({:engagement 5,
  :unread true,
  :crawled 1577678202309,
  :content
  {:content
   "On the impossibility of separating content from presentation I like writing in Emacs’ Org mode, not because it’s an especially good means of writing prose, but because I already use Org so heavily for notes and source code. My last post was written in Org mode. But my blog remains, as it always has been,… <p><a href=\"https://stuartsierra.com/2019/12/29/org-mode-for-blogging\">Read the full article</a></p><img alt=\"\" width=\"1\" src=\"http://feeds.feedburner.com/~r/StuartSierra/~4/zQF10CnByPs\" height=\"1\">",
   :direction "ltr"},
  :updated 1577676072000,
  :alternate
  [{:href
    "http://feedproxy.google.com/~r/StuartSierra/~3/zQF10CnByPs/org-mode-for-blogging",
    :type "text/html"}],
  :title "Org Mode for Blogging",
  :author "Stuart",
  :engagementRate 1.0,
  :published-str "Sun Dec 29 19:21:12 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16f54f2e5c5:21c7d86:bb2cd839",
  :visual {:url "none"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :htmlUrl "http://planet.clojure.in/",
   :title "Planet Clojure"},
  :originId "https://stuartsierra.com/?p=1242",
  :published 1577676072000,
  :fingerprint "1441730e",
  :canonicalUrl
  "http://feedproxy.google.com/~r/StuartSierra/~3/zQF10CnByPs/org-mode-for-blogging"}
 {:engagement 7,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1577467125273,
  :content
  {:content
   "<p>Each week, we discuss a different topic about Clojure and functional programming.</p>\n<p>If you have a question or topic you’d like us to discuss, tweet <a href=\"https://twitter.com/clojuredesign\">@clojuredesign</a>, send an email to <a href=\"mailto:feedback@clojuredesign.club\">feedback@clojuredesign.club</a>, or join the <code>#clojuredesign-podcast</code> channel on the <a href=\"http://clojurians.net/\">Clojurians Slack</a>.</p>\n<p>This week, the topic is: <strong>“Transducers.”</strong> We unpack transducers and find a familiar pattern that enables freedom from collections.</p>\n<p>Selected quotes:</p>\n<ul>\n<li>“The humble sequence. It is a mighty abstraction.”</li>\n<li>“Your reducing function can get more abstract by passing in the reducing function that handles producing the result.”</li>\n<li>“This is mind-bending enough, it’s worth saying again in a different way.”</li>\n<li>“We have a function that returns a function that returns a function!”</li>\n<li>“The cool thing about reducing functions is that they’re not about collections. They are about reduction.”</li>\n</ul>\n<p>Links:</p>\n<ul>\n<li><a href=\"https://clojure.org/reference/transducers\">Transducers</a> - Reference</li>\n<li><a href=\"https://blog.cognitect.com/blog/2014/8/6/transducers-are-coming\">Transducers are Coming</a> - Rich’s introductory blog post</li>\n<li><a href=\"https://clojure.org/guides/faq#transducers_vs_seqs\">What are good use cases for transducers?</a> - From the <a href=\"https://clojure.org/guides/faq\">Clojure FAQ</a></li>\n<li><a href=\"https://eli.thegreenplace.net/2017/reducers-transducers-and-coreasync-in-clojure/\">Reducers, transducers and core.async in Clojure</a></li>\n</ul>",
   :direction "ltr"},
  :updated 1577458800000,
  :alternate
  [{:href
    "https://clojuredesign.club/episode/061-transcendental-transformations/",
    :type "text/html"}],
  :title "Ep 061: Transcendental Transformations",
  :author "Christoph Neumann and Nate Jones",
  :engagementRate 0.88,
  :published-str "Fri Dec 27 07:00:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16f485e1e19:16582b4:bb2cd839",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :htmlUrl "http://planet.clojure.in/",
   :title "Planet Clojure"},
  :originId
  "https://clojuredesign.club/episode/061-transcendental-transformations/",
  :commonTopics
  [{:score 0.823,
    :id "nlp/f/topic/625",
    :salienceLevel "about",
    :label "deals"}
   {:score 26.455760707120408,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.943,
    :id "nlp/f/topic/861",
    :salienceLevel "about",
    :label "finance"}
   {:score 0.841,
    :id "nlp/f/topic/1695",
    :salienceLevel "mention",
    :label "parenting"}],
  :published 1577458800000,
  :fingerprint "2125bb09",
  :canonicalUrl
  "https://clojuredesign.club/episode/061-transcendental-transformations/"}
 {:engagement 19,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/todo",
    :label "todo"}
   {:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1577445604832,
  :content
  {:content
   "<p><a href=\"https://twitter.com/hillelogram\">Hillel Wayne</a> has a newsletter that you should absolutely <a href=\"https://buttondown.email/hillelwayne\">subscribe</a> to.\n<a href=\"https://buttondown.email/hillelwayne/archive/why-python-is-my-favorite-language/\">Todays edition</a> is called “Why Python Is My Favourite Languge”,\nand describes all the hurdles you need to jump in order to solve your $PROBLEM in a new language.</p>\n<p>So in this post, I’ll try to look at these hurdles, and see how they are overcome in my favourite language, Clojure:</p>\n<h2>How do I install the thing?</h2>\n<p>Hillel didn’t actually ask this question, but it’s IMO worth asking.\n<a href=\"https://clojure.org\">Clojure</a> is language running on the JVM, which means you need to have java installed (and yes I’m assuming a mac here):</p>\n<div><div><pre><code><span>$ </span>brew <span>install </span>adoptopenjdk\n</code></pre></div></div>\n<p>Once Java is installed, you should install <code>clojure</code> and you’re good to go:</p>\n<div><div><pre><code><span>$ </span>brew <span>install </span>clojure\n</code></pre></div></div>\n<p>This gives you two new commands, of which we’ll be focusing on <code>clj</code> which drops you into a repl:</p>\n<div><div><pre><code><span>$ </span>clj\nClojure 1.10.1\n<span>user</span><span>=></span>\n</code></pre></div></div>\n<p>You can read more about how to get started <a href=\"https://clojure.org/guides/getting_started\">here</a>.</p>\n<h2>How am I supposed to be writing this?</h2>\n<p>Clojure is editor agnostic, but anyone working in Clojure will be using her favourite $EDITOR with some plugin:</p>\n<ul>\n<li>Emacs, you will of course be using <a href=\"https://docs.cider.mx/cider/index.html\">CIDER</a>, unless you’re <a href=\"https://twitter.com/stuarthalloway\">Sherlock</a> and you’re using\n<a href=\"https://github.com/clojure-emacs/inf-clojure\">inf-clojure-mode</a></li>\n<li>Vim, here <a href=\"https://github.com/tpope/vim-fireplace\">fireplace</a> seems to be the choice of champions</li>\n<li>VSCode, your choice is <a href=\"https://calva.readthedocs.io/en/latest/\">Calva</a>, which aims at a great experience for beginners and pros alike</li>\n<li>For Intellij, just download <a href=\"https://cursive-ide.com\">Cursive</a>, which is free for personal use.</li>\n<li>Atom has <a href=\"https://atom.io/packages/chlorine\">Chlorine</a>, read more about it <a href=\"https://corfield.org/blog/2018/12/19/atom-chlorine/\">here</a></li>\n</ul>\n<p>2) How do I read from a file? How do I parse JSON, How do I pull environmental variables?\nThis section also contains two sub-questions, so let’s start with those:</p>\n<h3>How do I do any of the things that aren’t part of the core syntax/semantics, but are super common problems people face every day?</h3>\n<p>Let’s answer this and the first question from the section with one function: <a href=\"https://clojuredocs.org/clojure.core/slurp\"><code>slurp</code></a>.\n<code>slurp</code> lets you read from a file or a URL.</p>\n<div><div><pre><code><span>(</span><span>def</span><span> </span><span>passwords</span><span> </span><span>(</span><span>slurp</span><span> </span><span>&quot;/etc/password&quot;</span><span>))</span><span>\n</span><span>(</span><span>def</span><span> </span><span>news-letter</span><span> </span><span>(</span><span>slurp</span><span> </span><span>&quot;https://buttondown.email/hillelwayne/archive/why-python-is-my-favorite-language/&quot;</span><span>))</span><span>\n</span></code></pre></div></div>\n<p>its companion is calleds <a href=\"https://clojuredocs.org/clojure.core/spit\"><code>spit</code></a>:</p>\n<div><div><pre><code><span>(</span><span>spit</span><span> </span><span>&quot;/tmp/password&quot;</span><span> </span><span>(</span><span>slurp</span><span> </span><span>&quot;/etc/password&quot;</span><span>))</span><span>\n</span></code></pre></div></div>\n<h3>How do I parse JSON?</h3>\n<p>Parsing JSON is (unfortunatly) not part of the core language, so first we need to understand how we do dependency management in Clojure.</p>\n<h4>Dependency management</h4>\n<p>For dependency management in Clojure, there are several options (in addition to doing it manually which I will not cover here).\nThere is <a href=\"https://clojure.org/guides/deps_and_cli\"><code>deps</code></a> which is the most official way, and which is understood by the tools you installed previously, <a href=\"https://leiningen.org\">Leiningen</a> which was the defacto standard for many years, and <a href=\"https://boot-clj.com\">boot</a> which seems to be somewhat less popular these days.\nFor this post, I’ll be focusing on <code>deps</code>.</p>\n<p>So when you start <code>clj</code>, it will look for a file called <code>deps.edn</code> and parse it looking for dependencies. In its simplest form a <code>deps.edn</code> file will look like:</p>\n<div><div><pre><code><span>{</span><span>:deps</span><span>\n</span><span>{</span><span>cheshire</span><span> </span><span>{</span><span>:mvn/version</span><span> </span><span>&quot;5.9.0&quot;</span><span>}}}</span><span>\n</span></code></pre></div></div>\n<p>With a <code>deps.edn</code> like this, <code>clj</code> will download <a href=\"https://github.com/dakrone/cheshire\">cheshire</a> and start up Clojure with <code>cheshire</code> as a dependency, and voila, you can parse json:</p>\n<div><div><pre><code><span>(</span><span>require</span><span> </span><span>'</span><span>[</span><span>cheshire.core</span><span> </span><span>:as</span><span> </span><span>json</span><span>])</span><span>\n</span><span>(</span><span>json/decode</span><span> </span><span>&quot;{foo: \\&quot;bar\\&quot;}&quot;</span><span>)</span><span>\n</span><span>(</span><span>json/encode</span><span> </span><span>{</span><span>:foo</span><span> </span><span>&quot;</span><span>bar</span><span>})</span><span>\n</span></code></pre></div></div>\n<h3>How do I pull environment variables</h3>\n<p>Since Clojure is running on the JVM, it’s a matter of doing some <a href=\"https://www.clojure.org/reference/java_interop\">Java interop</a></p>\n<div><div><pre><code><span>(</span><span>System/getProperty</span><span> </span><span>&quot;user.dir&quot;</span><span>)</span><span>\n</span></code></pre></div></div>\n<p>The final question in this section was “Do I need to memorize another 100 functions and their params?”. My answer to this is of course “it depends”.\nFirst of all, the standard lib of Clojure is quite small, and since we’re basically always operating on maps and lists, you get fairly far with the basic operations on these datastructures (<code>map</code>, <code>filter</code>, <code>reduce</code>, <code>assoc</code>, <code>dissoc</code>)</p>\n<p>As a final note in this section, I’d recommend having a look at <a href=\"https://github.com/dakrone/clj-http\">clj-http</a> which should cover all your <code>http</code> needs.\nSo with a <code>deps.clj</code> looking like</p>\n<div><div><pre><code><span>{</span><span>:deps</span><span>\n</span><span>{</span><span>cheshire</span><span> </span><span>{</span><span>:mvn/version</span><span> </span><span>&quot;5.9.0&quot;</span><span>}</span><span>\n</span><span>clj-http</span><span> </span><span>{</span><span>:mvn/version</span><span> </span><span>&quot;3.10.0&quot;</span><span>}}}</span><span>\n</span></code></pre></div></div>\n<p>you’ll be set for most of your daily tasks.</p>\n<h2>What are the language quirks that will cast me an hour to discover</h2>\n<p>Clojure is famous for its bad error messages, so time will be spent on understanding them, this is but one example:</p>\n<div><div><pre><code><span>user=></span><span> </span><span>(</span><span>map</span><span> </span><span>1</span><span> </span><span>[</span><span>'lol</span><span>])</span><span>\n</span><span>Error</span><span> </span><span>printing</span><span> </span><span>return</span><span> </span><span>value</span><span> </span><span>(</span><span>ClassCastException</span><span>)</span><span> </span><span>at</span><span> </span><span>clojure.core/map$fn</span><span> </span><span>(</span><span>core.clj</span><span>:2753</span><span>)</span><span>.</span><span>\n</span><span>class</span><span> </span><span>java.lang.Long</span><span> </span><span>cannot</span><span> </span><span>be</span><span> </span><span>cast</span><span> </span><span>to</span><span> </span><span>class</span><span> </span><span>clojure.lang.IFn</span><span>\n</span></code></pre></div></div>\n<p>Having said that, a lot of work has been put down in order to make the error messages better in the last releases.</p>\n<h2>How is the help organized? Is there an official site? How’s the site laid out?</h2>\n<p>A lot of help is done in the <a href=\"http://clojurians.net\">Clojurians slack</a>, so yes, you may have to join yet another slack community.\nOtherwise, I find <a href=\"http://slipset.github.io/clojuredocs.org\">Clojure docs</a> extremely helpful for documentation on the standard library, <a href=\"https://cljdoc.org\">cljdoc</a> for documentation on most of the important community libraries, and the <a href=\"https://www.clojure-toolbox.com\">clojure toolbox</a> which is a directory of useful libraries.</p>\n<p>The official docs are there in the repl for you, along with the source and apropos:</p>\n<div><div><pre><code><span>$</span><span> </span><span>clj</span><span>\n</span><span>Clojure</span><span> </span><span>1.10</span><span>.1</span><span>\n</span><span>user=></span><span> </span><span>(</span><span>doc</span><span> </span><span>map</span><span>)</span><span>\n</span><span>-------------------------</span><span>\n</span><span>clojure.core/map</span><span>\n</span><span>([</span><span>f</span><span>]</span><span> </span><span>[</span><span>f</span><span> </span><span>coll</span><span>]</span><span> </span><span>[</span><span>f</span><span> </span><span>c1</span><span> </span><span>c2</span><span>]</span><span> </span><span>[</span><span>f</span><span> </span><span>c1</span><span> </span><span>c2</span><span> </span><span>c3</span><span>]</span><span> </span><span>[</span><span>f</span><span> </span><span>c1</span><span> </span><span>c2</span><span> </span><span>c3</span><span> </span><span>&amp;</span><span> </span><span>colls</span><span>])</span><span>\n</span><span>Returns</span><span> </span><span>a</span><span> </span><span>lazy</span><span> </span><span>sequence</span><span> </span><span>consisting</span><span> </span><span>of</span><span> </span><span>the</span><span> </span><span>result</span><span> </span><span>of</span><span> </span><span>applying</span><span> </span><span>f</span><span> </span><span>to</span><span>\n</span><span>the</span><span> </span><span>set</span><span> </span><span>of</span><span> </span><span>first</span><span> </span><span>items</span><span> </span><span>of</span><span> </span><span>each</span><span> </span><span>coll,</span><span> </span><span>followed</span><span> </span><span>by</span><span> </span><span>applying</span><span> </span><span>f</span><span> </span><span>to</span><span> </span><span>the</span><span>\n</span><span>set</span><span> </span><span>of</span><span> </span><span>second</span><span> </span><span>items</span><span> </span><span>in</span><span> </span><span>each</span><span> </span><span>coll,</span><span> </span><span>until</span><span> </span><span>any</span><span> </span><span>one</span><span> </span><span>of</span><span> </span><span>the</span><span> </span><span>colls</span><span> </span><span>is</span><span>\n</span><span>exhausted.</span><span> </span><span>Any</span><span> </span><span>remaining</span><span> </span><span>items</span><span> </span><span>in</span><span> </span><span>other</span><span> </span><span>colls</span><span> </span><span>are</span><span> </span><span>ignored.</span><span> </span><span>Function</span><span>\n</span><span>f</span><span> </span><span>should</span><span> </span><span>accept</span><span> </span><span>number-of-colls</span><span> </span><span>arguments.</span><span> </span><span>Returns</span><span> </span><span>a</span><span> </span><span>transducer</span><span> </span><span>when</span><span>\n</span><span>no</span><span> </span><span>collection</span><span> </span><span>is</span><span> </span><span>provided.</span><span>\n</span><span>nil</span><span>\n</span><span>user=></span><span> </span><span>(</span><span>source</span><span> </span><span>identity</span><span>)</span><span>\n</span><span>(</span><span>defn</span><span> </span><span>identity</span><span>\n</span><span>&quot;Returns its argument.&quot;</span><span>\n</span><span>{</span><span>:added</span><span> </span><span>&quot;1.0&quot;</span><span>\n</span><span>:static</span><span> </span><span>true</span><span>}</span><span>\n</span><span>[</span><span>x</span><span>]</span><span> </span><span>x</span><span>)</span><span>\n</span><span>nil</span><span>\n</span><span>user=></span><span> </span><span>(</span><span>apropos</span><span> </span><span>&quot;filter&quot;</span><span>)</span><span>\n</span><span>(</span><span>clojure.core/filter</span><span> </span><span>clojure.core/filterv</span><span>)</span><span>\n</span><span>user=></span><span>\n</span></code></pre></div></div>\n<p>So, no, you don’t have to be online to read the docs.</p>\n<p>The official docs could, IMO be considered aimed at masters, but I’d say that between the resources I’ve listed above, a beginner should also be catered to.</p>\n<h3>I hit problem X, Will I find help in the official docs, or the faq, or the community, or should I be putting random stuff into Google</h3>\n<p>One nice thing about Clojure is that if you put random stuff into Google and you find an answer from 2007 (when Clojure was first released) it is most likely still valid, as Clojure is earily backwards compatible, which means you can trust old advice. As for the official docs, I don’t think they’ll help you much with your day to day problems, but both the #clojure and #beginners channels are populated with friendly experts who will be able to help you on your way.</p>\n<h3>How do I debug? Will doing anything other than “breaking into a repl” be like pulling teeth?</h3>\n<p>I generally debug using <code>println</code> and also, since you generally program functionally, where you separate pure and sideffective functions, debugging in the repl is pretty sweet.\nEspecially since Clojure is all about <a href=\"https://vimeo.com/223309989\">repl-driven development</a></p>\n<h3>Testing. Is unit testing part of the core library?</h3>\n<p>Yes it is. <a href=\"https://clojure.github.io/clojure/clojure.test-api.html\">clojure.test</a>\nClojure has great support for <a href=\"https://github.com/clojure/test.check\">property based testing</a>, where <a href=\"https://www.clojure.org/about/spec\">clojure.spec</a> can be used to generate values for us. Read more about that <a href=\"http://www.adamfrey.me/posts/datomic-prop-testing-part-1.html\">here</a></p>\n<p>As for test runners. Tests are just normal functions which are annotated with <code>test</code> metadata, so you can easily run them in your repl. Having said that, most of the Clojure plugins come with some test integrations, and they basically work. Otherwise, both <code>lein</code> and <code>boot</code> come with ways of running the tests in the terminal, and with <a href=\"https://github.com/cognitect-labs/test-runner\">test.runner</a> you can make <code>clj</code> run your tests as well.\nI also have to mention <a href=\"https://github.com/lambdaisland/kaocha\">kaocha</a> which is the newest, coolest kid on the block.</p>\n<h3>How do I build? How do I package? How do I manage my environment?</h3>\n<p>Building is not really neccesary, as runing a Clojure program is as simple as:</p>\n<div><div><pre><code><span>$ </span>clj foo.clj\n</code></pre></div></div>\n<p>given that you have a file called <code>foo.clj</code> which contains a valid Clojure program.\nAs for the rest of the questions in this section, I believe this is answered elsewhere in the post, a part from the fact that yes, you will need to interact with other humans to figure out which of the competing libs are best for your use case.</p>\n<h3>So… the language community</h3>\n<p>Yes, you’ll have to, as already mentioned, join Yet Another Slack. There is also <a href=\"https://clojureverse.org\">Clojureverse</a> where a lot of the Clojure community hang out.\nThis community has a reputation of being friendly and helpful, which I think stems from what Rich Hickey <a href=\"https://clojure.org/community/etiquette\">wrote</a> years ago on how he wanted the community to behave.</p>",
   :direction "ltr"},
  :updated 1577404800000,
  :entities
  [{:mentions [{:text "Google"}],
    :id "nlp/f/entity/wd:95",
    :salienceLevel "mention",
    :label "Google"}],
  :alternate
  [{:href
    "http://slipset.github.io/posts/Why-Clojure-is-my-favourite-language",
    :type "text/html"}],
  :title "Why Clojure Is My Favourite Language",
  :author "Erik Assum",
  :engagementRate 2.38,
  :published-str "Thu Dec 26 16:00:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16f4715bde0:14b6f24:bb2cd839",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :htmlUrl "http://planet.clojure.in/",
   :title "Planet Clojure"},
  :originId
  "http://slipset.github.io/posts/Why-Clojure-is-my-favourite-language",
  :commonTopics
  [{:score 64.37803577474864,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1577404800000,
  :fingerprint "f507ed32",
  :canonicalUrl
  "http://slipset.github.io/posts/Why-Clojure-is-my-favourite-language"}
 {:engagement 15,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/todo",
    :label "todo"}
   {:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1577364536082,
  :content
  {:content
   "<p>You are now reading the last of our 24 blog posts on functional programming. We hope you have enjoyed our functional advent calendar, and maybe even learned something new. We have tried to keep a balance between introductory and slightly more advanced posts to make sure most people can find something interesting to read. Believe me – this ain’t as easy as it sounds!</p>\n<p>This last post is a bit different from the 23 previous ones. There will not be a single theme this time. Instead, we have collected some of the presentations on functional programming that we have enjoyed the most, and remember the best. They have different themes, but are all enjoyable and enlightning. You might have seen some of them before, but hopefully you’ll find at least one you haven’t.</p>\n<p>Happy holidays, thanks for joining us, and enjoy the talks!</p>\n<h2>Simple Made Easy – Rich Hickey</h2>\n<p>Link: <a href=\"https://www.infoq.com/presentations/Simple-Made-Easy/\">infoq.com/presentations/Simple-Made-Easy</a></p>\n<p>Length: 60 minutes</p>\n<blockquote>\n<p>Rich Hickey emphasizes simplicity’s virtues over easiness’, showing that while many choose easiness they may end up with complexity, and the better way is to choose easiness along the simplicity path.</p>\n</blockquote>\n<h2>Propositions as Types – Philip Wadler</h2>\n<p>Link: <a href=\"https://youtu.be/IOiZatlZtGU\">youtu.be/IOiZatlZtGU</a></p>\n<p>Length: 40 minutes</p>\n<blockquote>\n<p>The principle of Propositions as Types links logic to computation. At first sight it appears to be a simple coincidence---almost a pun---but it turns out to be remarkably robust, inspiring the design of theorem provers and programming languages, and continuing to influence the forefronts of computing. Propositions as Types has many names and many origins, and is a notion with depth, breadth, and mystery. Learn why functional programming is (and is not) the universal programming language.</p>\n</blockquote>\n<h2>Functional Principles for Object Oriented developers – Jessica Kerr</h2>\n<p>Link: <a href=\"https://www.infoq.com/presentations/fp-principles-oop/\">infoq.com/presentations/fp-principles-oop</a></p>\n<p>Length: 60 minutes</p>\n<blockquote>\n<p>How is an expert OO developer to improve on their craft? By learning from other paradigms! These six principles of the functional style also apply to OO. Some are part of good practice already; some express patterns both old and new; all give us different ways of thinking about problems. For developers without expertise in functional programming, examples in Java and C# provide new techniques for writing clear, quality code.</p>\n</blockquote>\n<h2>Parsing lexical ambiguity with Elm and expressive types – Emma Tsujimoto Cunningham</h2>\n<p>Link: <a href=\"https://youtu.be/sLh-7E-iOto\">youtu.be/sLh-7E-iOto</a></p>\n<p>Length: 20 minutes</p>\n<blockquote>\n<p>Parsing lexical ambiguity in natural language has always been a tricky endeavor, both from the perspective of formal linguistics as well as natural language processing. In this talk, we'll consider one of the canonical examples from linguistics, the &quot;Buffalo buffalo Buffalo buffalo buffalo buffalo Buffalo buffalo.&quot; sentence from Dmitri Borgmann's 1967 &quot;Beyond Language: Adventures in Word and Thought.&quot;</p>\n</blockquote>\n<h2>The Power of Composition – Scott Wlaschin</h2>\n<p>Link: <a href=\"https://vimeo.com/254635723\">vimeo.com/254635723</a></p>\n<p>Length: 60 minutes</p>\n<blockquote>\n<p>Composition is a fundamental principle of functional programming, but how is it different from an object-oriented approach, and how do you use it in practice? In this talk for beginners, we'll start by going over the basic concepts of functional programming, and then look at some different ways that composition can be used to build large things from small things. After that, we'll see how composition is used in practice, beginning with a simple FizzBuzz example, and ending with a complete (object-free!) web application.</p>\n</blockquote>\n<h2>Why Isn't Functional Programming the Norm? – Richard Feldman</h2>\n<p>Link: <a href=\"https://youtu.be/QyJZzq0v7Z4\">youtu.be/QyJZzq0v7Z4</a></p>\n<p>Length: 25 minutes</p>\n<blockquote>\n<p>Richard Feldman explores the reason why functional programming hasn’t taken over despite its advantages.</p>\n</blockquote>\n<h2>Functional Composition – Chris Ford</h2>\n<p>Link: <a href=\"https://youtu.be/jyNqHsN3pEc\">youtu.be/jyNqHsN3pEc</a></p>\n<p>Length: 40 minutes</p>\n<blockquote>\n<p>Chris Ford demonstrates that music theory can be delightfully represented as code. He shows how to make music starting with the basic building block of sound, the sine wave, and gradually accumulates abstractions culminating in a canon by Johann Sebastian Bach. Examples will be live-coded in Clojure.</p>\n</blockquote>\n<h2>Communicating in Types – Kris Jenkins</h2>\n<p>Link: <a href=\"https://youtu.be/R2afqbzWDiU\">youtu.be/R2afqbzWDiU</a></p>\n<p>Length: 40 minutes</p>\n<blockquote>\n<p>Modern type systems have come a long way from the days of C and Java. Far from being nit-pickers that berate us for making mistakes, type systems like the ones found in Haskell, PureScript and Elm form a language in themselves. A language for expressing high-level ideas about our software to our colleagues and to the computer. A design language. In this talk, we'll take a look at the way the right kind of type signatures let us talk about software. We'll survey how to state our assumptions about the domain we're coding in and how each part fits together. We'll show how it can highlight problems, and surface opportunities for reuse. And most importantly, we'll see how types can help you communicate to your coworkers, and to future maintainers, with little effort. You've probably heard the phrase, &quot;programs are meant to be read by humans and only incidentally for computers to execute.&quot; Come and see how a modern type system is about communicating ideas to humans, and only incidentally about proving correctness.</p>\n</blockquote>",
   :direction "ltr"},
  :updated 1577145600000,
  :alternate
  [{:href "https://functional.christmas/2019/24", :type "text/html"}],
  :title "Merry Functional Christmas",
  :author "The functional Christmas",
  :engagementRate 1.88,
  :published-str "Mon Dec 23 16:00:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16f4240bb12:f7de18:dcfbed0f",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url
   "https://images.unsplash.com/photo-1512389142860-9c449e58a543?w=1226&h=400&fit=crop&crop=edges",
   :width 1226,
   :height 400,
   :contentType "image/jpeg"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://functional.christmas/functional-2019-24",
  :commonTopics
  [{:score 94.15752719432669,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1577145600000,
  :fingerprint "40590057",
  :canonicalUrl "https://functional.christmas/2019/24"}
 {:engagement 13,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1577200585597,
  :recrawled 1577202373159,
  :content
  {:content
   "<div><p><em>This post is part of <a shape=\"rect\" href=\"https://lambdaisland.com/blog/2019-11-25-advent-of-parens\">Advent of Parens\n2019</a>, my attempt to\npublish one blog post a day during the 24 days of the advent.</em></p><p>Day 24, I made it! I did skip a day because I was sick and decided it was more\nimportant to rest up, but I’m pretty happy with how far I got.</p><p>Let’s see how the others fared who took on the challenge. John Stevenson at\n<a shape=\"rect\" href=\"https://practicalli.github.io/blog/\">Practicalli</a> got four posts out spread out\nacross the advent period, similar to lighting an extra candle every sunday of\nthe advent. Good job!</p><p><a shape=\"rect\" href=\"https://porkostomus.gitlab.io/\">Bobby Towers</a> mostly wrote about all the work\nhe’s done on his Mario-inspired media creation platform called MECCA, making it\nto a respectable 6 day streak.</p><p><a shape=\"rect\" href=\"http://slipset.github.io/\">Erik Assum</a> aka slipset managed a three day streak,\nand then wrote a few more posts, making it to day 8. Nice!</p><p><a shape=\"rect\" href=\"https://alexanderoloo.com/\">Alexander Oloo</a> did admit on Twitter that the odds\nwere small he would complete it. He did make it to day 9. I really appreciated\nhis more beginner-friendly articles. Good job Alex, keep writing!</p><p>Never afraid of a challenge Bozhidar Batsov also picked up the torch, writing on\nhis <a shape=\"rect\" href=\"https://metaredux.com/\">Metaredux</a> blog, running a flawless 24 day streak.\nRespect! The posts are a mix of Clojure and Ruby, and all enjoyable.</p><p>What I really hoped to achieve with this challenge was to inspire at least a few\npeople in the Clojure world to blog more. These independent voices are a vital\npart of a healthy community.</p><p>Some people asked if I wouldn’t run out of ideas, but honestly I still have a\ndozen topics left without even trying. What people don’t realize is that things\ndon’t have to be revolutionary or ground breaking to make good posts. On the\ncontrary, people try too hard to be thought leaders, on blogs, in conference\ntalks, on Twitter. It gets really old!</p><p>Instead speak directly from your own experience, whatever that may be. It\ndoesn’t have to be new or advanced, it just has to be genuine. You don’t need to\nwow, you just need to share. Every programming thing that anybody knows they\nonce had to learn. This means every small thing you do is worth writing about,\nfor the benefit of the next person.</p><p>And even more interesting then the technical details are the story, the context. Why did you do this? What were you working on? How did it turn out? My favorite blog posts and conference talks are basically this: “We had to solve this real-world problem under these constraints, we took this approach, and this worked out well (or not) for us”. My least favorite format is “Here’s an architecture/platform/methodology that is amazing and you should use it.”.</p><p>So write from your experience. Literally everything can be a topic, like a friend told me, it’s a state of\nmind. Start noticing the little things you do, the bits of code you find\ninteresting, the things you figure out, the hacks and tricks you came up with or\nlearned from someone else. Start keeping that list, and then every so often take\nsome time, pick an item from the list, and write that blog post. Don’t dwell it\non it and polish it to perfection. Just get it out and move on!</p><p>I want to thank everyone who blogged about Clojure this year. You all rock! And I want to thank everyone who will blog about Clojure in 2020 in advance. To use Eric Normand’s creed: Rock on!</p><p>How about you, will you blog about Clojure in 2020? If you do then make sure to\nadd your blog to the <a shape=\"rect\" href=\"http://planet.clojure.in/\">Planet Clojure</a> blog\naggregator. I just <a shape=\"rect\" href=\"https://github.com/ghoseb/planet.clojure/pull/297\">addded a\nPR</a> for Alexander Oloo, Erik\nAssum, and Practicalli.</p><p>Other places to get your blog posts out are the <a shape=\"rect\" href=\"https://clojureverse.org/c/learning-resources/blogs/42\">Blogs Category on\nClojureVerse</a> or the\n<code>#news-and-articles</code> on Clojurians slack,</p><p>You can also <a shape=\"rect\" href=\"https://twitter.com/planetclojure\">follow Planet Clojure on Twitter</a> if\nyou would like to see some more blogs on your timeline.</p><p>Enjoy your holidays, and see you all in 2020!</p><p><em>Hi, my name is Arne (aka @plexus) and I consult companies and teams about\napplication architecture, development process, tooling and testing. I\ncollaborate with other talented people under the banner\n<a shape=\"rect\" href=\"http://gaiwan.co\">Gaiwan</a>. If you like to have a chat about how we could help\nyou with your project then please <a shape=\"rect\" href=\"https://lambdaisland.com/p/contact\">get in touch!</a></em></p><p><strong><a shape=\"rect\" href=\"https://clojureverse.org/t/advent-of-parens-2019/5159\">Comment on ClojureVerse</a></strong></p></div>",
   :direction "ltr"},
  :updated 1577199670000,
  :alternate
  [{:href
    "https://lambdaisland.com/blog/2019-12-24-advent-of-parens-24-the-last-post",
    :type "text/html"}],
  :title "Advent 2019 part 24, The Last Post",
  :author "Arne Brasseur",
  :engagementRate 1.63,
  :published-str "Tue Dec 24 07:01:10 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16f387b0b7d:651175:512e2118",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://lambdaisland.com/blog/2019-12-24-advent-of-parens-24-the-last-post",
  :updateCount 1,
  :commonTopics
  [{:score 0.816,
    :id "nlp/f/topic/2148",
    :salienceLevel "mention",
    :label "spiritual"}],
  :published 1577199670000,
  :fingerprint "e0dcb01e",
  :canonicalUrl
  "https://lambdaisland.com/blog/2019-12-24-advent-of-parens-24-the-last-post"}
 {:engagement 5,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1577187244447,
  :content
  {:content
   "<p>In this episode I talk with Eric Normand. We talk his podcast “Thoughts on Functional Programming”; his in-progress book “Grokking Simplicity”; Actions, Calculations, and Data; trying to bury mutation and side-effects; Property-Based testing; and more.</p>\n<h2>Our Guest, Eric Normand</h2>\n<p><a href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly93d3cudHdpdHRlci5jb20vZXJpY25vcm1hbmQ%3D&feed-stats-url-post-id=15500\">@ericnormand</a> on Twitter<br>\n<a href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly9wdXJlbHlmdW5jdGlvbmFsLnR2Lw%3D%3D&feed-stats-url-post-id=15500\">PurelyFunctional.tv</a><br>\n<a href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly9saXNwY2FzdC5jb20v&feed-stats-url-post-id=15500\">LispCast.com</a><br>\n<a href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly9saXNwY2FzdC5jb20vY2F0ZWdvcnkvcG9kY2FzdC8%3D&feed-stats-url-post-id=15500\">Thoughts on Functional Programming</a><br>\n<a href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly9saXNwY2FzdC5jb20vZ3M%3D&feed-stats-url-post-id=15500\">Grokking Simplicity</a></p>\n<h3>Conference Announcements</h3>\n<p>Lambda Days 2020 will be on the 13th and 14th of February in Kraków, Poland. Visit <a href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly93d3cubGFtYmRhZGF5cy5vcmcvbGFtYmRhZGF5czIwMjA%3D&feed-stats-url-post-id=15500\">https://www.lambdadays.org/lambdadays2020</a> to find out more and to register.</p>\n<p>Code BEAM SF is taking place on March 6th and 6th. For more information visit: <a href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly9jb2Rlc3luYy5nbG9iYWwvY29uZmVyZW5jZXMvY29kZS1iZWFtLXNmLw%3D%3D&feed-stats-url-post-id=15500\">https://codesync.global/conferences/code-beam-sf/</a>.</p>\n<p>Elm in the Spring will be taking place May 1st. Check in at <a href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly93d3cuZWxtaW50aGVzcHJpbmcub3JnLw%3D%3D&feed-stats-url-post-id=15500\">https://www.elminthespring.org/</a> to keep updated as more information gets announced.</p>\n<p>If you have a conference related to functional programming, contact me, and I will be happy to announce it.</p>\n<h3>Announcements</h3>\n<p>Some of you have asked how you can support Functional Geekery, in that vein, Functional Geekery now has a Patreon Page.</p>\n<p>If that is one of the ways you would like to show your support, you can find out more at <a href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly93d3cucGF0cmVvbi5jb20vZm5nZWVrZXJ5&feed-stats-url-post-id=15500\">https://www.patreon.com/fngeekery</a>.</p>\n<h3>Topics [@2:32]</h3>\n<p>Welcome back Eric<br>What Eric has been up to since <a href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly93d3cuZnVuY3Rpb25hbGdlZWtlcnkuY29tL2VwaXNvZGUtMTE3LWVyaWMtbm9ybWFuZC8%3D&feed-stats-url-post-id=15500\">Episode 117</a><br><a href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly9wdXJlbHlmdW5jdGlvbmFsLnR2Lw%3D%3D&feed-stats-url-post-id=15500\">PurelyFunctional.tv</a><br><a href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly9saXNwY2FzdC5jb20vZ3M%3D&feed-stats-url-post-id=15500\">Grokking Simplicity</a><br>What prompted the <a href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly9saXNwY2FzdC5jb20vY2F0ZWdvcnkvcG9kY2FzdC8%3D&feed-stats-url-post-id=15500\">Thoughts on Functional Programming</a> podcast<br>Started from Eric’s<a href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly9saXNwY2FzdC5jb20vbGFtYmR1cC0yMDE3LXRoZW9yeS1mdW5jdGlvbmFsLXByb2dyYW1taW5nLw%3D%3D&feed-stats-url-post-id=15500\">talk at Lambdup 2017</a><br>Being told it is much easier to edit existing text than write new text<br>Trying to start a literature around functional programming<br>Figuring out the format/layout of the book<br>“Just imagine each page as a slide”<br>The target audience for the book<br>“Functional programming is programming without side effects”<br>Not being able to recommend any books on getting started with functional programming<br>Actions, Calculations, and Data<br>Actions (Impure “Function”) – Depend on when, or how many times, they are run<br>Side-effects also being the reason we write programs<br>Calculations (Pure “Functions”) – Same arguments, same answer no matter how many times you run it<br>Data – completely inert<br>Data can be interpreted in multiple ways<br>Other side of Data is that it requires at least some interpretation<br>How to help distinguish Actions from Calculations<br><a href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly93d3cuaGFza2VsbC5vcmcv&feed-stats-url-post-id=15500\">Haskell</a>‘s IO type containing all side-effects as brilliant<br>The illusion that we are not doing any mutability at the machine level<br>Blurry line between Actions and Calculations in some cases<br>Any conventions for later readers to hint at Actions vs Calculations<br>Selling the separation of Calculations from Actions<br>Spending time on showing how Actions “contaminate” Calculations<br>The idea that “You could abstract away the mutation”<br>Thinking you are going to bury and covering up the problem<br>“Can you construct a User from an ID without hitting the database”<br>Needing mocks as a possible signal of being an Action instead of a Calculation<br><a href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly9wdXJlbHlmdW5jdGlvbmFsLnR2L2Jyb3dzZS8%3D&feed-stats-url-post-id=15500\">PurelyFunctional.tv videos</a><br><a href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly9saXNwY2FzdC5jb20vY2F0ZWdvcnkvcG9kY2FzdC8%3D&feed-stats-url-post-id=15500\">Thoughts on Functional Programming podcast</a><br>Property-Based Testing videos<br><a href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly9wdXJlbHlmdW5jdGlvbmFsLnR2L2NvdXJzZXMvcHJvcGVydHktYmFzZWQtdGVzdGluZy13aXRoLXRlc3QtY2hlY2sv&feed-stats-url-post-id=15500\">Beginning Property-Based Testing course</a><br><a href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly9wdXJlbHlmdW5jdGlvbmFsLnR2L2NvdXJzZXMvaW50ZXJtZWRpYXRlLXByb3BlcnR5LWJhc2VkLXRlc3Rpbmctd2l0aC10ZXN0LWNoZWNrLw%3D%3D&feed-stats-url-post-id=15500\">Intermediate Property-Based Testing course</a><br><a href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly9wdXJlbHlmdW5jdGlvbmFsLnR2L2NvdXJzZXMvYWR2YW5jZWQtcHJvcGVydHktYmFzZWQtdGVzdGluZy13aXRoLXRlc3QtY2hlY2sv&feed-stats-url-post-id=15500\">Advanced Property-Based Testing course</a><br>Property-Based testing<br><a href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cDovL3d3dy5jc2UuY2hhbG1lcnMuc2UvfnJqbWgvUXVpY2tDaGVjay8%3D&feed-stats-url-post-id=15500\">QuickCheck</a><br>Next course likely building a web-app in Clojure<br>Bag of Tricks for Property-Based testing<br>Developing for Stateful Systems<br>Model-based Property testing<br>Taking a Stateful test to a Parallel test to a Distributed Test<br><code>TSSIMPLICITY</code> discount code for 50% off</p>\n<p>As always, a giant Thank You goes to <a href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly93d3cudHdpdHRlci5jb20vZGF2aWRqYmVsY2hlcg%3D%3D&feed-stats-url-post-id=15500\">David Belcher</a> for the logo design.</p>\n<img width=\"1\" src=\"https://www.functionalgeekery.com/?feed-stats-post-id=15500\" height=\"1\">",
   :direction "ltr"},
  :updated 1577185200000,
  :entities
  [{:mentions [{:text "Patreon"}],
    :id "nlp/f/entity/wd:15861362",
    :salienceLevel "mention",
    :label "Patreon"}],
  :alternate
  [{:href
    "https://www.functionalgeekery.com/functional-geekery-episode-129-eric-normand/",
    :type "text/html"}],
  :title "Functional Geekery Episode 129 – Eric Normand",
  :author "functionalgeekery",
  :engagementRate 0.63,
  :published-str "Tue Dec 24 03:00:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16f37af799f:537c7b:512e2118",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://www.functionalgeekery.com/functional-geekery-episode-129-eric-normand/",
  :commonTopics
  [{:score 46.48365494570225,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1577185200000,
  :fingerprint "3f5a9e9d",
  :canonicalUrl
  "https://www.functionalgeekery.com/functional-geekery-episode-129-eric-normand/"}
 {:engagement 5,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1577133609857,
  :recrawled 1577196125368,
  :content
  {:content
   "<div><p><em>This post is part of <a shape=\"rect\" href=\"https://lambdaisland.com/blog/2019-11-25-advent-of-parens\">Advent of Parens\n2019</a>, my attempt to\npublish one blog post a day during the 24 days of the advent.</em></p><p>I’ve been a big fan of SVG since the early 2000’s. To me it’s one of the great\nvictories of web standards. Mind you, browser support has taken a long time to catch up.\nBack then you had to embed your SVG file with an <code>&lt;object></code> tag, and support for the\nmany cool features and modules was limited and inconsistent.</p><p>These days of course you can drop an <code>&lt;svg></code> tag straight into your HTML. What a\njoy! And since the SVG can now go straight into the DOM, you can draw your SVG\nwith React/Reagent. Now there’s a killer combo.</p><p>I already mentioned\n<a shape=\"rect\" href=\"https://lambdaisland.com/blog/2019-12-10-advent-of-parens-10-hillchart-reagent-shadow-firebase\">Hillcharts</a>\nearlier in this series. Another SVG project that I’ve been tinkering on is a\ngame prototype called Hexagons (working title). It came about when I was on vacation the weeks\nafter Heart of Clojure. I had taken some time off to decompress, eat rösti, and\nspend some time in nature. One evening my idle mind started wandering and came\nup with an idea for a tabletop game. I built a first prototype of it the next\nday from cardboard, playing cards, post-its and pebbles.</p><p>The prototype left to be desired, and I figured that if I wanted to experiment\nmore with the game mechanics then a browser-based version would actually be\npretty convenient. This would also allow me to try it out with some of my old\nbuddies back home whom I don’t get to see often, thanks to the magic of the internet.</p><p>The whole game is just a single big SVG, so my idea was to have this one <code>&lt;svg></code>\nelement simply span the full browser viewport. This wasn’t as easy as I thought\nit would be. CSS was of little help, it was easy enough to have it span the full\nwidth, but I couldn’t figure out a good way to have it span the full height.</p><p>So I came up with this.</p><pre><code>(defn viewport-size []\n  {:width js/document.documentElement.clientWidth\n   :height js/document.documentElement.clientHeight})\n</code></pre><p>This app is just a simple Reagent app, no re-frame or anything like that. Since\nit’s pretty limited in scope I figured it would be fun to go back to basics, and\njust use ratoms and reactions directly.</p><p>In typical reagent/re-frame style a single ratom contains the application state,\nincluding the size of the browser viewport.</p><pre><code>(defonce state (reagent/atom (viewport-size)))\n</code></pre><p>And this is what the root of the render tree looks like. I’m using the SVG\n<code>viewBox</code> property to shift the coordinate system so that <code>[0, 0]</code> is right in\nthe middle of the browser.</p><p>The game pieces are hexagonal tiles. You start with one tile, and then players\nadd more tiles one by one, so the game kind of grows out of the center where\nthat first tile is. That’s why I decided to lay the coordinates like this.</p><p>Other UI elements are drawn relative to the viewport edge. This turned out to\nwork well with the zoom functionality built into browsers. When you zoom out all\ntiles and other elements get smaller, but they keep their position either\nrelative to the center of the viewport, or relative to the edge of the viewport.</p><pre><code>(defn app-root []\n  (let [{:keys [width height]} @state\n        top-left-x (/ width -2)\n        top-left-y (/ height -2)]\n    [:svg {:width width\n           :height height\n           :viewBox (str/join &quot; &quot; [top-left-x top-left-y width height])}\n     ;; UI goes in here\n     ]))\n</code></pre><p>You still need to handle browser resizing, that’s what this final snippet is\nfor.</p><pre><code>(set! js/document.body.onresize (fn [_] (swap! state merge (viewport-size))))\n</code></pre><p>Playing around with SVG, Reagent’s hiccup, and Figwheel or shadow-cljs for\nreloading is a lot of fun. I can highly recommend it. If you’re not sure how to\nstart then just draw some things in Inkscape, convert the result to Hiccup, and\npaste it into your code.</p><p><em>Hi, my name is Arne (aka @plexus) and I consult companies and teams about\napplication architecture, development process, tooling and testing. I\ncollaborate with other talented people under the banner\n<a shape=\"rect\" href=\"http://gaiwan.co\">Gaiwan</a>. If you like to have a chat about how we could help\nyou with your project then please <a shape=\"rect\" href=\"https://lambdaisland.com/p/contact\">get in touch!</a></em></p><p><strong><a shape=\"rect\" href=\"https://clojureverse.org/t/advent-of-parens-2019/5159\">Comment on ClojureVerse</a></strong></p></div>",
   :direction "ltr"},
  :updated 1577195025000,
  :alternate
  [{:href
    "https://lambdaisland.com/blog/2019-12-23-advent-of-parens-23-full-size-svg-with-reagent",
    :type "text/html"}],
  :title "Advent 2019 part 23, Full size SVG with Reagent",
  :author "Arne Brasseur",
  :published-str "Tue Dec 24 05:43:45 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16f347d1381:18e306:512e2118",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://lambdaisland.com/blog/2019-12-23-advent-of-parens-23-full-size-svg-with-reagent",
  :updateCount 1,
  :commonTopics
  [{:score 39.18187736334674,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 22.178370216250748,
    :id "nlp/f/topic/3029",
    :salienceLevel "about",
    :label "games"}],
  :published 1577195025000,
  :fingerprint "ed826500",
  :canonicalUrl
  "https://lambdaisland.com/blog/2019-12-23-advent-of-parens-23-full-size-svg-with-reagent"}
 {:engagement 5,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1577101779127,
  :content
  {:content
   "<div>\n<p><em>Issue 357 – December 23, 2019 · <a href=\"https://purelyfunctional.tv/newsletter-archives/\">Archives</a> · <a title=\"Thanks, Jeff!\" href=\"https://purelyfunctional.tv/newsletter/\">Subscribe</a></em></p>\n<h2>Clojure Tip 💡</h2>\n<p><em>recursion vs iteration</em></p>\n<p>Astute reader and all-around awesome community member Ray asked a very important question: isn’t <code>loop/recur</code> recursion and not iteration?</p>\n<p>We do have some iterative constructs in Clojure. There’s <code>dotimes</code> and <code>doseq</code> and even a <code>while</code> loop. We also have recursive constructs. There’s regular recursion (a function calling itself) and explicit tail recursion (<code>recur</code>). So, what’s the deal? Why did I call my <code>loop/recur</code> version of Fibonacci <em>iterative</em>?</p>\n<p>It’s a great question, and the short answer is I was using the terms <em>iterative</em> and <em>recursive</em> a little loosely. Let’s look at the recursive definition of Fibonacci.</p>\n<pre><code>(defn fib [n]\n  (cond\n    (= 0 n)\n    0\n    \n    (= 1 n)\n    1\n    \n    :else\n    (+' (fib (- n 1)) (fib (- n 2)))))\n</code></pre>\n<p>This version of the function clearly defines Fibonacci in terms of itself. That’s what I’m refering to as <em>recursive</em>.</p>\n<p>Now let’s look at the version that I’m calling <em>iterative</em>.</p>\n<pre><code>(defn fib5 [n]\n  (if (&lt; n 2)\n    n\n    (loop [i 2 f2 0 f1 1]\n      (if (= i n)\n        (+' f1 f2)\n        (recur (inc i) f1 (+' f1 f2))))))\n</code></pre>\n<p><code>loop</code> is just a shorthand for what would be another function call. Let’s look at the longhand.</p>\n<pre><code>\n(defn fib5-helper [n i f2 f1]\n  (if (= i n)\n    (+' f1 f2)\n    (recur n (inc i) f1 (+' f1 f2))))\n\n(defn fib5 [n]\n  (if (&lt; n 2)\n    n\n    (fib5-helper n 2 0 1)))\n</code></pre>\n<p>That is to say that <code>loop</code> is a short way of defining a new function that is itself recursive and calling it. In this case it is called <code>fib5-helper</code>. But <code>fib5</code> is no longer defined in terms of itself, so it is not recursive.</p>\n<p>Is <code>fib5-helper</code> recursive? Technically, yes. But I’m so used to thinking of tail recursive functions like this as tight loops that I used the term <em>iterative</em> instead. <code>fib5-helper</code> probably gets compiled down to something similar to this Java code:</p>\n<pre><code>long fib5Helper(long n, long i, long f2, long f1) {\n  while(true) {\n    if(n == i)\n      return f1 + f2;\n    i++;\n    long tf1 = f1;\n    f1 = tf1 + f2;\n    f2 = tf1;\n  }\n}\n</code></pre>\n<p>That’s how I think of <code>loop/recur</code>. Tail recursion gets converted into an iterative loop that has a value (since it’s an expression). It’s a mistake to not call it recursion, though. I really should have said “convert recursion to tail recursion”. That would have been more accurate.</p>\n<p>Thanks, Ray!</p>\n<h2>Follow-up 🙃</h2>\n<p>Ray also mentioned that using the letter <code>l</code> for one-character variable names is a really bad idea because many fonts make it hard to distinguish between <code>l</code> and <code>1</code> (el and one). Good call, Ray! There are so many great letters, <code>l</code> should be avoided.</p>\n<p>It reminded me of this Java puzzler: https://youtu.be/wbp-3BJWsU8?t=2584</p>\n<p>BTW, watching that (and a few other Java Puzzler videos) in order to find the puzzle that I remembered reminded me of how lucky we are in Clojure. Remember how easy it is to get things wrong in Java next time you’re complaining about Clojure.</p>\n<h2>Clojure Media 🍿</h2>\n<p><a title href=\"https://calva.readthedocs.io/en/latest/paredit.html\">Paredit — a Visual Guide</a></p>\n<p>This animated guide to the operations of Paredit is so fun to watch.</p>\n<h2>Clojure Challenge 🤔</h2>\n<h3>Last week’s challenge</h3>\n<p>The challenge in <a title href=\"https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-356-tip-convert-recursion-to-iteration/\">Issue 356</a> was to implement prime factoring. You can see the <a title href=\"https://gist.github.com/ericnormand/b98bcd33561ba7dcea733249e77961c3\">submissions</a>.</p>\n<p>I wanted to bring something up. My version was very good on many measures. It has very little nesting, it’s concise, and it works!</p>\n<pre><code>(defn factor\n  ([n]\n   (factor 2 [] n))\n  ([p ps n]\n   (cond\n     (= 1 n)\n     ps\n\n     (zero? (rem n p))\n     (recur p (conj ps p) (quot n p))\n\n     :else\n     (recur (inc p) ps n))))\n</code></pre>\n<p>However, I’ve been thinking about mathematical algorithms, especially those that have been worked over so many times by many developers. Sometimes, there is a clever bit of math done on paper that doesn’t show up in the code.</p>\n<p>For instance, I know that once I factor out all of the 2s, the resulting number will never be divisible by 4 (or any other even number). Likewise for 3. Once I factor out all the 3s, it will never be divisible by 6 or 9. This means I get a Sieve of Eratosthenes “for free”. No need to generate the list of primes separately.</p>\n<p>But the more I look at it, the more concerned I am with it. There’s something that is too clever about it. That mathematical reasoning is not evident in the code. And there are certain assumptions that follow from it. For instance, it means I have to start at 2 and work up, just like you would for a Sieve of Eratosthenes.</p>\n<p>Here’s what’s bothering me. The code is simple because it contains a lot of assumptions. Those assumptions are based on mathematical reasoning that is not captured in the code. And the mathematical reasoning is not easy to do. I got lucky and had seen this algorithm before. If I hadn’t learned it, what are the chances I’d get it myself? Am I worried about nothing?</p>\n<h3>This week’s challenge</h3>\n<p><em>task dependencies</em></p>\n<p>Let’s say you’re writing a project management app. A user will have a bunch of tasks to do and each task might depend on other tasks. Your challenge is to write a function that, given tasks and dependencies, gives at least one order for the tasks such that no task is done before its dependencies are done.</p>\n<pre><code>(def tasks [:clean-breakfast :shoes :socks :cook-breakfast \n:eat-breakfast])\n\n(def dependencies [[:socks :shoes] ;; socks come before shoes; shoes depend on \nsocks\n                   [:cook-breakfast :eat-breakfast] ;; cooking comes before \neating\n                   [:eat-breakfast :clean-breakfast]])\n(defn order-tasks [tasks dependencies]\n ;; you fill this out\n )\n\n(order-tasks tasks dependencies) => [:socks :shoes :cook-breakfast \n:eat-breakfast :clean-breakfast]\n</code></pre>\n<p>As usual, please reply to this email and let me know what you tried. I’ll collect them up and share them in the next issue. If you don’t want me to share your submission, let me know.</p>\n<p>Rock on!<br>Eric Normand</p>\n</div>\n<p>The post <a rel=\"nofollow\" href=\"https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-357-tip-recursion-vs-iteration/\">PurelyFunctional.tv Newsletter 357: Tip: recursion vs iteration</a> appeared first on <a rel=\"nofollow\" href=\"https://purelyfunctional.tv\">PurelyFunctional.tv</a>.</p>",
   :direction "ltr"},
  :updated 1577098800000,
  :alternate
  [{:href
    "https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-357-tip-recursion-vs-iteration/",
    :type "text/html"}],
  :title
  "PurelyFunctional.tv Newsletter 357: Tip: recursion vs iteration",
  :author "Eric Normand",
  :published-str "Mon Dec 23 03:00:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16f329760b7:1a37ad9:69b9f616",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://purelyfunctional.tv/?p=47123",
  :commonTopics
  [{:score 49.969612559721575,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1577098800000,
  :fingerprint "ee63e656",
  :canonicalUrl
  "https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-357-tip-recursion-vs-iteration/"}
 {:engagement 6,
  :unread true,
  :crawled 1577091385909,
  :content
  {:content
   "<p><em>This article is part of the <a href=\"http://metaredux.com/posts/2019/12/01/meta-advent-2019.html\">“Meta Advent 2019”</a> series. I’ve committed to writing\na new blog post here every day until Christmas.</em></p>\n<p>A while ago I wrote <a href=\"http://metaredux.com/posts/2019/11/02/hard-cider-understanding-the-jack-in-process.html\">an article explaining how the jack-in process in CIDER works</a>, but I omitted one subject -\nwhat happens if your project has multiple project marker files (e.g. <code>project.clj</code> and <code>deps.edn</code>).\nThis wasn’t a big issue a few years back, when almost everyone was using Leiningen, but now it’s pretty\ncommon to have some project with both Leiningen and <code>tools.deps</code> project marker files in it, or maybe <code>tools.deps</code>\nand <code>shadow-cljs</code>. So, how does CIDER handle such ambiguity and decide which tool to use when starting a REPL?</p>\n<p>Well, by default it will simply prompt you to select one of the build tools it detected. Pretty simple, but\nalso a bit annoying if you keep selecting the same tool all of the time. Fortunately, CIDER has an option\nto customize this though the <code>cider-preferred-build-tool</code> configuration variable.<sup><a href=\"http://metaredux.com/posts/2019/12/23/hard-cider-dealing-with-multiple-project-markers.html#fn:1\">1</a></sup> If you’re fond of Leiningen you can\ninstruct CIDER to always prefer it like this:</p>\n<div><div><pre><code><span>(</span><span>setq</span> <span>cider-preferred-build-tool</span> <span>'lein</span><span>)</span>\n</code></pre></div></div>\n<p>In practice it will be common to have the preferred build tool depending on the project you’re working on,\nso an optimal approach to leverage this variable would be through <a href=\"http://metaredux.com/posts/2019/10/05/hard-cider-project-specific-configuration.html\">project-specific configuration</a>:</p>\n<div><div><pre><code><span>((</span><span>clojure-mode</span>\n  <span>(</span><span>cider-preferred-build-tool</span> <span>.</span> <span>lein</span><span>)))</span>\n</code></pre></div></div>\n<p>In the end of the day you might combine the two approaches by putting in your global configuration (e.g. <code>init.el</code>) your\nfavourite tool and overriding this default choice on a per-project basis via <code>.dir-locals.el</code>. That’s what I normally do,\nalthough frankly speaking, I restart my REPLs so rarely that I don’t have any issues being prompted about the\nbuild tool to use every time I do so.</p>\n<p>That’s all I have for you today. See you again tomorrow!</p>\n<h2>Articles in the Series</h2>\n<ul>\n<li><a href=\"http://metaredux.com/posts/2019/05/11/hard-cider-keeping-your-repl-tidy.html\">Hard CIDER: Keeping your REPL Tidy</a></li>\n<li><a href=\"http://metaredux.com/posts/2019/05/15/hard-cider-repl-shortcuts.html\">Hard CIDER: REPL Shortcuts</a></li>\n<li><a href=\"http://metaredux.com/posts/2019/07/10/hard-cider-easy-downgrading.html\">Hard CIDER: Easy Downgrading</a></li>\n<li><a href=\"http://metaredux.com/posts/2019/10/05/hard-cider-project-specific-configuration.html\">Hard CIDER: Project-specific Configuration</a></li>\n<li><a href=\"http://metaredux.com/posts/2019/10/07/hard-cider-navigating-cider-buffers-ninja-style.html\">Hard CIDER: Navigating CIDER Buffers Ninja-style</a></li>\n<li><a href=\"http://metaredux.com/posts/2019/11/02/hard-cider-understanding-the-jack-in-process.html\">Hard CIDER: Understanding the Jack-in Process</a></li>\n<li><a href=\"http://metaredux.com/posts/2019/11/07/hard-cider-hard-restart.html\">Hard CIDER: Hard Restart</a></li>\n<li><a href=\"http://metaredux.com/posts/2019/12/11/hard-cider-find-usages.html\">Hard CIDER: Find Usages</a></li>\n<li><a href=\"http://metaredux.com/posts/2019/12/12/hard-cider-customizing-the-evaluation-results.html\">Hard CIDER: Customizing the Evaluation Results</a></li>\n<li><a href=\"http://metaredux.com/posts/2019/12/23/hard-cider-dealing-with-multiple-project-markers.html\">Hard CIDER: Dealing with Multiple Project Markers</a></li>\n</ul>\n<div>\n<ol>\n<li>\n<p>CIDER uses the “build tool” terminology for historical reasons, as <code>tools.deps</code> didn’t exist back then. <a href=\"http://metaredux.com/posts/2019/12/23/hard-cider-dealing-with-multiple-project-markers.html#fnref:1\">↩</a></p>\n</li>\n</ol>\n</div>",
   :direction "ltr"},
  :updated 1577088120000,
  :alternate
  [{:href
    "http://metaredux.com/posts/2019/12/23/hard-cider-dealing-with-multiple-project-markers.html",
    :type "text/html"}],
  :title "Hard CIDER: Dealing with Multiple Project Markers",
  :author "Bozhidar Batsov",
  :published-str "Mon Dec 23 00:02:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16f31f8ca35:1953388:ad5391a1",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "http://metaredux.com/posts/2019/12/23/hard-cider-dealing-with-multiple-project-markers",
  :published 1577088120000,
  :fingerprint "d3cd76db",
  :canonicalUrl
  "http://metaredux.com/posts/2019/12/23/hard-cider-dealing-with-multiple-project-markers.html"}
 {:engagement 6,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/todo",
    :label "todo"}
   {:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1577027106005,
  :content
  {:content
   "<p><em>This article is part of the <a href=\"http://metaredux.com/posts/2019/12/01/meta-advent-2019.html\">“Meta Advent 2019”</a> series. I’ve committed to writing\na new blog post here every day until Christmas.</em></p>\n<p>macOS’s Spotlight is an extremely powerful and fast search tool.\nIts speed is derived from the fact that internally Spotlight relies\non a pre-built file database (similar to what the Unix utility <code>locate</code> does).\nWhile for most people using Spotlight’s GUI interface is probably fine, people like me\nprefer to be able to leverage it from their terminals. Fortunately, that’s pretty\neasy to do, as macOS ships with a command-line interface for Spotlight called <code>mdfind</code>.<sup><a href=\"http://metaredux.com/posts/2019/12/22/mdfind.html#fn:1\">1</a></sup></p>\n<p>Let’s play a bit with <code>mdfind</code> to see how it can help us. I’ll share with you some of the ways\nin which I normally use <code>mdfind</code>. I encourage all of you to try the examples locally to get a\nbetter feel for how the different commands works.</p>\n<p>Here’s how you’d search for all files containing some text (you can think of this as some hybrid of <code>grep</code> and <code>find</code>):</p>\n<pre><code>$ mdfind cider\n</code></pre>\n<p>Here’s how you’d search for all files matching some name:</p>\n<pre><code>$ mdfind -name bozhidar.jpg\n</code></pre>\n<p>Note that this does a simple text match for the name, so you can easily expand the search by making it more generic:</p>\n<pre><code>$ mdfind -name bozhidar\n</code></pre>\n<p>You can also search for multiple words in the filename:</p>\n<pre><code>$ mdfind -name clojure mobi\n</code></pre>\n<p>You can easily limit the search to a particular directory like this:</p>\n<pre><code>$ mdfind -onlyin ~/Downloads -name bozhidar\n</code></pre>\n<p>Another way to limit a search is by specifying the type (kind) of the files to look for/in:</p>\n<pre><code>$ mdfind kind:image -name bozhidar\n</code></pre>\n<p>You can also do some fancier searches by matching for some specific macOS file metadata. The example bellow is\nsearching for all files and folders named exactly “Clojure”:</p>\n<pre><code>$ mdfind &quot;kMDItemFSName = Clojure&quot;\n</code></pre>\n<p>Admittedly it’s not very easy to remember attribute names like this one, but the possibility this opens up are almost\nendless. To get an idea about the metadata attributes that exist you can check them for some file with the\n<code>mdls</code> command:</p>\n<pre><code>$ mdls index.md\nkMDItemContentCreationDate         = 2018-10-27 06:08:22 +0000\nkMDItemContentCreationDate_Ranking = 2018-10-27 00:00:00 +0000\nkMDItemContentModificationDate     = 2018-10-27 06:08:22 +0000\nkMDItemContentType                 = &quot;net.daringfireball.markdown&quot;\nkMDItemContentTypeTree             = (\n    &quot;net.daringfireball.markdown&quot;,\n    &quot;public.item&quot;,\n    &quot;public.text&quot;,\n    &quot;public.data&quot;,\n    &quot;public.content&quot;,\n    &quot;net.daringfireball.markdown&quot;,\n    &quot;public.plain-text&quot;\n)\nkMDItemDateAdded                   = 2018-10-27 06:08:22 +0000\nkMDItemDateAdded_Ranking           = 2018-10-27 00:00:00 +0000\nkMDItemDisplayName                 = &quot;index.md&quot;\nkMDItemFSContentChangeDate         = 2018-10-27 06:08:22 +0000\nkMDItemFSCreationDate              = 2018-10-27 06:08:22 +0000\nkMDItemFSCreatorCode               = &quot;&quot;\nkMDItemFSFinderFlags               = 0\nkMDItemFSHasCustomIcon             = (null)\nkMDItemFSInvisible                 = 0\nkMDItemFSIsExtensionHidden         = 0\nkMDItemFSIsStationery              = (null)\nkMDItemFSLabel                     = 0\nkMDItemFSName                      = &quot;index.md&quot;\nkMDItemFSNodeCount                 = (null)\nkMDItemFSOwnerGroupID              = 20\nkMDItemFSOwnerUserID               = 501\nkMDItemFSSize                      = 175\nkMDItemFSTypeCode                  = &quot;&quot;\nkMDItemInterestingDate_Ranking     = 2018-10-27 00:00:00 +0000\nkMDItemKind                        = &quot;Plain Text Document&quot;\nkMDItemLogicalSize                 = 175\nkMDItemPhysicalSize                = 4096\n</code></pre>\n<p>You can find more information on metadata attributes, as well as some advanced <code>mdfind</code> queries <a href=\"https://superuser.com/questions/51122/how-to-search-with-spotlight-more-effectively/412090\">here</a>.</p>\n<p>Another cool thing about <code>mdfind</code> is that you never have to rebuild its database\nmanually, as this is automatically handled by macOS. When I was using GNU/Linux\nback in the day I’d have to setup some cron job to keep my <code>locate</code> database up\nto date, and occasionally I’d had to trigger its update manually.</p>\n<p>That’s all I have for you today. I’d love it if you share in the comments some of your favourite uses of <code>mdfind</code>. See you tomorrow!</p>\n<div>\n<ol>\n<li>\n<p>I believe MD stands for “meta data”. <a href=\"http://metaredux.com/posts/2019/12/22/mdfind.html#fnref:1\">↩</a></p>\n</li>\n</ol>\n</div>",
   :direction "ltr"},
  :updated 1577007000000,
  :entities
  [{:mentions [{:text "macOS"}],
    :id "nlp/f/entity/wd:14116",
    :salienceLevel "mention",
    :label "macOS"}],
  :alternate
  [{:href "http://metaredux.com/posts/2019/12/22/mdfind.html",
    :type "text/html"}],
  :title "mdfind: A Command-line Interface to macOS’s Spotlight",
  :author "Bozhidar Batsov",
  :published-str "Sun Dec 22 01:30:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16f2e23f4d5:155f3ef:69b9f616",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "http://metaredux.com/posts/2019/12/22/mdfind",
  :commonTopics
  [{:score 50.60322613054338,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1577007000000,
  :fingerprint "d11baec5"}
 {:engagement 21,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1576970695952,
  :recrawled 1577144700194,
  :content
  {:content
   "<p>First off, I want to thank everyone so much for all your support, encouragement, teachings, stories, and enthusiasm for <em><a href=\"https://www.amazon.com/Unicorn-Project-Developers-Disruption-Thriving-ebook/dp/B07QT9QR41\">The Unicorn Project</a></em>. I am so delighted that we hit #2 on the <em>Wall Street Journal</em> bestseller list for hardcover business books on the week ending November 30, 2019!</p>\n<div class=\"wp-block-image\"><figure><img alt=\"\" src=\"https://itrevolution.com/wp-content/uploads/2019/12/DraggedImage.png\" class=\"wp-image-7135\"></figure></div>\n<p>I hope that having <em>The Unicorn Project</em> show up alongside other business books shows that the technology challenges we face today are genuine business challenges that cannot be delegated away to “those technology people.”</p>\n<p>In this blog post, I provide resources and further reading for concepts in <em>The Unicorn Project</em>. I first list the books that most influenced my thinking during the development of this book, as well as a chapter-by-chapter list of references to the many many lectures, talks, videos, articles, tweets, and personal correspondences with people I admire that inspired scenes in those chapters.</p>\n<p>This post expands upon the citations listed at the end of the book. I added further background, commentary, and additional readings for people interested in learning more about those topics.</p>\n<p>(PS: The contents of this blog post will change, as it gets edited for clarity and correctness, and I will likely add to it as I finish up Part 2!)</p>\n<h2>Books Describing Core Concepts </h2>\n<div class=\"wp-block-image\"><figure><img alt=\"\" src=\"https://itrevolution.com/wp-content/uploads/2019/12/DraggedImage-1-1.png\" class=\"wp-image-7134\"></figure></div>\n<p>Before I go into the chapter-by-chapter list of references, I want to describe the books that most heavily influenced <em>The Unicorn Project</em>. In my opinion, these books are the best codifications of the most relevant bodies of knowledge which the DevOps community draws upon:</p>\n<ol><li><a href=\"https://www.amazon.com/Accelerate-Building-Performing-Technology-Organizations/dp/B07BMBYHXL\">Accelerate: The Science of Lean Software and DevOps: Building and Scaling High Performing Technology Organizations</a> by Dr. Nicole Forsgren, Jez Humble, and Gene Kim (IT Revolution, 2018).<br><br>This is the best body of work that summarizes the six years of the <em>State of DevOps Report</em>, a cross-population study now spanning over 35,000 respondents. This is the same type of study that linked cigarette smoking with early morbidity and mortality. This study helped us define what high-performing software delivery looks like, and what factors predict high performance.<br><br>I’m so pleased that this book won the Shingo Publication Award in 2019, which is one of the most cherished marks of recognition in the Lean community—a community and body of knowledge that greatly influenced the DevOps community. <br><br>You can <a href=\"https://www.youtube.com/watch?v=-OiOUwaRsXk\">watch Dr. Forsgren and Jez Humble’s 2018 presentation at the DevOps Enterprise Summit here</a>. (Twitter: <a href=\"https://twitter.com/nicolefv\">@nicolefv</a>, <a href=\"https://twitter.com/jezhumble\">@jezhumble</a>.)<br></li><li><a href=\"https://www.amazon.com/High-Velocity-Edge-Operational-Excellence-Competition-ebook/dp/B003GIPEC2\">The High-Velocity Edge: How Market Leaders Leverage Operational Excellence to Beat the Competition</a> by Dr. Steven J. Spear (McGraw Hill, 2010).<br><br>This is one of the most eye opening and illuminating books about dynamic learning organizations, which is the category that I believe academics and historians will call the next generation of management methods, of which DevOps will be considered a subset of. (To substantiate this claim, please see my references to Dr. Mik Kersten and Dr. Carlota Perez later in this post.)<br><br>Over the years, I’ve benefited so much from Dr. Steven Spear’s mentoring and coaching—his works have profoundly influenced my thinking ever since I took his three-day <a href=\"https://executive.mit.edu/openenrollment/program/organizational-development-high-velocity-organizations\">“High Velocity Learning” course at MIT</a> in 2014. You can <a href=\"https://itrevolution.com/devops-book-review-the-high-velocity-edge-by-dr-steven-spear/\">read my review of his book here</a>.<br><br>Since then, the DevOps Enterprise community has been able to learn so much from him—you can watch his <a href=\"https://www.youtube.com/watch?v=h4XMoHhireY\">DevOps Enterprise London 2019 video here</a>. You can also watch this <a href=\"https://www.youtube.com/watch?v=CFMJ3V4VakA&t=427s\">amazing 30-minute panel about the intersection of Lean, Safety Culture, and Resilience Engineering (along with Dr. Sidney Dekker and Dr. Richard Cook)</a>.<br><br>(And for those of you who want to see more, <a href=\"https://www.youtube.com/watch?v=gtxtb9z_4FY&t=618s\">here’s the 2.5-hour panel session we had done before that</a>, along with my friend John Willis.) (Twitter: <a href=\"https://twitter.com/stevenjspear\">@stevenjspear</a>, <a href=\"https://twitter.com/botchagalupe\">@botchagalupe</a>.)<br></li><li><a href=\"https://www.amazon.com/Project-Product-Survive-Disruption-Framework-ebook/dp/B07F3DJMZ1/\">Project to Product: How to Survive and Thrive in the Age of Digital Disruption with the Flow Framework</a> by Dr. Mik Kersten (IT Revolution, 2018).<br><br>Every decade, I read a couple of books that genuinely change my worldview. On my bookshelf, you can tell which books they are, because more than one-third of the pages are bookmarked, each dog-eared page indicating something I felt was truly an important, aha moment or a reminder to myself to study further later. <em>Project to Product</em> is definitely one of these books. <br><br>I genuinely admire this book—as in, I wish I were smart enough and had the experience to have written it.<br><br>From Dr. Kersten I learned about the four types of work that an engineering team does: features, defects, risks, and debt. These categories are mutually exclusive and comprehensively exhaustive, meaning that doing more of one type of work must be at the expense of the other three. <br><br>For me, it provided the first compelling model of the causation of how technical debt is created, and how feature freezes can help pay it down and restore agility. It made sense in light of all the case studies I had been collecting for years, such as Microsoft, Google, Facebook, LinkedIn, as well as one company that didn’t make it — Nokia.<br><br>You can read the foreword I wrote for this book <a href=\"https://docs.google.com/document/d/1a1rqv29VbQsfN1i5CBAX0b7JDQvtyBptddSiXkb_HyE/edit\">here</a>. And you can see Mik <a href=\"https://www.youtube.com/watch?v=E5VP3ioSRU8&t=3s\">presenting on his lifetime of work at DevOps Enterprise Summit 2018 here</a>. (Twitter: <a href=\"https://twitter.com/mik_kersten\">@mik_kersten</a>.)<br></li><li><a href=\"https://www.amazon.com/Goal-Process-Ongoing-Improvement/dp/0884270610\">The Goal: A Process of Ongoing Improvement by Eliyahu M. Goldratt and Jeff Cox</a> (North River Press, 1984). And <a href=\"https://www.amazon.com/Beyond-Goal-Eliyahu-Goldratt-Constraints/dp/1596590238\">Beyond The Goal: Eliyahu Goldratt Speaks on the Theory of Constraints</a> (Glidan Media, 2011).<br><br>Dr. Eliyahu Goldratt wrote this seminal book in 1984, a Socratic novel about Alex Rogo, a plant manager who must fix his cost and due date issues in ninety days or his plant will be shut down. This book has been incorporated into many MBA curriculums, has influenced multiple generations of business leaders, and has sold over six million copies to date.<br><br>We structured <em>The Phoenix Project</em> to closely mirror <em>The Goal</em>—my co-authors and I studied this book for nearly a decade, getting ready to write. <em>The Phoenix Project</em> was written as an homage to <em>The Goal</em>. We attempted to mirror most of the book structure and plot elements, while making it contemporary, relevant, and hopefully more dramatic. <br><br>I wrote an <a href=\"https://itrevolution.com/learn-more-about-concepts-in-phoenix-project/\">entire blog article in 2013 about Dr. Goldratt’s body of work, as well as how it influenced my work, here</a>.<br><br><em>Beyond The Goal</em> is an amazing tour de force by Dr. Goldratt. In six hours he describes his entire lifetime of learnings, told against the historic backdrop of the manufacturing revolution in the 1980s, his learnings and reflections of having written <em>The Goal</em>, the creation of MRP systems and the digitization of entire organizations via ERP, and his own aspirations for a more scientific way of working and creating value.<br><br>(And if you love <em>Beyond the Goal</em>, you’ll likely also like <a href=\"https://www.amazon.com/Beyond-Phoenix-Project-Origins-Evolution/dp/B07B76MQNY/\"><em>Beyond The Phoenix Project</em>,</a> which John Willis and I created in 2018. In this audio book, we explore the four bodies of knowledge that have impacted DevOps the most: Theory of Constraints, Lean, Safety Culture, and Dynamic Learning Organizations. This was the perfect project in preparation for writing <em>The Unicorn Project</em>! I wrote an <a href=\"https://itrevolution.com/beyond-phoenix-project-making-book-goldratt-deming/\">entire series of blog posts on this project here</a>. ) (Twitter: <a href=\"https://twitter.com/goldrattbooks\">@GoldrattBooks</a>.)<br></li><li><a href=\"https://www.amazon.com/Principles-Product-Development-Flow-Generation-ebook/dp/B00K7OWG7O\">The Principles of Product Development Flow: Second Generation Lean Product Development</a> by Donald G. Reinertsen (Celeritas, 2009).<br><br>This is another stunning book because it is grounded in Lean principles, but it reveals how new thinking is required to address the unique challenges (and opportunities) of software development. Unlike the realm of manufacturing and highly repetitive work, software design and development is inherently full of variability and uncertainty. Furthermore, design and development work is often never repeated exactly, so it rarely benefits from the repetition that we see in manufacturing (e.g., high repetition, low variability, and low cycle time), which allows us to manage down certain types of risks in those domains.<br><br>This book not only brilliantly describes the problems inherent to software development, and provides a dazzling array of tools and techniques to get better outcomes, primarily through taking an economic view of work: calculating and using cost of delay to prioritize work, reducing batch size, controlling flow, and decentralizing control.<br><br>Writing this it occurs to me how it so brilliantly extends the concepts introduced by Dr. Goldratt to knowledge work. In manufacturing and services, the primary business risk we talk about is how downtime impacts production throughput. However, in product development, the business impact is much, much more devastating. In certain industries, such as pharmaceuticals, for each day you can get to market faster, you can often capture upwards of millions of dollars of additional revenue. (This quote is in <em>The Unicorn Project</em> and is from Dr. Steven Spear.)<br><br>This is very similar to the dynamic that defines the problems with poor flow in software development, framed so brilliantly by Mr. Reinersten. I re-read this book every several years, and I always learn something on each re-reading. (Twitter: <a href=\"https://twitter.com/dreinertsen\">@dreinertsen</a>.)<br></li><li><a href=\"https://www.amazon.com/dp/B00KWG9OF4/\">Team of Teams: New Rules of Engagement for a Complex World</a> by General Stanley McChrystal, with Tantum Collins, David Silverman, and Chris Fussell (Portfolio, 2015).<br><br>This is one of the best books I’ve read in the past decade for so many different reasons. It is the story of how in 2004, the Joint Special Forces Task Force was failing to achieve its mission to defeat Al Qaeda in Iraq (AQI), a much smaller but nimbler adversary. It’s fascinating to see so many of the same forces we feel in business and technology being felt by a military and intelligence agency command, with the charter to protect citizen and warfighters.<br><br>What makes this story so amazing are the unique problems suffered by the joint operations of elite units across all the US military agencies: Army Rangers and Green Berets, Navy SEALs, etc. These were some of the most highly trained and experienced teams around, but what they all had in common was that the team was the “boundary of which everyone else sucked.” In other words, members of each team believed they were the best, and that everyone outside of the team sucked. And of course, they all believed that their counterparts in the intelligence agencies were one rung lower than all of them.<br><br>This is a story of how General McChrystal and his team were able to create the conditions so that all of these teams could work together toward a common goal (creating a “team of teams”), as well as dramatically decentralizing decision making, pushing decisions down to the lowest possible level so that people on the front lines could quickly make decisions. <br><br>One of the most remarkable stories is how after years of work these teams were able to go from “sighting to capture” of high-level AQI leaders in less than forty-five minutes, reversing the situation that had plagued the JSFT for years, where they found itself constantly reacting to and seemingly being outwitted by their adversary, often requiring days or weeks to plan and execute an operation.<br></li><li><a href=\"https://www.amazon.com/dp/B00KWG9OF4/\">A Seat at The Table: IT Leadership in the Age of Agility</a> by Mark Schwartz (IT Revolution, 2017).<br><br>I love everything that Mark Schwartz writes, and like many books written by philosophers, it’s very difficult to describe succinctly what Mark’s books are about. His first book, <em>The Art of Business Value</em>, was like <em>Zen and the Art of Motorcycle Maintenance</em> for technology.<br><br>This book brings the same incredible perspective and process of inquiry to technology and business leadership, and questions so much of common wisdom we take for granted. It decisively and logically shows what in that thinking is wrong, and provides alternative ways to think about the problem. (Twitter: <a href=\"https://twitter.com/schwartz_cio\">@schwartz_cio</a>.)<br></li><li><a href=\"https://www.amazon.com/Technological-Revolutions-Financial-Capital-Dynamics/dp/1843763311\">Technological Revolutions and Financial Capital: The Dynamics of Bubbles and Golden Ages</a> by Dr. Carlota Perez (Edward Elgar Pub, 2003).<br><br>This book by Dr. Carlota Perez was introduced to me by Chris Little (<a href=\"https://twitter.com/cshl1\">@cshl1</a>) in 2013, and I continue to be dazzled by Dr. Perez’s work. This book describes the astonishing regularity of technology revolutions that seem to happen every fifty to seventy years. Dr. Perez studied the last 250 years and identified the following revolutions: Industrial Revolution, Age of Steam and Railways, Age of Steel and Heavy Engineering, Age of Oil and Mass Production, and Age of Software and Digital (renamed by Dr. Mik Kersten).<br><br>She posits that during each age the following cycle happens: there is an intense period of innovation fueled by financial capital, a financial boom followed by a financial crash, then a period of re-regulation of this new technology, and then, ideally, a multi-decade golden age fueled by production capital where this new mode of production is exploited within all industries.<br><br>What is exciting to me is each age also results in a new mode of management that emerges to exploit this new means of production. In order, these ages resulted in factory systems, subcontracting, Taylorism, and Fordism. My long discussions with Dr. Mik Kersten and Dr. Steven Spear have convinced me that the new management mode, described so brilliant in <em>Team of Teams</em> and <em>The High-Velocity Edge</em> will be dynamic learning organizations, of which DevOps is certainly a subset of.<br><br><img width=\"1574\" src=\"https://itrevolution.com/wp-content/uploads/2019/12/DraggedImage-2-1.png\" class=\"wp-image-7136\" height=\"882\"><br><br>A marvelous description of how Dr. Perez’s work has influenced our thinking is this <a href=\"https://www.tasktop.com/blog/the-unicorn-project-review-finding-flow-with-the-five-ideals/\">blog post by Dr. Kersten</a>, which is also an amazing exposition of the Five Ideals. I will most certainly be writing more about Dr. Perez’s work and its implications to technology management. (Twitter: <a href=\"https://twitter.com/CarlotaPrzPerez\">@CarlotaPrzPerez</a>.)<br></li><li><a href=\"https://www.amazon.com/Transforming-NOKIA-Paranoid-Optimism-Colossal/dp/1260128725\">Transforming Nokia</a> by Risto Siilasmaa (McGraw-Hill Education, 2018).<br><br>This is another one of the best books I’ve read in the past decade. I will describe in more detail why this book was so impactful to me later in this post. Mr. Siilasmaa joined the board of Nokia in 2008, when it was the world’s ninth most valuable brand, with a market cap of $90 billion. My first reaction was “what could we possibly learn from a person who oversaw the 93% decimation of the company?”<br><br>There are four reasons to read this book. First, he describes the likely all too familiar dysfunctional power dynamics present on the Nokia board, where a “dream team” of directors were unable to see internal problems, where novelty and dissent were suppressed by a very powerful chairperson. Mr. Siilasmaa presents an unflinching assessment of his own performance and reflects on his inability to elevate issues sooner.<br><br>The second reason is the importance for business leaders to understand developer productivity and technical debt. He explains how he discovered in 2010 that the Symbian OS build times were forty-eight hours. He recognized that this technical debt and architecture was the death-knell for all near-term profitability and long-term viability. This led to re-platforming to Windows Mobile, which wasn’t successful either, but it was a far better bet than staying on Symbian OS.<br><br>The third reason to read this book is the astounding story of how Nokia is acquired by Microsoft for $7 billion (with Mr. Siilasmaa as CEO), because of incredible scenario planning and brilliant execution. This is despite Nokia’s grave cash position. He writes, “Our business was going so badly that we had one foot in the grave and the other on a banana peel…We had bet our entire business on Windows Mobile…and now it would bring Nokia to the brink of the grave or straight into it.” Despite bankruptcy being a distinct possibility, they were still acquired for over $7 billion, with all parties satisfied that it was a fair price.<br><br>The fourth reason to read the book is to see how Mr. Siilasmaa has led Nokia to its new chapter (now serving as board chair), having quintupled the value of the company by creating and reinforcing a culture of a dynamic, learning organization. I will write more about his view of data as a critical and core organizational competency in Part 2. (You can <a href=\"https://www.youtube.com/watch?v=KNMy7NCQDgk\">watch an hour video he does on machine learning here</a>.) But sufficed to say, this is an incredible book—what <em>Team of Teams</em> did for the military world, <em>Transforming Nokia</em> portends for the commercial world.<br><br>In my opinion, this book should be added to the mandatory reading list for the National Association for Corporate Directors. The world will be a far better place if all corporate directors and executives heeded his advice. (Twitter: <a href=\"https://twitter.com/rsiilasmaa?lang=en\">@rsiilasmaa</a>.)<br></li></ol>\n<h2>Description of the Remaining Resources</h2>\n<p>The rest of this blog post and follow-up posts will present additional resources and concepts presented by each chapter. <em>The Unicorn Project</em> has nineteen chapters. I start with Chapter 2, as there are no references in the first chapter.</p>\n<h2>Chapter 2</h2>\n<ul><li>Over the past many years in the DevOps Enterprise community, we’ve been seeking to better understand how to span the divide between business and technology leadership. In this journey, a source of incredible insight has been Chris O’Malley, CEO of Compuware, the famously resurgent mainframe software vendor. <br><br>To hear from a CEO of a software company, who lives and dies by the speed of delivery and quality of the software they create, watch this <a href=\"https://www.youtube.com/watch?v=r3H1E2lY_ig\">fireside chat with Chris O’Malley (CEO, Compuware)</a> from the DevOps Enterprise Summit Las Vegas 2018. Mr. O’Malley talks about technology and business leaders as John Lennon and Paul McCartney, the two parts of a duality needed to create greatness. In the business context, they must work together to understand what customers are dissatisfied by, find ways to delight those customers, built with greatness in both product and engineering. <br><br>However, in many organizations this requires a completely new mindset in leaders and new ways of working that look very different than how we’ve done things in decades past. (I introduce this fireside chat with a reference to <a href=\"https://a16z.com/2010/12/16/ones-and-twos/\">the famous “Ones and Twos” post by Ben Horowitz</a>, where he describes the “ones” as the product visionaries, and the “twos” as the executives who create process excellence.)<br><br>In 2019, I had the privilege of doing a <a href=\"https://www.youtube.com/watch?v=qBEXg_1Pn08\">follow-up fireside chat with Mr. O’Malley and his CFO, Joe Aho</a>, to better understand how we can get conservative financial leaders on board. And what better example of a conservative financial leader than the CFO! <br><br>What emerged was a fascinating discussion about the timeless power of the three metrics of employee engagement, customer satisfaction, and cash flow. They both assert and convincingly defend how focusing on these metrics will inevitably lead to success. In <em>The Unicorn Project</em>, these three metrics are prominently featured in Steve’s Town Halls.<br><br>The logic that Mr. O’Malley presents is simple: <br><br>– Customer satisfaction: organizations exist to serve their customers, and this is a measure of to what extent they are being served.<br><br>– Employee engagement: to what extent are people in the organizations energized and engaged in the company mission to serve their customers, and to what extent are the full extent of their creative powers being translated into things that customers care about.<br><br>– Cash flow: businesses are not charities, and must manage operations so they don’t run out of cash—and of course, this applies to not-for-profits too (e.g., charities, government agencies, military services). (Twitter: <a href=\"https://twitter.com/chris_t_omalley\">@chris_t_omalley</a>.)<br></li></ul>\n<h2>Chapter 3</h2>\n<ul><li><a href=\"https://leanpub.com/elementsofclojure\">Elements of Clojure</a> by Zachary Tellman (2019) is an amazing and astonishing book that talks about the principles of great software design. In many ways, it’s more of a philosophy book than a software engineering book.<br><br>Like the aforementioned Mark Schwartz, Mr. Tellman has a background in philosophy and takes the reader on a wild ride of exploring names, idioms, indirection, and composition. It is full of surprising insights. From this book comes the observation that building mathematical libraries can be like bridge building, because the fundamentals of mathematics don’t change—however, building a software product for a customer or market is far more difficult, because requirements may drastically change, so it is an endeavor fraught with far more uncertainties. (Twitter: <a href=\"https://twitter.com/ztellman\">@ztellman</a>.)<br><br>Evidence of Mr. Tellman’s point about the longevity of mathematics libraries: Python’s dominance of scientific computing is often attributed by its ability to use the famous high-performance <a href=\"https://en.wikipedia.org/wiki/LAPACK\">LAPACK linear algebra library</a>, written in FORTRAN in 1992, twenty-seven years ago at the time of this writing. It was modeled after LINPACK, which was also written in FORTRAN in the 1970s, nearly fifty years ago at the time of this writing.<br><br>(In this video, <a href=\"https://www.youtube.com/watch?v=cZpckkTH-Is\">“Tricking Sand into Thinking: Deep Learning in Clojure,“ Dave Liepmann speculates </a>that the reason Java didn’t take off for scientific computing was the absence of the ability to use these mathematical libraries. In contrast, <a href=\"https://numpy.org/devdocs/user/building.html\">the Python NumPy library leveraged the ability to use these great libraries</a>, through FORTRAN bindings and more. Fortunately, there are a number of exciting things happening that are finally bringing these capabilities to the JVM. (Twitter: <a href=\"https://twitter.com/daveliepmann\">daveliepmann</a>.)<br></li></ul>\n<h2>Chapter 6</h2>\n<ul><li>The incredible Jon Smart is responsible for the most incredibly pithy, lovely, and absolutely accurate definition of DevOps: “Better Value, Sooner, Safer, Happier.” <a href=\"https://www.youtube.com/watch?v=ZKrhdyjGoM8\">Watch his DevOps Enterprise Summit London 2019 presentation</a> to see how he’s developed this idea more fully. <br><br>You can watch more of his brilliance in his other equally important presentations: <a href=\"https://www.youtube.com/watch?v=R-fol1vkPlM\">“The PMO is Dead, Long Live the PMO – Barclays” </a>from DevOps Enterprise Summit London 2018, where he presented with Morag McCall, Director of Project Management at Barclays. It’s an incredible presentation that describes the bottlenecks that the project management, budgetary planning, and fiscal release processes create. (This was the basis of the contrast between the old way of working vs. the far more dynamic process used to support the Horizon 3 initiatives, described after Chapter 19 in <em>The Unicorn Project</em>.)<br><br>You can also watch Mr. Smart’s presentation <a href=\"https://www.youtube.com/watch?v=XRMf9QjUwlI\">“Risk &amp; Control is Dead, Long Live Risk &amp; Control”</a> from DevOps Enterprise Summit 2019, which addresses the incredible problem of real-world risk and controls organizations face in regulated companies. I am certain that the implications of these problems will be explored in the years to come in the DevOps Enterprise community. <br><br>(Incidentally, I’m so excited to see Jon Smart pouring his unique genius into a new upcoming IT Revolution book!) (Twitter: <a href=\"https://twitter.com/jonsmart\">@jonsmart</a>.)<br></li></ul>\n<h2>Chapter 7</h2>\n<ul><li>Rich Hickey, <a href=\"https://www.infoq.com/presentations/Simple-Made-Easy-QCon-London-2012/\">“Simple Made Easy,”</a> InfoQ, recorded at QCon London 2012, posted June 20, 2012.<br><br>So many of the ideas of the First Ideal of Locality and Simplicity were inspired by Rich Hickey, the inventor of the Clojure programming language. I wrote about how <a href=\"https://itrevolution.com/love-letter-to-clojure-part-1/\">his ideas and Clojure re-introduced the joys of coding into my life in my blog post “Love Letter To Clojure (Part 1)”</a>. Learning Clojure also led to a series of revelations about all the invisible structures that are required to enable developers to be productive. These concepts show up all over <em>The Unicorn Project</em>, most prominently in the First Ideal of Locality and Simplicity, but also how those conditions can lead to the Second Ideal of Focus, Flow, and Joy.<br><br>Without doubt, Clojure was one of the most difficult things I’ve learned professionally, but it has also been one of the most rewarding. It brought the joy of programming back into my life. For the first time in my career, as I’m nearing fifty years old, I’m finally able to write programs that do what I want them to do, and am able to build upon them for years without them collapsing like a house of cards, as has been my normal experience.<br><br>The famous French philosopher Claude Lévi-Strauss would say of certain tools, “Is it good to think with?” For reasons that I will try to explain in this post, Clojure embraces a set of design principles and sensibilities that were new to me: functional programming, immutability, an astonishingly strong sense of conservative minimalism (e.g., hardly any breaking changes in ten years!), and much more…<br><br>Clojure introduced to me a far better set of tools to think with and to also build with. It’s also led to a set of aha moments that explain why for decades my code would eventually fall apart, becoming more and more difficult to change, as if collapsing under its own weight. Learning Clojure taught me how to prevent myself from constantly self-sabotaging my code in this way.<br><br>To read more about Rich Hickey (Twitter: <a href=\"https://twitter.com/richhickey\">@richhickey</a>), you can read my blog post <a href=\"https://itrevolution.com/love-letter-to-clojure-part-1/\">“Love Letter To Clojure (Part 1)”</a>. And you can also watch the talk I gave at the 2019 Clojure/conj conference: <a href=\"https://www.youtube.com/watch?v=5mbp3SEha38\">“Love Letter To Clojure: And A Datomic Experience Report”</a>. And you can find a worthy list of other videos to watch <a href=\"https://itrevolution.com/love-letter-to-clojure-part-1/#the-amazing-clojure-community\">here</a> (selected links from my Clojure love letter) and <a href=\"https://github.com/tallesl/Rich-Hickey-fanclub\">here</a> (the “Rich Hickey Fan Club” links by Talles L).<br></li><li>Ward Cunningham, <a href=\"http://c2.com/cgi/wiki?WardExplainsDebtMetaphor\">“Ward Explains Debt Metaphor,”</a> wiki.c2.com, last edited January 22, 2011.<br><br>Here you will find the transcript of Ward Cunningham explaining the history of the metaphor of technical debt, and a lengthy and nuanced explanation of the various aspects of technical debt. I think it is absolutely terrific, and I find Dr. Mik Kersten’s treatment of “debts” as one of the four types of work in the Flow Framework a brilliantly simple way to integrate into the software planning process.<br></li></ul>\n<h2>Chapter 8</h2>\n<ul><li><a href=\"https://itrevolution.com/devops-blog/feed/%20https://www.youtube.com/watch?v=HluANRwPyNo&feature=youtu.be\">“What people think programming is vs. how it actually is,”</a> YouTube video, Posted by Jombo, February 22, 2018.<br><br>This is the great video that Maxine references which so brilliantly summarizes the way that movies depict how developers work as opposed to the way they really work. It’s only thirty seconds long, but it shows the striking contrast of how programming is portrayed in the movies versus what it actually looks like in real life.<br><br>I got particular delight out of the scene where Jared performs the code deployment, resulting in everyone cheering and clapping him on the back. Har har!<br></li><li>Ryan Naraine, <a href=\"https://www.zdnet.com/article/10-years-since-the-bill-gates-security-memo-a-personal-journey/\">“10 Years Since the Bill Gates Security Memo: A Personal Journey (Guest Editorial by Michael Howard)”</a> ZDNet, January 13, 2012.<br><br>Bill Gates, <a href=\"https://www.wired.com/2002/01/bill-gates-trustworthy-computing/\">“Bill Gates: Trustworthy Computing,”</a> Wired, January 17, 2012.<br><br>These articles on the famous Microsoft security stand-down are amazing, describing how Bill Gates, then CEO of Microsoft, responded after the “Summer of Worms” in 2001, when Code Red, Nimda, and SQL Slammer used vulnerabilities in Microsoft software to wreak havoc on the internet. The practice of the stand-down (i.e., “feature freeze”) was informed by the .NET team’s success using techniques such as Security Bug Bashes and their Security Standdown, periods which were solely dedicated to address security issues, which also included broad security training for developers or even finding new security problems!<br><br>The first article was written by Michael Howard (author of the book <em>Writing Secure Code</em>), and he describes a pivotal meeting he had with Bill Gates, which led to what became known as the “Windows Security Push,” leading to Bill Gates’ Trustworthy Computing memo (citation above).<br><br>This initiative proved to be so effective that it was later adopted by most of the other major Microsoft product groups, such as SQL Server, Exchange, and Office. The outcome was that it changed how engineers and managers across the entire organization thought about integrating information security objectives into everyone’s daily work.<br></li><li>Risto Siilasmaa, <em><a href=\"https://www.amazon.com/Transforming-NOKIA-Paranoid-Optimism-Colossal/dp/1260128725\">Transforming NOKIA: The Power of Paranoid Optimism to Lead Through Colossal Change</a></em> (McGraw-Hill, 2018) Kindle, 49.<br><br>One of the most remarkable parts of this book quoted in <em>The Unicorn Project</em> is when he learned in 2010 about the forty-eight hour build times of the Symbian OS. He described that it felt like “being hit in head with a sledgehammer” and how “all the hopes and promises made by the R&amp;D organization [were] a mirage” of which all near-term profitability and long-term viability hinged upon. He wrote that “if it required two days for anyone to determine whether a change worked or would have to be redone…[revealed] a fundamental/fatal flaw, dooming our near-term profitability and long-term viability.”<br><br>In my mind, this is one of the most incredible evidence points of how important “code build/code deployment lead time” is, which every business leader (and board director) needs to understand.<br><br>I think this serves as a stark contrast to how technical debt almost killed every one of the tech giants (e.g., Facebook, Amazon, Netflix, Google, Microsoft), but they were able to survive by eradicating it. (See the comments on Microsoft security stand-down above.) These near-extinction events show us how important acknowledging and managing technical debt is:<br><br>– Ebay (1999)<br>– Microsoft (2002): Bill Gates memo<br>– Google (2005): Automated testing culture<br>– Amazon (2004): Jeff Bezos memo<br>– Twitter (2008): Fail Whale<br>– LinkedIn (2009): Project Inversion after IPO<br>– Etsy (2009)<br><br>You can read some Twitter threads I wrote that gush about how much I love this book <a href=\"https://twitter.com/RealGeneKim/status/1163972487513690112\">here</a> and <a href=\"https://twitter.com/RealGeneKim/status/1187921288758562816\">here</a>. I especially love Sam Guckenheimer’s insightful comment about Nokia in the 2000’s: “It wasn’t that Nokia didn’t do the right thing; it was that it did the right thing for too long.” What a great summary of the innovator’s dilemma! (<a href=\"https://twitter.com/RealGeneKim/status/1164377292878954496\">tweet</a>)<br></li><li>John Cutler (<a href=\"https://twitter.com/johncutlefish\">@johncutlefish</a>), “Case in point (from actual org) * In 2015 reference feature took 15-30d. * In 2018 same (class of) feature took 150-300d primarily bc of 1) tech debt, and 2) fast track silver bullets to drive success theater and/or acquisitions (for same effect) Cc: @realgenekim @mik_kersten” Twitter, September 29, 2018. (<a href=\"https://twitter.com/johncutlefish/status/1046169469268111361\">Link to tweet</a>)<br><br><img width=\"1184\" src=\"https://itrevolution.com/wp-content/uploads/2019/12/DraggedImage-3-1.png\" class=\"wp-image-7133\" height=\"1252\"><br></li><li>John Allspaw,<a href=\"https://www.youtube.com/watch?v=xA5U85LSk0M\"> “How Your Systems Keep Running Day After Day – John Allspaw,”</a> YouTube video, posted by ITRevolution, from the DevOps Enterprise Summit Las Vegas, 2017.<br><br>In this amazing video, the famous John Allspaw describes so many of the new concepts that are showing up in the incredible vibrant Chaos Engineering and Resilience communities. He talks about concepts such as “above and below the line,” the notion that incidents are unplanned investments made without your consent, and that we are responsible for maximizing our return on those unplanned investments. (Twitter: <a href=\"https://twitter.com/allspaw\">@allspaw</a>.)<br></li><li>Charles Duhigg, <a href=\"https://www.nytimes.com/2016/02/28/magazine/what-google-learned-from-its-quest-to-build-the-perfect-team.html?smid=pl-share\">“What Google Learned From Its Quest to Build the Perfect Team,”</a> <em>New York Times</em>, February 25, 2016. <br><br><a href=\"https://rework.withgoogle.com/print/guides/5721312655835136/\">“Guide: Understand Team Effectiveness,”</a> <em>ReWork</em>, accessed August 21, 2019.<br><br>These are wonderful articles that describe Project Aristotle, which was started in 2012 to understand what made great teams great. One of the stunning findings was the the top factor was psychological safety.<br></li><li><em>Team of Teams: New Rules of Engagement for a Complex World</em> by Gen. Stanley McChrystal, with Tantum Collins, David Silverman, and Chris Fussell (Portfolio, 2015). Described at top of this article.<br></li><li><em>The Principles of Product Development Flow: Second Generation Lean Product Development</em> by Donald G. Reinertsen (Celeritas, 2009). Described at top of this article.<br></li><li><em>The High-Velocity Edge: How Market Leaders Leverage Operational Excellence to Beat the Competition</em> by Steven J. Spear (McGraw Hill, 2010). Described at top of this article.<br></li><li><a href=\"https://www.youtube.com/watch?v=CFMJ3V4VakA\">“Convergence of Safety Culture and Lean: Lessons from the Leaders,”</a> YouTube video, posted by IT Revolution, from DevOps Enterprise Summit San Francisco 2017.<br><br>In <em>Beyond The Phoenix Project</em>, John Willis and I describe the shoulders of giants that the DevOps movement is standing upon, including Dr. Eliyahu Goldratt, Dr. W. Edwards Deming, as well as the Lean and Safety Culture movements.<br><br>As aspiring students of both Lean and Safety Culture, John and I observed that there seemed to be many commonalities between these two movements, such as the need for psychological safety, a scientific method for the improvement of daily work, systems thinking, and so forth. However, instead of these movements seeing the other as mutually supportive bodies of knowledge, they seemed to view the other with suspicion or even in diametric opposition.<br><br>Over the last four years, John and I have had the privilege of interacting with many of the most influential thinkers from these two movements. In 2017, John and I filmed a half-day panel with Dr. Richard Cook and Dr. Sidney Dekker from the Safety Culture movement, and Dr. Steven Spear from the Lean movement.<br><br>As John will tell you, on the one hand it was amazing to see such an intellectual tour de force of argumentation, citing philosophy, physics, management and social sciences, medicine, ethics, economics, and even theology. On the other hand, it was at times a pretty stressful and wild ride, and at one point, John and I wondered whether we should have let this stay buried in the desert, so vehement was the discussion.<br><br>However, by the end, it was clear that many principles and values span both Lean and Safety Culture. I can’t think of a better demonstration of this than the thirty-minute panel I moderated with Dr. Cook, Dr. Dekker, and Dr. Spear at DevOps Enterprise Summit 2017. I agree with my friend Charles Betz, who said, “This panel will go down in history as a watershed moment for the digital profession. Notable, in the fullest sense of the word.”<br><br>I write about <a href=\"https://itrevolution.com/beyond-phoenix-project-modules-7-8-panel-case-studies/\">the making of this panel in this blog post</a>.<br></li><li>Jeffrey Snover (@jsnover) <a href=\"https://twitter.com/jsnover/status/931632205020913664\">tweet</a>, “I literally (and yes I do mean literally) wanted to hide under my desk. I knew that they wouldn’t be able to tell who did it (downside of DomainOS) so … making the phone call was one of the hardest things I’ve every done.” Twitter, November 17, 2017.<br><br>Maxine’s story about how she accidentally deleted the source code repository is based on Jeffrey Snover’s story.<br></li><li><a href=\"https://www.youtube.com/watch?v=0gvOrYuPBEA\">“Paul O’Neill of Safety Leadership,”</a> YouTube video, posted by Steve Japs, February 7, 2014.<br><br><a href=\"https://www.youtube.com/watch?v=htLCVqaLBvo\"> “Paul O’Neill The Irreducible Components of Leadership.wmv,”</a> YouTube video, posted by ValueCapture, Mar 22, 2012.<br><br>In <em>The Unicorn Project</em>, the story of Steve as a champion for physical safety in manufacturing plants is based on the story of <a href=\"https://en.wikipedia.org/wiki/Paul_H._O%27Neill\">Paul O’Neill</a> and his tenure as CEO at Alcoa. Watch these amazing videos on how he talks about workplace safety as a precondition of work, how his board of directors initially thought his notions were outlandish, and the harrowing stories of how he dealt with workplace injuries and fatalities during his tenure at Alcoa, and how he later brought them to the US Federal Government when he served as Secretary of the US Department of the Treasury.<br><br>Be forewarned: I found myself tearing up during many portions of these videos, and I watched them many, many times.<br></li></ul>\n<h2>End of Part 1: Part 2 is Coming!</h2>\n<p>In the interest of getting something posted before 2019 ends, I am posting Part 1 now, which covers many of the major books that served as inspiration for <em>The Unicorn Project</em>, and a chapter-by-chapter listing of references for Chapters 1 through 8. </p>\n<p>Part 2 will cover the books that I didn’t cover in this post, as well as completing the list of references for Chapters 9 through 19.</p>\n<p>Again, thank you for all your interest, enthusiasm, and support. Have a wonderful 2019, and may 2020 be even more joyful and prosperous than 2019!</p>\n<p>And for your researching and viewing pleasure, you can <a href=\"https://www.youtube.com/playlist?list=PLvk9Yh_MWYuz-RF0OEW0A2w913aidIdsr\">find a YouTube playlist of the videos I’ve selected here</a>—this includes videos from Part 1, as well as the upcoming Part 2.</p>\n<p>The post <a rel=\"nofollow\" href=\"https://itrevolution.com/resource-guide-to-the-unicorn-project-part-1/\">Resource Guide To The Unicorn Project (Part 1)</a> appeared first on <a rel=\"nofollow\" href=\"https://itrevolution.com\">IT Revolution</a>.</p>",
   :direction "ltr"},
  :updated 1576968369000,
  :entities
  [{:mentions [{:text "Nokia's"} {:text "Nokia"}],
    :id "nlp/f/entity/wd:1418",
    :salienceLevel "mention",
    :label "Nokia"}
   {:mentions [{:text "Microsoft"}],
    :id "nlp/f/entity/wd:2283",
    :salienceLevel "mention",
    :label "Microsoft"}
   {:mentions
    [{:text "McGraw Hill"}
     {:text "McGraw-Hill Education"}
     {:text "McGraw-Hill"}],
    :id "nlp/f/entity/wd:17153156",
    :salienceLevel "mention",
    :label "McGraw-Hill Education"}
   {:mentions [{:text "Google"}],
    :id "nlp/f/entity/wd:95",
    :salienceLevel "mention",
    :label "Google"}
   {:mentions [{:text "Edge"}],
    :id "nlp/f/entity/wd:793975",
    :salienceLevel "mention",
    :label "Edge"}],
  :alternate
  [{:href
    "https://itrevolution.com/resource-guide-to-the-unicorn-project-part-1/",
    :type "text/html"}],
  :title "Resource Guide To The Unicorn Project (Part 1)",
  :author "Gene Kim",
  :published-str "Sat Dec 21 14:46:09 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16f2ac73510:127685f:ad5391a1",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url
   "https://itrevolution.com/wp-content/uploads/2019/12/DraggedImage-2-1.png",
   :width 1574,
   :height 882,
   :contentType "image/png"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://itrevolution.com/?p=7137",
  :updateCount 2,
  :commonTopics
  [{:score 54.71133735616297,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.988,
    :id "nlp/f/topic/651",
    :salienceLevel "about",
    :label "devops"}],
  :published 1576968369000,
  :fingerprint "4ec55e9",
  :canonicalUrl
  "https://itrevolution.com/resource-guide-to-the-unicorn-project-part-1/"}
 {:engagement 14,
  :unread true,
  :crawled 1576960110248,
  :content
  {:content
   "From 2011 to 2015, I wrote an annual Clojure Year in Review post, attempting to summarize all the interesting things that happened in Clojure in the last year. After 2015, I gave up. There was just too much happening, and I couldn’t keep track of it all. A couple of years ago, I got tired… <p><a href=\"https://stuartsierra.com/2019/12/21/clojure-start-time-in-2019\">Read the full article</a></p><img alt=\"\" width=\"1\" src=\"http://feeds.feedburner.com/~r/StuartSierra/~4/pN-8WvkAroU\" height=\"1\">",
   :direction "ltr"},
  :updated 1576948440000,
  :alternate
  [{:href
    "http://feedproxy.google.com/~r/StuartSierra/~3/pN-8WvkAroU/clojure-start-time-in-2019",
    :type "text/html"}],
  :title "Clojure Start Time in 2019",
  :author "Stuart",
  :published-str "Sat Dec 21 09:14:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16f2a25aea8:11df156:ad5391a1",
  :visual {:url "none"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://stuartsierra.com/?p=1226",
  :commonTopics
  [{:score 28.767299710830763,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1576948440000,
  :fingerprint "b814247b",
  :canonicalUrl
  "http://feedproxy.google.com/~r/StuartSierra/~3/pN-8WvkAroU/clojure-start-time-in-2019"}
 {:engagement 5,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1576938737827,
  :content
  {:content
   "<div><p><em>This post is part of <a shape=\"rect\" href=\"https://lambdaisland.com/blog/2019-11-25-advent-of-parens\">Advent of Parens\n2019</a>, my attempt to\npublish one blog post a day during the 24 days of the advent.</em></p><p>An extremely useful Emacs feature which I learned about much too late is the\n<code>.dir-locals.el</code>. It allows you to define variables which will then be set\nwhenever you open a file in the directory where <code>.dir-locals.el</code> is located (or\nany subdirectory thereof).</p><p>Here’s an example of a <code>.dir-locals.el</code> file of a project I was poking at today.</p><pre><code>((nil . ((cider-clojure-cli-global-options    . &quot;-A:fig:dev&quot;)\n         (cider-preferred-build-tool          . clojure-cli)\n         (cider-default-cljs-repl             . figwheel-main)\n         (cider-figwheel-main-default-options . &quot;dev&quot;)\n         (cider-repl-display-help-banner      . nil))))\n</code></pre><p>What this essentially does is set a bunch of CIDER variables for this specific\nproject. Mainly it stops CIDER asking annoying questions. It really bugs me when\nit asks me five times a day what ClojureScript REPL I’m using. This is project\nlevel stuff, so with <code>.dir-locals.el</code> I configure it at the project level and\nCIDER never has to ask me again.</p><p>The syntax can throw people off though, so here’s a really quick primer on\nassociation lists.</p><p>Emacs Lisp doesn’t have the handy hash-map syntax that we Clojurists enjoy. It\ndoes have a kind of hash table but there’s no syntax literal for it, and in\npractice it seems it’s rarely used. Instead, like most traditional Lisps, Elisp\nprimarily makes use of two-element tuples called cons cells.</p><p>You can create them with the <code>cons</code> function, or with a ‘dotted pair’ notation.\nSo these two expressions are identical.</p><pre><code>(cons &quot;val1&quot; &quot;val2&quot;)\n'(&quot;val1&quot; . &quot;val2&quot;)\n</code></pre><p>Need to have a hash-map like associative mapping from key to value? Well then\njust stick a bunch of these cons cells in a list.</p><pre><code>((:name . &quot;Arne&quot;)\n (:favorite-lisp . &quot;not Elisp&quot;))\n</code></pre><p>Back to <code>.dir-locals.el</code>. It contains an association list mapping major modes to\nvariable mappings.</p><pre><code>((clojure-mode . ((var-1 . &quot;val 1&quot;)\n                  (var-2 . &quot;val 2&quot;)))\n (ruby-mode . ((var-3 . &quot;val 3&quot;))))\n</code></pre><p>This will set <code>var-1</code> and <code>var-2</code> as buffer local variables in Clojure buffers,\nand it will set <code>var-3</code> in Ruby buffers.</p><p>Or you can not really care about the major mode and instead just put <code>nil</code>, that\nway it will be used in all buffers regardless of their major mode. The per-major\nmode stuff is mainly useful for general Emacs variables that you want to change\nbased on the language.</p><pre><code>((js-mode . ((js-indent-level . 2)\n             (indent-tabs-mode . nil))))\n</code></pre><p>And once you set up these variables for your project by all means do check the\n<code>.dir-locals.el</code> into source control so others may benefit from it as well.</p><p>One caveat: when you update your <code>.dir-locals.el</code> the changes will only come\ninto effect when you (re-)open a file in that directory. This gets me all the\ntime. To quickly reload a file you already have open use <code>C-x C-f RET</code> in Emacs\nor <code>SPC f A RET</code> in Spacemacs.</p><p>A final trick to be aware of is that you can use the special <code>eval</code> variable to\nevaluate code when a file gets opened. This can be very useful for instance when\nyou are using a type of ClojureScript REPL that CIDER does not (yet) know about.</p><pre><code>((nil . ((cider-default-cljs-repl          . my-cljs-repl)\n         (eval . (cider-register-cljs-repl-type 'my-cljs-repl &quot;(code-that-switches-to-the-cljs-repl)&quot;)))))\n</code></pre><p>For the full lowdown you naturally only need to check the info pages, <code>(info &quot;(emacs) Directory Variables&quot;)</code>.</p><p><em>Hi, my name is Arne (aka @plexus) and I consult companies and teams about\napplication architecture, development process, tooling and testing. I\ncollaborate with other talented people under the banner\n<a shape=\"rect\" href=\"http://gaiwan.co\">Gaiwan</a>. If you like to have a chat about how we could help\nyou with your project then please <a shape=\"rect\" href=\"https://lambdaisland.com/p/contact\">get in touch!</a></em></p></div>",
   :direction "ltr"},
  :updated 1576937111000,
  :alternate
  [{:href
    "https://lambdaisland.com/blog/2019-12-21-advent-of-parens-21-project-config-dir-locals",
    :type "text/html"}],
  :title
  "Advent 2019 part 21, Project level Emacs config with .dir-locals.el",
  :author "Arne Brasseur",
  :published-str "Sat Dec 21 06:05:11 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16f28df90a3:1084059:c84ffc39",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://lambdaisland.com/blog/2019-12-21-advent-of-parens-21-project-config-dir-locals",
  :commonTopics
  [{:score 45.892004471633804,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1576937111000,
  :fingerprint "945bebc0",
  :canonicalUrl
  "https://lambdaisland.com/blog/2019-12-21-advent-of-parens-21-project-config-dir-locals"}
 {:engagement 5,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1576905971553,
  :content
  {:content
   "<p><em>This article is part of the <a href=\"http://metaredux.com/posts/2019/12/01/meta-advent-2019.html\">“Meta Advent 2019”</a> series. I’ve committed to writing\na new blog post here every day until Christmas.</em></p>\n<p>nREPL has many interesting aspects of its design and its notion of sessions\nis definitely one of those. In this article I’ll try to shed some light on sessions\nand explain their usefulness.</p>\n<p><strong>Note:</strong> If some of the terminology in this article (e.g. nREPL messages) is unclear to you,\nplease consult nREPL’s <a href=\"https://nrepl.org/nrepl/0.6.0/design/overview.html\">design documentation</a> for\na quick overview of the key concepts.</p>\n<p>Simply put, nREPL sessions allow you to multiplex multiple “logical” (meta) REPLs over a single nREPL connection.\nTo illustrate this better - you can have two REPLs powered by nREPL using the same connection\nwith the dynamic bindings specific to each REPL (e.g. <code>*e</code>) contained in their sessions. That’s pretty different from\nthe socket REPL that’s bundled with Clojure, as there you’ll need a separate physical connection\nfor each REPL you need. Both models have their pros and cons and I’ll leave you to decide for yourself\nwhich one is more to your liking.</p>\n<p>Internally nREPL sessions persist <a href=\"https://clojure.org/reference/vars\">dynamic\nvars</a> (collected by <code>get-thread-bindings</code>)\nagainst a unique lookup. This allows you to have different values for vars like\n<code>*e</code> from different REPL clients (e.g. two separate REPL-y instances) or from a\nsingle client making use of multiple session within one connection. An existing\nsession can be cloned to create a new one, which then can be modified. This\nallows for copying of existing preferences into new environments.</p>\n<p>Each nREPL message (e.g. <code>eval</code>) is evaluated within a session, although you’re not required to specify\nthe session id explicitly. Here’s a typical evaluation message:</p>\n<div><div><pre><code><span>{</span><span>:session</span><span> </span><span>&quot;44d1978c-e2b5-4f86-a0d1-0f9f53e167bf&quot;</span><span> </span><span>:op</span><span> </span><span>&quot;eval&quot;</span><span> </span><span>:code</span><span> </span><span>&quot;(+ 1 2 3)&quot;</span><span>}</span><span>\n</span></code></pre></div></div>\n<p>I hope it’s easy to guess that this message will evaluate the code <code>(+ 1 2 3)</code>\nin the context of the specified session. This evaluation will also update\nvars like <code>*e</code>, <code>*1</code>, etc.</p>\n<p>There are two types of sessions:\n<em>ephemeral sessions</em> and <em>long-lived sessions</em> (or registered sessions).</p>\n<p><strong>Ephemeral sessions</strong> are used for one-off processing of a single message. If a message\narrives without a session id, one is created and assigned to it. This is discarded\nafter processing the message. It’s a common practice dispatch non-eval nREPL ops\nvia such sessions.</p>\n<p><strong>Long-lived sessions</strong> provide two things, persistence of values between\nmessages, and a guarantee for serial execution of messages. The only way to\ncreate a long-lived session is to clone an existing session (even an\nephemeral one). Cloning is achieved via the <code>clone</code> nREPL op - it can be used\nboth to create a “clean” new session or to clone an existing session.</p>\n<p>Clojure development tools like CIDER make heavy use of sessions - e.g. each CIDER connection to\nnREPL creates two nREPL sessions - one for the user’s evaluations and one for\ninternal (tooling) operations (e.g. an interactive commands defined in terms of\nevaluating some Clojure code).<sup><a href=\"http://metaredux.com/posts/2019/12/20/userstanding-nrepl-sessions.html#fn:1\">1</a></sup> Why is this necessary? Well, it’s quite simple\nactually - if we used only a single session, the tooling operations would mess up\nvars like <code>*e</code>, <code>*1</code>, <code>*2</code>, etc. But there’s actually more to this - each session is\ninternally backed by one evaluation thread and <code>eval</code> requests get serialized for\nexecution by this thread. By using the two sessions we also ensure that tooling\noperations won’t block user evaluation. For similar reasons CIDER dispatches\nall nREPL ops, other than <code>eval</code>, to ephemeral sessions.</p>\n<p>On a related topic - how would you approach the problem of needing to evaluate\nmany long-running operations (e.g. expensive computations) in parallel? Well,\nyou’ll just spin all of those evaluations in different sessions. Transient\nsessions are ideal for this type of tasks. Keep in mind that when it comes to\nnon-eval ops there’s no serialisation guarantee with processing of messages in\nephemeral sessions (though they are serialized in the current implementation\nsince they run on the server IO thread).</p>\n<p>By the way, have you ever thought how evaluation interruption works in nREPL?\nEach time you interrupt a evaluation in nREPL you’re killing its session thread and\na new one gets created in its place.</p>\n<p>Sessions become even more useful when different nREPL extensions start\ntaking advantage of\nthem. <a href=\"https://github.com/gfredericks/debug-repl\">debug-repl</a> uses\nsessions to store information about the current breakpoint, allowing\ndebugging of two things\nseparately. <a href=\"https://github.com/nrepl/piggieback\">piggieback</a> uses\nsessions to allow host a ClojureScript REPL alongside an existing\nClojure one. I think Piggieback is my favourite example of how far\nthe simple session abstraction can take you.</p>\n<p>That’s all I have for you today! See you again tomorrow!</p>\n<div>\n<ol>\n<li>\n<p>Usually those serve as fallbacks for operations normally powered by cider-nrepl, when it’s absent. <a href=\"http://metaredux.com/posts/2019/12/20/userstanding-nrepl-sessions.html#fnref:1\">↩</a></p>\n</li>\n</ol>\n</div>",
   :direction "ltr"},
  :updated 1576800000000,
  :alternate
  [{:href
    "http://metaredux.com/posts/2019/12/20/userstanding-nrepl-sessions.html",
    :type "text/html"}],
  :title "Userstanding nREPL Sessions",
  :author "Bozhidar Batsov",
  :published-str "Thu Dec 19 16:00:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16f26eb9761:e864a3:c84ffc39",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "http://metaredux.com/posts/2019/12/20/userstanding-nrepl-sessions",
  :commonTopics
  [{:score 45.53347927011912,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1576800000000,
  :fingerprint "4f8b9cfc",
  :canonicalUrl
  "http://metaredux.com/posts/2019/12/20/userstanding-nrepl-sessions.html"}
 {:engagement 4,
  :unread true,
  :crawled 1576905971553,
  :content
  {:content
   "<p>Probably the last update of the year. I had hoped to do it this weekly in 2019. That didn’t quite happen but since this is the 25th update of the year, I average about one every 2 weeks, which I’ll still claim is a pretty good result. Hope they were useful to you. I’ll try to keep it up in 2020.</p>\n<h2>Dep graphs</h2>\n<p>I released a new version of <a href=\"https://github.com/clojure/tools.deps.graph\">tools.deps.graph</a> today (0.2.24) that has a –size flag to add jar sizes to your dep graphs. Maybe useful, let me know. I’m thinking about adding this into the clj -Stree output too.</p>\n<p>Here’s the core.async deps with sizes:</p>\n<p><img alt=\"core.async\" src=\"https://insideclojure.org/images/depsize.png\"></p>\n<p>If you have graphviz installed already, you should be able to try this in your own deps.edn project with this command line:</p>\n<div><div><pre><code>clj -Sdeps '{:aliases {:g {:deps {org.clojure/tools.deps.graph {:mvn/version &quot;0.2.24&quot;}} :main-opts [&quot;-m&quot; &quot;clojure.tools.deps.graph&quot; &quot;--size&quot;]}}}' -A:g\n</code></pre></div></div>\n<p>See the <a href=\"https://github.com/clojure/tools.deps.graph/blob/master/README.md\">docs</a> for better ways to install and other things to do.</p>\n<h2>S3 Transporter</h2>\n<p>I’ve been spending most of my time recently working on a new S3 repository access implementation for tools.deps. Maven repositories are mostly just a bunch of files that accessible and are usually served over http(s), but it’s become common to serve them from s3 buckets too.</p>\n<p>“Wagons” are the old school pluggable ways to get to different repository types in Maven. These days, the modern Maven resolver has a new framework called “transporters”. The main project people use for access to S3 is the <a href=\"https://github.com/spring-attic/aws-maven\">Spring AWS Maven Wagon</a>. This project has not been actively maintained in 4-5 years and is archived on GitHub. Because of the inactivity, there are a bunch of forks and wrappers floating around trying to limp it along. Because it’s a wagon, it doesn’t work directly in the new transporter framework so you need a transporter-wagon adapter as well. The S3 access happens through an old version of aws-java-sdk and there have been various issues with region access, credential chains, bloated deps, etc.</p>\n<p>In case it is not yet obvious, this is a big pile of janky barely-working stuff and I cannot wait to drop the whole pile on the floor. In its place, I’ve written a new Transporter impl that uses the Cognitect aws-api library to talk directly to S3. This is currently in a tools.deps <a href=\"https://github.com/clojure/tools.deps.alpha/tree/s3-transporter\">branch</a> until I’ve got another chunk of testing in various environments. Nicely, it’s just about 120 lines of Clojure code thanks to the much friendlier things I’m plugging together.</p>\n<p>Anyhow, this is not quite done yet, but it does mostly work, and removes about 3-4 mb from the clj install (which maybe nobobdy cares about but me).</p>\n<p>One question I anticipate is whether this code will work for non-clj users, and currently the answer is no. I have not updated the “put” path (as clj doesn’t need it), and I have not done whatever dependency injection magic is needed for this code to work properly as a Maven extension (or Leiningen plugin, etc). Maybe at some point if I have some free time, I will look at that.</p>\n<h2>Spec 2</h2>\n<p>In spec 2 world, when last I wrote I was talking about the addition of nonflowing s/and, aka s/and-. We’re now contemplating renaming that to s/union (which I know currently is being used for schema combination, but that would change).</p>\n<p>I also implemented a new s/defcompop that takes a spec name, and additional predicates and creates a new spec op that takes the args of the first spec, then s/and-‘s them with the predicates. That was really in service of making it easy to define s/catv and s/cats which are vector-only and sequence-only variants of s/cat. Those are all now available in spec. I’ve seen the vector-only and sequence-only needs come up many times when spec’ing macros, so this is a good tool to fix a bunch of issues in the current core.specs.</p>\n<p>Users who have dabbled a bit with spec 2 may also notice that I have renamed all of the namespaces in the current impl as well, trying out a better strategy for this “alpha while in dev” practice. Specifically, the api namespaces are now clojure.alpha.spec, clojure.alpha.spec.gen, and clojure.alpha.spec.test. We will probably rename the library as well to clojure.alpha.spec. The idea is that when we leave “alpha”, the alpha will be removed from all of these names. Timing of all that and how it interacts with Clojure itself is all still TBD, just starting to work towards that.</p>\n<p>Also, Rich has been hard at work on design work around function specs and possible integration into defn. Lots of exciting ideas and I’m sure that will be a focus in January.</p>\n<h2>Misc</h2>\n<p>Some other miscellaneous updates:</p>\n<ul>\n<li>com.cognitect.aws/api - I noticed while working on the combination of the s3-transporter and the tools.deps.graph size enhancement that the aws api depended on Apache commons-codec, solely for one call to hex encode, so I wrote a <a href=\"https://github.com/cognitect-labs/aws-api/blob/master/src/cognitect/aws/util.clj#L65-L77\">Clojure-only version</a> and killed off that dependency. It’s not as fast, but it’s something like 1.7x which seemed sufficiently good. If anyone wants to perf golf it, let me know what you find! Hasn’t yet been released but should be in next.</li>\n<li>clojure/data.xml - I also noticed that data.xml was using data.codec for base64 encoding, which is now built into the JDK (since Java 8) in the Base64 class so I swapped that out and killed off the dep (and left a note in the data.codec readme). Didn’t release that but it will be in next.</li>\n<li>clojure/core.async - there was a question on Slack about why (chan 0) errors, but (buffer 0) doesn’t, and indeed there is no good reason - the assertion was in a bad place, so I fixed that. Didn’t release it yet.</li>\n<li>clojure/tools.deps.alpha - did some minor cleanups and bumped to latest deps, not released</li>\n<li>Some misc JIRA stuff</li>\n</ul>\n<h2>Other stuff I enjoyed this week…</h2>\n<p>I’m totally digging <a href=\"https://www.youtube.com/watch?v=fe0Enf31npc\">Broke</a> by Samm Henshaw this week - hat tip to my daughter for sending that one to me. I was hooked by the first horn hit 3 seconds in. Also, I imagine that’s what my sons’ apartments will look like when they’re older.</p>",
   :direction "ltr"},
  :updated 1576800000000,
  :alternate
  [{:href "http://insideclojure.org/2019/12/20/journal/",
    :type "text/html"}],
  :title "Journal 2019.25 - dep graphs, s3 transporter, spec 2",
  :author "Inside Clojure",
  :published-str "Thu Dec 19 16:00:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16f26eb9761:e864a2:c84ffc39",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url "https://insideclojure.org/images/depsize.png",
   :width 891,
   :height 500,
   :contentType "image/png"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "http://insideclojure.org/2019/12/20/journal/",
  :commonTopics
  [{:score 67.06703457066783,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1576800000000,
  :fingerprint "fb0883b7"}
 {:engagement 6,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1576867276600,
  :content
  {:content
   "<p>Each week, we discuss a different topic about Clojure and functional programming.</p>\n<p>If you have a question or topic you’d like us to discuss, tweet <a href=\"https://twitter.com/clojuredesign\">@clojuredesign</a>, send an email to <a href=\"mailto:feedback@clojuredesign.club\">feedback@clojuredesign.club</a>, or join the <code>#clojuredesign-podcast</code> channel on the <a href=\"http://clojurians.net/\">Clojurians Slack</a>.</p>\n<p>This week, the topic is: <strong>“Reducers.”</strong> We look at clojure.core.reducers and how it extracts performance by composing reducing functions.</p>\n<p>Selected quotes:</p>\n<ul>\n<li>“The seq abstraction, it’s rather lazy.”</li>\n<li>“It’s amazing how much work laziness requires.”</li>\n<li>“It doesn’t work out as well. That’s a wonderful way of saying ‘wrong’.”</li>\n<li>“Because ease of use was a design goal, they’re pretty easy to use.”</li>\n</ul>\n<p>Links:</p>\n<ul>\n<li><a href=\"https://clojure.org/reference/reducers\">Reducers</a> - Reference</li>\n<li><a href=\"https://clojure.org/news/2012/05/08/reducers\">Reducers - A Library and Model for Collection Processing</a> - Rich’s introductory blog post</li>\n<li><a href=\"https://www.braveclojure.com/quests/reducers/know-your-reducers/\">Know Your Reducers</a></li>\n<li><a href=\"https://eli.thegreenplace.net/2017/reducers-transducers-and-coreasync-in-clojure/\">Reducers, transducers and core.async in Clojure</a></li>\n</ul>",
   :direction "ltr"},
  :updated 1576854000000,
  :alternate
  [{:href "https://clojuredesign.club/episode/060-reduce-done-quick/",
    :type "text/html"}],
  :title "Ep 060: Reduce Done Quick",
  :author "Christoph Neumann and Nate Jones",
  :published-str "Fri Dec 20 07:00:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16f249d2738:be9c5c:69b9f616",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://clojuredesign.club/episode/060-reduce-done-quick/",
  :commonTopics
  [{:score 32.05863467123777,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.847,
    :id "nlp/f/topic/861",
    :salienceLevel "mention",
    :label "finance"}],
  :published 1576854000000,
  :fingerprint "cf19a3aa",
  :canonicalUrl
  "https://clojuredesign.club/episode/060-reduce-done-quick/"}
 {:engagement 6,
  :unread true,
  :crawled 1576854057170,
  :content
  {:content
   "<div><p><em>This post is part of <a shape=\"rect\" href=\"https://lambdaisland.com/blog/2019-11-25-advent-of-parens\">Advent of Parens\n2019</a>, my attempt to\npublish one blog post a day during the 24 days of the advent.</em></p><p>Here’s a great life hack, to peal ginger don’t use a knife, use a spoon. I’m not\nkidding. Just scrape off the peal with the tip of the spoon, it’s almost too\neasy.</p><p>Here’s a Clojure + Emacs life hack:</p><pre><code>(defun plexus-clojure-extras/cider-pprint-register (register)\n  (interactive (list (register-read-with-preview &quot;Eval register: &quot;)))\n  (cider--pprint-eval-form (get-register register)))\n</code></pre><p>So what does this do? It takes the value of a specific register and evaluates\nit as Clojure code with CIDER, showing the pretty-printed result in a separate buffer.</p><p>Registers are these places in Emacs where you can store a snippet of text (among other things) for\nlater use. They have one letter names, so for instance you\nselect some text, then press <code>C-x r s a</code> to put that text into register <code>a</code>.</p><table><thead><tr><th colspan=\"1\" rowspan=\"1\">Command</th><th colspan=\"1\" rowspan=\"1\">Keybinding</th><th colspan=\"1\" rowspan=\"1\">Description</th></tr></thead><tbody><tr><td colspan=\"1\" rowspan=\"1\">copy-to-register</td><td colspan=\"1\" rowspan=\"1\">C-x r s</td><td colspan=\"1\" rowspan=\"1\">Copy to region to a register.</td></tr><tr><td colspan=\"1\" rowspan=\"1\">view-register</td><td colspan=\"1\" rowspan=\"1\"> </td><td colspan=\"1\" rowspan=\"1\">See what’s in a register.</td></tr><tr><td colspan=\"1\" rowspan=\"1\">insert-register</td><td colspan=\"1\" rowspan=\"1\">C-x r i</td><td colspan=\"1\" rowspan=\"1\">Insert a given register into the buffer.</td></tr><tr><td colspan=\"1\" rowspan=\"1\">set-register</td><td colspan=\"1\" rowspan=\"1\"> </td><td colspan=\"1\" rowspan=\"1\">Set a register to a given value.</td></tr></tbody></table><p>Try <code>(info &quot;(Emacs)Registers&quot;)</code> for more info on registers.</p><p>I have a number of these registers prepopulated when my Emacs starts, for instance:</p><pre><code>(set-register ?k &quot;(do (require 'kaocha.repl) (kaocha.repl/run))&quot;)\n(set-register ?K &quot;(do (require 'kaocha.repl) (kaocha.repl/run-all))&quot;)\n(set-register ?r &quot;(user/refresh)&quot;)\n</code></pre><p>But often I’ll also bind them on the fly. Say I’m working on a complicated\nfunction, and below the function in the buffer I have some code that calls said\nfunction. I can jump back and forth between the two, each time updating the\nfunction, then moving to the invocation and checking the result. Or I can copy\nthe invocation to a register, and invoke it from anywhere.</p><p>The last piece of the puzzle is binding this to some handy key combination. I’m\na Spacemacs user, and I’ve bound this to leader-key + <code>,</code>. My leader key is also\n<code>,</code>, so I can now run the tests for a namespace with <code>,,k</code>. Pretty handy.</p><pre><code>(dolist (m '(clojure-mode\n               clojurec-mode\n               clojurescript-mode\n               clojurex-mode\n               cider-repl-mode\n               cider-clojure-interaction-mode))\n    (spacemacs/set-leader-keys-for-major-mode m\n      &quot;,&quot;  'plexus-clojure-extras/cider-pprint-register))\n</code></pre><p><em>Hi, my name is Arne (aka @plexus) and I consult companies and teams about\napplication architecture, development process, tooling and testing. I\ncollaborate with other talented people under the banner\n<a shape=\"rect\" href=\"http://gaiwan.co\">Gaiwan</a>. If you like to have a chat about how we could help\nyou with your project then please <a shape=\"rect\" href=\"https://lambdaisland.com/p/contact\">get in touch!</a></em></p><p><strong><a shape=\"rect\" href=\"https://clojureverse.org/t/advent-of-parens-2019/5159\">Comment on ClojureVerse</a></strong></p></div>",
   :direction "ltr"},
  :updated 1576852115000,
  :alternate
  [{:href
    "https://lambdaisland.com/blog/2019-12-20-advent-of-parens-20-life-hacks-emacs-ginger-tea",
    :type "text/html"}],
  :title "Advent 2019 part 20, Life Hacks aka Emacs Ginger Tea",
  :author "Arne Brasseur",
  :published-str "Fri Dec 20 06:28:35 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16f23d370d2:ae3a36:ad5391a1",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://lambdaisland.com/blog/2019-12-20-advent-of-parens-20-life-hacks-emacs-ginger-tea",
  :commonTopics
  [{:score 26.483811406880722,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1576852115000,
  :fingerprint "27686b65",
  :canonicalUrl
  "https://lambdaisland.com/blog/2019-12-20-advent-of-parens-20-life-hacks-emacs-ginger-tea"}
 {:engagement 5,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1576786168587,
  :content
  {:content
   "<div><p><em>This post is part of <a shape=\"rect\" href=\"https://lambdaisland.com/blog/2019-11-25-advent-of-parens\">Advent of Parens\n2019</a>, my attempt to\npublish one blog post a day during the 24 days of the advent.</em></p><p>Something I’m pretty good at is coming up with random hacks. The thing where\nyou’re like “hey how about we plug this thing into that thing” and everyone says\n“why would you do that that’s a terrible idea” and I’m like (<em>mario voice</em>)\n“let’s a go”.</p><p>And sometimes the result is not entirely useless. Like <a shape=\"rect\" href=\"https://github.com/borkdude/babashka/blob/5e10c913e0dc706c4b4de85e508779a67c6e51c0/README.md#convert-projectclj-to-depsedn\">this little oneliner</a>\nI came up with yesterday, using Babashka to “convert” a <code>project.clj</code> into a\n<code>deps.edn</code>.</p><pre><code>cat project.clj | sed -e 's/#=//g' -e 's/~@//g' -e 's/~//g' | bb '(let [{:keys [dependencies source-paths resource-paths]} (apply hash-map (drop 3 *in*))] {:paths (into source-paths resource-paths) :deps (into {} (for [[d v] dependencies] [d {:mvn/version v}]))} ) ' | jet --pretty > deps.edn\n</code></pre><p>You could do this properly, write a hundred lines or more to deal with profiles,\naliases, etc, or you can cook this up in ten minutes, and do the rest by hand.</p><p>Reminds me of that time I wrote a <a shape=\"rect\" href=\"https://twitter.com/plexus/status/308362006711394304\">chat server that fits in a\ntweet</a>, (the old 140 character ones), on the bus on the\nway back from a conference. Code golf was a lot easier when I still did Ruby :D</p><p><em>Hi, my name is Arne (aka @plexus) and I consult companies and teams about\napplication architecture, development process, tooling and testing. I\ncollaborate with other talented people under the banner\n<a shape=\"rect\" href=\"http://gaiwan.co\">Gaiwan</a>. If you like to have a chat about how we could help\nyou with your project then please <a shape=\"rect\" href=\"https://lambdaisland.com/p/contact\">get in touch!</a></em></p><p><strong><a shape=\"rect\" href=\"https://clojureverse.org/t/advent-of-parens-2019/5159\">Comment on ClojureVerse</a></strong></p></div>",
   :direction "ltr"},
  :updated 1576783203000,
  :alternate
  [{:href
    "https://lambdaisland.com/blog/2019-12-19-advent-of-parens-19-advent-of-random-hacks",
    :type "text/html"}],
  :title "Advent 2019 part 19, Advent of Random Hacks",
  :author "Arne Brasseur",
  :published-str "Thu Dec 19 11:20:03 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16f1fc78b0b:58f84a:ad5391a1",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://lambdaisland.com/blog/2019-12-19-advent-of-parens-19-advent-of-random-hacks",
  :published 1576783203000,
  :fingerprint "8074761b",
  :canonicalUrl
  "https://lambdaisland.com/blog/2019-12-19-advent-of-parens-19-advent-of-random-hacks"}
 {:engagement 9,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1576662968551,
  :content
  {:content
   "<p><a shape=\"rect\" href=\"https://nextjournal.com/plexus/advent-2019-part-18-exploring-bootleg\">Today’s post is published on Nextjournal</a>. Enjoy!</p>",
   :direction "ltr"},
  :updated 1576662216000,
  :alternate
  [{:href
    "https://lambdaisland.com/blog/2019-12-18-advent-of-parens-18-exploring-bootleg",
    :type "text/html"}],
  :title "Advent 2019 part 18, Exploring Bootleg",
  :author "Arne Brasseur",
  :published-str "Wed Dec 18 01:43:36 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16f186fa8e7:20052e1:97b0c8f7",
  :visual {:url "none"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://lambdaisland.com/blog/2019-12-18-advent-of-parens-18-exploring-bootleg",
  :published 1576662216000,
  :fingerprint "d2f0a0da",
  :canonicalUrl
  "https://lambdaisland.com/blog/2019-12-18-advent-of-parens-18-exploring-bootleg"}
 {:engagement 9,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1576577734384,
  :content
  {:content
   "<div><p><em>This post is part of <a shape=\"rect\" href=\"https://lambdaisland.com/blog/2019-11-25-advent-of-parens\">Advent of Parens\n2019</a>, my attempt to\npublish one blog post a day during the 24 days of the advent.</em></p><p>Here’s a little REPL helper that you may like.</p><pre><code>(defn trace! [v]\n  (let [m    (meta v)\n        n    (symbol (str (ns-name (:ns m))) (str (:name m)))\n        orig (:trace/orig m @v)]\n    (alter-var-root v (constantly (fn [&amp; args]\n                                    (prn (cons n args))\n                                    (apply orig args))))\n    (alter-meta! v assoc :trace/orig orig)))\n\n(defn untrace! [v]\n  (when-let [orig (:trace/orig (meta v))]\n    (alter-var-root v (constantly orig))\n    (alter-meta! v dissoc :trace/orig)))\n</code></pre><p>Pass <code>trace!</code> a function var and it will print out the invocation each time the function gets called.</p><p>Drop it in <code>user.clj</code> and <code>trace!</code> to your heart’s content!</p><pre><code>user> (trace! #'foo.bar/baz)\nuser> (foo.bar/baz 123)\n(foo.bar/baz 123)\nnil\nuser>\n</code></pre><p><em>Hi, my name is Arne (aka @plexus) and I consult companies and teams about\napplication architecture, development process, tooling and testing. I\ncollaborate with other talented people under the banner\n<a shape=\"rect\" href=\"http://gaiwan.co\">Gaiwan</a>. If you like to have a chat about how we could help\nyou with your project then please <a shape=\"rect\" href=\"https://lambdaisland.com/p/contact\">get in touch!</a></em></p><p><strong><a shape=\"rect\" href=\"https://clojureverse.org/t/advent-of-parens-2019/5159\">Comment on ClojureVerse</a></strong></p></div>",
   :direction "ltr"},
  :updated 1576576979000,
  :alternate
  [{:href
    "https://lambdaisland.com/blog/2019-12-17-advent-of-parens-17-trace-untrace",
    :type "text/html"}],
  :title "Advent 2019 part 17, trace! and untrace!",
  :author "Arne Brasseur",
  :published-str "Tue Dec 17 02:02:59 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16f135b16f0:19f8d74:69b9f616",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://lambdaisland.com/blog/2019-12-17-advent-of-parens-17-trace-untrace",
  :published 1576576979000,
  :fingerprint "f69721bb",
  :canonicalUrl
  "https://lambdaisland.com/blog/2019-12-17-advent-of-parens-17-trace-untrace"}
 {:engagement 10,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1576497186444,
  :content
  {:content
   "<div>\n<p><em>Issue 356 – December 16, 2019 · <a href=\"https://purelyfunctional.tv/newsletter-archives/\">Archives</a> · <a title=\"Thanks, Jeff!\" href=\"https://purelyfunctional.tv/newsletter/\">Subscribe</a></em></p>\n<h2>Clojure Tip 💡</h2>\n<p><em>convert recursion to iteration</em></p>\n<p>In the last issue, I showed how to use memoization to speed up a Fibonacci calculation. I mentioned that memoization was nice because you could wrap the nice mathematical definition and achieve acceptable performance without changing your code. You could solve performance issues by converting the recursion to iteration, which may be harder to read.</p>\n<p>Samantha Atkins asked why it’s harder to read. She suggested calculating the values forward. It’s a good question and I’ll try to answer it.</p>\n<p>Well, I don’t know if it is harder to read, so let’s do it now. However it turns out, converting recursion to iteration is an important skill.</p>\n<p><img title=\"\" src=\"https://purelyfunctional.tv/wp-content/uploads/2019/12/fibonacci-1.png\"></p>\n<p>For reference, here is the memoized, recursive version:</p>\n<pre><code>(declare fib)\n(def fib\n  (memoize\n   (fn [n]\n     (cond\n       (= 0 n) 0\n       (= 1 n) 1\n       :else   (+' (fib (- n 2)) (fib (- n 1)))))))\n</code></pre>\n<p>If we look closely, this recursive function works backwards. It starts at <code>n</code> and decrements it in each recursion, eventually landing on 0 or 1, which are the base cases.</p>\n<p>We could go <em>forward</em>, starting from 0 and working to <code>n</code>. We can calculate them and add them to the end of a vector. That means each element of the vector at position <code>i</code> is <code>fib(i)</code>.</p>\n<pre><code>(defn fib2 [n]\n  (loop [vals [0 1]]\n    (if (contains? vals n)\n      (get vals n)\n      (let \n        (recur (conj vals (+' l1 l2)))))))\n</code></pre>\n<p>It’s actually a cool solution. We’re using the <code>contains?</code> function asking “does this vector contain an answer for <code>n</code>?” If it doesn’t, we add one more answer and try again.</p>\n<p>In writing this, I thought it was kind of awkward to get the last two values out of the vector. (Try it, because I tried several ways and this was the best I could find.) This got me thinking: we want the last two elements, and that’s easy in a list. So let’s convert this to use a list.</p>\n<pre><code>(defn fib3 [n]\n  (if (zero? n)\n    0\n    (loop [vals (list 1 0)]\n      (if (&lt; n (count vals))\n        (first vals)\n        (let [[l1 l2] vals]\n          (recur (conj vals (+' l1 l2))))))))\n</code></pre>\n<p>This is my attempt at that. It’s much easier to destructure the first 2 elements from the list and add them. I think the test for the base case is a little difficult. I had to think about it, and I’ll probably want to check that it’s correct the next time through. Plus, I had to check for zero, because the <code>loop</code> doesn’t handle that case correctly.</p>\n<p>It strikes me that I have seen a different definition of Fibonacci that made <code>fib(0) = 1</code> which would make that first <code>if</code> unnecessary.</p>\n<p>Then I got to thinking that we don’t really need the whole list. We only ever destructure at most two elements from it. So why not just store those two?</p>\n<pre><code>(defn fib4 [n]\n  (cond\n    (= 0 n) 0\n    (= 1 n) 1\n    :else\n    (loop [i 2 l2 0 l1 1]\n      (if (= i n)\n        (+' l1 l2)\n        (recur (inc i) l1 (+' l1 l2))))))\n</code></pre>\n<p>We check those initial two values, then jump into a loop. <code>l2</code> is the second-to-last element, and <code>l1</code> is the last. The loop is very tight code. Now, I’m just code golfing, but that <code>cond</code> is kind of verbose. It’s basically saying “if <code>n</code> is less than 2, return n.”</p>\n<pre><code>(defn fib5 [n]\n  (if (&lt; n 2)\n    n\n    (loop [i 2 l2 0 l1 1]\n      (if (= i n)\n        (+' l1 l2)\n        (recur (inc i) l1 (+' l1 l2))))))\n</code></pre>\n<p>Okay, so we converted the recursive version into four different iterative versions. I can’t say that any of these are easier or harder than the others in some objective way. But I prefer the recursive version. Whatever way you like best, it’s an important skill to be able to convert between them.</p>\n<h2>Clojure Media 🍿</h2>\n<p><a title href=\"https://purelyfunctional.tv/mini-guide/clojure-web-servers/\">Clojure Web Server Recommendations</a></p>\n<p>I wrote this small guide to choosing a web server when starting a new Clojure web project. It was very tough to make recommendations. It gave me a newfound appreciation for the beginner experience. Basically, if we tell people “here are some small pieces, put them together however you like”, we have to do a better job of teaching them how to choose the pieces and how to put them together.</p>\n<p>This article wouldn’t be as good as it is if it wasn’t for the feedback, you, my wonderful audience gave me. I’m not worthy of so much attention from such wonderful folks. 😍</p>\n<h2>Clojure Challenge 🤔</h2>\n<h3>Last week’s challenge</h3>\n<p>The challenge in <a title href=\"https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-355-tip-memoize-to-trade-space-for-time/\">Issue 355</a> was to implement A-Star. It was quite a challenging problem. You can see my implementation here: <a title href=\"https://gist.github.com/ericnormand/c029a7ef7324a4d36923a7becf8fef11\">submissions</a>.</p>\n<h3>This week’s challenge</h3>\n<p><em>Prime factorization</em></p>\n<p>Every natural number can be expressed as a product of primes. For instance, <code>10 = 2 x 5</code> and <code>24 = 2 x 2 x 2 x 3</code>.</p>\n<p>Your task is to write a function that takes a number <code>n</code> as an argument and returns a list of its prime factors.</p>\n<p>As usual, please reply to this email and let me know what you tried. I’ll collect them up and share them in the next issue. If you don’t want me to share your submission, let me know.</p>\n<p>Rock on!<br>Eric Normand</p>\n</div>\n<p>The post <a rel=\"nofollow\" href=\"https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-356-tip-convert-recursion-to-iteration/\">PurelyFunctional.tv Newsletter 356: Tip: convert recursion to iteration</a> appeared first on <a rel=\"nofollow\" href=\"https://purelyfunctional.tv\">PurelyFunctional.tv</a>.</p>",
   :direction "ltr"},
  :updated 1576494000000,
  :entities
  [{:mentions [{:text "1 n"}],
    :id "nlp/f/entity/wd:1033525",
    :salienceLevel "mention",
    :label "Canon EOS-1N"}
   {:mentions [{:text "A-Star"}],
    :id "nlp/f/entity/wd:922201",
    :salienceLevel "mention",
    :label "Suzuki Alto"}],
  :alternate
  [{:href
    "https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-356-tip-convert-recursion-to-iteration/",
    :type "text/html"}],
  :title
  "PurelyFunctional.tv Newsletter 356: Tip: convert recursion to iteration",
  :author "Eric Normand",
  :published-str "Mon Dec 16 03:00:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16f0e8e068c:12fbca9:49b12733",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url
   "https://purelyfunctional.tv/wp-content/uploads/2019/12/fibonacci-1.png",
   :width 1448,
   :height 302,
   :contentType "image/png"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://purelyfunctional.tv/?p=45457",
  :commonTopics
  [{:score 35.55507494740353,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.757,
    :id "nlp/f/topic/774",
    :salienceLevel "mention",
    :label "engineering"}],
  :published 1576494000000,
  :fingerprint "a7945436",
  :canonicalUrl
  "https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-356-tip-convert-recursion-to-iteration/"}
 {:engagement 5,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}
   {:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/todo",
    :label "todo"}],
  :unread false,
  :crawled 1576495400043,
  :content
  {:content
   "<div><p><em>This post is part of <a shape=\"rect\" href=\"https://lambdaisland.com/blog/2019-11-25-advent-of-parens\">Advent of Parens\n2019</a>, my attempt to\npublish one blog post a day during the 24 days of the advent.</em></p><p>Over the last year or so I’ve found myself using some variations on a\ncertain pattern when modelling processes in Clojure. It’s kind of like a\nevent loop, but adapted to the functional, immutable nature of\nClojure. For lack of a better name I’m calling these coffee grinders. (The\nanalogy doesn’t even really work but the kid needs to have a name.)</p><p>Since I saw <a shape=\"rect\" href=\"https://www.youtube.com/watch?v=UJnsXUVsr7w\">Avdi Grimm’s OOPS Keynote</a> at Keep Ruby Weird last year I’ve been thinking a lot about the transaction vs process\ndichotomy. Avdi talks about the “Transactional Fallacy” from around 15:25. From his slides:</p><p>A transaction:</p><ul><li>Has a goal and is synonymous with its goal.</li><li>Is synchronous (blocking).</li><li>Can’t be put aside for later.</li><li>Completes (or fails) in essentially zero time.</li><li>Not supposed to be able to hang.</li><li>Either completes or aborts.</li><li>Self-destructs on error. (there is no concept of resuming)</li></ul><p>The transactional fallacy is when you model something as a transaction while it\nreally is a process. In Clojure we are perhaps even more susceptible to this\nbecause we tend to model things simply as functions. A web service call, a\ndatabase import, a HTTP handler which in turn consults several microservices,\nthey all just become functions. When you call such a function all you can do is\nwait for it to finish or blow up. What if you want to inspect where in the\nprocess it is at, maybe show a progress bar or some stats to the user? What if\nyou want to be able to resume a failed process?</p><p>Then you need to model these things <em>as a process</em>. Luckily in Clojure we\nactually have great tools to do this, because in Clojure time is first class. We\nmodel time as successive values of immutable data.</p><p>A process has a notion of internal state. Inspired by\n<a shape=\"rect\" href=\"http://pedestal.io/reference/interceptors\">interceptors</a> I tend to use a map\nfor this called <code>context</code> or <code>ctx</code>.</p><p>A process happens step by step, so it has a notion of what to do next. I tend to\nmodel this as some kind of queue of simple EDN events, maps which have an event\n<code>:type</code> property.</p><p>I’ll describe two concrete use cases, with some clear differences but also\nclearly some commonalities. The first is the message queue the\n<a shape=\"rect\" href=\"https://github.com/lambdaisland/kaocha-cljs\">kaocha-cljs</a> uses to handle\nmessages coming from the ClojureScript pREPL. The second is code I wrote for\n<a shape=\"rect\" href=\"https://nextjournal.com\">Nextjournal</a> to reify part of their data model.</p><p>To run ClojureScript tests Kaocha-cljs starts up a ClojureScript pREPL. A pREPL\nis a Process REPL, it returns data structures rather than just a stream of text,\nso it is more suitable for tooling.</p><p>The first thing Kaocha-cljs will do after starting this pREPL is open a\nwebsocket connection back to Kaocha, so it can send testing events back while\ntests are running, like <code>:fail</code>, <code>:pass</code>, <code>:begin-test-var</code>, etc.</p><p>Kaocha sends forms to the pREPL like <code>(require 'foo.bar-test)</code> and\n<code>(foo.bar-test/some-test)</code>. It then asynchronously starts receiving messages,\neither from the pREPL whenever something gets printed, when an exception occurs,\nwhen the function returns, or from websocket (test started, test failed, etc).</p><p>Based on these messages it needs to keep track of where it is in the process\n(has the pREPL booted? has the websocket connection been established? has the\nnamespace loaded? has the test finished?), tally up test results, assign them to\nthe right test in the result data, and decide to continue with the process,\nmoving on to the next test or namespace, or time out.</p><p>To do this it puts all these messages on a\n<code>java.util.concurrent.LinkedBlockingQueue</code>. Then at each point where we need to\nwait for the ClojureScript side to do stuff it invokes this <code>queue-consumer</code>.</p><pre><code>(defn queue-consumer [{:keys [queue timeout handlers result]}]\n  (let [poll #(.poll queue timeout TimeUnit/MILLISECONDS)\n        handlers (merge default-queue-handlers handlers)]\n    (loop [message (poll)\n           context {}]\n\n      (if (nil? message)\n        (if-let [timeout-handler (get handlers :timeout)]\n          (timeout-handler context)\n          :timeout)\n\n        (if-let [handler (get handlers (:type message))]\n          (let [context (handler message context)]\n            (if-let [result (result context)]\n              result\n              (recur (poll) context)))\n          (recur (poll) context))))))\n</code></pre><p>This takes messages of the queue one by one, and dispatches them to a dispatch\nfunction based on the message type. Each dispatch function receives the message\nand the context map, and returns a potentially updated context map.</p><p>A special <code>result</code> handler is called after each message is handled, if it\nreturns truthy then the loop finishes and Kaocha can continue.</p><p>Here’s an example of how <code>queue-consumer</code> is used</p><pre><code>(queue-consumer {:queue queue\n                 :timeout timeout\n                 :handlers {:cljs/ret\n                            (fn [{:keys [val] :as event} context]\n                              (when (map? val)\n                                (throw (ex-info &quot;ClojureScript Error while loading Kaocha websocket client&quot; event)))\n                              (cond-> context\n                                (= (str done) val)\n                                (assoc :eval-done? true)))\n\n                            :cljs/out\n                            (fn [{:keys [val]} context]\n                              (if (= &quot;NODE_WS_NOT_FOUND\\n&quot; val)\n                                (throw (ex-info &quot;Nodejs: require('ws') failed, make sure to 'npm install ws'.&quot;\n                                         (merge limited-testable context)))\n                                (println val))\n                              context)\n\n                            :timeout\n                            (fn [{:keys [eval-done?] :as context}]\n                              (if eval-done?\n                                (throw (ex-info &quot;Failed initializing ClojureScript runtime&quot; (merge limited-testable context)))\n                                (throw (ex-info &quot;Kaocha ClojureScript client failed connecting back.&quot; (merge limited-testable context)))))}\n\n                 :result (fn [context]\n                           (and (:eval-done? context)\n                                (:ws-client/ack? context)))})\n</code></pre><p>This has turned out to be a surprisingly stable and reliable approach, that not\nonly does what it says on the tin, but also manages to fail better, since Kaocha\nhas ample context for error reporting.</p><p>The second use case was for Nextjournal. Nextjournal uses Datomic, but most of\nthe nodes that make up an article are not directly represented as Datomic\nentities. Instead we store Transit encoded blobs, either of the full article\ndocument state, or of a change event that updates a previous version.</p><p>This has worked quite well, since the application usually requires a complete\narticle document to work with, so building it up from individual entity nodes\neach time would be a lot of extra work, but the downside is that we can’t query\nfor article nodes directly. So we decided to <a shape=\"rect\" href=\"https://lambdaisland.com/blog/2019-12-01-advent-of-parens-1-clojure-vocab-reify\">reify</a>\nsome of these, starting with “environments” (think: Docker images + a reference to the article that created them).</p><p>An article may have exported multiple versions of multiple environments over\ntime, so we need to loop over the complete article’s history. These in turn may\nbe based on environments from other articles, so to correctly link them to their\nparent we need to reify those environments first. But when running this locally\nI may not have all the articles that are referenced imported yet, so if any are\nmissing they need to be imported from production.</p><p>So I came up with another coffee grinder approach. This time the queue is part\nof the context, similar to how it is in interceptors. I also split out side\neffects here, so action handlers return <code>:tx-data</code>, which is then transacted\noutside of the handler.</p><p>If I try to reify an environment but its parent is missing, then it will put the\nreification of the parent on the queue, and then enqueue itself again\nafterwards.</p><pre><code>\n(defn- run-queue!\n  &quot;Naive task runner. Takes a context map consisting of a `queue` of actions, and\n  a datomic connection and initial db. The `handler` executes one action at a\n  time, returning an updated context map.\n\n  This action handler can manipulate the queue, i.e. prepend (lifo) or\n  append (fifo) actions. If the returned `ctx` contains `:tx-data` then this\n  will be transacted, and subsequent actions will receive the new database\n  value.&quot;\n  [ctx handler]\n  (loop [{:keys [conn db queue] :as ctx} ctx]\n    (let [[action &amp; queue] queue]\n      (if action\n        (do\n          (log/debug (first action) (second action))\n          (let [ctx (handler action (assoc ctx :queue queue))\n                db  (if-let [tx-data (:tx-data ctx)]\n                      (do\n                        (log/trace :tx-data tx-data)\n                        (:db-after @(datomic/transact conn tx-data)))\n                      db)]\n            (recur (dissoc (assoc ctx :db db) :tx-data))))\n        ctx))))\n</code></pre><p>The handler in this case is not a map of functions but a multimethod.</p><pre><code>(defmethod handle-action :import-article [[_ article-uuid] ctx]\n  (let [import-data (article/article-imports [article-uuid]\n                                             {:host     &quot;https://nextjournal.com&quot;})]\n    (-> ctx\n        (add-tx-data import-data)\n        (queue-prepend [[:reify-article-environments [:nextjournal/id article-uuid]]]))))\n</code></pre><p>And invoking the whole thing</p><pre><code>(defn reify-article-environments\n  &quot;Given a sequence of article ids (:db/id), go over the history of each article,\n  reifying all environments that are exported by runtimes, imported by\n  docker-environment nodes, or that are referenced by transclusion. For\n  non-production environments this will also import any article that is\n  referenced by transclusion.\n\n  See namespace level docs for some overarching considerations.&quot;\n  [conn db-ids]\n  (run-queue! {:conn  conn\n               :db    (datomic/db conn)\n               :queue (for [article-id db-ids]\n                        [:reify-article-environments article-id])}\n              handle-action))\n</code></pre><p>What I like about these approaches is the intermediate state that is built up\nprogresses in clear increments. In this way it’s very different from keeping\nstate in a mutable object with a bunch of fields. There’s a single point where\nthe state progresses, so it is always consistent, and you have access to the\nprevious and next values, so you can store them, diff them, save them to retry\netc.</p><p>I also like how in this last example both enqueuing new actions, and transacting\ndata into the database are accomplished by simple adding stuff to the context.\nWhen functions need to query Datomic they also find the database value in the\ncontext, so even though in a way these implementations do a lot of work, at\ntheir core they are pure functions, making them a joy to test. (with the\nexception of the article import).</p><p>Today has been a longer brain dump, but I’m looking forward to hear what people\nthink, and maybe inspire a few of you to try out similar patterns when you find\nthat what you are modeling is really more a process than a transaction. I’m\nopening <a shape=\"rect\" href=\"https://clojureverse.org/t/coffee-grinders/5218\">a thread on ClojureVerse</a> for comments and discussion.</p><p><em>Hi, my name is Arne (aka @plexus) and I consult companies and teams about\napplication architecture, development process, tooling and testing. I\ncollaborate with other talented people under the banner\n<a shape=\"rect\" href=\"http://gaiwan.co\">Gaiwan</a>. If you like to have a chat about how we could help\nyou with your project then please <a shape=\"rect\" href=\"https://lambdaisland.com/p/contact\">get in touch!</a></em></p><p><strong><a shape=\"rect\" href=\"https://clojureverse.org/t/coffee-grinders/5218\">Comment on ClojureVerse</a></strong></p></div>",
   :direction "ltr"},
  :updated 1576493288000,
  :alternate
  [{:href
    "https://lambdaisland.com/blog/2019-12-16-advent-of-parens-16-coffee-grinders",
    :type "text/html"}],
  :title "Advent 2019 part 16, Coffee Grinders",
  :author "Arne Brasseur",
  :published-str "Mon Dec 16 02:48:08 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16f0e72c46b:12cf690:49b12733",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://lambdaisland.com/blog/2019-12-16-advent-of-parens-16-coffee-grinders",
  :commonTopics
  [{:score 50.15379547039512,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.843,
    :id "nlp/f/topic/253",
    :salienceLevel "mention",
    :label "big data"}],
  :published 1576493288000,
  :fingerprint "1fa33fb4",
  :canonicalUrl
  "https://lambdaisland.com/blog/2019-12-16-advent-of-parens-16-coffee-grinders"}
 {:engagement 6,
  :unread true,
  :crawled 1576439555954,
  :content
  {:content
   "<div><p><em>This post is part of <a shape=\"rect\" href=\"https://lambdaisland.com/blog/2019-11-25-advent-of-parens\">Advent of Parens\n2019</a>, my attempt to\npublish one blog post a day during the 24 days of the advent.</em></p><p>Two shell commands anyone using JVM languages should be familiar with are <code>jcmd</code>\nand <code>jstack</code>. They are probably already available on your system, as they come\nbundled with the JDK. Try it out, run <code>jcmd</code> in a terminal.</p><p>This is what the result might look like</p><pre><code>$ jcmd\n4508 sun.tools.jcmd.JCmd\n23330 clojure.main -m nrepl.cmdline --middleware [&quot;refactor-nrepl.middleware/wrap-refactor&quot;, &quot;cider.nrepl/cider-middleware&quot;, &quot;cider.piggieback/wrap-cljs-repl&quot;]\n23053 clojure.main -m nrepl.cmdline --middleware [&quot;refactor-nrepl.middleware/wrap-refactor&quot;, &quot;cider.nrepl/cider-middleware&quot;, &quot;cider.piggieback/wrap-cljs-repl&quot;]\n</code></pre><p>What it does is list all running JVM processes, with their process id (pid), the\nclass whose <code>main</code> function is being executed, and the arguments to said <code>main</code>\nentrypoint. In this case I have two REPLs started from CIDER, and you also see\nthe jcmd process itself.</p><p>This output tends to be a but more useful than <code>ps ax | grep clojure</code>, as it\nhides the often noisy JVM options like classpath, properties, and heap size.</p><p>Once you have found the pid with <code>jcmd</code>, you can invoke <code>jstack</code>.</p><pre><code>$ jstack 2330\nFull thread dump OpenJDK 64-Bit GraalVM CE 19.1.0 (25.212-b03-jvmci-20-b04 mixed mode):                                          \n\n&quot;main&quot; #1 prio=5 os_prio=0 tid=0x00007f7828010800 nid=0x5b2f waiting on condition [0x00007f782d8ec000]                                                                      \n   java.lang.Thread.State: TIMED_WAITING (sleeping)                \n        at java.lang.Thread.sleep(Native Method)             \n        at nrepl.cmdline$dispatch_commands.invokeStatic(cmdline.clj:441)    \n        at nrepl.cmdline$dispatch_commands.invoke(cmdline.clj:425)  \n        at nrepl.cmdline$_main.invokeStatic(cmdline.clj:448)            \n        at nrepl.cmdline$_main.doInvoke(cmdline.clj:443)                  \n        at clojure.lang.RestFn.applyTo(RestFn.java:137)\n        at clojure.lang.Var.applyTo(Var.java:705)                  \n        at clojure.core$apply.invokeStatic(core.clj:665)                                  \n        at clojure.main$main_opt.invokeStatic(main.clj:514)                               \n        at clojure.main$main_opt.invoke(main.clj:510)\n        at clojure.main$main.invokeStatic(main.clj:664)\n        at clojure.main$main.doInvoke(main.clj:616)                                                        \n        at clojure.lang.RestFn.applyTo(RestFn.java:137)\n        at clojure.lang.Var.applyTo(Var.java:705)\n        at clojure.main.main(main.java:40)             \n\n...\n</code></pre><p>What you get is the full stack trace of every thread of the given process. This\ncan be a lot of output so you might want to pipe it to <code>less</code>.</p><p>This can be extremely useful when a process seems to be stuck and you want to\nknow what on earth it’s actually doing. For each thread it also tells you if its\nactive (<code>RUNNABLE</code>), or sleeping/blocked (<code>TIMED_WAITING</code>/<code>WAITING</code>).</p><p>Since it’s a lot of output you might want to filter it a bit. Most of the output\nwill not relate to your program, it’s either Java/JVM stuff like the GC thread,\nor parts of the stack that are inside Clojure or in third party libraries,\nwhereas you usually want to know where in your code the program is executing.</p><p>Simply grepping can already be quite helpful here. Presumably you have a common\nnamespace prefix for your project, so you can grep for that.</p><pre><code>jcmd 2330 | grep com.nextjournal\n</code></pre><p>But that will mash all threads together. To still keep each thread name and\nstate visible you could do something like this (this is copied verbatim from my\nshell history).</p><pre><code>jstack 25235 | egrep '(^&quot;|nextjournal|State)' | less\n</code></pre><p><code>egrep</code> is a shorthand for <code>grep -E</code> (TIL <code>egrep</code> is considered deprecated, so\ntry <code>grep -E</code> if <code>egrep</code> doesn’t work). It switches <code>grep</code> from “basic” to\n“extended” regular expressions, which only means that things like\n<code>(foo|bar|baz)</code> groups work as you would expect. In basic grep you need to add\nbackslaches to a bunch of the special characaters, and I can never forget which\nones do need it and which ones don’t. (Is it <code>\\(foo\\|bar\\|baz\\)</code> or\n<code>\\(foo|bar|baz\\)</code>?)</p><p>The thread name starts with a double quote as the first character on a line\n(<code>^&quot;</code>), my own namespaces contain in this case <code>nextjournal</code>, and the state of\nthe thread contains the word <code>State</code>.</p><p>You can now combine this with <code>watch</code> to keep an eye on your process as its\nrunning. (Example again taken from my shell history directly).</p><pre><code>watch -n 0.2 'jstack 31758 | egrep &quot;(environm|migrate|graph)&quot;'\n</code></pre><p>These are pretty basic tools, so YMMV, but I like how simple and lightweight\nthey are. When a process is already pinning all of my CPU cores I also don’t\nhave the luxury to spin up <code>visualvm</code> to capture profiling data, it just needs\ntoo many resources. In this case <code>jcmd</code> and <code>jstack</code> can provide some early\ninsights cheaply.</p><p>(BTW <code>visualvm</code> is another great tool for another. Props to Alexander Yakushev\nfor introducing me to all three of these and several more in <a shape=\"rect\" href=\"https://www.youtube.com/watch?v=HNp5EaRs3KI\">his Dutch Clojure\nDays talk</a> from a few years back.)</p><p><em>Hi, my name is Arne (aka @plexus) and I consult companies and teams about\napplication architecture, development process, tooling and testing. I\ncollaborate with other talented people under the banner\n<a shape=\"rect\" href=\"http://gaiwan.co\">Gaiwan</a>. If you like to have a chat about how we could help\nyou with your project then please <a shape=\"rect\" href=\"https://lambdaisland.com/p/contact\">get in touch!</a></em></p><p><strong><a shape=\"rect\" href=\"https://clojureverse.org/t/advent-of-parens-2019/5159\">Comment on ClojureVerse</a></strong></p></div>",
   :direction "ltr"},
  :updated 1576437170000,
  :entities
  [{:mentions [{:text "GC"}],
    :id "nlp/f/entity/wd:182172",
    :salienceLevel "mention",
    :label "Nintendo GameCube"}],
  :alternate
  [{:href
    "https://lambdaisland.com/blog/2019-12-15-advent-of-parens-15-jcmd-and-jstack",
    :type "text/html"}],
  :title "Advent 2019 part 15, jcmd and jstack",
  :author "Arne Brasseur",
  :published-str "Sun Dec 15 11:12:50 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16f0b1ea772:f1c810:49b12733",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://lambdaisland.com/blog/2019-12-15-advent-of-parens-15-jcmd-and-jstack",
  :commonTopics
  [{:score 0.645,
    :id "nlp/f/topic/10200",
    :salienceLevel "about",
    :label "tutorial"}
   {:score 34.85221465234603,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1576437170000,
  :fingerprint "49c532d1",
  :canonicalUrl
  "https://lambdaisland.com/blog/2019-12-15-advent-of-parens-15-jcmd-and-jstack"}
 {:engagement 5,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1576365577222,
  :content
  {:content
   "<div><p><em>This post is part of <a shape=\"rect\" href=\"https://lambdaisland.com/blog/2019-11-25-advent-of-parens\">Advent of Parens\n2019</a>, my attempt to\npublish one blog post a day during the 24 days of the advent.</em></p><p>Because he didn’t like classes.</p><p>Almost missed today’s post, so I’ll keep it short.</p><p>It’s fairly well known that you can put <code>set -e</code> at the top of a shell script to\nexit the script when a command returns a non-zero exit status. What isn’t as\nwidely known is that <code>set -x</code> will cause every command to be printed out, so you\nget a trace of what the script is doing.</p><p>And what is not nearly as widely known as it should be is that you can also\nexecute <code>bash -x some_script</code> to run that script with tracing on. Curious what\nthe <code>clj</code> / <code>clojure</code> scripts do exactly? Then try this:</p><pre><code>bash -x `which clojure`\n</code></pre><p>What’s great about this is that any environment variables get expanded, so you really get the exact commands that are executed, and you can copy and tweak and re-run them as you like.</p><p>That’s it, see you tomorrow!</p><p><em>Hi, my name is Arne (aka @plexus) and I consult companies and teams about\napplication architecture, development process, tooling and testing. I\ncollaborate with other talented people under the banner\n<a shape=\"rect\" href=\"http://gaiwan.co\">Gaiwan</a>. If you like to have a chat about how we could help\nyou with your project then please <a shape=\"rect\" href=\"https://lambdaisland.com/p/contact\">get in touch!</a></em></p></div>",
   :direction "ltr"},
  :updated 1576364631000,
  :alternate
  [{:href
    "https://lambdaisland.com/blog/2019-12-14-advent-of-parens-14-why-did-the-clojurist-drop-out-of-school",
    :type "text/html"}],
  :title
  "Advent 2019 part 14, Why did the Clojurist drop out of school?",
  :author "Arne Brasseur",
  :published-str "Sat Dec 14 15:03:51 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16f06b5d406:b4371d:69b9f616",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://lambdaisland.com/blog/2019-12-14-advent-of-parens-14-why-did-the-clojurist-drop-out-of-school",
  :published 1576364631000,
  :fingerprint "8d0a4fe8",
  :canonicalUrl
  "https://lambdaisland.com/blog/2019-12-14-advent-of-parens-14-why-did-the-clojurist-drop-out-of-school"}
 {:engagement 6,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1576324802332,
  :content
  {:content
   "<p><em>This article is part of the <a href=\"http://metaredux.com/posts/2019/12/01/meta-advent-2019.html\">“Meta Advent 2019”</a> series. I’ve committed to writing\na new blog post here every day until Christmas.</em></p>\n<p>Remember how a while ago I wrote about the <a href=\"http://metaredux.com/posts/2019/06/29/farewell-grimoire.html\">demise of Grimoire</a>? Eventually\nwe had to replace the Grimoire documentation lookup functionality in CIDER with similar functionality\npowered by <a href=\"https://clojuredocs.org/\">ClojureDocs</a> and today I want to share\nhow exactly did we do this.</p>\n<p>With Grimoire it was possible to query the service for a particular symbol,\nwhich made it really easy to integrate it in CIDER. As Emacs can handle web\nAPI requests directly, the entire integration was done Emacs-side. This worked\nfairly well, but had the small downside that when you requested info about some\nvar from Grimoire it would take a second or so to fetch this data. I thought\na few times about building a smarter Grimoire middleware that did some data pre-fetching/caching,\nbut sadly I never found the time to work on this.</p>\n<p>When we started working on a similar ClojureDocs integration for CIDER we\nstruggled a bit, as ClojureDocs doesn’t have an equivaluent API. This meant\nthat the only option for us was to simply export all the ClojureDocs data and query it\nlocally. I’ve always been a bit bothered by the fact that ClojureDocs has only\na JSON data export. JSON is relatively easy to work with and quite ubiquitous\nthese days, but the Clojure community generally favours the use of EDN. And this\nleads us to the crux of this article…</p>\n<p>We didn’t really want to deal with JSON, so <a href=\"https://github.com/liquidz\">Masashi Iizuka</a>\n(of <code>vim-iced</code> fame) created a <a href=\"https://clojuredocs-edn.netlify.com/\">simple\nservice</a> that downloads fresh\ndata from ClojureDocs each day and converts it to EDN. As a bonus the service provides\nseveral versions of the data - a direct port of the original JSON data, a compact version that\nremoves all the data related to updates that were done to some entry, and a minified variant\nof the compact version. Generally what we needed was the compact format, so here I’ll share an example of it:</p>\n<div><div><pre><code><span>;; compact EDN</span><span>\n</span><span>{</span><span>:clojure.core/remove</span><span>\n</span><span>{</span><span>:added</span><span> </span><span>&quot;1.0&quot;</span><span>,</span><span>\n</span><span>:ns</span><span> </span><span>&quot;clojure.core&quot;</span><span>,</span><span>\n</span><span>:name</span><span> </span><span>&quot;remove&quot;</span><span>,</span><span>\n</span><span>:file</span><span> </span><span>&quot;clojure/core.clj&quot;</span><span>,</span><span>\n</span><span>:static</span><span> </span><span>true,</span><span>\n</span><span>:type</span><span> </span><span>&quot;function&quot;</span><span>,</span><span>\n</span><span>:column</span><span> </span><span>1</span><span>,</span><span>\n</span><span>:see-alsos</span><span>\n</span><span>[</span><span>:clojure.core/filter</span><span> </span><span>:clojure.core/group-by</span><span> </span><span>:clojure.core/keep</span><span>]</span><span>,</span><span>\n</span><span>:line</span><span> </span><span>2818</span><span>,</span><span>\n</span><span>:examples</span><span>\n</span><span>[</span><span>&quot;(remove pos? [1 -2 2 -1 3 7 0])\\n;;=> (-2 -1 0)\\n\\n(remove nil? [1 nil 2 nil 3 nil])\\n;;=> (1 2 3)\\n\\n;; remove items that are evenly divisible by 3\\n(remove #(zero? (mod % 3)) (range 1 21))\\n;;=> (1 2 4 5 7 8 10 11 13 14 16 17 19 20)&quot;</span><span>\n</span><span>&quot;;; compare to filter\\n\\n(remove even? (range 10))\\n;;=> (1 3 5 7 9)\\n\\n(remove (fn [x]\\n (= (count x) 1))\\n [\\&quot;a\\&quot; \\&quot;aa\\&quot; \\&quot;b\\&quot; \\&quot;n\\&quot; \\&quot;f\\&quot; \\&quot;lisp\\&quot; \\&quot;clojure\\&quot; \\&quot;q\\&quot; \\&quot;\\&quot;])\\n;;=> (\\&quot;aa\\&quot; \\&quot;lisp\\&quot; \\&quot;clojure\\&quot; \\&quot;\\&quot;)\\n\\n; When coll is a map, pred is called with key/value pairs.\\n(remove #(> (second %) 100)\\n {:a 1\\n :b 2\\n :c 101\\n :d 102\\n :e -1})\\n;;=> ([:a 1] [:b 2] [:e -1])\\n&quot;</span><span>\n</span><span>&quot;;; remove items from a set/list\\n\\n(remove #{:a} #{:b :c :d :a :e})\\n;;=> (:e :c :b :d)\\n\\n(remove #{:a} [:b :c :d :a :e :a :f])\\n;;=> (:b :c :d :e :f)\\n&quot;</span><span>\n</span><span>&quot;;; use map as a pred\\n\\n(remove {:a 42 :b 69} #{:a :b :c})\\n;;=> (:c)&quot;</span><span>]</span><span>,</span><span>\n</span><span>:notes</span><span> </span><span>nil,</span><span>\n</span><span>:arglists</span><span> </span><span>[</span><span>&quot;pred&quot;</span><span> </span><span>&quot;pred coll&quot;</span><span>]</span><span>,</span><span>\n</span><span>:doc</span><span>\n</span><span>&quot;Returns a lazy sequence of the items in coll for which\\n (pred item) returns logical false. pred must be free of side-effects.\\n Returns a transducer when no collection is provided.&quot;</span><span>,</span><span>\n</span><span>:library-url</span><span> </span><span>&quot;https://github.com/clojure/clojure&quot;</span><span>,</span><span>\n</span><span>:href</span><span> </span><span>&quot;/clojure.core/remove&quot;</span><span>}}</span><span>\n</span></code></pre></div></div>\n<p>Basically you get a simple Clojure map where the keys are fully qualified names and the values are maps describing those names.\nIf you’re interested in the implementation details you can check out the <a href=\"https://github.com/clojure-emacs/clojuredocs-export-edn\">GitHub repo</a>.</p>\n<p>If you’re curious how CIDER interacts with this service you should check out <a href=\"https://github.com/clojure-emacs/orchard/blob/master/src/orchard/clojuredocs.clj\">this namespace</a> in Orchard. Basically Orchard fetches the data once and caches it, refreshing it every few days. It’s not super elegant, but it gets the job done.\nOn the bright side, now once the data gets locally cached all the queries become instantaneous. We’ve also wrapped in this in a nREPL middleware (part of <code>cider-nrepl</code> as well).\nNow it’s really simple for tool authors to implement ClojureDocs lookup.</p>\n<p>Potentially down the road we can extend the export service to provide some simple data query interface. If someone is looking\nfor some simple way to contribute to CIDER and its Orchard, that’s as good of a starting point as any.\nFor me this story is a great example of the power of cross-team collaboration (in this case <code>vim-iced</code>’s and CIDER’s) and sharing\na common foundation for building development tools upon.</p>\n<p>That’s all I have for you today! I hope that some of you will find our work on\nthe data export service and the ClojureDocs support in Orchard and <code>cider-nrepl</code>\nuseful! See you again tomorrow!</p>",
   :direction "ltr"},
  :updated 1576281600000,
  :alternate
  [{:href
    "http://metaredux.com/posts/2019/12/14/exporting-clojuredocs-as-edn.html",
    :type "text/html"}],
  :title "Exporting ClojureDocs as EDN",
  :author "Bozhidar Batsov",
  :published-str "Fri Dec 13 16:00:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16f0447a71c:86c36a:49b12733",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "http://metaredux.com/posts/2019/12/14/exporting-clojuredocs-as-edn",
  :commonTopics
  [{:score 27.491481006562434,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1576281600000,
  :fingerprint "ec359992",
  :canonicalUrl
  "http://metaredux.com/posts/2019/12/14/exporting-clojuredocs-as-edn.html"}
 {:engagement 7,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1576306476953,
  :recrawled 1576480717864,
  :content
  {:content
   "<p>Two things makes me keep coming back to Clojure: <a href=\"https://augustl.com/blog/2019/you_have_to_know_about_persistent_data_structures/\">Persistent data structures</a> and lazy sequences.</p>\n<p>This post is about lazy sequences.</p>\n<h2>Lazy fibonacci</h2>\n<p>To demonstrate lazy sequences, let's implement the Fibonacci sequence.</p>\n<p>Here's a JavaScript version of the Clojure code to follow, so you have something to compare it to.</p>\n<pre><code><span>// JavaScript version, for good measure</span>\n<span>function</span> <span>fib</span><span>(</span><span>n</span><span>,</span> <span>xs</span><span>)</span> <span>{</span>\n  <span>xs</span> <span>=</span> <span>xs</span> <span>||</span> <span>[</span><span>0</span><span>,</span> <span>1</span><span>]</span>\n  \n  <span>const</span> <span>c</span> <span>=</span> <span>xs</span><span>.</span><span>length</span>\n  \n  <span>if</span> <span>(</span><span>c</span> <span>&lt;</span> <span>n</span><span>)</span> <span>{</span>\n    <span>return</span> <span>fib</span><span>(</span><span>n</span><span>,</span> <span>xs</span><span>.</span><span>concat</span><span>([</span>\n      <span>xs</span><span>[</span><span>xs</span><span>.</span><span>length</span> <span>-</span> <span>1</span><span>]</span> <span>+</span> <span>xs</span><span>[</span><span>xs</span><span>.</span><span>length</span> <span>-</span> <span>2</span><span>]</span>\n    <span>]))</span>\n  <span>}</span> <span>else</span> <span>{</span>\n    <span>return</span> <span>xs</span><span>;</span>\n  <span>}</span>\n<span>}</span>\n\n<span>fib</span><span>(</span><span>10</span><span>)</span>\n<span>// [0, 1, 1, 2, 3, 5, 8, 13, 21, 34]</span></code></pre>\n<p>Here's the Clojure version of the same code.</p>\n<pre><code><span>; &quot;Plain&quot; version</span>\n<span>(</span><span>defn </span><span>fib</span>\n  <span>([</span><span>n</span><span>]</span> \n   <span>(</span><span>fib</span> <span>n</span> <span>[</span><span>0</span> <span>1</span><span>]))</span>\n  <span>([</span><span>n</span> <span>xs</span><span>]</span>\n   <span>(</span><span>let </span><span>[</span><span>c</span> <span>(</span><span>count </span><span>xs</span><span>)]</span>\n     <span>(</span><span>if </span><span>(</span><span>&lt; </span><span>c</span> <span>n</span><span>)</span>\n       <span>(</span><span>fib</span> <span>n</span>\n         <span>(</span><span>conj </span><span>xs</span> \n           <span>(</span><span>+ </span><span>(</span><span>nth </span><span>xs</span> <span>(</span><span>- </span><span>c</span> <span>1</span><span>))</span>\n              <span>(</span><span>nth </span><span>xs</span> <span>(</span><span>- </span><span>c</span> <span>2</span><span>)))))</span>\n       <span>xs</span><span>))))</span>\n       \n<span>(</span><span>fib</span> <span>10</span><span>)</span>\n<span>; [0 1 1 2 3 5 8 13 21 34]</span></code></pre>\n<p>All good, right?</p>\n<p>Well, it's not the prettiest code in the world.</p>\n<p>Let's fix that, by making literally the prettiest code in the world.</p>\n<pre><code><span>; Lazy version - literally the prettiest </span>\n<span>; code in the world!</span>\n<span>(</span><span>defn </span><span>fib</span>\n  <span>([]</span>\n   <span>(</span><span>fib</span> <span>0</span> <span>1</span><span>))</span>\n  <span>([</span><span>a</span> <span>b</span><span>]</span>\n   <span>(</span><span>lazy-seq</span> <span>(</span><span>cons </span><span>a</span> <span>(</span><span>fib</span> <span>b</span> <span>(</span><span>+ </span><span>a</span> <span>b</span><span>))))))</span>\n   \n<span>(</span><span>take </span><span>10</span> <span>(</span><span>fib</span><span>))</span>\n<span>; (0 1 1 2 3 5 8 13 21 34)</span></code></pre>\n<p>Oh yass.</p>\n<p>First of all, that's <em>much</em> less code.</p>\n<p>Second of all, you can make it use BigDecimals and get <code>(fib 100000)</code> super fast, with good memory usage and no stack overflow and all that jazz.</p>\n<pre><code><span>; Clojure uses long by default, so make it use </span>\n<span>; bigdec for arbitrarily sized numbers</span>\n<span>(</span><span>defn </span><span>fib</span>\n  <span>([]</span>\n   <span>(</span><span>fib</span> <span>(</span><span>bigdec</span> <span>0</span><span>)</span> <span>(</span><span>bigdec</span> <span>1</span><span>)))</span>\n  <span>([</span><span>a</span> <span>b</span><span>]</span>\n   <span>(</span><span>lazy-seq</span> <span>(</span><span>cons </span><span>a</span> <span>(</span><span>fib</span> <span>b</span> <span>(</span><span>+ </span><span>a</span> <span>b</span><span>))))))</span>\n\n<span>(</span><span>time </span><span>(</span><span>last </span><span>(</span><span>take </span><span>100000</span> <span>(</span><span>fib</span><span>))))</span>\n<span>; &quot;Elapsed time: 299.1678 msecs&quot;</span>\n<span>; 1605285768272[...20880 digits (yes,</span>\n<span>; really) cut for brevity]790626M</span></code></pre>\n<p>That's pretty cool.</p>\n<p>By the way, the threading macro is awesome. You use it to write statements in the order that they are called.</p>\n<pre><code><span>; Plain version</span>\n<span>(</span><span>time </span><span>(</span><span>last </span><span>(</span><span>take </span><span>100000</span> <span>(</span><span>fib</span><span>))))</span>\n\n<span>; Awesome threading macro version</span>\n<span>(</span><span>->></span> <span>(</span><span>fib</span><span>)</span>\n     <span>(</span><span>take </span><span>100000</span><span>)</span>\n     <span>(</span><span>last</span><span>)</span>\n     <span>(</span><span>time</span><span>))</span></code></pre>\n<p>So what actually <em>is</em> this laziness?</p>\n<p>Well, the whole idea is that you separate two concepts: generating data, and extracting/using data.</p>\n<p>See how the first version had both iteration, data generation, checking if our max <code>n</code> was reached etc in the same code?</p>\n<p>We don't need to do that with laziness.</p>\n<p>With the lazy version, we just define what the data structure looks like. You get a &quot;lazy sequence&quot; back, and you can think of it as a view of an infinitely sized Fibonacci sequence, that is not actually computed until you actually ask for some data from the sequence.</p>\n<p>So it's the call to <code>(take)</code> that actually makes something happen.</p>\n<pre><code><span>; &quot;iterate&quot; is also lay</span>\n<span>(</span><span>take </span><span>10</span> <span>(</span><span>iterate inc </span><span>0</span><span>))</span>\n<span>; (0 1 2 3 4 5 6 7 8 9)</span>\n\n<span>; So is &quot;range&quot;</span>\n<span>(</span><span>take </span><span>10</span> <span>(</span><span>range </span><span>-50</span> <span>9000</span> <span>3</span><span>))</span>\n<span>; (-50 -47 -44 -41 -38 -35 -32 -29 -26 -23)</span></code></pre>\n<h2>Lazy map</h2>\n<p>This code prints absolutely nothing.</p>\n<pre><code><span>(</span><span>map </span><span>(</span><span>fn </span><span>[</span><span>n</span><span>]</span> <span>(</span><span>print </span><span>n</span> <span>&quot;&quot;</span><span>))</span>\n     <span>[</span><span>1</span> <span>2</span> <span>3</span> <span>4</span> <span>5</span> <span>6</span> <span>7</span> <span>8</span> <span>9</span> <span>10</span><span>])</span>\n\n<span>; Nothing.. Absolutely nothing</span></code></pre>\n<p>That's because <code>(map)</code> is also lazy. We have to actually get some items from it for the map function to be called.</p>\n<pre><code><span>; Wait what, now?</span>\n<span>(</span><span>->></span> <span>(</span><span>map </span><span>(</span><span>fn </span><span>[</span><span>n</span><span>]</span> <span>(</span><span>print </span><span>n</span> <span>&quot;&quot;</span><span>)</span> <span>n</span><span>)</span> \n          <span>[</span><span>1</span> <span>2</span> <span>3</span> <span>4</span> <span>5</span> <span>6</span> <span>7</span> <span>8</span> <span>9</span> <span>10</span><span>])</span>\n     <span>(</span><span>take </span><span>3</span><span>))</span>\n     \n<span>; prints</span>\n<span>; 1 2 3 4 5 6 7 8 9 10</span>\n\n<span>; returns</span>\n<span>; (1 2 3)</span></code></pre>\n<p>Surprised? We ask for 3 items, but all 10 items seems to be printed! Is it not lazy after all?</p>\n<p>It turns out that under the hood, Clojure will some times do a performance optimization and realize lazy sequences in batches of 32.</p>\n<pre><code><span>; Batching</span>\n<span>(</span><span>->></span> <span>(</span><span>map </span><span>(</span><span>fn </span><span>[</span><span>n</span><span>]</span> <span>(</span><span>print </span><span>n</span> <span>&quot;&quot;</span><span>)</span> <span>n</span><span>)</span>\n          <span>[</span><span>1</span> <span>2</span> <span>3</span> <span>4</span> <span>5</span> <span>6</span> <span>7</span> <span>8</span> <span>9</span> <span>10</span> <span>11</span> <span>...</span> <span>34</span> <span>35</span> <span>36</span><span>])</span>\n     <span>(</span><span>take </span><span>3</span><span>))</span>\n     \n<span>; prints</span>\n<span>; 1 2 3 4 5 6 7 8 9 10 11 ... 30 31 32 </span>\n\n<span>; returns</span>\n<span>; (1 2 3)</span></code></pre>\n<p>Note: it will run the mapping function 32 times and &quot;pre-cache&quot; the lazy results - but you'll still get a sequence with 3 elements in it returned from <code>(take)</code>.</p>\n<p>But, if your source is a lazy sequence and not a vector, it won't do that.</p>\n<pre><code><span>; No batching when source is lazy</span>\n<span>(</span><span>->></span> <span>(</span><span>map </span><span>(</span><span>fn </span><span>[</span><span>n</span><span>]</span> <span>(</span><span>print </span><span>n</span> <span>&quot;&quot;</span><span>)</span> <span>n</span><span>)</span> \n          <span>(</span><span>iterate inc </span><span>1</span><span>))</span>\n     <span>(</span><span>take </span><span>3</span><span>))</span>\n\n<span>; prints</span>\n<span>; 1 2 3</span>\n\n<span>; returns</span>\n<span>; (1 2 3)</span></code></pre>\n<h2>Generating PIN codes</h2>\n<p>This one is pretty cool. Let's say you want to generate N random 4 digit pin codes.</p>\n<p>You can generate an infinite lazy sequence of random numbers:</p>\n<pre><code><span>; Possible duplicates!</span>\n<span>(</span><span>->></span> <span>(</span><span>repeatedly</span> <span>#</span><span>(</span><span>rand-int </span><span>9999</span><span>))</span>\n     <span>(</span><span>take </span><span>5</span><span>))</span>\n\n<span>; (643 6000 483 8668 7493)</span></code></pre>\n<p>But this list can contain duplicates! The chances are low when you just get 5 items obviously, but that doesn't matter - our requirement was that the list should be unique.</p>\n<p>Enter the awesomeness of <code>(distinct)</code>. That function will take a list, and return a list with no duplicates - <em>and it is lazy!</em></p>\n<pre><code><span>; No duplicates!</span>\n<span>(</span><span>->></span> <span>(</span><span>repeatedly</span> <span>#</span><span>(</span><span>rand-int </span><span>9999</span><span>))</span>\n     <span>(</span><span>distinct</span><span>)</span>\n     <span>(</span><span>take </span><span>5</span><span>)</span>\n     <span>; Also format it, for good measure</span>\n     <span>(</span><span>map </span><span>#</span><span>(</span><span>format</span> <span>&quot;%04d&quot;</span> <span>%</span><span>)))</span>\n\n<span>; (&quot;6856&quot; &quot;3461&quot; &quot;8833&quot; &quot;4884&quot; &quot;0004&quot;)</span></code></pre>\n<p>So good. So, so very good.</p>",
   :direction "ltr"},
  :updated 1576278000000,
  :alternate
  [{:href "http://augustl.com/blog/2019/amazing_lazy_data_structures/",
    :type "text/html"}],
  :title "The amazingly amazing amaze of lazy data structures",
  :author "August Lilleaas",
  :published-str "Fri Dec 13 15:00:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16f03300799:7a9d01:69b9f616",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "urn:augustl-com:feed:post::blog:2019:amazing_lazy_data_structures",
  :updateCount 3,
  :commonTopics
  [{:score 62.765199708755745,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1576278000000,
  :fingerprint "1577d5a",
  :canonicalUrl
  "http://augustl.com/blog/2019/amazing_lazy_data_structures/"}
 {:engagement 6,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1576279312387,
  :content
  {:content
   "<p>Each week, we discuss a different topic about Clojure and functional programming.</p>\n<p>If you have a question or topic you’d like us to discuss, tweet <a href=\"https://twitter.com/clojuredesign\">@clojuredesign</a>, send an email to <a href=\"mailto:feedback@clojuredesign.club\">feedback@clojuredesign.club</a>, or join the <code>#clojuredesign-podcast</code> channel on the <a href=\"http://clojurians.net/\">Clojurians Slack</a>.</p>\n<p>This week, the topic is: <strong>“Sequences.”</strong> We examine the sequence abstraction and then ponder how it helps and hinders our data transformation.</p>\n<p>Selected quotes:</p>\n<ul>\n<li>“There is only one filter, map, and reduce. They need to be able to interpret all collections.”</li>\n<li>“Primitives only take you so far.”</li>\n<li>“The first thing is the first thing!”</li>\n<li>“The seq abstraction is foundational to Clojure core.”</li>\n<li>“The into function pours a sequence back into a concrete data structure.”</li>\n</ul>",
   :direction "ltr"},
  :updated 1576249200000,
  :alternate
  [{:href "https://clojuredesign.club/episode/059-lining-it-up/",
    :type "text/html"}],
  :title "Ep 059: Lining It Up",
  :author "Christoph Neumann and Nate Jones",
  :published-str "Fri Dec 13 07:00:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16f01918803:5ec41c:69b9f616",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://clojuredesign.club/episode/059-lining-it-up/",
  :commonTopics
  [{:score 48.543993907515336,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1576249200000,
  :fingerprint "cb5df84a",
  :canonicalUrl "https://clojuredesign.club/episode/059-lining-it-up/"}
 {:engagement 5,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1576229427678,
  :content
  {:content
   "<div><p><em>This post is part of <a shape=\"rect\" href=\"https://lambdaisland.com/blog/2019-11-25-advent-of-parens\">Advent of Parens\n2019</a>, my attempt to\npublish one blog post a day during the 24 days of the advent.</em></p><p>When I started consulting for <a shape=\"rect\" href=\"https://nextjournal.com/\">Nextjournal</a> I helped\nthem out a lot with tooling and testing. Their data model is fairly complex,\nwhich made it hard to do setup in tests. I created a factory based approach for\nthem, which has served the team well ever since.</p><p>First some preliminaries. At Nextjournal we’re big fans of Datomic, and so\nnaturally we have a Datomic connection as part of the Integrant system map.</p><pre><code>{:com.nextjournal.journal.system/datomic-conn\n #profile\n {:default {:uri #or[#env JOURNAL_DATOMIC_URI &quot;datomic:mem://nextjournal_dev&quot;]}\n  :prod    {:uri #or[#env JOURNAL_DATOMIC_URI #secret &quot;journal/datomic/uri&quot;]\n            :com.nextjournal.journal.system.vault/service #integrant/ref[:com.nextjournal.journal.system.vault/service]}\n  :test    {:uri        &quot;datomic:mem://nextjournal_test&quot;\n            :delete-db? true}}}\n</code></pre><p>For testing we use a dynamic var <code>*test-system*</code>. You could just set up a system\nand pass it around, but in this case a dynamic var is really convenient, since\nthis allows you to set it up in a fixture, and test helper functions can access\nthe system directly.</p><pre><code>(ns ns com.nextjournal.journal.test-system)\n\n(def ^:dynamic *test-system*)\n\n;; REPL use only\n(defn start! [] ,,,)\n(defn stop! [] ,,,)\n\n(defn wrap-system [test]\n  (binding [*test-system* (ig/init! config)]\n    (try\n      (test)\n      (finally\n        (ig/halt! *test-system*)))))\n\n;; in a test namespace:\n;; (use-fixtures :each test-system/wrap-system)\n</code></pre><p>With that we can make helpers to quickly get the Datomic connection, get a\ndatabase value, or do a query. This already takes a lot of clutter out of tests.</p><pre><code>(defn conn []\n  (:com.nextjournal.journal.system/datomic-conn *test-system*))\n\n(defn db []\n  (datomic/db (conn)))\n\n(defn q [query &amp; args]\n  (apply datomic/q query (db) args))\n</code></pre><p>To get test data into the database we have this handy <code>transact!</code> utility. It\ntransacts whatever transaction data you give it, and returns a map with resolved\ntemp-ids. If it finds any temp-ids that end in <code>&quot;-id&quot;</code>, then it will also return\na <code>(datomic/entity ,,,)</code> for that id.</p><pre><code>(defn transact*!\n  &quot;Like `transact!` but takes the connection explicitly&quot;\n  [conn &amp; tx-datas]\n  (let [tx-data  (vec (mapcat #(if (map? %) [%] %) tx-datas))\n        report   @(datomic/transact conn tx-data)\n        db-after (:db-after report)\n        tempids  (:tempids report)\n        ids      (into {} (keep (fn [{id :db/id}]\n                                  (when (string? id)\n                                    [(keyword id)\n                                     (datomic/resolve-tempid db-after tempids id)]))\n                                tx-data))]\n    (reduce-kv (fn [ids kid id]\n                 (let [kidn (name kid)]\n                   (if (str/ends-with? kidn &quot;-id&quot;)\n                     (let [k (keyword (str/replace kidn #&quot;-id$&quot; &quot;&quot;))\n                           e (datomic/entity db-after id)]\n                       (assoc ids k e))\n                     ids)))\n               ids\n               ids)))\n\n(defn transact!\n  &quot;Transact data and resolve temp-ids.\n\n  Calls datomic/transact on the current connection in *system*, and :db/id in\n  the input that are strings are resolved as tempids, keywordified, and returned\n  as a map. On top of that any keys ending in \\&quot;-id\\&quot; are also resolved as\n  entities, dropping the -id suffix.\n\n  Each argument can be either a map or a vector of maps.\n\n  See also: defactory.\n  &quot;\n  [&amp; tx-datas]\n  (apply transact*! (conn) tx-datas))\n</code></pre><p>So for example say I’m creating an article and a person entity for use in my test, this will look something like this.</p><pre><code>(let [{:keys [article article-id\n              person person-id]}\n      (transact! {:db/id &quot;article-id&quot; :article/change 1234}\n                 {:db/id &quot;person-id&quot; :person/email &quot;foo@bar.com&quot;})]\n  article    ;;=> {:db/id 158953 ,,,}\n  article-id ;;=> 158953\n  person     ;;=> {:db/id 158954 ,,,}\n  article-id ;;=> 158954\n\n  )\n</code></pre><p>I can destructure whatever I need out of that. Most of the time it’s most\nconvenient to work with the entity maps, but if you need the ids instead to pass\non to another function then you can access those directly.</p><p>With all of that set up it’s time for the grand finale: <code>defactory</code>!</p><pre><code>(defmacro defactory\n  &quot;Define a datomic factory helper. This should look like a function which takes a\n  single argument (an options map), and returns datomic transaction data, either\n  a single map or a vector of maps.\n\n  Use strings for temp-ids if possible.\n\n  This will create a regular function that just returns that data, but also a\n  method ending in a bang which will transact the tx-data against the\n  *test-system*, and return a map of resolved temp-ids.&quot;\n  [name &amp; [a1 a2 &amp; rst :as args]]\n  (let [[docstring arglist body]\n        (if (string? a1)\n          [a1 a2 rst]\n          [&quot;Factory function&quot; a1 (next args)])]\n    `(do\n       (defn ~name ~docstring [&amp; ~arglist]\n         (let [res# ~@body]\n           (if (map? res#)\n             [(dissoc res# :suffix)]\n             (mapv #(dissoc % :suffix) res#))))\n\n       (defn ~(symbol (str name &quot;!&quot;)) ~docstring\n         [&amp; [opts#]]\n         (let [conn# (:datomic/conn opts# (conn))\n               opts# (dissoc opts# :datomic/conn)]\n           (transact*! conn# (~name opts#)))))))\n</code></pre><p>This is already a hairy macro, I guess you don’t always want to see how the\nsausage gets made, but in usage it’s really nice.</p><pre><code>(ns com.nextjournal.journal.test-factories)\n\n(defactory profile\n  &quot;Creates a profile entity with random handle. Options are merged in directly.\n  Provides a \\&quot;profile-id\\&quot; tempid.&quot;\n  [opts]\n  (merge #:profile\n         {:db/id  &quot;profile-id&quot;\n          :handle (rand-username)\n          :name   &quot;Jonny Zimmerman&quot;}\n         opts))\n\n(defactory person\n  &quot;Creates a person entity. Options are merged in directly. The\n  `:person/password` key is treated special, it is converted to a password\n  digest and stored as such. Expects a \\&quot;profile-id\\&quot; temp-id in the same\n  transaction.\n  Provides a \\&quot;person-id\\&quot; tempid.&quot;\n  [opts]\n  (merge #:person\n         {:db/id   &quot;person-id&quot;\n          :profile &quot;profile-id&quot;\n          :email   (rand-email)}\n         (cond-> opts\n           (:person/password opts)\n           (-> (dissoc :person/password)\n               (assoc :person/password-digest\n                 (password/encrypt (:person/password opts)))))))\n</code></pre><p>This has created four functions: <code>profile</code>, <code>profile!</code>, <code>person</code>, and <code>person!</code>.\nThe versions without a bang just return transaction data.</p><pre><code>(profile)\n;;=> {:db/id &quot;person-id&quot;, :profile/handle &quot;jonny7&quot;, :profile/name &quot;Jonny Zimmerman&quot;}\n\n(profile {:profile/name &quot;Arne Brasseur&quot; :profile/website &quot;https://lambdaisland.com&quot;})\n;;=> {:db/id &quot;person-id&quot;, :profile/handle &quot;jonny7&quot;, :profile/name &quot;Arne Brasseur&quot; :profile/website &quot;https://lambdaisland.com&quot;}\n\n(let [{:keys [person]} (transact! (person) (profile))]\n  (-> person :person/profile :profile/handle) ;;=> &quot;marcus123&quot;\n  )\n</code></pre><p>The version with a bang immediately call <code>transact!</code>.</p><pre><code>(let [{:keys [profile]} (profile!)]\n  (profile :profile/handle) ;;=> &quot;marcus123&quot;\n  )\n</code></pre><p>We have a bit more logic in the factories to make it easy to create multiple\nentities of the same type in a single transaction, in that case they will get\ntemp-ids like <code>article-1-id</code>, so you can destructure them as <code>{:keys [article-1\narticle-2]}</code>.</p><p>Is this API perfect? Far from it, there are definitely some things I would\nreconsider if I did a second iteration of this. It’s also not the kind of code I\nwould write for regular, non-test use. It already starts to smell a little of\n“magic”, the kind that as a recovering Rubyist I have learned to avoid. Pulling\nup database connections from behind the covers, checking for the type of\narguments to have a more flexible interface, transacting things\n“automatically”… these are things Clojure has taught me to avoid, generally.</p><p>But in this case the magic does serve a higher purpose, it is taking the\nfriction out of writing unit tests, and anything that helps and encourages\npeople to test their code is a win in my book. And because it takes a lot of\nclutter and boilerplate out of the tests they start to better convey intention.\nBesides being there to test stuff tests also act as a form of documentation.\nThey show examples of how APIs can be used, and in the case of a failure they\npoint at the scenario that is causing trouble. So all in all we think these\nfactories are a win.</p><p><em>Hi, my name is Arne (aka @plexus) and I consult companies and teams about\napplication architecture, development process, tooling and testing. I\ncollaborate with other talented people under the banner\n<a shape=\"rect\" href=\"http://gaiwan.co\">Gaiwan</a>. If you like to have a chat about how we could help\nyou with your project then please <a shape=\"rect\" href=\"https://lambdaisland.com/p/contact\">get in touch!</a></em></p></div>",
   :direction "ltr"},
  :updated 1576228403000,
  :alternate
  [{:href
    "https://lambdaisland.com/blog/2019-12-13-advent-of-parens-13-datomic-test-factories",
    :type "text/html"}],
  :title "Advent 2019 part 13, Datomic Test Factories",
  :author "Arne Brasseur",
  :published-str "Fri Dec 13 01:13:23 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16efe9859de:19d40d:49b12733",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://lambdaisland.com/blog/2019-12-13-advent-of-parens-13-datomic-test-factories",
  :commonTopics
  [{:score 27.826100540688184,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.964,
    :id "nlp/f/topic/1430",
    :salienceLevel "about",
    :label "medical devices"}
   {:score 0.899,
    :id "nlp/f/topic/2148",
    :salienceLevel "about",
    :label "spiritual"}],
  :published 1576228403000,
  :fingerprint "9be71f2c",
  :canonicalUrl
  "https://lambdaisland.com/blog/2019-12-13-advent-of-parens-13-datomic-test-factories"}
 {:engagement 5,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/todo",
    :label "todo"}
   {:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1576173899795,
  :recrawled 1576410955401,
  :content
  {:content
   "<p>I’m taking a break to retool for Season 3, which will start in the new year. I also give an update on Grokking Simplicity. I am working on Chapter 7.</p>\n<p></p>\n<div>\n<div><span></span><img alt=\"Video Thumbnail\" src=\"https://i.ytimg.com/vi/NiaNuJlQxu8/mqdefault.jpg\"><p></p>\n<h5>Year-end update 2019</h5>\n<p><span>I'm taking a break to retool for Season 3, which will start in the new year. I also give an update on Grokking Simplicity. I am working on Chapter 7. https://share.transistor.fm/e/109d10f9 https://www.youtube.com/watch?v=NiaNuJlQxu8 Transcript Eric Normand: Hello, folks. I just wanted to let you kno</span></p></div>\n</div>\n<h2>Transcript</h2>\n<p>Eric Normand: Hello, folks. I just wanted to let you know that I am taking a break from this podcast. I am not recording. I’m deep in the back end working on season three. I’m retooling, planning, figuring out what this podcast is going to turn into in the New Year.</p>\n<p>Please stay subscribed if you’re interested in learning about that. Otherwise, just hang on because it’s coming. I want to give an update on the book. Chapter five just came out last week. Chapter five is all about…It’s called “Improving the Design of Actions.”</p>\n<p>The thing that this chapter is emphasizing is that people say that functional programming is about pure functions, programming with pure functions, but that sells it short because functional programmers have a lot to say about actions.</p>\n<p>We’ve identified them. We know what dangers lurk inside. We know how to work with them a lot better. We’ve developed tools. As an example, we would talk about whether you have a transactional state. If you have mutable state, is it transactional? What are the characteristics of it?</p>\n<p>We do that a lot more than object-oriented programmers. I would say. We have a lot of tools. Because you can’t get rid of actions, you should at least have them somewhat well-designed. The idea behind chapter five is that…In chapter four, we extract calculations from actions. You do that by identifying the inputs and outputs to the function.</p>\n<p>What are all the things that this function uses to produce an answer? What are all the answers it produces? A pure function, calculation will only have arguments and return values as its inputs and outputs. I’m calling those the explicit inputs and outputs. That’s thanks to Chris Jenkins for this idea.</p>\n<p>Then there’s all these implicit and explicit ones that exist in actions. If you just replace all the implicit ones with explicit ones, then you’ve got a calculation. Another thing we do is even if we can’t get rid of that last explicit input or that last explicit output having fewer or, sorry, implicit.</p>\n<p>I said explicit. We can’t get rid of last implicit input. Having fewer implicit inputs is still better. It doesn’t cross the line into calculation. If you have an action that only has one implicit input, it’s better than an action with two that does the same thing. That is the idea in chapter five.</p>\n<p>We go through. We have the code examples. We systematically look for implicit inputs and output and try to reduce them. The code is getting more and more functional as we go along. Little secret, this is an exclusive. Don’t tell anyone. The chapter six is already written. It’s ready.</p>\n<p>There’s a schedule. The publisher has a schedule for when chapters go out. At some point, they’re going to decide I don’t have any. I have no idea how it works. I have some ideas, but it’s the kind of thing where some people are like, “Hmm, I think it’s about time.”</p>\n<p>I don’t know what’s going on in there, but chapter five just came out. Chapter six is ready to go out when Manning, the publisher, decides. Chapter six is all about immutable data. We go through in great depth how to do copy on read and copy on write. It’s a good chapter.</p>\n<p>It talks a lot about why this is important and when to use each one. Now, I’m working on chapter seven. This one is tough because it’s more of a design chapter. It’s the last chapter in part one. When I’ve finished this one, the whole first part will be done, the first third of the book.</p>\n<p>I’m excited about that, but I just want to tell you chapter seven is about stratified design. It’s all about looking for layers of meaning in your code and if the layer structure doesn’t look very neat and organized, how to go in there and manipulate it so that it is neat and organized.</p>\n<p>It’s designed in the sense of…One thing that we have to deal with, since we don’t write programs once and never touch them again — we maintain them for the life of the business — you need to arrange things so that the things that will change frequently, because you’re experimenting, you’re learning how does free shipping work, you want to be able to change those things.</p>\n<p>You want those to be easy to change. Then some things, you want to say, “OK. This is good. It’s done. Let’s make it so that we don’t have to change it so much.” You’re going to have stuff like that other stuff is built on top of. How do you arrange that? It’s all about the call graph. What functions call? What functions? You just draw that all out.</p>\n<p>The stuff at the top, the stuff that nothing calls, the very top, since nothing relies on it, can change very easily, very cheaply. You can just rewrite it. You don’t even have to have the same contracts and stuff because nothing calls it.</p>\n<p>Now, this stuff at the bottom can’t change that easily because all this other code is built on top of it. If you change it, even if there’s a possibility of introducing a bug — maybe there’s some contract that you’re now violating — it just might be a bug. You just made a mistake.</p>\n<p>All of that has consequences. That stuff should be harder to change. Now, you have this nice stratification of going from easy to change at the top to hard to change at the bottom. You can choose where things go, which is great for maintenance.</p>\n<p>The other thing we talk about testing, where would you want to spend your testing budget if you have a limited budget? Of course, you could say yes. I want to test everything, but come on. What do you test first?</p>\n<p>If you have all this code, what’s the best bang for your buck? The tree kind of guides you there. The answer is at the bottom of the tree, because so much stuff relies on it. You want that to be more robust.</p>\n<p>Your tests aren’t going to change. They’re going to change just as frequently as the stuff at the bottom. When you write that test, it’s going to last a long time. Whereas if you write tests for stuff at the top, the advantage of writing tests for the stuff at the top is you are testing a lot more code.</p>\n<p>You are exercising a lot more code because the stuff at the top is calling stuff below it which is calling stuff below it. It’s exercising more code, but it’s also going to change more frequently. You spent two hours writing that test. Now you’re going to have to change the test too. It’s probably better to focus on the bottom of the tree.</p>\n<p>Then reuse. The stuff at the bottom it’s just more reusable. It’s already being used multiple times. The stuff at the top is not being used. Again, stuff at the bottom, it’s more reusable. It can be used more easily by other systems that weren’t anticipated.</p>\n<p>That’s what I’m working on now. It’s all about cleaning up your code, making it more organized, designing your system so that that works. It’s a preview of things to come. Every part, all three parts have a design chapter at the end.</p>\n<p>Part two ends with the onion architecture. Then the part three ends with reactive design, reactive architecture. This chapter is setting up a lot of things that will be useful later. The whole of part three is about domain modeling and data modeling and stuff.</p>\n<p>We’re going to get to that idea of, “How do you build this stuff that’s at the bottom?” The stuff at the bottom is usually your domain model. How do you design that? This chapter is not about, “OK, let’s get in there and make some domain model that’s going to last a long time.”</p>\n<p>It’s mostly just about, “Let’s move the code we have up and down this tree so that it has all the characteristics we want, maintainability, reuse, that kind of thing.” That was just a little update. Just a reminder, the podcast is going to go on hiatus until the New Year.</p>\n<p>Just so you know, it’s me planning, diving deep, figuring out what this podcast could be. Every year, I seem to go into a cocoon and emerge as a new butterfly.</p>\n<p>Awesome. My name is Eric Normand. This has been a thought on functional programming. Thank you for listening and rock on.</p>\n<p>The post <a rel=\"nofollow\" href=\"https://lispcast.com/year-end-update-2019/\">Year-end update 2019</a> appeared first on <a rel=\"nofollow\" href=\"https://lispcast.com\">LispCast</a>.</p>",
   :direction "ltr"},
  :updated 1576152000000,
  :alternate
  [{:href "https://lispcast.com/year-end-update-2019/",
    :type "text/html"}],
  :title "Year-end update 2019",
  :author "Eric Normand",
  :published-str "Thu Dec 12 04:00:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16efb491013:13778d2:69b9f616",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url "https://i.ytimg.com/vi/NiaNuJlQxu8/mqdefault.jpg",
   :width 320,
   :height 180,
   :contentType "image/jpeg"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://lispcast.com/year-end-update-2019/",
  :updateCount 2,
  :commonTopics
  [{:score 23.771159299708977,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1576152000000,
  :fingerprint "13777e88",
  :canonicalUrl "https://lispcast.com/year-end-update-2019/"}
 {:engagement 6,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1576152929412,
  :content
  {:content
   "<div><p><em>This post is part of <a shape=\"rect\" href=\"https://lambdaisland.com/blog/2019-11-25-advent-of-parens\">Advent of Parens\n2019</a>, my attempt to\npublish one blog post a day during the 24 days of the advent.</em></p><p>I’m a strong believer in pair programming. It can be intense and exhausting, and\nits a skill you need to learn and get good at, but it’s extremely valuable. It\nimproves knowledge sharing, prevents mistakes, and helps people to stay on track\nto make sure they are building the right thing, which is arguably one of the\nhardest aspects of our job.</p><p>But <a shape=\"rect\" href=\"http://gaiwan.co\">Gaiwan</a> is a remote-first company. We are spread out\nacross Germany, Brazil, Italy, and work with clients as far away as Singapore\nand Hong Kong, so we need good ways to pair remotely. For this we need a tool\nthat is</p><ul><li>cross platform, at least across Linux and mac, this rules out most of the\nnewer tools that try to solve this problem</li><li>symetrical, the experience should be the same for both participants, this\nrules out simple screen sharing, as well as most desktop sharing or VNC style\ntools</li><li>responsive, nothing is worse than a laggy editor</li></ul><p>This may seem like an impossible set of requirements, but sometimes all you need\nto do is change your perspective, and instead of looking at the shiniest new\ndevelopments, look at the classics. Unix once again comes to our rescue!</p><p>What we do nowadays is spin up a linux machine in the cloud, both participants\nssh into that, and then we use <code>tmux</code> to share the screen. This means you have\nto use a terminal based editor. For this we use Spacemacs in hybrid mode. This\nallows quickly switching between Emacs-style and vim-style keybindings, which is\na good compromise.</p><p>We have most of the setup automated, including pulling SSH keys off of Github so\npeople can immediately log in, and setting up the tools and dependencies we use.\nFinally we use <code>ngrok</code> to set up a HTTP tunnel so you can still access the app\nyou’re working on in your own browser.</p><p>This you then combine with whatever audio/video solution you prefer. We tend to\nuse <a shape=\"rect\" href=\"https://whereby.com\">Whereby</a> (previously Appear.in).</p><p>This works really well because it’s literally just a bunch of characters going\nover the wire, rather than complete video frames. It also means you can still\ncopy/paste into and out of your terminal/editor, which is a nice plus.</p><p>At Clojure/Conj this year I talked to some folks from\n<a shape=\"rect\" href=\"https://www.viasat.com/\">Viasat</a> about this approach, and turns out they do\nalmost the exact same thing, which was very validating. One nice touch is that\nthey equip everyone with a hardware SIP speaker phone, to get the lowest latency\nand highest fidelity audio. That’s definitely something we will consider as\nwell.</p><p><em>Hi, my name is Arne (aka @plexus) and I consult companies and teams about\napplication architecture, development process, tooling and testing. I\ncollaborate with other talented people under the banner\n<a shape=\"rect\" href=\"http://gaiwan.co\">Gaiwan</a>. If you like to have a chat about how we could help\nyou with your project then please <a shape=\"rect\" href=\"https://lambdaisland.com/p/contact\">get in touch!</a></em></p><p><strong><a shape=\"rect\" href=\"https://clojureverse.org/t/advent-of-parens-2019/5159\">Comment on ClojureVerse</a></strong></p></div>",
   :direction "ltr"},
  :updated 1576150851000,
  :alternate
  [{:href
    "https://lambdaisland.com/blog/2019-12-12-advent-of-parens-12-pairing-cloud-tmux",
    :type "text/html"}],
  :title "Advent 2019 part 12, Pairing in the Cloud with Tmux",
  :author "Arne Brasseur",
  :published-str "Thu Dec 12 03:40:51 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16efa091484:114e471:97b0c8f7",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://lambdaisland.com/blog/2019-12-12-advent-of-parens-12-pairing-cloud-tmux",
  :commonTopics
  [{:score 0.494,
    :id "nlp/f/topic/10200",
    :salienceLevel "about",
    :label "tutorial"}
   {:score 45.895671548924014,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1576150851000,
  :fingerprint "f57891db",
  :canonicalUrl
  "https://lambdaisland.com/blog/2019-12-12-advent-of-parens-12-pairing-cloud-tmux"}
 {:engagement 5,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1576146227550,
  :content
  {:content
   "<p><em>This article is part of the <a href=\"http://metaredux.com/posts/2019/12/01/meta-advent-2019.html\">“Meta Advent 2019”</a> series. I’ve committed to writing\na new blog post here every day until Christmas.</em></p>\n<p>Yesterday someone asked on the Clojurians Slack if you could configure CIDER to\ndisplay interactive evaluation results (results originating from source buffers most of the time)\nonly in overlays (inline), as by default they are displayed both in the Emacs minibuffer and inline.\nWell, I’ve often said that in CIDER almost everything is configurable and so is this:</p>\n<div><div><pre><code><span>(</span><span>setq</span> <span>cider-use-overlays</span> <span>t</span><span>)</span>\n</code></pre></div></div>\n<p>The default value of this configuration variable is <code>'both</code>. You can also easily disable the inline results\nby setting it to <code>nil</code>.<sup><a href=\"http://metaredux.com/2019/12/12/hard-cider-customizing-the-evaluation-results.html#fn:1\">1</a></sup></p>\n<p>But wait, there’s more! Did you know that a few other aspects of interactive evaluation results are configurable?\nFor instance, you can control whether results are font-locked (syntax highlighted) as Clojure code or not with the configuration\nvariables <code>cider-result-use-clojure-font-lock</code> (for the minibuffer) and <code>cider-overlays-use-font-lock</code> (for inline results).\nBoth are enabled by default. If you opt to disable Clojure font-locking for inline results they will the <code>cider-result-overlay-face</code>\ninstead. This might make it easier for you discern your results from the result of your code.</p>\n<p>Inline results are normally displayed at the end of the current line, but you can also display them at point:<sup><a href=\"http://metaredux.com/2019/12/12/hard-cider-customizing-the-evaluation-results.html#fn:2\">2</a></sup></p>\n<div><div><pre><code><span>(</span><span>setq</span> <span>cider-result-overlay-position</span> <span>'at-point</span><span>)</span>\n</code></pre></div></div>\n<p>You can control the prefix used with results:</p>\n<div><div><pre><code><span>(</span><span>setq</span> <span>cider-eval-result-prefix</span> <span>&quot;--> &quot;</span><span>)</span> <span>; it's => by default</span>\n\n<span>;; or you can remove it completely</span>\n<span>(</span><span>setq</span> <span>cider-eval-result-prefix</span> <span>&quot;&quot;</span><span>)</span>\n</code></pre></div></div>\n<p>Historically tools like SLIME didn’t use any prefix before the results, but I’ve tweaked this as it seemed more in\nline with what most other tools are doing.</p>\n<p>Another thing that you can control is when inline results would disappear. Normally this happens after your next action<sup><a href=\"http://metaredux.com/2019/12/12/hard-cider-customizing-the-evaluation-results.html#fn:3\">3</a></sup>, but you can\nkeep them around for some time limit (in seconds):</p>\n<div><div><pre><code><span>;; keep inline results around for 5 seconds</span>\n<span>(</span><span>setq</span> <span>cider-eval-result-duration</span> <span>5</span><span>)</span>\n\n<span>;; or forever</span>\n<span>(</span><span>setq</span> <span>cider-eval-result-duration</span> <span>nil</span><span>)</span>\n</code></pre></div></div>\n<p>Crazy, right? Who needs so many configuration options? Well, you know how I keep repeating that Emacs is all about\nmaking it your own and customizing to your way of work and your preferences. CIDER just embraces the Emacs\nphilosophy to the limit.</p>\n<p>I agree that many of those configuration options are somewhat confusingly named and therefore a bit hard to find.<sup><a href=\"http://metaredux.com/2019/12/12/hard-cider-customizing-the-evaluation-results.html#fn:4\">4</a></sup>\nThis is something that we’ll have to address down the road. Some of them are documented in the manual, but we can\ncertainly do better.</p>\n<p>That’s all I have for you today! See you tomorrow!</p>\n<div>\n<ol>\n<li>\n<p>This used to be the original behaviour in CIDER, because we introduced the concept of inline results a few years ago. <a href=\"http://metaredux.com/2019/12/12/hard-cider-customizing-the-evaluation-results.html#fnref:1\">↩</a></p>\n</li>\n<li>\n<p>This was introduced in CIDER 0.23. <a href=\"http://metaredux.com/2019/12/12/hard-cider-customizing-the-evaluation-results.html#fnref:2\">↩</a></p>\n</li>\n<li>\n<p>Technically speaking, after you invoke another Emacs interactive command. <a href=\"http://metaredux.com/2019/12/12/hard-cider-customizing-the-evaluation-results.html#fnref:3\">↩</a></p>\n</li>\n<li>\n<p>Especially for people not familiar with Emacs terminology. <a href=\"http://metaredux.com/2019/12/12/hard-cider-customizing-the-evaluation-results.html#fnref:4\">↩</a></p>\n</li>\n</ol>\n</div>",
   :direction "ltr"},
  :updated 1576145460000,
  :alternate
  [{:href
    "http://metaredux.com/2019/12/12/hard-cider-customizing-the-evaluation-results.html",
    :type "text/html"}],
  :title "Hard CIDER: Customizing the Evaluation Results",
  :author "Bozhidar Batsov",
  :published-str "Thu Dec 12 02:11:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16ef9a2d15e:10fb1ae:69b9f616",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "http://metaredux.com/2019/12/12/hard-cider-customizing-the-evaluation-results",
  :commonTopics
  [{:score 21.96613672444485,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1576145460000,
  :fingerprint "bc6943f4",
  :canonicalUrl
  "http://metaredux.com/2019/12/12/hard-cider-customizing-the-evaluation-results.html"}
 {:engagement 7,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1576065852683,
  :content
  {:content
   "<p><em>This article is part of the <a href=\"http://metaredux.com/posts/2019/12/01/meta-advent-2019.html\">“Meta Advent 2019”</a> series. I’ve committed to writing\na new blog post here every day until Christmas.</em></p>\n<p>The <a href=\"http://metaredux.com/posts/2019/11/02/state-of-cider.html\">State of CIDER survey</a> was super insightful for me on many levels.\nHere’s one example - I realized that users might have missed some recent developments. A few people had commented it’d be\nnice if CIDER had a build-in “find usages (references)” functionality and funny enough - it already has this.</p>\n<p>The functionality is based on <a href=\"http://metaredux.com/posts/2019/05/04/discovering-runtime-function-references-in-clojure.html\">ideas I’ve shared in the past</a> and was\nintroduced in CIDER 0.22. I guess for the majority of people the most interesting commands\nwould be <code>cider-xref-fn-refs</code> (<code>C-c C-? r</code>) and <code>cider-xref-fn-refs-select</code>\n(<code>C-c C-? C-r</code>).<sup><a href=\"http://metaredux.com/posts/2019/12/11/hard-cider-find-usages.html#fn:1\">1</a></sup> The first command will show the usages of the function at point in a dedicated buffer\nand the second will show them in the minibuffer.<sup><a href=\"http://metaredux.com/posts/2019/12/11/hard-cider-find-usages.html#fn:2\">2</a></sup> Here’s how they look in action:</p>\n<p><img alt=\"cider_find_usages.gif\" src=\"http://metaredux.com/assets/images/cider_find_usages.gif\"></p>\n<p>Keep in mind the following limitations:</p>\n<ul>\n<li>This works only for Clojure</li>\n<li>It’s powered by runtime state analysis, which means it will show only data for loaded namespaces</li>\n<li>It doesn’t (currently) find usages in lambdas</li>\n<li>It doesn’t give us the precise locations where something is used, we only know that it’s used</li>\n</ul>\n<p>On the bright side:</p>\n<ul>\n<li>It’s super fast</li>\n<li>It doesn’t require any static code analysis</li>\n<li>It’s still more reliable than <code>grep</code></li>\n</ul>\n<p>The functionality is not perfect, but at least it’s there if you need it. As a bonus you get a quick way to navigate to\nall of the functions used by some function using <code>cider-xref-fn-deps</code> (<code>C-c C-? d</code>) and <code>cider-xref-fn-deps-select</code> (<code>C-c C-? C-d</code>).\nThose are pretty handy if you don’t want to jump to the source of some function to see what it refers to internally.</p>\n<p>Don’t forget you also have a couple of third-party alternative:</p>\n<ul>\n<li>The much more sophisticated AST-powered “find usages” provided by <code>clj-refactor.el</code></li>\n<li><a href=\"https://github.com/bbatsov/projectile\">Projectile</a>’s “grep in project” (<code>projectile-grep</code>, typically bound to <code>C-c p g</code>)</li>\n</ul>\n<p>That’s all I have for you today! See you tomorrow!</p>\n<div>\n<ol>\n<li>\n<p>I know those keybindings kind of suck because of <code>C-?</code>, but we ran out of good keybinding options a while ago. <a href=\"http://metaredux.com/posts/2019/12/11/hard-cider-find-usages.html#fnref:1\">↩</a></p>\n</li>\n<li>\n<p>If you’re familiar with <code>cider-apropos</code> you’ll notice the UI is very similar. <a href=\"http://metaredux.com/posts/2019/12/11/hard-cider-find-usages.html#fnref:2\">↩</a></p>\n</li>\n</ol>\n</div>",
   :direction "ltr"},
  :updated 1576062000000,
  :entities
  [{:mentions [{:text "The first command"}],
    :id "nlp/f/entity/wd:407064",
    :salienceLevel "mention",
    :label "Air Education and Training Command"}],
  :alternate
  [{:href
    "http://metaredux.com/posts/2019/12/11/hard-cider-find-usages.html",
    :type "text/html"}],
  :title "Hard CIDER: Find Usages",
  :author "Bozhidar Batsov",
  :published-str "Wed Dec 11 03:00:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16ef4d8650b:a588dd:69b9f616",
  :visual {:url "none"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "http://metaredux.com/posts/2019/12/11/hard-cider-find-usages",
  :published 1576062000000,
  :fingerprint "39a0a58a",
  :canonicalUrl
  "http://metaredux.com/posts/2019/12/11/hard-cider-find-usages.html"}
 {:engagement 6,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1576059598841,
  :content
  {:content
   "<div><p><em>This post is part of <a shape=\"rect\" href=\"https://lambdaisland.com/blog/2019-11-25-advent-of-parens\">Advent of Parens\n2019</a>, my attempt to\npublish one blog post a day during the 24 days of the advent.</em></p><p>I’ve been a fan of <a shape=\"rect\" href=\"https://github.com/weavejester/integrant\">Integrant</a> pretty\nmuch ever since it came out. For me there is still nothing that can rival it.</p><p>The recently released <a shape=\"rect\" href=\"https://github.com/juxt/clip\">clip</a> by the folks from\nJuxt does deserve an honorable mention. It has an interesting alternative\napproach which some may prefer, but it does not resonate with me. I prefer my\nsystem configuration to be just data, rather than code wrapped in data.</p><p>However there’s another Juxt library that I do use on pretty much any project\nthese days, and that combines wonderfully with Integrant:\n<a shape=\"rect\" href=\"https://github.com/juxt/aero\">Aero</a>. Aero is basically just an EDN reader, but\nit provides half a dozen reader tags that make it ideal for system\nconfiguration, and so it pairs with Integrant like camembert with Bordeaux.</p><p>Aero provides things like <code>#env MY_ENV_VAR</code>, <code>#include &quot;my_other_file.edn&quot;</code>, or\n<code>#profile {:prod 80 :dev 8080}</code>.</p><p>So the first thing I’ll do on a project is usually to set up <code>integrant</code>,\n<code>integrant-repl</code>, and <code>aero</code>. Let’s see what that looks like.</p><p>The starting point for using Integrant is your configuration map, which goes in\na file named <code>resources/app_name/system.edn</code>. So if your main namespace is\n<code>feralberry.core</code>, then this goes into <code>resources/feralberry/system.edn</code>. This\nway it can be found on the classpath, and bundled into a jar, without\npotentially clashing with other files on the classpath.</p><p>For instance:</p><pre><code>{:feralberry.http/router {:routes [[&quot;/&quot; {:get {:interceptors :index}}]]}\n\n :feralberry.http/server {:port   2533\n                          :router #ig/ref :feralberry.http/router}\n\n :feralberry.storage/crux {:crux.node/topology           :crux.kafka/topology\n                           :crux.node/kv-store           crux.kv.rocksdb/kv\n                           :crux.kv/db-dir               &quot;data/db-dir-1&quot;\n                           :crux.kafka/bootstrap-servers &quot;localhost:9092&quot;}}\n</code></pre><p>Next we need a way to read this configuration:</p><pre><code>(ns feralberry.system\n  (:require [aero.core :as aero]\n            [clojure.java.io :as io]\n            [integrant.core :as ig]))\n\n(defmethod aero/reader 'ig/ref\n  [_ tag value]\n  (ig/ref value))\n\n(defn config [profile]\n  (aero/read-config (io/resource &quot;feralberry/system.edn&quot;) {:profile profile}))\n  \n(defn prep [profile]\n  (let [config (config profile)]\n    (ig/load-namespaces config)\n    config))\n</code></pre><p>Here I define an extra reader tag for Integrant references, and a helper to read\nin the configuration for a given profile (like <code>:dev</code>, <code>:prod</code>, <code>:test</code>).\nFinally I add a helper function <code>prep</code> which tries to load any namespaces\nreferenced in the configuration map, and then returns the configuration.</p><p>Next we need a way to start the system from the REPL, this is done in the <code>user</code>\nnamespace, since this gets loaded automatically during development, so these\nfunctions are immediately available after booting up.</p><pre><code>(ns user)\n\n(defmacro jit\n  &quot;Just in time loading of dependencies.&quot;\n  [sym]\n  `(requiring-resolve '~sym))\n\n(defn set-prep! []\n  ((jit integrant.repl/set-prep!) ((jit feralberry.system/prep) :dev)))\n\n(defn go []\n  (set-prep!)\n  ((jit integrant.repl/go)))\n\n(defn reset []\n  (set-prep!)\n  ((jit integrant.repl/reset)))\n\n(defn system []\n  @(jit integrant.repl.state/system))\n\n(defn config []\n  @(jit integrant.repl.state/config))\n</code></pre><p>This code looks a bit weird because of the <code>jit</code> thing. The reason I do this is\nI don’t like having any <code>:require</code> in my <code>user</code> ns, since it slows down the TTR\n(Time To REPL), so I only load stuff on demand. I also added two helpers to\neasily inspect the system and the current configuration from the REPL.</p><p>So now I have a nice reloaded workflow. Just <code>(go)</code> after booting the REPL, or\n<code>(reset)</code> to reload namespaces and restart.</p><p>With that the boilerplate is out of the way and I can start implementing my\nsystem components, for instance:</p><pre><code>(ns feralberry.storage\n  (:require [integrant.core :as ig]\n            [crux.api :as crux]))\n\n(defmethod ig/init-key ::crux [_ config]\n  (crux/start-node config))\n\n(defmethod ig/halt-key! ::crux [_ crux]\n  (.close crux))\n</code></pre><p>Note that I don’t need to explicitly require this namespace, it will get loaded\nby integrant based on the configuration key <code>:feralberry.storage/crux</code>.\nAlternatively I could have put these methods in a <code>feralberry.storage.crux</code>\nnamespace, that would have worked as well.</p><p>Since Integrant is simply a library it isn’t always clear to people how to use\nit in practice. I hope this post was helpful in showing at least one\npattern/convention for setting things up.</p><p><em>Hi, my name is Arne (aka @plexus) and I consult companies and teams about application\narchitecture, development process, tooling and testing. I collaborate with other\ntalented people under the banner <a shape=\"rect\" href=\"http://gaiwan.co\">Gaiwan</a>. If you like to have\na chat about how we could help you with your project then please <a shape=\"rect\" href=\"https://lambdaisland.com/p/contact\">get in touch!</a></em></p><p><strong><a shape=\"rect\" href=\"https://clojureverse.org/t/advent-of-parens-2019/5159\">Comment on ClojureVerse</a></strong></p></div>",
   :direction "ltr"},
  :updated 1576058211000,
  :alternate
  [{:href
    "https://lambdaisland.com/blog/2019-12-11-advent-of-parens-11-integrant-in-practice",
    :type "text/html"}],
  :title "Advent 2019 part 11, Integrant in Practice",
  :author "Arne Brasseur",
  :published-str "Wed Dec 11 01:56:51 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16ef478f7f9:9a0e48:97b0c8f7",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://lambdaisland.com/blog/2019-12-11-advent-of-parens-11-integrant-in-practice",
  :commonTopics
  [{:score 35.910908780454456,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1576058211000,
  :fingerprint "19fbae04",
  :canonicalUrl
  "https://lambdaisland.com/blog/2019-12-11-advent-of-parens-11-integrant-in-practice"}
 {:engagement 6,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1576055558360,
  :content
  {:content
   "<p>I’ve already told you the <a href=\"https://augustl.com/blog/2019/set_up_win10_dev_environment_for_macos_linux_users/\">&quot;how&quot;</a>. Now it’s time for the &quot;why&quot;.</p>\n<h2>Actually, I don’t care what you use</h2>\n<p>I just wanted to get this one out of the way. I have absolutely nothing against the use of macOS or Linux. Personal preferences are both <em>normal</em> and <em>OK</em>.</p>\n<p>I’ve used all of them, extensively. My gaming PC is Windows. I've had many Macs. I've ran Linux on a Mac. I've had Thinkpads and Dells with Linux. I have switched to Windows before, and ended up switching back. Maybe that will happen again in the future. Those that know me, laugh at the idea that I started that sentence with &quot;maybe&quot;.</p>\n<p>What has changed?</p>\n<h2>The big thing that is different now is WSL.</h2>\n<p>I live in a unix world. All the servers I deploy to are unix. The software platforms I choose - Clojure, Kotlin, and other JVM languages - have one thing in common:</p>\n<p>They're mostly used by people that use Linux or macOS.</p>\n<p>So you're bound to run into problems on Windows. It's getting pretty rare, but it does happen. For example, a couple of years ago, I tried to compile ClojureScript on Windows, and it failed because of the way it shelled out to call npm for installing npm module dependencies. Almost nobody combines Windows and ClojureScript, at least two years ago. So my guess is that it simply never occurred to anyone to test it on Windows. It's fixed now. And you can sort of blame the JVM APIs that shelling out isn't made cross platform compatible. But the point remains the same. It'll happen.</p>\n<p>But because of WSL, this is now a thing of the past.</p>\n<h2>WSL seals the deal</h2>\n<p>WSL is short for Windows Subsystem for Linux. It's a complete re-implementation of the Linux kernel system calls, against the NT kernel.</p>\n<p>Think of it as the business version of WINE, that lets you run Windows programs on Linux. Just much, much better.</p>\n<p>There has always been Cygwin. And I don't think I know anyone that uses Windows that didn't use to use Cygwin before WSL came along. But WSL is so much better than Cygwin.</p>\n<p>I won't go into detail about how WSL works here, I'll save that for a separate blog post.</p>\n<p>But suffice to say, WSL rocks. It's a proper Linux run-time, with no boot time, embedded right into Windows. And you can choose between a bunch of distros, so you have the Ubuntu <code>apt-get</code> repos right at your fingertips if you choose Ubuntu, for example. That's a world of difference from cygwin.</p>\n<p>For example, last week I needed imagemagick with the extensions for reading the Apple camera file format HEIF. I just used apt to get the build-deps for imagemagick and built it myself with the necessary flags for HEIF support. Good luck doing that on cygwin.</p>\n<p>I try to do most things directly on Windows, to get the hang of it. There are some things, though, such as curl, that I have absolutely no idea how to do on Windows. I just open a WSL shell and use curl. Real curl. On Linux. On Windows.</p>\n<h2>Windows has a good terminal now</h2>\n<p>This is a half truth. For ages, there's been <a href=\"https://cmder.net\">cmdr</a>, and it works great. The option menus looks like someone used an AI to convert config files and option flags to a GUI, and it does require some setup.</p>\n<p>So now, I'm using the <a href=\"https://www.microsoft.com/en-us/p/windows-terminal-preview/9n0dx20hk701\">new official terminal from Microsoft</a>, which is in early access and available for anyone to try. I've used it for more than two months now and haven't had a single issue, so it's as good as stable in my book.\nIt's nice to be able to use ctrl+shift+c to copy, instead of having to do the weird right click insert enter stuff that I never quite got the hang of in the old built-in terminal in\nWindows. It's <a href=\"https://github.com/Microsoft/Terminal\">even open source</a> - you can build it yourself!</p>\n<h2>I don't like Apple hardware</h2>\n<p>The new 16&quot; Macbook Pro is a step in the right direction.\nBut since 2015, Macbook Pro has been pretty much useless as far as I'm concerned. I don't like that lock-in.</p>\n<p>I mean, I guess someone sees my Dell XPS 15 laptop and thinks &quot;wow, poor guy, he doesn't have a touch bar&quot; before they think anything else. But that person sure aint me. And I like that it has a thunderbolt 3 port for connecting my dock so I can just attach one single cable when I arrive at work. And that it also has USB-A ports and a HDMI port.</p>\n<p>And I have a gamer gene. I like to have a wide variety of hardrware available, and I read news about the latest offerings from AMD and Intel. Have you seen the <a href=\"https://www.youtube.com/watch?v=WxocVricANg\">latest episodes from LinusTechTips</a> about this? Do you want to rely on Apple and hope they make laptops with AMD CPUs in them? I mean maybe it will happen. But I like to not have to rely on one single company for my hardware.</p>\n<h2>I'm not a huge fan of the window management in macOS</h2>\n<p>Have you noticed that we're purely in the domain of taste now? Don't blame me! I said it in the intro. Your taste can be different from mine.</p>\n<p>I really like that I can just hold the Windows key and press arrow up to maximize a window. And maximize means &quot;fill the screen&quot;, not &quot;whatever the developers of the app want&quot;.</p>\n<p>One of my main gripes with macOS is that Command+tab switches between apps and not Windows. I have multiple windows of IntelliJ open at the same time, and I might have an incognito window of Firefox open to test some login stuff, and I want to switch betwen those two windows. And some times I work with two IntelliJ windows and one Firefox window sort of kind of at the same time. Then I want to have those in the glorious and predictable LRU cache that is alt+tab on Windows.</p>\n<p>This is a pretty minor gripe. But it is actually quite annoying when I prefer the way Windows does it, and I'm constantly reminded that apparently macOS isn't made for people like me.\nThere are some plugins I found that makes Command+tab switch between windows, not apps. The best one I found shows a preview of the window contents that can be many minutes old, so I think I have an unread message in Slack, but then I saw that it was just an old preview I had in Command+tab. And every now and then, it just didn't show all the windows I had open.</p>\n<p>Meh.</p>\n<h2>I don't particularly like the state of software on Linux</h2>\n<p>Heck, even Linus Torvalds agrees (6:27).</p>\n<p>I make a podcast, and i use Ableton Live to edit that. Ableton Live exists for macOS and Windows. That's it.</p>\n<p>I somehow managed to set up Ubuntu wrong once, and set up an encrypted home folder instead of a fully encrypted disk. Because Linux, this is two completely different things, and Dropbox suddenly changed to support the latter, and not the former.</p>\n<p>The issue, as Linus mentions above, is that there's no such thing as &quot;linux&quot;. If you make software, you have to distribute it for Ubuntu, Debian, Fedora 23, Fedora 24, CentOS, Arch, ... The list goes on and on.</p>\n<h2>This post is not meant to persuade you</h2>\n<p>A long list of reasons that are mostly subjective is not very persuasive. And that's OK. I just wanted to tell you about why I chose Windows, that's all.</p>\n<p>You can check out my article on <a href=\"https://augustl.com/blog/2019/set_up_win10_dev_environment_for_macos_linux_users/\">how to set up a Windows development environment</a> if you want to!</p>",
   :direction "ltr"},
  :updated 1576018800000,
  :entities
  [{:mentions [{:text "macOS"} {:text "Mac"}],
    :id "nlp/f/entity/wd:14116",
    :salienceLevel "about",
    :label "macOS"}
   {:mentions [{:text "Apple"}],
    :id "nlp/f/entity/wd:312",
    :salienceLevel "mention",
    :label "Apple Inc."}
   {:mentions [{:text "AMD"}],
    :id "nlp/f/entity/wd:128896",
    :salienceLevel "mention",
    :label "Advanced Micro Devices"}
   {:mentions [{:text "Macs"}],
    :id "nlp/f/entity/wd:75687",
    :salienceLevel "mention",
    :label "Apple Macintosh"}
   {:mentions [{:text "Microsoft"}],
    :id "nlp/f/entity/wd:2283",
    :salienceLevel "mention",
    :label "Microsoft"}],
  :alternate
  [{:href
    "http://augustl.com/blog/2019/choosing_windows_over_macos_linux/",
    :type "text/html"}],
  :title
  "Why I ditched macOS, Linux, and chose Windows for development work",
  :author "August Lilleaas",
  :published-str "Tue Dec 10 15:00:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16ef43b50d8:94a674:97b0c8f7",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url "http://img.youtube.com/vi/WxocVricANg/0.jpg",
   :width 480,
   :height 360,
   :contentType "image/jpeg"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "urn:augustl-com:feed:post::blog:2019:choosing_windows_over_macos_linux",
  :commonTopics
  [{:score 116.90564212635195,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.927,
    :id "nlp/f/topic/1025",
    :salienceLevel "about",
    :label "hacking"}],
  :published 1576018800000,
  :fingerprint "aca0c5a6",
  :canonicalUrl
  "http://augustl.com/blog/2019/choosing_windows_over_macos_linux/"}
 {:engagement 7,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/todo",
    :label "todo"}
   {:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1576049377179,
  :content
  {:content
   "Explaining with pictures what connection timeout, read timeout and connection pool timeout are, and how Apache HTTP Client compares to Asynchronous HTTP client when handling them",
   :direction "ltr"},
  :updated 1576051200000,
  :alternate
  [{:href
    "https://danlebrero.com/2019/12/11/apache-http-client-timeouts-config-production-asynchronous-http-client-pictures/",
    :type "text/html"}],
  :title
  "Apache Http Client and Asynchronous HTTP client timeouts explained in pictures",
  :author "Daniel Lebrero",
  :published-str "Wed Dec 11 00:00:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16ef3dcff9b:8e1b9b:69b9f616",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url
   "https://danlebrero.com/images/blog/http-client-timeout-configuration/http-client-timeouts.jpg",
   :width 800,
   :height 354,
   :contentType "image/jpeg"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://danlebrero.com/2019/12/11/apache-http-client-timeouts-config-production-asynchronous-http-client-pictures/",
  :commonTopics
  [{:score 29.03419316664595,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1576051200000,
  :fingerprint "2594c87c",
  :canonicalUrl
  "https://danlebrero.com/2019/12/11/apache-http-client-timeouts-config-production-asynchronous-http-client-pictures/"}
 {:engagement 6,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1575998808324,
  :content
  {:content
   "<p><em>This article is part of the <a href=\"http://metaredux.com/posts/2019/12/01/meta-advent-2019.html\">“Meta Advent 2019”</a> series. I’ve committed to writing\na new blog post here every day until Christmas.</em></p>\n<p>It took me a while to write this article, but it’s finally here.\nI’ve opted to group related questions into several broader themes.\nHere we go…</p>\n<p><strong>Note:</strong> You can find all the raw data from the survey <a href=\"https://docs.google.com/spreadsheets/d/15AxpE16AmxaAhg6tbKnxl4L6OrEVTdnL5V0c5fxuWFk/edit?usp=sharing\">here</a>. I couldn’t figure out how to share with everyone the diagrams (mostly pie charts)\nthat I got from Google Forms directly with you. If someone know how to do this - please, let me know.</p>\n<h2>A Dedicated User Base</h2>\n<p>I was surprised to learn that the majority of CIDER’s users (around 50%) have been using it for more than 3 years.\nIn fact less than 15% of all respondents said that they started using CIDER in the past year.</p>\n<p>I’m not sure whether those results are good or bad, but it’s good to know that many people enjoy CIDER so much that\nthey stuck with it for quite a while in a highly competitive environment. Certainly today we’ve got way more\ngreat alternatives to CIDER than we did 5 years ago.</p>\n<p>Of course, this might be also related to the fact that 60% of respondents said that they were using Emacs before.<sup><a href=\"http://metaredux.com/posts/2019/12/10/state-of-cider-2019-results.html#fn:1\">1</a></sup>\nThis was also quite surprising, as I always thought we had plenty of people who came to Emacs for CIDER. Perhaps\nmany of those have fled to other tools now that there are more of those. I can only speculate here.</p>\n<p>Another interesting insight for me was that 13% of respondents came to CIDER from vim and around 12% from Cursive.\nI wasn’t that surprised about the vim converts, as Emacs has a pretty good vim keybindings emulation<sup><a href=\"http://metaredux.com/posts/2019/12/10/state-of-cider-2019-results.html#fn:2\">2</a></sup>, but\nI didn’t expect any Cursive converts.</p>\n<h2>User Environment</h2>\n<p>Most people seem to be using either macOS or GNU/Linux (around 53% for both). Windows users are quite few at\naround 6%. Note that some people are using more than one operating system.</p>\n<p>90% of all respondents are working with Emacs 26 or 27 (current development version), we’ve got only 10%\nstill running Emacs 25. 2/3 of all users reported they had a custom Emacs setup, and 28% are running Spacemacs. Frankly, I expected\nmore people on Spacemacs. It was also nice to see that about 7% reported they were using my Emacs Prelude.</p>\n<p>Around 50% of all people reported they were running the latest stable CIDER, with 28% running the development version\nof CIDER. Funny enough 8% responded that they had no idea what version of CIDER they were using.\nMost people reported that they were updating CIDER after each release and that the upgrade process is pretty\npainless these days. Great success!</p>\n<p>I was quite happy to learn that these days 97% (!!!) of all users are relying on <code>cider-nrepl</code>. I expected\nthis to be something like 70-80%, but this result really surprised me.</p>\n<h2>Typical Usage</h2>\n<p>Another interesting insight for me was that the bulk of our users (2/3) are using CIDER for both\nClojure and ClojureScript development. The rest are doing Clojure-only. ClojureScript support\nhas always been a weakness of CIDER, although things have been improving there gradually in the past couple\nof years. I guess knowing how many people rely on that support should motivate us even further to improve it.</p>\n<p>When it comes to build tools, 2/3 of CIDER’s users are relying on Leiningen and\nabout 1/3 on <code>tools.deps</code>. All the other build tools barely registered in the\nsurvey. I was surprised that Boot fared so poorly in it (less than 3%).</p>\n<p>87% of all participants in the survey are targeting Clojure 1.10. The number is pretty similar for ClojureScript\n1.10 (84%). There are still some people targeting 1.8 and 1.9, but it seems that Clojure 1.7 is pretty much dead.\nSeems our decision to try to support the last 3 Clojure(Script) releases was a good one.</p>\n<p>About 2/3 of our users are typically starting CIDER using <code>cider-jack-in</code> and\nthe rest favour the use of <code>cider-connect</code>. No surprises here. Most people\n(70%) use CIDER only for local development, but about 30% of the users said they\nwere also using CIDER to connect to remote applications.</p>\n<h2>Extensions</h2>\n<p>2/3 of the respondents said they were using some CIDER extensions. <code>clj-refactor</code> was the most popular\nby a huge margin - almost 90% usage. <code>helm-cider</code> came in second with 10%. None of the other extensions\nmade it to 10%. Over the years CIDER absorbed many extensions, so I guess it’s not a big surprise that\npeople are relying much on extensions.</p>\n<p>There were also quite a few remarks that people didn’t even know that many of those extensions existed,\neven though all of them are listed in <a href=\"https://docs.cider.mx/cider/additional_packages.html#_cider_extensions\">CIDER’s manual</a>.</p>\n<p>When it comes to Emacs extensions - <code>paredit</code>, <code>smartparens</code>, <code>projectile</code> and <code>magit</code> were the top choices\nfor most people. I doubt that anyone is surprised by those results.</p>\n<h2>Favourite Features</h2>\n<p>When asked to highlight their favourite features in CIDER most people pointed out the following:</p>\n<ul>\n<li>The debugger</li>\n<li>The (value) inspector</li>\n<li>Interactive programming</li>\n</ul>\n<p>I was surprised to see so many mentions of the inspector. It’s great to hear so many people find it useful!\nRelatively few features were highlighted by most people, so I’m also wondering how many of our users are\nfamiliar with everything CIDER has to offer. Another way to interpret this is that perhaps we have\ntoo many useless features and we should trim our fat. :-)</p>\n<h2>Ideas for Improvement</h2>\n<p>When it comes to ideas for improvements the front-runners were:</p>\n<ul>\n<li>Better ClojureScript support</li>\n<li>Better find-usages</li>\n<li>Improved refactoring functionality/Merging CIDER and clj-refactor</li>\n<li>Improved support for <code>clojure.spec</code></li>\n<li>Fewer breaking changes</li>\n<li>More informative messages (especially when it comes to errors)</li>\n</ul>\n<p>By the way, we’ve been planning to merge CIDER and clj-refactor for a while now, but unfortunately our progress\non that front has been quite slow. I can assure that we’re working to some extent on all those topics, but with our\nvery limited bandwidth big improvements take their time.</p>\n<p>It also seems that most people are reasonably happy with CIDER’s defaults as there weren’t many suggestions\nto improve those. Prompting for a symbol prior to acting on it and switching focus on certain actions popped\nup a few times on this question.</p>\n<h2>Learning and Resources</h2>\n<p>The vast majority of respondents seem to be happy with the current state of CIDER’s documentation.\nI’ve spent a lot of time working on it throughout the year, so I’m glad to see this.</p>\n<p>When it comes to support resources, the Clojurians Slack is clearly number 1 (favoured by about 50% of the respondents).\nReddit, GitHub Issues and StackOverflow come next with more or less the same share - about 12%-13%.</p>\n<p>I try to monitor all of them, even though I often ignore some questions simply due to lack of time.\nI always appreciate it when others are helping out with the support questions.</p>\n<h2>Funding</h2>\n<p>The bulk of people (70%) said they were using CIDER at their job. On the other hand only 22% said that\nthey or their company are supporting CIDER. That’s certainly a bit disappointing, but it’s relatively\neasy to explain - most companies need some licences that they can buy and this option doesn’t exist for them.</p>\n<p>On the bright side - 83% responded that they would be willing to support CIDER to one degree or another. I’ll\nuse this opportunity to remind everyone that the best ways to fund the development of CIDER today are:</p>\n<ul>\n<li><a href=\"https://opencollective.com/cider\">Open Collective</a></li>\n<li><a href=\"https://github.com/sponsors/bbatsov\">GitHub Sponsors</a></li>\n</ul>\n<p>These days I’d recommend using GitHub sponsors if you want to pitch in, because\nthey don’t charge me anything and for the first year they’re matching the\ndonations that I receive (if you donate $100, I’ll receive $200). In general I\nprefer Open Collective’s model, as it’s focused on the project, not on a\nparticular person, but I certainly wouldn’t mind getting a bit of extra money\nfrom GitHub/Microsoft for free.</p>\n<p>All in all, it’s nice to see people are willing to invest in CIDER. I’ll just have to figure out\nat some point how to sell some licences for it to companies.</p>\n<h2>General Notes</h2>\n<p>This was the first survey of the type that I ever did and it was an useful learning experience for me.\nI got a lot of feedback about improving the structure and the type of the questions.</p>\n<p>I promise you that I’ve learned my lessons and that the next survey is going to be better!</p>\n<p>I’ve also noticed that people seem to confuse CIDER and clj-refactor functionality, but\nthat’s not a big surprise.</p>\n<h2>Closing Thoughts</h2>\n<p>Well, that’s wrap!</p>\n<p>545 people participated in the survey in total, which was a bit\nunderwhelming as I really hoped we’d be able to make it to 1000, but it is what it is.\nWe’ll go big next year!</p>\n<p>I think that overall the survey results show that CIDER is in a good place and\nhas a dedicated (and happy) user base. People want to see existing features polished and\nrefined, more stability in the project (CIDER 1.0 maybe) and better ClojureScript support.\nYour voice has been heard and I hope that we won’t let you down!</p>\n<p>As usual there are many ways to interpret <a href=\"https://docs.google.com/spreadsheets/d/15AxpE16AmxaAhg6tbKnxl4L6OrEVTdnL5V0c5fxuWFk/edit?usp=sharing\">the data</a> and this is\nsimply mine interpretation. I’m looking forward to seeing more articles from members\nof the community analyzing it and sharing their perspective!</p>\n<p>Thanks to everyone who participated in the survey! I really appreciate your\ninput and I’ll work hard next year to make CIDER even better!</p>\n<div>\n<ol>\n<li>\n<p>And unlikely to ever use a different editor. <a href=\"http://metaredux.com/posts/2019/12/10/state-of-cider-2019-results.html#fnref:1\">↩</a></p>\n</li>\n<li>\n<p>And there’s also Spacemacs… <a href=\"http://metaredux.com/posts/2019/12/10/state-of-cider-2019-results.html#fnref:2\">↩</a></p>\n</li>\n</ol>\n</div>",
   :direction "ltr"},
  :updated 1575936000000,
  :entities
  [{:mentions [{:text "macOS"}],
    :id "nlp/f/entity/wd:14116",
    :salienceLevel "mention",
    :label "macOS"}
   {:mentions [{:text "Microsoft"}],
    :id "nlp/f/entity/wd:2283",
    :salienceLevel "mention",
    :label "Microsoft"}],
  :alternate
  [{:href
    "http://metaredux.com/posts/2019/12/10/state-of-cider-2019-results.html",
    :type "text/html"}],
  :title "State of CIDER 2019 Results",
  :author "Bozhidar Batsov",
  :published-str "Mon Dec 09 16:00:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16ef0d96104:4cd0ae:97b0c8f7",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "http://metaredux.com/posts/2019/12/10/state-of-cider-2019-results",
  :commonTopics
  [{:score 37.7218042207945,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1575936000000,
  :fingerprint "7b5eed0c",
  :canonicalUrl
  "http://metaredux.com/posts/2019/12/10/state-of-cider-2019-results.html"}
 {:engagement 5,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1575976830735,
  :content
  {:content
   "<div><p><em>This post is part of <a shape=\"rect\" href=\"https://lambdaisland.com/blog/2019-11-25-advent-of-parens\">Advent of Parens\n2019</a>, my attempt to\npublish one blog post a day during the 24 days of the advent.</em></p><p>Recently I led a workshop for a client to help them improve their development\nprocess, and we talked a lot about <a shape=\"rect\" href=\"https://basecamp.com/shapeup\">Shape Up</a>, a\nbook released by Basecamp earlier this year that talks about <em>their</em> process.\nYou can read it for free on-line, and I can very much recommend doing so. It’s\nnot a long read and there are a ton of good ideas in there.</p><p>One of these ideas has also become a feature in Basecamp, namely hill charts.\nThese provide a great way to communicate what stage a piece of work is in. Are\nyou still going uphill, figuring things out and discovering new work, or are you\ngoing downhill, where it’s mostly clear what things will look like, and you’re\njust executing what you discovered?</p><p><a shape=\"rect\" href=\"https://hillchart-91fcf.firebaseapp.com/#a3e77804-4aee-44c2-808c-70ff37d803a6\"><img alt=\"Hillchart\" width=\"1000px\" src=\"https://hillchart-91fcf.firebaseapp.com/a3e77804-4aee-44c2-808c-70ff37d803a6.svg\" height=\"600px\"></a></p><p>The team really liked this idea, but they’re not planning to switch to Basecamp,\nsince they’re quite heavily invested in another tool. So during breaks and on\nthe way home I wrote up a little app that does just that. Click on the chart\nabove and you can see it in action. Simply remove the uuid from the URL to get a\nnew chart.</p><p>The UX could still be vastly improved, but with some clicking around hopefully\nit’s easy enough to figure out how it works. Click on the big plus to add a dot,\nclick on a dot to start moving it around, click again to put it down. The “M”\nbutton on the right gives you a markdown snippet that you can paste for instance\nin Github or Gitlab, and the button below that lets you edit the captions. The\ncode can be found on Github: <a shape=\"rect\" href=\"https://github.com/plexus/hillchart\">plexus/hillchart</a>.</p><p>I used Firebase for this project which was a first for me, and I have to say the\nexperience was pretty great. Firebase basically does three things: it serves the\napp (HTML/CSS/JS), it acts as a database, and using a Firebase Cloud Function\n(akin to an AWS Lambda), it can render a chart to SVG, which is then used by the\nMarkdown snippet to embed the chart in other platforms.</p><p>It’s really neatly self-contained that way, and by using the Firestore storage\nyou get synchronization basically for free. Try opening the same chart in two\ntabs and edit it and you’ll see what I mean.</p><p>Matt’s article on the Applied Science blog <a shape=\"rect\" href=\"http://www.appliedscience.studio/articles/cljs-firebase-functions.html\">ClojureScript on Firebase Cloud\nFunctions</a>\nwas very helpful to set things up. I initially started the project with\nFigwheel, but switched over to Shadow-cljs as it seemed to make using the\nFirebase npm package a bit easier. That was another first for me and I have to\nsay it was a very positive experience.</p><p>Go ahead and browse around the code. It’s really just a Reagent app. There are\nseveral bits that would be interesting to write about, I’ll just show how the\nFirestore integration works. (slightly redacted)</p><pre><code>(ns hillchart.main\n  (:require [reagent.core :as r]))\n\n;; Reagent app state\n(defonce state (r/atom {:dots []}))\n\n;; Each chart is identified by a random UUID, if there is no UUID yet in the URL\n;; then we'll generate one, i.e. create a new chart\n(when (= &quot;&quot; js/document.location.hash)\n  (set! js/document.location.hash (random-uuid)))\n\n;; Grab the current ID, this will stay fixed\n(def chart-id (subs js/document.location.hash 1))\n\n;; Initialize firestore, grab the charts collection, and grab the document with\n;; the current chart-id.\n(def ^js db (js/firebase.firestore))\n(def ^js fs-charts (.collection db &quot;charts&quot;))\n(def ^js fs-doc (.doc fs-charts chart-id))\n\n;; Helper that merges the state coming from the db into the reagent state\n(defn fs->state! [^js doc]\n  (swap! state merge (js->clj (.data doc) :keywordize-keys true)))\n\n;; Grab the data the first time, the `defonce` is just so this doesn't happen\n;; again when hot reloading.\n(defonce fetch-doc\n  (.then (.get fs-doc) fs->state!))\n\n;; Listen for changes\n(defonce setup-listener\n  (.onSnapshot fs-doc fs->state!))\n\n;; Whenever a change happens I'll call this to push changes to the db. I used a\n;; watch on the atom first, but since there are things in there like the current\n;; viewport size that don't need to be stored I figured this worked better.\n(defn save-doc! []\n  (.set fs-doc (clj->js (select-keys @state [:dots]))))\n</code></pre><p>And this is the code that powers the cloud function, so an SVG version can be\nrendered on the server-side. Data access is a little different here, but it\ncomes down to the same thing.</p><pre><code>(ns hillchart.firebase\n  (:require [&quot;firebase-functions&quot; :as functions]\n            [&quot;firebase-admin&quot; :as admin]\n            [hillchart.main :as main]\n            [reagent.dom.server]\n            [clojure.string :as str]))\n\n(.initializeApp admin)\n\n(defn render-chart-svg [^js req, ^js res]\n  (let [doc-id (str/replace (str/replace (.-path req) &quot;.svg&quot; &quot;&quot;) &quot;/&quot; &quot;&quot;)\n        ^js db (.firestore admin)\n        ^js fs-charts (.collection db &quot;charts&quot;)\n        ^js fs-doc (.doc fs-charts doc-id)]\n    (.then (.get fs-doc)\n           (fn [doc]\n             (.type res &quot;.svg&quot;)\n             (.send res\n                    (reagent.dom.server/render-to-static-markup\n                     [main/Chart (assoc (js->clj (.data doc) :keywordize-keys true)\n                                   :screen/width 500\n                                   :screen/height 300\n                                   :static? true)])))))) ;;&lt;- hide the buttons\n\n(def cloud-functions\n  #js {:renderChartSVG (.onRequest functions/https render-chart-svg)})\n</code></pre><p><em>Hi, my name is Arne and I consult companies and teams about application\narchitecture, development process, tooling and testing. I collaborate with other\ntalented people under the banner <a shape=\"rect\" href=\"http://gaiwan.co\">Gaiwan</a>. If you like to have a chat about any of these things just <a shape=\"rect\" href=\"https://lambdaisland.com/p/contact\">get in touch!</a></em></p><p><strong><a shape=\"rect\" href=\"https://clojureverse.org/t/advent-of-parens-2019/5159\">Comment on ClojureVerse</a></strong></p></div>",
   :direction "ltr"},
  :updated 1575974732000,
  :entities
  [{:mentions [{:text "Basecamp"}],
    :id "nlp/f/entity/wd:2364173",
    :salienceLevel "mention",
    :label "Basecamp"}],
  :alternate
  [{:href
    "https://lambdaisland.com/blog/2019-12-10-advent-of-parens-10-hillchart-reagent-shadow-firebase",
    :type "text/html"}],
  :title
  "Advent 2019 part 10, Hillcharts with Firebase and Shadow-cljs",
  :author "Arne Brasseur",
  :published-str "Tue Dec 10 02:45:32 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16eef8a070f:2c730f:69b9f616",
  :visual {:url "none"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://lambdaisland.com/blog/2019-12-10-advent-of-parens-10-hillchart-reagent-shadow-firebase",
  :commonTopics
  [{:score 35.17125680722819,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.755,
    :id "nlp/f/topic/774",
    :salienceLevel "mention",
    :label "engineering"}],
  :published 1575974732000,
  :fingerprint "1b6fcf48",
  :canonicalUrl
  "https://lambdaisland.com/blog/2019-12-10-advent-of-parens-10-hillchart-reagent-shadow-firebase"}
 {:tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1575954616374,
  :content
  {:content
   "<p>With requirements for <a href=\"http://offlinefirst.org/\">offline</a> capabilities and fault\ntolerance, modern database management systems thrive for mechanisms that support\nsimple replications. By using decentralized <a href=\"https://ieeexplore.ieee.org/document/990434/\">peer-to-peer\nsystems</a> and by replicating only\nfiles we can easily achieve a simple synchronization solution without tempering\nwith databases itself. Since we are handling parallel events in the spacetime of\ndistributed systems conflicts may arise. For simplicity we leave the conflict\nresolution for another time.</p>\n<p>In the next section we will go through a simple example application for database\nreplication with as few steps as possible. Background information about the\nunderlying database <a href=\"https://github.com/replikativ/datahike\">Datahike</a> and\nsynchronization platform <a href=\"https://dat.foundation/\">dat</a> are described in the\n<a href=\"https://lambdaforge/2019/12/08/replicate-datahike-wherever-you-go.html#background\">background</a> section in the end. Basic knowledge of Clojure should\nbe enough to get a sense of the following code. So let’s start.</p>\n<h1>Demo application</h1>\n<p>The following demo will show an example Clojure application with two peers and a simple\n<a href=\"https://lambdaforge/2019/12/08/github.com/replikativ/datahike\">Datahike</a> database containing users with a name.\nFirst we will create an origin database with some entries, create a data\nrepository in the database folder and then share it to another folder on the\nsystem by cloning and synchronizing it using the <a href=\"https://dat.foundation/\">dat\nproject</a>, in particular the dat command-line client.\nThen we will attempt to read the cloned database again and observe live updates\nwith a file watcher.</p>\n<p>Figure <a href=\"https://lambdaforge/2019/12/08/replicate-datahike-wherever-you-go.html#FIG-1\">FIG-1</a> illustrates the connection between\nDatahike, the peers, and the synchronization layer. Updates within the database\nin application <em>origin app</em> are written to the file system on the <em>origin peer</em>,\nthe synchronization process <em>dat share</em> detects changes and propagates them to\nother peers, where process <em>dat sync</em> receives changes and applies them to the\nfile system of the <em>clone peer</em>. Then <em>clone app</em> detects file changes and\nrefreshes the connection to Datahike which reads again from the file system.</p>\n<figure>\n<img alt=\"FIG-1: System overview\" src=\"https://lambdaforge/assets/images/datahike_dat_replication.svg\">\n<em>FIG-1</em>: System overview\n</figure>\n<h2>Setup</h2>\n<p>First make sure you have dat installed. See the official\n<a href=\"https://docs.datproject.org/install\">docs</a> for further instructions. (If you are under Ubuntu, it might clash with a commandline tool from <code>liballegro4-dev</code>.) Since we\nare using <a href=\"https://clojure.org/\">Clojure</a>, you need the JVM (check your\noperating system for Java options) and <a href=\"https://leiningen.org/\">leiningen</a> in\norder to execute the code. If you don’t want to type you may find the example\ncode <a href=\"https://github.com/kordano/datahike-sync\">here</a>. This example aims for\nUnix environments like Linux or MacOS but it should easily be translatable to\nWindows environments (just contact me if you need help with that).</p>\n<h2>Origin Peer</h2>\n<p>Let’s start our project from scratch. Open a terminal and begin with:</p>\n<div><div><pre><code>lein new datahike-replication\n<span>cd </span>datahike-replication\n</code></pre></div></div>\n<p>Add the following to the <code>:dependencies</code> section in your <code>project.clj</code> with at least Clojure version <code>1.9.0</code>.</p>\n<div><div><pre><code><span>[</span><span>io.replikativ/datahike</span><span> </span><span>&quot;0.2.0&quot;</span><span>]</span><span>\n</span></code></pre></div></div>\n<p>Now we can fire up a REPL and start tinkering.</p>\n<div><div><pre><code><span>lein</span><span> </span><span>repl</span><span>\n</span><span>=></span><span>\n</span><span>nREPL</span><span> </span><span>server</span><span> </span><span>started</span><span> </span><span>on</span><span> </span><span>port</span><span> </span><span>49731</span><span> </span><span>on</span><span> </span><span>host</span><span> </span><span>127.0</span><span>.0.1</span><span> </span><span>-</span><span> </span><span>nrepl</span><span>://127.0.0.1:49731</span><span>\n</span><span>REPL-y</span><span> </span><span>0.3</span><span>.7,</span><span> </span><span>nREPL</span><span> </span><span>0.2</span><span>.13</span><span>\n</span><span>Clojure</span><span> </span><span>1.9</span><span>.0</span><span>\n</span><span>Java</span><span> </span><span>HotSpot</span><span>(</span><span>TM</span><span>)</span><span> </span><span>64</span><span>-Bit</span><span> </span><span>Server</span><span> </span><span>VM</span><span> </span><span>1.8</span><span>.0_144-b01</span><span>\n</span><span>Docs</span><span>:</span><span> </span><span>(</span><span>doc</span><span> </span><span>function-name-here</span><span>)</span><span>\n</span><span>(</span><span>find-doc</span><span> </span><span>&quot;part-of-name-here&quot;</span><span>)</span><span>\n</span><span>Source</span><span>:</span><span> </span><span>(</span><span>source</span><span> </span><span>function-name-here</span><span>)</span><span>\n</span><span>Javadoc</span><span>:</span><span> </span><span>(</span><span>javadoc</span><span> </span><span>java-object-or-class-here</span><span>)</span><span>\n</span><span>Exit</span><span>:</span><span> </span><span>Control+D</span><span> </span><span>or</span><span> </span><span>(</span><span>exit</span><span>)</span><span> </span><span>or</span><span> </span><span>(</span><span>quit</span><span>)</span><span>\n</span><span>Results</span><span>:</span><span> </span><span>Stored</span><span> </span><span>in</span><span> </span><span>vars</span><span> </span><span>*1,</span><span> </span><span>*2,</span><span> </span><span>*3,</span><span> </span><span>an</span><span> </span><span>exception</span><span> </span><span>in</span><span> </span><span>*e</span><span>\n</span><span>user=></span><span>\n</span></code></pre></div></div>\n<p>First we create an empty Datahike instance within our local folder\n<code>/tmp/origin-dat</code> and initialize it with a simple schema.</p>\n<div><div><pre><code><span>(</span><span>require</span><span> </span><span>'</span><span>[</span><span>datahike.api</span><span> </span><span>:as</span><span> </span><span>d</span><span>])</span><span>\n</span><span>(</span><span>def</span><span> </span><span>origin-dir</span><span> </span><span>&quot;/tmp/origin-dat&quot;</span><span>)</span><span>\n</span><span>(</span><span>def</span><span> </span><span>origin-uri</span><span> </span><span>(</span><span>str</span><span> </span><span>&quot;datahike:file://&quot;</span><span> </span><span>origin-dir</span><span>))</span><span>\n</span><span>(</span><span>def</span><span> </span><span>schema</span><span> </span><span>[{</span><span>:db/ident</span><span> </span><span>:name</span><span>\n</span><span>:db/valueType</span><span> </span><span>:db.type/string</span><span>\n</span><span>:db/cardinality</span><span> </span><span>:db.cardinality/one</span><span>}])</span><span>\n</span><span>(</span><span>d/create-database</span><span> </span><span>origin-uri</span><span> </span><span>:initial-tx</span><span> </span><span>schema</span><span>)</span><span>\n</span><span>(</span><span>def</span><span> </span><span>origin-conn</span><span> </span><span>(</span><span>d/connect</span><span> </span><span>origin-uri</span><span>))</span><span>\n</span></code></pre></div></div>\n<p>Now we add some data.</p>\n<div><div><pre><code><span>(</span><span>d/transact</span><span> </span><span>origin-conn</span><span> </span><span>[{</span><span>:name</span><span> </span><span>&quot;Christian&quot;</span><span>}</span><span>\n</span><span>{</span><span>:name</span><span> </span><span>&quot;Judith&quot;</span><span>}</span><span>\n</span><span>{</span><span>:name</span><span> </span><span>&quot;Konrad&quot;</span><span>}])</span><span>\n</span></code></pre></div></div>\n<p>Let’s check if everything is transacted correctly.</p>\n<div><div><pre><code><span>(</span><span>d/q</span><span> </span><span>'</span><span>[</span><span>:find</span><span> </span><span>?n</span><span>\n</span><span>:where</span><span> </span><span>[</span><span>?e</span><span> </span><span>:name</span><span> </span><span>?n</span><span>]]</span><span>\n</span><span>@</span><span>origin-conn</span><span>)</span><span>\n</span><span>;; => #{[&quot;Konrad&quot;] [&quot;Christian&quot;] [&quot;Judith&quot;]}</span><span>\n</span></code></pre></div></div>\n<p>Since we are using this query several times with different connections we\nshould use it as a function.</p>\n<div><div><pre><code><span>(</span><span>defn</span><span> </span><span>get-all-names</span><span> </span><span>[</span><span>conn</span><span>]</span><span>\n</span><span>(</span><span>d/q</span><span> </span><span>'</span><span>[</span><span>:find</span><span> </span><span>?n</span><span>\n</span><span>:where</span><span> </span><span>[</span><span>?e</span><span> </span><span>:name</span><span> </span><span>?n</span><span>]]</span><span>\n</span><span>@</span><span>conn</span><span>))</span><span>\n</span></code></pre></div></div>\n<h2>Dat Replication</h2>\n<p>Now let’s initialize the dat origin peer in the Datahike folder and start sharing it.</p>\n<div><div><pre><code><span>cd</span> /tmp/origin-dat\ndat create\ndat share\n</code></pre></div></div>\n<p>The share output provides the dat ID. Something like:</p>\n<div><div><pre><code>dat v13.13.1\ndat://1d823e35715ed567f03b7db945241881e25ac97cc20819c9fa759c944ad8c412\n</code></pre></div></div>\n<p>Now we can share this link and start distributing the database. Let the sharing daemon open and create a new terminal. Next we clone the repository into <code>/tmp/clone-dat</code>. Make sure that the folder doesn’t exist yet.</p>\n<div><div><pre><code><span>cd</span> /tmp\ndat clone dat://1d823e35715ed567f03b7db945241881e25ac97cc20819c9fa759c944ad8c412 clone-dat\n</code></pre></div></div>\n<p>With the cloning done, we can start synchronizing continuously.</p>\n<div><div><pre><code><span>cd</span> /tmp/clone-dat\ndat <span>sync</span>\n</code></pre></div></div>\n<p>Now everything is set up and we can check out the replicated Datahike instance.</p>\n<h2>Peer Clone</h2>\n<p>Let’s go back into our open repl:</p>\n<div><div><pre><code><span>(</span><span>def</span><span> </span><span>clone-dir</span><span> </span><span>&quot;/tmp/clone-dat&quot;</span><span>)</span><span>\n</span><span>(</span><span>def</span><span> </span><span>clone-uri</span><span> </span><span>(</span><span>str</span><span> </span><span>&quot;datahike:file://&quot;</span><span> </span><span>clone-dir</span><span>))</span><span>\n</span><span>(</span><span>def</span><span> </span><span>clone-conn</span><span> </span><span>(</span><span>d/connect</span><span> </span><span>clone-uri</span><span>))</span><span>\n</span><span>(</span><span>get-all-names</span><span> </span><span>clone-conn</span><span>)</span><span>\n</span><span>;; => #{[&quot;Konrad&quot;] [&quot;Christian&quot;] [&quot;Judith&quot;]}</span><span>\n</span></code></pre></div></div>\n<p>We have cloned the data once but updates through the synchronization are not realized in the Datahike connection. Let’s check this out by adding something to the origin database.</p>\n<div><div><pre><code><span>(</span><span>d/transact</span><span> </span><span>origin-conn</span><span> </span><span>[{</span><span>:name</span><span> </span><span>&quot;Pablo&quot;</span><span>}])</span><span>\n</span><span>(</span><span>get-all-names</span><span> </span><span>origin-conn</span><span>)</span><span>\n</span><span>;; => #{[&quot;Konrad&quot;] [&quot;Pablo&quot;] [&quot;Christian&quot;] [&quot;Judith&quot;]}</span><span>\n</span></code></pre></div></div>\n<p>If you look at the terminal process where the clone synchronizing is happening\nyou may see some updates coming through. Now let’s have a look at the clone-connection:</p>\n<div><div><pre><code><span>(</span><span>get-all-names</span><span> </span><span>clone-conn</span><span>)</span><span>\n</span><span>;; => #{[&quot;Konrad&quot;] [&quot;Christian&quot;] [&quot;Judith&quot;]}</span><span>\n</span></code></pre></div></div>\n<p>Tough luck. Nothing happened. The Datahike in-memory index is not in sync. We\nneed to re-create the local Datahike connection in order to get the updates in\nmemory.</p>\n<div><div><pre><code><span>(</span><span>def</span><span> </span><span>clone-conn</span><span> </span><span>(</span><span>d/connect</span><span> </span><span>clone-uri</span><span>))</span><span>\n</span><span>(</span><span>get-all-names</span><span> </span><span>clone-conn</span><span>)</span><span>\n</span><span>;; => #{[&quot;Konrad&quot;] [&quot;Pablo&quot;] [&quot;Christian&quot;] [&quot;Judith&quot;]}</span><span>\n</span></code></pre></div></div>\n<p>Alright, we have something here. Next, let’s update the connection whenever\nsomething in the clone peer has changed. As a simple solution we just check the\nlength of dat’s <code>content.signatures</code> file every 2 seconds and refresh Datahike’s\nconnection if it has changed. It may look a little bit frightening with all the\nfunctions from <code>core.async</code> but don’t be afraid. <a href=\"https://github.com/clojure/core.async\">core.async</a> provides a good\nlevel of abstraction to synchronize stateful processes.</p>\n<div><div><pre><code><span>(</span><span>require</span><span> </span><span>'</span><span>[</span><span>clojure.core.async</span><span> </span><span>:refer</span><span> </span><span>[</span><span>&lt;!</span><span> </span><span>go-loop</span><span> </span><span>>!</span><span> </span><span>timeout</span><span> </span><span>chan</span><span> </span><span>put!</span><span>]])</span><span>\n</span><span>(</span><span>defn</span><span> </span><span>signatures-length</span><span> </span><span>[]</span><span>\n</span><span>(</span><span>.length</span><span> </span><span>(</span><span>clojure.java.io/file</span><span> </span><span>(</span><span>str</span><span> </span><span>clone-dir</span><span> </span><span>&quot;/.dat/content.signatures&quot;</span><span>))))</span><span>\n</span><span>(</span><span>defn</span><span> </span><span>reconnect</span><span> </span><span>[]</span><span>\n</span><span>(</span><span>let</span><span> </span><span>[</span><span>state</span><span> </span><span>(</span><span>atom</span><span> </span><span>{</span><span>:chan</span><span> </span><span>(</span><span>chan</span><span>)</span><span>\n</span><span>:conn</span><span> </span><span>(</span><span>d/connect</span><span> </span><span>clone-uri</span><span>)})]</span><span>\n</span><span>(</span><span>go-loop</span><span> </span><span>[</span><span>event</span><span> </span><span>:reconnect</span><span>]</span><span>\n</span><span>(</span><span>case</span><span> </span><span>event</span><span>\n</span><span>:stop</span><span> </span><span>(</span><span>println</span><span> </span><span>:stopping</span><span>)</span><span>\n</span><span>:reconnect</span><span> </span><span>(</span><span>do</span><span>\n</span><span>(</span><span>swap!</span><span> </span><span>state</span><span> </span><span>assoc</span><span> </span><span>:conn</span><span> </span><span>(</span><span>d/connect</span><span> </span><span>clone-uri</span><span>))</span><span>\n</span><span>(</span><span>println</span><span> </span><span>:reconnected</span><span>)</span><span>\n</span><span>(</span><span>recur</span><span> </span><span>(</span><span>&lt;!</span><span> </span><span>(</span><span>:chan</span><span> </span><span>@</span><span>state</span><span>))))</span><span>\n</span><span>(</span><span>recur</span><span> </span><span>(</span><span>&lt;!</span><span> </span><span>(</span><span>:chan</span><span> </span><span>@</span><span>state</span><span>)))))</span><span>\n</span><span>(</span><span>go-loop</span><span> </span><span>[</span><span>l</span><span> </span><span>(</span><span>signatures-length</span><span>)]</span><span>\n</span><span>(</span><span>&lt;!</span><span> </span><span>(</span><span>timeout</span><span> </span><span>2000</span><span>))</span><span>\n</span><span>(</span><span>let</span><span> </span><span>[</span><span>new-l</span><span> </span><span>(</span><span>signatures-length</span><span>)]</span><span>\n</span><span>(</span><span>when-not</span><span> </span><span>(</span><span>=</span><span> </span><span>l</span><span> </span><span>new-l</span><span>)</span><span>\n</span><span>(</span><span>>!</span><span> </span><span>(</span><span>:chan</span><span> </span><span>@</span><span>state</span><span>)</span><span> </span><span>:reconnect</span><span>))</span><span>\n</span><span>(</span><span>recur</span><span> </span><span>new-l</span><span>)))</span><span>\n</span><span>state</span><span>))</span><span>\n</span><span>(</span><span>def</span><span> </span><span>state</span><span> </span><span>(</span><span>reconnect</span><span>))</span><span>\n</span></code></pre></div></div>\n<p>The updates should now be replicated to the database clone whenever we transact\nnew data in the origin connection. The REPL should display <code>:reconnected</code> once the connection is renewed.</p>\n<div><div><pre><code><span>(</span><span>d/transact</span><span> </span><span>origin-conn</span><span> </span><span>[{</span><span>:name</span><span> </span><span>&quot;Chrislain&quot;</span><span>}])</span><span>\n</span><span>(</span><span>get-all-names</span><span> </span><span>origin-conn</span><span>)</span><span>\n</span><span>;; => #{[&quot;Konrad&quot;] [&quot;Chrislain&quot;] [&quot;Pablo&quot;] [&quot;Christian&quot;] [&quot;Judith&quot;]}</span><span>\n</span></code></pre></div></div>\n<p>Wait a second or two for dat to synchronize the data. Then we have to check the\nconnection in the clone state, since it is reset every time dat synchronizes new\ndata.</p>\n<div><div><pre><code><span>(</span><span>get-all-names</span><span> </span><span>(</span><span>:conn</span><span> </span><span>@</span><span>state</span><span>))</span><span>\n</span><span>;; => #{[&quot;Konrad&quot;] [&quot;Chrislain&quot;] [&quot;Pablo&quot;] [&quot;Christian&quot;] [&quot;Judith&quot;]}</span><span>\n</span></code></pre></div></div>\n<p>Awesome, now we have a distributed database. You may stop watching the local\ncontent by sending the <code>:stop</code> event.</p>\n<div><div><pre><code><span>(</span><span>put!</span><span> </span><span>(</span><span>:chan</span><span> </span><span>@</span><span>state</span><span>)</span><span> </span><span>:stop</span><span>)</span><span>\n</span></code></pre></div></div>\n<h1>Background</h1>\n<p>Although the base idea is very simple, it can only be adapted with databases that\nmeet certain criteria. Firstly data updates must be operated atomically on a\nsingle file, so that the peer-to-peer system can propagate individual updates.\nSecondly most database systems use memory mapped files and mutate data in\nunpredictable positions all over the files of its transaction log and mutable indices.\nThis way we don’t get any efficient data deltas and the peer-to-peer system has\nto calculate the changes at high costs that increase with database size.</p>\n<p>You could imagine using a distributed file system like\n<a href=\"https://en.wikipedia.org/wiki/ZFS\">ZFS</a> to make these mutable databases\npersistent but this often hurts their performance significantly and requiring a\nspecial file system is not a lean operation. We believe that ZFS would have less\nof a performance impact for Datahike though and its fast synchronization and\ncomposable notion of persistent snapshots is an unexplored, but attractive\nalternative to dat synchronization.</p>\n<p>Either way using our database <a href=\"https://github.com/replikativ/datahike\">Datahike</a>\non any file system is sufficient here in combination with the\n<a href=\"https://datproject.org\">dat project</a> with its simple API and open protocol for\nfile replication.</p>\n<h2>datahike and dat project</h2>\n<p><a href=\"https://github.com/replikativ/datahike\">Datahike</a> is a\n<a href=\"https://en.wikipedia.org/wiki/Triplestore\">triplestore</a> that uses <a href=\"https://github.com/datacrypt-project/hitchhiker-tree\">hitchhiker\ntrees</a> as indexes and\nprovides a powerful <a href=\"https://en.wikipedia.org/wiki/Datalog\">datalog</a> query\nengine.</p>\n<p>The Hitchhiker tree is a functional data structure invented by <a href=\"https://github.com/dgrnbrg\">David\nGreenberg</a> that incorporates a fractal tree which\nleads to very efficient read and write operations. It is a\ncombination of a <a href=\"https://en.wikipedia.org/wiki/B%2B_tree\">B+-Tree</a> and an\nappend-only log. For more information, have a look at the presentation about the hitchhiker tree\nfrom <a href=\"https://www.youtube.com/watch?v=jdn617M3-P4\">strangeloop 2016</a> or from\n<a href=\"https://lambdaforge/index.html#sec-02\">Christian</a> on the\n<a href=\"https://blog.datopia.io/2018/11/03/hitchhiker-tree/\">datopia blog</a>.</p>\n<p>The <a href=\"https://datproject.org/\">dat project</a> is a nonprofit data sharing\npeer-to-peer protocol for building distributed applications. Currently dat is\nprimarily implemented in JavaScript with APIs for high and low-level data\nsynchronization.</p>\n<h1>Conclusion and future development</h1>\n<p>By combining Datahike’s efficient functional index with the replication\nmechanisms from <em>dat</em> we have a quick solution for simple data replication without\ntyping any synchronization code ourselves.</p>\n<figure>\n<img alt=\"Replicate All The Things\" src=\"https://lambdaforge/assets/images/replicate-all-data-meme.png\">\n</figure>\n<p>Multiple clones could scale our database reads by just replicating to more machines.</p>\n<p>Only the original peer can write to the dat repository and therefore we have only a\nsingle writer setup. Multiple writers will require a conflict resolution scheme\nwhich is planned in Datahike for future work.</p>\n<p>As replication systems you may try also <a href=\"https://ipfs.io/\">IPFS</a>,\n<a href=\"https://syncthing.net/\">syncthing</a> or even simple batch synchronization using\n<a href=\"https://en.wikipedia.org/wiki/Rsync\">rsync</a>.</p>\n<p>You should also be able to use a good old network file system like NFS, SSHFS,\nWebDAV or Windows network shares because our file system store does not update\nthe files in place but ensures atomic copy-on-write semantics itself.</p>\n<p>For the next iteration for Datahike we are extending the ideas of this simple\nreplication mechanism.</p>\n<p>We are very happy to discuss your ideas on\n<a href=\"https://app.slack.com/client/T03RZGPFR/CB7GJAN0L\">slack</a> or\n<a href=\"https://clojurians.zulipchat.com/#narrow/stream/204500-datahike\">zulip</a> and\npush things further since there are plenty of possibilities and we probably have\nnot thought about all of them yet :).</p>",
   :direction "ltr"},
  :updated 1575784800000,
  :entities
  [{:mentions [{:text "MacOS"}],
    :id "nlp/f/entity/wd:14116",
    :salienceLevel "mention",
    :label "macOS"}],
  :alternate
  [{:href
    "https://lambdaforge/2019/12/08/replicate-datahike-wherever-you-go.html",
    :type "text/html"}],
  :title "Replicate Datahike wherever you go",
  :author "Konrad Kühne",
  :published-str "Sat Dec 07 22:00:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16eee371036:e5908:69b9f616",
  :visual {:url "none"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://lambdaforge/2019/12/08/replicate-datahike-wherever-you-go",
  :commonTopics
  [{:score 77.53989688735199,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1575784800000,
  :fingerprint "c8aa5fcb"}
 {:engagement 5,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1575904050105,
  :recrawled 1576057806261,
  :content
  {:content
   "<div><p><em>This post is part of <a shape=\"rect\" href=\"https://lambdaisland.com/blog/2019-11-25-advent-of-parens\">Advent of Parens\n2019</a>, my attempt to\npublish one blog post a day during the 24 days of the advent.</em></p><p>Clojure has this great feature called Dynamic Vars, it lets you create variables\nwhich can be dynamically bound, rather than lexically. Lexical (from Ancient\nGreek λέξις (léxis) <em>word</em>) in this case means “according to how it is written”.\n<code>let</code> bindings for instance are lexical.</p><pre><code>(defn hello [x]\n  (str &quot;hello &quot; x))\n\n(defn greetings []\n  (str &quot;greetings&quot; foo)) ;; *error*\n\n(let [foo 123]\n  (hello foo)\n  (greetings))\n</code></pre><p>The <code>let</code> introduces a <em>lexical</em> binding for <code>foo</code>, it can be accessed in\n<code>(hello foo)</code> because lexically (textually) it’s within the <code>let</code>. <code>greetings</code>\nis outside of the let so it can’t “see” <code>foo</code>.</p><p><em>Dynamic</em> bindings are introduced with <code>binding</code>, and are visible within the\nsame call stack. Any function that is called on the same thread can “see” the\nbinding. For this to work you need to add metadata marking the var as\n<code>:dynamic</code>, and you need to give the name earmuffs (that’s what those asterisks\nare called. Cute, right?)</p><pre><code>(def ^:dynamic *foo*)\n\n(defn greetings []\n  (str &quot;greetings&quot; *foo*) \n\n(binding [*foo* 123]\n  (greetings))\n</code></pre><p>Ok so this is great and handy (although don’t overuse it, but that’s a topic for\nanother time). But how does this work in ClojureScript. For one ClojureScript\ndoes not have vars, they compile to plain JavaScript globals. JavaScript (and\nthus ClojureScript) also doesn’t have threads, so the mechanisms provided by\nvars like root binding and thread bindings are not relevant. But dynamic vars do\nexist in ClojureScript… curious! I’ve been wondering for some time now how\nthey work, and today I finally investigated.</p><p>Here’s how <code>binding</code> is implemented. Curious indeed! It calls the analyzer to\ncheck if the vars are actually defined as dynamic, and if that doesn’t throw a\ncompile-time error it will just call <code>with-redefs</code>.</p><pre><code>(core/defmacro binding\n  &quot;binding => var-symbol init-expr\n  Creates new bindings for the (already-existing) vars, with the\n  supplied initial values, executes the exprs in an implicit do, then\n  re-establishes the bindings that existed before.  The new bindings\n  are made in parallel (unlike let); all init-exprs are evaluated\n  before the vars are bound to their new values.&quot;\n  [bindings &amp; body]\n  (core/let [names (take-nth 2 bindings)]\n    (cljs.analyzer/confirm-bindings &amp;env names)\n    `(with-redefs ~bindings ~@body)))\n</code></pre><p><code>with-redefs</code> is even more curious.</p><pre><code>(core/defmacro with-redefs\n  &quot;binding => var-symbol temp-value-expr\n  Temporarily redefines vars while executing the body.  The\n  temp-value-exprs will be evaluated and each resulting value will\n  replace in parallel the root value of its var.  After the body is\n  executed, the root values of all the vars will be set back to their\n  old values. Useful for mocking out functions during testing.&quot;\n  [bindings &amp; body]\n  (core/let [names (take-nth 2 bindings)\n             vals (take-nth 2 (drop 1 bindings))\n             orig-val-syms (map (comp gensym #(core/str % &quot;-orig-val__&quot;) name) names)\n             temp-val-syms (map (comp gensym #(core/str % &quot;-temp-val__&quot;) name) names)\n             binds (map core/vector names temp-val-syms)\n             resets (reverse (map core/vector names orig-val-syms))\n             bind-value (core/fn [[k v]] (core/list 'set! k v))]\n    `(let [~@(interleave orig-val-syms names)\n           ~@(interleave temp-val-syms vals)]\n       ~@(map bind-value binds)\n       (try\n         ~@body\n         (finally\n           ~@(map bind-value resets))))))\n</code></pre><p>This one takes a bit more effor to read, but the clue is in this line:\n<code>bind-value (core/fn [[k v]] (core/list 'set! k v))</code>. Basically what the example\nfrom above translates to is:</p><pre><code>(set! *foo* 123)\n(try\n  (greetings)\n  (finally\n    (set! *foo* nil)))\n</code></pre><p>That’s it, that’s all there is. Somewhat anti-climactic I must admit. It just\nsets the value, calls your code, and sets it back afterwards.</p><p>(<a shape=\"rect\" href=\"https://github.com/clojure/clojurescript/blob/23cedecbf4f704f9fee672e395bbfa1e3fe3ee1a/src/main/clojure/cljs/core.cljc#L2232-L2267\">with-redefs and binding in context</a>)</p><p>So do you need <code>:dynamic</code> in ClojureScript? Or can you just use <code>with-redefs</code>,\nor even just <code>set!</code>? It looks like it, although there are of course good reasons\n(readability, showing intent) to still use them if you want to rebind something\nlater on.</p><p>So case closed? Not really. I had this nagging suspicion that there might still\nbe more going on, so I went through the compiler and analyzer to see what they\ndo with things marked as <code>:dynamic</code>, and sure enough in <code>cljs.compiler</code> we find\nthis:</p><pre><code>(defmethod emit* :invoke\n  [{f :fn :keys [args env] :as expr}]\n  (let [info (:info f)\n        fn? (and ana/*cljs-static-fns*\n                 (not (:dynamic info))\n                 (:fn-var info))\n        ,,,] ,,,))\n</code></pre><p>So what are we looking at? This is the code that emits (prints out JavaScript)\nfunction invocations. Usually this just emits things like <code>foo.call(123)</code>, but\nthere’s an optimization you can enable that makes calling multi-arity functions\na bit faster. When you have a function like</p><pre><code>(defn foo\n  ([arg1] ,,,)\n  ([arg1 arg2] ,,,))\n</code></pre><p>Then ClojureScript will emit three functions: one that takes one argument, one\nthat takes two, and one that dispatches to the right one based on\n<code>arguments.length</code>.</p><p>When you enable the <code>:static-fns</code> compiler option then ClojureScript will try to\navoid calling the dispatch function, calling the specific arity versions\ndirectly. But… this would break when you rebind the dispatch function, so if\n<code>:static-fns</code> is enabled, and the function you’re calling is dynamic, then emit\na regular <code>foo.call(...)</code>.</p><p>(Note that there are some caveats with <code>:static-fns</code>. At the ClojureScript\nInternals workshop that David Nolen gave in Berlin earlier this year he\nmentioned it may actually perform worse than when you leave it off. I don’t\nremember the exact details, it might have been because it prevents some Google\nClosure Compiler optimizations.)</p><p><strong><a shape=\"rect\" href=\"https://clojureverse.org/t/advent-of-parens-2019/5159\">Comment on ClojureVerse</a></strong></p></div>",
   :direction "ltr"},
  :updated 1576055589000,
  :entities
  [{:mentions [{:text "Google"}],
    :id "nlp/f/entity/wd:95",
    :salienceLevel "mention",
    :label "Google"}],
  :alternate
  [{:href
    "https://lambdaisland.com/blog/2019-12-09-advent-of-parens-9-dynamic-vars-clojurescript",
    :type "text/html"}],
  :title "Advent 2019 part 9, Dynamic Vars in ClojureScript",
  :author "Arne Brasseur",
  :published-str "Wed Dec 11 01:13:09 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16eeb337bb9:1509042:69b9f616",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://lambdaisland.com/blog/2019-12-09-advent-of-parens-9-dynamic-vars-clojurescript",
  :updateCount 1,
  :commonTopics
  [{:score 72.48647325658408,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 22.60189843159853,
    :id "nlp/f/topic/3048",
    :salienceLevel "about",
    :label "aerospace"}],
  :published 1576055589000,
  :fingerprint "aa078d6a",
  :canonicalUrl
  "https://lambdaisland.com/blog/2019-12-09-advent-of-parens-9-dynamic-vars-clojurescript"}
 {:engagement 5,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1575891564775,
  :content
  {:content
   "<div>\n<p><em>Issue 355 – December 09, 2019 · <a href=\"https://purelyfunctional.tv/newsletter-archives/\">Archives</a> · <a title=\"Thanks, Jeff!\" href=\"https://purelyfunctional.tv/newsletter/\">Subscribe</a></em></p>\n<h2>Clojure Tip 💡</h2>\n<p><em>memoize to trade space for speed</em></p>\n<p>In the last issue, part of the bonus of the challenge was to use memoization to speed up the straightforward recursive solution. This is a common use case for memoization.</p>\n<p>Take, for example, an implementation of Fibonacci that is a direct translation of the mathematical definition.</p>\n<p><img title=\"\" src=\"https://purelyfunctional.tv/wp-content/uploads/2019/12/fibonacci-1.png\"></p>\n<pre><code>(defn fib [n]\n  (cond\n    (= 0 n) 0\n    (= 1 n) 1\n    :else   (+' (fib (- n 2)) (fib (- n 1)))))\n</code></pre>\n<p>Try to run that function, however, on anything bigger than <code>n=10</code> and it takes much longer than you would think. Why? Because it is calculating the same numbers over and over.</p>\n<p>When you call <code>(fib 50)</code>, that will have to calculate <code>(+ (fib 8) (fib 9))</code>. But <code>(fib 9)</code> also has to calculate <code>(fib 8)</code>! There’s quite a lot of duplication.</p>\n<p>We could change the approach and build up the answer starting at the beginning. That would solve this problem and be very fast. But that’s hard to read. You lose the natural translation from the mathematical formula.</p>\n<p>Another solution is to find a way to store the answer the first time you calculated it so that the next time you need it, you just look it up. That’s where memoization comes from.</p>\n<p>Memoization basically means wrapping a function with another function. That wrapper function will cache the answers and the next time you pass the same arguments, it will return the cached answer. If you apply it to <code>fib</code> above, it will run fast again, yet the code still reflects the mathematical formula.</p>\n<p>The Levenshtein distance in the challenge last week had the same problem as Fibonacci. It has a nice, succinct, recursive definition.</p>\n<p><img title=\"\" src=\"https://purelyfunctional.tv/wp-content/uploads/2019/12/levenshtein.png\"></p>\n<p><code>lev</code> is called recursively and things are recalculated many times. Calling this function on long strings will be slow. The answer is to memoize it. You use space to store the calculated answers, but save time since you don’t have to re-calculate.</p>\n<p>If you’re interested in how to implement memoization, I have a <a title href=\"https://lispcast.com/what-is-memoization/\">podcast episode</a> about it. Clojure comes with a function called <a title href=\"https://clojuredocs.org/clojure.core/memoize\"><code>memoize</code></a> and there is also a more <a title href=\"https://github.com/clojure/core.memoize\">feature-rich, configurable and extensible library</a>.</p>\n<p>Next week, I’ll go deeper into memoization and its limitations.</p>\n<h2>Awesome book 📖</h2>\n<p><a title href=\"https://www.amazon.com/Timeless-Way-Building-Christopher-Alexander/dp/0195024028\"><em>The Timeliness Way of Building</em></a></p>\n<p>Whenever I need inspiration about the creative process, I pick up this book. The premise is that Christopher Alexander, a mathematician and architect, was trying to find a way to tap into our deep intuitions about how to build. The language touches the mystical. For me, it has a unique way of reminding me of all of the things that are important that are often overlooked when following strict process. The aim is to imagine and build something that helps humans thrive, which is something I aspire to.</p>\n<h2>Book update 📖</h2>\n<p>Chapter 5 is out! Buy it now: <a title href=\"https://lispcast.com/gs\"><em>Grokking Simplicity</em></a>.</p>\n<p>I’m currently working on Chapter 7, which is all about Stratified Design. There is so much to say. It’s a hard chapter because it’s all about design, which takes years of experience to develop a sense for. If someone has the experience, what I say will seem obvious. If they don’t have the experience, it will seem arbitrary. How can I condense the experience into the pages so that the reader can see what I am talking about?</p>\n<p>You can <a title href=\"https://lispcast.com/gs\">buy the book</a> and use the coupon code <strong>TSSIMPLICITY</strong> for 50% off.</p>\n<h2>Clojure Challenge 🤔</h2>\n<h3>Last week’s challenge</h3>\n<p>The challenge in <a title href=\"https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-354-tip-beware-how-many-threads-you-start/\">Issue 354</a> was to implement the Levenshtein distance. Here are the <a title href=\"https://gist.github.com/ericnormand/704f07e8aa041edace319afead3aac73\">submissions</a>.</p>\n<h3>This week’s challenge</h3>\n<p><em>A-Star Algorithm</em></p>\n<p>A neat algorithm for finding a short path through a graph is <a title href=\"https://en.wikipedia.org/wiki/A*_search_algorithm\"><em>A-Star</em></a>. It’s used in a lot of games for the characters to find paths through a map.</p>\n<p>One thing that’s fun about this algorithm is that it’s traditionally formulated in terms of mutable data structures. What would this look like as a functional implementation?</p>\n<p>Your task is to implement A-Star in Clojure. You can use mutable state if you want! The <a title href=\"https://en.wikipedia.org/wiki/A*_search_algorithm\">Wikipedia page</a> has a good description of the algorithm.</p>\n<p>As usual, please reply to this email and let me know what you tried. I’ll collect them up and share them in the next issue. If you don’t want me to share your submission, let me know.</p>\n<p>Rock on!<br>Eric Normand</p>\n</div>\n<p>The post <a rel=\"nofollow\" href=\"https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-355-tip-memoize-to-trade-space-for-time/\">PurelyFunctional.tv Newsletter 355: Tip: memoize to trade space for time</a> appeared first on <a rel=\"nofollow\" href=\"https://purelyfunctional.tv\">PurelyFunctional.tv</a>.</p>",
   :direction "ltr"},
  :updated 1575889200000,
  :entities
  [{:mentions [{:text "A-Star"}],
    :id "nlp/f/entity/wd:922201",
    :salienceLevel "mention",
    :label "Suzuki Alto"}],
  :alternate
  [{:href
    "https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-355-tip-memoize-to-trade-space-for-time/",
    :type "text/html"}],
  :title
  "PurelyFunctional.tv Newsletter 355: Tip: memoize to trade space for time",
  :author "Eric Normand",
  :published-str "Mon Dec 09 03:00:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16eea74f8e7:13d692b:97b0c8f7",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url
   "https://purelyfunctional.tv/wp-content/uploads/2019/12/fibonacci-1.png",
   :width 1448,
   :height 302,
   :contentType "image/png"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://purelyfunctional.tv/?p=42018",
  :commonTopics
  [{:score 0.5539399959230125,
    :id "nlp/f/topic/10100",
    :salienceLevel "about",
    :label "digest"}
   {:score 62.7758682282641,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.876,
    :id "nlp/f/topic/2140",
    :salienceLevel "about",
    :label "space"}],
  :published 1575889200000,
  :fingerprint "ea9d3bdc",
  :canonicalUrl
  "https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-355-tip-memoize-to-trade-space-for-time/"}
 {:engagement 12,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/todo",
    :label "todo"}
   {:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1575880982937,
  :content
  {:content
   "<p>It's sharing time!</p>\n<h2>Rich Hickey: <em>That</em> talk</h2>\n<p><strong>Simple Made Easy</strong> is the most mind bending talk I've ever seen. I think most Clojure programmers will tell you that. I'm not really a <em>Clojure programmer</em>, I like lots of things, but I do have an extra special relationship with Clojure, Datomic and the thoughts that lies underneath the surface.</p>\n<p>This talk is about Clojure, without really mentioning Clojure.</p>\n<a href=\"https://www.infoq.com/presentations/Simple-Made-Easy/\">\n<p><img src=\"https://augustl.com/static/posts/all_time_favorite_talks/simple_made_easy.jpg\">\n</p></a><p><a href=\"https://www.infoq.com/presentations/Simple-Made-Easy/\"></a><a href=\"https://www.infoq.com/presentations/Simple-Made-Easy/\">https://www.infoq.com/presentations/Simple-Made-Easy/</a></p>\n<h2>Kathryn McKinley: How Google makes search fast</h2>\n<p>Google clocks down CPUs to save power, but if a search is taking too long they'll clock up a core and re-run the search there. The talk goes in detail about how they figured out where to set the thresholds here, and what they do to achieve their goal of having 98% of searches complete in under 200 milliseconds. (Or was it 99% and 300 milliseconds? Don't remember the exact details there.)</p>\n<p><a href=\"https://www.thestrangeloop.com/2017/measuring-and-optimizing-tail-latency.html\">https://www.thestrangeloop.com/2017/measuring-and-optimizing-tail-latency.html</a></p>\n<h2>Byrd &amp; Friedman: Writing programs that write themselves as output - and more shenaningans</h2>\n<p>For example, if you fast forward to 0:45:00, you'll see how they generate all possible programs that return the number 6.</p>\n<p>Pretty mind blowing that this stuff is even possible</p>\n<p><a href=\"http://2013.flatmap.no/danwill.html\">http://2013.flatmap.no/danwill.html</a></p>\n<h2>Guy Steele: the worst program ever written</h2>\n<p>It's pretty cool to see how horrible software used to be in the 70s. He talks about cool auto-parallelism stuff in his own language, Fortress, with the context of all the things we used to have to think about when writing software in the (not so good) old days.</p>\n<a href=\"https://www.infoq.com/presentations/Thinking-Parallel-Programming/\">\n<p><img src=\"https://augustl.com/static/posts/all_time_favorite_talks/parallell_programming.jpg\">\n</p></a><p><a href=\"https://www.infoq.com/presentations/Thinking-Parallel-Programming/\"></a><a href=\"https://www.infoq.com/presentations/Thinking-Parallel-Programming/\">https://www.infoq.com/presentations/Thinking-Parallel-Programming/</a></p>\n<h2>Strange Loop</h2>\n<p>A bit of meta at the end. 3 of the 4 talks above are from <a href=\"https://thestrangeloop.com/\">Strange Loop</a>. And the last one <em>could</em> have been from Strange Loop - they've had a few talks there as well, it's just that when I saw them, it was at <a href=\"https://flatmap.no\">flatMap</a>.</p>\n<p>You should <em>totally</em> go to Strange Loop.</p>",
   :direction "ltr"},
  :updated 1575846000000,
  :entities
  [{:mentions [{:text "Google"}],
    :id "nlp/f/entity/wd:95",
    :salienceLevel "mention",
    :label "Google"}],
  :alternate
  [{:href "http://augustl.com/blog/2019/my_all_time_favorite_talks/",
    :type "text/html"}],
  :title "My all-time favorite talks",
  :author "August Lilleaas",
  :published-str "Sun Dec 08 15:00:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16ee9d38199:130111d:97b0c8f7",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url
   "https://augustl.com/static/posts/all_time_favorite_talks/simple_made_easy.jpg",
   :width 2622,
   :height 1416,
   :contentType "image/jpeg"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "urn:augustl-com:feed:post::blog:2019:my_all_time_favorite_talks",
  :commonTopics
  [{:score 43.016058483976074,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1575846000000,
  :fingerprint "b5ed1953",
  :canonicalUrl
  "http://augustl.com/blog/2019/my_all_time_favorite_talks/"}
 {:engagement 12,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1575834897984,
  :content
  {:content
   "<p><em>This article is part of the <a href=\"http://metaredux.com/posts/2019/12/01/meta-advent-2019.html\">“Meta Advent 2019”</a> series. I’ve committed to writing\na new blog post here every day until Christmas.</em></p>\n<p>Yesterday I was reminded of one of my favourite aspects of blogging - you share\nsome knowledge, but you also gain a lot of knowledge in return. To be more\nspecific - several readers commented on my article <a href=\"http://metaredux.com/posts/2019/12/07/dead-simple-emacs-screencasts.html\">Dead Simple Emacs\nScreencasts</a>, that they\nactually thought the article would cover how to record screencasts with Emacs\nitself. I have to admit this caught me by surprise, as even though I know well\nenough that Emacs can do anything, I still never thought of trying to record\nscreencasts with it. I’ve been using tools like Apple Quicktime for conventional\nscreencasts and <a href=\"https://www.cockos.com/licecap/\">LICEcap</a> or\n<a href=\"https://gifox.io/\">Gifox</a> for simple animated gifs. Let’s see if we can do\nbetter and record some awesome screencasts straight from Emacs!</p>\n<p>Well, it turns out that there’s a mode for that!<sup><a href=\"http://metaredux.com/posts/2019/12/08/recording-screencasts-with-emacs.html#fn:1\">1</a></sup> It’s named\n<a href=\"https://gitlab.com/ambrevar/emacs-gif-screencast\">gif-screencast</a> and seems to\nbe a fairly new addition to the Emacs ecosystem, as its first commit is from\nFebruary 2018. The package basically creates a single frame for each action you\ntake by making a screenshot. This simple approach has the nice benefit of\noptimizing the size of the resulting gif, as it elimates awkward pauses when\nyou’re not doing anything. As a bonus, it’s possible to easily edit the end\nresult! Here’s a bit of the project’s rationale straight from its README:</p>\n<blockquote>\n<p>Most of the time, one user action equals one visual change. By exploiting this\nfact, this package tailors GIF-screencasting for Emacs and captures one frame\nper user action. It’s much more efficient than capturing frames even at a\nfrequency as low as 10 per second. You could roughly expect 3 to 10 times\nsmaller files compared to videos of the same quality.</p>\n</blockquote>\n<p>Internally the mode shells out to several command-line tools that do the heavy lifting:</p>\n<ul>\n<li>a screenshot taking tool (by default that’s <code>scrot</code> on Linux and <code>screencapture</code> on macOS)</li>\n<li>an image cropping tool (ImageMagick’s <code>mogrify</code> by default)</li>\n<li>a tool to convert those screenshots into a gif (ImageMagick’s <code>convert</code> by default).</li>\n<li>a tool to optimize the final gif (<code>gifsicle</code> by default). Alternative you can\njust set <code>gif-screencast-want-optimized</code> to <code>nil</code>.</li>\n</ul>\n<p>All of those are configurable via <code>defcustom</code>s. You can check them out by doing <code>M-x customize-group gif-screencast</code>.</p>\n<p>I guess it’s clear at this point it’s a good idea to install ImageMagick to have <code>gif-screencast</code> work well.\nIf you’re using Linux you don’t do much besides getting the external tools installed, but macOS users will need a bit of extra\nsetup. Put something like this in your Emacs config:</p>\n<div><div><pre><code><span>(</span><span>with-eval-after-load</span> <span>'gif-screencast</span>\n  <span>(</span><span>setq</span> <span>gif-screencast-args</span> <span>'</span><span>(</span><span>&quot;-x&quot;</span><span>))</span> <span>;; To shut up the shutter sound of `screencapture' (see `gif-screencast-command').</span>\n  <span>(</span><span>setq</span> <span>gif-screencast-cropping-program</span> <span>&quot;mogrify&quot;</span><span>)</span> <span>;; Optional: Used to crop the capture to the Emacs frame.</span>\n  <span>(</span><span>setq</span> <span>gif-screencast-capture-format</span> <span>&quot;ppm&quot;</span><span>)</span> <span>;; Optional: Required to crop captured images.</span>\n</code></pre></div></div>\n<p>If you’re on a HiDPI display you’ll also need to patch your <code>gif-screencast</code> installation a bit:</p>\n<div><div><pre><code><span>(</span><span>advice-add</span>\n <span>#'</span><span>gif-screencast--cropping-region</span>\n <span>:around</span>\n <span>(</span><span>lambda</span> <span>(</span><span>oldfun</span> <span>&amp;rest</span> <span>r</span><span>)</span>\n   <span>(</span><span>apply</span> <span>#'</span><span>format</span> <span>&quot;%dx%d+%d+%d&quot;</span>\n          <span>(</span><span>mapcar</span>\n           <span>(</span><span>lambda</span> <span>(</span><span>x</span><span>)</span> <span>(</span><span>*</span> <span>2</span> <span>(</span><span>string-to-number</span> <span>x</span><span>)))</span>\n           <span>(</span><span>split-string</span> <span>(</span><span>apply</span> <span>oldfun</span> <span>r</span><span>)</span> <span>&quot;[+x]&quot;</span><span>)))))</span>\n</code></pre></div></div>\n<p>That’s quite the setup, right? Don’t worry, we’re done with it!\nNow you can finally do <code>M-x gif-screencast</code> and create your first screencast! Let’s play a bit with CIDER:</p>\n<p><img alt=\"gif_screencast_demo.gif\" src=\"http://metaredux.com/assets/images/gif_screencast_demo.gif\"></p>\n<p>When you’re done with your screencast you have to do <code>M-x\ngif-screencast-stop</code>. You can also pause a recording with <code>M-x\ngif-screencast-pause</code>. On macOS by default the screencasts get saved to\n<code>~/Videos/emacs</code>. On Linux <code>XDG_VIDEO_DIR</code> would be used (typically it’s\n<code>~/Video</code>).</p>\n<p>A couple of notes:</p>\n<ul>\n<li>For me at least Emacs became a bit slow during the screencast recording, but this wasn’t a major issue.</li>\n<li>I’ve noticed that <code>gif-screencast</code> doesn’t handle properly scrolling (e.g. in a REPL buffer).</li>\n<li>Cropping is broken on HiDPI displays. See <a href=\"https://gitlab.com/ambrevar/emacs-gif-screencast/issues/14\">this issue</a> for details.</li>\n<li>It’s hard to show overlays that are immediately cleared on the next command. This is clearly visible in the example I showed earlier.</li>\n<li>Even with optimization enabled the resulting gif for me was much bigger than what I’d get from Gifox. Perhaps I did something\nwrong.</li>\n<li>It’s a good idea to bind the commands for starting, pausing and stopping screencasts to some keybindings:</li>\n</ul>\n<div><div><pre><code><span>(</span><span>with-eval-after-load</span> <span>'gif-screencast</span>\n  <span>(</span><span>global-set-key</span> <span>(</span><span>kbd</span> <span>&quot;&lt;f8>&quot;</span><span>)</span> <span>#'</span><span>gif-screencast-toggle-pause</span><span>)</span>\n  <span>(</span><span>global-set-key</span> <span>(</span><span>kbd</span> <span>&quot;&lt;f9>&quot;</span><span>)</span> <span>#'</span><span>gif-screencast-stop</span><span>))</span>\n</code></pre></div></div>\n<p>Interestingly <code>emacs-gif-screencast</code> defines <code>gif-screencast-mode</code>, but doesn’t bind any keybindings there\nby default. That certainly seems like an opportunity for improvement to me.</p>\n<p>So, all in all <code>gif-screencast</code> is a pretty cool tool that proves once again how versatile Emacs is.\nUnfortunately, it’s also a bit rough around the edges, so I’ll probably stick with Gifox for the time being.\nStill, I’m pretty excited about the possibilities created by <code>gif-screencast</code> and I’ll certainly keep an eye on it.\nThat’s all I have for you today! Emacs forever!</p>\n<div>\n<ol>\n<li>\n<p>What a shocker, right? <a href=\"http://metaredux.com/posts/2019/12/08/recording-screencasts-with-emacs.html#fnref:1\">↩</a></p>\n</li>\n</ol>\n</div>",
   :direction "ltr"},
  :updated 1575804600000,
  :entities
  [{:mentions [{:text "macOS"}],
    :id "nlp/f/entity/wd:14116",
    :salienceLevel "mention",
    :label "macOS"}],
  :alternate
  [{:href
    "http://metaredux.com/posts/2019/12/08/recording-screencasts-with-emacs.html",
    :type "text/html"}],
  :title "Recording Screencasts with Emacs",
  :author "Bozhidar Batsov",
  :published-str "Sun Dec 08 03:30:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16ee7144e40:103b754:97b0c8f7",
  :visual {:url "none"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "http://metaredux.com/posts/2019/12/08/recording-screencasts-with-emacs",
  :commonTopics
  [{:score 25.219012686798038,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1575804600000,
  :fingerprint "e83a10ca",
  :canonicalUrl
  "http://metaredux.com/posts/2019/12/08/recording-screencasts-with-emacs.html"}
 {:engagement 6,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1575813632199,
  :recrawled 1575906394440,
  :content
  {:content
   "<div><p><em>This post is part of <a shape=\"rect\" href=\"https://lambdaisland.com/blog/2019-11-25-advent-of-parens\">Advent of Parens\n2019</a>, my attempt to\npublish one blog post a day during the 24 days of the advent.</em></p><p>I’ve always been a big UNIX fan. I can hold my own in a shell script, and I\nreally like the philosophy of simple tools working on a uniform IO abstraction.\nUniform abstractions are a huge enabler in heterogenous systems. Just think of\nUniform Resource Locators and Identifier (URLs/URIs), one of the\n<a shape=\"rect\" href=\"https://www.ics.uci.edu/~fielding/pubs/dissertation/top.htm\">cornerstones</a> of\nthe web as we know it.</p><p>Unfortunately since coming to Clojure I feel like I’ve lost of some of that\npower. I’m usually developing against a Clojure process running inside (or at\nleast connected to) my trusty editor, and the terminal plays second fiddle. How\ndo I pipe things into or out of that?</p><p>On top of that consider that most UNIX tools are line based (grep, awk, sed,\ncut, …), how do I marry that with Clojure’s EDN view of the world (another\nfabulous uniform abstraction).</p><p>I already covered <code>nc</code>, <code>rep</code>, and <code>jet</code> in a previous post. Each of these is\njust a single focused tool, but together they start to form a kind of Swiss army\nknife. Today I’ll look at a few more of these: HTTPie, Pup, kafkacat and websocat.</p><p><a shape=\"rect\" href=\"https://httpie.org/\">HTTPie</a> is a tasty alternative to <code>curl</code>. It’s a bit more\nintuitive when it comes to passing along custom headers or parameters, and it\ncan pretty print and format JSON. I have to thank Tommi from Metosin for\nindirectly introducing me to this one, I came across it in one of the Metosin\nREADMEs (can’t remember which one).</p><p>After adoping HTTPie (the command is simply <code>http</code>) life was great, until I\ntried to use it to connect to a websocket. Websockets are kind of HTTP so I\nthought it might work, but they’re also kind of their own thing so I don’t blame\nthe devs for leaving this out. Focused tools, right? Fortunately there’s\n<a shape=\"rect\" href=\"https://github.com/vi/websocat\">websocat</a> to do just that.</p><p>See how there’s a common theme here? We have various mechanisms for shuttling\ndata from one place to another, either as a stream, or a single shot transfer,\nand we’re simply hooking these to UNIX pipes. (Macbook owners can think of\ndongles as an apt metaphor).</p><p>The final tool I want to mention is <code>kafkacat</code>, you can probably guess by now\nwhat it does. I’ve been poking around a bit with Kafka lately, and having a\nsimple command line client for both sending and receiving was super helpful to\ndebug and better understand things.</p><p>So this is your set of dongles:</p><ul><li>TCP streams: <code>nc</code></li><li>Websocket streams: <code>websocat</code></li><li>HTTP requests: <code>http</code></li><li>kafka topics: <code>kafkacat</code></li><li>nREPL connections: <code>rep</code></li></ul><p>But just plugging things together isn’t always enough, they also need to speak\nthe same format. In the Clojure world we like things like Transit and EDN, but\nthe rest of the world speaks JSON, or XML/HTML, or CSV, and UNIX tools like to\nhave simple lines of text, so we need to convert between these formats.</p><p>I already mentioned <code>jet</code>, and <code>jq</code> is helpful for extracting things from JSON.\nThe final one I want to introduce in this series is <code>pup</code>, which is like <code>jq</code>\nfor HTML.</p><p>For instance:</p><pre><code>get-latest-datomic-version () {                   \n    http https://my.datomic.com/downloads/free | pup .latest attr{href} | sed 's^/downloads/free/^^'\n}\n</code></pre><p>Or say so you are putting Transit on a Kafka topic, but you want to see that as\npretty printed EDN to inspect what’s going over the wire? easy peasy.</p><pre><code>kafkacat -b 127.0.0.1:9092 -t topic-1 | jet --from transit --pretty\n</code></pre><ul><li><code>jet</code> convert/query EDN/Transit/JSON ; pretty-print EDN</li><li><code>jq</code> convert/query/pretty-print JSON</li><li><code>pup</code> extract from HTML/XML</li></ul><p>And of course all the classics are still there, <code>sed</code>, <code>grep</code>, <code>awk</code>, <code>cut</code>,\n<code>head</code>, <code>tail</code>, <code>tee</code> and many more.</p><p><strong><a shape=\"rect\" href=\"https://clojureverse.org/t/advent-of-parens-2019/5159\">Comment on ClojureVerse</a></strong></p></div>",
   :direction "ltr"},
  :updated 1575903337000,
  :entities
  [{:mentions [{:text "Macbook"}],
    :id "nlp/f/entity/wd:3065317",
    :salienceLevel "mention",
    :label "MacBook"}],
  :alternate
  [{:href
    "https://lambdaisland.com/blog/2019-12-08-advent-of-parens-8-everything-is-a-pipe",
    :type "text/html"}],
  :title "Advent 2019 part 8, Everything is (not) a pipe",
  :author "Arne Brasseur",
  :published-str "Mon Dec 09 06:55:37 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16ee5cfd0c7:f0ad93:69b9f616",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://lambdaisland.com/blog/2019-12-08-advent-of-parens-8-everything-is-a-pipe",
  :updateCount 1,
  :commonTopics
  [{:score 58.81313402654308,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.739,
    :id "nlp/f/topic/2148",
    :salienceLevel "mention",
    :label "spiritual"}],
  :published 1575903337000,
  :fingerprint "35989971",
  :canonicalUrl
  "https://lambdaisland.com/blog/2019-12-08-advent-of-parens-8-everything-is-a-pipe"}
 {:engagement 7,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1575807463978,
  :content
  {:content
   "The first draft of the second edition is complete and a lot of the editing work is done. There are …<p><a href=\"https://dataissexy.wordpress.com/2019/12/08/machine-learning-book-update-ai-machinelearning-java-clojure-kafka-dl4j-weka-spark/\">Continue reading <span>→</span></a></p>",
   :direction "ltr"},
  :updated 1575805430000,
  :alternate
  [{:href
    "https://dataissexy.wordpress.com/2019/12/08/machine-learning-book-update-ai-machinelearning-java-clojure-kafka-dl4j-weka-spark/",
    :type "text/html"}],
  :title
  "Machine Learning book update…. #ai #machinelearning #java #clojure #kafka #dl4j #weka #spark",
  :author "Jason Bell",
  :published-str "Sun Dec 08 03:43:50 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16ee571b22a:e80726:97b0c8f7",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url
   "https://dataissexy.files.wordpress.com/2017/12/cropped-24961595908_e21a3d155c_k.jpg",
   :width 960,
   :height 317,
   :contentType "image/jpeg"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "http://dataissexy.wordpress.com/?p=1852",
  :commonTopics
  [{:score 25.60774498485186,
    :id "nlp/f/topic/3000",
    :salienceLevel "about",
    :label "artificial intelligence"}
   {:score 25.606160249101823,
    :id "nlp/f/topic/3002",
    :salienceLevel "about",
    :label "data science"}],
  :published 1575805430000,
  :fingerprint "af4f0109",
  :canonicalUrl
  "https://dataissexy.wordpress.com/2019/12/08/machine-learning-book-update-ai-machinelearning-java-clojure-kafka-dl4j-weka-spark/"}
 {:engagement 4,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1575805672734,
  :content
  {:content
   "It’s been a while since I looked at the Luminus web development framework for Clojure. I know some folk find …<p><a href=\"https://dataissexy.wordpress.com/2019/12/08/a-little-gotcha-in-luminus-request-in-layout-renders-clojure-webdev-luminus/\">Continue reading <span>→</span></a></p>",
   :direction "ltr"},
  :updated 1575803866000,
  :alternate
  [{:href
    "https://dataissexy.wordpress.com/2019/12/08/a-little-gotcha-in-luminus-request-in-layout-renders-clojure-webdev-luminus/",
    :type "text/html"}],
  :title
  "A Little Gotcha in Luminus request in Layout Renders….. #clojure #webdev #luminus",
  :author "Jason Bell",
  :published-str "Sun Dec 08 03:17:46 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16ee5565d1e:e60d39:97b0c8f7",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url
   "https://dataissexy.files.wordpress.com/2017/12/cropped-24961595908_e21a3d155c_k.jpg",
   :width 960,
   :height 317,
   :contentType "image/jpeg"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "http://dataissexy.wordpress.com/?p=1846",
  :commonTopics
  [{:score 52.53384947182026,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1575803866000,
  :fingerprint "4cb9ea8e",
  :canonicalUrl
  "https://dataissexy.wordpress.com/2019/12/08/a-little-gotcha-in-luminus-request-in-layout-renders-clojure-webdev-luminus/"}
 {:engagement 29,
  :unread true,
  :crawled 1575805672734,
  :recrawled 1575880982937,
  :content
  {:content
   "<p>The first thing I look for when checking out a new programming language is immutable persistent data structures. This is an injury I've gotten from Clojure, which has them out of the box. I tend to structure my whole app around these kinds of data structures. They are smart, fast, efficient, immutable and amazing.</p>\n<p>In this post, I'll try to make you feel the same way about them.</p>\n<h2>Axiom: immutability is good</h2>\n<p>I'm not going to try to sell this one. Because it's a tough sell.</p>\n<p>As in, I know a few people that don't like immutable values, and I have no idea how to sell it to them.</p>\n<p>Personally, I like to use something that fundamentally eliminates a whole category of bugs from my code.</p>\n<p>Sorry. Couldn't resist being snarky. I don't want to trash talk those who don't like immutability. But I just don't get it.</p>\n<h2>The problem with immutable values is that they're immutable</h2>\n<p>Let's say you have an immutable hash map or something. It's implemented using some kind of tree structure under the hood, like a lot of data structures are.</p>\n<p><img src=\"https://augustl.com/static/posts/you_have_to_Know_about_persistent_data_structures/the_basic.png\">\n</p><p>The problem happens when we want to add a key to this map. The data structure is immutable, so we can't change it!</p>\n<p>So, we have to create a whole new copy of everything, an add our new stuff to it.</p>\n<p><img src=\"https://augustl.com/static/posts/you_have_to_Know_about_persistent_data_structures/complete_clone.png\">\n</p><p>(Red = new stuff)</p>\n<p>A new node was added at the bottom right of the image. And we had to copy <em>all the data</em> in the tree structure, since we can't change the immutable original.</p>\n<p>So that's the end of the story, then? Immutability sucks, because you have to copy everything all the time you want to change something?</p>\n<p>Well, yes.</p>\n<p>But, also, no.</p>\n<h2>Copy on write - nah</h2>\n<p>I mean, I'm not gonna diss copy on write completely. There does exist some mildly useful software that leverages it, such as the Linux Kernel.</p>\n<p>The whole central and important concept of forking a process in Linux/Unix, relies on copy on write (CoW). When you have a process that uses 11GB of RAM, and you fork it, you have a new process, identical to the original one, with its own copy of the 11GB of RAM. To make the process of forking not horribly tear-inducingly slow, the kernel relies on CoW. The action of forking doesn't actually do anything to those 11GBs of RAM. It's only when you start writing to memory from the fork, that the kernel starts copying and then writing - copy on write - the memory of the original process.</p>\n<p>CoW is technically speaking a type of persistent data structure.</p>\n<p>However, CoW is at its most useful when the data is mutable. When your data is immutable to the core, you have another option.</p>\n<p>That other option is...</p>\n<h2>Structural sharing - yass</h2>\n<p>Now <em>this</em> is my kind of persistent data structure.</p>\n<p>So.</p>\n<p>We have this huge data structure. We know that it is immutable. We want to change one little piece of it. What optimization can we run on this process?</p>\n<p>Do you see it yet?</p>\n<p>The old data structure <em>is immutable</em>. We can just use that!</p>\n<p><img src=\"https://augustl.com/static/posts/you_have_to_Know_about_persistent_data_structures/structural_sharing.png\">\n</p><p>(Red = new stuff)</p>\n<p>See what we did? Why copy immutable data?</p>\n<p>We just need to create a new root node, a new 2nd node, and a new data node, and then just point to the old stuff! The old stuff is immutable, after all. The whole idea is that it will never change.</p>\n<p>You just understood the Clojure state model. The values themselves are immutable. You can have functions that takes an immutable value, that return an updated immutable value. Creating new immutable values is cheap - because you can share almost all of the data with the old immutable value.</p>\n<p>Yay!</p>\n<h2>Clojure does another really cool thing</h2>\n<p>In the real world, it turns out that if you just have a small map with just a handful of keys, operating on a fancy tree structure can be kind of expensive.</p>\n<p>Under the hood, Clojure will do a very cool optimization: if your map has fewer than 8 (I think) items in it, it will just be represented as a normal mutable list under the hood.</p>\n<p>When you add an item, Clojure will make a full copy of that list, containing the old items and the newly added item.</p>\n<p>Why is that cool?</p>\n<p>Well, it turns out that it's actually faster to do it that way, when you only have a small amount of data. Checking a list of 8 items for whether or not your key exists in it, is much faster than having to maintain and balance a binary tree or a b-tree.</p>\n<p>Think of it like garbage collection generations. Under the hood, your stuff will be in the &quot;eden&quot; space or &quot;tenured&quot; space. Which is fancy speak for: stuff that is just created and immediately discarded is garbage collected differently than long lived stuff. This happens completely under the hood, as a performance optimization, without you having to do anything special to make it happen.</p>\n<h2>An other another cool thing!</h2>\n<p>Let's say you have this function in a tight loop that adds 100s of items to a map, based on a data stream of some kind. Maybe a CSV or a database or something like that.</p>\n<p>By default, all maps are immutable, so that means you have to do 100s of potentially expensive operations on the persistent data structures.</p>\n<p>However! Clojure has transients.</p>\n<p>Transients are a special version of immutable data structures. You first &quot;unlock&quot; it and create a &quot;transient&quot; map (or list or set or ...).</p>\n<p>Here's a normal immutable example:</p>\n<pre><code><span>(</span><span>->></span> <span>[</span><span>1</span> <span>2</span> <span>3</span> <span>4</span><span>]</span>\n     <span>(</span><span>reduce</span>\n       <span>(</span><span>fn </span><span>[</span><span>res</span> <span>curr</span><span>]</span> <span>(</span><span>conj </span><span>res</span> <span>(</span><span>+ </span><span>1</span> <span>curr</span><span>)))</span>\n       <span>[]))</span>\n<span>;; [2 3 4 5]</span></code></pre> <p>Here it is with transients. Notice how we have to use special versions of the functions, like <code>conj!</code> instead of <code>conj</code>.</p>\n<pre><code><span>(</span><span>->></span> <span>[</span><span>1</span> <span>2</span> <span>3</span> <span>4</span><span>]</span>\n     <span>(</span><span>reduce</span>\n       <span>(</span><span>fn </span><span>[</span><span>res</span> <span>curr</span><span>]</span> <span>(</span><span>conj!</span> <span>res</span> <span>(</span><span>+ </span><span>1</span> <span>curr</span><span>)))</span>\n       <span>(</span><span>transient</span> <span>[])))</span>\n<span>;; clojure.lang.PersistentVector$TransientVector@139e6e1d</span></code></pre> <p>Whoops! We forgot to make it persistent:</p>\n<pre><code><span>(</span><span>->></span> <span>[</span><span>1</span> <span>2</span> <span>3</span> <span>4</span><span>]</span>\n     <span>(</span><span>reduce</span>\n       <span>(</span><span>fn </span><span>[</span><span>res</span> <span>curr</span><span>]</span> <span>(</span><span>conj!</span> <span>res</span> <span>(</span><span>+ </span><span>1</span> <span>curr</span><span>)))</span>\n       <span>(</span><span>transient</span> <span>[]))</span>\n     <span>(</span><span>persistent!</span><span>))</span>\n<span>;; [2 3 4 5]</span></code></pre> <p>This optimization allows Clojure to know that in your tight loop, nobody else will actually use the data structure, so it can be &quot;less fancy&quot; in how it builds it up. And much faster, skipping the entire potential overhead of managing a persistent data structure.</p>\n<p>Clojure has pretty cool data structures.</p>",
   :direction "ltr"},
  :updated 1575759600000,
  :alternate
  [{:href
    "http://augustl.com/blog/2019/you_have_to_know_about_persistent_data_structures/",
    :type "text/html"}],
  :title "You have to know about persistent data structures",
  :author "August Lilleaas",
  :published-str "Sat Dec 07 15:00:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16ee5565d1e:e60d38:97b0c8f7",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url
   "https://augustl.com/static/posts/you_have_to_Know_about_persistent_data_structures/the_basic.png",
   :width 1487,
   :height 912,
   :contentType "image/png"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "urn:augustl-com:feed:post::blog:2019:you_have_to_know_about_persistent_data_structures",
  :updateCount 2,
  :commonTopics
  [{:score 76.64763338700602,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.934,
    :id "nlp/f/topic/253",
    :salienceLevel "about",
    :label "big data"}
   {:score 0.702,
    :id "nlp/f/topic/663",
    :salienceLevel "mention",
    :label "digital transformation"}],
  :published 1575759600000,
  :fingerprint "c8964ad7",
  :canonicalUrl
  "http://augustl.com/blog/2019/you_have_to_know_about_persistent_data_structures"}
 {:engagement 5,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1575750276419,
  :content
  {:content
   "<div><p><em>This post is part of <a shape=\"rect\" href=\"https://lambdaisland.com/blog/2019-11-25-advent-of-parens\">Advent of Parens\n2019</a>, my attempt to\npublish one blog post a day during the 24 days of the advent.</em></p><p><code>doto</code> is a bit of an oddball in the Clojure repertoire, because Clojure is a\nfunctional language that emphasizes pure functions and immutabilty, and <code>doto</code>\nonly makes sense when dealing with side effects.</p><p>To recap, <code>doto</code> takes a value and a number of function or method call forms. It\nexecutes each form, passing the value in as the first argument. At the end of\nthe ride it returns the original value.</p><p>The typical example of using <code>doto</code> is for dealing with mutable Java objects</p><pre><code>(doto (java.util.HashMap.)\n  (.put &quot;hello&quot; &quot;world&quot;)\n  (.put &quot;hi&quot; &quot;earth&quot;))\n;; => {&quot;hi&quot; &quot;earth&quot;, &quot;hello&quot; &quot;world&quot;}\n</code></pre><p>And it really cleans up invoking the Builder pattern.</p><pre><code>(.build\n (doto (FooBuilder.)\n   (.setBar 123)\n   (.toggleQux)\n   (.setName &quot;hello&quot;)))\n</code></pre><p>But what I want to show is that there are a few places where <code>doto</code> is useful\nwhen you’re not doing Java interop.</p><p>The first is with <code>prn</code> or <code>println</code>. These functions return <code>nil</code>, so if you\nwant to quickly add a <code>prn</code> to check what a function is returning you have to\nwork around that, for instance by adding a let.</p><pre><code>;; say you have something like this\n(foo (bar (baz x)))\n\n;; what's coming back from `baz`?\n;; this does not work:\n(foo (prn (bar (baz x))))\n\n;; you could do this, but that's a mouthful\n(let [x (bar (baz x))]\n  (prn x)\n  (foo x))\n\n;; instead throw in a `(doto ... prn)`\n(foo (doto (bar (baz x)) prn))\n</code></pre><p>The cool thing is this also works in thread-first forms (not in thread-last\nthough), just throw that <code>(doto prn)</code> in between any two forms.</p><pre><code>(-> x\n    baz\n    (doto prn)\n    bar\n    foo)\n</code></pre><p>Or with some markers to make the output a bit more obvious:</p><pre><code>(-> x\n    baz\n    (doto (prn '&lt;-baz))\n    bar\n    (doto (prn '&lt;-bar))\n    foo)\n</code></pre><p>You can also throw in a <code>(doto ... assert)</code> if you’re getting paranoid that\nthere’s a <code>nil</code> somewhere where you don’t expect it.</p><p>And if you’re using Datomic from a REPL or from tests, and you want to be able\nto quickly recreate an in-memory database, you can do this.</p><pre><code>(let [uri (doto &quot;datomic:mem:test1&quot; d/delete-database d/create-database)\n      conn (d/connect uri)]\n  ,,,)\n</code></pre><p><strong><a shape=\"rect\" href=\"https://clojureverse.org/t/advent-of-parens-2019/5159\">Comment on ClojureVerse</a></strong></p></div>",
   :direction "ltr"},
  :updated 1575747838000,
  :entities
  [{:mentions [{:text "the Builder"}],
    :id "nlp/f/entity/wd:4986440",
    :salienceLevel "mention",
    :label "Building"}],
  :alternate
  [{:href
    "https://lambdaisland.com/blog/2019-12-07-advent-of-parens-7-do-that-doto",
    :type "text/html"}],
  :title "Advent 2019 part 7, Do that doto",
  :author "Arne Brasseur",
  :published-str "Sat Dec 07 11:43:58 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16ee2091543:b89a66:97b0c8f7",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://lambdaisland.com/blog/2019-12-07-advent-of-parens-7-do-that-doto",
  :commonTopics
  [{:score 29.524502582982436,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1575747838000,
  :fingerprint "36a0c7b1",
  :canonicalUrl
  "https://lambdaisland.com/blog/2019-12-07-advent-of-parens-7-do-that-doto"}
 {:engagement 10,
  :unread true,
  :crawled 1575735788309,
  :content
  {:content
   "In case you didn’t know, I started a podcast this year: No Manifestos. One of the interesting things about podcasting is that it’s difficult to know who’s listening. This has even been suggested as the reason for the genre’s success, as it prevents the aggressive tracking and reductionist analytics that have made such a cesspool… <p><a href=\"https://stuartsierra.com/2019/12/07/web-analytics-in-a-serverless-world\">Read the full article</a></p><img alt=\"\" width=\"1\" src=\"http://feeds.feedburner.com/~r/StuartSierra/~4/dd4RZlKotKQ\" height=\"1\">",
   :direction "ltr"},
  :updated 1575733286000,
  :alternate
  [{:href
    "http://feedproxy.google.com/~r/StuartSierra/~3/dd4RZlKotKQ/web-analytics-in-a-serverless-world",
    :type "text/html"}],
  :title
  "Old Fashioned Web Analytics in a Newfangled Serverless World",
  :author "Stuart",
  :published-str "Sat Dec 07 07:41:26 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16ee12c0315:a9ccff:97b0c8f7",
  :visual {:url "none"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://stuartsierra.com/?p=1216",
  :published 1575733286000,
  :fingerprint "d8c5df13",
  :canonicalUrl
  "http://feedproxy.google.com/~r/StuartSierra/~3/dd4RZlKotKQ/web-analytics-in-a-serverless-world"}
 {:engagement 4,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/todo",
    :label "todo"}
   {:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1575693606284,
  :recrawled 1575714809440,
  :content
  {:content
   "<p><img alt=\"MECCA NSF\" src=\"https://porkostomus.gitlab.io/img/nsf.png\"></p><p>This could plausibly stand for:</p><ol><li>MECCA, Not Safe For [anyone, anywhere]</li><li>Nintendo Sound Format</li></ol><p>We'll ignore the first interpretation for now and go with the second.</p><p><a href=\"https://wiki.nesdev.com/w/index.php/NSF\">NSF</a> files contain the music from Nintendo games. While working on the main <a href=\"https://github.com/porkostomus/mecca\">music sequencer</a> part of this project, I recalled the main part of my motivation - my discontent with other music software, in particular their inability to play well together, even talk to each other. I realized that I consider absolutely vital in my music application the ability to interface with as many other formats as possible.</p><h2>A brief naive tour of some music encoding formats</h2><p><em>This is simply a sketch of the formats I deal with in this project. For a better treatment and modern solutions, check out <a href=\"https://github.com/alda-lang/alda\">Alda</a>!</em></p><ol><li>MusicXML - This is actually the most common format for scorewriters, such as Sibelius, Finale and Musescore. It is also the only one I'm mentioning here that is human readable, as it is simply sheet music described in XML. I'm working on a <a href=\"https://github.com/porkostomus/musicxml-parser\">MusicXML parser</a> which will likely be covered in a future post, but it is important to note that this is a markup language. Its primary focus is on describing the layout of notes on the page.</li><li>MIDI - In contrast, <a href=\"https://www.midi.org/specifications\">MIDI files</a> contain just pure note data, as a stream of hexadecimal bytes representing on/off events and other commands. This is the scope of <a href=\"https://github.com/porkostomus/mecca-midi\">MECCA MIDI</a>, and will likely be covered in a future post. Suffice to say here that this is the standard format for digital music storage and distribution. (We are talking about <em>note data</em>, not <em>audio</em>)</li><li>NSF files - Like MIDI, also a binary format, but here we have something completely different... the music is literally written in 6502 machine code!</li></ol><p>So it turns out, a parsing project has turned into a CPU emulation project. That is cool, because I'm up for the challenge. However, our emulator does not need to operate in real time, so I like to think of it as more of a <em>static analyser</em> in that all we need to do is make our program aware of just enough instructions to recreate the music score. Let's see how far we get! We'll start with the .nsf file of Super Mario Bros. but feel free to upload one of your own (you can find them <a href=\"https://www.zophar.net/music/nintendo-nes-nsf\">here</a>).</p><pre><code>(ns mecca.klipse\n  (:require [reagent.core :as r]\n            [goog.object :as o]\n            [goog.crypt :as crypt]))\n</code></pre><pre><code>(def file-atom (r/atom &quot;4E45534D1A011201C4BD34BED0F25375706572204D6172696F2042726F732E0000000000000000000000000000004B6F6A69204B6F6E646F0000000000000000000000000000000000000000000031393835204E696E74656E646F000000000000000000000000000000000000001A410000000000000000000000000000000048A200BD00BE9500E8D0F8BD00BF9D0007E8D0F768A007C90D900938E90DA000A24086FCC9079004C838E907AAA901E000F0050ACA4CF3BD99F40060004FD0010028200005EB000000000800000000000000000000000000000000000000000000000000000000000000000000000001AABD44BEA2004CC4BD0000000000000000020103040C0A07080B05090D0F0E101112131400000000000000000000000000000000000000000000010101010100000000000000000000000000000000000000286060606060000000000000000000000000000000000000000000000000000000000000000000000000000000000001010000000000000000000000000000000000000000000000B0E0000000000000000000000000000000000000000000000090A6019F1300000000180000000801FA11273E0000000000000001300000000000000028000700000002000000000100000000000000FFFF002490010000010801000001000A000802FFFF000000000000000301000C00000000000200000000000000008000000105C2000000012800000000020000010000000200000100000000000000000000000100030000000000101E00000000000A000000000000000900180000000000000000000000000000000000000000000000000000000000A1185A6ADE0BB70000BD01000905030E0309050E000000000030B800000000001200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003080700000000A56900959FC5023010BD3304C9809009A502959FA9009D330468F02BA50249FFA8C88407BD330438E5019D3304B59FE900959FC5071010BD3304C980B009A507959FA9FF9D330460B50F480AB01268F0034C82C8AD1F072907C907F00E4CCCC068290FA8B90F00D002950F600303060606060606070707050904050608090A060B1040B0B08040408040F0F0F0A56D38E904856DAD250738E9048D2507AD1A0738E9048D1A07AD1B0738E9048D1B07AD2A0738E9048D2A07A9008D3B078D2B078D39078D3A07B9F89B8D2C0760AD4507F05EAD2607D059A00B883054AD5F07D96BC0D0F5AD2507D976C0D0EDA5CED981C0D023A51DC900D01DAD5F07C906D023EED906EEDA06ADDA06C903D01EADD906C903F00FD007AD5F07C906F0E6208CC02071D0A9008DDA068DD906A9008D4507ADCD06F0109516A901950FA900951E8DCD064C26C2AC3907B1E9C9FFD0034C16C2290FC90EF00EE005900AC8B1E9293FC92EF00160AD1D0718693029F08507AD1B0769008506AC3907C8B1E90A900BAD3B07D006EE3B07EE3A0788B1E9290FC90FD019AD3B07D014C8B1E9293F8D3A07EE3907EE3907EE3B074CCCC0AD3A07956EB1E929F09587CD1D07B56EED1B07B00BB1E9290FC90EF0694C50C2A507D587A506F56E9041A90195B6B1E90A0A0A0A95CFC9E0F04CC8B1E92940F005ADCC06F06DB1E9293FC9379004C93F9031C906D007AC6A07F002A9029516A901950F2026C2B50FD04960ADCB06D009AD9803C901D00BA92F9516A900951E206CC2604C1BC7C8C8B1E94A4A4A4A4ACD5F07D00E88B1E98D5007C8B1E9291F8D51074C5BC2AC3907B1E9290FC90ED003EE3907EE3907EE3907A9008D3B07A60860B516C915B00DA8B5CF690895CFA9019DD8039820048E0EC30EC30EC31EC3F0C228C3F1C242C36BC3F0C275C375C3F7C287C7D1C74AC33DC385C3A0C7F0C2A0C7A0C7A0C7A0C7B8C7F0C2F0C25CC45CC45CC45CC459C4F0C2F0C2F0C2F0C2DFC712C83FC845C80BC803C80BC84BC857C849C560BC1EB9F0C2F0C2F0C2F0C2F0C207C381C860200EC34C46C3A90295B695CF4A9D96074A951E4C46C3A9B895CF60F8F4A001AD6A07D00188B90CC395584C5AC3200EC3A901951E608050A9009DA2039558ACCC06B926C39D9607A90B4C5CC3A9004C19C3A9009558A909D012A030B5CF9D01041002A0E09875CF9558A9039D9A04A9029546A90095A09D340460A9029546A9099D9A04602046C3BDA70729109558B5CF9D340460ADCB06D00BA9008DD106203DC34CD9C74C98C9262C32382022242613141516AD8F07D03CE005B038A9808D8F07A004B91600C911F02B8810F6EED106ADD106C907901DA204B50FF005CA10F93010A900951EA9119516208AC3A92020D8C5A60860A5CEC92C90F9B91E00D0F4B96E00956EB987009587A90195B6B9CF0038E90895CFBDA7072903A8A202B998C39501C8C8C8C8CA10F4A608206CCFA457C008B00EA8BDA8072903F0059849FFA8C8982046C3A0029558C9003001889446A9FD95A0A901950FA905951E60283828382800001010002075C5A9009558B51638E91BA8B94FC49D8803B954C49534B5CF18690495CFB5871869049587B56E6900956E4CD9C78030408030505070204080A0704090680E05060E1C20100C1E22181410602048AD8F07D0A12046C3BDA8072903A8B9A4C48D8F07A003ADCC06F001C88400E400B084BDA707290385008501A9FB95A0A900A457F007A904C01990010A481865008500BDA8072903F007BDA907290F850068186501A8B998C49558A9019546A557D012A400982902F00BB55849FF1869019558F646982902F00FA586187988C49587A56D69004C3CC5A58638F988C49587A56DE900956EA901950F95B6A9F895CF602075C58E6803A9008D63038D6903B5878D6603A9DF8D90079546A9208D64039D8A07A9058D83044A8D650360A0FFC8B90F00D0FA8CCF068A0980990F00B56E996E00B587998700A901950F99B600B5CF99CF006090807090FF01AD8F07D0F49D3404A5FD090285FDAC6803B91600C92DF03120D9D1186920ACCC06F00338E9108D8F07BDA70729039D1704A8B99DC595CFAD1D071869209587AD1B076900956E4C1FC6B9870038E90E9587B96E00956EB9CF0018690895CFBDA70729039D1704A8B99DC5A000D5CF9001C8B9A1C59D3404A9008DCB06A9089D9A04A90195B6950F4A9D0104951E60003060600020604070406030AD8F07D047A9208D8F07CED706A00688B91600C931D0F8B9870038E93048B96E00E9008500ADD70618791E00A868187931C69587A5006900956EB937C695CFA90195B6950F4A9558A90895A0600102040810204080403090502060A0700A0BAD8F07D06FAD4E07D057E003B066A000BDA707C9AA9001C8AD5F07C901F001C8982901A8B99AC69516ADDD06C9FFD005A9008DDD06BDA7072907A8B98AC62CDD06F007C89829074CD6C60DDD068DDD06B992C620D8C59D1704A9208D8F074C6CC2A0FFC8C005B00DB90F00F0F6B91600C908D0EF60A5FE090885FEA908D0A8A00038E93748C904B00B48A006AD6A07F002A002688401A0B02902F002A0708400AD1B078502AD1D078503A002684A9001C88CD306A2FFE8E005B02DB50FD0F7A5019516A502956EA50395871869188503A50269008502A50095CFA90195B6950F206CC2CED306D0CC4C5EC2A90195584A951E95A0B5CF9D340438E9189D1704A9094CDBC7B5168DCB0638E91220048EA4C3B7C7A8C4A3C53DC69CC660A005B91600C911D005A901991E008810F1A9008DCB06950F60A9029546A9F89558A9039D9A0460D6CFD6CFACCC06D005A0022071C8A0FFADA003951E10028AA88CA003A9009546A82071C8A9FF9DA2034C28C8A90095584C28C8A040B5CF100749FF186901A0C09D0104981875CF95582063C3A905AC4E07C003F007ACCC06D002A9069D9A0460204BC84C48C82057C84C2BC8A9109D3404A9FF95A04C60C8A9F09D3404A90095A0A0012071C8A9049D9A0460080CF80000FFB58718796BC89587B56E796EC8956E6060A608A900B416C015900398E91420048EE0C835C995D2D6C8D6C8D6C8D6C847C947C947C947C947C947C947C947C9D6C865C965C965C965C965C965C965C94DC94DC965D085BC4BB9D6C8D9D2BAB8D6C8A4B7D7C86020AFF12052F14C7DE8A9009DC50320AFF12052F1207DE82043E220C1DF2033DA2053D8AC4707D0032005C94C7AD6B51620048E77CA77CA77CA77CA77CAD8C977CA89CB36CC34C94ACC4ACCB0C9B0D3F9CAFFCA25CB28CF77CA34C9DFCE6020EBD120AFF12052F12043E22053D84C7AD6203CCD4C7AD620AFF12052F1204CE2207BDB2052F12066ED2055D64C7AD620AFF12052F12073E22045DBAD4707D0032082C92052F120C8E54C7AD6B51638E92420048E32D4D3D54FD64FD607D631D63DD6A900950F9516951E9D10019D96079D25019DC5039D8A0760BD9607D01620F7C2BDA80709809D3404290F09069D9607A9F995A04C92BF301C00E8001808F80CF4B51E2920F0034CE5CAB53CF02DD63CADD103290CD06ABDA203D017ACCC06B9CEC99DA2032094BA9009B51E0908951E4C58CADEA2034C58CA2037B51E2907C901F03EA9008500A0FAB5CF3013A0FDC970E600900BC600BDA8072901D002A0FA94A0B51E0901951EA5003DA907A8ADCC06D001A8B910CA9D8A07BDA80709C0953CA0FCA5092940D002A0049458A0012043E1300AC8BD9607D004A9F895589446A000B51E2940D019B51E0AB030B51E2920D05BB51E2907F024C905F004C903B0302063BFA000B51EC902F00C2940F00DB516C92EF007D0034C02BFA001B558481002C8C81879D0C995582002BF68955860BD9607D01E951EA5092901A8C8944688AD6A07F002C8C8B9D4C99558602063BF4C02BFC90ED009B516C906D0032098C9602092BF4C02BFB5A01D3404D0139D1704B5CFDD0104B009A5092907D002F6CF60B5CFD55890034C75BF4C70BF2045CB2066CBA001A5092903D011A5092940D002A0FF8400B5CF18650095CF60A9138501A5092903D00DB458B5A04AB00AC401F003F65860F6A06098F0FAD65860B55848A001B5A02902D00BB55849FF1869019558A00294462002BF8500689558603F03B51E2920D04DACCC06BDA8073987CBD0128A4A9004A445B008A0022043E1100188944620DFCBB5CF38FD3404C920900295CFB44688D00EB5871875589587B56E6900956E60B58738F5589587B56EE900956E604C8CBFB5A02902D037A509290748B5A04AB01568D011BD34041869019D34049558C902D002F6A06068D014BD340438E9019D34049558D007F6A0A9029D960760BD9607F008A5094AB002F6CF60B5CF6910C5CE90F0A90095A060B51E2920F0034C92BFA9E895584C02BF40800404B51E2920F0034C8CBF8503B51638E90AA8B946CC8502BD010438E5029D0104B587E9009587B56EE900956EA9208502E0029049B558C9109016BD17041865029D1704B5CF650395CFB5B669004CACCCBD170438E5029D1704B5CFE50395CFB5B6E90095B6A000B5CF38FD34041007A01049FF186901C90F900398955860000103040506070708000306090B0D0E0F100004090D101316171800060C12161A1D1F2000070F161C212527280009121B21272C2F30000B151F272E333738000C18242D353B3E40000E1B28323B424648000F1F2D38424A4E50001122313E49515658010302000009121B242D363F48515A630C1820AFF1ADD1032908D074AD4707D00ABD88032010D4291F95A0B5A0B416C01F900DC908F004C918D00518690195A085EF2052F1208ECEBCE506ADB9039900028507ADAE039903028506A90185002008CEA005B516C91F9002A00B84EDA9008500A5EF208ECE20BBCDA500C904D008ACCF06B9E5068506E600A500C5ED90E260A5038505A406A5014605B00449FF6901186DAE039903028506CDAE03B009ADAE0338E5064CE6CD38EDAE03C9599004A9F8D015ADB903C9F8F00EA5024605B00449FF6901186DB903990002850720EDEC9848AD9F070D4707D0708505A4B588D069A4CEAD5407D005AD1407F009E605E60598186918A89838E507100549FF186901C908B01CA506C9F0B016AD0702186904850438E506100549FF186901C9089013A505C902F023A405A5CE18793ACDE6054C32CEA201A504C506B001E88646A200A50048202CD9688500681869048506A6086048290FC9099005490F1869018501A400B92ECD186501A8B9C7CC85016848186908290FC9099005490F1869018502A400B92ECD186502A8B9C7CC8502684A4A4AA8B92ACD850360F8A070BD002020200000B51E2920F008A9009DC5034C92BF2002BFA00DA9052096BFBD34044A4A4A4AA8B5CF38F9D5CE100549FF186901C908B00EBD34041869109D34044A4A4A4AA8B9DACE9DC50360153040B51E2920F0034C63BFB51EF00BA90095A08DCB06A910D013A9128DCB06A002B925CF9901008810F7206CCF9558A001B5A02901D00AB55849FF1869019558C894464C02BFA0002043E1100AC8A50049FF1869018500A500C93C901CA93C8500B516C911D01298D5A0F00DB5A0F006D658B558D0409895A0A500293C4A4A8500A000A557F024AD7507F01FC8A557C9199008AD7507C9029001C8B516C912D004A557D006B5A0D002A000B90100A40038E9018810FA601A5898969492908E8C8A8886848280AE6803B516C92DD0108608B51EF01A2940F006B5CFC9E0900AA98085FCEE72074C71D0208CBF4C7BD1CE6403D044A9048D6403AD630349018D6303A9228505AC6903B9DDCF8504AC0003C8A20C20CD8AA608208F8AA90885FEA90185FDEE6903AD6903C90FD00B2063C3A940951EA98085FE4C7BD121411131B51E2920F014B5CFC9E0909EA2042098C9CA10FA8DCB06A60860A9008DCB06AD4707F0034C39D1AD630310034C0FD1CE6403D00DA9208D6403AD630349018D6303A509290FD004A9029546BD8A07F01C2043E11017A9019546A9028D6503A9209D8A078D9007B587C9C8B03EA5092903D038B587CD6603D00CBDA7072903A8B961D08DDC06B587186D65039587B446C001F017A0FF38ED6603100749FF186901A001CDDC0690038C6503BD8A07D028208CBFAD5F07C9059009A5092903D0032094BAB5CFC980901CBDA7072903A8B961D09D8A074C49D1C901D009D6CF2063C3A9FE95A0AD5F07C907F004C905B027AD9007D022A9208D9007AD630349808D630330E120D9D1ACCC06F00338E9108D9007A9158DCB0620BCD1A010B5464A9002A0F098187587ACCF06998700B5CF18690899CF00B51E991E00B546994600A50848AECF068608A92D951620BCD1688508AAA9008D6A0360EE6A0320D7C8B51ED0F5A90A9D9A042043E24C53D8BF40BFBFBF4040BFAC6703EE6703AD670329078D6703B9D1D160AD4707D030A940ACCC06F002A9608500BD010438E5009D0104B587E9019587B56EE900956EBC1704B5CFD99DC5F006187D340495CF2052F1B51ED0C3A9518500A002A5092902F002A0828401BCE506A200ADB903990002A500990102E600A501990202ADAE039903021869088DAE03C8C8C8C8E8E00390D9A60820AFF1BCE506ADD1034A489005A9F8990C02684A489005A9F8990802684A489005A9F8990402684A9005A9F899000260D6A0D00CA90895A0F658B558C903B0182052F1ADB9038DBA03ADAE038DAF03BCE506B5582017ED60A900950FA90885FEA9058D38014C36D3000008080008000854555657A9008DCB06AD4607C905B02C20048E11D3F2D212D34ED3A2D3A005ADFA07C901F00EA003C903F008A000C906F002A9FF8DD706941EEE460760ADF8070DF9070DFA07F0F1A5092904F004A91085FEA023A9FF8D3901205F8FA9058D3901A00BAD5307F002A011205F8FAD53070A0A0A0A09044C36BCB5CFC9729005D6CF4C65D3ADD706F0383036A9168DCB062052F1BCE506A203ADB903187DCDD2990002BDD5D2990102A922990202ADAE03187DD1D2990302C8C8C8C8CA10DAA608602065D3A9069D9607EE4607602065D3BD9607D005ADB107F0EF60B51ED056BD8A07D051B5A0D023B55830142043E11009A50049FF1869018500A500C9219035B55849FF1869019558F6A0BD3404B4581003BD17048500A5094A9019AD4707D014B5CF18755895CFC500D009A90095A0A9409D8A07A9209DC503608507B534D00EA018B5581865079558B5A0690060A008B55838E5079558B5A0E90060B5B6C903D0034C98C9B51E100160A8BDA2038500B546F0034CBBD5A92DD5CF900FC400F00818690295CF4CB1D54C98D5D9CF00900DE400F0F418690299CF004CB1D5B5CF48BDA2031018BD34041869058500B5A06900301AD00CA500C90B900CB004C508F00C20B7BF4CA7D420B1D54CA7D420B4BFB41E6838F5CF1879CF0099CF00BDA2033004AA2021DCA408B9A000193404F077AE0003E020B070B9A00048482041D5A5019D0103A5009D0203A9029D0303B9A000300DA9A29D0403A9A39D05034CFFD4A9249D04039D0503B91E00A86849FF2041D5A5019D0603A5009D0703A9029D080368100DA9A29D0903A9A39D0A034C30D5A9249D09039D0A03A9009D0B03AD000318690A8D0003A6086048B98700186908AECC06D00318691048B96E00690085026829F04A4A4A8500B6CF6810058A186908AA8AAE00030A2A482A290309208501A50229010A0A050185016829E01865008500B9CF00C9E89006A50029BF85006098AA20AFF1A9062011DAADAD039D1701A5CE9D1E01A90195462063C399A000993404609848206BBF68AA206BBFA608BDA2033004AA2021DCA60860B5A01D3404D0159D1704B5CFDD0104B00BA5092907D002F6CF4CFED5B5CFD558900620B7BF4CFED520B4BFBDA20330032021DC60A90E2047CB2066CBBDA203301CA5861865008586A56DA400300569004C28D6E900856D8CA1032021DC60BDA20330062088BF2021DC602002BF8500BDA2033007A91095582014D660205BD64CFED5205BD64C71D6AD4707D019BD1704187D34049D1704B5CF75A095CF60BDA203F0032019DC60B516C914F055AD1C07B416C005F004C00DD0026938E9488501AD1A07E9008500AD1D0769488503AD1B0769008502B587C501B56EE5003020B587C503B56EE5023019B51EC905F013C00DF00FC030F00BC031F007C032F0032098C960FFFFFFB524F0560AB053A5094AB04E8A0A0A18691CA8A20486019848B51E2920D034B50FF030B516C9249004C92B9026C906D006B51EC902B01CBDD803D0178A0A0A186904AA2027E3A6089009A9809524A601203ED768A8A601CA10BBA60860060002121107052D2052F1A601B50F100B290FAAB516C92DF00CA601B516C902F06BC92DD02DCE8304D0622063C395588DCB06A9FE95A0AC5F07B936D79516A920C003B0020903951EA98085FEA601A909D033C908F036C90CF032C915B02EB516C90DD006B5CF691895CF201BE0B51E291F0920951EA902B416C005D002A906C006D002A9012011DAA90885FF60A5094A9036AD47070DD603D02E8A0A0A186924A82025E3A608901BBDBE06D01BA9019DBE06B56449FF1869019564AD9F07D0084C2CD9A9009DBE06602098C9A9062011DAA92085FEA539C902900EC903F024A9238D9F07A94085FB60AD5607F01BC901D023A608A9028D560720F185A608A90C4C47D8A90B9D100160A9018D5607A909A0002048D96018E830D008F8A5094AB0F42041DCB023BDD803D01EA50EC908D018B51E2920D0122052DC2025E3A608B009BD910429FE9D910460B416C02ED0034C00D8AD9F07F0064C95D70A0604BD910429011DD803D059A9011D91049D9104C012F04EC00DF07DC00CF079C033F042C015B071AD4E07F06CB51E0AB034B51E2907C902902CB516C906F025A90885FFB51E0980951E2005DAB94FD89558A903186D8404BC9607C003B003B992D82011DA60A59F3002D06AB516C9079009A5CE18690CD5CF905BAD9107D056AD9E07D03DADAD03CDAE0390034CF6D9B546C901D0034CFFD9AD9E07D024AE5607F0228D5607A9088D9E070A85FF20F185A90AA001850E841DA0FF8C4707C88C7507A608608657E886FCA9FC859FA90BD0E102060506B516C912F0BDA90485FFB516A000C914F01BC908F017C933F013C90CF00FC8C905F00AC8C911F005C8C907D01DB965D92011DAB54648202FE0689546A920951E2063C39558A9FD859F60C909901D29019516A000941EA9032011DA2063C32005DAB951D895584CF1D9100BA904951EEE8404AD8404186D91072011DAEE9107AC6A07B9D2D99D9607A9FC859F60B546C901D0034C2CD9201CDB4C2CD9A0012043E11001C8944688609D1001A9309D2C01B5CF9D1E01ADAE039D170160804020100804027FBFDFEFF7FBFDA5094A90ECAD4E07F0E7B516C915B06EC911F06AC90DF066BDD803D0612052DCCA305B86019848B50FF04CB516C915B046C911F042C90DF03EBDD803D0398A0A0A186904AA2027E3A608A4019020B51E191E002980D011B991043D25DAD018B991041D25DA99910420B4DA4CAADAB991043D2CDA99910468A8A601CA10A5A60860B91E00151E2920D033B51EC906902EB516C905F027B91E000A900AA9062011DA2095D7A40198AA2095D7A608BD2501186904A6012011DAA608FE250160B91E00C906901DB91600C905F0F12095D7A401B92501186904A6082011DAA601FE25016098AA201CDBA608B516C90DF022C911F01EC905F01AC912F008C90EF004C907B00EB55849FFA8C89458B5464903954660A9FF9DA203AD4707D029B51E3025B516C924D006B51EAA205FDB2041DCB0148A2054DCB5CF85008A482025E368AA900320BCDBA60860AD4707D0379DA2032041DCB02FA9028500A6082052DC2902D022B9AD04C92090052025E3B019B9AD0418698099AD04B9AF0418698099AF04C600D0D5A60860A608B9AF0438EDAD04C904B008A59F1004A901859FADAF0438F9AD04C906B01BA59F3017A500B416C02BF005C02CF0018AA6089DA203A900851D60A9018500ADAE0438F9AC04C908900DE600B9AE0418EDAC04C909B003204BDFA608608000A8B5CF187916DC2CB5CFA40EC00BF017B4B6C001D01138E92085CE98E90085B5A900859F8D330460ADD003C9F0B009A4B588D004A5CEC9D060A5080A0A186904A8ADD103290FC90F602010AD1607D02EA50EC90BF028C9049024A901AC0407D00AA51DF004C903D004A902851DA5B5C901D00BA9FF8D9004A5CEC9CF900160A002AD1407D00CAD5407D00788AD0407D00188B9ADE385EBA8AE5407AD1407F001E8A5CEDD62DC903520E9E3F03020A1DFB04FA49F1027A404C0049021208FDFB010AC4E07F013AC8407D00E20EDBC4CF6DCC926F004A90285FFA901859FA4EBA5CEC9CFB06020E8E320A1DFB0144820E8E38500688501D00CA500F04920A1DF90034C05DE209ADFB03CA49F3038C9C5D0034C0EDE20BDDEF02CAC0E07D023A404C0059007A54585004C4BDF20C4DEA9F025CE85CE20E8DEA900859F8D33048D8404A900851DA4EBC8C8A9028500C884EBA5CEC9209016C9E4B02820ECE3F00DC91CF009C96BF005209ADF9017A4EBC8A5CEC908900DC9D0B00920ECE3D005C600D0CB6020BDDEF061209ADF90034C2EDE20A1DFB05720DDDE9008AD0E07D04A4CFFDDA41DC000D03EA43388D039C96CF004C91FD031ADC403D004A01084FF09208DC403A586290FF00EA000AD1A07F001C8B903DE8DDE06A50EC907F00CC908D008A902850E60204BDF60A034201CDEEE48074CFEBBA9008D7207A9028D7007A9188557A402A90091064C4D8AF907FF001822506890A404C0069004C00A900160C924F004C925D039A50EC905F041A9018533EE2307A50EC904F01FA933201697A98085FC4A8D1307A204A5CE8D0F07DD29DEB003CAD0F88E0F01A904850E4C88DEC926D00AA5CEC920B004A901850EA903851DA90085578D0507A58638ED1C07C910B004A9028533A433A5060A0A0A0A187924DE8586A506D009AD1B07187926DE856D60C95FF002C9606020DDDE9013A9708D0907A9F98DDB06A9038D86074A8D0E0760C967F005C96818D0013860A50B2904F05CA500C911D056A501C910D050A9308DDE06A903850EA91085FFA9208DC403ADD606F03929030A0AAAA586C9609006E8C9A09001E8BCF287888C5F07BEB49CBDBC9C8D5007A98085FCA9008D51078D60078D5C078D5207EE5D07EE570760A900A457A600CAD00AE8C0003028A9FF4C66DFA202C001101DA901A0108C8507A0008457C90010018884001865868586A56D6500856D8A49FF2D90048D900460106188C420B0DFDD8BDF60246D8AC620B0DFDD96DF60C9C2F006C9C3F0021860A90185FE60A829C00A2A2AAA986001010202020510F0B51E2920D0F1205BE190ECB416C012D006B5CFC92590E0C00ED0034C63E1C005D0034C85E1C012F008C02EF004C007B07420AEE1D0034CE2E020B5E1F0F8C923D064A402A9009106B516C915B00CC906D003208EE1A9012011DAC9099010C911B00CC90A9004C90D900429019516B51E29F00902951ED6CFD6CFB516C907F007A9FDAC4E07D002A9FF95A0A0012043E11001C8B516C933F006C908F002944688B9BFDF955860A50438E908C905B072B51E2940D057B51E0A90034CFEE0B51EF0F9C905F01FC903B01AB51EC902D015A910B416C012D002A9009D9607A903951E204FE160B516C906F022C912D00EA9019546A9089558A5092907F010A0012043E11001C898D546D0032024E1204FE1B51E2980D005A900951E60B51E29BF951E60B516C903D004B51EF038B51EA80A9007B51E09404CFCE0B9B9DF951EB5CFC920901FA016A90285EBA5EBD546D00CA9012088E3F00520B5E1D008C6EBC8C01890E760E005F009B51E0A9004A90285FFB516C905D009A9008500A0FA4C37CA4C36DBB58738E5868500B56EE56D602063C3B5CF29F0090895CF60B5CF18693EC94460205BE1901AB5A0186902C903901120AEE1F00C20B5E1F007204FE1A9FD95A04CFEE020AEE1F01DC923D0082095D7A9FC95A060BD8A07D00CB51E2988951E204FE14CFEE0B51E0901951E60A900A0154C88E3C926F00EC9C2F00AC9C3F006C95FF002C96060B5D5C9189021209CE3F01C20B5E1F017B5A63018B53AD014A9FD95A6A901953AB5D529F895D560A900953A60A9809524A90285FF6002080E2003140D2002140E2002090E15000018060000200D0000300D0000080806040A08030E0D140002101504040C1C8A186907AAA002D0078A186909AAA006209CE24CDEE2A0488400A0444C52E2A0088400A004B58738ED1C078501B56EED1A0730060501F002A400982DD1039DD803D0194C7CE2E820F6F1CAC9FEB00D8A186901AAA001209CE24CDEE28A0A0AA8A9FF99B00499B10499B20499B304608600B9B8038502B9AD0385018A0A0A48A8BD99040A0AAAA501187DFDE199AC04A501187DFFE199AE04E8C8A502187DFDE199AC04A502187DFFE199AE0468A8A60060AD1C071869808502AD1A0769008501B586C502B56DE5019015B9AE04300DA9FFBEAC04300399AC0499AE04A60860B9AC041011C9A0900DA900BEAE04100399AE0499AC04A60860A2008406A9018507B9AC04DDAC04B02ADDAE049012F042B9AE04D9AC04903ADDAC04B035A40660BDAE04DDAC04902AB9AE04DDAC04B022A40660DDAC04F01ADDAE049015F013D9AE04900AF008B9AE04DDAC04B00418A40660E8C8C60710A938A40660488A186901AA684CA5E38A18690DAAA01B4CA3E3A01A8A186907AAA90020F0E3A608C9006000070E08030C02020D0D08030C02020D0D08030C02020D0D0800100414040404202008180818022020081808181220201818181818141406060810C8A9002CA901A200488404B9B0E31875868505B56D690029014A05056A4A4A4A20E19BA404B5CE1879CCE329F038E9208502A8B1068503A40468D005B5CE4C2BE4B586290F8504A50360FF00308400ADB903187933E4BE9A03BCE506840220AEE4ADAE03990302990B02991302186906990702990F02991702A921990202990A029912020940990602990E02991602A205A9E1990102C8C8C8C8CA10F4A402A500D005A9E0990102A200AD9D0338F90002C9649005A9F8990002C8C8C8C8E8E006D0E7A40060A206990002186908C8C8C8C8CAD0F3A402600400040000040004000800080800080080828183818380820303C3C3BCF306AD4707D008B52A297FC901F004A200F007A5094A4A2903AAADBE03187DC4E4990002187DCCE4990402ADB303187DC0E4990302187DC8E4990702BDD0E4990102BDD4E4990502BDD8E4990202990602A608ADD60329FCF009A900952AA9F820C1E560F950F750FAFBF8FBF6FBBCE506ADAE03990302186908990702990B0218690C8505B5CF20C1E56908990802AD0D018502A90185038504990202990602990A02A97E990102990902A97F990502AD0F07F0159818690CA8AD0F010AAABD41E58500BD42E520B2EBA608BCE506ADD103290EF014A9F8991402991002990C0299080299040299000260BCE5068402C8C8C8ADAE0320AEE4A608B5CF20BBE5AC4E07C003F005ACCC06F002A9F8BCE506991002991402A95BAE4307F002A975A608C820B5E5A902C820B5E5E820F6F1CABCE5060A489005A9F8990002680A489005A9F8990402680A489005A9F8990802680A489005A9F8990C02680A489005A9F8991002680A9005A9F8991402ADD1030A900320B3E560A5094AB002D6DBB5DB20C1E5ADB303990302186908990702A902990202990602A9F7990102A9FB9905024CBDE660616263BCF306B52AC902B0C6B5DB990002186908990402ADB303990302990702A5094A2903AABD82E6C820C1E588A902990202A982990602A6086076777879D6D6D9D98D8DE4E47677787902010201ACEA06ADB9031869088502ADAE038505A639BDCEE60DCA0385048A480A0AAAA90185078503BDBEE68500BDBFE620B2EBC60710F1ACEA0668F02FC903F02B8500A5094A29030DCA03990202990602A600CAF006990A02990E02B906020940990602B90E020940990E024C64EBFCFCAAABACADFCFCAEAFB0B1FCA5A6A7A8A9FCA0A1A2A3A469A56AA7A8A96BA06CA2A3A4FCFC96979899FCFC9A9B9C9DFCFC8F8E8E8FFCFC95949495FCFCDCDCDFDFDCDCDDDDDEDEFCFCB2B3B4B5FCFCB6B3B7B5FCFC70717273FCFC6E6E6F6FFCFC6D6D6F6FFCFC6F6F6E6EFCFC6F6F6D6DFCFCF4F4F5F5FCFCF4F4F5F5FCFCF5F5F4F4FCFCF5F5F4F4FCFCFCFCEFEFB9B8BBBABCBCFCFCBDBDBCBC7A7BDADBD8D8CDCDCECECFCF7D7CD18CD3D27D7C89888B8AD5D4E3E2D3D2D5D4E3E28B8AE5E5E6E6EBEBECECEDEDEEEEFCFCD0D0D7D7BFBEC1C0C2FCC4C3C6C5C8C7BFBECAC9C2FCC4C3C6C5CCCBFCFCE8E7EAE9F2F2F3F3F2F2F1F1F1F1FCFCF0F0FCFCFCFC0C0C000C0CA8543CEA184848CCC01818189024FF489CD2D8F0F6FC01020302010103030301010202210102010102FF02020101020202081818191A1918B5CF8502ADAE038505BCE50684EBA9008D0901B5468503BDC5038504B516C90DD00AB4583006BC8A07F00160B51E85ED291FA8B516C935D008A000A9018503A915C933D013C602A903BC8A07F00209208504A00084EDA908C932D008A003AE0E07BD78E885EF84ECA608C90CD007B5A03003EE0901AD6A03F009A016C901F001C884EFA4EFC006D01DB51EC9029004A20486EC29200D4707D00CA5092908D006A50349038503B95BE805048504B940E8AAA4ECAD6A03F030C901D013AD63031002A2DEA5ED2920F0038E09014C4BEAAD63032901F002A2E4A5ED2920F0EEA50238E91085024C46E9E024D011C005D00AA230A9028503A90585EC4CCAE9E090D012A5ED2920D009AD8F07C910B002A2964C37EAA5EFC904B010C002900CA25AA4EFC002D004A27EE602A5ECC904D01EA272E602A4EFC002F004A266E602C006D00CA254A5ED2920D004A28AC602A408A5EFC905D00CA5EDF0242908F05DA2B4D01CE048F018B99607C905B04EE03CD00DC901F046E602E602E6024C29EAA5EFC906F037C908F033C90CF02FC918B02BA000C915D010C8AD5F07C907B01DA2A2A90385ECD015A5093976E8D00EA5ED29A00D4707D0058A186906AAA5ED2920F00EA5EFC9049008A0018C09018884ECA4EB20AAEB20AAEB20AAEBA608BCE506A5EFC908D0034C64EBAD0901F03DB902020980C8C820B5E5888898AAA5EFC905F00DC911F009C915B0058A186908AABD010248BD050248B911029D0102B915029D05026899150268991102AD6A03D0B6A5EFA6ECC905D0034C64EBC907F01DC90DF019C90CF015C912D004E005D048C915D005A942991602E002903BAD6A03D036B9020229A3990202990A029912020940E005D0020980990602990E02991602E004D013B90A020980990A029912020940990E02991602A5EFC911D036AD0901D021B912022981991202B916020941991602AE8F07E010B030990E022981990A029026B902022981990202B906020941990602A5EFC9189010A982990A029912020940990E02991602A608ADD1034A4A4A489005A90420C1EB684A489005A90020C1EB684A4A489005A91020B7EB684A489005A90820B7EB684A901220B7EBB516C90CF009B5B6C902D0032098C960BD3EE78500BD3FE785014C82F2187DE506A8A9F84CC1E5187DE506A8204AEC9910026085858686ADBC038502ADB1038505A90385044A8503BCEC06A200BDCDEB8500BDCEEB20B2EBE004D0F1A608BCEC06AD4E07C901F008A986990102990502BDE803C9C4D024A987C820BBE588A903AE4E07CAF0014AA60899020209409906020980990E022983990A02ADD403482904F008A9F8990402990C02682908F008A9F899000299080260A9028500A975A40EC005F006A9038500A984BCEC06C820BBE5A5090A0A0A0A29C00500C820BBE58888ADBC0320C1E5ADB103990302BDF10338ED1C07850038EDB10365006906990702ADBD03990802990C02ADB203990B02A50038EDB20365006906990F02ADD4032046ECADD4030A9005A9F820C1E5A5001010B90302D907029008A9F8990402990C0260BCF106ADBA03990002ADAF03990302A5094A4A4829014964990102684A4AA902900209C099020260686766BCEC06B524F6244A2907C903B04AAABD06EDC820BBE588A608ADBA0338E904990002990802186908990402990C02ADAF0338E904990302990702186908990B02990F02A902990202A982990602A942990A02A9C2990E0260A900952460BCE506A95BC820B5E5C8A90220B5E58888ADAE03990302990F02186908990702991302186908990B02991702B5CFAA48E020B002A9F820BEE568186980AAE020B002A9F8990C02991002991402ADD103482908F008A9F8990002990C0268482904F008A9F8990402991002682902F008A9F8990802991402A60860A4B588D020ADD3032908D019BCEE06ADB003990302ADBB03990002A974990102A902990202602028C818004050588088B87860A0B0B8000102030405060708090A0B0C0D0E0F101112131415161718191A1B1C1D1E1F2021222324252627080928292A2B2C2D08090A0B0C302C2D08090A0B2E2F2C2D080928292A2B5C5D08090A0B0C0D5E5FFCFC080958595A5A080928292A2B0E0FFCFCFCFC32333435FCFCFCFC36373839FCFCFCFC3A373B3CFCFCFCFC3D3E3F40FCFCFCFC32414243FCFCFCFC32334445FCFCFCFC32334447FCFCFCFC32334849FCFCFCFC32339091FCFCFCFC3A379293FCFCFCFC9E9E9F9FFCFCFCFC3A374F4FFCFC00014C4D4E4E00014C4D4A4A4B4B3146AD9E07F005A5094AB040A50EC90BF047AD0B07D03CAC0407F031A51DC900F02B2034EFA5092904D021AAACE406A5334AB004C8C8C8C8AD5407F009B91902CDB5EEF007E8BDE7EE9919026020ECEF4C45EF20B0F04C45EFA00EB907EE8DD506A90420BEEF20E9F0AD1107F025A000AD8107CD11078C1107B0188D1107A007B907EE8DD506A004A557050CF001889820BEEFADD0034A4A4A4A8500A203ADE406186918A8A9F84600900320C1E59838E908A8CA10EF6058010060FF04A205BD9EEF9502CA10F8A2B8A00420DCEFAD260209408D2202608507ADAD038D55078505ADB8038502A5338503ADC4038504AED506ACE406BD17EE8500BD18EE20B2EBC607D0F160A51DC903F052C902F03EC901D011AD0407D051A006AD1407D022A0004C28F0A006AD1407D016A002A557050CF00EAD0007C909901BA5452533D015C82091F0A9008D0D07B907EE60A0042091F04C62F0A0042091F04C68F0A005A59FF0DE2091F04C6DF0A0012091F0AD82070D0D07D00BA50A0AB006AD0D074CD0F0A9034C6FF0A90285002062F048AD8107D015AD0C078D8107AD0D07186901C5009002A9008D0D076860AD5407F00598186908A8600001000100010200010202000200020002000200AC0D07A5092903D00DC8C00A9005A0008C0B078C0D07AD5407D00CB99CF0A00F0A0A0A7907EE609818690AAAA009BD9CF0D002A001B907EE60ACE406A50EC90BF013ADD506C950F01EC9B8F01AC9C0F016C9C8D024B91202293F991202B91602293F0940991602B91A02293F991A02B91E02293F0940991E0260A200A0004C42F1A00120A8F1A0034C42F1A00020A8F1A0022071F1A60860A00220A8F1A0064C42F1A901A0014C65F1A909A0042065F1E8E8A909C88600186500AA2071F1A60860B5CE99B803B58638ED1C0799AD0360A200A0004CC0F1A00020A8F1A0024CC0F1A00120A8F1A0034CC0F1A00220A8F1A0064CC0F107160D8A1879A5F1AA60A901A0014CBAF1A909A0048600186500AA984820D7F10A0A0A0A0500850068A8A50099D003A6086020F6F14A4A4A4A85004C39F27F3F1F0F0703010080C0E0F0F8FCFEFF070F078604A001B91C0738F5868507B91A07F56DBEF3F1C9003010BEF4F1C9011009A9388506A908206DF2BDE3F1A604C900D0038810D06000080C0E0F07030100040004FF008604A001B937F238F5CE8507A901F5B5BE34F2C9003010BE35F2C9011009A9208506A904206DF2BD2BF2A604C900D0038810D1608505A507C506B00C4A4A4A2907C001B0026505AA60A5034A4AA500900C990502A501990102A940D00A990102A501990502A9000504990202990602A502990002990402A505990302186908990702A502186908850298186908A8E8E86078EECBF2FFFFAD7007D0048D154060A9FF8D1740A90F8D1540ADC607D006A5FAC901D05DADB207D023A5FAF0668DB2078DC607A9008D154085F185F285F3A90F8D1540A92A8DBB07A944D011ADBB07C924F008C91EF0F1C918D009A964A284A07F2088F3CEBB07D02AA9008D1540ADB207C902D005A9008DC607A9008DB207F012201BF4207CF52067F62094F6A90085FB85FCA90085FF85FE85FD85FAACC007A5F42903F007EEC007C030900698F003CEC0078C1140608C01408E0040602081F3A200A8B901FFF00B9D0240B900FF09089D0340608E04408C054060209FF3A204D0E0A208D0DC9F9B989695949290909A97959392A9408DBB07A962208BF3A299D025A926D002A918A282A0A72088F3A9288DBB07ADBB07C925D006A25FA0F6D008C920D029A248A0BC2081F3D020A905A099D004A90AA093A29E8DBB07A90C2088F3ADBB07C906D005A9BB8D0140D060A4FFF02084F130AA46FFB0AA46FFB0D446FFB02C46FFB04A46FFB07F46FFB0BE46FFB080A5F1F017309A4AB0974AB0C24AB01B4AB03C4AB0674AB0B64AB04860A90E8DBB07A09CA29EA9262088F3ACBB07B9B0F38D0040C006D005A99E8D0240D025A90EA0CBA29F8DBB07A9282088F3D015ACBB07C008D009A9A08D0240A99FD002A9908D0040CEBB07D00EA20086F1A20E8E1540A20F8E154060A92F8DBB07ADBB074AB0104AB00D2902F009A091A29AA9442088F34CA2F4580254564E444C524C483E363E3630284A504A643C323C322C243A643A342C222C221C141404222416042426180426281A04282A1C042A2C1E042C2E20042E3022043032A935A28DD004A906A2988DBD07A07FA94220A6F3ADBD07C930D005A9548D0640D02EA9208DBD07A094A95ED00BADBD07C918D01CA093A918D07FA9368DBD07ADBD074AB00BA8B9D9F4A25DA07F20A6F3CEBD07D00EA20086F2A20D8E1540A20F8E154060A5F22940D065A4FEF02084F2303E46FEB08A46FEB06A46FEB06A46FEB0A046FEB08046FEB0B046FEB03CA5F2F01730274AB0134AB05D4AB05A4AB08D4AB0074AB0994AB026604C2CF54C68F5A9388DBD07A0C4A918D00BADBD07C908D08EA0A4A95AA29FD083A9308DBD07ADBD07A2034AB0D6CAD0FAA8B9D3F4A282A07FD0E4A910D002A9208DBD07A97F8D0540A9008DBE07EEBE07ADBE074AA8CCBD07F00CA99D8D0440B9F8F420A9F3604C6DF5010E0E0D0B060C0F0A09030D080D060CA9208DBF07ADBF074A9012A8BE2BF6B9EAFF8D0C408E0E40A9188D0F40CEBF07D009A9F08D0C40A90085F360A4FDF00A84F346FDB0CA46FDB00BA5F3F0064AB0C44AB00660A9408DBF07ADBF074AA8A20FB9C9FFD0BC4C3AF7A5FCD00CA5FBD02CADB10705F4D0EE608DB107C901D00620A7F42071F5A6F48EC507A0008CC40784F4C940D030A2088EC407D029C904D00320A7F4A0108CC707A0008CB10785F4C901D00EEEC707ACC707C032D00CA011D0E4A00884F7C84A90FCB90CF9A8B90DF985F0B90EF985F5B90FF985F6B910F985F9B911F985F8B912F98DB0078DC107A9018DB4078DB6078DB9078DBA07A90085F78DCA07A90B8D1540A90F8D1540CEB407D05FA4F7E6F7B1F5F004103DD02FADB107C940D005ADC507D01D2904D01CA5F4295FD013A90085F48DB1078D0840A9908D00408D0440604CD4F64CA4F620CBF88DB307A4F7E6F7B1F5A6F2D00E20A9F3F00320D8F88DB507209FF3ADB3078DB407A5F2D01AADB1072991D013ACB507F003CEB50720F4F88D0440A27F8E0540A4F8F05ACEB607D032A4F8E6F8B1F5D00FA9838D0040A9948D01408DCA07D0E920C5F88DB607A4F1D0348A293E208BF3F00320D8F88DB7072081F3A5F1D01FADB1072991D00EACB707F003CEB70720F4F88D0040ADCA07D002A97F8D0140A5F9CEB907D04CA4F9E6F9B1F5F041101320CBF88DB807A91F8D0840A4F9E6F9B1F5F02C20ADF3AEB8078EB907ADB107296ED006A5F4290AF0198AC912B00FADB1072908F004A90FD006A91FD002A9FF8D0840A5F429F3F051CEBA07D04CACB007EEB007B1F5D008ADC1078DB007D0EE20C5F88DBA078A293EF024C930F018C920F00C2910F018A91CA203A018D012A91CA20CA018D00AA91CA203A058D002A9108D0C408E0E408C0F4060AA6A8A2A2A2A29071865F06DC407A8B966FF60ADB1072908F004A904D00CA5F4297DF004A908D002A928A282A07F60ADB1072908F004B996FF60A5F4297DF004B99AFF60B9A2FF60A5595464593C314B695E464F368D364B8D69696F756F7B6F756F7B8187818D69699399939F9399939F8187818D9399939F0872FC271820B8F92E1A4020B0FC3D2120C4FC3F1D1811FD0000081CFA0000A4FB936210C8FE24141845FC1E140852FDA070680851FE4C241801FA2D1CB81849FA2012701875FA1B1044189DFA110A1C18C2FA2D105818DBFA140D3F18F9FA150D211825FB18107A184BFB190F541874FB1E122B1872FB1E0F2D842C2C2C82042C04852C842C2C2A2A2A82042A04852A842A2A001F1F1F981F1F989E981F1D1D1D941D1D949C941D861885263084042630861485222C8404222C21D0C4D031D0C4D000852C221C84262A822826048722343A82400436843A34822C30852A005D554D15199615D5E3EB2DA62B279C9E5985221C14841E2282201E04871C2C348236043034042C04262A85228404823A38363204340424262C04262C300005B4B2B02BAC849C9EA284949C9E851422842C851E822C842C1E8404823A38363204340464046486640005B4B2B02BAC8437B6B64585141C8222842C4E824E844E22840485328530862C040005A4059E059D8584148524282C822284221421D0C4D031D0C4D000822C842C2C822C3004342C0426862200A42525A429A21D9C95822C2C042C042C308534040400A42525A4A86304850E1A8424852214840C8234843434822C8434863A0400A02121A0212B05A3821884181882181804863A2231903190317131909090008234842C852284248226360436862600AC275D1D9E2DAC9F8514822084222C1E1E822C2C1E04872A4040403A3682342C0426862200E3F7F7F7F5F1AC279E9D8518821E84222A2222822C2C22048604822A36043687363430862C040000686A6C45A231B0F1EDEBA21D9C958604852282228722262A842C22861451903111008022282226222422262228222A2228222622282226222422262228222A222822262026202420262028202620282026202420262024202620282026202820262024283028322830282E2830282E282C282E283028322830282E2830282E282C282E0004706E6C6E7072706E706E6C6E7072706E6E6C6E706E706E6C6E6C6E706E706E6C76787674767472747678767476747274841A831820841E831C28261C1A1C822C0404220404841C87262A26842428248022009C0594050D9F1E9C989D822204041C04048414861E80168014811C30043030041E3204323204203404343404360484360046A464A448A666A64AA868A86A442B812A42044242042C64046464042E4604464604220484228704060C141C22862C228704600E141A24862C2487040810181E28863030806400CDD5DDE3EDF5BBB5CFD5DBE5EDF3BDB3D1D9DFE9F1F7BFFFFFFF3400860487141C228634842C04040487141A248632842C04860487181E28863687303030802C82142C62261028800482142C62261028800482081E5E18601A800482081E5E18601A8604831A181684141A180E0C168314201E1C282687241A1210620E8004040082181C20222628812A2A2A042A04832A822286343234810422262A2C3086348332823684348504812286302E30810422262A2C2E863083228236843485048122863A3A3A823A81408204813A863636368236813A82048136863482262A368134348534812A862C008490B0845050B000989694929496585858445C449FA3A1A385A3E0A623C49F9D9F859FD2A623C4B5B1AF85B1AFAD85959EA2AA6A6A6B5E9D840404822286228214222C12222A14222C1C222C14222C12222A14222C1C222C18222A16202818222A12222A18222A12222A14222C0C222C14223412223010222E1622341826361626361426361222365C22340C2222811E1E851E81128614812C221C2C221C852C04812E241E2E241E852E0481322822322822853287363636843A005C544C5C544C5C1C1C5C5C5C5C5E564E5E564E5E1E1E5E5E5E5E625A50625A5062222262E7E7E72B8614811480141481141414148616811680161681161616168128221A28221A288028288128872C2C2C84308304840C8362108412831C221E2226181E041C00E3E1E31DDEE023EC7574F0F4F6EA312D83121404181A1C1426221E1C181E220C14FFFFFF0088002F000002A60280025C023A021A01DF01C401AB0193017C016701530140012E011D010D00FE00EF00E200D500C900BE00B300A900A00097008E00860077007E007100540064005F0059005000470043003B0035002A00230475035702F902CF01FC006A050A1428501E3C02040810204018300C03060C183012240836030906121B240C240206040C1218081201030206090C0498999A9B90949495959697989091929293939394949494949495959595959596969696969696969696969696969696969595949315161617171819191A1A1C1D1D1E1E1F1F1F1F1E1D1C1E1F1F1E1D1C1A18161415161617171819191A1A1C1D1D1E1E1F6B6F64653534&quot;))\n\n(defn file-upload []\n  [:div\n   [:h1 &quot;File upload&quot;]\n   [:input#input\n    {:type      &quot;file&quot;\n     :on-change \n     (fn [e]\n       (let [dom    (o/get e &quot;target&quot;)\n             file   (o/getValueByKeys dom #js [&quot;files&quot; 0])\n             reader (js/FileReader.)]\n         (.readAsArrayBuffer reader file)\n         (set! (.-onload reader)\n               #(reset! file-atom (-&amp;amp;gt % .-target .-result\n                                            (js/Uint8Array.)\n                                            crypt/byteArrayToHex\n                                            .toUpperCase)))))}]])\n\n[file-upload]\n</code></pre><p>We have read the file in as an array buffer and stored it in <code>file-atom</code> as one long string:</p><pre><code>@file-atom\n</code></pre><p><em>If you have uploaded your own file, reload the snippet by deleting the last character and reentering it.</em></p><p>These bytes are ripped straight from the game, and prepended with a header describing the music data to follow:</p><pre><code>(defn hex-bytes\n  ([file n] (hex-bytes file n (inc n)))\n  ([file from to]\n   (map #(apply str %)\n        (partition 2 (take (- (* 2 to) (* 2 from))\n                           (drop (* 2 from) file))))))\n\n(defn hex->ascii [bytes]\n  (apply str (map #(js/String.fromCharCode (str &quot;0x&quot; %)) bytes)))\n\n(defn word [file offset]\n  (str &quot;0x&quot; (first (hex-bytes file (inc offset)))\n       (first (hex-bytes file offset))))\n\n(defn header [file]\n       [:div\n        [:p (str &quot;Version number: &quot; (first (hex-bytes file 0x05)))]\n        [:p (str &quot;Total songs: &quot; (js/parseInt (str &quot;0x&quot; (first (hex-bytes file 0x06)))))]\n        [:p (str &quot;Starting song: &quot; (js/parseInt (str &quot;0x&quot; (first (hex-bytes file 0x07)))))]\n        [:p (str &quot;Load address: &quot; (word file 0x08))]\n        [:p (str &quot;Init address: &quot; (word file 0x0a))]\n        [:p (str &quot;Play address: &quot; (word file 0x0c))]\n        [:p (str &quot;Song name: &quot; (hex->ascii (hex-bytes file 0x0e 0x2e)))]\n        [:p (str &quot;Artist: &quot; (hex->ascii (hex-bytes file 0x2e 0x4e)))]\n        [:p (str &quot;Copyright: &quot; (hex->ascii (hex-bytes file 0x4e 0x6e)))]\n        [:p (str &quot;Play speed (NTSC): &quot; (js/parseInt (word file 0x6e)) &quot; (in 1/1000000th sec ticks)&quot;)]\n        [:p (str &quot;Bankswitch init values: &quot; (hex-bytes file 0x70 0x78))]\n        [:p (str &quot;Play speed (PAL): &quot; (js/parseInt (word file 0x78)) &quot; (in 1/1000000th sec ticks)&quot;)]\n        [:p (str &quot;PAL/NTSC: &quot; (first (hex-bytes file 0x7a)))]\n        [:p (str &quot;Extra Sound Chip Support: &quot;\n                 (let [byte (first (hex-bytes file 0x7b))]\n                   (case byte\n                     &quot;01&quot; &quot;This song uses VRC6 audio&quot;\n                     &quot;02&quot; &quot;This song uses VRC7 audio&quot;\n                     &quot;04&quot; &quot;This song uses FDS audio&quot;\n                     &quot;08&quot; &quot;This song uses MMC5 audio&quot;\n                     &quot;10&quot; &quot;This song uses Namco 163 audio&quot;\n                     &quot;20&quot; &quot;This song uses Sunsoft 5B audio&quot;\n                     &quot;none&quot;)))]])\n\n[header @file-atom]\n</code></pre><p>Now we can load the music data into the appropriate banks (ignoring bankswitching for now) starting from offset $080 in the file:</p><pre><code>(defn format-hex [s]\n  (let [length (count s)]\n    (str &quot;$&quot;\n         (apply str (repeat (- 4 length) &quot;0&quot;))\n         s)))\n\n(defn bank-selector [file]\n   (let [bank (r/atom 0)\n         hovered (r/atom nil)]\n    (fn []\n      [:div\n       [:h4 (str &quot;Select 4KB bank: &quot; @bank)]\n  [:span\n   [:svg {:width     30\n          :view-box  &quot;0 -0.5 10 11&quot;\n          :transform (str &quot;translate(0,10)&quot; (when-not (= @hovered :left) &quot;scale(0.7)&quot;))\n          :cursor    &quot;pointer&quot;\n          :on-mouse-over #(reset! hovered :left)\n          :on-mouse-out #(reset! hovered nil)\n          :on-click  #(if (= 0 @bank)\n                        (reset! bank 7)\n                        (swap! bank dec))}\n    [:path {:stroke &quot;#000000&quot;\n            :d      &quot;M4 0h1M3 1h2M2 2h1M4 2h3M1 3h1M0 4h1M1 5h1M2 6h1M4 6h3M3 7h2M4 8h1&quot;}]\n    [:path {:stroke &quot;#f8f800&quot;\n            :d      &quot;M3 2h1M2 3h5M1 4h6M2 5h5M3 6h1&quot;}]]\n   (str (apply str (interpose &quot; - &quot; (map #(-> % (.toString 16) format-hex) (take 2 (drop @bank (iterate #(+ 4096 %) 0)))))))\n   [:svg {:width         30\n          :view-box      &quot;0 -0.5 10 11&quot;\n          :transform     (str &quot;translate (0,5),rotate (180)&quot; (when-not (= @hovered :right) &quot;scale(0.7)&quot;))\n          :cursor        &quot;pointer&quot;\n          :on-mouse-over #(reset! hovered :right)\n          :on-mouse-out  #(reset! hovered nil)\n          :on-click      #(if (= 7 @bank)\n                        (reset! bank 0)\n                        (swap! bank inc))}\n    [:path {:stroke &quot;#000000&quot;\n            :d      &quot;M4 0h1M3 1h2M2 2h1M4 2h3M1 3h1M0 4h1M1 5h1M2 6h1M4 6h3M3 7h2M4 8h1&quot;}]\n    [:path {:stroke &quot;#f8f800&quot;\n            :d      &quot;M3 2h1M2 3h5M1 4h6M2 5h5M3 6h1&quot;}]]]\n       [:br]\n       [:div\n        [:textarea\n         {:rows      30\n          :cols      74\n          :value   (let [offsets (take 2 (drop @bank (iterate #(+ 4096 %) 0)))]\n    (apply str (interpose &quot; &quot; (hex-bytes file (first offsets) (last offsets)))))\n          :read-only true}]]])))\n  \n[bank-selector (drop (* 2 0x80) @file-atom)]\n</code></pre>",
   :direction "ltr"},
  :updated 1575590400000,
  :entities
  [{:mentions [{:text "Nintendo"}],
    :id "nlp/f/entity/wd:8093",
    :salienceLevel "mention",
    :label "Nintendo"}
   {:mentions [{:text "FDS"}],
    :id "nlp/f/entity/wd:135321",
    :salienceLevel "mention",
    :label "Family Computer Disk System"}],
  :alternate
  [{:href
    "https://porkostomus.gitlab.io/posts-output/2019-12-06-mecca-nsf/",
    :type "text/html"}],
  :title "MECCA NSF",
  :author "These are the Voyages of the Porkostomus",
  :published-str "Thu Dec 05 16:00:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16edea85d8c:810ead:ad5391a1",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url "https://porkostomus.gitlab.io/img/nsf.png",
   :width 636,
   :height 530,
   :contentType "image/png"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://porkostomus.gitlab.io/posts-output/2019-12-06-mecca-nsf/",
  :updateCount 4,
  :commonTopics
  [{:score 84.34332919348859,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 32.67218558844665,
    :id "nlp/f/topic/3030",
    :salienceLevel "about",
    :label "video games"}],
  :published 1575590400000,
  :fingerprint "882493b4",
  :canonicalUrl
  "https://porkostomus.gitlab.io/posts-output/2019-12-06-mecca-nsf/"}
 {:engagement 7,
  :unread true,
  :crawled 1575673961158,
  :content
  {:content
   "<p>Each week, we discuss a different topic about Clojure and functional programming.</p>\n<p>If you have a question or topic you’d like us to discuss, tweet <a href=\"https://twitter.com/clojuredesign\">@clojuredesign</a>, send an email to <a href=\"mailto:feedback@clojuredesign.club\">feedback@clojuredesign.club</a>, or join the <code>#clojuredesign-podcast</code> channel on the <a href=\"http://clojurians.net/\">Clojurians Slack</a>.</p>\n<p>This week, the topic is: <strong>“Reduce and reducing functions”</strong> We take a long hard look at reduce and find the first of many generally useful nuggets inside.</p>\n<p>Selected quotes:</p>\n<ul>\n<li>“Parentheses are a joy, they are hugs around your code.”</li>\n<li>“You want to boil it down into a result, so you use reduce.”</li>\n<li>“We’ve taken ahold of the cooking metaphors and are just running with it!”</li>\n<li>“Reducing functions are a backbone of functional programming, because we don’t have mutation.”</li>\n<li>“Understanding reduce is really important for understanding functional programming.”</li>\n</ul>\n<p>Related episodes:</p>\n<ul>\n<li><a href=\"https://clojuredesign.club/episode/002-tic-tac-toe-state-in-a-row\">002: Tic-Tac-Toe, State in a Row</a></li>\n</ul>",
   :direction "ltr"},
  :updated 1575644400000,
  :alternate
  [{:href "https://clojuredesign.club/episode/058-reducing-it-down/",
    :type "text/html"}],
  :title "Ep 058: Reducing It Down",
  :author "Christoph Neumann and Nate Jones",
  :published-str "Fri Dec 06 07:00:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16edd7c9ac6:68d6b9:97b0c8f7",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://clojuredesign.club/episode/058-reducing-it-down/",
  :commonTopics
  [{:score 0.8396691783414558,
    :id "nlp/f/topic/625",
    :salienceLevel "about",
    :label "deals"}
   {:score 35.20763082444293,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.965,
    :id "nlp/f/topic/349",
    :salienceLevel "about",
    :label "business"}],
  :published 1575644400000,
  :fingerprint "79037c6f",
  :canonicalUrl
  "https://clojuredesign.club/episode/058-reducing-it-down/"}
 {:engagement 4,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1575667694774,
  :content
  {:content
   "<p>I’ve fallen off the pace on these journals but here’s an update!</p>\n<h2>Spec 2</h2>\n<p>Most fresh in my head is some ongoing work on Spec 2. This week I added <code>s/and-</code>, which is a nonflowing variant of <code>s/and</code>. This variant does not pass a conformed value while validating or generating and instead validates each predicate against the candidate value, and conforms and gens only from the first predicate:</p>\n<figure><pre><code><span>(</span><span>s/def</span><span> </span><span>::x</span><span> </span><span>(</span><span>s/and-</span><span> </span><span>(</span><span>s/cat</span><span> </span><span>:i1</span><span> </span><span>int?</span><span> </span><span>:i2</span><span> </span><span>int?</span><span>)</span><span> </span><span>#</span><span>(</span><span>apply</span><span> </span><span>distinct?</span><span> </span><span>%</span><span>)))</span><span>\n</span><span>(</span><span>s/valid?</span><span> </span><span>::x</span><span> </span><span>[</span><span>1</span><span> </span><span>2</span><span>])</span><span> </span><span>;; true</span><span>\n</span><span>(</span><span>s/valid?</span><span> </span><span>::x</span><span> </span><span>[</span><span>1</span><span> </span><span>1</span><span>])</span><span> </span><span>;; false</span><span>\n</span><span>(</span><span>s/conform</span><span> </span><span>::x</span><span> </span><span>[</span><span>1</span><span> </span><span>2</span><span>])</span><span>\n</span><span>;;=> {:i1 1, :i2 2}</span><span>\n</span><span>(</span><span>s/explain</span><span> </span><span>::x</span><span> </span><span>[</span><span>1</span><span> </span><span>1</span><span>])</span><span>\n</span><span>;; [1 1] - failed: (apply distinct? %) spec: :user/x</span><span>\n</span><span>(</span><span>gen/sample</span><span> </span><span>(</span><span>s/gen</span><span> </span><span>::x</span><span>))</span><span>\n</span><span>;;=> ((0 2) (-1 0) [0 -1] (-2 -1) (5 -5) (-8 15) (-3 1) [-1 -24] [-26 -1] [-116 -1])</span><span>\n</span><span>(</span><span>s/unform</span><span> </span><span>::x</span><span> </span><span>{</span><span>:i1</span><span> </span><span>1</span><span>,</span><span> </span><span>:i2</span><span> </span><span>2</span><span>})</span><span>\n</span><span>;;=> (1 2)</span></code></pre></figure>\n<p>We may swap the current <code>s/and</code> with this such that <code>s/and</code> would be nonflowing and the old <code>s/and</code> would be <code>s/and-></code>, still TBD.</p>\n<p>Additionally, <code>s/cat</code> has always worked on any sequential collection, importantly vectors, lists, and seqs. However it only generated lists. That has now changed and it will generate both lists and vectors. You can combine with <code>s/and-</code> to narrow to only <code>vector?</code> or only <code>seq?</code>. There may still be some more changes in this area (particularly s/unform).</p>\n<p>Some other minor bugs and enhancements - fixed s/form on fspecs, added <code>vector-distinct-by</code> to dynaload generator set, made <code>gen/generator?</code> public, fix allowing non-keyword keys to flow through s/keys.</p>\n<h2>tools.deps</h2>\n<p>If you’re interested in tools.deps, I <a href=\"https://www.youtube.com/watch?v=7CM7Ef-dPWQ\">did a talk</a> about it Clojure/conj 2019. At the end of the talk I announced a new tool, <a href=\"https://github.com/clojure/tools.deps.graph\">tools.deps.graph</a> which you can use to make graphs of your deps project dependencies or (for debugging purposes) trace the expansion process for your deps graph and what choices are made.</p>\n<p>This tool can even drive from an expansion trace, which can now be generated by <code>clj -Strace</code>. More than anything, that’s useful for me to debug issues, but you can also just read the trace file directly - it contains an ordered list of the expansion steps, what lib is considered, whether it was included, and why or why not.</p>\n<p>Some other features and fixes in recent tools.deps/clj releases include:</p>\n<ul>\n<li>New alias options :deps and :paths, which are like :extra-deps and :extra-paths but actually indicate to <em>replace</em>, rather than <em>append</em> to the project deps and paths. This is primarily useful for tools that need their own classpath and don’t require using the project classpath.</li>\n<li>Fix -Spom extra newline issue in newer JDKs (TDEPS-29)</li>\n<li>Fix including pom dep resource directories in classpath (TDEPS-127)</li>\n<li>Add support for Maven server http properties (needed for gitlab CI support) (TDEPS-140)</li>\n</ul>\n<h2>core.async</h2>\n<p>core.async had a couple releases. Deps were bumped up for tools.analyzer.jvm, tools.reader, etc. A new feature was added with the system property <code>clojure.core.async.go-checking</code>. When that’s set to true, if you use a blocking channel operation (>!!, &lt;!!, alts!!, or alt!!) in a go block (importantly this can accidentally happen way down the call stack from a go), then an exception will be thrown. By default, this exception will kill the go block thread and get printed on stderror. You may have your own exception handling process that does otherwise or you can set the default uncaught thread exception handler if you want to log somewhere.</p>\n<p>The <code>pipeline</code> function previously used the go block thread pool to implement the concurrent operations. That has been changed to match <code>pipeline-blocking</code> instead, which will use explicit threads to handle the N operations (previously N was unnecessarily bounded by the concurrency of the go pool).</p>\n<p>Also, I have been working on a trio of doc pages for core.async - rationale (mostly from Rich’s release notes), a reference page (all new), and a guide (adopted from my original walkthrough). Not done yet.</p>\n<h2>Misc</h2>\n<p>Some other contrib lib updates:</p>\n<ul>\n<li>Many contrib lib API docs were refreshed and some were created for the first time like <a href=\"https://clojure.github.io/tools.deps.alpha\">tools.deps.alpha</a>, <a href=\"https://clojure.github.io/tools.gitlibs\">tools.gitlibs</a>, <a href=\"https://clojure.github.io/spec-alpha2\">spec-alpha2</a>, etc.</li>\n<li>Released data.json 0.2.7 with a fix for <a href=\"https://clojure.atlassian.net/browse/DJSON-29\">DJSON-29</a> (throwing exceptions on various invalid json)</li>\n<li>Released tools.namespace 0.3.1 with a fix for <a href=\"https://clojure.atlassian.net/browse/TNS-54\">TNS-54</a> to fix issues on Java 9+ and bumps on java.classpath and tools.reader</li>\n<li>Nicola Mometto released tools.analyzer.jvm 0.7.3 with bumped deps</li>\n<li>Andy Fingerhut has been overhauling core.rrb-vector this fall and current version is 0.1.1</li>\n<li>Sean Corfield released new versions of core.cache (0.8.2), core.memoize (0.8.2), java.data (0.1.4)</li>\n<li>and lots of minor updates on the build box and other infrastructure</li>\n</ul>\n<p>Lots of updates on the clojure.org site - companies, success stories, events, contributors, typos, fixes in reference docs, etc. Constant updates!</p>\n<p>And did some analysis on some Clojure 1.11 ideas, nothing to report there, just laying some groundwork.</p>\n<h2>Other stuff I enjoyed this week…</h2>\n<p>A bit of old, some <a href=\"https://www.youtube.com/watch?v=g3hBYTkI-sE\">Bill Withers</a> and a bit of new - new EP out from <a href=\"http://theokatzman.bandcamp.com/album/modern-johnny-tackles-the-issues\">Theo Katzman</a>.</p>",
   :direction "ltr"},
  :updated 1575590400000,
  :entities
  [{:mentions [{:text "on Spec"}],
    :id "nlp/f/entity/wd:7091136",
    :salienceLevel "mention",
    :label "On Spec"}],
  :alternate
  [{:href "http://insideclojure.org/2019/12/06/journal/",
    :type "text/html"}],
  :title "Journal 2019.24 - spec and-, tools.deps.graph",
  :author "Inside Clojure",
  :published-str "Thu Dec 05 16:00:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16edd1cfcb6:65793f:ad5391a1",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url "http://img.youtube.com/vi/7CM7Ef-dPWQ/0.jpg",
   :width 480,
   :height 360,
   :contentType "image/jpeg"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "http://insideclojure.org/2019/12/06/journal/",
  :commonTopics
  [{:score 57.918290958373944,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1575590400000,
  :fingerprint "554111c0",
  :canonicalUrl "http://insideclojure.org/2019/12/06/journal/"}
 {:engagement 4,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1575637484465,
  :recrawled 1575714809440,
  :content
  {:content
   "<p><em>This article is part of the <a href=\"http://metaredux.com/posts/2019/12/01/meta-advent-2019.html\">“Meta Advent 2019”</a> series. I’ve committed to writing\na new blog post here every day until Christmas.</em></p>\n<p>A while ago I wrote <a href=\"http://metaredux.com/posts/2019/04/02/ruby-s-creed.html\">an article</a>, where\nI made the case Ruby seems to have lost its way. I thought I had exhausted the\ntopic, but a few of the recent developments around the Ruby 2.7’s development\nlead me to revisit it.</p>\n<p>Ruby 2.7 has become infamous at this point for several highly controversial\nchanges that were either quickly revised or removed. A classic tell-tale of\ngood project management and a clear vision for the future, right?</p>\n<p>Let’s examine a few of those ill-fated changes in no particular order…</p>\n<h2>Flip-flops Forever</h2>\n<p>Remember how the flip-flop operator (<code>..</code>) was finally deprecated in Ruby 2.6 after\nyears of discussions? Well, it just got (quietly) <a href=\"https://bugs.ruby-lang.org/issues/5400#note-25\">reinstated</a>.</p>\n<p>I find it really amusing how this went down - 3 (!!!) people complained about the deprecation and Matz quickly responded with:</p>\n<blockquote>\n<p>I hear the negative feedback from the community. OK, I give up.\nThe warning should be removed.</p>\n<p>– Matz</p>\n</blockquote>\n<p>There are numerous other instances where he ignored the complaints of way more people. Go figure.\nAs usual, there was no real discussion on the ticket - just a decision. Not to mention that\nno one even thought to try to solicit more community feedback on the subject. I learned about the\nremoval of the deprecation when someone posted this on Twitter…</p>\n<p>None of this is new, in Ruby-land it’s business as usual. It’s just becoming progressively more\nfrustrating for me.</p>\n<h2>Numbered Parameters Revisited</h2>\n<p>Remember the highly controversial numbered block parameter syntax?</p>\n<div><div><pre><code><span># now</span>\n<span>[</span><span>1</span><span>,</span> <span>2</span><span>,</span> <span>3</span><span>].</span><span>each</span> <span>{</span> <span>|</span><span>i</span><span>|</span> <span>puts</span> <span>i</span> <span>}</span>\n<span>(</span><span>1</span><span>..</span><span>10</span><span>).</span><span>map</span> <span>{</span> <span>|</span><span>i</span><span>|</span> <span>i</span> <span>*</span> <span>3</span> <span>}</span>\n<span>(</span><span>1</span><span>..</span><span>9</span><span>).</span><span>each_slice</span><span>(</span><span>3</span><span>).</span><span>map</span> <span>{</span> <span>|</span><span>x</span><span>,</span> <span>y</span><span>,</span> <span>z</span><span>|</span> <span>x</span> <span>+</span> <span>y</span> <span>+</span> <span>z</span> <span>}</span>\n\n<span># Ruby 2.7</span>\n<span>[</span><span>1</span><span>,</span> <span>2</span><span>,</span> <span>3</span><span>].</span><span>each</span> <span>{</span> <span>puts</span> <span>@</span><span>1</span> <span>}</span>\n<span>(</span><span>1</span><span>..</span><span>10</span><span>).</span><span>map</span> <span>{</span> <span>@</span><span>1</span> <span>*</span> <span>3</span> <span>}</span>\n<span>(</span><span>1</span><span>..</span><span>9</span><span>).</span><span>each_slice</span><span>(</span><span>3</span><span>).</span><span>map</span> <span>{</span> <span>@</span><span>1</span> <span>+</span> <span>@</span><span>2</span> <span>+</span> <span>@</span><span>3</span> <span>}</span>\n</code></pre></div></div>\n<p>After <a href=\"https://bugs.ruby-lang.org/issues/15723\">quite the backlash</a> this syntax was revised to something more reasonable:</p>\n<div><div><pre><code><span>[</span><span>1</span><span>,</span> <span>2</span><span>,</span> <span>3</span><span>].</span><span>each</span> <span>{</span> <span>puts</span> <span>_1</span> <span>}</span>\n<span>(</span><span>1</span><span>..</span><span>10</span><span>).</span><span>map</span> <span>{</span> <span>_1</span> <span>*</span> <span>3</span> <span>}</span>\n<span>(</span><span>1</span><span>..</span><span>9</span><span>).</span><span>each_slice</span><span>(</span><span>3</span><span>).</span><span>map</span> <span>{</span> <span>_1</span> <span>+</span> <span>_2</span> <span>+</span> <span>_3</span> <span>}</span>\n</code></pre></div></div>\n<p>A great success, right? Matz made a couple of interesting comments on this mega-thread. My favourite one was:</p>\n<blockquote>\n<p>Yes, I admit { @1[@2] = “Go Fish: #{@2}” } is cryptic. But {@1 * @2} is not. So use numbered parameters with care (just like other features in Ruby). The possibility to make code cryptic itself should not be the reason to withdraw a feature.</p>\n<p>The problem is introducing it or this could break existing code. That is the problem. Numbered parameters are a compromise to simplify block expression without breaking compatibility.</p>\n<p>FYI, I am not fully satisfied with the beauty of the code with numbered parameters, so I call it a compromise.</p>\n<p>– Matz</p>\n</blockquote>\n<p>So, he accepted something that he wasn’t perfectly happy about. OK, I can\nunderstand the need for compromises from time to time. But I totally hate this\nline of reasoning “The possibility to make code cryptic itself should not be the\nreason to withdraw a feature.”. I think that adding features for the sake of\nadding them is not a reason to add something either.</p>\n<p>I also think that we should be\ncareful with the impact of features on tools and with all the accidental\ncomplexity they bring (e.g. now Ruby parsers are more complex). Not to mention the\nfact that no one could make a strong case for introducing this feature in the\nfirst place. I’m still not sure what’s the grand problem it solves…</p>\n<h2>The Totally Useless Pipeline Operator</h2>\n<p>This was probably the most ridiculous part of Ruby 2.7’s development cycle. At some point\nthe pipeline operator landed in <code>master</code>:</p>\n<div><div><pre><code><span># now</span>\n<span>foo</span><span>()</span>\n  <span>.</span><span>bar</span><span>(</span><span>1</span><span>,</span> <span>2</span><span>)</span>\n  <span>.</span><span>display</span>\n\n<span># Ruby 2.7</span>\n<span>foo</span><span>()</span>\n  <span>|></span> <span>bar</span> <span>1</span><span>,</span> <span>2</span>\n  <span>|></span> <span>display</span>\n</code></pre></div></div>\n<p>Everyone who has actually used the pipeline operator in Elixir (the source of inspiration for this change),\nhowever, knows that it behaves nothing like this. Here Ruby’s team basically came up with different syntax\nfor <code>.</code> (method invocation) with a lower precedence that allowed you to do questionable things like:</p>\n<div><div><pre><code><span>(</span><span>a</span><span>..</span><span>b</span><span>).</span><span>each</span> <span>{}</span>\n\n<span>a</span><span>..</span><span>b</span> <span>|></span> <span>each</span> <span>{}</span>\n</code></pre></div></div>\n<p>I won’t go into much details about this misguided operator. After all, a lot of great articles exist about\nit already.<sup><a href=\"http://metaredux.com/posts/2019/12/06/ruby-where-do-we-go-now.html#fn:1\">1</a></sup> For me the important things here are:</p>\n<ul>\n<li>This feature was not well thought-out</li>\n<li>It generated a massive backlash</li>\n<li>It was quickly reverted</li>\n</ul>\n<p>Sounds familiar, doesn’t it?</p>\n<h2>The Rise and Fall of the Method Reference Operator</h2>\n<p>Ruby 2.7 was supposed to introduce a method reference operator:</p>\n<div><div><pre><code><span>[</span><span>2</span><span>,</span> <span>4</span><span>,</span> <span>8</span><span>,</span> <span>16</span><span>,</span> <span>32</span><span>].</span><span>map</span> <span>{</span> <span>|</span><span>n</span><span>|</span> <span>Math</span><span>.</span><span>log2</span><span>(</span><span>n</span><span>)</span> <span>}</span>\n\n<span>[</span><span>2</span><span>,</span> <span>4</span><span>,</span> <span>8</span><span>,</span> <span>16</span><span>,</span> <span>32</span><span>].</span><span>map</span><span>(</span><span>&amp;</span><span>Math</span><span>.</span><span>:log2</span><span>)</span>\n</code></pre></div></div>\n<p>Well, not anymore. This feature was recently <a href=\"https://bugs.ruby-lang.org/issues/16275\">reverted</a>.\nThere were some good reasons for it to be reverted, which serves to underline my point that\na lot of changes to Ruby recently were made without thinking much about their implications.\nMatz, made one particularly interesting comment on this ticket:</p>\n<blockquote>\n<p>In recent years, we have added/discussed a lot of features inspired by functional programming. But those features are not designed with a grand design. Those are rather ad hoc additions. We felt the future, more functional Ruby should be designed with the big picture of functional Ruby programming, which we lack currently.</p>\n<p>Besides that, I don’t like the specific operator (.:) which looks like braille.</p>\n<p>So you don’t have to consider this revert as a rejection of this whole idea, but an invitation to the next try.</p>\n<p>– Matz</p>\n</blockquote>\n<p>I was really glad to see this, as it seems that Matz also understands that without a solid vision in the end\nwe’ll just get one big mess. I’m a bit sad about the <code>.:</code> operator being reverted, as this was a feature I could\nsee myself using, but that’s a small price to pay for a better future of Ruby.</p>\n<h2>Parameter Forwarding Weirdness</h2>\n<p>Just when I had some hope about the future I came across another “brilliant” addition to Ruby 2.7 - parameter forwarding.\nIt’s best explained with an example:</p>\n<div><div><pre><code><span>def</span> <span>foo</span><span>(</span><span>...</span><span>)</span>\n  <span>bar</span><span>(</span><span>...</span><span>)</span>\n<span>end</span>\n</code></pre></div></div>\n<p>This defines a method <code>foo</code>, that can have any parameters whatsoever and simply\nforwards all of them to <code>bar</code>. I don’t know about you, but I always wanted\nsomething like this!<sup><a href=\"http://metaredux.com/posts/2019/12/06/ruby-where-do-we-go-now.html#fn:2\">2</a></sup></p>\n<p>There are some plans to make it a bit more generic and support forwarding a\nsubset of all parameters:</p>\n<div><div><pre><code><span>def</span> <span>foo</span><span>(</span><span>a</span><span>,</span> <span>b</span><span>,</span> <span>...</span><span>)</span>\n  <span>if</span> <span>a</span><span>.</span><span>even?</span>\n    <span>bar</span><span>(</span><span>b</span><span>,</span> <span>...</span><span>)</span>\n  <span>end</span>\n<span>end</span>\n</code></pre></div></div>\n<p>Still, I think this is another random addition that doesn’t solve real problems\nand just adds mental and technical complexity.</p>\n<h2>A RuboCop Perspective</h2>\n<p>You might be wondering I am so grumpy about a bit of chaos during the development\ncycle of Ruby? After all it seems that most problematic features tend to get improved/removed.</p>\n<p>I’m the author of <a href=\"https://github.com/rubocop-hq/rubocop\">RuboCop</a>, a popular\nstatic code analyzer and formatter for Ruby, that’s why my perspective on all of\nthis is probably different from that of many other people. Together with RuboCop\nand <a href=\"https://github.com/whitequark/parser\">Parser</a>’s team we actually have to\nsupport all of those language changes. Imagine how fun it is to add support for\nsomething, change this a couple of times, while tracking upstream changes, and\nthen just delete it at the end. Or to have to do complex changes to support\nsome new syntax that probably is going to be used by a handful of\npeople… Trust me, that’s get frustrating after a while, and we’d definitely\nappreciate less turbulence in the design of the language.</p>\n<p>You might say now - why don’t you just wait for the stable release of Ruby before\nimplementing support for it? Have you ever seen users who don’t want support for the\nlatest and greatest feature at day one? Yeah, I haven’t seen many of those either. :-)\nNot to mention that when you’re in the business of parsing code unknown syntax\ndoesn’t result in a very pleasant end user experience.</p>\n<h2>Epilogue</h2>\n<p>So, we made it to the end of this somewhat bitter and rantish article. So, what’s the takeaway from\nall of this, if any?</p>\n<p>It’s good that Ruby’s team listens to user feedback, but it might also be nice\nfor them to actually start asking about feedback in some more open/structured\nmanner prior to making language changes. Especially given their recent track\nrecord with the Ruby community… You can’t really expect everyone to be\nmonitoring all tickets in Ruby’s issue tracker, right?<sup><a href=\"http://metaredux.com/posts/2019/12/06/ruby-where-do-we-go-now.html#fn:3\">3</a></sup> I’ve often dreamt of\na state where Ruby’s team actually announces in advance the focus for the next\nrelease (a.k.a. a roadmap), so interested parties can actually go and help with\nthe tasks at hand. That should not require that much extra work - just a bit of\ngood old planning. Some voting system on tickets and annual surveys might be a good idea as well - other programming communities are making good use of those.</p>\n<p>Many people are excited about\nRuby 3.0, but I’m not. It’s a major release in theory, but in practice it will\nadd relatively little to what we have today. It’s not even clear if the new\nconcurrent programming model will make it there or not at this point.</p>\n<p>Ruby 2.7 has showed better than ever the chaos in Ruby’s development and the\nlack of a clear direction/destination. There are some signs that Matz understands this as\nwell, so I’m still optimistic about the future.</p>\n<p>I think Matz should take a page from Rich Hickey’s<sup><a href=\"http://metaredux.com/posts/2019/12/06/ruby-where-do-we-go-now.html#fn:4\">4</a></sup> book and take a bit of <a href=\"https://www.youtube.com/watch?v=f84n5oFoZBc\">hammock-time</a> to figure\nout where he wants to take Ruby next. So, Ruby, where do we go now?</p>\n<p><strong>P.S.</strong> The article generated an interesting discussion <a href=\"https://www.reddit.com/r/ruby/comments/e6ye3t/ruby_where_do_we_go_now/\">on reddit</a>. I encourage you to check it out.</p>\n<div>\n<ol>\n<li>\n<p>That’s my favourite one <a href=\"https://dev.to/baweaver/ruby-2-7-the-pipeline-operator-1b2d\">https://dev.to/baweaver/ruby-2-7-the-pipeline-operator-1b2d</a>. <a href=\"http://metaredux.com/posts/2019/12/06/ruby-where-do-we-go-now.html#fnref:1\">↩</a></p>\n</li>\n<li>\n<p>You can’t here my voice, but that’s sarcasm here. <a href=\"http://metaredux.com/posts/2019/12/06/ruby-where-do-we-go-now.html#fnref:2\">↩</a></p>\n</li>\n<li>\n<p>Especially given the fact that the vast majority of ideas for language changes are just ignored and stay dormant for ages. <a href=\"http://metaredux.com/posts/2019/12/06/ruby-where-do-we-go-now.html#fnref:3\">↩</a></p>\n</li>\n<li>\n<p>The author of Clojure. <a href=\"http://metaredux.com/posts/2019/12/06/ruby-where-do-we-go-now.html#fnref:4\">↩</a></p>\n</li>\n</ol>\n</div>",
   :direction "ltr"},
  :updated 1575590400000,
  :alternate
  [{:href
    "http://metaredux.com/posts/2019/12/06/ruby-where-do-we-go-now.html",
    :type "text/html"}],
  :title "Ruby, Where do We Go Now?",
  :author "Bozhidar Batsov",
  :published-str "Thu Dec 05 16:00:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16edb5003b1:3b5a2b:97b0c8f7",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url "http://img.youtube.com/vi/f84n5oFoZBc/0.jpg",
   :width 480,
   :height 360,
   :contentType "image/jpeg"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "http://metaredux.com/posts/2019/12/06/ruby-where-do-we-go-now",
  :updateCount 2,
  :commonTopics
  [{:score 61.464176765961675,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1575590400000,
  :fingerprint "8a6e076f",
  :canonicalUrl
  "http://metaredux.com/posts/2019/12/06/ruby-where-do-we-go-now.html"}
 {:engagement 5,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1575635188770,
  :content
  {:content
   "<div><p><em>This post is part of <a shape=\"rect\" href=\"https://lambdaisland.com/blog/2019-11-25-advent-of-parens\">Advent of Parens\n2019</a>, my attempt to\npublish one blog post a day during the 24 days of the advent.</em></p><p>As an avid tea drinker I’ve been poring (pouring?) over this catalog of teas.</p><pre><code>(def teas [{:name &quot;Dongding&quot;\n            :type :oolong}\n           {:name &quot;Longjing&quot;\n            :type :green}\n           {:name &quot;Baozhong&quot;\n            :type :oolong}\n           {:name &quot;Taiwan no. 18&quot;\n            :type :black}\n           {:name &quot;Dayuling&quot;\n            :type :oolong}\n           {:name &quot;Biluochun&quot;\n            :type :green}])\n</code></pre><p>I like all kinds of teas, but my favorites are definitely oolongs, so I want to\nfilter this list. Here’s a common way to do that.</p><pre><code>(filter #(= :oolong (:type %)) teas)\n;; => ({:name &quot;Dongding&quot;, :type :oolong}\n;;     {:name &quot;Baozhong&quot;, :type :oolong}\n;;     {:name &quot;Dayuling&quot;, :type :oolong})\n</code></pre><p>I’m sure many of you have written anonymous functions just like this one, I\ncertainly have written my fair share, but nowadays I would write this\ndifferently.</p><pre><code>(filter (comp #{:oolong} :type) teas)\n</code></pre><p>This may or may not look strange, depending on how used you are to using sets as\nfunctions, and composing with <code>comp</code>, but it just looks so much cleaner to me.\nIt also doesn’t create a closure. Anonymous functions close over all local\nvariables, so as long as there’s a live reference to it none of those local\nvariables can be garbage collected.</p><p>The real kicker however is that this is so nicely and naturally extensible.</p><pre><code>;; get all black or oolong teas\n(filter (comp #{:black :oolong} :type) teas)\n;; => ({:name &quot;Dongding&quot;, :type :oolong}\n;;     {:name &quot;Baozhong&quot;, :type :oolong}\n;;     {:name &quot;Taiwan no. 18&quot;, :type :black}\n;;     {:name &quot;Dayuling&quot;, :type :oolong})\n\n;; get all non-oolong teas\n(filter (comp (complement #{:oolong}) :type) teas)\n;; => ({:name &quot;Longjing&quot;, :type :green}\n;;     {:name &quot;Taiwan no. 18&quot;, :type :black}\n;;     {:name &quot;Biluochun&quot;, :type :green})\n</code></pre><p>If <code>(some #{:foo} coll)</code> can be mainstream, then surely <code>(comp #{:foo} :bar)</code>\ncan be too, so go forth and <code>comp</code>!</p><p><strong><a shape=\"rect\" href=\"https://clojureverse.org/t/advent-of-parens-2019/5159\">Comment on ClojureVerse</a></strong></p></div>",
   :direction "ltr"},
  :updated 1575634143000,
  :alternate
  [{:href
    "https://lambdaisland.com/blog/2019-12-06-advent-of-parens-6-a-small-idiom",
    :type "text/html"}],
  :title "Advent 2019 part 6, A small idiom",
  :author "Arne Brasseur",
  :published-str "Fri Dec 06 04:09:03 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16edb2cfc22:3b8930:69b9f616",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://lambdaisland.com/blog/2019-12-06-advent-of-parens-6-a-small-idiom",
  :published 1575634143000,
  :fingerprint "e3e0a098",
  :canonicalUrl
  "https://lambdaisland.com/blog/2019-12-06-advent-of-parens-6-a-small-idiom"}
 {:engagement 4,
  :unread true,
  :crawled 1575609626569,
  :content
  {:content
   "<p><img alt=\"MECCA ROMs\" src=\"https://porkostomus.gitlab.io/img/pix.png\"></p><p>So now we've got a nice raster image of our pixel art. How do we import it into our app? This is the job of <a href=\"https://github.com/porkostomus/mecca-pix\">MECCA Pix</a>.</p><p>First we need to be able to upload a file. I'll provide one here as a default, but this is a <em>real</em> upload form; feel free to replace it with a (small, low-res!) image of your own:</p><pre><code>(ns mecca.klipse\n  (:require [reagent.core :as r]\n            [goog.object :as o]))\n\n(def file-atom (r/atom &quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAADgCAIAAABjIy8HAAATJElEQVR42u1dLZiyTBRlv+cNRCPRaDQSiUbjxo1GopFINBqNRqORaDQajUYj8btw3XF2GBCGHwXOWR+ecRhgZM+ZuXd+v6IosgBgrPgPrwCAAAAAAgAACAAAIAAAgAAAYAT4N7Yf7LruyH6xXTF9rI09nU4QwDj4YttxHJdMWYpQr+5W8j4l7/YSp8X0WRwcr6gBAIX9FTSQx8tKnO4MTH03uialfGhZwW/MiGUAH6ABEPvtv6ijnzJhQ/ZHu4T9QWrnrGMKJF+jnVwnQABjL/4TdgQVinBmPwcYleyo7sp+Yr/lUUbt9NclCBL/gCLHrAEIoKwXyJxpRGbvMpDsJnxkCADQu7AcUL62+lwZL9N79Ff9FJxgoJQJJAwe2QT6QFf4kc8wzdg6/lh/ffgCaLU9PqL/a0Pt1go/xFfBeK25n2X/y/sYUrkMQsuLruTYWF7wyHAUiJwn4Siwg2sckiQggA4R/f262TwCvv+M4bB8ShtWLjwerKVjRncTq1g4wXWMH7o8DMP1el0QNkFohVc2dIJ884hOBZRsPT4NfIoPwFznjxzDFOfIgqN8oXlJHxPbUh4TkwMv27aT/ZqVQR77y9+nJR/AZgGEj+I/yQMFUlvILtAGaoBuoHBdlP0cX0xu+cJPcAY+y6peJ+V6kNKdiR4HT7rbSTDgU+spTKB3a0Br9sgK0erh7dR/pztbTgPB1fpLehXBzxjZ/ykmkMJ1QetKho32JhXN5bSfiP5CL8+GaYS43feRrbdWuAuE8fMnP1FApygBTKCP04DWTJIlwVc1QP0HTSLuCLbXeg2ULI8NrCCRPpDsk7ywuQZWQZy5zZjZT/h616oQseseDy3ef+nom0Hzml+1lC0uqnsyGvTPzcOVRhjKE7R3Gepw6C8siwKMGRgKAYwaDx/A8zy8C2BUYNsHNQCAGuAX9/sdbwQYPCaTCXwAAIAAAAgArwCAAAAAAgAACAAAIAAAgAAAAAIAAAgAACAAAIAAAAACAAAIAAAgAACAAAAAAgAACAAAIAAAgAAAAAIAAAgAACAAAIAAAAACAAAIAAAgAACAAAAAAgAACAAA3oJ/ff8B8lLXQPfo+5L6qAEA1AD9x/UW9S7Pt6t1vZ457Hrz3uV/6ngQAGBI/QeHpg/en6JzT2UAAQDVQFxn3s/ns+wpaAA+wMDLfmI/UV9hP3+lU1wVABAAAMAEGpzxE0WR48yPx2g2e7TeXi5JM+LtlhT82+2BjqvVch34eF0QQI+JnncquyE5K2E28+SzeXeAhwAB9IP9y+V343c+HPbwkiGAHoDYf7tfuJlfNHSKJn9Lav3UQklJ/jFRn8JkPpGN1MceDwhgmBZOcWFMPCbK/vzMmdCkivP5stttUlNHrwFtSr5P1nYyyBKQBVqBDEGkLG6yJIr//PhEXyI0fWzbcV2P8f3ty8W8YL82JZ2i+7z0relxdMT/BQLoAkoPbkElQIQmA4Y4Hce31WpJhCaa7vcbRQPlU5Z3uAEIoEVQ8cwyKKYgGTPEYCK076+stImT7HhtUV0+pUAYbFiNbCAVm0kABNAYyDFl97SMBpjKHKYAfc1LSeV9yZTMfhahkhkATnAXILNEjGigMNMxaykdj5FszTOnBbnZtqFknHI2m7DNk02plPri/iIDFKCjAw2gBugAZK6wcUIBOT7b/L9YeJfLnT7EbJnTQi10H5bBy5QCjjNnt5gu5AzQTUSWANQA3cnA+m3uZNNF215JzOZkWUudBEOXUJFPpKfiPC8lnZL94NvtfDwmgXQYRS0nWJ6TICwoqkzET8vWac4UAoD988sMZr+w2gs8UcVAl/vIuM2HNWC96ib7dRKSyiEdQTRnDRS0FBUgZXPyuNns+dA4fnyl4+Vylk21gbEfJlBdGTD7ifTXW8SfkhcK850FwxooQ2LxIL6QNMDD6fhoqgGLia5g8OwfTg0wmUzv92vHDxXsr9r/ml4YZRuLKt2EH0q34pGkfDTWANlCRHe5HpDruqGyf1AmEGnAShYpuHbDe4YB+620Z9fMYsnTQP1bZTVA4cGzf4A+QGcyMGA/D+95qS9hF5Vp129DA8povAGzf7BOcKsyEG5uVfYrtBazIuXWJFHJJH6F5Ci/1EAjYA3wQ/npw2a/NexWoJZkUJNw2mFw782SAraCGjHSIIBxGUUyeBx/tgjP1gDFMhDzAQAIoE8yINamlszTcOIxDmWw32+EKsrMBwAggA+SAVNfWPMivnxDZ9apFZ3NAATw0TIgczwMNi2RFfMhIYAeyGAd+GXWNZk6nhgpDWZDAJ8rg5ZmXbGhz8Z9S4/AFGEIoK4MeCnP7Dqenw9yRcgYwxpbEEBdGTD7eaWTvuByTebsk30FARQDo0E1MmAlyCD2O5OZtqmep2J9fjwAAdSSgdy42cd4QIsvMabX6ud+T7xH2D1uyzo5Hg5ipbceQZhAVduX6GfyUIjjcVc8Foh3iOkvZ5j5qAEAOMFAFbiux326xQu2ARDAYEEWI9lFvr8qqYFmvdLsADueaUAGz+kE6x8C6ATKgigv0dSC6dmRocT+zWZL8RgsBAF0BJ7Ua2YC2bZjJSsv3LKRDPlUXnxNNQIQgDlqmhnEY5nWzHKF9Pw1L14B6bDcZEsAAqgB7QSXvCES3BjfmZfMD+IjJtBAAK3gl9Pz8uZHyUm9beQTw+BKAv0AZcEbXlS9qvtRCWb5RA0AdAR2AGSDXvEKXsYDEECPoeVxHrlBegig53S37sI0f0sG5I0LyDHgjVax3SoE0LVd/q5Hy6txkRjIPeCjVgN8SokZ9owCOMG1QOU6t8Fnj1z829bkvTnkMY+8vEoyOPT3mB0yzXP56ZRYKZoTy3vSQADjhXaiCdOIewOY9xzm+LewX5tP3oVJVAWa0UTbpNditVryjjWsAQrzFjV0FiYQCntNPwD3wsr2PYdfrmOV7bttqu3SuB+AeL/ZbCng+yvKvujIo6w6zhwCgB0/z/aCyfUAkT5KUWD6C94T1W73i2KBZK1243xerpFSLciBgjn+5/OF8mbbzunEVcF92P9WCKAu5MX+5YJfYTBTn7gVk2uQlrLKfYSvyUrgOzXlPYvuag7wUTbu5TJ+VEPrIIDWG3lk6gves7EhQ5xiJQgZNKIBeVMz+avYaTgMt+P830EA7YIH6wvqZ3kvIE5xSiGD+hqQzRh5Q7Ht9sC7EIz5HwQBtMv+cLPJo77sOsvTZYQnyjKorwF5+zBlQ7FfjyUasJsLAbyT/WvfV6gveM+kp68UUCJlGdTUgJgmJjbftn634JYXjJAbOvu4DB4E0DryNrzIY3+yRO5f9jPLtXMjRaSShi6vqoGa8wHocnrifr+hn0D+/XRKv+UMAQC58wHKXy4X+VrjJy+NQT5FP4CyKQGvR63dqYDUxXaXaMti952+DrgxFD3BFZp6SvZVcfFPZbYo/mVCFzBbTiNKcboJD8jhPlqDfJJ9zx/rt7kza/H/rDzKNrvFfBMOUEwi+5WHGgAwrzqW36EVVyvRWQONrCVR4ATLEB0RwtBiDWAwHFALCZX3a8ueV5ZNQyupCLDXy0ctrSmS2c+rI1J48ItLowZoHjzkmKhDJjVbQQmVqQYgDcTn8rLhgOQEm9ghCoP5azGtxWbxYwBqgNY18Iwl9lesBxT2v3FeAWoAoG498NRAWg/I2tD2EIP9EMAHoVI/QLEG5MEOguuKDIzZj3WBYAK1ArONJ7K2EDM7a5pn05iV/Uo+s7vdAKgBNLicr1Y6THKx1G9nXTAfoJIGZOo7k6S0Fp1Wchpjyyc7H6Cb7cEhgH6zPxkAM5/MLdePvsNNw7NghQaU+PP5oszekgaBNmz3QwYwgV5YDodga1/sVn1iJdKZalokW/V6tVsAogYYO8jySdrd55PVKmrvKVoNZNFBmw9qAwjgPeBROi+H9HTT4gkZQADvwUe16I9cBhBAWRj0A1hNrA5d9Ylm/QCjlQEE8CBZ0v7oWXlj5S2j+QAP16Kea77bbXjqevlLjPcHIBncrCsEMEYk+8ytb54fRHGQJxID9p/PlzqVAOuHCF1+SqR2XSAAAijBtmO6qqH3+Ho8NLDpIrP/+9tkUPF+v1FuZeA8rP3k0VQh8DqNed18owX6AfQg9i+Xq0a8VTP217lQhpdiQsZNujwo66GSUTTsfoN/Y6Y4l4gcSIrq1PbxLI9iDIb9fCb4hzjOfDZL6iJeFYK7GsrXBgN2kUdtAlEZ7/vfOTN9h2lD82rPXLORzitZRIOUwXgFIMr4PCeVWdL3hdN4/vvcnTiTeVoD+GnkfTab0BswcAkGJgM4wbng9aGEAMz6Ad6SbbkfYLHwrL9rXUmNqua13GAcg1ELIOVBlMPpSFkkuea6QJ1B6Qfg1f1v9zPXAGQC8Wq42mt5TPioMAoBaBs0qSAsWCyfzjpTNpCeavl89lsl+gFko47fjFwEjGpG/CgEQP9jbRlPRSPHa5fDH0wrkAJuBWIfIDWQfkZu6P4bCfu1xbyyWP5Qcbudz6fE2GPSl8FmsyHnYTafQgADcWcxT1yRxC3dgft43GkTsOuMGmBQyFo1FCNWD8+aCmYLUfXFCrKkdXOzJuIYyv7RCcD6u4eX0EOeBsTWd4Ogu/43YmjQ6JpBxb9cCEA7/pl4I48asHrbD5CF+L3JJtibzcgFgMFwZWG2LhDyiRrgzeBGHi0nuHTXGjnZmTGD6QewnvsDHCCAgQtAGDzaup5VodVG3ryw3kH5IWzX8f4Ag/mNMIHMUWAE80j6AfxGsUOMsjFM9rfblp39XC4n1ABDpr5WA2vfH0YrkPV3Pxgq9YsdX6VffLfbLJbebLjbRsIJrlwzVLXIlZmN5XE6RW/5Xa7r8Qc+ADRQa2Ywb3M0n8/i2HzLx7comTeThACAJ6r2A1BK3ma0JtIlIbyq+azzRKp5KOdt1D8QQI9hMB/g58evr4GqTkiddYHEBgX0UM451QPkA0AAgGE/AGmgqdGmHawL9LP6vqWj5OK7xbwfNvshgI6U0/0CiWaYzVxu8CHPx/NG0UsAAXSkAbwECKBFDLuz5i1vZiSvFDVAA5A9XV5lyCxG4EM2EIAAgLLgHU59fyVW8DSLsUqsKU3py6+Va4Dr5TadORAA8Afl+wGy5XfJGPnm2qn6BemVfD5rp20S/ll9FzOeexv4OB72QwAVUNwPIG/7XiemOL58PkU/ANNa0YPgumD8zyxRCB9hAgF6szuP/dnGfrMY8aA6A/CUfgBmvztPmL1aLUVVMFrGQwB14boej6SXPddsY79ZTGkfwMt64dvtITt+gWf2nM5YFAMCaA7EP+IoEVHRwMu2mjIxJX0Amf3J9jaHvXb4Gma9QACtoDxBDVDVByjIDI9l4AEOAATQDFLDOsrZWKCZGqZ84kaG3EEAw8TxcMmUiHVnN7U9Tthg7BBLUSvI+/0OlhdgyDPC3Pl3EATpMoDPT1YSJTGfz7S8bCOe9/PiDzvEcoyIr3R/YKQmkOwakkeYTpA1qQTy+gE+M170A1wvIHkRvuSp332sLieTZMXjvGY+bv/+Y8BUbBC8Xm5U1u4P2369llP02BKP6sCWHsF37i9nmPkDrwEaaf8+ny/Mp/5WfcB4TaD62O02/SXTdIZ/IARQi0DOYuJxazpaVCCAMcJxHLwECAB4KgEdqxAAlAAMAVgaEYAAAAAmUK+R7fACANQAADD0GgBt8wBqAACAAAAAAgAACAAAIAAAgAAAAAIAAAgAAHT40xHGcyUBADUAAIwCX/La2QCAGgAAAAAYiQkUH+Jm72gv7fNmMZsvki8zLMoBdI5Lshre5Xyc+8eX9P5XwONKD21cSADQAYrmA8Sx4DSJIdYdf0/bNl4lMGAnuIj9ADDMGkCnAQvsL4P9sflt1r8XLl7sWwQgSn0ydazULEI98IL939/rxm8bBH7gY8OvN5hAsXTMiwFU9tsSlK/CZcpLoE0fBJtggwWf3+MDWGEY8n+NjvT/oK94dwW43RMT6HqL6MNfRZgDFEOvUU7wMj19wnCLd9u1CXQ6nbJ7tgUpkp1IXBimGjgTVxylxrTnKWK/HD91PHEUAU7A6YG3CYDZL28kI59S/ruAXAPIrcNcnItTVqbtOA4kryuwuNSX0wNvEACbOqKkp4CiAUqwXq/xHrMQjJeLdm2Cx9ng2eYAfIoP8HKHqfa2oOo7tKQvMjWtiD+RFeHtfZAJxKaO1gQCGtSAZ7lSy3I8dWy5DhHOQNLKhA6BjgUA6lfCfh96C0+hr2L2yGcpnErFTgO2aF6e2s+bEPuFz3C63twpNijoVgBAhbJ84W03lXenXK9XdBUdQ3sbx0lzM8cIWSWn0AzasQC4uRM+QFUslu71ci2ffrcL5LBtB3LM5YIdmd7kBL9s4UETkGr3z6YGxX+BHgSo+KdKAG+4axMo2/Qpn8IbVJBY50vXc38avzOxfzZzSGAEjEPpTgCu68ZxHIahbO1QGGV/gQai066SCVS+eiE4YH/3TvA6Bd5XhXqgDfsK7O9SAJjn9XkaAPu7EgDm+AJjANYFAkaNL2wyB4wZ/wOdiQuJWAtJXgAAAABJRU5ErkJggg==&quot;))\n\n(defn file-upload []\n  [:div\n   [:h1 &quot;File upload&quot;]\n   [:input#input\n    {:type      &quot;file&quot;\n     :on-change \n     (fn [e]\n       (let [dom    (o/get e &quot;target&quot;)\n             file   (o/getValueByKeys dom #js [&quot;files&quot; 0])\n             reader (js/FileReader.)]\n         (.readAsDataURL reader file)\n         (set! (.-onload reader)\n               #(reset! file-atom (-> % .-target .-result)))))}]])\n\n</code></pre><pre><code>[file-upload]\n</code></pre><p>We have read the file in as a base64 URL and stored the string in our <code>file-atom</code>:</p><pre><code>@file-atom\n</code></pre><p>And now we can display it as an <code>img</code> element:</p><pre><code>(defn img-el [url]\n  [:div\n   [:img {:width &quot;100%&quot; :src url}]])\n   \n[img-el @file-atom]\n</code></pre><p>To extract the pixel data, we'll draw the image onto an HTML Canvas, and make use of its <code>getImageData</code> method which returns a Uint8ClampedArray of rgba values (0-255 inclusive):</p><pre><code>(defn img->data [file]\n  (let [img (js/Image.)\n        canvas (.createElement js/document &quot;canvas&quot;)\n        ctx    (.getContext canvas &quot;2d&quot;)]\n    (set! (.-src img) file)\n    (set! (.-width canvas) (.-width img))\n    (set! (.-height canvas) (.-height img))\n    (.drawImage ctx img 0 0)\n    (.-data (.getImageData ctx 0 0 (.-width img) (.-height img)))))\n\n[:textarea \n {:rows      10\n  :cols      48\n  :value     (str (img->data @file-atom))\n  :read-only true}]\n</code></pre><p>In a future article we will divide the pixels into color paths and optimize them.</p><p>Happy Advent!</p>",
   :direction "ltr"},
  :updated 1575504000000,
  :alternate
  [{:href
    "https://porkostomus.gitlab.io/posts-output/2019-12-05-mecca-pix/",
    :type "text/html"}],
  :title "MECCA Pix",
  :author "These are the Voyages of the Porkostomus",
  :published-str "Wed Dec 04 16:00:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16ed9a6efc9:17071e:97b0c8f7",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url "https://porkostomus.gitlab.io/img/pix.png",
   :width 636,
   :height 530,
   :contentType "image/png"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://porkostomus.gitlab.io/posts-output/2019-12-05-mecca-pix/",
  :commonTopics
  [{:score 25.44087137295233,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1575504000000,
  :fingerprint "8ea28a79",
  :canonicalUrl
  "https://porkostomus.gitlab.io/posts-output/2019-12-05-mecca-pix/"}
 {:engagement 5,
  :unread true,
  :crawled 1575567040869,
  :content
  {:content
   "<div><p><em>This post is part of <a shape=\"rect\" href=\"https://lambdaisland.com/blog/2019-11-25-advent-of-parens\">Advent of Parens\n2019</a>, my attempt to\npublish one blog post a day during the 24 days of the advent.</em></p><p>I already showed you netcat, and how it combines perfectly with socket REPLs.\nBut what if all you have is an nREPL connection? Then you use\n<a shape=\"rect\" href=\"https://github.com/eraserhd/rep\">rep</a></p><pre><code>$ rep '(clojure.tools.namespace.repl/refresh)'\n:reloading ()\n:ok\n</code></pre><p><code>rep</code> will find a <code>.nrepl-port</code> file, or you can specify the port directly.</p><pre><code>rep -p 4829 &quot;(require 'foo.bar :reload)&quot;\n</code></pre><p>Unfortunately <code>rep</code> is not able to read code from STDIN, making it the odd one\nout in my exposition of command line tools, but there’s a pull request open for\nthat.</p><p>Rep is part of a new breed of Clojure tools that use GraalVM to compile to\nnative binaries, giving them super fast start-up times.</p><p>Finally using Clojure from the shell has become tractable, which must have been\nwhat Michiel Borkent (a.k.a. borkdude) was thinking when he created\n<a shape=\"rect\" href=\"https://github.com/borkdude/babashka\">Babashka</a>, or <code>bb</code> for friends.</p><pre><code>$ bb -e '(+ 1 1)'\n2\n</code></pre><p>My favorite part of <code>bb</code> are the <code>-I</code> and <code>-O</code> options. The first will read and\nparse consecutive edn forms from STDIN, and make them available as a lazy\nsequence bound to <code>*in*</code>. The second will print the return value of your program\nas newline-delimited EDN forms.</p><p>Here’s a little loop to get the download numbers for Kaocha for the past ten days</p><pre><code>for i in {1..10} ; do curl -s https://clojars.org/stats/downloads-`date -d &quot;now - $i days&quot; &quot;+%Y%m%d&quot;`.edn; done |\n  bb -I -O '(->> *in* (map #(get % [&quot;lambdaisland&quot; &quot;kaocha&quot;])) (map vals) (map (partial apply +)))'\n</code></pre><p>But what if instead of EDN you have some other format, like <a shape=\"rect\" href=\"http://jsonlines.org/\">newline-delimited\nJSON</a>? Then you use another one of Michiel’s projects,\nand a perfect complement to Babashka: <a shape=\"rect\" href=\"https://github.com/borkdude/jet\">Jet</a>!</p><pre><code>cat log.json | jet --from json --to edn | bb -I '(map ,,, *in*)'\n</code></pre><p>It can convert back and forth between JSON, EDN, and Transit, and it can pretty\nprint. So say you have an big old ugly Transit blob and you want to actually\nlook at what’s in there, you could do this.</p><pre><code>jet --from transit --pretty &lt; blob.transit | less\n</code></pre><p>Pretty neat. It also has some querying capabilities similar to <code>jq</code>, and an\ninteractive mode, although for complex querying I would probably just use\nBabashka, since that way I can just write Clojure.</p><p><strong><a shape=\"rect\" href=\"https://clojureverse.org/t/advent-of-parens-2019/5159\">Comment on ClojureVerse</a></strong></p></div>",
   :direction "ltr"},
  :updated 1575565036000,
  :alternate
  [{:href
    "https://lambdaisland.com/blog/2019-12-05-advent-of-parens-5-clojure-in-the-shell",
    :type "text/html"}],
  :title "Advent 2019 part 5, Clojure in the shell",
  :author "Arne Brasseur",
  :published-str "Thu Dec 05 08:57:16 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16ed71d2165:c9a85b:97b0c8f7",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://lambdaisland.com/blog/2019-12-05-advent-of-parens-5-clojure-in-the-shell",
  :commonTopics
  [{:score 31.85687047916544,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1575565036000,
  :fingerprint "24056d09",
  :canonicalUrl
  "https://lambdaisland.com/blog/2019-12-05-advent-of-parens-5-clojure-in-the-shell"}
 {:engagement 5,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}
   {:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/todo",
    :label "todo"}],
  :unread false,
  :crawled 1575549612387,
  :content
  {:content
   "<p>Bruno Ribeiro asked a great question about the practical uses of monads. Are they useful? Why are they used so much in Haskell? In this episode, we briefly go over the history of monads in Haskell and how they allow you to do imperative programming in a pure functional language.</p>\n<p></p>\n<div>\n<div><span></span><img alt=\"Video Thumbnail\" src=\"https://i.ytimg.com/vi/B7OrU_GsfCs/mqdefault.jpg\"><p></p>\n<h5>Are monads practical?</h5>\n<p><span>Bruno Ribeiro asked a great question about the practical uses of monads. Are they useful? Why are they used so much in Haskell? In this episode, we briefly go over the history of monads in Haskell and how they allow you to do imperative programming in a pure functional language. https://share.transi</span></p></div>\n</div>\n<p>The post <a rel=\"nofollow\" href=\"https://lispcast.com/are-monads-practical/\">Are monads practical?</a> appeared first on <a rel=\"nofollow\" href=\"https://lispcast.com\">LispCast</a>.</p>",
   :direction "ltr"},
  :updated 1575547200000,
  :alternate
  [{:href "https://lispcast.com/are-monads-practical/",
    :type "text/html"}],
  :title "Are monads practical?",
  :author "Eric Normand",
  :published-str "Thu Dec 05 04:00:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16ed6133163:b38c21:69b9f616",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url "https://i.ytimg.com/vi/B7OrU_GsfCs/mqdefault.jpg",
   :width 320,
   :height 180,
   :contentType "image/jpeg"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://lispcast.com/?p=2092",
  :commonTopics
  [{:score 62.68263487696318,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1575547200000,
  :fingerprint "8805f569",
  :canonicalUrl "https://lispcast.com/are-monads-practical/"}
 {:engagement 5,
  :unread true,
  :crawled 1575541121961,
  :content
  {:content
   "<p><em>This article is part of the <a href=\"http://metaredux.com/posts/2019/12/01/meta-advent-2019.html\">“Meta Advent 2019”</a> series. I’ve committed to writing\na new blog post here every day until Christmas.</em></p>\n<p>Trust me, it wasn’t easy to find the right name for this article. I started off with the\npompous sounding “Improving the Printed Representation of Certain Clojure Built-in Object Types” and\nneeded half an hour to come to the current title. Naming is hard!</p>\n<p>So, what’s the fancy sounding title all about? Have you noticed that many Clojure types are not\nrepresented in a particularly “user-friendly” way in the REPL?<sup><a href=\"http://metaredux.com/posts/2019/12/05/pimp-my-print-method-prettier-clojure-built-in-types.html#fn:1\">1</a></sup> Here are a few examples:</p>\n<div><div><pre><code>Clojure 1.10.1\nuser=> +\n#object[clojure.core$_PLUS_ 0x2bc12da &quot;clojure.core$_PLUS_@2bc12da&quot;]\nuser=> print-method\n#object[clojure.lang.MultiFn 0x3122b117 &quot;clojure.lang.MultiFn@3122b117&quot;]\nuser=> (atom 5)\n#object[clojure.lang.Atom 0x17ae7628 {:status :ready, :val 5}]\nuser=> (find-ns 'clojure.core)\n#object[clojure.lang.Namespace 0x5b78fdb1 &quot;clojure.core&quot;]\n</code></pre></div></div>\n<p>Here we have a function, a multi-method, an atom and a namespace object. While when you’re\nused to Clojure their printed representations probably make sense to most people, they certainly\nare confusing to newcomers. The representation of <code>+</code> in particular is pure gold when it comes\nto clarity. The real question, however, is “Can we do better than this?”. Yes, we can!</p>\n<p>People using CIDER or editors backed by <code>cider-nrepl</code> (e.g. <code>vim-fireplace</code> and Calva) might be confused by the examples I gave,\nbecause they’d get something pretty different in their REPLs. Let’s do this one more time in CIDER’s REPL:</p>\n<div><div><pre><code><span>user></span><span> </span><span>+</span><span>\n</span><span>#</span><span>function</span><span>[</span><span>clojure.core/+</span><span>]</span><span>\n</span><span>user></span><span> </span><span>print-method</span><span>\n</span><span>#</span><span>multifn</span><span>[</span><span>print-method</span><span> </span><span>0</span><span>x757ca063</span><span>]</span><span>\n</span><span>user></span><span> </span><span>(</span><span>atom</span><span> </span><span>5</span><span>)</span><span>\n</span><span>#</span><span>&lt;Atom</span><span>@</span><span>3</span><span>e319fc5</span><span>:</span><span> </span><span>5</span><span>></span><span>\n</span><span>user></span><span> </span><span>(</span><span>find-ns</span><span> </span><span>'clojure.core</span><span>)</span><span>\n</span><span>#</span><span>namespace</span><span>[</span><span>clojure.core</span><span>]</span><span>\n</span></code></pre></div></div>\n<p>I don’t know about you, but I find this version much easier to comprehend. So, time for the crux of this\narticle - how did we achieve this? It’s pretty simple actually - we simply leveraged <code>print-method</code>, a built-in Clojure\nmulti-method that controls how an object gets printed. Here’s an excerpt from the <a href=\"https://github.com/clojure-emacs/cider-nrepl/blob/v0.22.4/src/cider/nrepl/print_method.clj\">actual implementation</a>:</p>\n<div><div><pre><code><span>(</span><span>def</span><span> </span><span>^</span><span>:dynamic</span><span> </span><span>*pretty-objects*</span><span>\n</span><span>&quot;If true, cider prettifies some object descriptions.\nFor instance, instead of printing functions as\n#object[clojure.core$_PLUS_ 0x4e648e99 \\&quot;clojure.core$_PLUS_@4e648e99\\&quot;]\nthey are printed as\n#function[clojure.core/+]\nTo disable this feature, do\n(alter-var-root #'cider.nrepl.print-method/*pretty-objects* not)&quot;</span><span>\n</span><span>true</span><span>)</span><span>\n</span><span>(</span><span>defmacro</span><span> </span><span>def-print-method</span><span> </span><span>[</span><span>dispatch-val</span><span> </span><span>arg</span><span> </span><span>&amp;</span><span> </span><span>strings</span><span>]</span><span>\n</span><span>`</span><span>(</span><span>defmethod</span><span> </span><span>print-method</span><span> </span><span>~</span><span>dispatch-val</span><span> </span><span>[</span><span>~</span><span>arg</span><span> </span><span>~'^</span><span>Writer</span><span> </span><span>w</span><span>]</span><span>\n</span><span>(</span><span>if</span><span> </span><span>*pretty-objects*</span><span>\n</span><span>(</span><span>do</span><span> </span><span>~@</span><span>(</span><span>map</span><span> </span><span>#</span><span>(</span><span>list</span><span> </span><span>'.write</span><span> </span><span>'w</span><span> </span><span>%</span><span>)</span><span> </span><span>strings</span><span>))</span><span>\n</span><span>(</span><span>#</span><span>'clojure.core/print-object</span><span> </span><span>~</span><span>arg</span><span> </span><span>~</span><span>'w</span><span>))))</span><span>\n</span><span>(</span><span>defn-</span><span> </span><span>translate-class-name</span><span> </span><span>[</span><span>c</span><span>]</span><span>\n</span><span>(</span><span>main/demunge</span><span> </span><span>(</span><span>.getName</span><span> </span><span>(</span><span>class</span><span> </span><span>c</span><span>))))</span><span>\n</span><span>;;; Atoms</span><span>\n</span><span>;; Ex: #atom[{:foo :bar} 0x54274a2b]</span><span>\n</span><span>(</span><span>def-print-method</span><span> </span><span>Atom</span><span> </span><span>c</span><span>\n</span><span>&quot;#atom[&quot;</span><span>\n</span><span>(</span><span>pr-str</span><span> </span><span>@</span><span>c</span><span>)</span><span>\n</span><span>(</span><span>format</span><span> </span><span>&quot; 0x%x]&quot;</span><span> </span><span>(</span><span>System/identityHashCode</span><span> </span><span>c</span><span>)))</span><span>\n</span><span>;;; Function objects</span><span>\n</span><span>;; Ex: #function[cider.nrepl.print-method/multifn-name]</span><span>\n</span><span>(</span><span>def-print-method</span><span> </span><span>AFunction</span><span> </span><span>c</span><span>\n</span><span>&quot;#function[&quot;</span><span>\n</span><span>(</span><span>translate-class-name</span><span> </span><span>c</span><span>)</span><span>\n</span><span>&quot;]&quot;</span><span>)</span><span>\n</span></code></pre></div></div>\n<p>It’s a bit more complicated than it needs to be, mostly because of the wrapper <code>def-print-method</code> macro that\nmakes each <code>print-method</code> aware of a dynamic var that controls the pretty-printing. It’s needed in\na tool like CIDER, in case some users don’t like the different printing, but I guess most people won’t need this\nif they’re just tweaking something in their local setup.</p>\n<p>All in all - you need this code in some namespace that gets required early-on in your application and you’re done.\nThat’s exactly what <code>cider-nrepl</code> does.\nWhile writing this article I also realized that I should really move this code to <code>Orchard</code>, as it’s not nREPL-specific\nin any way, and having it as part of <code>Orchard</code> would make it easier for more people to reuse the code directly.</p>\n<p>The technique is not without its flaws, though. Recently a CIDER user ran into the following problem:<sup><a href=\"http://metaredux.com/posts/2019/12/05/pimp-my-print-method-prettier-clojure-built-in-types.html#fn:2\">2</a></sup></p>\n<div><div><pre><code><span>(</span><span>defrecord</span><span> </span><span>Foo</span><span> </span><span>[]</span><span>\n</span><span>clojure.lang.IDeref</span><span> </span><span>(</span><span>deref</span><span> </span><span>[</span><span>x</span><span>]</span><span> </span><span>x</span><span>)</span><span> </span><span>)</span><span>\n</span><span>(</span><span>Foo.</span><span>)</span><span>\n</span><span>;; =></span><span>\n</span><span>;; 2. Unhandled clojure.lang.ExceptionInfo</span><span>\n</span><span>;;</span><span>\n</span><span>;; 1. Caused by java.lang.IllegalArgumentException</span><span>\n</span><span>;; Multiple methods in multimethod 'simple-dispatch' match dispatch value: class</span><span>\n</span><span>;; scratch.Foo -> interface clojure.lang.IDeref and interface</span><span>\n</span><span>;; clojure.lang.IPersistentMap, and neither is preferred</span><span>\n</span></code></pre></div></div>\n<p>Solving the problem is as easy as adding:</p>\n<div><div><pre><code><span>(</span><span>prefer-method</span><span> </span><span>print-method</span><span>\n</span><span>clojure.lang.IPersistentMap</span><span>\n</span><span>clojure.lang.IDeref</span><span>)</span><span>\n</span></code></pre></div></div>\n<p>Still, I do believe that implementing <code>IDeref</code> in a record is a bad idea, and\nI’m also reasonably sure this is the only bug report we’ve got in the 5 years\nsince this feature was added to CIDER. This leads me to believe it works fairly\nwell for most people.</p>\n<p>That’s all I had for you today. I hope you managed to\nlearn something useful. See you tomorrow!</p>\n<div>\n<ol>\n<li>\n<p>For my definition of “user-friendly” I guess. <a href=\"http://metaredux.com/posts/2019/12/05/pimp-my-print-method-prettier-clojure-built-in-types.html#fnref:1\">↩</a></p>\n</li>\n<li>\n<p>This bug report was my inspiration to write the article you’re now reading. <a href=\"http://metaredux.com/posts/2019/12/05/pimp-my-print-method-prettier-clojure-built-in-types.html#fnref:2\">↩</a></p>\n</li>\n</ol>\n</div>",
   :direction "ltr"},
  :updated 1575538020000,
  :alternate
  [{:href
    "http://metaredux.com/posts/2019/12/05/pimp-my-print-method-prettier-clojure-built-in-types.html",
    :type "text/html"}],
  :title "Pimp my Print Method: Prettier Clojure Built-in Types",
  :author "Bozhidar Batsov",
  :published-str "Thu Dec 05 01:27:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16ed591a3a9:a3e8ec:97b0c8f7",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "http://metaredux.com/posts/2019/12/05/pimp-my-print-method-prettier-clojure-built-in-types",
  :commonTopics
  [{:score 49.787706748772685,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1575538020000,
  :fingerprint "16cb10f7",
  :canonicalUrl
  "http://metaredux.com/posts/2019/12/05/pimp-my-print-method-prettier-clojure-built-in-types.html"}
 {:engagement 4,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1575525932492,
  :content
  {:content
   "<p>Confession: I used an SNES emulator to extract the image data in yesterday's post. While this is a step up from searching for sprite sheets online (my previous method), how would I go about ripping the graphics straight from the game? This is the domain of <a href=\"https://github.com/porkostomus/mecca-roms\">MECCA ROMs</a>.</p><p><img alt=\"MECCA ROMs\" src=\"https://porkostomus.gitlab.io/img/roms.png\"></p><p>Are we making an emulator yet? We'll start with something basic - the original Super Mario Bros. for NES:</p><pre><code>(ns mecca.klipse \n  (:require [reagent.core :as r]))\n\n(def mario-hex\n  &quot;4E45531A02010100000000000000000078D8A9108D0020A2FF9AAD022010FBAD022010FBA0FEA205BDD707C90AB00CCA10F6ADFF07C9A5D002A0D620CC908D11408D7007A9A58DFF078DA707A90F8D1540A9068D012020208220198EEE7407AD7807098020ED8E4C578001A4C8EC100041414C343C4454687CA8BFDEEF038C8C8C8D0303038D8D8D8D8D8D8D8D8D8D8D0040AD7807297F8D7807297E8D0020AD790729E6AC7407D005AD7907091E8D790729E78D0120AE0220A90020E68E8D0320A9028D1440AE7307BD5A808500BD6D80850120DD8EA000AE7307E006D001C8BE8080A9009D00039D01038D7307AD79078D012020D0F2205C8E20828120978FAD76074AB025AD4707F005CE4707D019A214CE7F071007A9148D7F07A223BD8007F003DE8007CA10F5E609A200A007ADA70729028500ADA8072902450018F001387EA707E888D0F9AD2207F01FAD02202940D0F9AD76074AB00620238220C681AD02202940F0F9A01488D0FDAD3F078D0520AD40078D0520AD7807488D0020AD76074AB003201282AD02206809808D002040AD7007C902F00BC901D038AD7207C903D031AD7707F004CE770760ADFC062910F019AD76072980D01AA92B8D7707AD7607A8C884FA49010980D005AD7607297F8D760760AC4E07A9288500A20EBDE406C500900FACE0061879E10690031865009DE406CA10E7AEE006E8E003D002A2008EE006A208A002B9E9069DF1061869089DF2061869089DF306CACACA8810E860AD700720048E3182DCAE8B831892A0002CA004A9F8990002C8C8C8C8D0F760AD720720048ECF8F678561904582042073010000A000ADFC060DFD06C910F004C990D0034CD882C920F01AAEA207D00B8D8007206B83B0604CC082AEFC07F04AC940D046C8ADA207F04EA9188DA207AD8007D036A9108D8007C001F00EAD7A0749018D7A072025834CBB82AE6B07E88A29078D6B07200E83BD3F829D0003E8E00630F5AC5F07C88C0403A9008DFC0620EAAEA50EC906D044A9008D70078D72078D2207EE740760ACA207F0EC0A9006ADFD07200E8320039CEE5D07EE6407EE5707EE7007ADFC078D6A07A9008D72078DA207A217A9009DDD07CA10FA608D5F078D6607A2008E60078E67076007224983CE242400A007B91D839900038810F7AD7A07F00AA9248D0403A9CE8D0603600180028141800142C2028041C141C101C1010280009B1018052C2024155A1020283020108020303001FF00AE1707AD1807D00DE8EE170738BD54838D1807F00ABD3F838DFC06CE1807186020A083AD7207F007A20086082047C0202AF14CE9EEAD720720048EECCFB083BD83F6836184AE1B07E88634A90885FC4C4E87A0008435A56DC534D006A586C960B003E635C89820E6B0AD1A07C534F016AD68071869808D6807A9016900A820C4AF206FAFE635A535F06860AD4907D048AD1907F018C909B03FAC5F07C007D009C9039034E9014C1884C902902BA8D008AD5307F014C8D011C8AD5F07C907F00988C004B026C003B00FC003D004A90485FC9818690C8D7307AD49071869048D4907AD190769008D1907C9079008A9068DA107EE720760ADA107D020AC5F07C007B01AA9008D60078D5C078D7207EE5F0720039CEE5707A9018D700760ADFC060DFD062940F00DA9018DFC07A9FF8D5A0720489260FFFFF6FBF7FBF8FBF9FBFAFBF650F750F850F950FA50FDFEFF4142444548313234353800BD1001F0BEC90B9005A90B9D1001A8BD2C01D0049D100160DE2C01C92BD01EC00BD007EE5A07A94085FEB9B7844A4A4A4AAAB9B784290F9D34012027BCBCE506B516C912F022C90DF01EC905F012C90AF016C90BF012C909B006B51EC902B008AEEE03BCEC06A608BD1E01C9189005E9019D1E01BD1E01E90820C1E5BD1701990302186908990702A902990202990602BD10010AAABD9F84990102BDA084990502A60860AD3C0720048E8B859B8552865A8693869D88A8869D88E686BF85E3854386FF863287498720208220198EAD7007F032A2034CC585AD440748AD560748A9008D5607A9028D440720F185688D5607688D44074C458701020304AC4E07BEBB858E73074C458700090A0422220F0F0F220F0F221627182230271922372716AC4407F006B9C7858D7307EE3C07AE0003A000AD5307F002A004AD5607C902D002A008A9038500B9D7859D0403C8E8C60010F4AE0003AC4407D003AC4E07B9CF859D0403A93F9D0103A9109D0203A9049D0303A9009D08038A1869078D000360AD3307C901D005A90B8D73074C4587A9002008884C45872030BCAE0003A9209D0103A9739D0203A9039D0303AC5F07C8989D0403A9289D0503AC5C07C8989D0603A9009D07038A1869068D00034C4587AD5907F00AA9008D5907A9024CC786EE3C074C4587AD7007F033C903F022AD5207D02AAC4E07C003F005AD6907D01E20A4EFA90120088820A588A9008D740760A9128DA007A9032008884C4E87A9088D3C0760EE740720B092AD1F07D0F8CE1E071003EE3C07A9068D730760AD7007D04AA91E8D0620A9C08D0620A9038501A0008400AD0720AD07209100C8D002E601A501C904D0F0C03A90ECA9054C4C86AD7007D017A2009D00039D0004CAD0F7202583EE3C0760A9FA2036BCEE720760204305160A1B121820520B20181B150D24241D12160E2068050024242E2923C07FAA23C201EAFF21CD0724242924242424214B0920181B150D24242824220C472423DC01BAFF21CD05160A1B1218220C071D12160E241E19FF21CD05160A1B1218220B09100A160E24181F0E1BFF258415200E150C18160E241D1824200A1B19242318170E2B26250124262D01242635012427D946AA27E145AAFF151E12101204030200240524000807060000002727464E59616E6E480AA8C004900CC0089002A008AD7A07D001C8BEFE87A000BD5287C9FFF007990103E8C8D0F2A90099010368AAC904B049CAD023AD5A07186901C90A9007E90AA09F8C08038D0903AC5F07C88C1403AC5C07C88C160360AD7A07F01DAD5307CAD009AC7007C003F00249014A900BA004B9ED879904038810F760E9040A0AAAA000BDF287991C03E8C8C8C8C8C00C90F1A92C4C3F86ADA007D00B202082A9078DA007EE3C0760AD260729018505AC40038400AD2107994203AD2007994103A99A994303A9008504AA8601BDA10629C085030A2A2AA8B9088B8506B90C8B8507BDA1060A0A8502AD1F07290149010A6502A8A600B1069D4403C8B1069D4503A404A505D00EA5014AB0192603260326034C3089A5014AB00F46034603460346034C308946034603E604B9F903050399F903E600E600A601E8E00D908DA400C8C8C8A9009941038C4003EE2107AD2107291FD00DA9808D2107AD200749048D20074CBD89AD2107291F38E904291F8501AD2007B0024904290409238500A5014A4A69C08501A200AC4003A500994103A5011869089942038501BDF903994403A9019943034A9DF903C8C8C8C8E8E00790D99941038C4003A9068D7307602727271707173F0C04FFFFFFFF000F07120F0F07170F0F07171C0F071700A5092907D051AE0003E031B04AA8B9C9899D0103E8C8C00890F4AE0003A9038500AD4E070A0AA8B9D1899D0403C8E8C60010F4AE0003ACD406B9C3899D0503AD00031869078D0003EED406ADD406C9069005A9008DD4066045454747474747475758595A2424242426262626A041A903AE4E07D002A90420978AA9068D730760206D8AEEF003DEEC0360A900A003C900F014A000C958F00EC951F00AC8C95DF005C952F001C898AC0003C820978A889818690A4C3F86860084010A0AAAA020A506C9D09002A0248403290F0A8504A9008505A5021869200A26050A260565048504A50569001865038505A401BD398A990303BD3A8A990403BD3B8A990803BD3C8A990903A504990103186920990603A505990003990503A902990203990703A900990A03A6006010AC648C8B8B8C8C242424242727272724242435362537252438242424303026262634262431243233262433342626262626262624C024C0247F7F24B8BAB9BBB8BCB9BDBABCBBBD606461656266636760646165626663676868696926266A6A4B4C4D4E4D4F4D4F4D4E50516B702C2D6C716D726E736F74868A878B888C888C898D69698E918F922693269390946969A4E9EAEB24242424242F243DA2A2A3A324242424A2A2A3A39924992424A23E3F5B5C24A3242424249D479E47474727274747474727274747A947AA479B279C27272727275252525280A081A1BEBEBFBF75BA76BBBABABBBB454745474747474745474547B4B6B5B7454745474547454745474547454745474547454747474747474747474747474747474747474747472424242424242424ABACADAE5D5E5D5EC124C124C6C8C7C9CACCCBCD2A2A404024242424244724478283848524472447868A878B8E918F92242F243D242424353625372524382424242439243A243B243C2424244126412626262626B0B1B2B3777977795355545653555456A5A7A6A8C2C4C3C55759585A7B7D7C7E3F00200F1512250F3A1A0F0F30120F0F27120F221627180F1030270F1630270F0F3010003F00200F291A0F0F36170F0F30210F0F27170F0F1627180F1A30270F1630270F0F3617003F00200F291A090F3C1C0F0F30211C0F27171C0F1627180F1C36170F1630270F0C3C1C003F00200F3010000F3010000F3016000F2717000F1627180F1C36170F1630270F003010003F000422300010003F00040F300010003F00042227160F003F14040F1A3027002548101D110A17142422181E24160A1B12182B002548101D110A17142422181E24151E1210122B0025C5160B1E1D24181E1B24191B12170C0E1C1C24121C24121726050F0A17181D110E1B240C0A1C1D150E2B0025A71322181E1B241A1E0E1C1D24121C24181F0E1BAF0025E31B200E24191B0E1C0E171D2422181E240A24170E20241A1E0E1C1DAF00264A0D191E1C11240B1E1D1D1817240B002688111D18241C0E150E0C1D240A2420181B150D000AA8688504688505C8B1048506C8B10485076C0600AD0220AD7807091029F020ED8EA924202D8EA9208D0620A9008D0620A204A0C0A9248D072088D0FACAD0F7A0408A8D00038D01038D072088D0FA8D3F078D40074CE68EA9018D16404AAA8D1640206A8EE8A00848BD164085004A05004A682A88D0F19DFC064829303D4A07F0076829CF9DFC0660689D4A07608D0620C8B1008D0620C8B1000A48AD78070904B00229FB20ED8E680A90030902C84A4AAAB001C8B1008D0720CAD0F5389865008500A90065018501A93F8D0620A9008D06208D06208D0620AE0220A000B100D0AC8D05208D0520608D00208D780760F006620662066D026D027A03060C12181E24850020118FA5004A4A4A4A186901290FC906B044480AA8AE0003A920C000D002A9229D0103B9F48E9D0203B9F58E9D03038503860268AABD008F38F9F58EA8A602B9D7079D0403E8C8C603D0F4A9009D0403E8E8E88E000360AD7007C900F016A205BD34011879D7073016C90AB01999D70788CA10ECA900A2069D3301CA10FA60DE3301A909D0E738E90AFE33014C758FA205209E8FA20BA00538BDDD07F9D707CA8810F6900EE8C8BDDD0799D707E8C8C00690F460043048607890A8C0D8E824F8FC282C18FF2358A06F20CC90A01F99B0078810FAA9188DA20720039CA04B20CC90A221A9009D8007CA10FAAD5B07AC5207F003AD51078D1A078D25078D28072038B0A0202901F002A0248C2007A0808C21070A0A0A0A8DA006CE3007CE3107CE3207A90B8D1E0720229CAD6A07D010AD5F07C904900CD007AD5C07C9029003EECC06AD5B07F005A9028D1007A98085FBA9018D7407EE720760A9018D57078D5407A9028D5A078D6107A9008D7407A8990003C8D0FA8D59078D69078D2807A9FF8DA003AD1A074E780729016A2E780720ED90A9388DE306A9488DE206A9588DE106A20EBDBC8F9DE406CA10F7A003B9CB8F9900028810F720AF9220AA92EE2207EE720760A207A90085068607E001D004C060B002910688C0FFD0F1CA10EC60020104081020AD7007F023AD5207C902F00DA005AD1007C906F00EC907F00AAC4E07AD4307F002A004B9E79085FB602818382808000020B0500000B0B0F0002000000000000020040302AD1A07856DA9288D0A07A901853385B5A900851DCE9004A0008C5B07AD4E07D001C88C0407AE1007AC5207F007C001F003BE1891B916918586BD1C9185CEBD25918DC40320F185AC1507F01AAD5707F015B92D918DF807A9018DFA074A8DF9078D57078D9F07AC5807F014A903851DA2002084BDA9F085D7A205A000201EB9AC4E07D003200BB7A907850E6056406570664066406640666065700000EE7407A9008D2207A98085FCCE5A07100BA9008D7207A9038D700760AD5F070AAAAD5C072902F001E8BCBD91AD5C074A98B0044A4A4A4A290FCD1A07F0049002A9008D5B072082924C6492AD720720048E249267853792A9008D3C078D2207A90285FCEE7407EE720760A9008D7407ADFC062910D005ADA007D039A98085FC2082929013AD5F078DFD07A9000A8D72078DA0078D70076020039CA9018D5407EE5707A9008D47078D5607850E8D7207A9018D70076038AD7A07F021AD6107301CAD530749018D5307A206BD5A0748BD61079D5A07689D6107CA10EF1860A9FF8DC90660AC1F07D005A0088C1F07889820C892CE1F07D003206A896020048EDB92AE88AE88FC93DB92AE88AE88FC93EE2607AD2607290FD0068D2607EE2507EEA006ADA006291F8DA006600030609300001112121300005152530000000000000102020300000000000091929300000000515253414243000000000091929787888999000000111213A4A5A5A5A697989901020300A4A5A6001112121213000000000102020300A4A5A5A600000011121213000000000000009C008BAAAAAAAA1112138B009C9C00000102031112121300000000AAAA9CAA008B0001020380830081840082850002000003000004000000050607060A0008094D00000D0F4E0E4E4E000D1A8687878787878787878787696900000000004547474747470000000000000000000000000086876954526200000018011807180F18FF18011F071F0F1F811F01008F1FF11FF918F118FF1FAD2807F003200895A20CA9009DA106CA10FAAC4207F042AD2507C903300538E90310F70A0A0A0A79F6926D2607AABDFA92F02648290F38E90185000A6500AA684A4A4A4AA8A9038500BD8A9399A106E8C8C00BF004C600D0F0AE4107F013BCAD93A200B9B193F0039DA106C8E8E00DD0F2AC4E07D00CAD5F07C907D005A9624C8894B9D893AC4307F002A9888507A200AD27070AA8B9DC938500C88401AD4307F00AE000F006A50029088500A000B98AC62400F005A5079DA106E8E00DF018AD4E07C902D008E00BD004A9548507C8C008D0DBA401D0BE200895ADA00620E19BA200A0008400BDA10629C00A2A2AA8BDA106D90495B002A900A400910698186910A8E8E00D90DD60105188C0A2028608A9008D2907AC2C07B1E7C9FDF04BBD30071046C8B1E70A900BAD2B07D006EE2B07EE2A0788B1E7290FC90DD01BC8B1E7882940D01CAD2B07D017C8B1E7291F8D2A07EE2B074C6E95C90ED005AD2807D008AD2A07CD250790062095954C7195EE2907208995A608BD30073003DE3007CA108CAD2907D085AD2807D08060EE2C07EE2C07A9008D2B0760BD30073003BC2D07A210B1E7C9FDF0E3290FC90FF008A208C90CF002A2008607A608C90ED008A9008507A92ED053C90DD01BA9228507C8B1E72940F063B1E7297FC94BD003EE4507293F4C1696C90CB027C8B1E72970D00BA9168507B1E7290F4C16968500C970D00AB1E72908F004A9008500A5004C1296C8B1E729704A4A4A4A8500BD30071042AD2A07CD2507F011AC2C07B1E7290FC90ED005AD2807D02160AD2807F00BA9008D28078D2907850860AC2C07B1E729F04A4A4A4ACD2607D0DFAD2C079D2D07208995A50018650720048EE59840972E9A3E9AF299509A599AE598419BBA9779997C997F99579968996B99D099D7990698B79AAB9894990E9B0E9B0E9B019B199B199B199B149B199B6F98199AD39A82989E99099A0E9A019AF2960D970D972B972B972B974596C596BC2D07C8B1E7482940D0126848290F8D27076829304A4A4A4A8D420760682907C90490058D4407A9008D410760A204AD5F07F008E8AC4E0788D001E88A8DD606200888A90D201697AD230749018D2307608500A900A204B416C400D002950FCA10F560141718A600BD2097A005883007D91600D0F8A9008DCD0660AD330720048E4C977897699A20BB9BBD3007F01F1011989D3007AD25070D2607F005A9164CB097A607A9179DA106A94C4CAA97A9184CB09720AC9B8406900CBD30074A9D3607A9194CB097A91BBC3007F01EBD36078506A607A91A9DA106C406D02CE8A94F9DA106A950E8A00F4C7D9BA607A0004C7D9B42414320AC9BA000B007C8BD3007D001C8B9B7978DA1066000454545000048474600454949494547474A474747474B47474949494949474A474A47474B474B4747474747474A474A474A4B474B474B20BB9B8407A00420AF9B8A48BC3007A607A90B8506B9CF979DA106E8A506F007C8C8C8C8C8C606E00BD0EA68AAAD2507F036BD3007C901F02AA407D004C903F022C902D02320CB9B48204A99689587AD2507956EA90195B6950FA99095CFA931951660A0528CAB066020BB9BBC3007A607A96B9DA106A96C9DA20660A00320AF9BA00A20B398B010A206A9009DA106CA10F8B9DD988DA8066015140000151E1D1C1521201FA00320AF9B20BB9B88888405BC30078406A605E8B99F98C900F008A200A405207D9B18A406B9A3989DA106B9A7989DA206601110151413121514203999A500F004C8C8C8C89848AD60070D5F07F02BBC3007F026204A99B02120CB9B1869089587AD25076900956EA90195B6950F20D39B95CFA90D95162087C768A8A607B9DD989DA106E8B9DF98A406884C7D9BA00120AF9B20BB9B9829078506BC300760A20018B50FF005E8E005D0F66020AC9BA9868DAB06A20BA001A9874C7D9BA9032CA9074820AC9B68AAA9C09DA10660A9062CA9072CA9094820AC9B68AAA90B9DA106E8A000A9634C7D9B20BB9BA202A96D4C7D9BA9248DA106A201A008A925207D9BA9618DAB0620CB9B38E908858CAD2507E9008573A93085D4A9B08D0D01A930851BE61460A200A00F4CE9998A48A201A00FA944207D9B68AA20BB9BA201A9404C7D9BC3C2C2C2AC4E07B9EE994C449A060708C50C89A00C20AF9B4C0E9AA9088D7307A400BEF999B9FC994C209A20BB9BA607A9C4A0004C7D9B696161622251525288AC4E07AD4307F002A004B9299A4C449AAC4E07B9259A4820AC9BA607A000684C7D9BAC4E07B9299A4C5F9AAC4E07B9259A4820BB9B68A6074C7D9B20BB9BA607A9649DA106E888300EA9659DA106E8883005A966207D9BAE6A0420D39B9D7704AD25079D6B0420CB9B9D7104E8E0069002A2008E6A046007070605040302010003030405060708090A20AC9B9005A9098D3407CE3407AC3407BEAE9AB9A59AA8A9614C7D9B20BB9B204A9920CB9B9587AD2507956E20D39B95CF9558A9329516A00194B6F60FA607A9679DA106A9689DA20660AD5D07F036A9008D5D074C199B20369B4C2C9BA9008DBC0620369B8407A900AC4E0788F002A905186507A8B9E8BD4820BB9B4C489AA50038E900A8608700000020AC9B902DAD4E07D028AE6A0420CB9B38E9109D7104AD2507E9009D6B04C8C8980A0A0A0A9D7704E8E0059002A2008E6A04AE4E07BD3D9BA208A00F8C3507BCA106F018C017F017C01AF013C0C0F00CC0C0B00BC054D004C950F0039DA106E8E00DB006AC35078810D26020BB9BBD3007181005989D30073860BC2D07B1E7290F8507C8B1E7290FA860AD26070A0A0A0A60A5070A0A0A0A1869206000D00505484A4A4A4AA8B9DF9B850768290F1879DD9B850660FFFF12360E0E0E3232320A264020139C8D500729600A2A2A2A8D4E0760AC5F07B9B49C186D6007A8B9BC9C60AD500720099CA8AD5007291F8D4F07B9E09C186D4F07A8B9E49C85E9B9069D85EAAC4E07B9289D186D4F07A8B92C9D85E7B94E9D85E8A000B1E7482907C90490058D4407A9008D4107684829384A4A4A8D10076829C0182A2A2A8D1507C8B1E748290F8D2707684829304A4A4A4A8D42076829C0182A2A2AC903D0058D4307A9008D3307A5E718690285E7A5E8690085E86000050A0E13171B202529C026602829012762243520632229412C612A3126622E232D603329012764303221651F061C007097B0DF0A1F597E9BA9D0011F3C517B7CA0A9CEF1FAFB35608EAAB3D8053360719B9D9D9D9D9E9E9E9E9E9E9E9F9F9F9F9F9F9F9F9F9F9F9FA0A0A0A0A0A0A1A1A1A1A10003191C0645C06BCE378A198EF348CD323B7A8FF65BCEFF92057ED70235D879AF108F026FFAAEAEAEA4A4A5A5A6A6A6A7A7A8A8A8A8A8A9A9A9AAABABABACACACADA1A2A2A3A3A376DDBB4CEA1D1BCC565D169DC61D369DC91D04DB491D841BC95D88950F08304C782DA62890B5FF0F03561BC91B0F07361BAA1B48950F0A2A1B5B0C782D90B5FF0B8C4B4C775FEB0CBDDB199D751D7D5BD91D3DDD991D269D5A2B8A2CCA1B20957B5CDB4C1BCC3BCC782DA62890B5FF0B8C3B1D8B1DAB0CDB1D0F03651D6B1B059D0B1B059B0B1D8B0C1B8C70157B0CDB0C0F08782DA62890B5FF27A94B0C68290F06771B0F0B60154B8C782D90B5FF0F038E65E1BB386DA83EE5E70F080B022B025E65E1BB0EDB0EBB8EDB0EFE65EC0F0D4E65E10F0E4E02E00F10FEE5E11B857B0C5B95782D90B5FFA586E42818A845836903C6299B8316A48824E92805A87B28248FC803E80346A88524C824FFEB8E0F03FB051785DB8E0F0757057B059B802B85FB050F0B1B059B05FF2EC266E2110F0702110F0C1211FF0EC2A8AB00BB8E6B82DE00A0338643063EB4A0CB020F077E42A683020F0A3B02CB370F0CE30EFF9B8ECA0EEE42445B8680B81B8050BA10B75B0017854B05FE3440B786C6065B808300D0385B8E8A0EA600BB0EC580F300FF1EC2006B068B8663B70F05030623064BB7BB005BB7FB373BB70F0B1B37FF2BD7E303C286E20676A5A38F03862B576828E928E583248F36A85B03FF0F02784048CEF8C3F8C30F077B43C6D00F8AC850FF85860B801B00DB377780EB37FE2B202B807B38ABB87786FE422049868B069B807B8E5BB79B0EBB0E9B80FF0B80603810B8C03BDB8E40B8F0387B8EA0B8C0B8FB00A0B830BBEE42880F0B2B0E670EFF0AAA0E282A0E3188FFC783D703428F7A0305A47824A625E4254B83E30305A48924B52409A46524C9240F088525FFCDA5B5A807A87628CC2565A4A924E52419A40F079528E62419A4D72916A958299729FF0F0202110F070211FFFF2B82AB38DE42E21BB8EB3BDB808BB81B82FBB87B80FB3C5BBC7BB81B8ECB0E1B8E0F0D2B3BBBB8EB824BB8BB383BB7BB020F131B00CB806BBCFF7B80AE00808B8EE805F986178616854E2B80AB8E8785C3058B829B02AB02BB86CB06D3033B8E6B0EA78EFF298E5211830E0F039B0E2B8E5B0ECB8EFB0EFB829B82BB02FE42E8BB8E0F0AAB0ECB0EF90E8886A606DB02B68EFFABCEDE42C0CBCE5B8E1BCE4B8567450F072B007B8597050F0A9202FF0AAA0E244A1E23AAFF1B80BB384BBCEB3B0F042B00AB38EB00CB8EFB80ABB86B80FB3C9BBB5BBCFB006BB8FB38FF0B861A06DB06DEC202F03BBB80EB060B869306F0390F0660B81B86A0B9B727BD272B83A126A926EE250B27B4FF0F021E2F60E03AA5A7DB803B828B02FE426870BB25A72C27B226B9269B80A882B527BC27B0BB3B828734EE256BFF1EA50A2E28272E33C70F031E40072E30E70F051E24440F071E226A2E23AB0F091E41681E2A8A2E23A22E32EAFF3B876627CC27EE3187EE23A73B87DB07FF0F012E252B2E254B4E25CB6B079747E98747C77A07D6C778073887AB47E3079B870F096847DBC73BC7FF479BCB07FA1D869B3A875607881B079D2E65F0FF9B07053206330734CE03DC51EE0773E0740A7E069E0ACE06E400E80AFE0A2E894E0B540A148AC40A348A7E06C70A01E0020A470A8160820AC70A0E877E02A702B302D702E302078213023E067E02AE07FE0A0DC4CD43CE09DE0BDD42FE025DC7FD5B070532063307345E0A68649864A864CE06FE020D011E0E7E029463B463D463F46314E32E0E5E0264358872BE0E0D04AE02CE08CD4BFE020D0568317E0A9631A963A833D530EE02E662F46104B1083F44339463A431E43104BF083F04BF083FCD4B03E40E032E017E06BE02DE06FE0A0DC4CD43CE09DE0BDD42FE025DC7FD9B07053206330734FE0027B16532750A7100B73108E418641E04573BBB0A178A273A730A7B0AD70AE73A3B8A970AFE08248A2E003E4038646F009F00BE43C80AC963CE07FE072E8166426A42790ABE00C864F86408E42E077E039E07BE03DE07FE0A03A50D44CD43CE09DD42DE0BFE025DC7FD9B07053206330734FE060C81390A5C01890AAC01D90AFC012E83A701B700C701DE0AFE024E835A32630A690A7E02EE03FA32038A090A1E02EE03FA32038A090A14421E027E0A9E07FE0A2E865E0A8E06BE0AEE073E835E07FE0A0DC441525152CD43CE09DE0BDD42FE025DC7FD5B07053206330734FE0AAE86BE07FE020D022732466155625E0E1E82683C743A7D4B5E8E7D4B7E8284629461A431BD4BCE06FE020D0634313E0A6432750A7B61A433AE02DE0E3E8264327832B436C836DD4B44B258329463A43EBA30C961CE06DD4BCE86DD4BFE022E865E027E06FE021E863E025E067E029E06FE0A0DC4CD43CE09DE0BDD42FE025DC7FD5B060532063307345E0AAE020D0139730D03397B4D4BDE061E8AAE06C43316FEA577FE02FE820D073973A874ED4B49FBE874FE0A2E826702847A87310D0BFE020D0C39735E06C67645FFBE0ADD48FE063DCB467EAD4AFE8239F3A97B4E8A9E07FE0A0DC4CD43CE09DE0BDD42FE025DC7FD94110F26FE1028946515EB12FA414A965440A442B713E919F515118047427113804115921B1F2440551264409512A440D212E14013C02C172F12491383409F14A340179283139241B914C512C840D4404B92781B9C949F11DF14FE117DC19E42CF20FD90B10F2629917E42FE4028924E422EC05773C325C727238433205C01776388629961AA60BC01EE424EC069117E42DE40F8620EC2AE40D763E76333A737274304CC01E7730C813E420D0A5E408872BE42E787FE4039E14E0069608760A560C331FE316DC1BE42EF20FD52210F206E4058F2930197000C819740A641C7400D040301070123012701EC03ACF3C30378E2944347F3744347FB74432CF14C63470057215C017C7239F1EC024C81D862EC010D0D0F38C707ED4A1DC15F26FD54210F26A72237FB7320830787029320C77304F1063139715971E77337A04704867CE571E73133A43971A971D32308F21305270249717575E87267F39971E720F472F73117A0332039717328BC0539F17971A621C306D320DC00FC0007A213215F328C00987AC763D96103A2072274727731E77339F158727773D8727FB19773B664C565D466E367F3678DC1CF26FD52310F206E66078136016600A72208F2677BDC0298F2D72039F19F33DC27DC57238357636C5187639961A306B32177F3F321F72A1381232253006322E90B0C831321162233058F35EC0163A067207301770183208720B320B720C301C700D320D72067A077078722E862F5651C827F388DC1CF26FD502107814724570063017701C97168F2E77397FB06835C01D722E70003A76C02B322E301E70747A05706A701D300D70107816720932203A31C6117216F33C763D862E961FA604FB387639C01B763C862D961EA6039F18721A701B72039F15F386DC1AF26FD90110F26FE102A938717A314B2420A9219403614504182162B932441BB14B800C243C3131B946712C41553C1D24112C1291385171B921A4247138341A7130E91A763B763C565D565DD4AE367F3678DC1AE42DF20FD90110F266E108B17AF32D862E862FC3FADC8F8640CBE4343F8640CBF734084409340A440B340F86448E45C3983409241B340F86448E45C39F86413C237654C2463009765C3420B97AC32F8640CBE53459D48F8642AE23C475643BA62F8640CB78864BC31D445FC313CB178648C380B9C1A331861286139605D4AEE110FB81DC13E426F20FD52310F206E40F720078417204F34C303C702D32227E33961E7735CE457006C7347A053066322A773FC7313A1330543215C72C323CC0377FBAC0239F1A773D304E872E32226F4BC028C81A86217874324A701C30408F29721A302C90BE169F1698DC1CF26FD38110F26AD403DC7FD95B10F260D02C8721C8138720D0597349862A320B306C320CC03F9912C8148620D093763470357218C02C579C731F91139F1A9116FB4D365E3657DC1BF26FD00C14C00F44F0D020242434F52C2DE005AC24DC7FD90510F26EE100B94331442427716864402924A1669427314B000C71205C01C171F1136128F1491401B94351234426042611287129640A3141C981F1147129F15CC15CF1105C01F1539127C167F1182409812DF1516C4171454129B162894CE013DC15E428F20FD97110F26FE102B9257128B12C041F7135B92690BBB12B2461993710017947C147F119341BF15FC13FF112F95504251125814A612DB121B9346437B128D49B7141B94490BBB12FC13FF1203C12F1543124B1377139D4A15C1A141C312FE017DC19E42CF20FD52210F206E440CF14C01AA35D934EE2008B3373243044E2153207C019721B7079C81E7425FB39763AC02C54149E05861766485659466A422A603C822DC0268F2964213821702AF34F621FC0626802A2436018C00FF354EA05521772087078922AE214C829F34EC0103E713678D4AAD410FA6FD10514C00C712C642039202422912631262426914A512A442E214E144F81637C18F3802BB287A687AA87AE06AF06A6DC5FD92310F206E400D023773EC000C803C006C009C0006C0C773068328729640E77326C0877BD24139F1C8F297E3A323E702E307F32237E39C00BC00EC000C803C008621A606B6245C807C009C0029E1DC05F641DC80E8720C8127734C0166740D113F35B6412C8236407C028640F96139E1AC04C6410C83164188F239F17C0089619C00A763BC00C565DC00E367F3678DC1CF26FD55B10F26CF3307B215115242990BAC02D324D642D7252384CF3307E31961787AEF332C81466455656565EC74478253056321624196229A41CC03B99139F163266727D306FC0118E2D907E9040C86372293248784AC02C241C323D971FC017FB19C00A763B664CC00D466E367F3678DC1CF26FD50B10F26FC001FB35C006565746683679367DC734C80B320C90BC308D32FDC002C804C008C00D32EED4AFC00D7A1EC014C805911D811DA1037A047049911E7213A906720761077608707D81239F1AC00E9710C802C004C05C77B39F1EC00F9110C826F34F811FA107FB2AC00B664CC01E367F3678DC1CF26FD52B10F206E453991B304C321C811CA1049917C73E81288918A10E721059107301707272049119C01C87223A62726D303D87A8991D87239F1A91109F163246724D86228912A1056217004790B8C0094219F352FB83DC17F26FD06C14C00F44F0D020620244F35A036205346D520D62034A1734974209420B420D420F4202E8059424DC7FD96310F260D031A607742C400C862B9E1D306D707F9610C814EB18EB1BC01E450E9610C810D0A844398720D0C0F381DC15F26FD480F0E015E02A700BC731AE03961586277639763B862D607F86219E175528640875095529343A521C552D640D720E506E6513E8D5E03675277527E029E03A643A723DE05FE021E8333544640472156045E028354935296079750BE03C723FE020C824345452446249008955178FAD77339F18C01A852B852CC015FB397639E000E81162466048E00FE0108D20E066F479E0F0E822D47287A687AA87AAE01DE0F6DC5FD480F0E015E02BC01FC012C8241524E04672568246924BA42C704DE0BB287FE022CE12C716701770087018E00EE01F602038505021321160227022E028872C720D707E47607A01706487A7620987279E188629C01B773DC01F862FE0108E20E006E027320772383049320AE00FE0A0E823971A872E7730C818F32AE00FE0404D1170426492729DF33FE0244F67C018E06BF47EE0F4DC70E82687AAE01DE0F6DC5FD48010E01005A3E06454647465344AE01DF4A4DC70E81005A2E0437283A484647C707CE0FDF4A4DC70E81005A335343514640475053045540565062436440655071417351835194409550A350A540A650B351B640B750C353DF4A4DC70E81005A2E02364737523A494725A752D704DF4A4DC70E81005A3E024451534454445524A154AE01B421DF4AE5074DC7FD4101B434C852F25147D36C0365499E07BE01CC03FE070DC91E016C01623563538A41AC01B353E95126C3273363436433BA60C961CE0BE509EE0F7DCA7D47FD4101B852EA4127B2B34216D44A42A551A73127D308E216642C04384276648862DE07FE010DC92332315198520DC959426353673114C23631875317E3296130623C08423759406A429940C961D76339D15852C367D331DC06F742FA4223B14367C334C734D15143B347339A30A961B862BE0BD509DE0F0DCA7D47FD490F1E0139735E07AE0B1E826E889E020D042E0B45094E0FED47FDFFAD720720048EE48F67857190EAAEAE5307BDFC068DFC06204AB0AD7207C903B001602024B6A20086082047C020C384E8E006D0F32080F1202AF120E9EE20D4BEA20186082070BECA86082070BE2096BB20BCB920B8B72055B8204FB720E189A5B5C9021011AD9F07F01EC904D008AD7F07D00320ED90AC9F07A509C008B0024A4A4A2088B24C67AF209AB2A50A850DA900850CAD7307C906F01CAD1F07D014AD3D07C9203010AD3D07E9208D3D07A9008D400320B09260ADFF06186DA1038DFF06AD2307D059AD5507C9509052AD8507D04DACFF06883047C8C002900188AD5507C9709003ACFF06988D7507186D3D078D3D0798186D1C078D1C078D3F07AD1A0769008D1A0729018500AD780729FE05008D78072038B0A9088D95074C00B0A9008D7507A20020F6F18500A0000AB007C8A5002920F01BB91C0738F934B08586B91A07E900856DA50CD936B0F004A9008557A9008DA1036000100102AD1C071869FF8D1D07AD1A0769008D1B0760A50E20048E3191C7B106B2E5B1A4B2CAB2CD9169B0E9B033B245B269B27DB2AD5207C902F02BA900A4CEC030906EAD1007C906F004C907D050ADC403D005A9014CE6B0201FB2CEDE06D050EE69074C15B3AD5807D00CA9FF2000B2A5CEC991902860AD9903C960D032A5CEC999A000A901900AA903851DC8A9088DB4058C160720E6B0A586C9489012A908850EA90185334A8D52078D16078D5807608DFC06A50EC90BF03CAD4E07D010A4B588D006A5CEC9D09005A9008DFC06ADFC0629C0850AADFC062903850CADFC06290C850B2904F00EA51DD00AA40CF006A900850C850B2029B3A001AD5407D009A000AD1407F002A0028C9904A901A457F00510010A85452093AF2080F1202AF1A200209CE22064DCA5CEC9409016A50EC905F010C907F00CC9049008ADC40329DF8DC403A5B5C902303BA2018E2307A0048407A200AC5907D005AC4307D016E8A40EC00BF00FAC1207D006C884FC8C1207A0068407C507300CCA300AACB107D004A906850E60A9008D580720DDB1EE520760A5B5D006A5CEC9E4900CA9088D5807A003841D4CE6B0A9028D52074C13B2A9012000B22093AFA000ADD606D017C8AD4E07C903D00FC84C0BB21865CE85CE60201FB2A002CEDE06D00E8C5207EE7407A9008D72078D220760A9088557A001A586290FD0038557A89820E6B060AD4707C9F8D0034C55B2C9C4D0032073B260AD4707C9F0B007C9C8F0234CE9B0D013AC0B07D00E8C0D07EE0B07AD540749018D540760AD4707C9F0B0334CE9B0A9008D4707A908850E60AD4707C9C0F013A5094A4A29038500ADC40329FC05008DC403602073B2ADC40329FC8DC4036060A51BC930D015AD130785FFA9008D1307A4CEC09EB002A9044CE6B0E60E601523161B17182363A90120E6B0A5CEC9AE900EAD2307F009A92085FCA9008D2307AD90044AB00DAD4607D003EE4607A9208DC403AD4607C905D02BEE5C07AD5C07C903D00EAC5F07AD4807D9C2B29003EE5D07EE600720039CEE57072013B28D5B07A98085FC60A900AC5407D008A51DD007A50B29048D14072050B4AD0B07D016A51DC903F005A0188C890720048E5AB376B36DB3CFB360208FB5A50CF002853320CCB52009BF8DFF0660AD0A078D09074CACB3A49F1013A50A2980250DD011AD080738E5CECD06079006AD0A078D0907AD0407F014208FB5A5CEC914B005A9188D0907A50CF0028533A50CF00320CCB52009BF8DFF06A50EC90BD005A9288D09074C4DBF0E04FCF20000FFFFAD1604186D33048D1604A000A59F100188840065CE85CEA5B5650085B5A50C2D9004F02DAC8907D027A0188C8907A200A4334AB002E8E888F001E8A586187DC7B38586A56D7DCBB3856DA50C49038533608D89076020201E28280D0470706090900A09FCFCFCFBFBFEFF00000000008000D8E8F02818100CE498D000FF010020FFA51DC903D023A000A50B2D9004F006C82908D001C8BE4DB48E3304A908BE4AB4869F30014A8D0C0760AD0E07D00AA50A2980F004250DF0034C1CB5A51DF011AD0407F0F4AD8207D007A59F10034C1CB5A9208D8207A0008C16048C3304A5B58D0707A5CE8D0807A901851DAD0007C9099010C8C910900BC8C9199006C8C91C9001C8A9018D0607AD0407F008A005AD7D04F001C8B924B48D0907B92BB48D0A07B939B48D3304B932B4859FAD0407F011A90485FFA5CEC914B012A900859F4C1CB5A901AC5407F002A98085FFA0008400A51DF009AD0007C919B0339018C8AD4E07F01288A50CC545D00BA50A2940D019AD8307D019C8E600AD0307D007AD0007C921900AE6004C5EB5A90A8D8307B940B48D5004A50EC907D002A003B943B48D5604A400B947B48D0207A9008D0107A533C545F0060E02072E010760020407A000AD0007C91CB015C8C90EB001C8ADFC06297FF0202903C545D008A9008D03074CC5B5AD0007C90BB00BA5338545A90085578D0507B98CB58D0C07602D9004C900D008A557F049102330034A901EAD0507186D02078D0507A5576D01078557CD56043023AD560485574C20B6AD050738ED02078D0507A557ED01078557CD50041005AD50048557C900100549FF1869018D000760AD5607C9029043A50A2940F033250DD02FADCE062901AAB524D025A4B588D020AD1407D01BA51DC903F015A92085FFA9029524AC0C078C1107888C8107EECE06A2002089B6A2012089B6AD4E07D013A202860820F9B62031F12091F120E1EDCA10EF6040C08608B5240AB063B424F05E88F027A5866904958DA56D69009574A5CE95D5A90195BCA43388B987B6955EA90495A6A9079DA004D6248A186907AAA9508500A9038502A90020D7BF200FBFA608203BF12087F1202DE220C8E1ADD20329CCD00620D9D64CDEECA900952460203BF14C09EDBDA80729018507B5E4C9F8D02CAD9207D03FA000A5334A9002A008986586959CA56D69009583A5CE18690895E4A90195CBA407B94DB78D9207A407BD2C0438F94BB79D2C04B5E4E900C920B002A9F895E460FF504020AD7007F04FA50EC9089049C90BF045A5B5C902B03FAD8707D03AADF8070DF9070DFA07F026ACF80788D00CADF9070DFA07D004A94085FCA9188D8707A023A9FF8D3901205F8FA9A44C068F8D56072031D9EE590760AD2307F0FAA5CE25B5D0F48D2307EED6064C98C9AD4E07D0378D7D04AD4707D02FA004B97104187977048502B96B04F01C69008501A58638F97104A56DF96B04300BA50238E586A501E56D10048810D360B977044A8500B971041865008501B96B0469008500A5094A902CA50138E586A500E56D100EA58638E9018586A56DE9004C39B8AD90044A900DA5861869018586A56D6900856DA9108500A9018D7D0485024AAA4CD7BF05020804010303040404A2058608B516C930D056A50EC904D031A51DC903D02BB5CFC9AAB028A5CEC9A2B022BD170469FF9D1704B5CF690195CFAD0E0138E9FF8D0E01AD0D01E9018D0D014CACB8AC0F01B94BB8BE50B89D34012027BCA905850E20AFF12052F1204BE5600810080020AFF1AD4707D040AD0E07F03BA888982902D007E6CEE6CE4CD9B8C6CEC6CEB5581879B6B895CFC001900FA50A2980F009250DD005A9F48DDB06C003D00AADDB06859FA9008D0E072052F1207DE8207AD6AD0E07F00DAD8607D008A9048D8607EE0E0760A92F9516A901950FB97600956EB98F009587B9D70095CFAC9803D0038D9D038A999A03EE9803A90485FE603060E005D068AC980388AD9903D949B9F00FA5094A4A9009A5D4E90185D4EE9903AD9903C90890462052F120AFF1A0002035E4C8CC9803D0F7ADD103290CF01088BE9A032098C98810F78D98038D9903AD9903C9209017A206A901A01B20F0E3A402C0D0B008B106D004A9269106A608600F07AD4E07F06FA2028608B50FD051BDA807ACCC0639BAB9C906B044A8B96B04F03EB97D04F008E900997D044C1ABAAD4707D02CA90E997D04B96B04956EB971049587B9770438E90895CFA90195B6950F4A951EA9099D9A04A93395164C2DBAB516C933D00D207AD6B50FF00620AFF12033BACA10936018E8AD4707D03EB51ED02EADD103290CC90CF040A0012043E13001C8944688B931BA9558A5006928C9509028A901951EA90A9D8A07A90885FEB51E2920F0032063BF2002BF20AFF12052F12043E22053D84C7DE82098C96004040405050506060610F0ADA8072907D005ADA8072908A8B92A00D019BE89BAB50FD012A6088A99AE06A990992A00A90799A2043860A6081860AD4707D063B52A297FBCAE06C902F020B0348A18690DAAA9108500A90F8501A9048502A90020D7BF200FBFA6084C28BBA9FE95ACB91E0029F7991E00B646CABD92BAA6089564D62AB987001869029593B96E006900957AB9CF0038E90A95DBA90195C2D00320C4D7209BF12048F12036E220DCE4602084BBB576997A00B58F0905999300B5D7E91099DB004C6CBB2084BBBDEA03997A00A5060A0A0A0A0905999300A502692099DB00A9FB99AC00A90199C200992A0085FE860820FEBBEE480760A008B92A00F00788C005D0F6A0088CB70660A2088608B52AF0560A900620C3BA4CF4BBB42A88F01DF62AB593186D75079593B57A6900957AB52AC930D026A900952A4CF4BB8A18690DAAA9508500A90685024A8501A90020D7BFA608B5ACC905D002F62A2048F1209BF12036E22086E6CA10A160171D0B110213A9018D3901AE5307BCF8BB205F8FEE5E07AD5E07C964D00CA9008D5E07EE5A07A94085FEA9028D3801AE5307BCFABB205F8FAC5307B9FCBB20068FAC0003B9FB02D005A92499FB02A60860A92E851BB5768573B58F858CA90185BBB5D738E90885D4A90185238514A9038D9F04A539C902B00AAD5607C90290014A8539A9208DCA03A90285FE60A2058608A523F05D0A9023AD4707D043A539F011C903F00DC902D03720F9CA2063E14CD8BC2077CA20C1DF4CD8BCA5092903D019C6D4A523E623C911900FA9109558A98085230A8DCA032A9546A523C90690122052F120AFF12043E220D2E62053D8207AD660041248A911AEEE03AC5407D002A9129526206B8AAEEE03A5029DE403A8A5069DE603B10620F6BD8500AC5407D001989025A0119426A9C4A400C058F004C05DD015ADBC06D008A90B8D9D07EEBC06AD9D07D002A0C4989DE8032084BDA402A9239106A9108D8407688505A000AD1407D005AD5407F001C8A5CE1879EBBC29F095D7B426C011F0062002BE4C7BBD209BBDADEE0349018DEE0360A58618690829F0958FA56D690095769DEA03A5B595BE60201FBEA90285FFA90095609D3C04859FA9FE95A8A50520F6BD903198C9099002E90520048ED2BD38BB38BBD8BDD2BDDFBDD5BD38BBD8BDA9002CA9022CA90385394C49BCA205ACEE03201EB960C1C05F6055565758595A5B5C5D5EA00DD9E8BDF0048810F81860201FBEA9019DEC0385FD2041BEA9FE859FA9058D39012027BCAEEE0360AEEE03A402F01A9838E9108502A8B106C9C2D00DA9009106204D8AAEEE032051BB60B58F9DF103A9F095609562A9FA95A8A9FC95AAA9009D3C049D3E04B5769578B58F9591B5D718690895D9A9FA95A860B526F05D290F48A88A186909AA88F03320A4BF200FBF8A186902AA20A4BF200FBFA6082059F120B6F12053EC68B4BEF03048A9F0D5D9B00295D9B5D7C9F0689020B01C20A4BFA6082059F120B6F120D1EBB5D7290FC90568B007A9019DEC03A900952660A2018608AD0103D021BDEC03F01CBDE6038506A9058507BDE4038502A8BDE803910620618AA9009DEC03CA10D560E8200FBFA60860AD0E07D03EAAB5570A0A0A0A8501B5574A4A4A4AC908900209F08500A000C9001001888402BD00041865019D0004A9002A486AB58665009586B56D6502956D6818650060A200AD4707D005AD0E07D0F3AD09078500A9044CADBFA03DB51EC905D002A0204C94BFA0004C77BFA001E8A9038500A9068501A9028502984CD1BFA07FD002A00FA902D004A01CA9038400E820ADBFA608600608A0002CA001A9508500B99FBF8502A9004CD7BFA9002CA90148B416E8A905C029D002A9098500A90A8501A903850268A820D7BFA6086048BD1604187D33049D1604A000B59F100188840775CE95CEB5B5650795B5BD33041865009D3304B59F6900959FC5023010BD3304C9809009A502959FA9009D330468F02BA50249FFA8C88407BD330438E5019D3304B59FE900959FC5071010BD3304C980B009A507959FA9FF9D330460B50F480AB01268F0034C82C8AD1F072907C907F00E4CCCC068290FA8B90F00D002950F600303060606060606070707050904050608090A060B1040B0B08040408040F0F0F0A56D38E904856DAD250738E9048D2507AD1A0738E9048D1A07AD1B0738E9048D1B07AD2A0738E9048D2A07A9008D3B078D2B078D39078D3A07B9F89B8D2C0760AD4507F05EAD2607D059A00B883054AD5F07D96BC0D0F5AD2507D976C0D0EDA5CED981C0D023A51DC900D01DAD5F07C906D023EED906EEDA06ADDA06C903D01EADD906C903F00FD007AD5F07C906F0E6208CC02071D0A9008DDA068DD906A9008D4507ADCD06F0109516A901950FA900951E8DCD064C26C2AC3907B1E9C9FFD0034C16C2290FC90EF00EE005900AC8B1E9293FC92EF00160AD1D0718693029F08507AD1B0769008506AC3907C8B1E90A900BAD3B07D006EE3B07EE3A0788B1E9290FC90FD019AD3B07D014C8B1E9293F8D3A07EE3907EE3907EE3B074CCCC0AD3A07956EB1E929F09587CD1D07B56EED1B07B00BB1E9290FC90EF0694C50C2A507D587A506F56E9041A90195B6B1E90A0A0A0A95CFC9E0F04CC8B1E92940F005ADCC06F06DB1E9293FC9379004C93F9031C906D007AC6A07F002A9029516A901950F2026C2B50FD04960ADCB06D009AD9803C901D00BA92F9516A900951E206CC2604C1BC7C8C8B1E94A4A4A4A4ACD5F07D00E88B1E98D5007C8B1E9291F8D51074C5BC2AC3907B1E9290FC90ED003EE3907EE3907EE3907A9008D3B07A60860B516C915B00DA8B5CF690895CFA9019DD8039820048E0EC30EC30EC31EC3F0C228C3F1C242C36BC3F0C275C375C3F7C287C7D1C74AC33DC385C3A0C7F0C2A0C7A0C7A0C7A0C7B8C7F0C2F0C25CC45CC45CC45CC459C4F0C2F0C2F0C2F0C2DFC712C83FC845C80BC803C80BC84BC857C849C560BC1EB9F0C2F0C2F0C2F0C2F0C207C381C860200EC34C46C3A90295B695CF4A9D96074A951E4C46C3A9B895CF60F8F4A001AD6A07D00188B90CC395584C5AC3200EC3A901951E608050A9009DA2039558ACCC06B926C39D9607A90B4C5CC3A9004C19C3A9009558A909D012A030B5CF9D01041002A0E09875CF9558A9039D9A04A9029546A90095A09D340460A9029546A9099D9A04602046C3BDA70729109558B5CF9D340460ADCB06D00BA9008DD106203DC34CD9C74C98C9262C32382022242613141516AD8F07D03CE005B038A9808D8F07A004B91600C911F02B8810F6EED106ADD106C907901DA204B50FF005CA10F93010A900951EA9119516208AC3A92020D8C5A60860A5CEC92C90F9B91E00D0F4B96E00956EB987009587A90195B6B9CF0038E90895CFBDA7072903A8A202B998C39501C8C8C8C8CA10F4A608206CCFA457C008B00EA8BDA8072903F0059849FFA8C8982046C3A0029558C9003001889446A9FD95A0A901950FA905951E60283828382800001010002075C5A9009558B51638E91BA8B94FC49D8803B954C49534B5CF18690495CFB5871869049587B56E6900956E4CD9C78030408030505070204080A0704090680E05060E1C20100C1E22181410602048AD8F07D0A12046C3BDA8072903A8B9A4C48D8F07A003ADCC06F001C88400E400B084BDA707290385008501A9FB95A0A900A457F007A904C01990010A481865008500BDA8072903F007BDA907290F850068186501A8B998C49558A9019546A557D012A400982902F00BB55849FF1869019558F646982902F00FA586187988C49587A56D69004C3CC5A58638F988C49587A56DE900956EA901950F95B6A9F895CF602075C58E6803A9008D63038D6903B5878D6603A9DF8D90079546A9208D64039D8A07A9058D83044A8D650360A0FFC8B90F00D0FA8CCF068A0980990F00B56E996E00B587998700A901950F99B600B5CF99CF006090807090FF01AD8F07D0F49D3404A5FD090285FDAC6803B91600C92DF03120D9D1186920ACCC06F00338E9108D8F07BDA70729039D1704A8B99DC595CFAD1D071869209587AD1B076900956E4C1FC6B9870038E90E9587B96E00956EB9CF0018690895CFBDA70729039D1704A8B99DC5A000D5CF9001C8B9A1C59D3404A9008DCB06A9089D9A04A90195B6950F4A9D0104951E60003060600020604070406030AD8F07D047A9208D8F07CED706A00688B91600C931D0F8B9870038E93048B96E00E9008500ADD70618791E00A868187931C69587A5006900956EB937C695CFA90195B6950F4A9558A90895A0600102040810204080403090502060A0700A0BAD8F07D06FAD4E07D057E003B066A000BDA707C9AA9001C8AD5F07C901F001C8982901A8B99AC69516ADDD06C9FFD005A9008DDD06BDA7072907A8B98AC62CDD06F007C89829074CD6C60DDD068DDD06B992C620D8C59D1704A9208D8F074C6CC2A0FFC8C005B00DB90F00F0F6B91600C908D0EF60A5FE090885FEA908D0A8A00038E93748C904B00B48A006AD6A07F002A002688401A0B02902F002A0708400AD1B078502AD1D078503A002684A9001C88CD306A2FFE8E005B02DB50FD0F7A5019516A502956EA50395871869188503A50269008502A50095CFA90195B6950F206CC2CED306D0CC4C5EC2A90195584A951E95A0B5CF9D340438E9189D1704A9094CDBC7B5168DCB0638E91220048EA4C3B7C7A8C4A3C53DC69CC660A005B91600C911D005A901991E008810F1A9008DCB06950F60A9029546A9F89558A9039D9A0460D6CFD6CFACCC06D005A0022071C8A0FFADA003951E10028AA88CA003A9009546A82071C8A9FF9DA2034C28C8A90095584C28C8A040B5CF100749FF186901A0C09D0104981875CF95582063C3A905AC4E07C003F007ACCC06D002A9069D9A0460204BC84C48C82057C84C2BC8A9109D3404A9FF95A04C60C8A9F09D3404A90095A0A0012071C8A9049D9A0460080CF80000FFB58718796BC89587B56E796EC8956E6060A608A900B416C015900398E91420048EE0C835C995D2D6C8D6C8D6C8D6C847C947C947C947C947C947C947C947C9D6C865C965C965C965C965C965C965C94DC94DC965D085BC4BB9D6C8D9D2BAB8D6C8A4B7D7C86020AFF12052F14C7DE8A9009DC50320AFF12052F1207DE82043E220C1DF2033DA2053D8AC4707D0032005C94C7AD6B51620048E77CA77CA77CA77CA77CAD8C977CA89CB36CC34C94ACC4ACCB0C9B0D3F9CAFFCA25CB28CF77CA34C9DFCE6020EBD120AFF12052F12043E22053D84C7AD6203CCD4C7AD620AFF12052F1204CE2207BDB2052F12066ED2055D64C7AD620AFF12052F12073E22045DBAD4707D0032082C92052F120C8E54C7AD6B51638E92420048E32D4D3D54FD64FD607D631D63DD6A900950F9516951E9D10019D96079D25019DC5039D8A0760BD9607D01620F7C2BDA80709809D3404290F09069D9607A9F995A04C92BF301C00E8001808F80CF4B51E2920F0034CE5CAB53CF02DD63CADD103290CD06ABDA203D017ACCC06B9CEC99DA2032094BA9009B51E0908951E4C58CADEA2034C58CA2037B51E2907C901F03EA9008500A0FAB5CF3013A0FDC970E600900BC600BDA8072901D002A0FA94A0B51E0901951EA5003DA907A8ADCC06D001A8B910CA9D8A07BDA80709C0953CA0FCA5092940D002A0049458A0012043E1300AC8BD9607D004A9F895589446A000B51E2940D019B51E0AB030B51E2920D05BB51E2907F024C905F004C903B0302063BFA000B51EC902F00C2940F00DB516C92EF007D0034C02BFA001B558481002C8C81879D0C995582002BF68955860BD9607D01E951EA5092901A8C8944688AD6A07F002C8C8B9D4C99558602063BF4C02BFC90ED009B516C906D0032098C9602092BF4C02BFB5A01D3404D0139D1704B5CFDD0104B009A5092907D002F6CF60B5CFD55890034C75BF4C70BF2045CB2066CBA001A5092903D011A5092940D002A0FF8400B5CF18650095CF60A9138501A5092903D00DB458B5A04AB00AC401F003F65860F6A06098F0FAD65860B55848A001B5A02902D00BB55849FF1869019558A00294462002BF8500689558603F03B51E2920D04DACCC06BDA8073987CBD0128A4A9004A445B008A0022043E1100188944620DFCBB5CF38FD3404C920900295CFB44688D00EB5871875589587B56E6900956E60B58738F5589587B56EE900956E604C8CBFB5A02902D037A509290748B5A04AB01568D011BD34041869019D34049558C902D002F6A06068D014BD340438E9019D34049558D007F6A0A9029D960760BD9607F008A5094AB002F6CF60B5CF6910C5CE90F0A90095A060B51E2920F0034C92BFA9E895584C02BF40800404B51E2920F0034C8CBF8503B51638E90AA8B946CC8502BD010438E5029D0104B587E9009587B56EE900956EA9208502E0029049B558C9109016BD17041865029D1704B5CF650395CFB5B669004CACCCBD170438E5029D1704B5CFE50395CFB5B6E90095B6A000B5CF38FD34041007A01049FF186901C90F900398955860000103040506070708000306090B0D0E0F100004090D101316171800060C12161A1D1F2000070F161C212527280009121B21272C2F30000B151F272E333738000C18242D353B3E40000E1B28323B424648000F1F2D38424A4E50001122313E49515658010302000009121B242D363F48515A630C1820AFF1ADD1032908D074AD4707D00ABD88032010D4291F95A0B5A0B416C01F900DC908F004C918D00518690195A085EF2052F1208ECEBCE506ADB9039900028507ADAE039903028506A90185002008CEA005B516C91F9002A00B84EDA9008500A5EF208ECE20BBCDA500C904D008ACCF06B9E5068506E600A500C5ED90E260A5038505A406A5014605B00449FF6901186DAE039903028506CDAE03B009ADAE0338E5064CE6CD38EDAE03C9599004A9F8D015ADB903C9F8F00EA5024605B00449FF6901186DB903990002850720EDEC9848AD9F070D4707D0708505A4B588D069A4CEAD5407D005AD1407F009E605E60598186918A89838E507100549FF186901C908B01CA506C9F0B016AD0702186904850438E506100549FF186901C9089013A505C902F023A405A5CE18793ACDE6054C32CEA201A504C506B001E88646A200A50048202CD9688500681869048506A6086048290FC9099005490F1869018501A400B92ECD186501A8B9C7CC85016848186908290FC9099005490F1869018502A400B92ECD186502A8B9C7CC8502684A4A4AA8B92ACD850360F8A070BD002020200000B51E2920F008A9009DC5034C92BF2002BFA00DA9052096BFBD34044A4A4A4AA8B5CF38F9D5CE100549FF186901C908B00EBD34041869109D34044A4A4A4AA8B9DACE9DC50360153040B51E2920F0034C63BFB51EF00BA90095A08DCB06A910D013A9128DCB06A002B925CF9901008810F7206CCF9558A001B5A02901D00AB55849FF1869019558C894464C02BFA0002043E1100AC8A50049FF1869018500A500C93C901CA93C8500B516C911D01298D5A0F00DB5A0F006D658B558D0409895A0A500293C4A4A8500A000A557F024AD7507F01FC8A557C9199008AD7507C9029001C8B516C912D004A557D006B5A0D002A000B90100A40038E9018810FA601A5898969492908E8C8A8886848280AE6803B516C92DD0108608B51EF01A2940F006B5CFC9E0900AA98085FCEE72074C71D0208CBF4C7BD1CE6403D044A9048D6403AD630349018D6303A9228505AC6903B9DDCF8504AC0003C8A20C20CD8AA608208F8AA90885FEA90185FDEE6903AD6903C90FD00B2063C3A940951EA98085FE4C7BD121411131B51E2920F014B5CFC9E0909EA2042098C9CA10FA8DCB06A60860A9008DCB06AD4707F0034C39D1AD630310034C0FD1CE6403D00DA9208D6403AD630349018D6303A509290FD004A9029546BD8A07F01C2043E11017A9019546A9028D6503A9209D8A078D9007B587C9C8B03EA5092903D038B587CD6603D00CBDA7072903A8B961D08DDC06B587186D65039587B446C001F017A0FF38ED6603100749FF186901A001CDDC0690038C6503BD8A07D028208CBFAD5F07C9059009A5092903D0032094BAB5CFC980901CBDA7072903A8B961D09D8A074C49D1C901D009D6CF2063C3A9FE95A0AD5F07C907F004C905B027AD9007D022A9208D9007AD630349808D630330E120D9D1ACCC06F00338E9108D9007A9158DCB0620BCD1A010B5464A9002A0F098187587ACCF06998700B5CF18690899CF00B51E991E00B546994600A50848AECF068608A92D951620BCD1688508AAA9008D6A0360EE6A0320D7C8B51ED0F5A90A9D9A042043E24C53D8BF40BFBFBF4040BFAC6703EE6703AD670329078D6703B9D1D160AD4707D030A940ACCC06F002A9608500BD010438E5009D0104B587E9019587B56EE900956EBC1704B5CFD99DC5F006187D340495CF2052F1B51ED0C3A9518500A002A5092902F002A0828401BCE506A200ADB903990002A500990102E600A501990202ADAE039903021869088DAE03C8C8C8C8E8E00390D9A60820AFF1BCE506ADD1034A489005A9F8990C02684A489005A9F8990802684A489005A9F8990402684A9005A9F899000260D6A0D00CA90895A0F658B558C903B0182052F1ADB9038DBA03ADAE038DAF03BCE506B5582017ED60A900950FA90885FEA9058D38014C36D3000008080008000854555657A9008DCB06AD4607C905B02C20048E11D3F2D212D34ED3A2D3A005ADFA07C901F00EA003C903F008A000C906F002A9FF8DD706941EEE460760ADF8070DF9070DFA07F0F1A5092904F004A91085FEA023A9FF8D3901205F8FA9058D3901A00BAD5307F002A011205F8FAD53070A0A0A0A09044C36BCB5CFC9729005D6CF4C65D3ADD706F0383036A9168DCB062052F1BCE506A203ADB903187DCDD2990002BDD5D2990102A922990202ADAE03187DD1D2990302C8C8C8C8CA10DAA608602065D3A9069D9607EE4607602065D3BD9607D005ADB107F0EF60B51ED056BD8A07D051B5A0D023B55830142043E11009A50049FF1869018500A500C9219035B55849FF1869019558F6A0BD3404B4581003BD17048500A5094A9019AD4707D014B5CF18755895CFC500D009A90095A0A9409D8A07A9209DC503608507B534D00EA018B5581865079558B5A0690060A008B55838E5079558B5A0E90060B5B6C903D0034C98C9B51E100160A8BDA2038500B546F0034CBBD5A92DD5CF900FC400F00818690295CF4CB1D54C98D5D9CF00900DE400F0F418690299CF004CB1D5B5CF48BDA2031018BD34041869058500B5A06900301AD00CA500C90B900CB004C508F00C20B7BF4CA7D420B1D54CA7D420B4BFB41E6838F5CF1879CF0099CF00BDA2033004AA2021DCA408B9A000193404F077AE0003E020B070B9A00048482041D5A5019D0103A5009D0203A9029D0303B9A000300DA9A29D0403A9A39D05034CFFD4A9249D04039D0503B91E00A86849FF2041D5A5019D0603A5009D0703A9029D080368100DA9A29D0903A9A39D0A034C30D5A9249D09039D0A03A9009D0B03AD000318690A8D0003A6086048B98700186908AECC06D00318691048B96E00690085026829F04A4A4A8500B6CF6810058A186908AA8AAE00030A2A482A290309208501A50229010A0A050185016829E01865008500B9CF00C9E89006A50029BF85006098AA20AFF1A9062011DAADAD039D1701A5CE9D1E01A90195462063C399A000993404609848206BBF68AA206BBFA608BDA2033004AA2021DCA60860B5A01D3404D0159D1704B5CFDD0104B00BA5092907D002F6CF4CFED5B5CFD558900620B7BF4CFED520B4BFBDA20330032021DC60A90E2047CB2066CBBDA203301CA5861865008586A56DA400300569004C28D6E900856D8CA1032021DC60BDA20330062088BF2021DC602002BF8500BDA2033007A91095582014D660205BD64CFED5205BD64C71D6AD4707D019BD1704187D34049D1704B5CF75A095CF60BDA203F0032019DC60B516C914F055AD1C07B416C005F004C00DD0026938E9488501AD1A07E9008500AD1D0769488503AD1B0769008502B587C501B56EE5003020B587C503B56EE5023019B51EC905F013C00DF00FC030F00BC031F007C032F0032098C960FFFFFFB524F0560AB053A5094AB04E8A0A0A18691CA8A20486019848B51E2920D034B50FF030B516C9249004C92B9026C906D006B51EC902B01CBDD803D0178A0A0A186904AA2027E3A6089009A9809524A601203ED768A8A601CA10BBA60860060002121107052D2052F1A601B50F100B290FAAB516C92DF00CA601B516C902F06BC92DD02DCE8304D0622063C395588DCB06A9FE95A0AC5F07B936D79516A920C003B0020903951EA98085FEA601A909D033C908F036C90CF032C915B02EB516C90DD006B5CF691895CF201BE0B51E291F0920951EA902B416C005D002A906C006D002A9012011DAA90885FF60A5094A9036AD47070DD603D02E8A0A0A186924A82025E3A608901BBDBE06D01BA9019DBE06B56449FF1869019564AD9F07D0084C2CD9A9009DBE06602098C9A9062011DAA92085FEA539C902900EC903F024A9238D9F07A94085FB60AD5607F01BC901D023A608A9028D560720F185A608A90C4C47D8A90B9D100160A9018D5607A909A0002048D96018E830D008F8A5094AB0F42041DCB023BDD803D01EA50EC908D018B51E2920D0122052DC2025E3A608B009BD910429FE9D910460B416C02ED0034C00D8AD9F07F0064C95D70A0604BD910429011DD803D059A9011D91049D9104C012F04EC00DF07DC00CF079C033F042C015B071AD4E07F06CB51E0AB034B51E2907C902902CB516C906F025A90885FFB51E0980951E2005DAB94FD89558A903186D8404BC9607C003B003B992D82011DA60A59F3002D06AB516C9079009A5CE18690CD5CF905BAD9107D056AD9E07D03DADAD03CDAE0390034CF6D9B546C901D0034CFFD9AD9E07D024AE5607F0228D5607A9088D9E070A85FF20F185A90AA001850E841DA0FF8C4707C88C7507A608608657E886FCA9FC859FA90BD0E102060506B516C912F0BDA90485FFB516A000C914F01BC908F017C933F013C90CF00FC8C905F00AC8C911F005C8C907D01DB965D92011DAB54648202FE0689546A920951E2063C39558A9FD859F60C909901D29019516A000941EA9032011DA2063C32005DAB951D895584CF1D9100BA904951EEE8404AD8404186D91072011DAEE9107AC6A07B9D2D99D9607A9FC859F60B546C901D0034C2CD9201CDB4C2CD9A0012043E11001C8944688609D1001A9309D2C01B5CF9D1E01ADAE039D170160804020100804027FBFDFEFF7FBFDA5094A90ECAD4E07F0E7B516C915B06EC911F06AC90DF066BDD803D0612052DCCA305B86019848B50FF04CB516C915B046C911F042C90DF03EBDD803D0398A0A0A186904AA2027E3A608A4019020B51E191E002980D011B991043D25DAD018B991041D25DA99910420B4DA4CAADAB991043D2CDA99910468A8A601CA10A5A60860B91E00151E2920D033B51EC906902EB516C905F027B91E000A900AA9062011DA2095D7A40198AA2095D7A608BD2501186904A6012011DAA608FE250160B91E00C906901DB91600C905F0F12095D7A401B92501186904A6082011DAA601FE25016098AA201CDBA608B516C90DF022C911F01EC905F01AC912F008C90EF004C907B00EB55849FFA8C89458B5464903954660A9FF9DA203AD4707D029B51E3025B516C924D006B51EAA205FDB2041DCB0148A2054DCB5CF85008A482025E368AA900320BCDBA60860AD4707D0379DA2032041DCB02FA9028500A6082052DC2902D022B9AD04C92090052025E3B019B9AD0418698099AD04B9AF0418698099AF04C600D0D5A60860A608B9AF0438EDAD04C904B008A59F1004A901859FADAF0438F9AD04C906B01BA59F3017A500B416C02BF005C02CF0018AA6089DA203A900851D60A9018500ADAE0438F9AC04C908900DE600B9AE0418EDAC04C909B003204BDFA608608000A8B5CF187916DC2CB5CFA40EC00BF017B4B6C001D01138E92085CE98E90085B5A900859F8D330460ADD003C9F0B009A4B588D004A5CEC9D060A5080A0A186904A8ADD103290FC90F602010AD1607D02EA50EC90BF028C9049024A901AC0407D00AA51DF004C903D004A902851DA5B5C901D00BA9FF8D9004A5CEC9CF900160A002AD1407D00CAD5407D00788AD0407D00188B9ADE385EBA8AE5407AD1407F001E8A5CEDD62DC903520E9E3F03020A1DFB04FA49F1027A404C0049021208FDFB010AC4E07F013AC8407D00E20EDBC4CF6DCC926F004A90285FFA901859FA4EBA5CEC9CFB06020E8E320A1DFB0144820E8E38500688501D00CA500F04920A1DF90034C05DE209ADFB03CA49F3038C9C5D0034C0EDE20BDDEF02CAC0E07D023A404C0059007A54585004C4BDF20C4DEA9F025CE85CE20E8DEA900859F8D33048D8404A900851DA4EBC8C8A9028500C884EBA5CEC9209016C9E4B02820ECE3F00DC91CF009C96BF005209ADF9017A4EBC8A5CEC908900DC9D0B00920ECE3D005C600D0CB6020BDDEF061209ADF90034C2EDE20A1DFB05720DDDE9008AD0E07D04A4CFFDDA41DC000D03EA43388D039C96CF004C91FD031ADC403D004A01084FF09208DC403A586290FF00EA000AD1A07F001C8B903DE8DDE06A50EC907F00CC908D008A902850E60204BDF60A034201CDEEE48074CFEBBA9008D7207A9028D7007A9188557A402A90091064C4D8AF907FF001822506890A404C0069004C00A900160C924F004C925D039A50EC905F041A9018533EE2307A50EC904F01FA933201697A98085FC4A8D1307A204A5CE8D0F07DD29DEB003CAD0F88E0F01A904850E4C88DEC926D00AA5CEC920B004A901850EA903851DA90085578D0507A58638ED1C07C910B004A9028533A433A5060A0A0A0A187924DE8586A506D009AD1B07187926DE856D60C95FF002C9606020DDDE9013A9708D0907A9F98DDB06A9038D86074A8D0E0760C967F005C96818D0013860A50B2904F05CA500C911D056A501C910D050A9308DDE06A903850EA91085FFA9208DC403ADD606F03929030A0AAAA586C9609006E8C9A09001E8BCF287888C5F07BEB49CBDBC9C8D5007A98085FCA9008D51078D60078D5C078D5207EE5D07EE570760A900A457A600CAD00AE8C0003028A9FF4C66DFA202C001101DA901A0108C8507A0008457C90010018884001865868586A56D6500856D8A49FF2D90048D900460106188C420B0DFDD8BDF60246D8AC620B0DFDD96DF60C9C2F006C9C3F0021860A90185FE60A829C00A2A2AAA986001010202020510F0B51E2920D0F1205BE190ECB416C012D006B5CFC92590E0C00ED0034C63E1C005D0034C85E1C012F008C02EF004C007B07420AEE1D0034CE2E020B5E1F0F8C923D064A402A9009106B516C915B00CC906D003208EE1A9012011DAC9099010C911B00CC90A9004C90D900429019516B51E29F00902951ED6CFD6CFB516C907F007A9FDAC4E07D002A9FF95A0A0012043E11001C8B516C933F006C908F002944688B9BFDF955860A50438E908C905B072B51E2940D057B51E0A90034CFEE0B51EF0F9C905F01FC903B01AB51EC902D015A910B416C012D002A9009D9607A903951E204FE160B516C906F022C912D00EA9019546A9089558A5092907F010A0012043E11001C898D546D0032024E1204FE1B51E2980D005A900951E60B51E29BF951E60B516C903D004B51EF038B51EA80A9007B51E09404CFCE0B9B9DF951EB5CFC920901FA016A90285EBA5EBD546D00CA9012088E3F00520B5E1D008C6EBC8C01890E760E005F009B51E0A9004A90285FFB516C905D009A9008500A0FA4C37CA4C36DBB58738E5868500B56EE56D602063C3B5CF29F0090895CF60B5CF18693EC94460205BE1901AB5A0186902C903901120AEE1F00C20B5E1F007204FE1A9FD95A04CFEE020AEE1F01DC923D0082095D7A9FC95A060BD8A07D00CB51E2988951E204FE14CFEE0B51E0901951E60A900A0154C88E3C926F00EC9C2F00AC9C3F006C95FF002C96060B5D5C9189021209CE3F01C20B5E1F017B5A63018B53AD014A9FD95A6A901953AB5D529F895D560A900953A60A9809524A90285FF6002080E2003140D2002140E2002090E15000018060000200D0000300D0000080806040A08030E0D140002101504040C1C8A186907AAA002D0078A186909AAA006209CE24CDEE2A0488400A0444C52E2A0088400A004B58738ED1C078501B56EED1A0730060501F002A400982DD1039DD803D0194C7CE2E820F6F1CAC9FEB00D8A186901AAA001209CE24CDEE28A0A0AA8A9FF99B00499B10499B20499B304608600B9B8038502B9AD0385018A0A0A48A8BD99040A0AAAA501187DFDE199AC04A501187DFFE199AE04E8C8A502187DFDE199AC04A502187DFFE199AE0468A8A60060AD1C071869808502AD1A0769008501B586C502B56DE5019015B9AE04300DA9FFBEAC04300399AC0499AE04A60860B9AC041011C9A0900DA900BEAE04100399AE0499AC04A60860A2008406A9018507B9AC04DDAC04B02ADDAE049012F042B9AE04D9AC04903ADDAC04B035A40660BDAE04DDAC04902AB9AE04DDAC04B022A40660DDAC04F01ADDAE049015F013D9AE04900AF008B9AE04DDAC04B00418A40660E8C8C60710A938A40660488A186901AA684CA5E38A18690DAAA01B4CA3E3A01A8A186907AAA90020F0E3A608C9006000070E08030C02020D0D08030C02020D0D08030C02020D0D0800100414040404202008180818022020081808181220201818181818141406060810C8A9002CA901A200488404B9B0E31875868505B56D690029014A05056A4A4A4A20E19BA404B5CE1879CCE329F038E9208502A8B1068503A40468D005B5CE4C2BE4B586290F8504A50360FF00308400ADB903187933E4BE9A03BCE506840220AEE4ADAE03990302990B02991302186906990702990F02991702A921990202990A029912020940990602990E02991602A205A9E1990102C8C8C8C8CA10F4A402A500D005A9E0990102A200AD9D0338F90002C9649005A9F8990002C8C8C8C8E8E006D0E7A40060A206990002186908C8C8C8C8CAD0F3A402600400040000040004000800080800080080828183818380820303C3C3BCF306AD4707D008B52A297FC901F004A200F007A5094A4A2903AAADBE03187DC4E4990002187DCCE4990402ADB303187DC0E4990302187DC8E4990702BDD0E4990102BDD4E4990502BDD8E4990202990602A608ADD60329FCF009A900952AA9F820C1E560F950F750FAFBF8FBF6FBBCE506ADAE03990302186908990702990B0218690C8505B5CF20C1E56908990802AD0D018502A90185038504990202990602990A02A97E990102990902A97F990502AD0F07F0159818690CA8AD0F010AAABD41E58500BD42E520B2EBA608BCE506ADD103290EF014A9F8991402991002990C0299080299040299000260BCE5068402C8C8C8ADAE0320AEE4A608B5CF20BBE5AC4E07C003F005ACCC06F002A9F8BCE506991002991402A95BAE4307F002A975A608C820B5E5A902C820B5E5E820F6F1CABCE5060A489005A9F8990002680A489005A9F8990402680A489005A9F8990802680A489005A9F8990C02680A489005A9F8991002680A9005A9F8991402ADD1030A900320B3E560A5094AB002D6DBB5DB20C1E5ADB303990302186908990702A902990202990602A9F7990102A9FB9905024CBDE660616263BCF306B52AC902B0C6B5DB990002186908990402ADB303990302990702A5094A2903AABD82E6C820C1E588A902990202A982990602A6086076777879D6D6D9D98D8DE4E47677787902010201ACEA06ADB9031869088502ADAE038505A639BDCEE60DCA0385048A480A0AAAA90185078503BDBEE68500BDBFE620B2EBC60710F1ACEA0668F02FC903F02B8500A5094A29030DCA03990202990602A600CAF006990A02990E02B906020940990602B90E020940990E024C64EBFCFCAAABACADFCFCAEAFB0B1FCA5A6A7A8A9FCA0A1A2A3A469A56AA7A8A96BA06CA2A3A4FCFC96979899FCFC9A9B9C9DFCFC8F8E8E8FFCFC95949495FCFCDCDCDFDFDCDCDDDDDEDEFCFCB2B3B4B5FCFCB6B3B7B5FCFC70717273FCFC6E6E6F6FFCFC6D6D6F6FFCFC6F6F6E6EFCFC6F6F6D6DFCFCF4F4F5F5FCFCF4F4F5F5FCFCF5F5F4F4FCFCF5F5F4F4FCFCFCFCEFEFB9B8BBBABCBCFCFCBDBDBCBC7A7BDADBD8D8CDCDCECECFCF7D7CD18CD3D27D7C89888B8AD5D4E3E2D3D2D5D4E3E28B8AE5E5E6E6EBEBECECEDEDEEEEFCFCD0D0D7D7BFBEC1C0C2FCC4C3C6C5C8C7BFBECAC9C2FCC4C3C6C5CCCBFCFCE8E7EAE9F2F2F3F3F2F2F1F1F1F1FCFCF0F0FCFCFCFC0C0C000C0CA8543CEA184848CCC01818189024FF489CD2D8F0F6FC01020302010103030301010202210102010102FF02020101020202081818191A1918B5CF8502ADAE038505BCE50684EBA9008D0901B5468503BDC5038504B516C90DD00AB4583006BC8A07F00160B51E85ED291FA8B516C935D008A000A9018503A915C933D013C602A903BC8A07F00209208504A00084EDA908C932D008A003AE0E07BD78E885EF84ECA608C90CD007B5A03003EE0901AD6A03F009A016C901F001C884EFA4EFC006D01DB51EC9029004A20486EC29200D4707D00CA5092908D006A50349038503B95BE805048504B940E8AAA4ECAD6A03F030C901D013AD63031002A2DEA5ED2920F0038E09014C4BEAAD63032901F002A2E4A5ED2920F0EEA50238E91085024C46E9E024D011C005D00AA230A9028503A90585EC4CCAE9E090D012A5ED2920D009AD8F07C910B002A2964C37EAA5EFC904B010C002900CA25AA4EFC002D004A27EE602A5ECC904D01EA272E602A4EFC002F004A266E602C006D00CA254A5ED2920D004A28AC602A408A5EFC905D00CA5EDF0242908F05DA2B4D01CE048F018B99607C905B04EE03CD00DC901F046E602E602E6024C29EAA5EFC906F037C908F033C90CF02FC918B02BA000C915D010C8AD5F07C907B01DA2A2A90385ECD015A5093976E8D00EA5ED29A00D4707D0058A186906AAA5ED2920F00EA5EFC9049008A0018C09018884ECA4EB20AAEB20AAEB20AAEBA608BCE506A5EFC908D0034C64EBAD0901F03DB902020980C8C820B5E5888898AAA5EFC905F00DC911F009C915B0058A186908AABD010248BD050248B911029D0102B915029D05026899150268991102AD6A03D0B6A5EFA6ECC905D0034C64EBC907F01DC90DF019C90CF015C912D004E005D048C915D005A942991602E002903BAD6A03D036B9020229A3990202990A029912020940E005D0020980990602990E02991602E004D013B90A020980990A029912020940990E02991602A5EFC911D036AD0901D021B912022981991202B916020941991602AE8F07E010B030990E022981990A029026B902022981990202B906020941990602A5EFC9189010A982990A029912020940990E02991602A608ADD1034A4A4A489005A90420C1EB684A489005A90020C1EB684A4A489005A91020B7EB684A489005A90820B7EB684A901220B7EBB516C90CF009B5B6C902D0032098C960BD3EE78500BD3FE785014C82F2187DE506A8A9F84CC1E5187DE506A8204AEC9910026085858686ADBC038502ADB1038505A90385044A8503BCEC06A200BDCDEB8500BDCEEB20B2EBE004D0F1A608BCEC06AD4E07C901F008A986990102990502BDE803C9C4D024A987C820BBE588A903AE4E07CAF0014AA60899020209409906020980990E022983990A02ADD403482904F008A9F8990402990C02682908F008A9F899000299080260A9028500A975A40EC005F006A9038500A984BCEC06C820BBE5A5090A0A0A0A29C00500C820BBE58888ADBC0320C1E5ADB103990302BDF10338ED1C07850038EDB10365006906990702ADBD03990802990C02ADB203990B02A50038EDB20365006906990F02ADD4032046ECADD4030A9005A9F820C1E5A5001010B90302D907029008A9F8990402990C0260BCF106ADBA03990002ADAF03990302A5094A4A4829014964990102684A4AA902900209C099020260686766BCEC06B524F6244A2907C903B04AAABD06EDC820BBE588A608ADBA0338E904990002990802186908990402990C02ADAF0338E904990302990702186908990B02990F02A902990202A982990602A942990A02A9C2990E0260A900952460BCE506A95BC820B5E5C8A90220B5E58888ADAE03990302990F02186908990702991302186908990B02991702B5CFAA48E020B002A9F820BEE568186980AAE020B002A9F8990C02991002991402ADD103482908F008A9F8990002990C0268482904F008A9F8990402991002682902F008A9F8990802991402A60860A4B588D020ADD3032908D019BCEE06ADB003990302ADBB03990002A974990102A902990202602028C818004050588088B87860A0B0B8000102030405060708090A0B0C0D0E0F101112131415161718191A1B1C1D1E1F2021222324252627080928292A2B2C2D08090A0B0C302C2D08090A0B2E2F2C2D080928292A2B5C5D08090A0B0C0D5E5FFCFC080958595A5A080928292A2B0E0FFCFCFCFC32333435FCFCFCFC36373839FCFCFCFC3A373B3CFCFCFCFC3D3E3F40FCFCFCFC32414243FCFCFCFC32334445FCFCFCFC32334447FCFCFCFC32334849FCFCFCFC32339091FCFCFCFC3A379293FCFCFCFC9E9E9F9FFCFCFCFC3A374F4FFCFC00014C4D4E4E00014C4D4A4A4B4B3146AD9E07F005A5094AB040A50EC90BF047AD0B07D03CAC0407F031A51DC900F02B2034EFA5092904D021AAACE406A5334AB004C8C8C8C8AD5407F009B91902CDB5EEF007E8BDE7EE9919026020ECEF4C45EF20B0F04C45EFA00EB907EE8DD506A90420BEEF20E9F0AD1107F025A000AD8107CD11078C1107B0188D1107A007B907EE8DD506A004A557050CF001889820BEEFADD0034A4A4A4A8500A203ADE406186918A8A9F84600900320C1E59838E908A8CA10EF6058010060FF04A205BD9EEF9502CA10F8A2B8A00420DCEFAD260209408D2202608507ADAD038D55078505ADB8038502A5338503ADC4038504AED506ACE406BD17EE8500BD18EE20B2EBC607D0F160A51DC903F052C902F03EC901D011AD0407D051A006AD1407D022A0004C28F0A006AD1407D016A002A557050CF00EAD0007C909901BA5452533D015C82091F0A9008D0D07B907EE60A0042091F04C62F0A0042091F04C68F0A005A59FF0DE2091F04C6DF0A0012091F0AD82070D0D07D00BA50A0AB006AD0D074CD0F0A9034C6FF0A90285002062F048AD8107D015AD0C078D8107AD0D07186901C5009002A9008D0D076860AD5407F00598186908A8600001000100010200010202000200020002000200AC0D07A5092903D00DC8C00A9005A0008C0B078C0D07AD5407D00CB99CF0A00F0A0A0A7907EE609818690AAAA009BD9CF0D002A001B907EE60ACE406A50EC90BF013ADD506C950F01EC9B8F01AC9C0F016C9C8D024B91202293F991202B91602293F0940991602B91A02293F991A02B91E02293F0940991E0260A200A0004C42F1A00120A8F1A0034C42F1A00020A8F1A0022071F1A60860A00220A8F1A0064C42F1A901A0014C65F1A909A0042065F1E8E8A909C88600186500AA2071F1A60860B5CE99B803B58638ED1C0799AD0360A200A0004CC0F1A00020A8F1A0024CC0F1A00120A8F1A0034CC0F1A00220A8F1A0064CC0F107160D8A1879A5F1AA60A901A0014CBAF1A909A0048600186500AA984820D7F10A0A0A0A0500850068A8A50099D003A6086020F6F14A4A4A4A85004C39F27F3F1F0F0703010080C0E0F0F8FCFEFF070F078604A001B91C0738F5868507B91A07F56DBEF3F1C9003010BEF4F1C9011009A9388506A908206DF2BDE3F1A604C900D0038810D06000080C0E0F07030100040004FF008604A001B937F238F5CE8507A901F5B5BE34F2C9003010BE35F2C9011009A9208506A904206DF2BD2BF2A604C900D0038810D1608505A507C506B00C4A4A4A2907C001B0026505AA60A5034A4AA500900C990502A501990102A940D00A990102A501990502A9000504990202990602A502990002990402A505990302186908990702A502186908850298186908A8E8E860FFFFFFFFFFFFAD7007D0048D154060A9FF8D1740A90F8D1540ADC607D006A5FAC901D05DADB207D023A5FAF0668DB2078DC607A9008D154085F185F285F3A90F8D1540A92A8DBB07A944D011ADBB07C924F008C91EF0F1C918D009A964A284A07F2088F3CEBB07D02AA9008D1540ADB207C902D005A9008DC607A9008DB207F012201BF4207CF52067F62094F6A90085FB85FCA90085FF85FE85FD85FAACC007A5F42903F007EEC007C030900698F003CEC0078C1140608C01408E0040602081F3A200A8B901FFF00B9D0240B900FF09089D0340608E04408C054060209FF3A204D0E0A208D0DC9F9B989695949290909A97959392A9408DBB07A962208BF3A299D025A926D002A918A282A0A72088F3A9288DBB07ADBB07C925D006A25FA0F6D008C920D029A248A0BC2081F3D020A905A099D004A90AA093A29E8DBB07A90C2088F3ADBB07C906D005A9BB8D0140D060A4FFF02084F130AA46FFB0AA46FFB0D446FFB02C46FFB04A46FFB07F46FFB0BE46FFB080A5F1F017309A4AB0974AB0C24AB01B4AB03C4AB0674AB0B64AB04860A90E8DBB07A09CA29EA9262088F3ACBB07B9B0F38D0040C006D005A99E8D0240D025A90EA0CBA29F8DBB07A9282088F3D015ACBB07C008D009A9A08D0240A99FD002A9908D0040CEBB07D00EA20086F1A20E8E1540A20F8E154060A92F8DBB07ADBB074AB0104AB00D2902F009A091A29AA9442088F34CA2F4580254564E444C524C483E363E3630284A504A643C323C322C243A643A342C222C221C141404222416042426180426281A04282A1C042A2C1E042C2E20042E3022043032A935A28DD004A906A2988DBD07A07FA94220A6F3ADBD07C930D005A9548D0640D02EA9208DBD07A094A95ED00BADBD07C918D01CA093A918D07FA9368DBD07ADBD074AB00BA8B9D9F4A25DA07F20A6F3CEBD07D00EA20086F2A20D8E1540A20F8E154060A5F22940D065A4FEF02084F2303E46FEB08A46FEB06A46FEB06A46FEB0A046FEB08046FEB0B046FEB03CA5F2F01730274AB0134AB05D4AB05A4AB08D4AB0074AB0994AB026604C2CF54C68F5A9388DBD07A0C4A918D00BADBD07C908D08EA0A4A95AA29FD083A9308DBD07ADBD07A2034AB0D6CAD0FAA8B9D3F4A282A07FD0E4A910D002A9208DBD07A97F8D0540A9008DBE07EEBE07ADBE074AA8CCBD07F00CA99D8D0440B9F8F420A9F3604C6DF5010E0E0D0B060C0F0A09030D080D060CA9208DBF07ADBF074A9012A8BE2BF6B9EAFF8D0C408E0E40A9188D0F40CEBF07D009A9F08D0C40A90085F360A4FDF00A84F346FDB0CA46FDB00BA5F3F0064AB0C44AB00660A9408DBF07ADBF074AA8A20FB9C9FFD0BC4C3AF7A5FCD00CA5FBD02CADB10705F4D0EE608DB107C901D00620A7F42071F5A6F48EC507A0008CC40784F4C940D030A2088EC407D029C904D00320A7F4A0108CC707A0008CB10785F4C901D00EEEC707ACC707C032D00CA011D0E4A00884F7C84A90FCB90CF9A8B90DF985F0B90EF985F5B90FF985F6B910F985F9B911F985F8B912F98DB0078DC107A9018DB4078DB6078DB9078DBA07A90085F78DCA07A90B8D1540A90F8D1540CEB407D05FA4F7E6F7B1F5F004103DD02FADB107C940D005ADC507D01D2904D01CA5F4295FD013A90085F48DB1078D0840A9908D00408D0440604CD4F64CA4F620CBF88DB307A4F7E6F7B1F5A6F2D00E20A9F3F00320D8F88DB507209FF3ADB3078DB407A5F2D01AADB1072991D013ACB507F003CEB50720F4F88D0440A27F8E0540A4F8F05ACEB607D032A4F8E6F8B1F5D00FA9838D0040A9948D01408DCA07D0E920C5F88DB607A4F1D0348A293E208BF3F00320D8F88DB7072081F3A5F1D01FADB1072991D00EACB707F003CEB70720F4F88D0040ADCA07D002A97F8D0140A5F9CEB907D04CA4F9E6F9B1F5F041101320CBF88DB807A91F8D0840A4F9E6F9B1F5F02C20ADF3AEB8078EB907ADB107296ED006A5F4290AF0198AC912B00FADB1072908F004A90FD006A91FD002A9FF8D0840A5F429F3F051CEBA07D04CACB007EEB007B1F5D008ADC1078DB007D0EE20C5F88DBA078A293EF024C930F018C920F00C2910F018A91CA203A018D012A91CA20CA018D00AA91CA203A058D002A9108D0C408E0E408C0F4060AA6A8A2A2A2A29071865F06DC407A8B966FF60ADB1072908F004A904D00CA5F4297DF004A908D002A928A282A07F60ADB1072908F004B996FF60A5F4297DF004B99AFF60B9A2FF60A5595464593C314B695E464F368D364B8D69696F756F7B6F756F7B8187818D69699399939F9399939F8187818D9399939F0872FC271820B8F92E1A4020B0FC3D2120C4FC3F1D1811FD0000081CFA0000A4FB936210C8FE24141845FC1E140852FDA070680851FE4C241801FA2D1CB81849FA2012701875FA1B1044189DFA110A1C18C2FA2D105818DBFA140D3F18F9FA150D211825FB18107A184BFB190F541874FB1E122B1872FB1E0F2D842C2C2C82042C04852C842C2C2A2A2A82042A04852A842A2A001F1F1F981F1F989E981F1D1D1D941D1D949C941D861885263084042630861485222C8404222C21D0C4D031D0C4D000852C221C84262A822826048722343A82400436843A34822C30852A005D554D15199615D5E3EB2DA62B279C9E5985221C14841E2282201E04871C2C348236043034042C04262A85228404823A38363204340424262C04262C300005B4B2B02BAC849C9EA284949C9E851422842C851E822C842C1E8404823A38363204340464046486640005B4B2B02BAC8437B6B64585141C8222842C4E824E844E22840485328530862C040005A4059E059D8584148524282C822284221421D0C4D031D0C4D000822C842C2C822C3004342C0426862200A42525A429A21D9C95822C2C042C042C308534040400A42525A4A86304850E1A8424852214840C8234843434822C8434863A0400A02121A0212B05A3821884181882181804863A2231903190317131909090008234842C852284248226360436862600AC275D1D9E2DAC9F8514822084222C1E1E822C2C1E04872A4040403A3682342C0426862200E3F7F7F7F5F1AC279E9D8518821E84222A2222822C2C22048604822A36043687363430862C040000686A6C45A231B0F1EDEBA21D9C958604852282228722262A842C22861451903111008022282226222422262228222A2228222622282226222422262228222A222822262026202420262028202620282026202420262024202620282026202820262024283028322830282E2830282E282C282E283028322830282E2830282E282C282E0004706E6C6E7072706E706E6C6E7072706E6E6C6E706E706E6C6E6C6E706E706E6C76787674767472747678767476747274841A831820841E831C28261C1A1C822C0404220404841C87262A26842428248022009C0594050D9F1E9C989D822204041C04048414861E80168014811C30043030041E3204323204203404343404360484360046A464A448A666A64AA868A86A442B812A42044242042C64046464042E4604464604220484228704060C141C22862C228704600E141A24862C2487040810181E28863030806400CDD5DDE3EDF5BBB5CFD5DBE5EDF3BDB3D1D9DFE9F1F7BFFFFFFF3400860487141C228634842C04040487141A248632842C04860487181E28863687303030802C82142C62261028800482142C62261028800482081E5E18601A800482081E5E18601A8604831A181684141A180E0C168314201E1C282687241A1210620E8004040082181C20222628812A2A2A042A04832A822286343234810422262A2C3086348332823684348504812286302E30810422262A2C2E863083228236843485048122863A3A3A823A81408204813A863636368236813A82048136863482262A368134348534812A862C008490B0845050B000989694929496585858445C449FA3A1A385A3E0A623C49F9D9F859FD2A623C4B5B1AF85B1AFAD85959EA2AA6A6A6B5E9D840404822286228214222C12222A14222C1C222C14222C12222A14222C1C222C18222A16202818222A12222A18222A12222A14222C0C222C14223412223010222E1622341826361626361426361222365C22340C2222811E1E851E81128614812C221C2C221C852C04812E241E2E241E852E0481322822322822853287363636843A005C544C5C544C5C1C1C5C5C5C5C5E564E5E564E5E1E1E5E5E5E5E625A50625A5062222262E7E7E72B8614811480141481141414148616811680161681161616168128221A28221A288028288128872C2C2C84308304840C8362108412831C221E2226181E041C00E3E1E31DDEE023EC7574F0F4F6EA312D83121404181A1C1426221E1C181E220C14FFFFFF0088002F000002A60280025C023A021A01DF01C401AB0193017C016701530140012E011D010D00FE00EF00E200D500C900BE00B300A900A00097008E00860077007E007100540064005F0059005000470043003B0035002A00230475035702F902CF01FC006A050A1428501E3C02040810204018300C03060C183012240836030906121B240C240206040C1218081201030206090C0498999A9B90949495959697989091929293939394949494949495959595959596969696969696969696969696969696969595949315161617171819191A1A1C1D1D1E1E1F1F1F1F1E1D1C1E1F1F1E1D1C1A18161415161617171819191A1A1C1D1D1E1E1F82800080F0FF030F1F1F1C242666000000001F3F3F7FE0C080FC80C0002000206000F0FCFEFE607018070F1F3F7F7F7F1F07001E3F7FFC7C0000E0F0F8F8FCFCF8C0C2672F377F7FFFFF07070F0F7F7EFCF0F8F8F070FDFEB4F8F8F9FBFF37365C000001031F1F3FFFFFFC7070380824E3F0F8707038FFFFFF1F000000001F1F1F1F00000000000001070F0F0E120000000000000F1F0000F0E0C0FE4060000000103000F8FE13333018040F1F1F1F3F3F1F0708171700107E3E0000C0E0FFFFFEFEFCE040A03F3F3F1F1F1F1F1F3727230301000000F0F0F0F8F8F8F8F8CCFFFFFFFF700008FFFFFFFEF0C08000F0F0F0F0F0C08000FCFCF87878787E7E1060800078787E7E00030F1F1F1C242600000000001F3F3F00E0C080FC80C0000000206000F0FCFE666030180F1F3F3F7F7F3F1F00162F2F20FC7C0000E0E0F0FEFCFCF8C06020303F3F3F3F3F3F3F1F2F2F2F0F07030000F09000080C1CFCF810F0F0F0F0E0C0E00F0F0707070F0F0301030104070F0F03F8F0E0F0B080E0E0F8F0E070B080E0E0033F7F190909285C0030707FFFFFF7F3F8E0E0FC2630801000181000F8F8FEFF3E1E3F383030003AE70F0F1F1F1F0F07781E80FE7E7E7F7FFFFEFCC68EEEFFFF3C3F1F0F073F21200300000E073F3F3FFFFFFFFEFEFEFC70FF7F3F0EC0C0E0E00F9FCFFF7F3F1E0E0080C8FE7F3F1E0E20C0808000000000E0000000000000000000030F1F1F1C240000000000001F3F0004E6E0FFFF8F830E1F1F1F1F03FFFF26266078180F7FFF3F3F7F7F1F007EFF0121FE7A06FEFCFCFFFFFEFEFEDE5C6CFFCF8707070F1F1FFFFFFEFCF8B06000F8F8F0B8F8F9FBFF283018400001030F1FFFFFFFFFFEC08010ECE3E0E0E0C080FFFFFF3F000000000F0F0F0F0000000013333018040F1F1F1F3F3F1F0709131700107E30E0F0F0E0FFFFFEFFFEFCF8E01F1F0F0F0F1F1F1F1717030000000000F0F0F8F8B8F8F8F8D0901808400000003FFFFFFFF6C6840030F0F0F1F6C68400F0E080000000000000000000000000001F1F3F3F1F0F0F1F1F1F3F3E7C78F0E0F0F0F8F8B8F8F8F0B090180840000000E0F0F0F0F0F0F8F0C0E0FCFEFF7F03001F1F1F3F3E3C3818000010383E3C3818000307070A0B0C00000000070F0F0F0300E0FC2020103C00000000F0FCFEFCF80707071F1F3E2101070F1B1810302101E0E0E0F0F0E0C0E0A8FCF8000000C0E0070F0E141618003F00000F1F1F1F073CC0F84040207800C00000E0F8FCF8F0C03F0E0F1F3F7C7038FCEDC00000607038F0F8E4FCFC7C00007E1E040C0C0C0000070F0E141618000F00000F1F1F1F070D1F1F1F1C0C0707071E1C1E0F07000707E060F070E0E0F0806090008000E0F080071F3F1213081F3100103F7F7F3F030FC0F040003018C0F80000E0F8FCF8B03831391F1F0F5F7E3C1F07000E0F537C3CF8F8F0E0E0C00000F8F8F0000080000000E0FC2727113E04070703F7FFFFFEFC3F7F3F0F1F3F7F4F3E7FFFE250387040F8F9F9B7FFFFE000E871014B0303000007070F3F3F3F26040503013030302604F0F0F0E0C0000000FEFCE0000000000007070F1F3F0F1C1805030110300C1C18E0E0E0E0C0800000C0E0F07818080000070F1F0F3F0F1C18070F3E7C300C1C18E0E0E040C080000060606080000000007FFFFFFB0F0F0F1F73F3F0F4F0F070603F7E7C7C3C3CFCFC000000003C3CFCFC607018080F1F3F7F7F7F1F070B1B3B7BFC7C0020F0F8FCFEFCFCF8E0D0D8DCDE0B0F1F1E3C3C3C7CC4E0E040003C3C7C1F3F0D070F0E1C3C1D3C3A3830001C3C0000000000000000225555555555772200071FFF071F0F0600000000000000003FFFFFFFFFFFFB760000CF077F00000020F8FFC3FDFEF04000003CFCFEE0000040E0404041414F4740E0403F3E3E3038000000000000E0C0000000F8F8F8183843464440404040403C393B3F0000000080C04000000000007838B8F8000000003130387C7FFFFFFB3F3F0F7777F7F7F7107E3E001EFEFFFFFFFEFEFEFAFAF3E7FFFFE3C387483CFCF0F8FC7C78383CFC00FFC38383FFFFFFFF00C38181C3FF001F1F0F07010000000000000000000000F0FBFFFFFE3E0C04000B1F1F1E3E0C041F1F0F0F070000000000000000000000FBFFFFFFFF000000030F0F0F0F00000000183C7E6EDFDFDF00183C7E76FBFBFB0018183C3C3C3C1C001010202020202000080808080808000008080808080808000808040404040400101038383838383C7E77FB9F5F8E2000183C0E0E0400005C2E8F3F7B777E3C000004061E3C1800134F3FBF3F7AF8F80000010A170F2F1F0008050F2F1D1C3C0000000005070F0700000000020B070F000000000000010300000000000804040060F0F87C3E7E7F02020205717F7F7F3F5F7F3E0E0A512000000000000000040000000000000E1F02020001133F7F7F3F7F7FFEECCA51200040607073270F1F004063777C38F8E40000000003070F1F000003070C18F8E47F7F3F3F1F1F0F07034428100804030403070F1F3F7777F503070F1F277B78FBC0E0F0F8FCEEEEAFC0E0F0F8E4DE1EDFF1FF780000181C0EFFFF7F0F0F0703008FFF1E000C3E7E7CFFFFFEF0F0C0800000000000000000000000182424180000000241416133063C3C7EFFFFFFFF7E3C03070F1F3F7F7FFF03070F1F3F6341C1C0E0F0F8FCFEFEFFC08000008CFEFEF3FFFFFF7800000000C1E3FF470F0F0F07FFFFFF1E00202040F1F9FFE2F0F0F0E0161F3F7F3D1D3F1F161F0000050D3F1F8080C0E0F0F0F0F88080000000A0A0E03CFAB172F2DBDF5F00044E8C0C7FFFFF000000010101061E00000000000001010000000000000000FF7F3F1F0F070301007CD692BAEEFE38FF83296D451101C700153F625FFF9F7D0808021F22020200000000000000000008080808080808082F1E2F2F2F150D0E101E1050100800000000000000000000000000FE000000001C3E7FFFFFFE7C381C2A77EEDDAA742800FFFFFFFFFFFFFFFFFEFE00EFEFEF00FFFFFFFFFFFFFFFFFEFEFE00EFEFEF007FFFFFFFFFFFFFFF007F5F7F7F7F7F7F684EE0E0E0F0F8FCB89E80C0E0F0F87C3F5C393BBBF9FCFE0023574F5727C321C0F0F0F0F0E0C00000307070F0E0C000FEFC610FFFFEF0E0130F1EF0FCF8F0E06E40E0E0E0E0E0C0BE9080C0C080000001010303077F7F3F01010303077F7D3D06073F3C197B7F3F06043023066460003F7F7F1F3F3F0706006060002030040603070F0F0F0F07030001010000000000F8F8F8A0E1FFFFFFFEFFFF40010303030F0F0F1F1F1F0F070101000000000000E0F8F8F8FFFEF0C0E0FEFF7F03020000010F0F1F3933377F010D0800362C08607F3F3F3F1F0F0F016000203000080D0100000303476777770101034367777B78000000008898F8F000008084CCDCBC3C7E7FFF1F07301C0C330707E3383F1C0C7E38F6EDDF38706098C7C89230F870600000000303476777000101034367777B00000000008898F80000008084CCDCBC777E7FFF1F0770F078330707E3387FF0F07E38F6EDDF383C3C98C7C89230F83C03070A1A1C1E0B0800107F7F7F1F0F0F1C3F3F3D3F1F00000333393A381800000000044C4E4E466F10383C7476767E7D001F3F3F4F5F7F7F0000110A342A51207F67A3B0D8DEDCC87F676370383E7CB87F7F7F1F47707039510A04EA797F7039E8E8E0C01070E0C058381030F0F0E0C0000000206666666200081C3C7A7A7A7E00001F3F7F4F5F7F000000110A342A51777F3FB7B3DBDAD87F7D3F37333B3A787F7F7F7F1F0770F020510A04EA397FF0CCE8E8E0C0187C3EBC58381030F8FC3E030F1F3F3B3F7F7F000000060E0C000080F0F8FCFEFEFFFE0000000000000F187F7F7F7FFF0F030000000000F83E3B18FEFBFFFFF6E0C000101410103878F83000030F1F3F3B3F7F00000000060E0C0000C0F0F8FCFEFEFF000000000000000F7F7F7F7F7FFF0F030000000000F87EF3FEFEFBFFFFF6E0C01810141010387CDE0001010101000008000D1E1E1E1F0F0778F0F8E4C0CACAC078F0001A3F35353F0F1F9FFFFF7F7420000080E0E0707321E4FFFEFC9C1E00001A070C1878FEFCF0000103030703010000010200387C7E3F005F7F7F3F3F14003F40606020301301C0E0F030383C3CFCC0E030D0D0D0D000070F1F222025251F070F021D1F1A1A02FEFE7E3A02014141387CFCFCFCFEBEBE1F3F7E5C408082821C3E3F3F3F7F7D7D8280A0444340211E7D7F5F3B3C3F1E001C3F3E3C408082821C3E3F1F3F7F7D7D00008080929DC7EF0000006062653F1F0023333F3F7F7F7F703C3C1800000207FEF8A00000008080CF7A5A100000C0807E7F7D3F1E8F8F19858486C6E77373E1E00E73F3F9F9F870804E77F3FBF9FA780E66E2F6FFFF1F9811397D390000E0E7000000040F0F1F070000070716100038F3E7EEECCDCFCFDFCF1F171033303020273F3F783C1F1F73383040C70766E06C9F3E7CFCF8F8C04060C080049EFFF0F87F7E7801071F3C7C240107FEFF7F3F7FFCF8A0FEFCF08000CF7A0AFEFC0000007E7F7F3F1F8F8F18858683C3E17070E09F3E7CF8F83C18F860C0800098FCFEFF7F7F78010713F103240007FEFF7FFF0300001C1D1BC3E3E1030F2362643C1C1EE0CD1D4FEEFF3F3F1F3D6D4FEEF320033F3F000070B8FCFC07071F3F0F470300070F1F3F3E7C7878000003070F0F1F1F3F5C393BBFFFFEFE0023574F572FDF21C0C08080808000000000000080800000FEFC610F7F3F1F1E230F1EF01C3F1F1EF078E4C8CCBEBE3E0080183034FEFEFE000100070707071F000001040606070700000F3F3F0F00000F3F7FF8F87F3F0F787C7E7F3F3F1B091F1F1F0B010100000C000000077F7C00031F3F3F780003FF01E171793D3D1F0300000000000000003F3F1F1B36307F3F23271F070F1F7F3FF8F8F8B818D8D8B8E0808040E0E0E0C0010204040808101003070F1F3F7FFF1F000F130D0D130C201F100C12122C3F3F002400240004000037363636161612020F41008800440000107EFFFFF6763A1A387CFEFE3B030303000038040000000003337B7FFFFB03030000003840000000DCC0E0E0E0E0E0C0FCA08080000000003F5F3F3FBBF8FEFE0727574F5727C1211F0F0F1F1F1E38301D0F0F1F1F1E38300020606070F0F8F8000038104C188624F8FCFC7E7E3E1F0700420A401002080200C070B8F4F2F57B00008040080C0A8400DF10FFDFFFFFF90000CF202020262E1F1F3EFCF8F0C000E0E0C00000000000F8FCFEFFFFDFDF002F23212020000000C1F1797D3D3F1F03C1B1596D353B1F0302060E0E1E1E3E3E00020008020028003E3E3E3E1E1E0E020410021004000A00C1F1797D3D3F1F03C1B1596D353B1F037C0000FFC37F1F03000F1FFFFC631F03FFFF7C00007CFFFF0000FEC6C6FE0000FFFF00040C183000000006060C187060FFFF0004040408080000060604040808081010000010100808103030303010087F3F3F3E1F0F03000000010301000000030FFF7F7F7F7F7F030EF80000000000000000000000000022652525252577720000000000000000629515254585F7F20000000000000000A2A5A5A5F5F527220000000000000000F28585E51515F7E2000000000000000062955565B59597620000000000000000205050505050702000000000000000000000000000000000000000000000000066E666666667F30000000000000000005E5959595ED8980000000000007C38000000000000040800384CC6C6C664380000000000000000001838181818187E0000000000000000007CC60E3C78E0FE0000000000000000007E0C183C06C67C0000000000000000001C3C6CCCFE0C0C000000000000000000FCC0FC0606C67C0000000000000000003C60C0FCC6C67C000000000000000000FEC60C183030300000000000000000007CC6C67CC6C67C0000000000000000007CC6C67E060C78000000000000000000386CC6C6FEC6C6000000000000000000FCC6C6FCC6C6FC0000000000000000003C66C0C0C0663C000000000000000000F8CCC6C6C6CCF8000000000000000000FEC0C0FCC0C0FE000000000000000000FEC0C0FCC0C0C00000000000000000003E60C0CEC6663E000000000000000000C6C6C6FEC6C6C60000000000000000007E18181818187E0000000000000000001E060606C6C67C000000000000000000C6CCD8F0F8DCCE0000000000000000006060606060607E000000000000000000C6EEFEFED6C6C6000000000000000000C6E6F6FEDECEC60000000000000000007CC6C6C6C6C67C000000000000000000FCC6C6C6FCC0C00000000000000000007CC6C6C6DECC7A000000000000000000FCC6C6CEF8DCCE00000000000000000078CCC07C06C67C0000000000000000007E181818181818000000000000000000C6C6C6C6C6C67C000000000000000000C6C6C6EE7C3810000000000000000000C6C6D6FEFEEEC6000000000000000000C6EE7C387CEEC60000000000000000006666663C181818000000000000000000FE0E1C3870E0FE00000000000000000000000000000000000000000000000000FFFFFFFFFFFFFFFF00000000000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0000007E7E000000000000000000000000004428102844000000000000000000FFFFFFFFFFFFFFFF7F7F7F7F7F7F7F7F183C3C3C181800180000000000000000FF7F7F7F7FFFE3C1FF80808080001C3E808080C1E3FFFFFF7F7F7F3E1C0000FF387C7C7C7C7C3800080404040404080003060C0C0808040303050B0B0F0F070301020408102040800103070F1F3F7FFF00000000000738C00000000000073FFF0000000000E01C030000000000E0FCFF804020100804020180C0E0F0F8FCFEFF040E0E0E6E646060FFFFFFFFFFFFFFFF070F1F1F7FFFFF7F070810006080804003071F3F3F3F79F70304182020204688C0E0F0F4FEBFDFFFC02010140A41210190B8F8FAFFFFFFFE90A8480A050101023B1D0E0F070000002412090807000000FFBF1CC0F3FF7E1C0040E33F0C81621CBF7F3D83C7FFFF3C4080C27C3800C33CFCFEFFFEFEF860000402010006986000C0201010101020C0C0E0F0F0F0F0E0C0000000003F7FE0C00000000000001C3E889C8880808080807F7F7F3E1C000000FEFEFEFEFEFEFEFEFFFFFFFFFFFFFFFF081424C40340A12600081838FCBF5ED9FFFFFFFF7F7F7F7F8181818181818181FFFFFFFFFFFFFFFF01010101010101017F8080989C8C8080007F7F67677F7F7FFF0101FF101010FF00FFFFFFFFFFFFFF80808080808080807F7F7F7F7F7F7F7F010101FF101010FFFFFFFFFFFFFFFFFFFF0000000000000000FFFFFFFFFFFFFFFE0101191D0D010100FFFFE7E7FFFFFF0101010101010101FFFFFFFFFFFFFFFF3F7F7FFFFFFFFFFF3F6040C080808080FFFFFFFFFFFF7E3C808080808081423CFFFFFFFFFFFFFFFFFF00000000000000FFFFFFFFFFFFFE7C000000000001827CFFFFFFFFFFFFFE7C00000000000183FFF8FCFEFEFFFFFFFFF804020201010101FFFFFFFFFFFF7E3C010101010181423C0008080810101000FFFFFFFFFFFFFFFF007F7F787373737F7F80A0878F8E8E8600FFFF3F9F9F9F1FFE0105C1E17171F17E7E7F7E7E7F7FFF8181808181A080FF7F7FFF7F7FFFFFFFF1C1C181C1C501FF7F80A080808080807FFFFFFFFFFFFFFFFE01050101010101FEFFFFFFFFFFFFFF8080808080A0807FFFFFFFFFFFFFFF7F01010101010501FEFFFFFFFFFFFFFFFE00000000FCFE0703000000000000387C1139110101010101FEFEFE7C38000000EF2828282828EF0020E7E7E7E7E7EF00FE8282828282FE00027E7E7E7E7EFE00808080989C8C807F7F7F7F67677F7F7FFFFF83F3F3F3F3F3FF80FC8C8C8C8C8CFFFFF0F6F6F6F6F6FF000F0909090909FFFF000000000000FF00FFFFFFFFFFFFFFFF01572F572F57FF01FFA9D1A9D1A9F3F3F3F3F3F3FF3F8C8C8C8C8C8CFF3FF6F6F6F6F6F6FFFF090909090909FFFF000000000000FFFFFFFFFFFFFFFFFFFF2F572F572F57FFFCD1A9D1A9D1A9FFFC3C3C3C3C3C3C3C3C2323232323232323FBFBFBFBFBFBFBFB0404040404040404BC5CBC5CBC5CBC5C44A444A444A444A41F204040808080811F3F7F7FFFFFFFFEFF8080C0FFFFFEFEFF7F7F3F00000101FF7F7FFFFF070303FF80800000F8FCFCFF0000000081C3FFFFFFFFFFFF7E3C00F8FCFEFEE3C18181F80402021D3F7F7F83FFFFFFFFFF7F1FFC8080808080601FFCFCFCFCFEFEFFFF03030303010100FF01010101030307FFFEFEFEFEFCFCF8FFFFFFFFFFFFFFFFFF00000000000000FF81C1E3FFFFFFFFFE7F3F1D01010103FEFFFFFFFFFFFBB5CE808080808084CAB1FFFFFFFFFFDFAD73010101010121538D77777777777777770000000077FFFFFF00000000000000FFFFFFFFFFFFFFFFFF7777777700000000FFFFFF7777777777010101191D0D01FEFFFFFFE7E7FFFFFE20787FFEFEFEFEFE0021214141414141049AFAFDFDFDFDFD00808080808080807E382100010001002121010101010101FA8A8480808080808080808080808080020400100040800001010608182020C00B0B3B0BFB0B0B0A0404C4F4F404040590101F101F10109070F0F0FFFFF0F0703F78E7CF58585090C08718B0E7E7EFEFB0FCE2C1C1838F7E6F435D3F3F7F7FFFFE030F917060203103FFF16ECFDFFFFF3F3F1D397BF386FEFDFBFBF7F70F7FFFFFFFFFFFFF8080FFFF80808080FFFF80FEFFFFFFFF0303FFFE03030303FFFF0300FFFFFFFFFF000000FF00000000FFFF3CFCFCFCFCFC040423F30B0B0B07FFFFFFFFFFFF80FFFFFF80808080FF808080FFFFFFFF03FFFFFF03030303FF030303FFFFFFFFFF00FFFF0000000000FF0000FCFCFEFEFE02FEFE0707030303FF0303FF8080808080808080FFFFFFFFFFFFFFFF0303030303030303FFFFFFFFFFFFFF0202020202020404FFFFFFFFFFFFFFFF8080AAD5AAFFFFFFFFFFD5AAD58080FF0303AB57ABFFFFFEFFFF57AB570303FE0055AA55FFFFFF00FFAA55AA0000FF000454AC5CFCFCFC3CFFAF57AB0B0BF3233F3F3F3F000000FFFFFFFFFFFFFFFFFF7E7C7C78000000FFFFFFFFFFFFFFFFFF1F0F0F07000000FFFFFFFFFFFFFFFFFFFEFCFCF8000000FFFFFFFFFFFFFFFFFF00000000FFFF0000000000000000000018181818181818180000000000000000071F3FFF7F7FFFFFFFFFFFFFFFFFFFFFE1F9FDFFFEFEFFFFFFFFFFFFFFFFFFFFF0101010101010FF00E0E0E0E0E0E0E01F101010101010FF000F0F0F0F0F0F0F929292FEFE00000048486C000000FE000A0A3A0AFB0B0B0B0505C5F5F404040490909F909F9090907070707F7F7070700101010101010101000000000000000080808080808080800000000000000000088891D15353733FFFFFFFFFFFFEBECE0000070F0C1B1B1B00000000030404040000E0F0F0F8F8F800006030309898981B1B1B1B1B0F0F070404040404030000F8F8F8F8F8F0F0E09898989898303060F111111F101010FF0FEFEFEFEFEFEFE01F1010F0101010FFE0EFEFEFEFEFEF0F7FBFDFEFF0F0F0F0804020100F0F0F0FF0F0F0F0FFFFFFFF0F0F0F0F1F3F7FFFFFFFFFFF0F0F0F0F0103070FFFFFFFFF0F0F0F0FF7FBFDFEFFFFFFFFFFFFFFFF000000000000181800000000000000001F3F7F7F7FFFFFFF1F20404040808282FFFFFF7F7F7F3F1E8280A0444340211EF8FCFEFEFEFFFFFFF804020202014141FFFFFFFEFEFEFC7841010522C20284787F80808080808080807F7F7F7F7F7F7FDE616161715E7F6161DFDFDFDFFFC1DF8080C0F0BF8F817E7F7FFF3F4F717FFF6161C1C1818183FEDFDFBFBF7F7F7F7F0000030F1F3F7F7F0000030C102040400000C0F0F8FCFEFE0000C03008040202FFFFFFFFFFFFFFFF8080808080808080FFFFFFFFFFFFFFFF01010101010101017F7F7F3F3F1F0F0740404020301C0F07FEFEFEFCFCF8F0F0020202040C38F0F00F0F0F0F0F0F070F08080808080C050AF0F0F0F0F0F0E0F0105050505030A05081C1A3A39D818181004122221C000000E3F7C1C1C1C1F7E3E3143E3E3E3E14E30000070F0C1B1B1BFFFFF8F0F0E0E0E00000E0F0F0F8F8F8FFFF7F3F3F9F9F9F1B1B1B1B1B0F0F07E0E0E0E0E0F3F0F8F8F8F8F8F8F0F0E09F9F9F9F9F3F3F7FE0FFFFFFFFFFFFFF00701F10707F7F7F07FFFFFFFFFFFFFF0003F80003FBFBFBFFFFFFFFFFFEFFEF7C7B767575771767FFDFEFAFAF6FEFE73BFB7BFBFBF3F8F31F1F3F3F7063E7E50F0F1F1F3F3C787AF0F0F8F80CC4E4A6F8F8FCFCFE3E1E5FE9E9E9EFE2E3F0FF767676707D7C7F7F969696F646C60EFE6F6F6F0FBF3FFFFF0000000000007E3C3C7E7EFFFFFF42003C4299A1A199423C00000000000000000F1F1F3F3F7F7F7FF0E0E0C0C0808080F0F8F8FCFCFEFEFE0F070703030101017F7F3F3F3F3F1F1F8080C0C0E0F8FEFFFEFFFFFFFCFCFEFEFF7F1F07030301817F7F7F3F3F3F3F1F808080C0C0E0E0F0FEFEFFFFFFFFFFFE010101030307070F1F0F0F0700000000FFFFFFFFFFFFFFFFFEFCFCF800000000FFFFFFFFFFFFFFFF7E7E7E7E7F7F7F7F8181818181818181FFFFFFFFFFFFFFFE010101030307070FFEFEFEFEFFFFFFFF01010101010101017F7F7F7F7F7F7F7F8181818181818181FFFFFFFFFCFEFE7EFF030303030303FFFFFFFFFF00000000FFFFFFFFFFFFFFFF7F7F7F7F7F7F7F7F8080808080808080FFFFFFFFFFFFFFFE01010103070301017E7E7F7F7F7F7F7F81818181818181813F3F3F3F00000000FFFFFFFFFFFFFFFF7E7C7C7800000000FFFFFFFFFFFFFFFFFEFEFFFF7F7F7F7F81818181818181817F7F3F3F3F3F1F1F8080C0C0E0F8FEFF3FBFFFFFFCFCFEFEFF7F1F07030301817F7F7E7E7F7F7F7F81818181818181817E7E7E7E7F7F7F7F818181818181818181C3C3E7E7FFFFFF7E3C3C18180000000F435B5331190F07F2FEFEFFFFEFF7F8C1C3C684FCFC0E02BFBEBD7B7B07F3FD102022BAE6E1C0C0FFFFFF67599EBFBF20A6542620C6542620E65426210654262085014420865448209A014920A5C94620BAC94A20A60AD0D1D8D8DED1D0DADED120C60AD2D3DBDBDBD9DBDCDBDF20E60AD4D5D4D9DBE2D4DADBE021060AD6D7D6D7E126D6DDE1E1212614D0E8D1D0D1DED1D8D0D126DED1DED1D0D1D0D126214614DB4242DB42DB42DBDB4226DB42DB42DB42DB4226216646DB216C0EDFDBDBDB26DBDFDBDFDBDBE4E526218614DBDBDBDE43DBE0DBDBDB26DBE3DBE0DBDBE6E32621A614DBDBDBDB42DBDBDBD4D926DBD9DBDBD4D9D4D9E721C5165F95959595959595959798789596959597989798957A21ED0ECF01090805241712171D0E170D18224B0D012419150A220E1B24100A160E228B0D022419150A220E1B24100A160E22EC041D18192822F6010023C9565523E20499AAAAAA23EA0499AAAAAA00FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEBD965C0C8C9CACBC9C7C0C3C5C8C9C9D9C3D9D9F5C1CB29CB29CB09CB29CB29ED5F07CB19CB2978A9C22DC03CED47ED572111E11149D3E240C02100E011F9F872ED5F732CED5F10F7D9E2C9C9F3D9E12BE5D9C9C9D9C3D9D3808080C3C3C7838080CDC3C380FF80FF805C80FF80FF805C80FF80FF805C80FF80FF805C400087C080F1807810F080FF80FF805C80FF80FF805C80FF80FF805C80FF80FF805C80F110F0CDC3830000FFFFFFFFFFFFC7C7CFC7C7CFD7CFCFC7C7C73E08ED47C7C7C7EDFFC7C7CFC7C7CFD7CFCFC7C7C73E08ED47C7CFC7E60FED4FFE0AD2F3DF26001100856F006FDAD0D9D9D9D9C3D2D9D9D9C9D9D9C3C2D9D9D9D9CDD9D9C3D9D9D9C314C0C9D9D9D9D9C9F3F690ED4FC9D9D9C3D9D9D9D9C9C3D9D9C7D7FBC7D7C7C7D7FB3E3AED47C7D7FBC7D7C7D7C7D7C7D7FB3EDFED47C7D7C7D7C7C7C7C7D7FB3EEDED47C7D7FB3E3BED47C7D7C7C7C7D7C7D7C7C7D7FB3E1FED47C7D7C7C7C7D7C7D7C7D7C7C7D7D7CFC7C7C7D7D7FB3EC7ED47C7D7D7C7D7D7C7C7C7D7D7FB3EC7ED47C7D7D7C7D7D7C7C7C7D7D7C7D7FB3E1BED47C7D7D7FB3EDFED47C7D7CFC7C7C7D7C7C7C7C7C7C7C7D7D7C7C7D7D7C7D7C7C7C7C7D7D7C7D7C7D7CFC7C7C7D7C7C7C7C7D7FB3EE6ED47C7D7C7D7C7D7FB3EF6ED47C7D7C7C7C7D7FB3E1EED47C7D7C7C7C7D7D7C7C7C7D7C7C7D7FB3E40ED47C7D7FB3E32ED47C7D7C7D7FB3E32ED47C7D7C7D7FB3E32ED47C7D7D7C7C7C7C7D7FBC7D7C7D7C7C7C7D7C7C7D7C7C7C7C7D7CFC7C7C7C7D7D7C7C7C7C7D7D7C7C7D7C7C7D7C7C7D7D7C7C7C7D7C7D7C7D7C7C7C7D7C7C7C7C7D7D7C7D7FBC7D7FB3E3BED47C7C7D7C7C7C7D7C7D7C7C7D7D7C7D7C7D7FB3E25ED47C7D7D7FB3E14ED47C7D7CFC7C7C7C7D7C7C7D7C7C7D7CFC7C7C7D7C7C7C7D7C7C7C7D7C7C7C7D7C7D7C7C7D7D7C7C7C7C7D7C7C7C7D7C7C7C7D7FB3EDBED47C7D7C7D7C7D7C7C7D7C7D7C7D7C7C7D7C7D7FB3EDFED47C7D7C7C7C7C5E5C5E5C5E5C5E5C5E5E5C5E5C5E5C5E5C5E5C5E5C5E5C508ED73678101C7C3210000F92B36ECED5FE5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E5C5E50812ED7B6781C1A7E92D722D732D34722D7272722D17C72426211623471E12231A2047132320242C47474747474A824AAECAB1061B9FBD069FB0E4169FAE1C1610E09FB6E010E80632D0C0E3BECE072402BECD3B352FFFBED4070403BED53634062F252522B0D6698B6680AFA9B166DED06668676766A9CDAFCCDC8D19D7B0D1ACCAF4F11DF1ACED1DF1AC1323F4F11DAC28ED2A22E4E4E42CC76DD75BB0C54967B04955B0B0BFC049608ABA92B06FBF4963B0C58EBAAEC650734E689791994EC6B84E8F4E658F9597914E65C6C496BFB5B5B27947D06A94C49CBA53969B94B99A98C953CABA5395985370CBBD98C4785CD060825D77A6A0A85DD5C75D9E5D6DA6CEA25D6DA9C4D9A2CE887AD5C7A2CE71D05F89B991AF488B89AE48BF90B9AFC4485891B98D8A899494BE6DC3CA4B6C4747474747477064BE88B8AB88AD7147AB88928CBD475E88B890AE41C78FACC08FAC898F88928B468CADB746872ED700D2F1FB018A01D3EECFAF06CA56C79BD678CFA3D4D45EC0D8CAC5EAC884FBCCF5EB00DCC99352629BC39794939E9E79F1C999C637D15AB185B6B6404F585E4F5C40405C85B7B8B1A640B7A740AA818785404202951E91E192E13F8073F174F13F8093E194E13F8075F176F13F8095E196E197E142952098E199E13CF077F178F1AAF19AE19BE13CF079F17AF1AAF19CE19DE13F809EE182951C9FE1A0E1A1E13F803F80A2E1A3E1A4E13F803F803F80A5E1A6E1A7E1CE95129FE1A0E1A1E13F803F803F809FE1A0E1A1E1EB11F7C5013F80722D732D3421FE95F26EDEEB11F5D1013F80722D732D34213E96F26EDE732D3472CFC7C7C7C7D7CFC7C7D7C7C7D7CFC7C7C7D7C7C7C7D7C7C7C7D7C7C7C7D7C7D7C7C7D7D7C7C7C7C7D7C7C7C7D7C7C7C7D7FB3EDBED47C7D7C7D7C7D7C7C7D7C7D7C7D7C7C7D7C7D7FB3EDFED47C7D7C7C7C7C7CFD7C7D7C7D7FB3E31ED47C7D7C7C7C7D7CFC7C7C7D7C7C7C7D7D7FB3EC6ED47C7D7C7C72D34722D34722D732D722D732D34722D722D7234722127DDE51D1D1A4FC602DD214EC5FD210496C3E6C2213CDDE51D1D1A4FC60ADD218FC4FD21C892C3E6C221F2DDE51D1D1A4FC6D1DD211BD6FD210000C3E6C22135DDE51D1D1A4FC607DD21E0D5FD214695C3E6C2216DDDE51D1D1A4FC6E8DD2114D5FD214293C3E6C22143DDE51D1D1A4FC60FDD21FAD3FD21CC90C3E6C22158DDE51D1D1A4FC61FDD21EBC3FD210291C3E6C2213CDDE51D1D1A4FC605DD2155C4FD214292C3E6C221A5DDE51D1D1A4FC60BDD2118C5FD211094C3E6C221C1DDE51D1D1A4FC626DD2129C5FD21E494C3E6C22127DDE51D1D1A4FC608DD2133D4FD214291C3E6C22D73722D0BC1C7C7D7CFED5FFBED47C7C7D7C7C7C7C7C7C7D7CFED5FFBED47C7C7D7C7C7C7C7C7C7D7C7CFED5FFBED47C7C7D7C7C7C7C7C7C7D7CFED5FFBED47C7C7D7C7C7C7C7C7C7D7CFED5FFBED47C7C7D7C7C7C7C7C7C7D7CFED5FFBED47C7C7D7C7C7C7C7C7C7D7CFED5FFBED47C7C7D7C7C7C7C7C7C7D7CFED5FFBED47C7C7C7C7C7C7C7C7D7C7C7C7C7C7C7D7D7C7C7D7D7C7D7FB3EDFED47C7D7C7C7C7D7CFC7C7C7D7C7C7C7D7CFC7C7C7D7FB3EF4ED47C7D7C7D7C7C7C7C7D7D7C7C7C7C7D7C7D7C7C7C7D7C7D7C7C7C7C7D7FB3EE7ED47C7C7D7CFC7C7C7D7C7D7C7D7D7C7C7D7C7D7FBC7D7C7D7D7CFC7C7C7C7D7D7C7D7C7C7C7D7C7C7C7D7FB3E0EED47C7D7C7C7D7C7C7D7C7C7C7D7C7D7C7C7C7C7D7D7C7C7C7D7C7C7C7C7D7D7FB3ED9ED47C7D7FB3E04ED47C7D7C7D7C7C7D7D7C7D7C7C7C7C7D7FB3EC0ED47C7D7D7C7C7D7D7CFC7C7C7D7C7C7D7C7D7D7CFC7C7C7D7CFC7C7C7D7D7C7FB3EEFED47C7D7CFC7C7C7D7C7C7C7D7C7C7C7C7D7CFC7C7C7D7C7C7C7D7C7D7C7C7D7FB3E04ED47C7D7FBC7D7FB3EDBED47C7D7CFC7C7C7D7C7C7C7D7FB3EC7ED47C7D7C7C7C7C7D7C7C7D7FB3E0DED47C7D7FB3E07ED47C7D7C7C7D7FBC7D7C7C7D7FB3E3AED47C7D7FBC7D7C7D7C7D7C7D7FB3EDFED47C7D7C7D7C7C7C7C7D7FB3EEDED47C7D7FB3E3BED47C7D7C7C7C7C7D7C7D7C7C7D7FB3E1FED47C7D7C7C7C7D7C7D7C7D7C7C7D7D7CFC7C7C7D7D7FB3EC7ED47C7D7D7C7D7D7C7C7C7D7D7FB3EC7ED47C7D7D7C7D7D7C7C7C7D7D7C7D7FB3E1BED47C7D7D7FB3E3E0132F0893AF089A720FAC92D34732D722D722D732D34722D722D72347221F2DDE51D1D1A4FC69CDD214AC5FD210000C3E6C221F2DDE51D1D1A4FC6EADD214CC5FD210000C3E6C221F2DDE51D1D1A4FC612DD2127C5FD210000C3E6C2212EDDE51D1D1A4FC628DD21FDD5FD218695C3E6C22143DDE51D1D1A4FC692DD2191D5FD218694C3E6C2212EDDE51D1D1A4FC6A4DD21DDD4FD21C292C3E6C2213CDDE51D1D1A4FC6F9DD21ABD4FD214292C3E6C22120DDE51D1D1A4FC6FDDD216DD4FD21C291C3E6C2212EDDE51D1D1A4FC628DD2115D4FD210491C3E6C22166DDE51D1D1A4FC6F2DD21C7D4FD218692C3E6C22135DDE51D1D1A4FC6A8DD2103C4FD214291C3E6C22182DDE51D1D1A4FC644DD2106C5FD21D093C3E6C221A5DDE51D1D1A4FC668DD213DC5FD216895C3E6C2214ADDE51D1D1A4FC6D5DD21C6D5FD210295C3E6C2722D732D00F1C9FDE1DDE1D1C1E1D9D1C1E1F108ED5FEE88ED4F3E01D308F1ED45C7C7C7C7C7C7D7C7C7C7D7C7C7C7D7FBC7C7C7C7C7C7D7C7C7C7C7D7D7FBC7D7C7C7D7FBC7D7C7C7D7C7C7D7C7D7FB3ECDED47C7D7C7D7FB3EC5ED47C7D7FBC7D7FB3E14ED47C7D7C7D7C7D7C7D7C7C7D7C7C7D7C7C7C7D7C7D7FB3ED6ED47C7D7C7D7C7C7D7C7D7FB3ED9ED47C7D7FBC7D7FB3E36ED47C7D7C7C7C7C7D7D7C7D7FB3EF0ED47C7D7C7C7D7D7FB3ECDED47C7D7D7C7C7D7CFC7C7C7D7D7C7D7C7D7C7C7C7C7D7FB3EC2ED47C7D7C7D7D7FBC7D7FB3E11ED47C7D7CFC7C7C7D7CFC7C7C7D7C7C7D7C7C7D7CFC7C7C7D7CFC7C7C7D7D7FB3EC9ED47C7D7D7C7C7D7C7D7D7FBC7D7D7FB3E27ED47C7D7C7C7D7C7C7D7FB3EE4ED47C7D7C7C7C7C7D7C7C7D7C7D7C7C7D7C7C7C7C7D7C7C7C7D7C7C7D7C7C7D7C7C7D7C7C7C7D7C7D7D7C7D7D7C7C7C7C7D7C7C7C7D7C7C7D7C7D7C7C7D7C7D7D7C7D7FB3EE4ED47C7D7C7D7C7C7D7C7D7D7C7C7C7D7C7C7D7C7C7C7C7D7C7C7C7D7C7C7C7D7CFC7C7C7D7C7C7D7C7D7C7D7C7C7D7C7C7C7D7C7C7D7C7C7D7D7C7C7D7C7C7C7D7C7D7C7C7C7D7FB3E24ED47C7D7C7C7D7C7D7C7C7D7C7C7D7D7CFC7C7C7D7D7C7C7D7FBC7D7C7D7D7C7C7D7C7C7D7CFC7C7C7D7C7C7D7D7FB3EF1ED47C7D7C7C7D7C7C7C7C7D7C7D7CFC7C7C7D7C7D7C7C7C7D7D7FB3EC0ED47C7D7FB3E24ED47C7D7C7D7C7D7D7CFC7C7C7D7CFC7C7C7D7FB3E0BED47C7D7C7C7D7FB3E3AED47C7D7C7D7FB3E14ED47C7D7D7CFC7C7C7D7C7C7C7D7C7C7C7C7D7D7FB3E1EED47C7D7C7C7C7C7D7C7C7D7C7D7C7D7C7C7C7D7C7C7D7D7C7C7C7C7D7C7D7FB3EE2ED47C7D7C7D7C7D7C7D7C7C7D7C7C7C7C7D7D7C7D7C7C7C7D7CFC7C7C7D7C7D7D7FB3E19ED47C7D7C7D7D7C7C7D7C7D7CFC7C7C7C7D7C7C7C7D7C7C7C7D7C7C7D7D7C7D7C7C7C7D7C7C7D7D7C7D7C7C7D7D7CFC7C7C7C7D7C7D7D7C7D7C7D7C7C7C7D7C7C7C7D7C7D7CFC7C7C7D7C7C7C7C7D7C7C7D7FBC7D7C7C7C7D7C7C7C7C7D7C7C7D7C7C7D7FB3E11ED47C7D7CFC7C7C7C7D7C7C7D7C7D7FB3ED9ED47C7D7C7C7C7C7D7CFC7C7C7D7C7C7D7C7C7C7C7D7C7C7D7D7CFC7C7C7D7D7C7D7D7C7C7D7FB3EE2ED47C7D7FB3E2FED47C7D7C7C7C7D7D7FB3E23ED47C7D7C7C7D7C7C7C7C7D7C7D7C7C7D7C7C7C7C7D7C7D7D7C7C7D7CFC7C7C7C7D7C7D7C7C7C7C7D7D7C7C7D7FB3EE1ED47C7D7C7C7D7D7C7C7D7D7C7C7D7D7C7C7C7D7C7C7C7C7D7D7C7D7C7C7C7C7D7D7C7C7C7D7C7C7D7ED5FFBED47C3C9C9D7C7C7C7D7D7C7C7C7D7FB3ECBED47C7D7FB3EC1ED47C7C7D7C7C7D7C7D7D7C7D7C7C7C7D7D7C7C7D7C7C7D7CFC7C7C7D7FB3EE8ED47C7D7D7CFC7C7C7D7FB3EE9ED47C7D7D7C7C7C7D7D7C7C7C7D7D7C7C7C7D7D7C7D7D7C7C7D7C7D7D7C7C7C7D7D7FBC7D7D7CFC7C7C7D7CFC7C7C7C7D7D7C7D7C7C7D7CFED5FFBED47C3C3C3C7C7C7D7CFED5FFBED47C7C7D7C7C7C7C7C7C7C7C7C7D7CFED5FFBED47C7C7D7C7C7C7C7C7C7D7CFED5FFBED47C7C7D7C7C7C7C7C7C7D7CFED5FFBED47C7C7D7C7C7C7C7C7C7D7CFED5FFBED47C7C7D7C7C7C7C7C7C7D7CFED5FFBED47C7C7D7C7C7C7C7C7C7D7CFED5FFBED47C7C7D7C7C7C7C7C7C7D7CFED5FFBED47C7C7D7C7C7C7C7C7C7D7CFED5FFBED47C7C7D7C7C7C7C7C7C7D7CFED5FFBED47C7C7D7C7C7C7C7C7C7D7CFED5FFBED47C7C7D7C7C7C7C7C7C7C7D7CFED5FFBED47C7C7D7C7C7C7C7C7C7D7CFED5FFBED47C7C7D7C7C7C7C7C7C7D7CFED5FFBED47C7C7D7C7C7C7C7C7C8D6D3C2C4C6C1CAF6C0ED4FC9C6C1CAC6C1CACD34722D722D73342D34732D342D732D72722D732D34722D722D723472215FDDE51D1D1A4FC646DD2120C4FD218291C3E6C22120DDE51D1D1A4FC6EBDD21ABC4FD210293C3E6C2213CDDE51D1D1A4FC6FFDD21CBC4FD214893C3E6C22127DDE51D1D1A4FC6FFDD21E7C4FD218293C3E6C2212EDDE51D1D1A4FC66FDD218DD4FD210492C3E6C2212EDDE51D1D1A4FC6EBDD2129D5FD218693C3E6C22190DDE51D1D1A4FC66DDD2147D5FD21C293C3E6C22135DDE51D1D1A4FC601DD2157D5FD210694C3E6C2722D2D732DCB06CB06CB06CB06CB06CB0ECB06CB06CB06CB0ECB06CB06CB06CB0ECB06CB06CB06CB06CB06CB06CB06CB06CB06CB06CB06CB06CB0ECB06C35BDE06C7CB0606C3C3CB06CBCBC3CBC3FAD9C3CB06CBC3CB06722D722D722D2150D1226581213CD63E0606005E2356234E23EDB03D20F5C9215ED1226581216DC53E02C342D121D6D32265813E8132648121B1C53E02C342D1EB118AD13E88722D732D34DD210491CD04DEDD214291C301DEEB11A3D13E88722D732D34DD218491CD0DDEDD21C291C3FEDDEB11BCD13E88722D732D34DD218693CD04DEDD210694C307DEEB11DCD13E88722D732D34DD214694CD07DEDD218694CD0DDEDD21C694C310DEEB1102C73E88722D732D34DD214695CD07DEDD218695C304DEEB110ED23E88722D732D34DD214291CD07DEDD218291C319DEEB1127D23E88722D732D34DD21C291CD0ADEDD218292C304DEEB1139D23E88722D732D34DD21C892C30ADEEB1152D23E88722D732D34DD210293CDFEDDDD214893C30ADEEB11C5D63E88722D732D34DD218293CD01DEDD21D093CD28DEDD211094C337DED7D7C7C7C7D7C7D7C7D7C7C7C7C7D7C7C7C7C7D7D7C7D7FBC7D7FB3E3BED47C7D7C7C7C7D7C7D7C7C7D7D7C7D7C7D7FB3E25ED47C7D7D7FB3E14ED47C7D7CFC7C7C7C7D7C7C7D7C7C7C7C7C7D7CFC7C7C7D7C7C7C7D7C7C7C7D7C7C7C7D7C7D7C7C7D7D7C7C7C7C7D7C7C7C7D7C7C7C7D7FB3EDBED47C7D7C7D7C7D7C7C7D7C7D7C7D7C7C7D7C7D7FB3EDFED47C7D7C7C7C7C7D7C7D7C7D7FB3E31ED47C7D7C7C7C7D7CFC7C7C7D7C7C7C7D7D7FB3EC6ED47C7D7C7C7C7D7D7C7C7C7D7FB3ECBED47C7D7FB3EC1ED47C7D7C7C7D7C7D7D7C7D7C7C7C7D7D7C7C7D7C7C7D7CFC7C7C7D7FB3EE8ED47C7D7D7CFC7C7C7D7FB3EE9ED47C7D7D7C7C7C7D7D7C7C7C7D7D7C7C7C7D7D7C7D7D7C7C7D7C7D7D7C7C7C7D7D7FBC7D7D7CFC7C7C7D7CFC7C7C7D7C7D7D7C7D7D7C7C7D7C7D7D7C7C7D7CFED5FFBED47C3C3C3C7C7C7D7D7C7C7D7D7C7D7FB3EDFED47C7D7C7C7C7D7CFC7C7C7D7C7C7C7D7CFC7C7C7D7FB3E0AD02DEB11E8D3013F80722D732D3421FE95F26EDEEB1171D1013F80722D732D34213E96F26EDE84CA2426211623471E12231A2047132320242C474747474749824A6BC7F78A494B56D98C8B8A564756D84F894B03D84E4B56D8D9D6D8524BD704D777B2026F7273727E0076737EB101FF76FEB3B3B17E1B77B27572B3B12D6FCA2577067FBB360786BD097B07088608BB867C067B7B86087E7B86D0EDCB447F3E40CCCC4B433CCC4B807F47D24B45CECCCD4B3D4042CE7FFAFA5ACA707070485AAFC44866AF4855AFAEBFB9AF94485F89B991AF4870707099CACEF802FCB7CEF828001EB733F80302B7CDFCFD2EF2D300FEFF2E45CAECB0BD1716272117FCB0C6F5F627EBCCF9F7F827EFD6B9E3EDE7A2B9E313EB09A2131A08A2DEA2AF0908191309EEA2B8DDBEEDC6C28E8F928B46B0B78BBCBC8FAC8D46A84688BEBDBDADAC9BD07CE6B1B96EAA6E7BD5D4E5DFD5BA6EB2D5EAD4B0D063BDBCCDC7BDA256CEC0569FCC569CBDC75699A29FBA989FBC9D8E8EC5D055B9A5AB417D415BB286B7B741A243D7CCF6F3AEFA1514F5F31FAE2C1526AE181FF32424AE0FD9AE25F6F330CAF7F8F6F7F420AFC6F020F816AFF927131925D4AFC920F42525AF1058D72CF8F9FCF5B0C7F121F917B0F926B021281616F916F7B02717EDCA8CBAA6AC428A8B898A87B34283A8864288BAB3B98A87B367D8C6BE07A0161CE904A0E906A01CE117E511A0DCA0BEE10AA0011BCA80BBECBAE675DFBEB8C0BEDBBC75B67585BEE6BA7585C1DCF1BAE6C3C696EDC1F2F27CDE7CF3E37CF3C4EDE3F87CBD7C8CC5EDC1BEBDC8C8A3DAD6E5C58FE6BAEBEB75848D93849175ECDC75EBBABA75DBBAF2EC75DFB6BCBA9C3891046FF170F178910471F172F18893046BF16CF1C893046DF16EF18694187BE17CE17DE13F807EE17FE13F8080E181E13F8082E183E1C4941A84E185E186E187E188E189E18AE18BE18CE18DE18EE18FE190E1D7C7D7FB3E732D72722D7221B3DDE51D1D1A4FC6CEDD2132C5FD212695C3E6C2213CDDE51D1D1A4FC698DD2137C4FD21C291C3E6C22143DDE51D1D1A4FC658DD21D0C3FD21CC90C3E6C22127DDE51D1D1A4FC64BDD211DD6FD210496C3E6C22151DDE51D1D1A4FC628DD21FBD4FD210693C3E6C22143DDE51D1D1A4FC6C5DD2152D4FD218491C3E6C221F2DDE51D1D1A4FC605DD2153C4FD210000C3E6C221F2DDE51D1D1A4FC6B7DD2125C5FD210000C3E6C22135DDE51D1D1A4FC601DD2174D5FD214694C3E6C2214ADDE51D1D1A4FC65EDD21ACD5FD21C694C3E6C2212EDDE51D1D1A4FC605DD2171C4FD218292C3E6C2342D27D1ED47C7C7D7C7C7C7C7C7C7D7CFED5FFBED47C7C7D7C7C7C7C7C7C7D7CFED5FFBED47C7C7D7C7C7C7C7C7C7D7CFED5FFBED47C7C7D7C7C7C7C7C7C7D7CFED5FFBED47C7C7D7C7C7C7C7C7C7D7CFED5FFBED47C7C7D7C7C7C7C7C7C7D7CFED5FFBED47C7C7D7C7C7C7C7C7C7D7CFED5FFBED47C7C7D7C7C7C7C7C7C7D7CFED5FFBED47C7C7D7C7C7C7C7C7C7D7CFED5FFBED47C7C7D7C7C7C7C7C7C7D7CFED5FFBED47C7C7D7C7C7C7C7C7C7D7D7C7C7D7D7C7D7FB3EDFED47C7D7C7C7C7D7CFC7C7C7D7C7C7C7D7CFC7C7C7D7FB3EF4ED47C7D7C7D7C7C7C7C7D7D7C7C7C7C7D7C7D7C7C7C7D7C7D7C7C7C7C7D7FB3EE7ED47C7D7CFC7C7C7D7C7D7C7D7D7C7C7D7C7D7FBC7D7C7D7D7CFC7C7C7C7D7D7C7D7C7C7C7D7C7C7C7D7FB3E0EED47C7D7C7C7D7C7C7D7C7C7C7D7C7D7C7C7C7C7D7D7C7C7C7D7C7C7C7C7D7D7FB3ED9ED47C7D7FB3E04ED47C7D7C7D7C7C7D7D7C7D7C7C7C7D7FB3EC0ED47C7D7D7C7C7D7D7CFC7C7C7D7C7C7D7C7D7D7CFC7C7C7D7CFC7C7C7D7D7FB3EEFED47C7D7CFC7C7C7D7C7C7C7D7C7C7C7C7D7CFC7C7C7D7C7C7C7D7C7D7C7C7D7FB3E04ED47C7D7FBC7D7FB3EDBED47C7D7CFC7C7C7D7C7C7C7D7FB3EC7ED47C7D7C7C7C7C7D7C7C7D7FB3E0DED47C7D7FB3E07ED47C7D7C7C7D7FBC7D7C7C7D7FB3E3AED47C7D7FBC7D7C7D7C7D7C7D7FB3EDFED47C7D7C7D7C7C7C7C7D7FB3EEDED47C7D7FB3E3BED47C7D7C7C7C7D7C7D7C7C7D7FB3E1FED47C7D7C7C7C7D7C7D7C7D7C7C7D7D7CFC7C7C7D7D7FB3EC7ED47C7D7D7C7D7D7C7C7C7D7ED5365813F1FED4FC9C7C7C7D7C7C7C7C7290029AF29292929371977003729C3F3DF370029C7C700C737C7C7C7C336CBD7C7D7C7CFC7C73E50ED47F02AE3803600C9D7C7D7C7CFC7C73E50ED47D7C7D7C7D7FB3EF6ED47C7D7C7C7C7D7FB3E1EED47C7D7C7C7C7D7D7C7C7C7D7C7C7D7FB3E40ED47C7D7FB3E32ED47C7D7C7D7FB3E32ED47C7D7C7D7FB3E32ED47C7D7D7C7C7C7C7D7FBC7D7C7D7C7C7C7D7C7C7D7C7C7C7C7D7CFC7C7C7C7D7D7C7C7C7C7D7D7C7C7D7C7C7D7C7C7D7D7C7C7C7D7C7D7C7D7C7C7C7D7C7C7C7C7D7D7C7D7FBC7D7FB3E3BED47C7D7C7C7C7D7C7D7C7C7D7D7C7D7C7D7FB3E25ED47C7D7D7FB3E14ED47C7D7CFC7C7C7C7D7C7C7D7C7C7D7CFC7C7C7D7C7C7C7D7C7C7C7D7C7C7C7D7C7D7C7C7D7D7C7C7C7C7D7C7C7C7D7C7C7C7D7FB3EDBED47C7D7C7D7C7D7C7C7D7C7D7C7D7C7C7D7C7D7FB3EDFED47C7D7C7C7C7C7D7C7D7C7D7FB3E31ED47C7D7C7C7C7D7CFC7C7C7D7C7C7C7D7D7FB3EC6ED47C7D7C7C7C7D7D7C7C7C7D7FB3ECBED47C7D7FB3EC1ED47C7D7C7C7D7C7D7D7C7D7C7C7C7D7D7C7C7D7C7C7D7CFC7C7C7D7FB3EE8ED47C7D7D7CFC7C7C7D7FB3EE9ED47C7D7D7C7C7C7D7D7C7C7C7D7D7C7C7C7D7D7C7D7D7C7C7D7C7D7D7C7C7C7D7D7FBC7D7D7CFC7C7C7D7CFC7C7C7D7C7D7D7C7D7D7C7C7D7C7D7D7C7C7D7CFED5FFBED47C3C3C3C7C7C7D7D7C7C7D7D7C7D7FB3EDFED47C7D7C7C7C7D7CFC7C7C7D7C7C7C7D7CFC7C7C7D7FB3EF4ED47C7D7C7D7C7C7C7C7D7D7C7C7C7C7D7C7D7C7C7C7D7C7D7C7C7C7C7D7FB3EE7ED47C7D7CFC7C7C7D7C7D7C7D7D7C7C7D7C7D7FBC7D7C7D7D7CFC7C7C7C7D7D7C7D7C7C7C7D7C7C7C7D7FB3E0EED47C7D7C7C7D7C7C7D7C7C7C7D7C7D7C7C7C7C7D7D7C7C7C7D7C7C7C7C7D7D7FB3ED9ED47C7D7FB3E04ED47C7D7C7D7C7C7D7D7C7D7C7C7C7D7FB3EC0ED47C7D7D7C7C7D7D7CFC7C7C7D7C7C7D7C7D7D7CFC7C7C7D7CFC7C7C7D7D7FB3EEFED47C7D7CFC7C7C7D7C7C7C7D7C7C7C7C7D7CFC7C7C7D7C7C7C7D7C7D7C7C7D7FB3E04ED47C7D7FBC7D7FB3EDBED47C7D7CFC7C7C7D7C7C7C7D7FB3EC7ED47C7D7C7C7C7C7D7C7C7D7FB3E0DED47C7D7FB3E07ED47C7D7C7C7D7FBC7D7C7C7D7FB3E3AED47C7D7FBC7D7C7D7C7D7C7D7FB3EDFED47C7D7C7D7C7C7C7C7D7FB3EEDED47C7D7FB3E3BED47C7D7C7C7C7D7DD77DD77DD77DD77DD77DD7E1F91FD773ADD7E1E91FD7738DD7E1D91FD7736DD7E1C91FD7734DD7E1B91FD7732DD7E1A91FD7730DD7E1991FD772EDD7E1891FD772CDD7E1791FD772ADD7E1691FD7728DD7E1591FD7726DD7E1491FD7724DD7E1391FD7722DD7E1291FD7720DD7E1191FD771EDD7E1091FD771CDD7E0F91FD771ADD7E0E91FD7718DD7E0D91FD7716DD7E0C91FD7714DD7E0B91FD7712DD7E0A91FD7710DD7E0991FD770EDD7E0891FD770CDD7E0791FD770ADD7E0691FD7708DD7E0591FD7706DD7E0491FD7704DD7E0391FD7702DD7E0291FD7700DD560137ED57DD5E00EABFD9DD773BDD7739DD7737DD7735DD7733DD7731DD772FDD772DDD772BDD7729DD7727DD7725DD7723DD7721DD771FDD771DDD771BDD7719DD7717DD7715DD7713DD7711DD770FDD770DDD770BDD7709DD7707DD7705DD7703DD7701C9DD777DE6C02CCBBDCBB5B56FED5FC34AC0DD77DD77ED736781F921BCFFC5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C539F921BCFFC5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C539F921BCFFC5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C539F921BCFFC5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C539F921BCFFC5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C539F921BCFFC5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C539F921BCFFC5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C539F921BCFFC5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C539F921BCFFC5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C539F921BCFFC5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C539F921BCFFC5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C5C539ED5FFAD6C0ED7B6781C9DD7780&quot;)\n</code></pre><p>That's the <em>entire</em> game, as a string of hex bytes. Let's make a function that will retrieve a byte at a given offset or range of offsets:</p><pre><code>(defn hex-bytes\n  ([s n] (first (hex-bytes s n (inc n))))\n  ([s from to]\n   (map #(apply str %)\n        (partition 2 (take (- (* 2 to) (* 2 from))\n                           (drop (* 2 from) s))))))\n                           \n(defn hex->ascii [bytes]\n  (apply str (map #(js/String.fromCharCode (str &quot;0x&quot; %)) bytes)))\n  \n(hex->ascii (hex-bytes mario-hex 0 3))                         \n</code></pre><p>As we can see, this is an NES ROM :)</p><p>The next 2 bytes tell us that this cartridge contains 16k of PRG ROM (game data) and 8k CHR ROM (image data).</p><p>We will expand on this... in the next post!</p><p>Happy Advent</p>",
   :direction "ltr"},
  :updated 1575417600000,
  :entities
  [{:mentions [{:text "NES"}],
    :id "nlp/f/entity/wd:172742",
    :salienceLevel "mention",
    :label "Nintendo Entertainment System"}
   {:mentions [{:text "SNES"}],
    :id "nlp/f/entity/wd:183259",
    :salienceLevel "mention",
    :label "Super Nintendo Entertainment System"}],
  :alternate
  [{:href
    "https://porkostomus.gitlab.io/posts-output/2019-12-04-mecca-roms/",
    :type "text/html"}],
  :title "MECCA ROMs",
  :author "These are the Voyages of the Porkostomus",
  :published-str "Tue Dec 03 16:00:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16ed4a9ddcc:903d52:97b0c8f7",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url "https://porkostomus.gitlab.io/img/roms.png",
   :width 636,
   :height 530,
   :contentType "image/png"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://porkostomus.gitlab.io/posts-output/2019-12-04-mecca-roms/",
  :commonTopics
  [{:score 69.08234818735401,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 23.23381269398578,
    :id "nlp/f/topic/3029",
    :salienceLevel "about",
    :label "games"}],
  :published 1575417600000,
  :fingerprint "d547d4d6",
  :canonicalUrl
  "https://porkostomus.gitlab.io/posts-output/2019-12-04-mecca-roms/"}
 {:engagement 5,
  :unread true,
  :crawled 1575475474393,
  :recrawled 1575477312340,
  :content
  {:content
   "<div><p><em>This post is part of <a shape=\"rect\" href=\"https://lambdaisland.com/blog/2019-11-25-advent-of-parens\">Advent of Parens\n2019</a>, my attempt to\npublish one blog post a day during the 24 days of the advent.</em></p><p>Here’s a little Clojure idiom that never fails to bring me joy.</p><pre><code>(into {} (map (juxt key val)) m)\n</code></pre><p>The keen observer may notice this does exactly nothing. It’s a complicated way\nof taking a map and returning that same map. However by changing parts of that\nexpression you can do so many different things, because what this really does is\npull a map into its individual bits: map entries, and keys, and values, and then\nputting it back together, so by plugging into this you can do almost any\nmap-to-map transformation imaginable, as well as many other collection-to-collection transformations.</p><p>Let’s start with a simple <code>map-vals</code> as you might find in utility libraries like\nMedley.</p><pre><code>(defn map-vals\n  &quot;Maps a function over the values of an associative collection.&quot;\n  [f m]\n  (into {} (map (juxt key (comp f val))) m))\n\n(map-vals inc {:x 1 :y 2})\n;; => {:x 2, :y 3}\n</code></pre><p>Or how about <code>keywordize-keys</code>?</p><pre><code>(defn keywordize-keys\n  [m]\n  (into {} (map (juxt (comp keyword key) val)) m))\n\n(keywordize-keys {&quot;x&quot; 1 &quot;y&quot; 2})\n;; => {:x 1, :y 2}\n</code></pre><p>Or imagine you have a sequence of maps, and you want to turn it into a map using\nthe ids as keys, so you can quickly look them up by id.</p><pre><code>(let [coll [{:id 456 :x &quot;hello&quot;}\n            {:id 641 :x &quot;world&quot;}\n            {:id 941 :x &quot;wide&quot;}]]\n  (into {} (map (juxt :id identity)) coll))\n;; => {456 {:id 456, :x &quot;hello&quot;}\n;;     641 {:id 641, :x &quot;world&quot;}\n;;     941 {:id 941, :x &quot;wide&quot;}}\n</code></pre><p>We’ve only scratched the surface here. You could take this in any direction you\nlike.</p><p>I called this pattern an idiom at the top of the post. In natural language\nidioms are things like “I’ll show you the ropes” or “I’m about to hit the sack”.\nTheir meaning is not self-evident, but for native speakers they convey a lot of\nmeaning and connotation in a short phrase. Even though they seem to obscure\nmeaning, they actually require less parsing and processing because of the\nfamiliarity of the phrase, making them a very useful tool for communication.</p><p>If however you want to be understood by a wide and diverse audience then you\nprobably want to go easy on the idioms. In programming you have to make a\nsimilar trade-off.</p><p><strong><a shape=\"rect\" href=\"https://clojureverse.org/t/advent-of-parens-2019/5159\">Comment on ClojureVerse</a></strong></p></div>",
   :direction "ltr"},
  :updated 1575474583000,
  :alternate
  [{:href
    "https://lambdaisland.com/blog/2019-12-04-advent-of-parens-4-a-useful-idiom",
    :type "text/html"}],
  :title "Advent 2019 part 4, A useful idiom",
  :author "Arne Brasseur",
  :published-str "Wed Dec 04 07:49:43 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16ed1a7efd9:50abd4:49b12733",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://lambdaisland.com/blog/2019-12-04-advent-of-parens-4-a-useful-idiom",
  :updateCount 1,
  :published 1575474583000,
  :fingerprint "d8e19e4f",
  :canonicalUrl
  "https://lambdaisland.com/blog/2019-12-04-advent-of-parens-4-a-useful-idiom"}
 {:unread true,
  :crawled 1575475474393,
  :content
  {:content
   "<h3>How do “Hello World” programs affect the way I think about programing</h3><figure><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/1024/1*OohqW5DGh9CQS4hLY5FXzA.png\"></figure><p>I’ve recently watched this <a href=\"https://www.youtube.com/watch?v=0fpDlAEQio4\">great talk</a> by Scott Wlaschin on YouTube. One of the insights I took from the talk was a quote from <a href=\"https://en.wikipedia.org/wiki/Alan_Perlis\"><em>Alan Perlis</em></a><em>:</em></p><blockquote><em>“</em>A language that doesn’t affect the way you think about programming, is not worth knowing”.</blockquote><p>But it didn’t occur to me that writing a simple “Hello World” program will actually make me think about programing…</p><p>Whether you’re an experienced developer or just taking your first steps in the programing world, you are probably familiar with the iconic “<a href=\"https://en.wikipedia.org/wiki/%22Hello,_World!%22_program\">Hello World</a>” programs. When learning a new language, an “Hello World” program is commonly used to demonstrate basic syntax, and help you setup your development environment (the tour of Go tutorial, for example, starts with this “<a href=\"https://tour.golang.org\">Hello, 世界</a>” example).</p><p>In this <a href=\"https://mayareads.blog/2019/09/10/hello_world/\">post</a>, which I’ve only recently discovered thanks to this great <a href=\"https://www.tocode.co.il/newsletter/show/46\">newsletter </a>(both written in Hebrew), the writer decided to write an “Hello World” program in as many programing languages as she can. But to spice things up, a small twist was added —the program should print the “Hello World” string diagonally:</p><pre>H<br> e<br>  l<br>   l<br>    o<br>     <br>      W<br>       o<br>        r<br>         l<br>          d</pre><p>I can hear the wheels turning in your head: there is no need to be an experienced developer to write this program (and you’d be right, of course). <strong>What is there to think about</strong>?</p><p>The basic “out of the box” idea would be to iterate the “Hello World” string while holding some kind of temporary variable to help us print an incremental number of spaces before each character. On each iteration we will update our temporary variable value to create the diagonal.</p><p>And indeed (as expected), when I was reading through the different programs written in different languages, they all felt the same and they have all implemented, with some minor variations, this basic algorithm. I’ve never learned Python, yet I could easily follow the writer’s Python solution:</p><a href=\"https://medium.com/media/db69d2e063a5be48c59a3e5c857c5b2a/href\">https://medium.com/media/db69d2e063a5be48c59a3e5c857c5b2a/href</a><p>The similarity between different solutions made we wonder about writing this program in <a href=\"https://clojure.org/\">Clojure</a> (the primary backend language at <a href=\"https://appsflyer.com\">AppsFlyer</a>). If you are not familiar with this language, I will only state that Clojure is a <a href=\"https://en.wikipedia.org/wiki/Functional_programming\">functional</a> dialect of <a href=\"https://en.wikipedia.org/wiki/Lisp_(programming_language)\">Lisp</a>. And one of the key concepts of functional programing is <a href=\"https://en.wikipedia.org/wiki/Functional_programming\">immutability</a>, which makes the “out of the box” solution irrelevant since we cannot update variable values during our iterations…</p><p>(Note that you can follow the Clojure code bellow even if you are not familiar with Clojure. After all, this is the purpose of “Hello World” program… Just don’t be alarmed by the syntax and parentheses, despite the fact that it does look a bit awkward if you’re not used to it).</p><p>So without further ado, let’s look at my initial solution, which was basically just a <a href=\"https://en.wikipedia.org/wiki/Porting\">portion</a> of the Python code. True, due to immutability we cannot update the spaces counter value, but we can overcome it (well done, me) by converting the “Hello World” string into an indexed vector and use the index value to recreate the spaces string on each iteration.</p><a href=\"https://medium.com/media/27a1c2a41c928cfcc16fb7df497505a4/href\">https://medium.com/media/27a1c2a41c928cfcc16fb7df497505a4/href</a><p>Believe it or not, this function will print a diagonal “Hello World” string to screen (and if you don’t, check it <a href=\"https://repl.it/@TzafrirBen/Hello-world\">online</a> for yourself).</p><p>But this solution, despite working, didn’t feel right. It especially didn’t feel like a functional solution. To begin with, this function has <a href=\"https://en.wikipedia.org/wiki/Side_effect_(computer_science)\">side effect</a> (TL;DR a side effect creates a change outside of the current code scope, like printing to screen). We cannot completely avoid side effects when the purpose of our program is to print to screen, but we should try to <strong>narrow and isolate</strong> these as much as possible.</p><p>So back to the drawing board, let’s rewrite the hello-world function to return a diagonal “Hello World” string instead of printing it (we still need to print the <strong>result</strong> of this function, but in itself this functions has no side effects).</p><a href=\"https://medium.com/media/d83b8f70b595b217737bd8f6347671de/href\">https://medium.com/media/d83b8f70b595b217737bd8f6347671de/href</a><p>Again, if you don’t believe me that it works just <a href=\"https://repl.it/@TzafrirBen/Hello-world\">check</a> it online for yourself…</p><p>But even after narrowing down the side effects, this function still feels like we can do better. But wait, one might ask, if the purpose of our program is to diagonally print “Hello World” and we have accomplished that, why are you feeling that its still not a “good enough” solution?</p><p>In my opinion, recreating the spaces string on each iteration results in a code that is not simple and <a href=\"https://en.wikipedia.org/wiki/Readability\"><strong>readable</strong></a>. Our code is written for humans to read, and potentially change, which makes it super important to be “easy to follow”.</p><p>I wanted to find a way to increment the spaces string instead of recreate it. And surprise surprise, there is a way to do so with Clojure. Please welcome a <a href=\"https://clojure.org/about/functional_programming#_recursive_looping\">recursive</a> solution:</p><a href=\"https://medium.com/media/bb7ebaaad9bfccd944309e8a635a5295/href\">https://medium.com/media/bb7ebaaad9bfccd944309e8a635a5295/href</a><p>If you still don’t believe that it works on the third time, you can <a href=\"https://repl.it/@TzafrirBen/Hello-world\">see for yourself</a>.</p><p>Who thought that writing a trivial “Hello World” program (sure, with some twists!), would force me to think about my code. I could easily get away with using C#, Java, Go, Node.js or any other programing language I’ve used in the past, and I would probably end up writing code similar to the Python code we’ve seen… But to go back to the quote I’ve started this post with “a language that doesn’t affect the way you think about programming, is not worth knowing”.</p><p>If this example feels a bit artificial to you, you’re correct since it is. But, and I hope I was able to emphasize this, using Clojure will force you to think about the correct way, and even possibly the most elegant way (and not just the fastest way) to write your code.</p><img width=\"1\" src=\"https://medium.com/_/stat?event=post.clientViewed&referrerSource=full_rss&postId=3be5cefdaf8c\" height=\"1\"><hr><p><a href=\"https://medium.com/appsflyer/how-can-hello-world-program-effect-the-way-you-think-about-programing-3be5cefdaf8c\">How can “Hello World” program effect the way you think about programing</a> was originally published in <a href=\"https://medium.com/appsflyer\">AppsFlyer</a> on Medium, where people are continuing the conversation by highlighting and responding to this story.</p>",
   :direction "ltr"},
  :updated 1575473907000,
  :entities
  [{:mentions [{:text "Medium"} {:text "medium.com"}],
    :id "nlp/f/entity/wd:16186120",
    :salienceLevel "mention",
    :label "Medium"}
   {:mentions [{:text "AppsFlyer"}],
    :id "nlp/f/entity/wd:20050673",
    :salienceLevel "mention",
    :label "AppsFlyer"}
   {:mentions [{:text "YouTube"}],
    :id "nlp/f/entity/wd:866",
    :salienceLevel "mention",
    :label "YouTube"}],
  :alternate
  [{:href
    "https://medium.com/appsflyer/how-can-hello-world-program-effect-the-way-you-think-about-programing-3be5cefdaf8c?source=rss----2736d8c2498d---4",
    :type "text/html"}],
  :title
  "How can “Hello World” program effect the way you think about programing",
  :author "Tzafrir Ben Ami",
  :published-str "Wed Dec 04 07:38:27 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16ed1a7efd9:50abd3:49b12733",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url
   "https://cdn-images-1.medium.com/max/1024/1*OohqW5DGh9CQS4hLY5FXzA.png",
   :width 1024,
   :height 544,
   :contentType "image/png"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://medium.com/p/3be5cefdaf8c",
  :commonTopics
  [{:score 95.13344605552506,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1575473907000,
  :fingerprint "f3030b07",
  :canonicalUrl
  "https://medium.com/appsflyer/how-can-hello-world-program-effect-the-way-you-think-about-programing-3be5cefdaf8c?source=rss----2736d8c2498d---4"}
 {:engagement 5,
  :unread true,
  :crawled 1575453921495,
  :content
  {:content
   "<p><em>This article is part of the <a href=\"http://metaredux.com/posts/2019/12/01/meta-advent-2019.html\">“Meta Advent 2019”</a> series. I’ve committed to writing\na new blog post here every day until Christmas.</em></p>\n<p>One common problem with third-party nREPL middleware is that often they aren’t (properly) documented and you\nhave to dig into the middleware code to figure out how to use it. Here I’m not referring to Clojure-level API documentation,\nbut to nREPL operation (a.k.a. “op”) API documentation. Think things like <code>eval</code>, <code>interrupt</code>, etc - the different\ntype of commands that a client would send to an nREPL server to make it do its bidding.<sup><a href=\"http://metaredux.com/posts/2019/12/04/documenting-nrepl-middleware-apis.html#fn:1\">1</a></sup></p>\n<p>The funny thing is that nREPL\nhad always had special provisions to ensure that op APIs were properly documented. Each middleware\nhas to have a descriptor (think middleware metadata) which lists things like handled ops, their parameters, return values, etc.\nHere’s an example of a middleware descriptor:</p>\n<div><div><pre><code><span>(</span><span>set-descriptor!</span><span> </span><span>#</span><span>'wrap-load-file</span><span>\n</span><span>{</span><span>:requires</span><span> </span><span>#</span><span>{</span><span>#</span><span>'caught/wrap-caught</span><span> </span><span>#</span><span>'print/wrap-print</span><span>}</span><span>\n</span><span>:expects</span><span> </span><span>#</span><span>{</span><span>&quot;eval&quot;</span><span>}</span><span>\n</span><span>:handles</span><span> </span><span>{</span><span>&quot;load-file&quot;</span><span>\n</span><span>{</span><span>:doc</span><span> </span><span>&quot;Loads a body of code, using supplied path and filename info to set source file and line number metadata. Delegates to underlying \\&quot;eval\\&quot; middleware/handler.&quot;</span><span>\n</span><span>:requires</span><span> </span><span>{</span><span>&quot;file&quot;</span><span> </span><span>&quot;Full contents of a file of code.&quot;</span><span>}</span><span>\n</span><span>:optional</span><span> </span><span>(</span><span>merge</span><span> </span><span>caught/wrap-caught-optional-arguments</span><span>\n</span><span>print/wrap-print-optional-arguments</span><span>\n</span><span>{</span><span>&quot;file-path&quot;</span><span> </span><span>&quot;Source-path-relative path of the source file, e.g. clojure/java/io.clj&quot;</span><span>\n</span><span>&quot;file-name&quot;</span><span> </span><span>&quot;Name of source file, e.g. io.clj&quot;</span><span>})</span><span>\n</span><span>:returns</span><span> </span><span>(</span><span>-></span><span> </span><span>(</span><span>meta</span><span> </span><span>#</span><span>'eval/interruptible-eval</span><span>)</span><span>\n</span><span>::middleware/descriptor</span><span>\n</span><span>:handles</span><span>\n</span><span>(</span><span>get</span><span> </span><span>&quot;eval&quot;</span><span>)</span><span>\n</span><span>:returns</span><span>)}}})</span><span>\n</span></code></pre></div></div>\n<p>You can read more about middleware descriptors <a href=\"https://nrepl.org/nrepl/design/middleware.html#_middleware_descriptors_and_nrepl_server_configuration\">here</a>.</p>\n<p>nREPL leverages those descriptors in its own documentation and <a href=\"https://nrepl.org/nrepl/ops.html\">the result</a> is pretty nice.\nThis op API documentation is generated by a <a href=\"https://github.com/nrepl/nrepl/blob/master/src/maint/nrepl/impl/docs.clj\">simple script</a> that can output both AsciiDoc and Markdown.</p>\n<p>Is there a reason why third-party middleware libraries can’t apply the same approach? Not really. After a lot of\nprocrastination I finally emulated all of this for <code>cider-nrepl</code> and its nREPL op API is finally <a href=\"https://docs.cider.mx/cider-nrepl/nrepl-api/ops.html\">well-documented</a>.\nI had to tweak a bit the original script from nREPL, but the modifications were tiny<sup><a href=\"http://metaredux.com/posts/2019/12/04/documenting-nrepl-middleware-apis.html#fn:2\">2</a></sup> and the result was pretty good.\nI was thinking it’d be cool if the documentation script was made more generic and reusable across projects (e.g. in the form of\na Leiningen plugin), but I didn’t have time to pursue this idea.</p>\n<p>Actually, when it comes to <code>cider-nrepl</code>’s documentation, I did much more than documenting the nREPL op API. During the\ncourse of CIDER’s recent funding round by “Clojurists Together”, I actually created a <a href=\"https://docs.cider.mx/cider-nrepl/index.html\">documentation site</a> for the project.\nIt’s still pretty basic, but I hope to extend and polish it in the months to come. Feedback and help would be most welcome!</p>\n<p>Given the fact that middleware like <code>cider-nrepl</code> and <code>refactor-nrepl</code> are widely used today by many editors I think it’s really\nimportant to invest in documentation. That way client authors can focus on building great features for their users, instead\nof wasting their time figuring out how are they supposed to use some API. I doubt I’ll have time to tackle <code>refactor-nrepl</code>’s\ndocumentation any time soon, but anyone with enough desire to help out can easily replicate what I’ve done for <code>cider-nrepl</code>.\nBelieve it or not - documenting APIs can be a lot of fun!</p>\n<p>That’s all I had for you today. See you tomorrow!</p>\n<div>\n<ol>\n<li>\n<p>You can read more those <a href=\"https://nrepl.org/nrepl/design/overview.html\">here</a>. <a href=\"http://metaredux.com/posts/2019/12/04/documenting-nrepl-middleware-apis.html#fnref:1\">↩</a></p>\n</li>\n<li>\n<p>Most notably - I had to exclude the built-in middleware prior to generating the output. <a href=\"http://metaredux.com/posts/2019/12/04/documenting-nrepl-middleware-apis.html#fnref:2\">↩</a></p>\n</li>\n</ol>\n</div>",
   :direction "ltr"},
  :updated 1575448980000,
  :alternate
  [{:href
    "http://metaredux.com/posts/2019/12/04/documenting-nrepl-middleware-apis.html",
    :type "text/html"}],
  :title "Documenting nREPL Middleware APIs",
  :author "Bozhidar Batsov",
  :published-str "Wed Dec 04 00:43:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16ed05f10d7:303824:97b0c8f7",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "http://metaredux.com/posts/2019/12/04/documenting-nrepl-middleware-apis",
  :commonTopics
  [{:score 40.04698768616258,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1575448980000,
  :fingerprint "dc8f1bb0",
  :canonicalUrl
  "http://metaredux.com/posts/2019/12/04/documenting-nrepl-middleware-apis.html"}
 {:engagement 21,
  :unread true,
  :crawled 1575449890227,
  :content
  {:content
   "<p>I'm a bit of a <a href=\"https://www.datomic.com/\">Datomic</a> fan. That's a bit of an understatement.</p>\n<p>I'm going to tell you a DevOps story today, about Marzia and Felix. They are both DevOps experts, delivering quality software at breakneck speeds. Marzia uses Datomic, and Felix uses PostgreSQL. Let's see how their DevOps acts out in the world.</p>\n<h2>It's 11:30 pm, almost midnight</h2>\n<p>Felix is sleeping.</p>\n<p><strong>The System</strong> is operational. Everything is running A-OK. No alerts are triggered, no warnings are active.</p>\n<p>Earlier today, Felix deployed to production. Four times, actually! DevOps, yay!</p>\n<p><strong>The System</strong> receives orders from many different systems in the organization. Felix is experienced and knows that stuff can go wrong, so he has created an audit log table in postgres that stores all the incoming orders. It's great to be able to replay orders that goes wrong.</p>\n<p>It's <em>possible</em> that <strong>The System</strong> has a complete meltdown and that orders are missed - but that doesn't matter. What matters, is that when everything is up and running, and some validation error or other software bug fails to process the order, it can simply be reprocessed by finding it in the orders audit log.</p>\n<p>It's 11:30pm. An order fails.</p>\n<p>Nobody is alerted. This is just normal business. The different system that posted the order to us got an error message back. It's their responsibility to retry until it works.</p>\n<h2>It's 08:41 am, the next day</h2>\n<p>Felix just arrived at the office.</p>\n<p>The Boss asks Felix why the order failed. It was an important order, and the system that sent it to us hasn't retried it.</p>\n<p>Cool! We have an audit log, so let's try! We just send it again. We don't have to spend time digging in the logs to find the first failure.</p>\n<p>It succeeds.</p>\n<p>(Have you ever told yourself: &quot;damn, I wish it didn't work?&quot;. That's normal. It happens to engineers all the time.)</p>\n<p>Felix is told that The Boss changed some of the rules in the admin setup this morning, before Felix arrived. The admin setup is very powerful and flexible. Lots of grids and configs to tweak and adjust how orders are processed.</p>\n<p>Oh well. It worked. We're not sure why it failed.</p>\n<p>Moving on to other things!</p>\n<h2>It's 11:30 pm, almost midnight.</h2>\n<p>Marzia is sleeping.</p>\n<p><strong>The Other System</strong> is operational. Everything is running A-OK. No alerts are triggered, no warnings are active.</p>\n<p>Earlier today, Marzia deployed to production. Four times, actually! DevOps, yay!</p>\n<p><strong>The Other System</strong> receives orders from many different systems in the organization. Marzia is a fan of Datomic, so she stores all the rules about how to process orders, and all the data about the orders themselves, as well as the raw input data that <strong>The Other System</strong> receives, in Datomic.</p>\n<p>They use redis for some other things, and Riak as well. It's nice to be able to use different databases with different semantics for different parts of <strong>The Other System</strong>.</p>\n<p>It's 11:30pm. An order fails.</p>\n<p>Nobody is alerted. This is just normal business. The different system that posted the order to us got an error mesage back. It's their responsibility to retry until it works.</p>\n<h2>It's 08:41 am, the next day</h2>\n<p>Marzia just arrived at the office.</p>\n<p>The Boss asks Marzia why the order failed. It was an important order, and the system that sent it to us hasn't retried it.</p>\n<p>Cool! Marzia stores all order related information in Datomic, so we have full access to the historical information about all the data in our system.</p>\n<p>(Say what?)</p>\n<p>Marzia is told that The Boss changed some of the rules in the admin setup this morning, before Marzia arrived.</p>\n<p>Marzia finds the transaction where the boss changed the rules.</p>\n<p>(Say <em>what??</em>)</p>\n<pre><code><span>;; Finds all transactions by boss-user</span>\n<span>(</span><span>->></span> <span>(</span><span>d/q</span> <span>'</span><span>[</span><span>:find</span> <span>[</span><span>?tx</span> <span>...</span><span>]</span>\n            <span>:in</span> <span>$</span> <span>?boss-id</span>\n            <span>:where</span>\n            <span>[</span><span>?tx</span> <span>:tx/changed-by</span> <span>?boss-id</span><span>]]</span>\n       <span>(</span><span>d/history</span> <span>db-3</span><span>)</span>\n       <span>(</span><span>:db/id</span> <span>boss-user</span><span>))</span>\n     <span>;; Get the last 3 ones</span>\n     <span>(</span><span>sort</span><span>)</span>\n     <span>(</span><span>reverse</span><span>)</span>\n     <span>(</span><span>take </span><span>3</span><span>)</span>\n     <span>(</span><span>map</span>\n       <span>(</span><span>fn </span><span>[</span><span>tx</span><span>]</span>\n              <span>;; Get raw data from transaction log for this tx</span>\n         <span>(</span><span>->></span> <span>(</span><span>d/tx-range</span> <span>db-log</span> <span>tx</span> <span>(</span><span>inc </span><span>tx</span><span>))</span>\n              <span>(</span><span>first</span><span>)</span>\n              <span>:data</span>\n              <span>;; Remove noise we don't want</span>\n              <span>(</span><span>filter </span><span>(</span><span>fn </span><span>[[</span><span>e</span> <span>a</span> <span>v</span> <span>t</span> <span>added?</span><span>]]</span> <span>(</span><span>and </span><span>added?</span> <span>(</span><span>not= </span><span>e</span> <span>tx</span><span>))))</span>\n              <span>;; Give us the good stuff</span>\n              <span>(</span><span>map </span><span>(</span><span>fn </span><span>[[</span><span>e</span> <span>a</span> <span>v</span><span>]]</span>\n                     <span>{</span><span>:id</span> <span>e</span>\n                      <span>:attr</span> <span>(</span><span>d/ident</span> <span>db-3</span> <span>a</span><span>)</span>\n                      <span>:val</span> <span>v</span><span>}))))))</span></code></pre>\n<p>Marzia could have asked for more than the 3 latest ones, but decided that 3 was a good start. Here's what Marzia gets back from that query.</p>\n<pre><code><span>({</span><span>:timestamp</span> <span>#</span><span>inst</span><span>&quot;2019-11-28T07:54:28.102-00:00&quot;</span>,\n  <span>:changes</span> \n  <span>({</span><span>:id</span> <span>17592186045421</span>, \n    <span>:attr</span> <span>:order-rule/zip-code</span>, <span>:val</span> <span>&quot;0061&quot;</span>, <span>:added?</span> <span>true</span><span>}</span>\n   <span>{</span><span>:id</span> <span>17592186045421</span>, \n     <span>:attr</span> <span>:order-rule/zip-code</span>, <span>:val</span> <span>&quot;0056&quot;</span>, <span>:added?</span> <span>false</span><span>})}</span>\n   \n <span>{</span><span>:timestamp</span> <span>#</span><span>inst</span><span>&quot;2019-11-28T07:53:58.031-00:00&quot;</span>,\n   <span>:changes</span> \n   <span>({</span><span>:id</span> <span>17592186092838</span>, \n     <span>:attr</span> <span>:customer/name</span>, <span>:val</span> <span>&quot;Some Flower Shop&quot;</span>, <span>:added?</span> <span>true</span><span>}</span>\n    <span>{</span><span>:id</span> <span>17592186092838</span>, \n     <span>:attr</span> <span>:customer/department</span>, <span>:val</span> <span>17592186860812</span>, <span>:added?</span> <span>true</span><span>})}</span>\n    \n <span>{</span><span>:timestamp</span> <span>#</span><span>inst</span><span>&quot;2019-11-28T07:52:01.511-00:00&quot;</span>,\n   <span>:changes</span> \n   <span>({</span><span>:id</span> <span>17592186089123</span>, \n     <span>:attr</span> <span>:customer/name</span>, <span>:val</span> <span>&quot;Some Office&quot;</span>, <span>:added?</span> <span>true</span><span>}</span>\n    <span>{</span><span>:id</span> <span>17592186089123</span>, \n      <span>:attr</span> <span>:customer/name</span>, <span>:val</span> <span>&quot;Some Offcie&quot;</span>, <span>:added?</span> <span>false</span><span>})})</span></code></pre>\n<p>Marzia found it! The query yielded three transactions, performed around 07:55. The oldest one fixed a spelling error in a customer name, the second one added a new customer and set its name and assigned it to a department, and the most recent one changed an <code>:order-rule/zip-code</code> from &quot;0056&quot; to &quot;0061&quot;.</p>\n<p>Marzia knows that the zip code is important to the routing, and the change of zip codes triggered some rules that were changed by a code change the day before.</p>\n<p>And the order that failed was related to the department that order rule is assigned to.</p>\n<pre><code><span>(</span><span>d/q</span>\n  <span>'</span><span>[</span><span>:find</span> <span>[</span><span>?rule-id</span> <span>...</span><span>]</span>\n    <span>:in</span> <span>$</span> <span>?order-id</span>\n    <span>:where</span>\n    <span>[</span><span>?order-id</span> <span>:order/zip-code</span> <span>?zip-code</span><span>]</span>\n    <span>[</span><span>?rule-id</span> <span>:order-rule/zip-code</span> <span>?zip-code</span><span>]]</span>\n  <span>db</span>\n  <span>failed-order-id</span><span>)</span>  \n<span>;; => #{17592186045421}</span></code></pre>\n<p>Jut to be on the safe side, Marzia checks that the order rule in question was actually associated with the same department around the time the order failed. This can be done easily, by running the same query again, but running it with the database <code>as-of</code> a provided timestamp.</p>\n<pre><code><span>(</span><span>d/q</span>\n  <span>'</span><span>[</span><span>:find</span> <span>[</span><span>?rule-id</span> <span>...</span><span>]</span>\n    <span>:in</span> <span>$</span> <span>?order-id</span>\n    <span>:where</span>\n    <span>[</span><span>?order-id</span> <span>:order/zip-code</span> <span>?zip-code</span><span>]</span>\n    <span>[</span><span>?rule-id</span> <span>:order-rule/zip-code</span> <span>?zip-code</span><span>]]</span>\n  <span>(</span><span>d/as-of</span> <span>db</span> <span>#</span><span>inst</span> <span>&quot;2019-11-27T23:30:00.000&quot;</span><span>)</span>\n  <span>failed-order-id</span><span>)</span>  \n<span>;; => #{17592186045421}</span></code></pre>\n<p>Marzia could also have checked the full history, in case it changed departments rapidly back and forth for some reason, but decides to leave it at that.</p>\n<h2>Retrospective</h2>\n<p>Felix had an audit log, but not much else.</p>\n<p>Marzia queried the Datomic database, and had all the info readily available.</p>\n<p>Datomic keeps the history for <em>all</em> the changes across the database over time. Datomic also treats transactions as first class entities, so the only &quot;clever&quot; thing that was done here was to make sure to tag transactions with the user that performed the change, so that it's easy to find that later on.</p>\n<pre><code><span>(</span><span>d/transact</span> <span>conn</span> \n  <span>[[</span><span>:db/add</span> <span>(</span><span>:db/id</span> <span>my-order-rule</span><span>)</span> <span>:order-rule/zip-code</span> <span>&quot;0061&quot;</span><span>]</span>\n   <span>[</span><span>:db/add</span> <span>&quot;datomic.tx&quot;</span> <span>:tx/changed-by</span> <span>(</span><span>:db/id</span> <span>boss-user</span><span>)]])</span></code></pre>\n<p>This is a DevOps superpower. You can track your data as it changes and churns, across deploys and code changes, and all the way back to the beginning of time. And it's just there, out of the box, you don't have to think up the use cases for time tracking up front.</p>\n<p>You can and should create audit logs. But it's super nice to be able to have <em>all</em> of the data that governs your system with change tracking.</p>\n<p>You do it with your source code. You do it with your log files. You should also do it with critical business data.</p>",
   :direction "ltr"},
  :updated 1575414000000,
  :alternate
  [{:href
    "http://augustl.com/blog/2019/devops_going_back_in_time_with_datomic",
    :type "text/html"}],
  :title "DevOps: The magic of going back in time with Datomic",
  :author "August Lilleaas",
  :published-str "Tue Dec 03 15:00:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16ed0218db3:2c079c:69b9f616",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "urn:augustl-com:feed:post::blog:2019:devops_going_back_in_time_with_datomic",
  :published 1575414000000,
  :fingerprint "d995dcc7",
  :canonicalUrl
  "http://augustl.com/blog/2019/devops_going_back_in_time_with_datomic"}
 {:engagement 8,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1575424392398,
  :recrawled 1575451704371,
  :content
  {:content
   "<p>So far this Advent of Parens I haven't posted any Clojure. Now I'm going to fix that!</p><p>I thought it would be cool to recreate the Mario Paint pixel art editor:</p><p><img alt=\"Mario Paint pixel art editor\" src=\"https://porkostomus.gitlab.io/img/paint.png\"></p><p>Here's the live self-hosted Clojurescript. Thanks to the magic of KLIPSE and Cryogen you should find the app rendered below as a Reagent element. If it doesn't show up, try loading the blog post directly. Or maybe I broke it...</p><pre><code>(ns mecca.klipse \n  (:require [reagent.core :as r]))\n\n(def current-color (r/atom &quot;#f80000&quot;))\n\n(defn svg-paths\n  ([paths]\n   (svg-paths nil paths 0 0 1))\n  ([attrs paths]\n   (svg-paths attrs paths 0 0 1))\n  ([paths x y]\n   (svg-paths nil paths x y 1))\n  ([paths x y scale]\n   (svg-paths nil paths x y scale))\n  ([attrs paths x y scale]\n   (into [:g (merge attrs\n                    {:transform (str &quot;scale(&quot; scale &quot;) translate(&quot; x &quot;,&quot; y &quot;)&quot;)})]\n         (for [[color path] paths]\n           ^{:key [color path]}\n           [:path {:stroke color\n                   :d      path}]))))\n\n(defn background []\n  (svg-paths\n   [[&quot;#c0c0c0&quot; &quot;M0 0h256M0 1h256M0 2h256M0 3h256M0 4h256M0 5h256M0 6h256M0 7h1M23 7h233M0 8h1M23 8h233M0 9h1M23 9h233M0 10h1M23 10h233M0 11h1M23 11h233M0 12h1M23 12h233M0 13h1M23 13h233M0 14h1M23 14h233M0 15h1M23 15h233M0 16h1M23 16h233M0 17h1M23 17h233M0 18h1M23 18h233M0 19h1M23 19h233M0 20h1M23 20h233M0 21h1M23 21h233M0 22h1M23 22h233M0 23h256M0 24h256M0 25h2M254 25h2M0 26h2M254 26h2M0 27h2M254 27h2M0 28h2M254 28h2M0 29h2M254 29h2M0 30h2M254 30h2M0 31h2M254 31h2M0 32h2M254 32h2M0 33h2M254 33h2M0 34h2M254 34h2M0 35h2M254 35h2M0 36h2M254 36h2M0 37h2M254 37h2M0 38h2M254 38h2M0 39h2M254 39h2M0 40h2M254 40h2M0 41h2M254 41h2M0 42h2M254 42h2M0 43h2M254 43h2M0 44h2M254 44h2M0 45h2M254 45h2M0 46h2M254 46h2M0 47h2M254 47h2M0 48h2M254 48h2M0 49h2M254 49h2M0 50h2M254 50h2M0 51h2M254 51h2M0 52h2M254 52h2M0 53h2M254 53h2M0 54h2M254 54h2M0 55h2M254 55h2M0 56h2M254 56h2M0 57h2M254 57h2M0 58h2M254 58h2M0 59h2M254 59h2M0 60h2M254 60h2M0 61h2M254 61h2M0 62h2M254 62h2M0 63h2M254 63h2M0 64h2M254 64h2M0 65h2M254 65h2M0 66h2M254 66h2M0 67h2M254 67h2M0 68h2M254 68h2M0 69h2M254 69h2M0 70h2M254 70h2M0 71h2M254 71h2M0 72h2M254 72h2M0 73h2M254 73h2M0 74h2M254 74h2M0 75h2M254 75h2M0 76h2M254 76h2M0 77h2M254 77h2M0 78h2M254 78h2M0 79h2M254 79h2M0 80h2M254 80h2M0 81h2M254 81h2M0 82h2M254 82h2M0 83h2M221 83h1M224 83h1M254 83h2M0 84h2M221 84h1M224 84h1M254 84h2M0 85h2M221 85h4M254 85h2M0 86h2M222 86h2M254 86h2M0 87h2M254 87h2M0 88h2M254 88h2M0 89h2M254 89h2M0 90h2M220 90h2M254 90h2M0 91h2M220 91h2M254 91h2M0 92h2M220 92h2M254 92h2M0 93h2M220 93h2M223 93h1M254 93h2M0 94h2M220 94h2M254 94h2M0 95h2M220 95h2M254 95h2M0 96h2M220 96h2M254 96h2M0 97h2M220 97h2M254 97h2M0 98h2M220 98h2M254 98h2M0 99h2M220 99h5M254 99h2M0 100h2M220 100h1M254 100h2M0 101h2M254 101h2M0 102h2M254 102h2M0 103h2M254 103h2M0 104h2M254 104h2M0 105h2M254 105h2M0 106h2M254 106h2M0 107h2M254 107h2M0 108h2M254 108h2M0 109h2M254 109h2M0 110h2M254 110h2M0 111h2M254 111h2M0 112h2M254 112h2M0 113h2M254 113h2M0 114h2M254 114h2M0 115h2M254 115h2M0 116h2M254 116h2M0 117h2M254 117h2M0 118h2M254 118h2M0 119h2M254 119h2M0 120h2M254 120h2M0 121h2M254 121h2M0 122h2M254 122h2M0 123h2M254 123h2M0 124h2M254 124h2M0 125h2M254 125h2M0 126h2M254 126h2M0 127h2M254 127h2M0 128h2M254 128h2M0 129h2M254 129h2M0 130h2M254 130h2M0 131h2M254 131h2M0 132h2M254 132h2M0 133h2M254 133h2M0 134h2M254 134h2M0 135h2M254 135h2M0 136h2M254 136h2M0 137h2M254 137h2M0 138h2M254 138h2M0 139h2M254 139h2M0 140h2M254 140h2M0 141h2M254 141h2M0 142h2M254 142h2M0 143h2M254 143h2M0 144h2M254 144h2M0 145h2M254 145h2M0 146h2M254 146h2M0 147h2M254 147h2M0 148h2M254 148h2M0 149h2M254 149h2M0 150h2M254 150h2M0 151h2M254 151h2M0 152h2M254 152h2M0 153h2M254 153h2M0 154h2M254 154h2M0 155h2M221 155h1M224 155h1M254 155h2M0 156h2M221 156h1M224 156h1M254 156h2M0 157h2M221 157h4M254 157h2M0 158h2M222 158h2M254 158h2M0 159h2M254 159h2M0 160h2M254 160h2M0 161h2M254 161h2M0 162h2M220 162h2M254 162h2M0 163h2M220 163h2M254 163h2M0 164h2M220 164h2M254 164h2M0 165h2M220 165h2M223 165h1M254 165h2M0 166h2M220 166h2M254 166h2M0 167h2M220 167h2M254 167h2M0 168h2M220 168h2M254 168h2M0 169h2M220 169h2M254 169h2M0 170h2M220 170h2M254 170h2M0 171h2M220 171h5M254 171h2M0 172h2M220 172h1M254 172h2M0 173h2M254 173h2M0 174h2M254 174h2M0 175h2M254 175h2M0 176h2M254 176h2M0 177h2M254 177h2M0 178h2M254 178h2M0 179h2M254 179h2M0 180h2M254 180h2M0 181h2M254 181h2M0 182h2M254 182h2M0 183h2M254 183h2M0 184h2M254 184h2M0 185h2M254 185h2M0 186h2M254 186h2M0 187h2M254 187h2M0 188h2M254 188h2M0 189h2M254 189h2M0 190h2M254 190h2M0 191h2M254 191h2M0 192h2M254 192h2M0 193h2M254 193h2M0 194h2M254 194h2M0 195h2M254 195h2M0 196h2M254 196h2M0 197h256M0 198h256M217 204h3M226 204h3M218 205h1M220 205h1M225 205h1M221 206h4M220 207h5M12 208h1M19 208h1M220 208h1M222 208h2M220 209h1M222 209h1M10 210h1M21 210h1M220 210h3M220 211h3M220 212h2M220 213h2M220 214h1M221 215h1M10 216h1M21 216h1M12 218h1M19 218h1&quot;]\n    [&quot;#000000&quot; &quot;M1 7h22M1 8h1M3 8h1M20 8h1M22 8h1M1 9h3M20 9h3M1 10h3M20 10h3M1 11h1M3 11h1M20 11h1M22 11h1M1 12h3M20 12h3M1 13h3M20 13h3M1 14h1M3 14h1M20 14h1M22 14h1M1 15h3M20 15h3M1 16h3M20 16h3M1 17h1M3 17h1M20 17h1M22 17h1M1 18h3M20 18h3M1 19h3M20 19h3M1 20h1M3 20h1M20 20h1M22 20h1M1 21h3M20 21h3M1 22h22M2 25h252M2 26h252M2 27h2M252 27h2M2 28h2M252 28h2M2 29h2M252 29h2M2 30h2M252 30h2M2 31h2M50 31h4M66 31h4M73 31h5M80 31h6M89 31h4M96 31h3M104 31h2M108 31h3M170 31h4M252 31h2M2 32h2M49 32h1M54 32h1M65 32h2M69 32h2M74 32h1M78 32h1M81 32h1M85 32h1M88 32h2M93 32h1M97 32h1M103 32h2M109 32h1M169 32h1M174 32h1M252 32h2M2 33h2M48 33h1M50 33h1M53 33h1M55 33h1M65 33h1M74 33h1M77 33h2M81 33h1M83 33h1M87 33h2M97 33h1M102 33h1M104 33h1M109 33h1M168 33h1M170 33h1M173 33h1M175 33h1M252 33h2M2 34h2M48 34h1M55 34h1M66 34h4M74 34h4M81 34h3M87 34h2M97 34h1M101 34h1M104 34h1M109 34h1M168 34h1M175 34h1M252 34h2M2 35h2M48 35h1M50 35h1M53 35h1M55 35h1M69 35h2M73 35h1M80 35h1M83 35h1M87 35h2M93 35h1M96 35h1M101 35h4M108 35h1M168 35h1M170 35h1M173 35h1M175 35h1M252 35h2M2 36h2M49 36h1M51 36h2M54 36h1M64 36h2M68 36h3M73 36h1M80 36h1M85 36h1M88 36h1M92 36h2M96 36h1M100 36h1M104 36h1M108 36h1M112 36h1M169 36h1M171 36h2M174 36h1M252 36h2M2 37h2M50 37h4M65 37h5M72 37h3M79 37h7M89 37h4M95 37h3M99 37h2M103 37h3M107 37h6M170 37h4M252 37h2M2 38h2M252 38h2M2 39h2M42 39h140M252 39h2M2 40h2M41 40h2M181 40h2M252 40h2M2 41h2M40 41h2M182 41h2M252 41h2M2 42h2M40 42h1M183 42h1M252 42h2M2 43h2M40 43h1M183 43h1M252 43h2M2 44h2M40 44h1M46 44h132M183 44h1M252 44h2M2 45h2M40 45h1M45 45h134M183 45h1M252 45h2M2 46h2M40 46h1M45 46h134M183 46h1M252 46h2M2 47h2M10 47h28M40 47h1M45 47h134M183 47h1M194 47h44M252 47h2M2 48h2M9 48h2M37 48h2M40 48h1M45 48h134M183 48h1M193 48h2M237 48h2M252 48h2M2 49h2M8 49h2M38 49h3M45 49h134M183 49h1M192 49h2M238 49h2M252 49h2M2 50h2M8 50h1M39 50h2M45 50h134M183 50h1M192 50h1M239 50h1M252 50h2M2 51h2M8 51h1M39 51h2M45 51h134M183 51h1M192 51h1M239 51h1M252 51h2M2 52h2M8 52h1M14 52h20M39 52h2M45 52h134M183 52h1M192 52h1M198 52h36M239 52h1M252 52h2M2 53h2M8 53h1M13 53h22M39 53h2M45 53h134M183 53h1M192 53h1M197 53h38M239 53h1M252 53h2M2 54h2M8 54h1M13 54h22M39 54h2M45 54h134M183 54h1M192 54h1M197 54h38M239 54h1M252 54h2M2 55h2M8 55h1M13 55h3M32 55h3M39 55h2M45 55h134M183 55h1M192 55h1M197 55h3M232 55h3M239 55h1M252 55h2M2 56h2M8 56h1M13 56h3M32 56h3M39 56h2M45 56h134M183 56h1M192 56h1M197 56h3M232 56h3M239 56h1M252 56h2M2 57h2M8 57h1M13 57h3M32 57h3M39 57h2M45 57h134M183 57h1M192 57h1M197 57h3M232 57h3M239 57h1M252 57h2M2 58h2M8 58h1M13 58h3M32 58h3M39 58h2M45 58h134M183 58h1M192 58h1M197 58h3M232 58h3M239 58h1M252 58h2M2 59h2M8 59h1M13 59h3M32 59h3M39 59h2M45 59h134M183 59h1M192 59h1M197 59h3M232 59h3M239 59h1M252 59h2M2 60h2M8 60h1M13 60h3M32 60h3M39 60h2M45 60h134M183 60h1M192 60h1M197 60h3M232 60h3M239 60h1M252 60h2M2 61h2M8 61h1M13 61h3M32 61h3M39 61h2M45 61h134M183 61h1M192 61h1M197 61h3M232 61h3M239 61h1M252 61h2M2 62h2M8 62h1M13 62h3M32 62h3M39 62h2M45 62h134M183 62h1M192 62h1M197 62h3M232 62h3M239 62h1M252 62h2M2 63h2M8 63h1M13 63h3M32 63h3M39 63h2M45 63h134M183 63h1M192 63h1M197 63h38M239 63h1M252 63h2M2 64h2M8 64h1M13 64h3M32 64h3M39 64h2M45 64h134M183 64h1M192 64h1M197 64h38M239 64h1M252 64h2M2 65h2M8 65h1M13 65h3M32 65h3M39 65h2M45 65h134M183 65h1M192 65h1M198 65h36M239 65h1M252 65h2M2 66h2M8 66h1M13 66h3M32 66h3M39 66h2M45 66h134M183 66h1M192 66h1M239 66h1M252 66h2M2 67h2M8 67h1M13 67h3M32 67h3M39 67h2M45 67h134M183 67h1M192 67h1M239 67h1M252 67h2M2 68h2M8 68h1M13 68h3M32 68h3M39 68h2M45 68h134M183 68h1M192 68h2M238 68h2M252 68h2M2 69h2M8 69h1M13 69h3M32 69h3M39 69h2M45 69h134M183 69h1M193 69h2M237 69h3M252 69h2M2 70h2M8 70h1M13 70h3M32 70h3M39 70h2M45 70h134M183 70h1M194 70h46M252 70h2M2 71h2M8 71h1M13 71h22M39 71h2M45 71h134M183 71h1M210 71h30M252 71h2M2 72h2M8 72h1M13 72h22M39 72h2M45 72h134M183 72h1M209 72h2M237 72h3M252 72h2M2 73h2M8 73h1M14 73h20M39 73h2M45 73h134M183 73h1M208 73h2M238 73h2M252 73h2M2 74h2M8 74h1M39 74h2M45 74h134M183 74h1M208 74h1M239 74h1M252 74h2M2 75h2M8 75h1M39 75h2M45 75h134M183 75h1M208 75h1M239 75h1M252 75h2M2 76h2M8 76h2M38 76h3M45 76h134M183 76h1M208 76h1M214 76h20M239 76h1M252 76h2M2 77h2M9 77h2M37 77h2M40 77h1M45 77h134M183 77h1M208 77h1M213 77h2M233 77h2M239 77h1M252 77h2M2 78h2M10 78h28M40 78h1M45 78h134M183 78h1M208 78h1M213 78h1M234 78h1M239 78h1M252 78h2M2 79h2M40 79h1M45 79h134M183 79h1M208 79h1M213 79h1M234 79h1M239 79h1M252 79h2M2 80h2M40 80h1M45 80h134M183 80h1M208 80h1M213 80h1M222 80h3M234 80h1M239 80h1M252 80h2M2 81h2M40 81h1M45 81h134M183 81h1M208 81h1M213 81h1M220 81h2M225 81h2M234 81h1M239 81h1M252 81h2M2 82h2M40 82h1M45 82h134M183 82h1M208 82h1M213 82h1M219 82h1M227 82h1M234 82h1M239 82h1M252 82h2M2 83h2M40 83h1M45 83h134M183 83h1M208 83h1M213 83h1M219 83h1M227 83h1M234 83h1M239 83h1M252 83h2M2 84h2M40 84h1M45 84h134M183 84h1M208 84h1M213 84h1M218 84h1M228 84h1M234 84h1M239 84h1M252 84h2M2 85h2M40 85h1M45 85h134M183 85h1M208 85h1M213 85h1M218 85h1M228 85h1M234 85h1M239 85h1M252 85h2M2 86h2M40 86h1M45 86h134M183 86h1M208 86h1M213 86h1M218 86h1M228 86h1M234 86h1M239 86h1M252 86h2M2 87h2M40 87h1M45 87h134M183 87h1M208 87h1M213 87h1M219 87h1M227 87h1M234 87h1M239 87h1M252 87h2M2 88h2M40 88h1M45 88h134M183 88h1M208 88h1M213 88h1M219 88h1M227 88h1M234 88h1M239 88h1M252 88h2M2 89h2M40 89h1M45 89h134M183 89h1M208 89h1M213 89h1M219 89h3M225 89h3M234 89h1M239 89h1M252 89h2M2 90h2M40 90h1M45 90h134M183 90h1M208 90h1M213 90h1M219 90h1M222 90h3M227 90h1M234 90h1M239 90h1M252 90h2M2 91h2M40 91h1M45 91h134M183 91h1M208 91h1M213 91h1M219 91h1M222 91h1M224 91h1M227 91h1M234 91h1M239 91h1M252 91h2M2 92h2M40 92h1M45 92h134M183 92h1M208 92h1M213 92h1M219 92h1M222 92h1M224 92h1M227 92h1M234 92h1M239 92h1M252 92h2M2 93h2M40 93h1M45 93h134M183 93h1M208 93h1M213 93h1M219 93h1M222 93h1M224 93h1M227 93h1M234 93h1M239 93h1M252 93h2M2 94h2M40 94h1M45 94h134M183 94h1M208 94h1M213 94h1M219 94h1M222 94h1M224 94h1M227 94h1M234 94h1M239 94h1M252 94h2M2 95h2M40 95h1M45 95h134M183 95h1M208 95h1M213 95h1M219 95h1M222 95h3M227 95h1M234 95h1M239 95h1M252 95h2M2 96h2M40 96h1M45 96h134M183 96h1M208 96h1M213 96h1M219 96h1M222 96h3M227 96h1M234 96h1M239 96h1M252 96h2M2 97h2M40 97h1M45 97h134M183 97h1M208 97h1M213 97h1M219 97h1M222 97h3M227 97h1M234 97h1M239 97h1M252 97h2M2 98h2M40 98h1M45 98h134M183 98h1M208 98h1M213 98h1M219 98h1M222 98h3M227 98h1M234 98h1M239 98h1M252 98h2M2 99h2M40 99h1M45 99h134M183 99h1M208 99h1M213 99h1M219 99h1M227 99h1M234 99h1M239 99h1M252 99h2M2 100h2M40 100h1M45 100h134M183 100h1M208 100h1M213 100h1M219 100h1M227 100h1M234 100h1M239 100h1M252 100h2M2 101h2M40 101h1M45 101h134M183 101h1M208 101h1M213 101h1M220 101h1M226 101h1M234 101h1M239 101h1M252 101h2M2 102h2M40 102h1M45 102h134M183 102h1M208 102h1M213 102h1M221 102h5M234 102h1M239 102h1M252 102h2M2 103h2M40 103h1M45 103h134M183 103h1M208 103h1M213 103h1M234 103h1M239 103h1M252 103h2M2 104h2M40 104h1M45 104h134M183 104h1M208 104h1M213 104h2M233 104h2M239 104h1M252 104h2M2 105h2M40 105h1M45 105h134M183 105h1M208 105h1M214 105h20M239 105h1M252 105h2M2 106h2M40 106h1M45 106h134M183 106h1M208 106h1M239 106h1M252 106h2M2 107h2M40 107h1M45 107h134M183 107h1M208 107h1M239 107h1M252 107h2M2 108h2M40 108h1M45 108h134M183 108h1M208 108h2M238 108h2M252 108h2M2 109h2M40 109h1M45 109h134M183 109h1M209 109h2M237 109h2M252 109h2M2 110h2M40 110h1M45 110h134M183 110h1M210 110h28M252 110h2M2 111h2M40 111h1M45 111h134M183 111h1M252 111h2M2 112h2M40 112h1M45 112h134M183 112h1M252 112h2M2 113h2M40 113h1M45 113h134M183 113h1M252 113h2M2 114h2M40 114h1M45 114h134M183 114h1M252 114h2M2 115h2M40 115h1M45 115h134M183 115h1M252 115h2M2 116h2M40 116h1M45 116h134M183 116h1M252 116h2M2 117h2M40 117h1M45 117h134M183 117h1M252 117h2M2 118h2M40 118h1M45 118h134M183 118h1M252 118h2M2 119h2M40 119h1M45 119h134M183 119h1M194 119h44M252 119h2M2 120h2M40 120h1M45 120h134M183 120h1M193 120h2M237 120h2M252 120h2M2 121h2M40 121h1M45 121h134M183 121h1M192 121h2M238 121h2M252 121h2M2 122h2M40 122h1M45 122h134M183 122h1M192 122h1M239 122h1M252 122h2M2 123h2M40 123h1M45 123h134M183 123h1M192 123h1M239 123h1M252 123h2M2 124h2M40 124h1M45 124h134M183 124h1M192 124h1M198 124h36M239 124h1M252 124h2M2 125h2M40 125h1M45 125h134M183 125h1M192 125h1M197 125h38M239 125h1M252 125h2M2 126h2M40 126h1M45 126h134M183 126h1M192 126h1M197 126h38M239 126h1M252 126h2M2 127h2M40 127h1M45 127h134M183 127h1M192 127h1M197 127h3M232 127h3M239 127h1M252 127h2M2 128h2M40 128h1M45 128h134M183 128h1M192 128h1M197 128h3M232 128h3M239 128h1M252 128h2M2 129h2M40 129h1M45 129h134M183 129h1M192 129h1M197 129h3M232 129h3M239 129h1M252 129h2M2 130h2M40 130h1M45 130h134M183 130h1M192 130h1M197 130h3M232 130h3M239 130h1M252 130h2M2 131h2M40 131h1M45 131h134M183 131h1M192 131h1M197 131h3M232 131h3M239 131h1M252 131h2M2 132h2M40 132h1M45 132h134M183 132h1M192 132h1M197 132h3M232 132h3M239 132h1M252 132h2M2 133h2M40 133h1M45 133h134M183 133h1M192 133h1M197 133h3M232 133h3M239 133h1M252 133h2M2 134h2M40 134h1M45 134h134M183 134h1M192 134h1M197 134h3M232 134h3M239 134h1M252 134h2M2 135h2M40 135h1M45 135h134M183 135h1M192 135h1M197 135h38M239 135h1M252 135h2M2 136h2M40 136h1M45 136h134M183 136h1M192 136h1M197 136h38M239 136h1M252 136h2M2 137h2M40 137h1M45 137h134M183 137h1M192 137h1M198 137h36M239 137h1M252 137h2M2 138h2M9 138h4M14 138h1M19 138h4M25 138h3M30 138h4M40 138h1M45 138h134M183 138h1M192 138h1M239 138h1M252 138h2M2 139h2M9 139h1M12 139h1M14 139h1M19 139h1M24 139h1M28 139h1M30 139h1M34 139h1M37 139h1M40 139h1M45 139h134M183 139h1M192 139h1M239 139h1M252 139h2M2 140h2M9 140h1M14 140h1M19 140h1M24 140h1M28 140h1M30 140h1M34 140h1M37 140h1M40 140h1M45 140h134M183 140h1M192 140h2M238 140h2M252 140h2M2 141h2M9 141h1M14 141h1M19 141h3M24 141h5M30 141h4M37 141h1M40 141h1M45 141h134M183 141h1M193 141h2M237 141h3M252 141h2M2 142h2M9 142h1M14 142h1M19 142h1M24 142h1M28 142h1M30 142h1M33 142h1M37 142h1M40 142h1M45 142h134M183 142h1M194 142h46M252 142h2M2 143h2M9 143h1M12 143h1M14 143h1M19 143h1M24 143h1M28 143h1M30 143h1M34 143h1M37 143h1M40 143h1M45 143h134M183 143h1M210 143h30M252 143h2M2 144h2M9 144h4M14 144h4M19 144h4M24 144h1M28 144h1M30 144h1M34 144h1M37 144h1M40 144h1M45 144h134M183 144h1M209 144h2M237 144h3M252 144h2M2 145h2M36 145h2M40 145h1M45 145h134M183 145h1M208 145h2M238 145h2M252 145h2M2 146h2M37 146h1M40 146h1M45 146h134M183 146h1M208 146h1M239 146h1M252 146h2M2 147h2M37 147h1M40 147h1M45 147h134M183 147h1M208 147h1M239 147h1M252 147h2M2 148h2M36 148h1M40 148h1M45 148h134M183 148h1M208 148h1M214 148h20M239 148h1M252 148h2M2 149h2M8 149h28M40 149h1M45 149h134M183 149h1M208 149h1M213 149h2M233 149h2M239 149h1M252 149h2M2 150h2M40 150h1M45 150h134M183 150h1M208 150h1M213 150h1M234 150h1M239 150h1M252 150h2M2 151h2M40 151h1M45 151h134M183 151h1M208 151h1M213 151h1M234 151h1M239 151h1M252 151h2M2 152h2M40 152h1M45 152h134M183 152h1M208 152h1M213 152h1M222 152h3M234 152h1M239 152h1M252 152h2M2 153h2M40 153h1M45 153h134M183 153h1M208 153h1M213 153h1M220 153h2M225 153h2M234 153h1M239 153h1M252 153h2M2 154h2M40 154h1M45 154h134M183 154h1M208 154h1M213 154h1M219 154h1M227 154h1M234 154h1M239 154h1M252 154h2M2 155h2M40 155h1M45 155h134M183 155h1M208 155h1M213 155h1M219 155h1M227 155h1M234 155h1M239 155h1M252 155h2M2 156h2M40 156h1M45 156h134M183 156h1M208 156h1M213 156h1M218 156h1M228 156h1M234 156h1M239 156h1M252 156h2M2 157h2M40 157h1M45 157h134M183 157h1M208 157h1M213 157h1M218 157h1M228 157h1M234 157h1M239 157h1M252 157h2M2 158h2M40 158h1M45 158h134M183 158h1M208 158h1M213 158h1M218 158h1M228 158h1M234 158h1M239 158h1M252 158h2M2 159h2M40 159h1M45 159h134M183 159h1M208 159h1M213 159h1M219 159h1M227 159h1M234 159h1M239 159h1M252 159h2M2 160h2M40 160h1M45 160h134M183 160h1M208 160h1M213 160h1M219 160h1M227 160h1M234 160h1M239 160h1M252 160h2M2 161h2M40 161h1M45 161h134M183 161h1M208 161h1M213 161h1M219 161h3M225 161h3M234 161h1M239 161h1M252 161h2M2 162h2M40 162h1M45 162h134M183 162h1M208 162h1M213 162h1M219 162h1M222 162h3M227 162h1M234 162h1M239 162h1M252 162h2M2 163h2M40 163h1M45 163h134M183 163h1M208 163h1M213 163h1M219 163h1M222 163h1M224 163h1M227 163h1M234 163h1M239 163h1M252 163h2M2 164h2M40 164h1M45 164h134M183 164h1M208 164h1M213 164h1M219 164h1M222 164h1M224 164h1M227 164h1M234 164h1M239 164h1M252 164h2M2 165h2M40 165h1M45 165h134M183 165h1M208 165h1M213 165h1M219 165h1M222 165h1M224 165h1M227 165h1M234 165h1M239 165h1M252 165h2M2 166h2M40 166h1M45 166h134M183 166h1M208 166h1M213 166h1M219 166h1M222 166h1M224 166h1M227 166h1M234 166h1M239 166h1M252 166h2M2 167h2M40 167h1M45 167h134M183 167h1M208 167h1M213 167h1M219 167h1M222 167h3M227 167h1M234 167h1M239 167h1M252 167h2M2 168h2M40 168h1M45 168h134M183 168h1M208 168h1M213 168h1M219 168h1M222 168h3M227 168h1M234 168h1M239 168h1M252 168h2M2 169h2M40 169h1M45 169h134M183 169h1M208 169h1M213 169h1M219 169h1M222 169h3M227 169h1M234 169h1M239 169h1M252 169h2M2 170h2M40 170h1M45 170h134M183 170h1M208 170h1M213 170h1M219 170h1M222 170h3M227 170h1M234 170h1M239 170h1M252 170h2M2 171h2M40 171h1M45 171h134M183 171h1M208 171h1M213 171h1M219 171h1M227 171h1M234 171h1M239 171h1M252 171h2M2 172h2M40 172h1M45 172h134M183 172h1M208 172h1M213 172h1M219 172h1M227 172h1M234 172h1M239 172h1M252 172h2M2 173h2M40 173h1M45 173h134M183 173h1M208 173h1M213 173h1M220 173h1M226 173h1M234 173h1M239 173h1M252 173h2M2 174h2M40 174h1M45 174h134M183 174h1M208 174h1M213 174h1M221 174h5M234 174h1M239 174h1M252 174h2M2 175h2M40 175h1M45 175h134M183 175h1M208 175h1M213 175h1M234 175h1M239 175h1M252 175h2M2 176h2M40 176h1M45 176h134M183 176h1M208 176h1M213 176h2M233 176h2M239 176h1M252 176h2M2 177h2M40 177h1M46 177h132M183 177h1M208 177h1M214 177h20M239 177h1M252 177h2M2 178h2M40 178h1M183 178h1M208 178h1M239 178h1M252 178h2M2 179h2M40 179h1M183 179h1M208 179h1M239 179h1M252 179h2M2 180h2M40 180h2M182 180h2M208 180h2M238 180h2M252 180h2M2 181h2M41 181h2M181 181h2M209 181h2M237 181h2M252 181h2M2 182h2M42 182h140M210 182h28M252 182h2M2 183h2M252 183h2M2 184h2M252 184h2M2 185h2M252 185h2M2 186h2M252 186h2M2 187h2M252 187h2M2 188h2M252 188h2M2 189h2M252 189h2M2 190h2M252 190h2M2 191h2M252 191h2M2 192h2M252 192h2M2 193h2M252 193h2M2 194h2M252 194h2M2 195h252M2 196h252M0 199h256M27 200h1M244 200h1M8 201h16M27 201h1M244 201h1M8 202h1M23 202h1M27 202h1M244 202h1M8 203h1M23 203h1M27 203h1M216 203h14M244 203h1M8 204h1M23 204h1M27 204h1M216 204h1M220 204h6M229 204h1M244 204h1M8 205h1M23 205h1M27 205h1M216 205h2M221 205h4M228 205h2M244 205h1M8 206h1M15 206h1M23 206h1M27 206h1M216 206h2M219 206h1M226 206h1M228 206h2M244 206h1M8 207h1M15 207h1M23 207h1M27 207h1M216 207h2M228 207h2M244 207h1M8 208h1M13 208h6M23 208h1M27 208h1M216 208h3M227 208h3M244 208h1M8 209h1M12 209h1M15 209h5M23 209h1M27 209h1M216 209h3M221 209h1M224 209h1M227 209h3M244 209h1M8 210h1M11 210h1M16 210h5M23 210h1M27 210h1M216 210h3M227 210h3M244 210h1M8 211h1M10 211h2M16 211h6M23 211h1M27 211h1M216 211h3M227 211h3M244 211h1M8 212h1M10 212h3M15 212h7M23 212h1M27 212h1M216 212h3M222 212h2M227 212h3M244 212h1M8 213h1M10 213h12M23 213h1M27 213h1M216 213h3M222 213h2M227 213h3M244 213h1M8 214h1M10 214h12M23 214h1M27 214h1M216 214h3M221 214h4M227 214h3M244 214h1M8 215h1M10 215h12M23 215h1M27 215h1M216 215h4M226 215h4M244 215h1M8 216h1M11 216h10M23 216h1M27 216h1M216 216h5M225 216h5M244 216h1M8 217h1M12 217h8M23 217h1M27 217h1M216 217h14M244 217h1M8 218h1M13 218h6M23 218h1M27 218h1M244 218h1M8 219h1M23 219h1M27 219h1M244 219h1M8 220h16M27 220h1M244 220h1M27 221h1M244 221h1M27 222h1M244 222h1&quot;]\n    [&quot;#f8f8f8&quot; &quot;M2 8h1M21 8h1M2 11h1M21 11h1M2 14h1M21 14h1M2 17h1M21 17h1M2 20h1M21 20h1M44 42h135M43 43h2M179 43h1M43 44h1M180 44h1M43 45h1M180 45h1M43 46h1M180 46h1M43 47h1M180 47h1M43 48h1M180 48h1M43 49h1M180 49h1M12 50h23M43 50h1M180 50h1M196 50h39M11 51h2M35 51h1M43 51h1M180 51h1M195 51h2M235 51h1M11 52h1M36 52h1M43 52h1M180 52h1M195 52h1M236 52h1M11 53h1M36 53h1M43 53h1M180 53h1M195 53h1M236 53h1M11 54h1M36 54h1M43 54h1M180 54h1M195 54h1M236 54h1M11 55h1M36 55h1M43 55h1M180 55h1M195 55h1M200 55h31M236 55h1M11 56h1M36 56h1M43 56h1M180 56h1M195 56h1M200 56h1M236 56h1M11 57h1M36 57h1M43 57h1M180 57h1M195 57h1M200 57h1M236 57h1M11 58h1M36 58h1M43 58h1M180 58h1M195 58h1M200 58h1M236 58h1M11 59h1M36 59h1M43 59h1M180 59h1M195 59h1M200 59h1M236 59h1M11 60h1M36 60h1M43 60h1M180 60h1M195 60h1M200 60h1M236 60h1M11 61h1M36 61h1M43 61h1M180 61h1M195 61h1M200 61h1M236 61h1M11 62h1M36 62h1M43 62h1M180 62h1M195 62h1M236 62h1M11 63h1M36 63h1M43 63h1M180 63h1M195 63h1M236 63h1M11 64h1M36 64h1M43 64h1M180 64h1M195 64h1M236 64h1M11 65h1M36 65h1M43 65h1M180 65h1M195 65h1M236 65h1M11 66h1M36 66h1M43 66h1M180 66h1M195 66h2M235 66h1M11 67h1M36 67h1M43 67h1M180 67h1M196 67h39M11 68h1M36 68h1M43 68h1M180 68h1M11 69h1M36 69h1M43 69h1M180 69h1M11 70h1M36 70h1M43 70h1M180 70h1M11 71h1M36 71h1M43 71h1M180 71h1M11 72h1M36 72h1M43 72h1M180 72h1M11 73h1M36 73h1M43 73h1M180 73h1M11 74h2M35 74h1M43 74h1M180 74h1M212 74h23M12 75h23M43 75h1M180 75h1M211 75h2M235 75h1M43 76h1M180 76h1M211 76h1M236 76h1M43 77h1M180 77h1M211 77h1M236 77h1M43 78h1M180 78h1M211 78h1M236 78h1M43 79h1M180 79h1M211 79h1M236 79h1M43 80h1M180 80h1M211 80h1M236 80h1M43 81h1M180 81h1M211 81h1M236 81h1M43 82h1M180 82h1M211 82h1M236 82h1M43 83h1M180 83h1M211 83h1M222 83h2M236 83h1M43 84h1M180 84h1M211 84h1M222 84h2M236 84h1M43 85h1M180 85h1M211 85h1M236 85h1M43 86h1M180 86h1M211 86h1M236 86h1M43 87h1M180 87h1M211 87h1M236 87h1M43 88h1M180 88h1M211 88h1M236 88h1M43 89h1M180 89h1M211 89h1M236 89h1M43 90h1M180 90h1M211 90h1M236 90h1M43 91h1M180 91h1M211 91h1M236 91h1M43 92h1M180 92h1M211 92h1M236 92h1M43 93h1M180 93h1M211 93h1M236 93h1M43 94h1M180 94h1M211 94h1M236 94h1M43 95h1M180 95h1M211 95h1M236 95h1M43 96h1M180 96h1M211 96h1M236 96h1M43 97h1M180 97h1M211 97h1M236 97h1M43 98h1M180 98h1M211 98h1M236 98h1M43 99h1M180 99h1M211 99h1M236 99h1M43 100h1M180 100h1M211 100h1M236 100h1M43 101h1M180 101h1M211 101h1M236 101h1M43 102h1M180 102h1M211 102h1M236 102h1M43 103h1M180 103h1M211 103h1M236 103h1M43 104h1M180 104h1M211 104h1M236 104h1M43 105h1M180 105h1M211 105h1M236 105h1M43 106h1M180 106h1M211 106h2M235 106h1M43 107h1M180 107h1M212 107h23M43 108h1M180 108h1M43 109h1M180 109h1M43 110h1M180 110h1M43 111h1M180 111h1M43 112h1M180 112h1M43 113h1M180 113h1M43 114h1M180 114h1M43 115h1M180 115h1M43 116h1M180 116h1M43 117h1M180 117h1M43 118h1M180 118h1M43 119h1M180 119h1M43 120h1M180 120h1M43 121h1M180 121h1M43 122h1M180 122h1M196 122h39M43 123h1M180 123h1M195 123h2M235 123h1M43 124h1M180 124h1M195 124h1M236 124h1M43 125h1M180 125h1M195 125h1M236 125h1M43 126h1M180 126h1M195 126h1M236 126h1M43 127h1M180 127h1M195 127h1M201 127h30M236 127h1M43 128h1M180 128h1M195 128h1M200 128h1M236 128h1M43 129h1M180 129h1M195 129h1M200 129h1M236 129h1M43 130h1M180 130h1M195 130h1M200 130h1M236 130h1M43 131h1M180 131h1M195 131h1M200 131h1M236 131h1M43 132h1M180 132h1M195 132h1M200 132h1M236 132h1M43 133h1M180 133h1M195 133h1M200 133h1M236 133h1M43 134h1M180 134h1M195 134h1M236 134h1M43 135h1M180 135h1M195 135h1M236 135h1M43 136h1M180 136h1M195 136h1M236 136h1M8 137h28M43 137h1M180 137h1M195 137h1M236 137h1M7 138h2M13 138h1M15 138h4M23 138h2M28 138h2M34 138h3M43 138h1M180 138h1M195 138h2M235 138h1M7 139h1M43 139h1M180 139h1M196 139h39M7 140h2M10 140h4M15 140h4M20 140h4M25 140h3M29 140h1M31 140h3M35 140h2M43 140h1M180 140h1M7 141h1M43 141h1M180 141h1M7 142h1M43 142h1M180 142h1M7 143h1M43 143h1M180 143h1M7 144h1M36 144h1M43 144h1M180 144h1M35 145h1M43 145h1M180 145h1M43 146h1M180 146h1M212 146h23M43 147h1M180 147h1M211 147h2M235 147h1M43 148h1M180 148h1M211 148h1M236 148h1M43 149h1M180 149h1M211 149h1M236 149h1M43 150h1M180 150h1M211 150h1M236 150h1M43 151h1M180 151h1M211 151h1M236 151h1M43 152h1M180 152h1M211 152h1M236 152h1M43 153h1M180 153h1M211 153h1M236 153h1M43 154h1M180 154h1M211 154h1M236 154h1M43 155h1M180 155h1M211 155h1M222 155h2M236 155h1M43 156h1M180 156h1M211 156h1M222 156h2M236 156h1M43 157h1M180 157h1M211 157h1M236 157h1M43 158h1M180 158h1M211 158h1M236 158h1M43 159h1M180 159h1M211 159h1M236 159h1M43 160h1M180 160h1M211 160h1M236 160h1M43 161h1M180 161h1M211 161h1M236 161h1M43 162h1M180 162h1M211 162h1M236 162h1M43 163h1M180 163h1M211 163h1M236 163h1M43 164h1M180 164h1M211 164h1M236 164h1M43 165h1M180 165h1M211 165h1M236 165h1M43 166h1M180 166h1M211 166h1M236 166h1M43 167h1M180 167h1M211 167h1M236 167h1M43 168h1M180 168h1M211 168h1M236 168h1M43 169h1M180 169h1M211 169h1M236 169h1M43 170h1M180 170h1M211 170h1M236 170h1M43 171h1M180 171h1M211 171h1M236 171h1M43 172h1M180 172h1M211 172h1M236 172h1M43 173h1M180 173h1M211 173h1M236 173h1M43 174h1M180 174h1M211 174h1M236 174h1M43 175h1M180 175h1M211 175h1M236 175h1M43 176h1M180 176h1M211 176h1M236 176h1M43 177h1M180 177h1M211 177h1M236 177h1M43 178h2M179 178h1M211 178h2M235 178h1M44 179h135M212 179h23M9 202h14M9 203h4M14 203h1M16 203h1M18 203h5M9 204h14M9 205h3M13 205h1M17 205h1M19 205h4M9 206h5M17 206h6M9 207h4M14 207h1M16 207h1M18 207h5M9 208h3M20 208h3M221 208h1M224 208h1M9 209h2M21 209h2M9 210h1M13 210h2M22 210h1M9 211h1M13 211h2M22 211h1M9 212h1M22 212h1M9 213h1M22 213h1M9 214h1M22 214h1M9 215h1M22 215h1M9 216h1M22 216h1M9 217h2M21 217h2M9 218h3M20 218h3M9 219h14&quot;]\n    [@current-color &quot;M4 8h16M4 9h16M4 10h16M4 11h16M4 12h16M4 13h16M4 14h16M4 15h16M4 16h16M4 17h16M4 18h16M4 19h16M4 20h16M4 21h16&quot;]\n    [&quot;#f8e8b8&quot; &quot;M4 27h248M4 28h248M4 29h248M4 30h248M4 31h46M54 31h12M70 31h3M78 31h2M86 31h3M93 31h3M99 31h5M106 31h2M111 31h14M129 31h2M138 31h4M144 31h2M148 31h3M153 31h1M159 31h11M174 31h78M4 32h45M55 32h10M67 32h2M71 32h3M75 32h3M79 32h2M82 32h3M86 32h2M90 32h3M94 32h3M98 32h5M105 32h4M110 32h14M126 32h2M130 32h1M132 32h2M135 32h2M138 32h3M143 32h4M149 32h1M152 32h3M156 32h3M160 32h9M175 32h77M4 33h44M56 33h9M66 33h8M75 33h2M79 33h2M82 33h1M84 33h3M89 33h8M98 33h4M103 33h1M105 33h4M110 33h14M125 33h9M135 33h5M141 33h1M143 33h4M148 33h1M150 33h1M152 33h3M156 33h2M160 33h8M176 33h76M4 34h44M56 34h10M70 34h4M78 34h3M84 34h3M89 34h8M98 34h3M102 34h2M105 34h4M110 34h15M129 34h5M135 34h4M140 34h2M143 34h4M148 34h1M150 34h1M152 34h3M159 34h9M176 34h76M4 35h44M56 35h13M71 35h2M74 35h6M81 35h2M84 35h3M89 35h4M94 35h2M97 35h4M105 35h3M109 35h19M130 35h3M134 35h5M143 35h3M147 35h4M152 35h2M155 35h13M176 35h76M4 36h45M55 36h9M66 36h2M71 36h2M74 36h6M81 36h4M86 36h2M89 36h3M94 36h2M97 36h3M101 36h3M105 36h3M109 36h3M113 36h10M125 36h2M130 36h3M134 36h4M139 36h3M143 36h3M147 36h3M151 36h3M155 36h14M175 36h77M4 37h46M54 37h11M70 37h2M75 37h4M86 37h3M93 37h2M98 37h1M101 37h2M106 37h1M113 37h11M129 37h3M135 37h2M139 37h2M144 37h1M148 37h1M152 37h1M156 37h14M174 37h78M4 38h155M160 38h92M4 39h38M182 39h70M4 40h37M183 40h69M4 41h36M186 41h66M4 42h36M187 42h65M4 43h36M188 43h64M4 44h36M188 44h64M4 45h36M188 45h64M4 46h36M188 46h64M4 47h6M38 47h2M188 47h6M238 47h14M4 48h5M39 48h1M188 48h5M239 48h13M4 49h4M188 49h4M242 49h10M4 50h4M188 50h4M243 50h9M4 51h4M188 51h4M244 51h8M4 52h4M188 52h4M244 52h8M4 53h4M188 53h4M244 53h8M4 54h4M188 54h4M244 54h8M4 55h4M188 55h4M244 55h8M4 56h4M188 56h4M244 56h8M4 57h4M188 57h4M244 57h8M4 58h4M188 58h4M244 58h8M4 59h4M188 59h4M244 59h8M4 60h4M188 60h4M244 60h8M4 61h4M188 61h4M244 61h8M4 62h4M188 62h4M244 62h8M4 63h4M188 63h4M244 63h8M4 64h4M188 64h4M244 64h8M4 65h4M188 65h4M244 65h8M4 66h4M188 66h4M244 66h8M4 67h4M188 67h4M244 67h8M4 68h4M188 68h4M244 68h8M4 69h4M188 69h5M244 69h8M4 70h4M188 70h6M244 70h8M4 71h4M188 71h8M244 71h8M4 72h4M188 72h9M244 72h8M4 73h4M188 73h10M244 73h8M4 74h4M188 74h11M244 74h8M4 75h4M188 75h20M244 75h8M4 76h4M188 76h20M244 76h8M4 77h5M188 77h20M244 77h8M4 78h6M188 78h20M244 78h8M4 79h8M188 79h20M244 79h8M4 80h9M188 80h20M244 80h8M4 81h10M188 81h20M244 81h8M4 82h11M188 82h20M244 82h8M4 83h36M188 83h20M244 83h8M4 84h36M188 84h20M244 84h8M4 85h36M188 85h20M244 85h8M4 86h36M188 86h20M244 86h8M4 87h36M188 87h20M244 87h8M4 88h36M188 88h20M244 88h8M4 89h36M188 89h20M244 89h8M4 90h36M188 90h20M244 90h8M4 91h36M188 91h20M244 91h8M4 92h36M188 92h20M244 92h8M4 93h36M188 93h20M244 93h8M4 94h36M188 94h20M244 94h8M4 95h36M188 95h20M244 95h8M4 96h36M188 96h20M244 96h8M4 97h36M188 97h20M244 97h8M4 98h36M188 98h20M244 98h8M4 99h36M188 99h20M244 99h8M4 100h36M188 100h20M244 100h8M4 101h36M188 101h20M244 101h8M4 102h36M188 102h20M244 102h8M4 103h36M188 103h20M244 103h8M4 104h36M188 104h20M244 104h8M4 105h36M188 105h20M244 105h8M4 106h36M188 106h20M244 106h8M4 107h36M188 107h20M244 107h8M4 108h36M188 108h20M244 108h8M4 109h36M188 109h21M244 109h8M4 110h36M188 110h22M244 110h8M4 111h36M188 111h24M244 111h8M4 112h36M188 112h25M244 112h8M4 113h36M188 113h26M243 113h9M4 114h36M188 114h27M242 114h10M4 115h36M188 115h64M4 116h36M188 116h64M4 117h36M188 117h64M4 118h36M188 118h64M4 119h36M188 119h6M238 119h14M4 120h36M188 120h5M239 120h13M4 121h36M188 121h4M242 121h10M4 122h36M188 122h4M243 122h9M4 123h36M188 123h4M244 123h8M4 124h36M188 124h4M244 124h8M4 125h36M188 125h4M244 125h8M4 126h36M188 126h4M244 126h8M4 127h36M188 127h4M244 127h8M4 128h36M188 128h4M244 128h8M4 129h36M188 129h4M244 129h8M4 130h36M188 130h4M244 130h8M4 131h36M188 131h4M244 131h8M4 132h36M188 132h4M244 132h8M4 133h36M188 133h4M244 133h8M4 134h36M188 134h4M244 134h8M4 135h36M188 135h4M244 135h8M4 136h4M36 136h4M188 136h4M244 136h8M4 137h3M37 137h3M188 137h4M244 137h8M4 138h2M38 138h2M188 138h4M244 138h8M4 139h2M38 139h2M188 139h4M244 139h8M4 140h2M38 140h2M188 140h4M244 140h8M4 141h2M38 141h2M188 141h5M244 141h8M4 142h2M38 142h2M188 142h6M244 142h8M4 143h2M38 143h2M188 143h8M244 143h8M4 144h2M39 144h1M188 144h9M244 144h8M4 145h2M188 145h10M244 145h8M4 146h2M188 146h11M244 146h8M4 147h2M188 147h20M244 147h8M4 148h2M188 148h20M244 148h8M4 149h3M188 149h20M244 149h8M4 150h4M39 150h1M188 150h20M244 150h8M4 151h5M38 151h2M188 151h20M244 151h8M4 152h36M188 152h20M244 152h8M4 153h36M188 153h20M244 153h8M4 154h36M188 154h20M244 154h8M4 155h36M188 155h20M244 155h8M4 156h36M188 156h20M244 156h8M4 157h36M188 157h20M244 157h8M4 158h36M188 158h20M244 158h8M4 159h36M188 159h20M244 159h8M4 160h36M188 160h20M244 160h8M4 161h36M188 161h20M244 161h8M4 162h36M188 162h20M244 162h8M4 163h36M188 163h20M244 163h8M4 164h36M188 164h20M244 164h8M4 165h36M188 165h20M244 165h8M4 166h36M188 166h20M244 166h8M4 167h36M188 167h20M244 167h8M4 168h36M188 168h20M244 168h8M4 169h36M188 169h20M244 169h8M4 170h36M188 170h20M244 170h8M4 171h36M188 171h20M244 171h8M4 172h36M188 172h20M244 172h8M4 173h36M188 173h20M244 173h8M4 174h36M188 174h20M244 174h8M4 175h36M188 175h20M244 175h8M4 176h36M188 176h20M244 176h8M4 177h36M188 177h20M244 177h8M4 178h36M188 178h20M244 178h8M4 179h36M188 179h20M244 179h8M4 180h36M188 180h20M244 180h8M4 181h37M188 181h21M244 181h8M4 182h38M188 182h22M244 182h8M4 183h40M188 183h24M244 183h8M4 184h41M188 184h25M244 184h8M4 185h42M187 185h27M243 185h9M4 186h43M186 186h29M242 186h10M4 187h248M4 188h248M4 189h248M4 190h248M4 191h248M4 192h248M4 193h248M4 194h248M31 200h210M31 201h210M31 202h210M31 203h185M230 203h11M31 204h185M230 204h11M31 205h185M232 205h9M31 206h185M232 206h9M31 207h185M232 207h9M31 208h185M232 208h9M31 209h185M232 209h9M31 210h185M232 210h9M31 211h185M232 211h9M31 212h185M232 212h9M31 213h185M232 213h9M31 214h185M232 214h9M31 215h185M232 215h9M31 216h185M232 216h9M31 217h185M232 217h9M31 218h187M232 218h9M31 219h187M232 219h9M31 220h210M31 221h210M31 222h210&quot;]\n    [&quot;#f80080&quot; &quot;M125 31h4M131 31h7M142 31h2M146 31h2M151 31h2M154 31h5M124 32h2M128 32h2M131 32h1M134 32h1M137 32h1M141 32h2M147 32h2M150 32h2M155 32h1M159 32h1M124 33h1M134 33h1M140 33h1M142 33h1M147 33h1M149 33h1M151 33h1M155 33h1M158 33h2M125 34h4M134 34h1M139 34h1M142 34h1M147 34h1M149 34h1M151 34h1M155 34h4M128 35h2M133 35h1M139 35h4M146 35h1M151 35h1M154 35h1M123 36h2M127 36h3M133 36h1M138 36h1M142 36h1M146 36h1M150 36h1M154 36h1M124 37h5M132 37h3M137 37h2M141 37h3M145 37h3M149 37h3M153 37h3&quot;]\n    [&quot;#f8f800&quot; &quot;M50 32h4M170 32h4M49 33h1M51 33h2M54 33h1M169 33h1M171 33h2M174 33h1M49 34h6M169 34h6M49 35h1M51 35h2M54 35h1M169 35h1M171 35h2M174 35h1M50 36h1M53 36h1M170 36h1M173 36h1&quot;]\n    [&quot;#f0f0f0&quot; &quot;M159 38h1M16 55h16M16 56h16M16 57h16M16 58h16M16 59h16M16 60h16M16 61h16M16 62h16M16 63h16M16 64h16M16 65h16M16 66h16M16 67h16M16 68h16M16 69h16M16 70h16M0 223h256&quot;]\n    [&quot;#a8a8a8&quot; &quot;M43 40h137M42 41h1M180 41h1M41 42h1M181 42h1M184 42h1M41 43h1M46 43h132M181 43h1M184 43h2M41 44h1M45 44h1M178 44h1M181 44h1M185 44h2M41 45h1M44 45h1M179 45h1M181 45h1M186 45h1M41 46h1M44 46h1M179 46h1M181 46h1M186 46h1M41 47h1M44 47h1M179 47h1M181 47h1M186 47h1M11 48h25M41 48h1M44 48h1M179 48h1M181 48h1M186 48h1M195 48h41M10 49h1M36 49h1M41 49h1M44 49h1M179 49h1M181 49h1M186 49h1M194 49h1M236 49h1M9 50h1M37 50h1M41 50h1M44 50h1M179 50h1M181 50h1M186 50h1M193 50h1M237 50h1M240 50h1M9 51h1M14 51h20M37 51h1M41 51h1M44 51h1M179 51h1M181 51h1M186 51h1M193 51h1M198 51h36M237 51h1M240 51h2M9 52h1M13 52h1M34 52h1M37 52h1M41 52h1M44 52h1M179 52h1M181 52h1M186 52h1M193 52h1M197 52h1M234 52h1M237 52h1M241 52h2M9 53h1M12 53h1M35 53h1M37 53h1M41 53h1M44 53h1M179 53h1M181 53h1M186 53h1M193 53h1M196 53h1M235 53h1M237 53h1M242 53h1M9 54h1M12 54h1M35 54h1M37 54h1M41 54h1M44 54h1M179 54h1M181 54h1M186 54h1M193 54h1M196 54h1M235 54h1M237 54h1M242 54h1M9 55h1M12 55h1M35 55h1M37 55h1M41 55h1M44 55h1M179 55h1M181 55h1M186 55h1M193 55h1M196 55h1M235 55h1M237 55h1M242 55h1M9 56h1M12 56h1M35 56h1M37 56h1M41 56h1M44 56h1M179 56h1M181 56h1M186 56h1M193 56h1M196 56h1M235 56h1M237 56h1M242 56h1M9 57h1M12 57h1M35 57h1M37 57h1M41 57h1M44 57h1M179 57h1M181 57h1M186 57h1M193 57h1M196 57h1M235 57h1M237 57h1M242 57h1M9 58h1M12 58h1M35 58h1M37 58h1M41 58h1M44 58h1M179 58h1M181 58h1M186 58h1M193 58h1M196 58h1M235 58h1M237 58h1M242 58h1M9 59h1M12 59h1M35 59h1M37 59h1M41 59h1M44 59h1M179 59h1M181 59h1M186 59h1M193 59h1M196 59h1M235 59h1M237 59h1M242 59h1M9 60h1M12 60h1M35 60h1M37 60h1M41 60h1M44 60h1M179 60h1M181 60h1M186 60h1M193 60h1M196 60h1M235 60h1M237 60h1M242 60h1M9 61h1M12 61h1M35 61h1M37 61h1M41 61h1M44 61h1M179 61h1M181 61h1M186 61h1M193 61h1M196 61h1M235 61h1M237 61h1M242 61h1M9 62h1M12 62h1M35 62h1M37 62h1M41 62h1M44 62h1M179 62h1M181 62h1M186 62h1M193 62h1M196 62h1M235 62h1M237 62h1M242 62h1M9 63h1M12 63h1M35 63h1M37 63h1M41 63h1M44 63h1M179 63h1M181 63h1M186 63h1M193 63h1M196 63h1M235 63h1M237 63h1M242 63h1M9 64h1M12 64h1M35 64h1M37 64h1M41 64h1M44 64h1M179 64h1M181 64h1M186 64h1M193 64h1M196 64h1M235 64h1M237 64h1M242 64h1M9 65h1M12 65h1M35 65h1M37 65h1M41 65h1M44 65h1M179 65h1M181 65h1M186 65h1M193 65h1M197 65h1M234 65h1M237 65h1M242 65h1M9 66h1M12 66h1M35 66h1M37 66h1M41 66h1M44 66h1M179 66h1M181 66h1M186 66h1M193 66h1M237 66h1M242 66h1M9 67h1M12 67h1M35 67h1M37 67h1M41 67h1M44 67h1M179 67h1M181 67h1M186 67h1M193 67h2M236 67h1M242 67h1M9 68h1M12 68h1M35 68h1M37 68h1M41 68h1M44 68h1M179 68h1M181 68h1M186 68h1M194 68h42M242 68h1M9 69h1M12 69h1M35 69h1M37 69h1M41 69h1M44 69h1M179 69h1M181 69h1M186 69h1M242 69h1M9 70h1M12 70h1M35 70h1M37 70h1M41 70h1M44 70h1M179 70h1M181 70h1M186 70h1M242 70h1M9 71h1M12 71h1M35 71h1M37 71h1M41 71h1M44 71h1M179 71h1M181 71h1M186 71h1M197 71h1M242 71h1M9 72h1M12 72h1M35 72h1M37 72h1M41 72h1M44 72h1M179 72h1M181 72h1M186 72h1M198 72h1M211 72h25M242 72h1M9 73h1M13 73h1M34 73h1M37 73h1M41 73h1M44 73h1M179 73h1M181 73h1M186 73h1M199 73h9M210 73h1M236 73h1M242 73h1M9 74h1M37 74h1M41 74h1M44 74h1M179 74h1M181 74h1M186 74h1M209 74h1M237 74h1M242 74h1M9 75h2M36 75h1M41 75h1M44 75h1M179 75h1M181 75h1M186 75h1M209 75h1M214 75h20M237 75h1M242 75h1M10 76h26M41 76h1M44 76h1M179 76h1M181 76h1M186 76h1M209 76h1M213 76h1M234 76h1M237 76h1M242 76h1M41 77h1M44 77h1M179 77h1M181 77h1M186 77h1M209 77h1M212 77h1M235 77h1M237 77h1M242 77h1M41 78h1M44 78h1M179 78h1M181 78h1M186 78h1M209 78h1M212 78h1M233 78h1M235 78h1M237 78h1M242 78h1M13 79h1M41 79h1M44 79h1M179 79h1M181 79h1M186 79h1M209 79h1M212 79h1M233 79h1M235 79h1M237 79h1M242 79h1M14 80h1M41 80h1M44 80h1M179 80h1M181 80h1M186 80h1M209 80h1M212 80h1M233 80h1M235 80h1M237 80h1M242 80h1M15 81h25M41 81h1M44 81h1M179 81h1M181 81h1M186 81h1M209 81h1M212 81h1M233 81h1M235 81h1M237 81h1M242 81h1M41 82h1M44 82h1M179 82h1M181 82h1M186 82h1M209 82h1M212 82h1M233 82h1M235 82h1M237 82h1M242 82h1M41 83h1M44 83h1M179 83h1M181 83h1M186 83h1M209 83h1M212 83h1M233 83h1M235 83h1M237 83h1M242 83h1M41 84h1M44 84h1M179 84h1M181 84h1M186 84h1M209 84h1M212 84h1M233 84h1M235 84h1M237 84h1M242 84h1M41 85h1M44 85h1M179 85h1M181 85h1M186 85h1M209 85h1M212 85h1M233 85h1M235 85h1M237 85h1M242 85h1M41 86h1M44 86h1M179 86h1M181 86h1M186 86h1M209 86h1M212 86h1M233 86h1M235 86h1M237 86h1M242 86h1M41 87h1M44 87h1M179 87h1M181 87h1M186 87h1M209 87h1M212 87h1M233 87h1M235 87h1M237 87h1M242 87h1M41 88h1M44 88h1M179 88h1M181 88h1M186 88h1M209 88h1M212 88h1M233 88h1M235 88h1M237 88h1M242 88h1M41 89h1M44 89h1M179 89h1M181 89h1M186 89h1M209 89h1M212 89h1M233 89h1M235 89h1M237 89h1M242 89h1M41 90h1M44 90h1M179 90h1M181 90h1M186 90h1M209 90h1M212 90h1M233 90h1M235 90h1M237 90h1M242 90h1M41 91h1M44 91h1M179 91h1M181 91h1M186 91h1M209 91h1M212 91h1M233 91h1M235 91h1M237 91h1M242 91h1M41 92h1M44 92h1M179 92h1M181 92h1M186 92h1M209 92h1M212 92h1M233 92h1M235 92h1M237 92h1M242 92h1M41 93h1M44 93h1M179 93h1M181 93h1M186 93h1M209 93h1M212 93h1M233 93h1M235 93h1M237 93h1M242 93h1M41 94h1M44 94h1M179 94h1M181 94h1M186 94h1M209 94h1M212 94h1M233 94h1M235 94h1M237 94h1M242 94h1M41 95h1M44 95h1M179 95h1M181 95h1M186 95h1M209 95h1M212 95h1M233 95h1M235 95h1M237 95h1M242 95h1M41 96h1M44 96h1M179 96h1M181 96h1M186 96h1M209 96h1M212 96h1M233 96h1M235 96h1M237 96h1M242 96h1M41 97h1M44 97h1M179 97h1M181 97h1M186 97h1M209 97h1M212 97h1M233 97h1M235 97h1M237 97h1M242 97h1M41 98h1M44 98h1M179 98h1M181 98h1M186 98h1M209 98h1M212 98h1M233 98h1M235 98h1M237 98h1M242 98h1M41 99h1M44 99h1M179 99h1M181 99h1M186 99h1M209 99h1M212 99h1M233 99h1M235 99h1M237 99h1M242 99h1M41 100h1M44 100h1M179 100h1M181 100h1M186 100h1M209 100h1M212 100h1M233 100h1M235 100h1M237 100h1M242 100h1M41 101h1M44 101h1M179 101h1M181 101h1M186 101h1M209 101h1M212 101h1M233 101h1M235 101h1M237 101h1M242 101h1M41 102h1M44 102h1M179 102h1M181 102h1M186 102h1M209 102h1M212 102h1M233 102h1M235 102h1M237 102h1M242 102h1M41 103h1M44 103h1M179 103h1M181 103h1M186 103h1M209 103h1M212 103h1M233 103h1M235 103h1M237 103h1M242 103h1M41 104h1M44 104h1M179 104h1M181 104h1M186 104h1M209 104h1M212 104h1M215 104h18M235 104h1M237 104h1M242 104h1M41 105h1M44 105h1M179 105h1M181 105h1M186 105h1M209 105h1M213 105h1M234 105h1M237 105h1M242 105h1M41 106h1M44 106h1M179 106h1M181 106h1M186 106h1M209 106h1M237 106h1M242 106h1M41 107h1M44 107h1M179 107h1M181 107h1M186 107h1M209 107h2M236 107h1M242 107h1M41 108h1M44 108h1M179 108h1M181 108h1M186 108h1M210 108h26M242 108h1M41 109h1M44 109h1M179 109h1M181 109h1M186 109h1M242 109h1M41 110h1M44 110h1M179 110h1M181 110h1M186 110h1M242 110h1M41 111h1M44 111h1M179 111h1M181 111h1M186 111h1M213 111h1M241 111h2M41 112h1M44 112h1M179 112h1M181 112h1M186 112h1M214 112h1M240 112h2M41 113h1M44 113h1M179 113h1M181 113h1M186 113h1M215 113h26M41 114h1M44 114h1M179 114h1M181 114h1M186 114h1M41 115h1M44 115h1M179 115h1M181 115h1M186 115h1M41 116h1M44 116h1M179 116h1M181 116h1M186 116h1M41 117h1M44 117h1M179 117h1M181 117h1M186 117h1M41 118h1M44 118h1M179 118h1M181 118h1M186 118h1M41 119h1M44 119h1M179 119h1M181 119h1M186 119h1M41 120h1M44 120h1M179 120h1M181 120h1M186 120h1M195 120h41M41 121h1M44 121h1M179 121h1M181 121h1M186 121h1M194 121h1M236 121h1M41 122h1M44 122h1M179 122h1M181 122h1M186 122h1M193 122h1M237 122h1M240 122h1M41 123h1M44 123h1M179 123h1M181 123h1M186 123h1M193 123h1M198 123h36M237 123h1M240 123h2M41 124h1M44 124h1M179 124h1M181 124h1M186 124h1M193 124h1M197 124h1M234 124h1M237 124h1M241 124h2M41 125h1M44 125h1M179 125h1M181 125h1M186 125h1M193 125h1M196 125h1M235 125h1M237 125h1M242 125h1M41 126h1M44 126h1M179 126h1M181 126h1M186 126h1M193 126h1M196 126h1M235 126h1M237 126h1M242 126h1M41 127h1M44 127h1M179 127h1M181 127h1M186 127h1M193 127h1M196 127h1M235 127h1M237 127h1M242 127h1M41 128h1M44 128h1M179 128h1M181 128h1M186 128h1M193 128h1M196 128h1M235 128h1M237 128h1M242 128h1M41 129h1M44 129h1M179 129h1M181 129h1M186 129h1M193 129h1M196 129h1M235 129h1M237 129h1M242 129h1M41 130h1M44 130h1M179 130h1M181 130h1M186 130h1M193 130h1M196 130h1M235 130h1M237 130h1M242 130h1M41 131h1M44 131h1M179 131h1M181 131h1M186 131h1M193 131h1M196 131h1M235 131h1M237 131h1M242 131h1M41 132h1M44 132h1M179 132h1M181 132h1M186 132h1M193 132h1M196 132h1M235 132h1M237 132h1M242 132h1M41 133h1M44 133h1M179 133h1M181 133h1M186 133h1M193 133h1M196 133h1M235 133h1M237 133h1M242 133h1M41 134h1M44 134h1M179 134h1M181 134h1M186 134h1M193 134h1M196 134h1M235 134h1M237 134h1M242 134h1M41 135h1M44 135h1M179 135h1M181 135h1M186 135h1M193 135h1M196 135h1M235 135h1M237 135h1M242 135h1M41 136h1M44 136h1M179 136h1M181 136h1M186 136h1M193 136h1M196 136h1M235 136h1M237 136h1M242 136h1M41 137h1M44 137h1M179 137h1M181 137h1M186 137h1M193 137h1M197 137h1M234 137h1M237 137h1M242 137h1M41 138h1M44 138h1M179 138h1M181 138h1M186 138h1M193 138h1M237 138h1M242 138h1M41 139h1M44 139h1M179 139h1M181 139h1M186 139h1M193 139h2M236 139h1M242 139h1M41 140h1M44 140h1M179 140h1M181 140h1M186 140h1M194 140h42M242 140h1M41 141h1M44 141h1M179 141h1M181 141h1M186 141h1M242 141h1M41 142h1M44 142h1M179 142h1M181 142h1M186 142h1M242 142h1M41 143h1M44 143h1M179 143h1M181 143h1M186 143h1M197 143h1M242 143h1M41 144h1M44 144h1M179 144h1M181 144h1M186 144h1M198 144h1M211 144h25M242 144h1M41 145h1M44 145h1M179 145h1M181 145h1M186 145h1M199 145h9M210 145h1M236 145h1M242 145h1M41 146h1M44 146h1M179 146h1M181 146h1M186 146h1M209 146h1M237 146h1M242 146h1M41 147h1M44 147h1M179 147h1M181 147h1M186 147h1M209 147h1M214 147h20M237 147h1M242 147h1M41 148h1M44 148h1M179 148h1M181 148h1M186 148h1M209 148h1M213 148h1M234 148h1M237 148h1M242 148h1M41 149h1M44 149h1M179 149h1M181 149h1M186 149h1M209 149h1M212 149h1M235 149h1M237 149h1M242 149h1M41 150h1M44 150h1M179 150h1M181 150h1M186 150h1M209 150h1M212 150h1M233 150h1M235 150h1M237 150h1M242 150h1M41 151h1M44 151h1M179 151h1M181 151h1M186 151h1M209 151h1M212 151h1M233 151h1M235 151h1M237 151h1M242 151h1M41 152h1M44 152h1M179 152h1M181 152h1M186 152h1M209 152h1M212 152h1M233 152h1M235 152h1M237 152h1M242 152h1M41 153h1M44 153h1M179 153h1M181 153h1M186 153h1M209 153h1M212 153h1M233 153h1M235 153h1M237 153h1M242 153h1M41 154h1M44 154h1M179 154h1M181 154h1M186 154h1M209 154h1M212 154h1M233 154h1M235 154h1M237 154h1M242 154h1M41 155h1M44 155h1M179 155h1M181 155h1M186 155h1M209 155h1M212 155h1M233 155h1M235 155h1M237 155h1M242 155h1M41 156h1M44 156h1M179 156h1M181 156h1M186 156h1M209 156h1M212 156h1M233 156h1M235 156h1M237 156h1M242 156h1M41 157h1M44 157h1M179 157h1M181 157h1M186 157h1M209 157h1M212 157h1M233 157h1M235 157h1M237 157h1M242 157h1M41 158h1M44 158h1M179 158h1M181 158h1M186 158h1M209 158h1M212 158h1M233 158h1M235 158h1M237 158h1M242 158h1M41 159h1M44 159h1M179 159h1M181 159h1M186 159h1M209 159h1M212 159h1M233 159h1M235 159h1M237 159h1M242 159h1M41 160h1M44 160h1M179 160h1M181 160h1M186 160h1M209 160h1M212 160h1M233 160h1M235 160h1M237 160h1M242 160h1M41 161h1M44 161h1M179 161h1M181 161h1M186 161h1M209 161h1M212 161h1M233 161h1M235 161h1M237 161h1M242 161h1M41 162h1M44 162h1M179 162h1M181 162h1M186 162h1M209 162h1M212 162h1M233 162h1M235 162h1M237 162h1M242 162h1M41 163h1M44 163h1M179 163h1M181 163h1M186 163h1M209 163h1M212 163h1M233 163h1M235 163h1M237 163h1M242 163h1M41 164h1M44 164h1M179 164h1M181 164h1M186 164h1M209 164h1M212 164h1M233 164h1M235 164h1M237 164h1M242 164h1M41 165h1M44 165h1M179 165h1M181 165h1M186 165h1M209 165h1M212 165h1M233 165h1M235 165h1M237 165h1M242 165h1M41 166h1M44 166h1M179 166h1M181 166h1M186 166h1M209 166h1M212 166h1M233 166h1M235 166h1M237 166h1M242 166h1M41 167h1M44 167h1M179 167h1M181 167h1M186 167h1M209 167h1M212 167h1M233 167h1M235 167h1M237 167h1M242 167h1M41 168h1M44 168h1M179 168h1M181 168h1M186 168h1M209 168h1M212 168h1M233 168h1M235 168h1M237 168h1M242 168h1M41 169h1M44 169h1M179 169h1M181 169h1M186 169h1M209 169h1M212 169h1M233 169h1M235 169h1M237 169h1M242 169h1M41 170h1M44 170h1M179 170h1M181 170h1M186 170h1M209 170h1M212 170h1M233 170h1M235 170h1M237 170h1M242 170h1M41 171h1M44 171h1M179 171h1M181 171h1M186 171h1M209 171h1M212 171h1M233 171h1M235 171h1M237 171h1M242 171h1M41 172h1M44 172h1M179 172h1M181 172h1M186 172h1M209 172h1M212 172h1M233 172h1M235 172h1M237 172h1M242 172h1M41 173h1M44 173h1M179 173h1M181 173h1M186 173h1M209 173h1M212 173h1M233 173h1M235 173h1M237 173h1M242 173h1M41 174h1M44 174h1M179 174h1M181 174h1M186 174h1M209 174h1M212 174h1M233 174h1M235 174h1M237 174h1M242 174h1M41 175h1M44 175h1M179 175h1M181 175h1M186 175h1M209 175h1M212 175h1M233 175h1M235 175h1M237 175h1M242 175h1M41 176h1M44 176h1M179 176h1M181 176h1M186 176h1M209 176h1M212 176h1M215 176h18M235 176h1M237 176h1M242 176h1M41 177h1M45 177h1M178 177h1M181 177h1M186 177h1M209 177h1M213 177h1M234 177h1M237 177h1M242 177h1M41 178h1M181 178h1M186 178h1M209 178h1M237 178h1M242 178h1M41 179h2M180 179h1M186 179h1M209 179h2M236 179h1M242 179h1M42 180h138M186 180h1M210 180h26M242 180h1M186 181h1M242 181h1M186 182h1M242 182h1M45 183h1M185 183h2M213 183h1M241 183h2M46 184h1M184 184h2M214 184h1M240 184h2M47 185h138M215 185h26&quot;]\n    [&quot;#707070&quot; &quot;M180 40h1M181 41h1M182 42h1M182 43h1M182 44h1M184 44h1M182 45h1M184 45h2M182 46h1M184 46h2M182 47h1M184 47h2M36 48h1M182 48h1M184 48h2M236 48h1M37 49h1M182 49h1M184 49h2M237 49h1M38 50h1M182 50h1M184 50h2M238 50h1M38 51h1M182 51h1M184 51h2M238 51h1M38 52h1M182 52h1M184 52h2M238 52h1M240 52h1M38 53h1M182 53h1M184 53h2M238 53h1M240 53h2M38 54h1M182 54h1M184 54h2M238 54h1M240 54h2M38 55h1M182 55h1M184 55h2M238 55h1M240 55h2M38 56h1M182 56h1M184 56h2M238 56h1M240 56h2M38 57h1M182 57h1M184 57h2M238 57h1M240 57h2M38 58h1M182 58h1M184 58h2M238 58h1M240 58h2M38 59h1M182 59h1M184 59h2M238 59h1M240 59h2M38 60h1M182 60h1M184 60h2M238 60h1M240 60h2M38 61h1M182 61h1M184 61h2M238 61h1M240 61h2M38 62h1M182 62h1M184 62h2M238 62h1M240 62h2M38 63h1M182 63h1M184 63h2M238 63h1M240 63h2M38 64h1M182 64h1M184 64h2M238 64h1M240 64h2M38 65h1M182 65h1M184 65h2M238 65h1M240 65h2M38 66h1M182 66h1M184 66h2M238 66h1M240 66h2M38 67h1M182 67h1M184 67h2M237 67h2M240 67h2M38 68h1M182 68h1M184 68h2M236 68h2M240 68h2M38 69h1M182 69h1M184 69h2M195 69h42M240 69h2M38 70h1M182 70h1M184 70h2M240 70h2M38 71h1M182 71h1M184 71h2M198 71h12M240 71h2M38 72h1M182 72h1M184 72h2M199 72h10M236 72h1M240 72h2M38 73h1M182 73h1M184 73h2M237 73h1M240 73h2M38 74h1M182 74h1M184 74h2M238 74h1M240 74h2M37 75h2M182 75h1M184 75h2M238 75h1M240 75h2M36 76h2M182 76h1M184 76h2M238 76h1M240 76h2M11 77h26M39 77h1M182 77h1M184 77h2M215 77h18M238 77h1M240 77h2M38 78h2M182 78h1M184 78h2M214 78h1M238 78h1M240 78h2M14 79h26M182 79h1M184 79h2M214 79h1M238 79h1M240 79h2M15 80h25M182 80h1M184 80h2M214 80h1M238 80h1M240 80h2M182 81h1M184 81h2M214 81h1M238 81h1M240 81h2M182 82h1M184 82h2M214 82h1M238 82h1M240 82h2M182 83h1M184 83h2M214 83h1M238 83h1M240 83h2M182 84h1M184 84h2M214 84h1M238 84h1M240 84h2M182 85h1M184 85h2M214 85h1M238 85h1M240 85h2M182 86h1M184 86h2M214 86h1M238 86h1M240 86h2M182 87h1M184 87h2M214 87h1M238 87h1M240 87h2M182 88h1M184 88h2M214 88h1M238 88h1M240 88h2M182 89h1M184 89h2M214 89h1M238 89h1M240 89h2M182 90h1M184 90h2M214 90h1M238 90h1M240 90h2M182 91h1M184 91h2M214 91h1M238 91h1M240 91h2M182 92h1M184 92h2M214 92h1M238 92h1M240 92h2M182 93h1M184 93h2M214 93h1M238 93h1M240 93h2M182 94h1M184 94h2M214 94h1M238 94h1M240 94h2M182 95h1M184 95h2M214 95h1M238 95h1M240 95h2M182 96h1M184 96h2M214 96h1M238 96h1M240 96h2M182 97h1M184 97h2M214 97h1M238 97h1M240 97h2M182 98h1M184 98h2M214 98h1M238 98h1M240 98h2M182 99h1M184 99h2M214 99h1M238 99h1M240 99h2M182 100h1M184 100h2M214 100h1M238 100h1M240 100h2M182 101h1M184 101h2M214 101h1M238 101h1M240 101h2M182 102h1M184 102h2M214 102h1M238 102h1M240 102h2M182 103h1M184 103h2M214 103h1M238 103h1M240 103h2M182 104h1M184 104h2M238 104h1M240 104h2M182 105h1M184 105h2M238 105h1M240 105h2M182 106h1M184 106h2M238 106h1M240 106h2M182 107h1M184 107h2M237 107h2M240 107h2M182 108h1M184 108h2M236 108h2M240 108h2M182 109h1M184 109h2M211 109h26M239 109h3M182 110h1M184 110h2M238 110h4M182 111h1M184 111h2M214 111h27M182 112h1M184 112h2M215 112h25M182 113h1M184 113h2M182 114h1M184 114h2M182 115h1M184 115h2M182 116h1M184 116h2M182 117h1M184 117h2M182 118h1M184 118h2M182 119h1M184 119h2M182 120h1M184 120h2M236 120h1M182 121h1M184 121h2M237 121h1M182 122h1M184 122h2M238 122h1M182 123h1M184 123h2M238 123h1M182 124h1M184 124h2M238 124h1M240 124h1M182 125h1M184 125h2M238 125h1M240 125h2M182 126h1M184 126h2M238 126h1M240 126h2M182 127h1M184 127h2M238 127h1M240 127h2M182 128h1M184 128h2M238 128h1M240 128h2M182 129h1M184 129h2M238 129h1M240 129h2M182 130h1M184 130h2M238 130h1M240 130h2M182 131h1M184 131h2M238 131h1M240 131h2M182 132h1M184 132h2M238 132h1M240 132h2M182 133h1M184 133h2M238 133h1M240 133h2M182 134h1M184 134h2M238 134h1M240 134h2M182 135h1M184 135h2M238 135h1M240 135h2M182 136h1M184 136h2M238 136h1M240 136h2M182 137h1M184 137h2M238 137h1M240 137h2M182 138h1M184 138h2M238 138h1M240 138h2M182 139h1M184 139h2M237 139h2M240 139h2M182 140h1M184 140h2M236 140h2M240 140h2M182 141h1M184 141h2M195 141h42M240 141h2M182 142h1M184 142h2M240 142h2M182 143h1M184 143h2M198 143h12M240 143h2M182 144h1M184 144h2M199 144h10M236 144h1M240 144h2M182 145h1M184 145h2M237 145h1M240 145h2M182 146h1M184 146h2M238 146h1M240 146h2M182 147h1M184 147h2M238 147h1M240 147h2M182 148h1M184 148h2M238 148h1M240 148h2M182 149h1M184 149h2M215 149h18M238 149h1M240 149h2M182 150h1M184 150h2M214 150h1M238 150h1M240 150h2M182 151h1M184 151h2M214 151h1M238 151h1M240 151h2M182 152h1M184 152h2M214 152h1M238 152h1M240 152h2M182 153h1M184 153h2M214 153h1M238 153h1M240 153h2M182 154h1M184 154h2M214 154h1M238 154h1M240 154h2M182 155h1M184 155h2M214 155h1M238 155h1M240 155h2M182 156h1M184 156h2M214 156h1M238 156h1M240 156h2M182 157h1M184 157h2M214 157h1M238 157h1M240 157h2M182 158h1M184 158h2M214 158h1M238 158h1M240 158h2M182 159h1M184 159h2M214 159h1M238 159h1M240 159h2M182 160h1M184 160h2M214 160h1M238 160h1M240 160h2M182 161h1M184 161h2M214 161h1M238 161h1M240 161h2M182 162h1M184 162h2M214 162h1M238 162h1M240 162h2M182 163h1M184 163h2M214 163h1M238 163h1M240 163h2M182 164h1M184 164h2M214 164h1M238 164h1M240 164h2M182 165h1M184 165h2M214 165h1M238 165h1M240 165h2M182 166h1M184 166h2M214 166h1M238 166h1M240 166h2M182 167h1M184 167h2M214 167h1M238 167h1M240 167h2M182 168h1M184 168h2M214 168h1M238 168h1M240 168h2M182 169h1M184 169h2M214 169h1M238 169h1M240 169h2M182 170h1M184 170h2M214 170h1M238 170h1M240 170h2M182 171h1M184 171h2M214 171h1M238 171h1M240 171h2M182 172h1M184 172h2M214 172h1M238 172h1M240 172h2M182 173h1M184 173h2M214 173h1M238 173h1M240 173h2M182 174h1M184 174h2M214 174h1M238 174h1M240 174h2M182 175h1M184 175h2M214 175h1M238 175h1M240 175h2M182 176h1M184 176h2M238 176h1M240 176h2M182 177h1M184 177h2M238 177h1M240 177h2M182 178h1M184 178h2M238 178h1M240 178h2M181 179h2M184 179h2M237 179h2M240 179h2M180 180h2M184 180h2M236 180h2M240 180h2M43 181h138M183 181h3M211 181h26M239 181h3M182 182h4M238 182h4M46 183h139M214 183h27M47 184h137M215 184h25&quot;]\n    [&quot;#d0d0d0&quot; &quot;M43 41h137M184 41h2M42 42h2M179 42h2M185 42h2M42 43h1M45 43h1M178 43h1M180 43h1M186 43h2M42 44h1M44 44h1M179 44h1M187 44h1M42 45h1M187 45h1M42 46h1M187 46h1M42 47h1M187 47h1M42 48h1M187 48h1M11 49h25M42 49h1M187 49h1M195 49h41M240 49h2M10 50h2M35 50h2M42 50h1M187 50h1M194 50h2M235 50h2M241 50h2M10 51h1M13 51h1M34 51h1M36 51h1M42 51h1M187 51h1M194 51h1M197 51h1M234 51h1M236 51h1M242 51h2M10 52h1M12 52h1M35 52h1M42 52h1M187 52h1M194 52h1M196 52h1M235 52h1M243 52h1M10 53h1M42 53h1M187 53h1M194 53h1M243 53h1M10 54h1M42 54h1M187 54h1M194 54h1M243 54h1M10 55h1M42 55h1M187 55h1M194 55h1M243 55h1M10 56h1M42 56h1M187 56h1M194 56h1M243 56h1M10 57h1M42 57h1M187 57h1M194 57h1M243 57h1M10 58h1M42 58h1M187 58h1M194 58h1M243 58h1M10 59h1M42 59h1M187 59h1M194 59h1M243 59h1M10 60h1M42 60h1M187 60h1M194 60h1M243 60h1M10 61h1M42 61h1M187 61h1M194 61h1M243 61h1M10 62h1M42 62h1M187 62h1M194 62h1M243 62h1M10 63h1M42 63h1M187 63h1M194 63h1M243 63h1M10 64h1M42 64h1M187 64h1M194 64h1M243 64h1M10 65h1M42 65h1M187 65h1M194 65h1M196 65h1M235 65h1M243 65h1M10 66h1M42 66h1M187 66h1M194 66h1M197 66h38M236 66h1M243 66h1M10 67h1M42 67h1M187 67h1M195 67h1M235 67h1M243 67h1M10 68h1M42 68h1M187 68h1M243 68h1M10 69h1M42 69h1M187 69h1M243 69h1M10 70h1M42 70h1M187 70h1M243 70h1M10 71h1M42 71h1M187 71h1M196 71h1M243 71h1M10 72h1M42 72h1M187 72h1M197 72h1M243 72h1M10 73h1M12 73h1M35 73h1M42 73h1M187 73h1M198 73h1M211 73h25M243 73h1M10 74h1M13 74h22M36 74h1M42 74h1M187 74h1M199 74h9M210 74h2M235 74h2M243 74h1M11 75h1M35 75h1M42 75h1M187 75h1M210 75h1M213 75h1M234 75h1M236 75h1M243 75h1M42 76h1M187 76h1M210 76h1M212 76h1M235 76h1M243 76h1M42 77h1M187 77h1M210 77h1M243 77h1M42 78h1M187 78h1M210 78h1M215 78h18M243 78h1M12 79h1M42 79h1M187 79h1M210 79h1M215 79h1M232 79h1M243 79h1M13 80h1M42 80h1M187 80h1M210 80h1M215 80h1M232 80h1M243 80h1M14 81h1M42 81h1M187 81h1M210 81h1M215 81h1M232 81h1M243 81h1M15 82h25M42 82h1M187 82h1M210 82h1M215 82h1M232 82h1M243 82h1M42 83h1M187 83h1M210 83h1M215 83h1M232 83h1M243 83h1M42 84h1M187 84h1M210 84h1M215 84h1M232 84h1M243 84h1M42 85h1M187 85h1M210 85h1M215 85h1M232 85h1M243 85h1M42 86h1M187 86h1M210 86h1M215 86h1M232 86h1M243 86h1M42 87h1M187 87h1M210 87h1M215 87h1M232 87h1M243 87h1M42 88h1M187 88h1M210 88h1M215 88h1M232 88h1M243 88h1M42 89h1M187 89h1M210 89h1M215 89h1M232 89h1M243 89h1M42 90h1M187 90h1M210 90h1M215 90h1M232 90h1M243 90h1M42 91h1M187 91h1M210 91h1M215 91h1M232 91h1M243 91h1M42 92h1M187 92h1M210 92h1M215 92h1M232 92h1M243 92h1M42 93h1M187 93h1M210 93h1M215 93h1M232 93h1M243 93h1M42 94h1M187 94h1M210 94h1M215 94h1M232 94h1M243 94h1M42 95h1M187 95h1M210 95h1M215 95h1M232 95h1M243 95h1M42 96h1M187 96h1M210 96h1M215 96h1M232 96h1M243 96h1M42 97h1M187 97h1M210 97h1M215 97h1M232 97h1M243 97h1M42 98h1M187 98h1M210 98h1M215 98h1M232 98h1M243 98h1M42 99h1M187 99h1M210 99h1M215 99h1M232 99h1M243 99h1M42 100h1M187 100h1M210 100h1M215 100h1M232 100h1M243 100h1M42 101h1M187 101h1M210 101h1M215 101h1M232 101h1M243 101h1M42 102h1M187 102h1M210 102h1M215 102h1M232 102h1M243 102h1M42 103h1M187 103h1M210 103h1M215 103h18M243 103h1M42 104h1M187 104h1M210 104h1M243 104h1M42 105h1M187 105h1M210 105h1M212 105h1M235 105h1M243 105h1M42 106h1M187 106h1M210 106h1M213 106h22M236 106h1M243 106h1M42 107h1M187 107h1M211 107h1M235 107h1M243 107h1M42 108h1M187 108h1M243 108h1M42 109h1M187 109h1M243 109h1M42 110h1M187 110h1M243 110h1M42 111h1M187 111h1M212 111h1M243 111h1M42 112h1M187 112h1M213 112h1M242 112h2M42 113h1M187 113h1M214 113h1M241 113h2M42 114h1M187 114h1M215 114h27M42 115h1M187 115h1M42 116h1M187 116h1M42 117h1M187 117h1M42 118h1M187 118h1M42 119h1M187 119h1M42 120h1M187 120h1M42 121h1M187 121h1M195 121h41M240 121h2M42 122h1M187 122h1M194 122h2M235 122h2M241 122h2M42 123h1M187 123h1M194 123h1M197 123h1M234 123h1M236 123h1M242 123h2M42 124h1M187 124h1M194 124h1M196 124h1M235 124h1M243 124h1M42 125h1M187 125h1M194 125h1M243 125h1M42 126h1M187 126h1M194 126h1M243 126h1M42 127h1M187 127h1M194 127h1M243 127h1M42 128h1M187 128h1M194 128h1M243 128h1M42 129h1M187 129h1M194 129h1M243 129h1M42 130h1M187 130h1M194 130h1M243 130h1M42 131h1M187 131h1M194 131h1M243 131h1M42 132h1M187 132h1M194 132h1M243 132h1M42 133h1M187 133h1M194 133h1M243 133h1M42 134h1M187 134h1M194 134h1M243 134h1M42 135h1M187 135h1M194 135h1M243 135h1M42 136h1M187 136h1M194 136h1M243 136h1M42 137h1M187 137h1M194 137h1M196 137h1M235 137h1M243 137h1M42 138h1M187 138h1M194 138h1M197 138h38M236 138h1M243 138h1M42 139h1M187 139h1M195 139h1M235 139h1M243 139h1M42 140h1M187 140h1M243 140h1M42 141h1M187 141h1M243 141h1M42 142h1M187 142h1M243 142h1M42 143h1M187 143h1M196 143h1M243 143h1M42 144h1M187 144h1M197 144h1M243 144h1M42 145h1M187 145h1M198 145h1M211 145h25M243 145h1M42 146h1M187 146h1M199 146h9M210 146h2M235 146h2M243 146h1M42 147h1M187 147h1M210 147h1M213 147h1M234 147h1M236 147h1M243 147h1M42 148h1M187 148h1M210 148h1M212 148h1M235 148h1M243 148h1M42 149h1M187 149h1M210 149h1M243 149h1M42 150h1M187 150h1M210 150h1M215 150h18M243 150h1M42 151h1M187 151h1M210 151h1M215 151h1M232 151h1M243 151h1M42 152h1M187 152h1M210 152h1M215 152h1M232 152h1M243 152h1M42 153h1M187 153h1M210 153h1M215 153h1M232 153h1M243 153h1M42 154h1M187 154h1M210 154h1M215 154h1M232 154h1M243 154h1M42 155h1M187 155h1M210 155h1M215 155h1M232 155h1M243 155h1M42 156h1M187 156h1M210 156h1M215 156h1M232 156h1M243 156h1M42 157h1M187 157h1M210 157h1M215 157h1M232 157h1M243 157h1M42 158h1M187 158h1M210 158h1M215 158h1M232 158h1M243 158h1M42 159h1M187 159h1M210 159h1M215 159h1M232 159h1M243 159h1M42 160h1M187 160h1M210 160h1M215 160h1M232 160h1M243 160h1M42 161h1M187 161h1M210 161h1M215 161h1M232 161h1M243 161h1M42 162h1M187 162h1M210 162h1M215 162h1M232 162h1M243 162h1M42 163h1M187 163h1M210 163h1M215 163h1M232 163h1M243 163h1M42 164h1M187 164h1M210 164h1M215 164h1M232 164h1M243 164h1M42 165h1M187 165h1M210 165h1M215 165h1M232 165h1M243 165h1M42 166h1M187 166h1M210 166h1M215 166h1M232 166h1M243 166h1M42 167h1M187 167h1M210 167h1M215 167h1M232 167h1M243 167h1M42 168h1M187 168h1M210 168h1M215 168h1M232 168h1M243 168h1M42 169h1M187 169h1M210 169h1M215 169h1M232 169h1M243 169h1M42 170h1M187 170h1M210 170h1M215 170h1M232 170h1M243 170h1M42 171h1M187 171h1M210 171h1M215 171h1M232 171h1M243 171h1M42 172h1M187 172h1M210 172h1M215 172h1M232 172h1M243 172h1M42 173h1M187 173h1M210 173h1M215 173h1M232 173h1M243 173h1M42 174h1M187 174h1M210 174h1M215 174h1M232 174h1M243 174h1M42 175h1M187 175h1M210 175h1M215 175h18M243 175h1M42 176h1M187 176h1M210 176h1M243 176h1M42 177h1M44 177h1M179 177h1M187 177h1M210 177h1M212 177h1M235 177h1M243 177h1M42 178h1M45 178h134M180 178h1M187 178h1M210 178h1M213 178h22M236 178h1M243 178h1M43 179h1M179 179h1M187 179h1M211 179h1M235 179h1M243 179h1M187 180h1M243 180h1M187 181h1M243 181h1M187 182h1M243 182h1M44 183h1M187 183h1M212 183h1M243 183h1M45 184h1M186 184h2M213 184h1M242 184h2M46 185h1M185 185h2M214 185h1M241 185h2M47 186h139M215 186h27&quot;]\n    [&quot;#b8f8f8&quot; &quot;M231 55h1M201 56h5M209 56h3M213 56h2M218 56h1M222 56h1M228 56h3M201 57h4M206 57h5M212 57h1M214 57h2M217 57h3M221 57h3M225 57h6M201 58h5M208 58h2M211 58h3M215 58h1M217 58h3M221 58h3M227 58h4M201 59h7M209 59h1M215 59h2M218 59h1M220 59h4M225 59h6M201 60h3M205 60h3M209 60h1M211 60h3M215 60h2M218 60h1M220 60h4M225 60h2M228 60h3M201 61h3M209 61h1M211 61h3M215 61h3M219 61h4M228 61h3M200 62h1&quot;]\n    [&quot;#4888f8&quot; &quot;M206 56h3M212 56h1M215 56h3M219 56h3M223 56h5M205 57h1M211 57h1M213 57h1M216 57h1M220 57h1M224 57h1M206 58h2M210 58h1M214 58h1M216 58h1M220 58h1M224 58h3M208 59h1M210 59h5M217 59h1M219 59h1M224 59h1M204 60h1M208 60h1M210 60h1M214 60h1M217 60h1M219 60h1M224 60h1M227 60h1M204 61h5M210 61h1M214 61h1M218 61h1M223 61h5&quot;]\n    [&quot;#70a8f8&quot; &quot;M231 56h1M231 57h1M231 58h1M231 59h1M231 60h1M231 61h1M201 62h31&quot;]\n    [&quot;#a0c0b0&quot; &quot;M216 79h16M216 80h6M225 80h7M216 81h4M227 81h5M216 82h3M228 82h4M216 83h3M228 83h4M216 84h2M229 84h3M216 85h2M229 85h3M216 86h2M229 86h3M216 87h3M228 87h4M216 88h3M228 88h4M216 89h3M228 89h4M216 90h3M228 90h4M216 91h3M228 91h4M216 92h3M228 92h4M216 93h3M228 93h4M216 94h3M228 94h4M216 95h3M228 95h4M216 96h3M228 96h4M216 97h3M228 97h4M216 98h3M228 98h4M216 99h3M228 99h4M216 100h3M228 100h4M216 101h4M227 101h5M216 102h5M226 102h6M216 151h16M216 152h6M225 152h7M216 153h4M227 153h5M216 154h3M228 154h4M216 155h3M228 155h4M216 156h2M229 156h3M216 157h2M229 157h3M216 158h2M229 158h3M216 159h3M228 159h4M216 160h3M228 160h4M216 161h3M228 161h4M216 162h3M228 162h4M216 163h3M228 163h4M216 164h3M228 164h4M216 165h3M228 165h4M216 166h3M228 166h4M216 167h3M228 167h4M216 168h3M228 168h4M216 169h3M228 169h4M216 170h3M228 170h4M216 171h3M228 171h4M216 172h3M228 172h4M216 173h4M227 173h5M216 174h5M226 174h6&quot;]\n    [&quot;#808080&quot; &quot;M222 81h3M220 82h2M225 82h2M220 83h1M226 83h1M219 84h1M226 84h2M219 85h1M226 85h2M219 86h1M226 86h2M220 87h1M225 87h2M220 88h7M222 89h3M225 90h2M223 91h1M225 91h2M225 92h2M225 93h2M223 94h1M226 94h1M226 95h1M226 96h1M226 97h1M226 98h1M226 99h1M225 100h2M221 101h5M222 153h3M220 154h2M225 154h2M220 155h1M226 155h1M219 156h1M226 156h2M219 157h1M226 157h2M219 158h1M226 158h2M220 159h1M225 159h2M220 160h7M222 161h3M225 162h2M223 163h1M225 163h2M225 164h2M225 165h2M223 166h1M226 166h1M226 167h1M226 168h1M226 169h1M226 170h1M226 171h1M225 172h2M221 173h5M219 205h1M226 205h1M218 207h1M226 207h2M226 208h1M11 209h1M13 209h2M20 209h1M226 209h1M12 210h1M15 210h1M226 210h1M12 211h1M15 211h1M226 211h1M13 212h2M226 212h1M226 213h1M219 214h1M225 214h2M224 215h2M221 216h1M223 216h2M11 217h1M20 217h1&quot;]\n    [&quot;#c8c8c8&quot; &quot;M222 82h3M225 83h1M220 84h1M225 84h1M220 85h1M225 85h1M220 86h2M224 86h2M221 87h4M223 92h1M225 94h1M225 95h1M225 96h1M225 97h1M225 98h1M225 99h1M221 100h4M222 154h3M225 155h1M220 156h1M225 156h1M220 157h1M225 157h1M220 158h2M224 158h2M221 159h4M223 164h1M225 166h1M225 167h1M225 168h1M225 169h1M225 170h1M225 171h1M221 172h4&quot;]\n    [&quot;#f8b0f8&quot; &quot;M200 127h1M231 127h1M201 128h3M207 128h4M214 128h4M219 128h3M226 128h5M201 129h4M206 129h4M211 129h3M215 129h2M218 129h1M220 129h3M224 129h2M227 129h4M201 130h4M206 130h4M211 130h3M215 130h1M217 130h3M221 130h2M224 130h3M228 130h3M201 131h4M206 131h4M211 131h3M215 131h1M221 131h2M224 131h3M228 131h3M201 132h4M206 132h2M209 132h1M211 132h3M215 132h1M217 132h3M221 132h2M224 132h3M228 132h3M201 133h3M209 133h2M214 133h2M217 133h3M221 133h1M227 133h4M200 134h1M0 200h27M245 200h11M0 201h8M24 201h3M245 201h11M0 202h8M24 202h3M245 202h11M0 203h8M24 203h3M245 203h11M0 204h8M24 204h3M245 204h11M0 205h8M24 205h3M245 205h11M0 206h8M24 206h3M245 206h11M0 207h8M24 207h3M245 207h11M0 208h8M24 208h3M245 208h11M0 209h8M24 209h3M245 209h11M0 210h8M24 210h3M245 210h11M0 211h8M24 211h3M245 211h11M0 212h8M24 212h3M245 212h11M0 213h8M24 213h3M245 213h11M0 214h8M24 214h3M245 214h11M0 215h8M24 215h3M245 215h11M0 216h8M24 216h3M245 216h11M0 217h8M24 217h3M245 217h11M0 218h8M24 218h3M245 218h11M0 219h8M24 219h3M245 219h11M0 220h8M24 220h3M245 220h11M0 221h27M245 221h11M0 222h27M245 222h11&quot;]\n    [&quot;#b028c0&quot; &quot;M204 128h3M211 128h3M218 128h1M222 128h4M205 129h1M210 129h1M214 129h1M217 129h1M219 129h1M223 129h1M226 129h1M205 130h1M210 130h1M214 130h1M216 130h1M220 130h1M223 130h1M227 130h1M205 131h1M210 131h1M214 131h1M216 131h5M223 131h1M227 131h1M205 132h1M208 132h1M210 132h1M214 132h1M216 132h1M220 132h1M223 132h1M227 132h1M204 133h5M211 133h3M216 133h1M220 133h1M222 133h5M231 134h1&quot;]\n    [&quot;#c850c0&quot; &quot;M231 128h1M231 129h1M231 130h1M231 131h1M231 132h1M231 133h1M201 134h30&quot;]\n    [&quot;#a0a080&quot; &quot;M8 136h28M7 137h1M6 138h1M6 139h1M6 140h1M6 141h1M6 142h1M6 143h1M6 144h1M38 144h1M6 145h2M38 145h1M6 146h1M38 146h1M6 147h1M9 147h25M38 147h1M9 148h25M38 148h1M37 149h1M9 150h28&quot;]\n    [&quot;#787868&quot; &quot;M36 137h1M37 138h1M8 146h29M34 147h3M7 148h1M34 148h2M37 148h1M36 149h1&quot;]\n    [&quot;#e0e8c0&quot; &quot;M8 139h1M10 139h2M13 139h1M15 139h4M20 139h4M25 139h3M29 139h1M31 139h3M35 139h2M8 141h1M10 141h4M15 141h4M22 141h2M29 141h1M34 141h3M8 142h1M10 142h4M15 142h4M20 142h4M25 142h3M29 142h1M31 142h2M34 142h3M8 143h1M10 143h2M13 143h1M15 143h4M20 143h4M25 143h3M29 143h1M31 143h3M35 143h2M8 144h1M13 144h1M18 144h1M23 144h1M25 144h3M29 144h1M31 144h3M35 144h1M8 145h27M7 146h1M7 147h1M39 149h1M38 150h1M37 151h1&quot;]\n    [&quot;#c0c8a0&quot; &quot;M39 145h1M39 146h1M8 147h1M39 147h1M6 148h1M8 148h1M39 148h1M7 149h1M38 149h1M8 150h1M37 150h1M9 151h28&quot;]\n    [&quot;#d09048&quot; &quot;M28 200h1M243 200h1M28 201h1M243 201h1M28 202h1M243 202h1M28 203h1M243 203h1M28 204h1M243 204h1M28 205h1M230 205h2M243 205h1M28 206h1M230 206h2M243 206h1M28 207h1M230 207h2M243 207h1M28 208h1M230 208h2M243 208h1M28 209h1M230 209h2M243 209h1M28 210h1M230 210h2M243 210h1M28 211h1M230 211h2M243 211h1M28 212h1M230 212h2M243 212h1M28 213h1M230 213h2M243 213h1M28 214h1M230 214h2M243 214h1M28 215h1M230 215h2M243 215h1M28 216h1M230 216h2M243 216h1M28 217h1M230 217h2M243 217h1M28 218h1M218 218h14M243 218h1M28 219h1M218 219h14M243 219h1M28 220h1M243 220h1M28 221h1M243 221h1M28 222h1M243 222h1&quot;]\n    [&quot;#f8c090&quot; &quot;M29 200h2M241 200h2M29 201h2M241 201h2M29 202h2M241 202h2M29 203h2M241 203h2M29 204h2M241 204h2M29 205h2M241 205h2M29 206h2M241 206h2M29 207h2M241 207h2M29 208h2M241 208h2M29 209h2M241 209h2M29 210h2M241 210h2M29 211h2M241 211h2M29 212h2M241 212h2M29 213h2M241 213h2M29 214h2M241 214h2M29 215h2M241 215h2M29 216h2M241 216h2M29 217h2M241 217h2M29 218h2M241 218h2M29 219h2M241 219h2M29 220h2M241 220h2M29 221h2M241 221h2M29 222h2M241 222h2&quot;]\n    [&quot;#00f800&quot; &quot;M13 203h1M15 203h1M17 203h1M12 205h1M14 205h3M18 205h1M14 206h1M16 206h1M13 207h1M17 207h1&quot;]\n    [&quot;#a0a0b0&quot; &quot;M227 205h1M218 206h1M220 206h1M225 206h1M227 206h1M219 207h1M225 207h1M219 208h1M225 208h1M219 209h1M223 209h1M225 209h1M219 210h1M223 210h3M219 211h1M223 211h3M219 212h1M224 212h2M219 213h1M224 213h2M220 215h1M222 215h2M222 216h1&quot;]]))\n\n(def cell [[&quot;#f0f0f0&quot; &quot;M0 0h7M0 1h7M0 2h2M3 2h1M5 2h2M0 3h3M4 3h3M0 4h2M3 4h1M5 4h2M0 5h7M0 6h7&quot;]\n           [&quot;#808080&quot; &quot;M2 2h1M4 2h1M3 3h1M2 4h1M4 4h1&quot;]])\n\n(def colors [&quot;#f80000&quot; &quot;#f88000&quot; &quot;#f8f800&quot; &quot;#00f800&quot; &quot;#008040&quot; &quot;#00f8f8&quot; &quot;#0000f8&quot; &quot;#c04020&quot; &quot;#806000&quot; &quot;#f8c080&quot; &quot;#c000c0&quot; &quot;#000000&quot; &quot;#808080&quot; &quot;#c0c0c0&quot; &quot;#f8f8f8&quot; &quot;#ebebeb&quot;])\n\n(defn color [n]\n  [[&quot;#000000&quot; &quot;M5 0h3M3 1h2M8 1h2M2 2h1M10 2h1M1 3h1M11 3h1M1 4h1M11 4h1M0 5h1M12 5h1M0 6h1M12 6h1M0 7h1M12 7h1M1 8h1M11 8h1M1 9h1M11 9h1M2 10h1M10 10h1M3 11h2M8 11h3M5 12h5&quot;]\n   [(get colors n) &quot;M5 1h3M3 2h7M2 3h9M2 4h2M6 4h5M1 5h3M6 5h5M1 6h10M1 7h10M2 8h8M2 9h8M5 10h3&quot;]\n   [&quot;#f8f8f8&quot; &quot;M4 4h2M4 5h2&quot;]\n   [&quot;#808080&quot; &quot;M11 5h1M11 6h1M11 7h1M10 8h1M10 9h1M3 10h2M8 10h2M5 11h3M11 11h1M10 12h3M6 13h5&quot;]])\n\n(def pixels (r/atom {}))\n\n(defn palette []\n  (into [:g]\n        (for [x (range 16)]\n      ^{:key x}\n      (svg-paths {:on-click #(reset! current-color (get colors x))} \n                 (color x) (+ 24 (* 14 x)) 9 1))))\n\n(defn micro-view []\n  (into [:g]\n        (for [[[x y] color] @pixels]\n          [:rect {:width  0.99\n                  :height 1\n                  :fill   color\n                  :x      (+ 16 (* 0.99 x))\n                  :y      (+ 54.5 (* 1 y))}])))\n\n(defn cells []\n  (into [:g]\n        (for [x (range 16)\n          y (range 16)]\n      ^{:key [x y]}\n      (svg-paths {:on-click \n                  #(swap! pixels assoc [x y] @current-color)} \n                 cell (+ 48.5 (* 8 x)) (+ 47.5 (* 8 y)) 1))))\n\n(defn macro-view []\n  (into [:g]\n        (for [[[x y] color] @pixels]\n          [:rect {:width  7\n                  :height 7\n                  :fill   color\n                  :x      (+ 48.5 (* 8 x))\n                  :y      (+ 47 (* 8 y))\n                  :pointer-events &quot;none&quot;}])))\n\n(defn mecca []\n  [:div\n   [:p (str &quot;Color: &quot; @current-color)]\n   [:p (str &quot;Pixels: &quot; @pixels)]\n   [:svg\n    {:width    &quot;100%&quot;\n     :view-box &quot;0 0 256 224&quot;}\n    [background]\n    [palette]\n    [micro-view]\n    [cells]\n    [macro-view]]])\n</code></pre><pre><code>[mecca]\n</code></pre>",
   :direction "ltr"},
  :updated 1575331200000,
  :alternate
  [{:href
    "https://porkostomus.gitlab.io/posts-output/2019-12-03-mecca-paint/",
    :type "text/html"}],
  :title "MECCA Paint",
  :author "These are the Voyages of the Porkostomus",
  :published-str "Mon Dec 02 16:00:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16ece9c7cce:c6ba0:97b0c8f7",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url "https://porkostomus.gitlab.io/img/paint.png",
   :width 1024,
   :height 896,
   :contentType "image/png"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :decorations {:Pocket "https://app.getpocket.com/read/2812292053"},
  :originId
  "https://porkostomus.gitlab.io/posts-output/2019-12-03-mecca-paint/",
  :updateCount 2,
  :commonTopics
  [{:score 0.737,
    :id "nlp/f/topic/1339",
    :salienceLevel "mention",
    :label "lifestyle"}],
  :published 1575331200000,
  :fingerprint "706ff86a",
  :canonicalUrl
  "https://porkostomus.gitlab.io/posts-output/2019-12-03-mecca-paint/"}
 {:engagement 5,
  :unread true,
  :crawled 1575388234964,
  :content
  {:content
   "<div><p><em>This post is part of <a shape=\"rect\" href=\"https://lambdaisland.com/blog/2019-11-25-advent-of-parens\">Advent of Parens\n2019</a>, my attempt to\npublish one blog post a day during the 24 days of the advent.</em></p><p>Ah <code>clojure.core</code>, it’s like an all you can eat hot-pot. Just when you think\nyou’ve scooped up all it has to offer, you discover another small but delicious\ndelicacy floating in the spicy broth.</p><p>In exactly the same way I recently became aware of two functions that until now\nhad only existed on the periphery of my awareness. I’ve since enjoyed using them\non several occasions, and keep finding uses for them.</p><p>These are <code>every-pred</code>, and <code>some-fn</code>. I’ll demonstrate them with an example.\nSay you have a discussion forum. People can be admins or moderators, and besides\ntheir username they can optionally set a nickname.</p><pre><code>(def people [{:name   &quot;Elsie&quot;\n              :admin? true\n              :mod?   true}\n             {:name     &quot;Lin Shiwen&quot;\n              :nickname &quot;Rocky&quot;\n              :mod?     true}])\n</code></pre><p>If you want to grab people’s nickname if they have one, or fall back to their\nregular name otherwise, then this is pretty elegant with <code>some-fn</code>.</p><pre><code>(map (some-fn :nickname :name) people)\n;; => (&quot;Elsie&quot; &quot;Rocky&quot;)\n</code></pre><p>If on the other hand you want to find everyone who’s both an admin and a mod,\nthen you can do so easily with <code>every-pred</code>.</p><pre><code>(filter (every-pred :admin? :mod?) people)\n;; => ({:name &quot;Elsie&quot;, :admin? true, :mod? true})\n</code></pre><p>Clojure has a bunch of functions with <code>every</code> and <code>some</code> in their names, which\ncan be a bit confusing. In <code>some?</code> and <code>some-></code> it refers to a value being\nsomething other than <code>nil</code>, whereas in <code>some</code> and <code>some-fn</code> it means “the first\none that applies”.</p><p>I think this overloading is part of the reason why these two have eluded me so\nlong. Only recently did I have the aha insight that while their names are very\ndifferent they are really each other’s complement. One combines functions with a\nlogical <code>or</code>, the other does so with a logical <code>and</code>.</p><pre><code>(map #(or (:nickname %) (:name %)) people)\n;; => (&quot;Elsie&quot; &quot;Rocky&quot;)\n\n(filter #(and (:admin? %) (:mod? %)) people)\n;; => ({:name &quot;Elsie&quot;, :admin? true, :mod? true})\n</code></pre><p>So next time you find yourself writing an anonymous function like this, consider\nreaching for <code>some-fn</code> or <code>every-pred</code> instead.</p><p>The only difference is that <code>every-pred</code> coerces its result to a boolean, making\nit a little less general purpose. Say we had an <code>every-fn</code> instead, you could\ncombine it with <code>some</code> to get for instance the name of the first admin in the\nlist.</p><pre><code>(some (every-fn :admin? :name) people)\n</code></pre><p>The implementation of <code>every-fn</code> is left as an exercise to the reader. (hint:\nit’s just like <code>every-pred</code>, but without the calls to <code>boolean</code>).</p><p><strong><a shape=\"rect\" href=\"https://clojureverse.org/t/advent-of-parens-2019/5159\">Comment on ClojureVerse</a></strong></p></div>",
   :direction "ltr"},
  :updated 1575385642000,
  :entities
  [{:mentions [{:text "anonymous function"}],
    :id "nlp/f/entity/wd:567612",
    :salienceLevel "about",
    :label "anonymous function"}
   {:mentions [{:text "hot pot"}],
    :id "nlp/f/entity/wd:846849",
    :salienceLevel "about",
    :label "hot pot"}],
  :alternate
  [{:href
    "https://lambdaisland.com/blog/2019-12-03-advent-of-parens-3-some-fn-every-pred",
    :type "text/html"}],
  :title "Advent 2019 part 3, `every-pred` and `some-fn`",
  :author "Arne Brasseur",
  :published-str "Tue Dec 03 07:07:22 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16ecc74c4d4:2b11380:49b12733",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://lambdaisland.com/blog/2019-12-03-advent-of-parens-3-some-fn-every-pred",
  :published 1575385642000,
  :fingerprint "6c0d50c3",
  :canonicalUrl
  "https://lambdaisland.com/blog/2019-12-03-advent-of-parens-3-some-fn-every-pred"}
 {:engagement 4,
  :unread true,
  :crawled 1575358621811,
  :content
  {:content
   "<p><img alt=\"MECCA Music Platform\" src=\"https://porkostomus.gitlab.io/img/mecca.png\"></p><p>It all started from a simple question - &quot;How do I make the computer play a note?&quot; Now this project has expanded and multiplied and taken over my entire life, and I've become determined to develop it into a piece of software worthy of being called a <em>platform</em>.</p><p><a href=\"https://github.com/porkostomus/mecca\">Check out the platform on Github</a></p><h2>A creative platform</h2><p><img alt=\"2d platformer\" src=\"https://porkostomus.gitlab.io/img/platform.png\"></p><p>I did not happen to have this double meaning in mind at the time when I called it a &quot;platform&quot;, but it sure would come in handy. I also don't know if I had ever fully noticed the similarity between the scrolling music editor and 2D side-scroller game mechanics. Mario enters stage left and moves to the center of the screen, at which point the rest of the view begins scrolling instead. This, representing my accidental stumble into game dev, also feeds a little pet theory that this game did that on purpose, as a way to sneakily introduce me to another form of media. Just like it introduced me to the joys of graphical music composition many years ago.</p><p>This is the nature of a creative platform. It is entirely wired to encourage playful exploration. I think we could use some more apps like this.</p><p>I mentioned that this project has multiplied, and indeed, it has splintered off into a suite of companion projects that I intend to cover in the coming weeks:</p><ul><li><a href=\"https://github.com/porkostomus/mecca-pix\">mecca-pix</a> - Tool to convert pixel art to SVG</li><li><a href=\"https://github.com/porkostomus/mecca-roms\">mecca-roms</a> - Inspect image, sound and game data from Nintendo binaries</li><li><a href=\"https://github.com/porkostomus/mecca-midi\">mecca-midi</a> - Clojurescript app for exploring MIDI files</li></ul>",
   :direction "ltr"},
  :updated 1575244800000,
  :entities
  [{:mentions [{:text "music composition"}],
    :id "nlp/f/entity/wd:207628",
    :salienceLevel "about",
    :label "musical composition"}
   {:mentions [{:text "Nintendo"}],
    :id "nlp/f/entity/wd:8093",
    :salienceLevel "about",
    :label "Nintendo"}
   {:mentions [{:text "pixel art"}],
    :id "nlp/f/entity/wd:1135821",
    :salienceLevel "about",
    :label "pixel art"}],
  :alternate
  [{:href
    "https://porkostomus.gitlab.io/posts-output/2019-12-02-mecca-platform/",
    :type "text/html"}],
  :title "The MECCA Platform",
  :author "These are the Voyages of the Porkostomus",
  :published-str "Sun Dec 01 16:00:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16ecab0e873:27dc7cb:69b9f616",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url "https://porkostomus.gitlab.io/img/mecca.png",
   :width 640,
   :height 640,
   :contentType "image/png"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://porkostomus.gitlab.io/posts-output/2019-12-02-mecca-platform/",
  :commonTopics
  [{:score 23.604256718489637,
    :id "nlp/f/topic/3029",
    :salienceLevel "about",
    :label "games"}
   {:score 0.734,
    :id "nlp/f/topic/750",
    :salienceLevel "mention",
    :label "electronics"}],
  :published 1575244800000,
  :fingerprint "8f605cdb",
  :canonicalUrl
  "https://porkostomus.gitlab.io/posts-output/2019-12-02-mecca-platform/"}
 {:engagement 5,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1575301464552,
  :content
  {:content
   "<div><p><em>This post is part of <a shape=\"rect\" href=\"https://lambdaisland.com/blog/2019-11-25-advent-of-parens\">Advent of Parens\n2019</a>, my attempt to\npublish one blog post a day during the 24 days of the advent.</em></p><p>Part of what I want to do in this series is simply point at some of the useful\ntools and libraries I discovered in the past year. I’ve adopted a few tools for\ndoing network stuff on the command line which I’ll show you in another post.\nFirst though we’ll look at a classic: netcat!</p><p>I’ve been using netcat for years, it’s such a great tool. It simply sets up a\nTCP connection and connects it to STDIN/STDOUT. Pretty straightforward. I’ve\nbeen using it more and more though because of Clojure’s socket REPL.</p><p>You might have to poke around a bit to find out how to install it on your system\nor distribution. Debian/Ubuntu packages it as <code>netcat-openbsd</code>, RHEL has it as\n<code>nmap-ncat</code>. Mac users can <code>brew install netcat</code>. The executable is sometimes\ncalled <code>ncat</code>, but usually you find it as just <code>nc</code>.</p><p>First start a socket REPL by setting the <code>clojure.server.repl</code> Java property.\n(<code>-J</code> passes an option straight through to <code>java</code>, and <code>-D</code> is the java flag to\nset a property).</p><pre><code>clj -J-Dclojure.server.repl='{:port,5555,:accept,clojure.core.server/repl}'\n</code></pre><p>(Note the “commas are whitespace” trick, to prevent the shell from splitting\nthis into multiple arguments. Not really necessary here, but it has served me\nwell for instance in Dockerfiles. Life is too short to mentally process shell\nquoting rules.)</p><p>Now connect to it with <code>nc</code> and you got yourself a REPL!</p><pre><code>nc localhost 5555\n</code></pre><p>Add <code>rlwrap</code> for some readline-based command line editing:</p><pre><code>rlwrap nc localhost 5555\n</code></pre><p>I now by default install <code>rlwrap</code> and <code>nc</code> on servers that I administer, and\nalways start my Clojure processes with a socket REPL on, just in case I need to\nlog in and debug stuff. It’s also neat for sending Clojure commands to a process\nfrom scripts, or from cron. In these cases you should add <code>-N</code> so it closes the\nconnection upon EOF.</p><pre><code>echo '(foo.bar/baz)' | nc -N localhost 5555\n</code></pre><p>Other stuff you can do with netcat: wait until a socket is ready to accept\nconnections. Great in shell scripts if you first start a service, and then want\nto use that service later on.</p><pre><code>while ! nc -z localhost 1234; do sleep 0.5; done\n</code></pre><p>I’ve even used <code>nc</code> with a NULL modem (an ethernet cable with the send/receive\nwires twisted, so you can connect two network interfaces directly), as a cheapo\nway of transferring files. This also works when you’re on the same local\nnetwork.</p><pre><code># on the receiving end, -l for &quot;listen&quot;\n# ifconfig eth0 10.0.0.1\nnc -l 10.0.0.1 9999 > file.txt\n\n# on the sending end\n# ifconfig eth0 10.0.0.2\nnc 10.0.0.1 9999 &lt; file.txt\n</code></pre><p><strong><a shape=\"rect\" href=\"https://clojureverse.org/t/advent-of-parens-2019/5159\">Comment on ClojureVerse</a></strong></p></div>",
   :direction "ltr"},
  :updated 1575299505000,
  :entities
  [{:mentions [{:text "Netcat"}],
    :id "nlp/f/entity/wd:306070",
    :salienceLevel "about",
    :label "Netcat"}
   {:mentions [{:text "REPL"}],
    :id "nlp/f/entity/wd:2032810",
    :salienceLevel "mention",
    :label "Read–eval–print loop"}
   {:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "TCP"}],
    :id "nlp/f/entity/wd:8803",
    :salienceLevel "mention",
    :label "Transmission Control Protocol"}
   {:mentions [{:text "RHEL"}],
    :id "nlp/f/entity/wd:215273",
    :salienceLevel "mention",
    :label "Red Hat Enterprise Linux"}],
  :alternate
  [{:href
    "https://lambdaisland.com/blog/2019-12-02-advent-of-parens-2-netcat",
    :type "text/html"}],
  :title "Advent 2019 part 2, Piping hot network sockets with Netcat",
  :author "Arne Brasseur",
  :published-str "Mon Dec 02 07:11:45 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16ec748c1e8:22b7ef5:97b0c8f7",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://lambdaisland.com/blog/2019-12-02-advent-of-parens-2-netcat",
  :commonTopics
  [{:score 79.59379030929398,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1575299505000,
  :fingerprint "1f753eee",
  :canonicalUrl
  "https://lambdaisland.com/blog/2019-12-02-advent-of-parens-2-netcat"}
 {:engagement 5,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1575286124274,
  :content
  {:content
   "<div>\n<p><em>Issue 354 – December 02, 2019 · <a href=\"https://purelyfunctional.tv/newsletter-archives/\">Archives</a> · <a title=\"Thanks, Jeff!\" href=\"https://purelyfunctional.tv/newsletter/\">Subscribe</a></em></p>\n<h2>Property-Based Testing Course Launch 🚀</h2>\n<p>Folks, if you are reading this, there might just be time to get 50% off of the three Property-Based Testing courses before the price goes up forever.</p>\n<p>I was planning to end the course today, but I didn’t have great descriptions for the courses before (and holidays got in the way), so I’ve decided to extend the sale for a couple more days. Wednesday is the absolute end of this sale.</p>\n<p>The three courses for Property-Based Testing with test.check are:</p>\n<ul>\n<li><a title href=\"https://purelyfunctional.tv/courses/property-based-testing-with-test-check/\">Beginning</a></li>\n<li>learn to let the computer write thousands of tests for you</li>\n<li><a title href=\"https://purelyfunctional.tv/courses/intermediate-property-based-testing-with-test-check/\">Intermediate</a></li>\n<li>gain more confidence in stateful code</li>\n<li><a title href=\"https://purelyfunctional.tv/courses/advanced-property-based-testing-with-test-check/\">Advanced</a></li>\n<li>learn to test the untestable (parallel and distributed systems)</li>\n</ul>\n<p>Each course builds on the last one. Along the way, you learn to build custom generators, test at four different times in development, and how to integrate with Clojure Spec. Wednesday morning I will wake up and double the prices of these courses. Buy now or forever pay more.</p>\n<h2>Clojure Tip 💡</h2>\n<p><em>beware how many threads you start</em></p>\n<p>It’s really easy in Clojure to start new threads. The JVM uses OS threads, so each one you create is about as efficient as a thread could be. However, how many threads can your OS handle?</p>\n<p>A common way to start too many threads is to start a new thread per server request. For example, every time an HTTP request comes in, you spawn a thread to calculate part of the answer. If you get thousands of requests in a short time period, you’ll create thousands of threads all running at the same time.</p>\n<p><strong>Consequences</strong></p>\n<p>The least problematic consequence of creating too many threads is that it throws an <code>OutOfMemory</code> Error. This is meant to be an error that you can’t recover from.</p>\n<p>I’ve also had systems that did worse than this. If you continue to create more threads despite the <code>OutOfMemory</code> error, you can crash your entire operating system, forcing a restart. That has happened to me before, and in fact happened while I was writing this newsletter. </p>\n<pre><code>;; do not run this\n(dotimes [_ 400]\n  (let [p (promise) \n        f (reduce (fn [f _]\n                    (future\n                      @f\n                      (Thread/sleep 100) ;;; @A\n                      @f))\n                  p (range 100))]\n    (deliver p 1)))\n</code></pre>\n<p>In the code above, we’re creating a chain of <code>futures</code> 100 long, each waiting for the next. And we run that 400 times in a loop. Without the <code>(Thread/sleep 100)</code> on the line marked with <code>@A</code>, it runs fine and only a couple hundred threads get created. Normally, <code>futures</code> run in threads from a thread pool, so the threads get reused. But if they take time (like 100 ms), they can’t be reused fast enough, and thousands of threads get created.</p>\n<p>What’s more, the threads are getting created inside of other futures, so the <code>OutOfMemory</code> error is not stopping the outer loop. Threads keep getting created, and the OS decides to clean house. Forced reboot.</p>\n<p>I have also seen it where the threads are created but there are so many most time is spent on scheduling. As far as my code was concerned, nothing was getting done. The threads were blocking and unblocking on each other, and all of that overhead dominated the small amount of work I asked them to do.</p>\n<p><strong>What to use instead</strong></p>\n<p>Just to be clear, futures are okay to use for very short tasks and if they aren’t chained together so much. If they’re chained, you’re blocking one thread waiting for another.</p>\n<p>If you need longer-running things to run in parallel, you should use an <code>ExecutorService</code>. <code>ExecutorService</code>s manage a thread pool and a queue of tasks to feed to the pool. It handles problems like threads dying (by restarting them) and other things you would normally have to handle on your own.</p>\n<p>It’s beyond the scope of this email to explain them, but I have a short tutorial <a title href=\"https://purelyfunctional.tv/guide/clojure-concurrency/#executorservice\">here</a>.</p>\n<p>By using a fixed size thread pool, you can guarantee that all tasks are handled as fast as they could be on your hardware without creating unbounded threads.</p>\n<h2>Awesome book 📖</h2>\n<p><a title href=\"https://www.manning.com/books/elixir-in-action-second-edition?a_aid=lispcast&a_bid=8c7f7de1\"><em>Elixir in Action</em></a> (affiliate link)</p>\n<p>It’s important to learn other languages, and it has been a while for me since I have learned something new. So I read this book about Elixir. The book is excellent and gives a good example of what Elixir and OTP give you to make systems more reliable. I was impressed by what is offered by the Erlang VM as well as with the presentation in the book. It takes a single, simple example and through the chapters makes it more and more robust.</p>\n<h2>First Annual PurelyFunctional.tv Survey! 📋</h2>\n<p>The first annual <a title href=\"https://purelyfunctional.tv/annual-customer-survey/\">PurelyFunctional.tv Survey</a> is still open. Your answer to this quick survey will help me understand how to improve my videos and help you master Clojure faster and more deeply.</p>\n<p>There are only four questions. If you’ve watched any of my video content, please take a few minutes to <a title href=\"https://purelyfunctional.tv/annual-customer-survey/\">fill this out</a>. I appreciate any answer you can give. And a big “thank you” to everyone who has already submitted an answer.</p>\n<p><a title href=\"https://purelyfunctional.tv/annual-customer-survey/\">Fill out the survey</a></p>\n<p>The survey will run until the end of the week.</p>\n<h2>Clojure Tool 🔨</h2>\n<p><a title href=\"https://github.com/helpshift/emacs-up\"><em>emacs-up</em></a></p>\n<p>Emacs requires a bit of setup before it is really competitive as an editor in today’s world. This starter package is minimal but gives you what you need to get started editing Clojure with Emacs. It also has nice installation instructions.</p>\n<h2>Book update 📖</h2>\n<p>I have approved the proofs for <a title href=\"https://lispcast.com/gs\"><em>Grokking Simplicity</em></a> Chapter 5. Expect it out any day now!</p>\n<p>I’m currently working on Chapter 7, which is all about Stratified Design.</p>\n<p>You can <a title href=\"https://lispcast.com/gs\">buy the book</a> and use the coupon code <strong>TSSIMPLICITY</strong> for 50% off.</p>\n<h2>Clojure Challenge 🤔</h2>\n<h3>Last week’s challenge</h3>\n<p>The challenge in <a title href=\"https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-353-tip-string-literals-are-interned/\">Issue 353</a> was to try to improve your editing experience in some way. I didn’t get any submissions, but I hope people did find some improvements.</p>\n<h3>This week’s challenge</h3>\n<p><em>Levenshtein distance</em></p>\n<p>The Levenshtein distance measures the edit distance between two strings. That is, how many one-character changes do you need to make between two strings to turn one into the other. The algorithm has a nice <a title href=\"https://en.wikipedia.org/wiki/Levenshtein_distance\">recursive definition on Wikipedia</a>, which makes it easy to write in Clojure.</p>\n<p>Your goal is to implement the Levenshtein distance as a function of two strings. It should return the edit distance.</p>\n<p>Bonus: use memoization to make it more efficient, or use an iterative method.</p>\n<p>As usual, please reply to this email and let me know what you tried. I’ll collect them up and share them in the next issue. If you don’t want me to share your submission, let me know.</p>\n<p>Rock on!<br>Eric Normand</p>\n</div>\n<p>The post <a rel=\"nofollow\" href=\"https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-354-tip-beware-how-many-threads-you-start/\">PurelyFunctional.tv Newsletter 354: Tip: beware how many threads you start</a> appeared first on <a rel=\"nofollow\" href=\"https://purelyfunctional.tv\">PurelyFunctional.tv</a>.</p>",
   :direction "ltr"},
  :updated 1575284400000,
  :entities
  [{:mentions [{:text "newsletter"}],
    :id "nlp/f/entity/wd:264238",
    :salienceLevel "about",
    :label "newsletter"}
   {:mentions [{:text "Thread"}],
    :id "nlp/f/entity/wd:213092",
    :salienceLevel "mention",
    :label "thread"}
   {:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "Survey"}],
    :id "nlp/f/entity/wd:1144458",
    :salienceLevel "mention",
    :label "archaeological field survey"}
   {:mentions [{:text "Elixir"}],
    :id "nlp/f/entity/wd:5362035",
    :salienceLevel "mention",
    :label "Elixir"}],
  :alternate
  [{:href
    "https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-354-tip-beware-how-many-threads-you-start/",
    :type "text/html"}],
  :title
  "PurelyFunctional.tv Newsletter 354: Tip: beware how many threads you start",
  :author "Eric Normand",
  :published-str "Mon Dec 02 03:00:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16ec65eaef2:220e7b4:49b12733",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :decorations {:Pocket "https://app.getpocket.com/read/2810666516"},
  :originId "https://purelyfunctional.tv/?p=40244",
  :commonTopics
  [{:score 47.313056479819174,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1575284400000,
  :fingerprint "9be85734",
  :canonicalUrl
  "https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-354-tip-beware-how-many-threads-you-start/"}
 {:engagement 6,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1575252063987,
  :recrawled 1575299142490,
  :content
  {:content
   "<p>On a recent project, I was working on an ETL process, where\nthe transform step happened in Clojure. After all of the data\nhad been shaped the way we wanted, we imported the data into a\nPostgresql database. As with our typical pattern, we used the\n<code>clojure.java.jdbc/insert-multi!</code> function to insert rows in batches.\nBut the performance for the database insertion wasn't quite what we\nwere hoping for.</p>\n<p>Although the overhead from <code>org.clojure.jdbc</code> is negligible in most\nscenarios, and certainly in virtually all CRUD-like workflows, it can\nbecome significant with batch insertions at scale: all of the work of\nconverting data types to String-y parameters adds up.</p>\n<p>Having previously used the <code>COPY</code> syntax for importing textual\ndata like CSVs, I found that Postgresql's <code>COPY</code> also has a binary\nvariant that allows direct insertion into tables. Because the binary\non-the-wire representation of Postgresql's data types is virtually\nthe same as the storage representation, there is significantly less\noverhead for importing using <code>COPY ... FROM STDIN WITH BINARY</code>.</p>\n<p>So, there are immediately two benefits to using the binary <code>COPY</code> approach:</p>\n<ol>\n<li>The binary on-the-wire representation weighs less than its textual,\n<code>INSERT</code>-based counterpart.</li>\n<li>The Postgres server has less work to do to extract data from a\nbinary <code>COPY</code> than it does with <code>INSERT</code> statement because the\nbinary representation so closely mirrors the internal storage\nrepresentation.</li>\n</ol>\n<p>There may be other benefits I'm unaware of, but those two things alone\nmade me curious if there was a way to get the <code>COPY</code> goodness with\nidiomatic Clojure.</p>\n<p>Both main postgresql jdbc drivers, <a href=\"https://jdbc.postgresql.org/\">https://jdbc.postgresql.org/</a> and\n<a href=\"https://impossibl.github.io/pgjdbc-ng/\">https://impossibl.github.io/pgjdbc-ng/</a>, support putting a connection\ninto COPY mode, after which data can be streamed into or out of\npostgresql. However, both drivers don't do anything to help you get\nthe data into the raw format that postgresql expects. For the text\n(default) format, that's basically a tab-delimited or CSV payload.</p>\n<p>The binary COPY format, however, is a different beast entirely. Each\npostgresql data type has a very specific binary representation. Again,\nwhile the postgresql jdbc drivers provide a way to stream in or stream\nout COPY data, the data within those streams is left entirely up to\nyou. The best library I found to do this kind of serialization was\n<a href=\"https://github.com/bytefish/PgBulkInsert\">PgBulkInsert</a>, which works with JDBC, but has a very Java-centric\nAPI.</p>\n<p>That's where <a href=\"https://github.com/jgdavey/clj-pgcopy\">clj-pgcopy</a> comes in. It maps common data types to\ntheir binary represenation, with the hope that using the binary COPY\nstyle of importing data is as easy to use as clojure.java.jdbc\nmethods. The primary API of clj-pgcopy is\n<code>clj-pgcopy.core/copy-into!</code>, which aims to be drop-in compatible with\nmost places where <code>clojure.java.jdbc/insert-multi!</code> is being used.</p>\n<h2>Example usage</h2>\n<p>For example, let's say that we have a table of product listings,\nlooking like this:</p>\n<div><pre><code><span>create</span> <span>table</span> <span>inventory</span> <span>(</span>\n  <span>guid</span> <span>uuid</span> <span>primary</span> <span>key</span><span>,</span>\n  <span>created_at</span> <span>timestamptz</span> <span>not</span> <span>null</span><span>,</span>\n  <span>active</span> <span>boolean</span> <span>not</span> <span>null</span> <span>default</span> <span>false</span><span>,</span>\n  <span>price</span> <span>decimal</span><span>(</span><span>8</span><span>,</span><span>2</span><span>)</span><span>,</span>\n  <span>average_rating</span> <span>float4</span>\n<span>)</span><span>;</span>\n</code></pre></div><p>And some data we'd like to import that looks like this:</p>\n<div><pre><code><span>(</span><span>def </span><span>data</span>\n  <span>[</span><span>{</span><span>:guid</span> <span>#</span><span>uuid</span> <span>&quot;d44c2977-0a9f-4d12-88d2-7d85e07ce1e2&quot;</span>,\n    <span>:created_at</span> <span>#</span><span>inst</span> <span>&quot;2019-12-01T23:37:33.701-00:00&quot;</span>,\n    <span>:active</span> <span>true</span>,\n    <span>:price</span> <span>998.49</span><span>M</span>,\n    <span>:average_rating</span> <span>3.3</span><span>}</span>\n   <span>{</span><span>:guid</span> <span>#</span><span>uuid</span> <span>&quot;220603d4-c1b9-4ea4-b5f4-c61a38e9f515&quot;</span>,\n    <span>:created_at</span> <span>#</span><span>inst</span> <span>&quot;2019-12-01T16:22:35.826-00:00&quot;</span>,\n    <span>:active</span> <span>false</span>,\n    <span>:price</span> <span>847.90</span><span>M</span>,\n    <span>:average_rating</span> <span>2.1</span><span>}</span><span>]</span><span>)</span>\n</code></pre></div><p>A typical way to import data with <code>clojure.java.jdbc/insert-multi!</code> would look like this:</p>\n<div><pre><code><span>(</span><span>let </span><span>[</span><span>cols</span> <span>[</span><span>:guid</span> <span>:created_at</span> <span>:active</span> <span>:price</span> <span>:average_rating</span><span>]</span>\n      <span>->tuple</span> <span>(</span><span>apply </span><span>juxt</span> <span>cols</span><span>)</span><span>]</span>\n  <span>(</span><span>jdbc/with-db-connection</span> <span>[</span><span>conn</span> <span>conn-spec</span><span>]</span>\n    <span>(</span><span>jdbc/insert-multi!</span> <span>conn</span> <span>:inventory</span> <span>cols</span> <span>(</span><span>map </span><span>->tuple</span> <span>data</span><span>)</span><span>)</span><span>)</span><span>)</span>\n</code></pre></div><p>To use <code>clj-pgcopy</code>, the only thing that needs to change is adding a\n<code>require</code>, and changing the callsite:</p>\n<div><pre><code><span>(</span><span>require</span> <span>'</span><span>[</span><span>clj-pgcopy.core</span> <span>:as</span> <span>copy</span><span>]</span><span>)</span>\n\n<span>(</span><span>let </span><span>[</span><span>cols</span> <span>[</span><span>:guid</span> <span>:created_at</span> <span>:active</span> <span>:price</span> <span>:average_rating</span><span>]</span>\n      <span>->tuple</span> <span>(</span><span>apply </span><span>juxt</span> <span>cols</span><span>)</span><span>]</span>\n  <span>(</span><span>jdbc/with-db-connection</span> <span>[</span><span>conn</span> <span>conn-spec</span><span>]</span>\n    <span>(</span><span>copy/copy-into!</span> <span>(</span><span>:connection</span> <span>conn</span><span>)</span> <span>:inventory</span> <span>cols</span> <span>(</span><span>map </span><span>->tuple</span> <span>data</span><span>)</span><span>)</span><span>)</span><span>)</span>\n</code></pre></div><p>Please note that <code>copy-into!</code> expects a “raw” JDBC connection, not a\nClojure map wrapping one, like <code>clojure.java.jdbc</code> uses.</p>\n<h2>Performance</h2>\n<p>Using the same table as our above example, I did some non-definitive benchmarking. For most typical use-cases, <code>clj-pgcopy</code> should be a little more than twice as fast as <code>insert-multi</code>:</p>\n<table>\n<thead>\n<tr>\n<th>tuples</th>\n<th>batch size</th>\n<th>insert-multi</th>\n<th>clj-pgcopy</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>10000</td>\n<td>100</td>\n<td>218.4 ms</td>\n<td>107.2 ms</td>\n</tr>\n<tr>\n<td>10000</td>\n<td>500</td>\n<td>205.2 ms</td>\n<td>90.35 ms</td>\n</tr>\n<tr>\n<td>50000</td>\n<td>100</td>\n<td>1.030 sec</td>\n<td>422.3 ms</td>\n</tr>\n<tr>\n<td>50000</td>\n<td>500</td>\n<td>1.272 sec</td>\n<td>382.3 ms</td>\n</tr>\n<tr>\n<td>100000</td>\n<td>100</td>\n<td>2.051 sec</td>\n<td>1.005 sec</td>\n</tr>\n</tbody>\n</table>\n<p>For measurement methodology, or to run your own benchmarks, see the\n<a href=\"https://github.com/jgdavey/clj-pgcopy/blob/master/bench/clj_pgcopy/benchmark.clj\">benchmark</a>\nnamespace of the <a href=\"https://github.com/jgdavey/clj-pgcopy\">clj-pgcopy</a> repository.</p>\n<h2>Type Mappings</h2>\n<p>Out of the box, clj-pgcopy supports many data types, with what I\nconsider reasonable default mappings.</p>\n<h3>Basic type mapping</h3>\n<table>\n<thead>\n<tr>\n<th>JVM type</th>\n<th>Postgres type</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Short</td>\n<td>int2 (aka smallint)</td>\n</tr>\n<tr>\n<td>Integer</td>\n<td>int4 (aka integer)</td>\n</tr>\n<tr>\n<td>Long</td>\n<td>int8 (aka bigint)</td>\n</tr>\n<tr>\n<td>Float</td>\n<td>float4 (aka real)</td>\n</tr>\n<tr>\n<td>Double</td>\n<td>float8 (aka double presicion)</td>\n</tr>\n<tr>\n<td>BigDecimal</td>\n<td>numeric/decimal</td>\n</tr>\n<tr>\n<td>Boolean</td>\n<td>boolean</td>\n</tr>\n<tr>\n<td>String</td>\n<td>text/varchar/char</td>\n</tr>\n<tr>\n<td>java.util.UUID</td>\n<td>uuid</td>\n</tr>\n</tbody>\n</table>\n<h3>Date-related mappings</h3>\n<table>\n<thead>\n<tr>\n<th>JVM type</th>\n<th>Postgres type</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>java.sql.Date</td>\n<td>date</td>\n</tr>\n<tr>\n<td>java.time.LocalDate</td>\n<td>date</td>\n</tr>\n<tr>\n<td>java.util.Date</td>\n<td>timestamp[tz]</td>\n</tr>\n<tr>\n<td>java.sql.Timestamp</td>\n<td>timestamp[tz]</td>\n</tr>\n<tr>\n<td>java.time.Instant</td>\n<td>timestamp[tz]</td>\n</tr>\n<tr>\n<td>java.time.ZonedDateTime</td>\n<td>timestamp[tz]</td>\n</tr>\n<tr>\n<td>java.time.OffsetDatetime</td>\n<td>timestamp[tz]</td>\n</tr>\n<tr>\n<td>org.postgres.util.PGInterval</td>\n<td>interval</td>\n</tr>\n</tbody>\n</table>\n<h3>Geometric mappings</h3>\n<table>\n<thead>\n<tr>\n<th>JVM type</th>\n<th>Postgres type</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>org.postgres.geometric.PGpoint</td>\n<td>point</td>\n</tr>\n<tr>\n<td>org.postgres.geometric.PGline</td>\n<td>line</td>\n</tr>\n<tr>\n<td>org.postgres.geometric.PGpath</td>\n<td>path</td>\n</tr>\n<tr>\n<td>org.postgres.geometric.PGbox</td>\n<td>box</td>\n</tr>\n<tr>\n<td>org.postgres.geometric.PGcircle</td>\n<td>circle</td>\n</tr>\n<tr>\n<td>org.postgres.geometric.PGpolygon</td>\n<td>polygon</td>\n</tr>\n</tbody>\n</table>\n<h3>Arrays</h3>\n<p>Impemented for the following JVM-typed arrays for:</p>\n<table>\n<thead>\n<tr>\n<th>JVM type</th>\n<th>Postgres type</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>int[]</td>\n<td>int4[] (aka integer[])</td>\n</tr>\n<tr>\n<td>long[]</td>\n<td>int8[] (aka bigint[])</td>\n</tr>\n<tr>\n<td>float[]</td>\n<td>float4[] (aka real[])</td>\n</tr>\n<tr>\n<td>double[]</td>\n<td>float8[] (aka double precision[])</td>\n</tr>\n<tr>\n<td>byte[]</td>\n<td>bytea</td>\n</tr>\n<tr>\n<td>String[]</td>\n<td>text[] (or varchar)</td>\n</tr>\n<tr>\n<td>java.util.UUID[]</td>\n<td>uuid[]</td>\n</tr>\n</tbody>\n</table>\n<p>Currently, only 1-dimensional Postgres arrays are supported.</p>\n<h3>jsonb</h3>\n<p>Things that are String-like, or serialized in string form, should work\nusing the String -> text mapping. An exception is the <code>jsonb</code> postgres\ntype, because the binary format requires a version signifier. Wrapping\na JSON string in a <code>clj-pgcopy.core/JsonB</code> handles that.</p>\n<p>Note that this library does not serialize to JSON, it simply wraps a\nvalid JSON string such that it can actually be used.</p>\n<h2>What about my weird type?</h2>\n<p>These type mappings are implented using a clojure protocol, namely\n<code>clj-pgcopy.core/IPGBinaryWrite</code>. In order to add support for another\ntype, just extend that protocol with an implementation. You can and\nshould use the implementation of other types in the library for\nguidance on doing so.</p>\n<h2>Conclusion</h2>\n<p>Go forth and import!</p>",
   :direction "ltr"},
  :updated 1575158400000,
  :entities
  [{:mentions [{:text "PostgreSQL"} {:text "Postgres"}],
    :id "nlp/f/entity/wd:192490",
    :salienceLevel "mention",
    :label "PostgreSQL"}
   {:mentions [{:text "INSERT"}],
    :id "nlp/f/entity/wd:1076017",
    :salienceLevel "mention",
    :label "INSERT"}
   {:mentions [{:text "type"} {:text "data type"}],
    :id "nlp/f/entity/wd:190087",
    :salienceLevel "mention",
    :label "data type"}
   {:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "JDBC"}],
    :id "nlp/f/entity/wd:722772",
    :salienceLevel "mention",
    :label "Java Database Connectivity"}],
  :alternate
  [{:href "https://joshuadavey.com/2019/12/01/introducing-clj-pgcopy/",
    :type "text/html"}],
  :title "Introducting clj-pgcopy",
  :author "Joshua Davey",
  :published-str "Sat Nov 30 16:00:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16ec456f6f3:1efe7ee:97b0c8f7",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://joshuadavey.com/2019/12/01/introducing-clj-pgcopy/",
  :updateCount 1,
  :commonTopics
  [{:score 56.670253332045526,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1575158400000,
  :fingerprint "6bf54a05",
  :canonicalUrl
  "https://joshuadavey.com/2019/12/01/introducing-clj-pgcopy/"}
 {:engagement 4,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1575247744680,
  :recrawled 1575252063987,
  :content
  {:content
   "<p><img alt=\"Advent of Parens 2019 Day 1\" src=\"https://porkostomus.gitlab.io/img/advent.png\"></p><p>Here we go! So much to get around to, so much to catch up on since my last post which was 4 months ago. Last season I was just getting into UI work with Reagent. Then I started making bigger apps with re-frame, and have <a href=\"https://github.com/porkostomus/mecca\">something very exciting</a> to share.</p><p>But first... I have to do a thing for a job interview! It's... </p><p>A twitterbot!</p><p>Which is actually really funny, because readers of this blog may remember that it was actually founded on a <a href=\"https://twitter.com/just_juxt\">very similar project</a>!</p><p>This kind of thing was also given a very nice (and thorough) treatment on the <a href=\"https://clojuredesign.club/\">Functional Design in Clojure</a> podcast.</p><p>Thanks a lot! I learned a whole bunch. My potential employer was likely betting on the applicants not listening to those shows.</p><p>Happy Advent!</p><p>Please check out the blogs of the other participants:</p><p><a href=\"https://lambdaisland.com/blog/2019-11-25-advent-of-parens\">Arne Brasseur</a></p><p><a href=\"https://alexanderoloo.com/\">Alexander Oloo</a></p><p><a href=\"https://practicalli.github.io/blog/\">John Stevenson</a></p>",
   :direction "ltr"},
  :updated 1575158400000,
  :entities
  [{:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "about",
    :label "Clojure"}],
  :alternate
  [{:href
    "https://porkostomus.gitlab.io/posts-output/2019-12-01-advent-of-parens/",
    :type "text/html"}],
  :title "Advent of Parens 2019",
  :author "These are the Voyages of the Porkostomus",
  :published-str "Sat Nov 30 16:00:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16ec4150ea8:1eafa73:97b0c8f7",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url "https://porkostomus.gitlab.io/img/advent.png",
   :width 640,
   :height 640,
   :contentType "image/png"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://porkostomus.gitlab.io/posts-output/2019-12-01-advent-of-parens/",
  :updateCount 1,
  :published 1575158400000,
  :fingerprint "905c9719",
  :canonicalUrl
  "https://porkostomus.gitlab.io/posts-output/2019-12-01-advent-of-parens/"}
 {:engagement 5,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1575239496257,
  :recrawled 1575241651756,
  :content
  {:content
   "<div><p><em>This post is part of <a shape=\"rect\" href=\"https://lambdaisland.com/blog/2019-11-25-advent-of-parens\">Advent of Parens\n2019</a>, my attempt to\npublish one blog post a day during the 24 days of the advent.</em></p><p>An interesting aspect of the Clojure community, for better or for worse, is that\nit forms a kind of linguistic bubble. We use certain words that aren’t\nparticularly common in daily speech, like “accretion”, or use innocuous little\nwords to refer to something very specific. Even a simple word like “simple” is\nno longer that simple.</p><p>We can thank Rich Hickey for this. He seems to care a great deal about language,\nand is very careful in picking the words he uses in his code, documentation, and\nin his talks.</p><p>The word I want to look at today is “reify”. Pronunciation tip: it has three\nsyllables, re-i-fy.</p><p>To reify is to “make something a thing”, it comes from the Latin “res”, meaning\n“thing”. When you reify you have a <em>reification</em> on your hands. It can mean to\nmake something abstract concrete. This is what Clojure’s <code>reify</code> macro does, it\ntakes a Java Interface, and turns it into a concrete object.</p><p>Take for instance the <code>reify</code> macro in Clojure. You pass it an interface name\nand method definitions, and what you get back is a concrete object that\nimplements this interface.</p><pre><code>(let [listener (reify java.awt.event.ActionListener\n                 (actionPerformed [this action-event]\n                   ,,,))]\n  (.addActionListener button listener))\n</code></pre><p>Reify can also mean to make something “first class”, i.e. to take something\nimplicit, and represent it in an explicit way so it can be referred to and\nmanipulated like other parts of the system.</p><p>Most languages have some version of global variables, but Clojure vars are a\nlittle different because they are <em>reified</em>. You can refer to a var itself, pass\nit as an argument or return it from a function.</p><pre><code>(def xxx &quot;foo&quot; 123)\n\n(defn set-doc! [v doc]\n  (alter-meta! v assoc :doc doc))\n\n(set-doc! #'xxx &quot;An important number&quot;)\n\n(:doc (meta #'xxx))\n</code></pre><p>In Datomic transactions are reified. They are represented as entities, you can\nquery them, refer to them, etc.</p><p>Reifying in this sense can be a powerful way to allow for a higher order of\nprogramming. The interceptor queue in Pedestal is a reified execution stack,\nallowing you to inspect and change that stack at runtime.</p><p>And of course when you decomplect you’ll often find that there’s a concept\nwaiting to be reified.</p><p><strong><a shape=\"rect\" href=\"https://clojureverse.org/t/advent-of-parens-2019/5159\">Post your comments on ClojureVerse</a></strong></p></div>",
   :direction "ltr"},
  :updated 1575239192000,
  :entities
  [{:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "about",
    :label "Clojure"}
   {:mentions [{:text "Latin"}],
    :id "nlp/f/entity/wd:397",
    :salienceLevel "mention",
    :label "Latin"}],
  :alternate
  [{:href
    "https://lambdaisland.com/blog/2019-12-01-advent-of-parens-1-clojure-vocab-reify",
    :type "text/html"}],
  :title "Advent 2019 part 1, Clojure Vocab: to Reify",
  :author "Arne Brasseur",
  :published-str "Sun Dec 01 14:26:32 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16ec3973241:1e31b98:97b0c8f7",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://lambdaisland.com/blog/2019-12-01-advent-of-parens-1-clojure-vocab-reify",
  :updateCount 1,
  :commonTopics
  [{:score 34.92394047830523,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1575239192000,
  :fingerprint "5ea1c883",
  :canonicalUrl
  "https://lambdaisland.com/blog/2019-12-01-advent-of-parens-1-clojure-vocab-reify"}
 {:engagement 7,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1575224622195,
  :content
  {:content
   "<p>Code-Golf is the art of writing the shortest program in a given language that\nimplements some given algorithm. It started in the 90’s in the Perl community\nand spread to other languages; there are now languages dedicated to\ncode-golfing and StackExchange has a <a href=\"https://codegolf.stackexchange.com/\">Q&amp;A website</a> for it.</p>\n<p>In 2015, for example, I wrote a blog post showing how to write a <a href=\"https://bfontaine.net/2015/10/29/a-javascript-modules-manager-that-fits-in-a-tweet/\">JavaScript modules manager that fits in 140 chars</a> (the maximum length\nof a tweet at that time).</p>\n<p><a href=\"http://www.4clojure.com/\">4clojure</a> is a well-known website to learn Clojure\nthrough exercises of increasing difficulty, but it has a lesser-known code-golf\nchallenge which you can enable by clicking on “<a href=\"http://www.4clojure.com/league\">Leagues</a>” in the top menu.\nIf you check the code-golf checkbox, you then get a score on each problem that\nis the number of non-whitespace characters of your solution; the smaller the\nbetter.</p>\n<p>The first thing you’ll note when code-golfing is that the reader syntax for\nanonymous functions is a lot shorter than using <code>fn</code>:</p>\n<div><figure><span></span><div><pre><code><span></span><span>; 18 chars</span>\n<span>(</span><span>fn </span><span>[</span><span>a</span> <span>b</span> <span>c</span><span>]</span> <span>(</span><span>* </span><span>(</span><span>+ </span><span>a</span> <span>b</span><span>)</span> <span>c</span><span>))</span>\n\n<span>; 13 chars</span>\n<span>#</span><span>(</span><span>* </span><span>(</span><span>+ </span><span>%1</span> <span>%2</span><span>)</span> <span>%3</span><span>)</span>\n<span>; 12 chars: -1 char because '%' is equivalent to '%1'</span>\n<span>#</span><span>(</span><span>* </span><span>(</span><span>+ </span><span>%</span> <span>%2</span><span>)</span> <span>%3</span><span>)</span>\n</code></pre></div></figure></div>\n<p>Unfortunately you can’t have a reader-syntax function inside another\nreader-syntax one, so you often have to transform the code not to use anonymous\nfunctions.</p>\n<p><code>for</code> is a very powerful tool for that, because it allows you to do the\nequivalent of <code>map</code>, and a lot more, with no function:</p>\n<div><figure><span></span><div><pre><code><span></span><span>; invalid!</span>\n<span>#</span><span>(</span><span>map </span><span>#</span><span>(</span><span>* </span><span>2</span> <span>%</span><span>)</span> <span>%</span><span>)</span>\n\n<span>; 19 chars</span>\n<span>#</span><span>(</span><span>map </span><span>(</span><span>fn </span><span>[</span><span>x</span><span>]</span> <span>(</span><span>* </span><span>2</span> <span>x</span><span>))</span> <span>%</span><span>)</span>\n<span>; 17 chars</span>\n<span>#</span><span>(</span><span>map </span><span>(</span><span>partial * </span><span>2</span><span>)</span> <span>%</span><span>)</span>\n<span>; 15 chars</span>\n<span>#</span><span>(</span><span>for </span><span>[</span><span>x</span> <span>%</span><span>]</span> <span>(</span><span>* </span><span>2</span> <span>x</span><span>))</span>\n\n<span>; Note that for this specific example</span>\n<span>; the best solution uses `map`:</span>\n<span>#</span><span>(</span><span>map + </span><span>%</span> <span>%</span><span>)</span>\n</code></pre></div></figure></div>\n<p>On some problems it can even be shorter than using <code>map</code> + <code>filter</code>:</p>\n<div><figure><span></span><div><pre><code><span></span><span>; 31 chars</span>\n<span>(</span><span>fn </span><span>[</span><span>x</span> <span>a</span><span>]</span>\n  <span>(</span><span>map inc </span><span>(</span><span>filter </span><span>#</span><span>(</span><span>&lt; </span><span>%</span> <span>a</span><span>)</span> <span>x</span><span>)))</span>\n\n<span>; 26 chars</span>\n<span>#</span><span>(</span><span>for </span><span>[</span><span>e</span> <span>x</span> <span>:when</span> <span>(</span><span>&lt; </span><span>e</span> <span>a</span><span>)]</span> <span>(</span><span>inc </span><span>e</span><span>))</span>\n</code></pre></div></figure></div>\n<p>Some core functions are equivalent in some contexts and so the shorter one can\nsubstitute a longer one:</p>\n<div><figure><span></span><div><pre><code><span></span><span>; 18 chars</span>\n<span>#</span><span>(</span><span>filter identity </span><span>%</span><span>)</span>\n<span>; 14 chars</span>\n<span>#</span><span>(</span><span>filter comp </span><span>%</span><span>)</span>\n\n<span>; 6 chars</span>\n<span>(</span><span>inc </span><span>x</span><span>)</span>\n<span>(</span><span>dec </span><span>x</span><span>)</span>\n<span>; 5 chars</span>\n<span>(</span><span>+ </span><span>x</span> <span>1</span><span>)</span>\n<span>(</span><span>- </span><span>x</span> <span>1</span><span>)</span>\n\n<span>; 12 chars</span>\n<span>(</span><span>reduce str </span><span>x</span><span>)</span>\n<span>; 11 chars</span>\n<span>(</span><span>apply str </span><span>x</span><span>)</span>\n\n<span>; 14 chars</span>\n<span>(</span><span>apply concat </span><span>x</span><span>)</span>\n<span>; 13 chars</span>\n<span>(</span><span>mapcat comp </span><span>x</span><span>)</span>\n</code></pre></div></figure></div>\n<p>When you must use a long function name in multiple places, it might be shorter\nto <code>let</code> that function with a one-letter symbol:</p>\n<div><figure><span></span><div><pre><code><span></span><span>; 120 chars</span>\n<span>#</span><span>(</span><span>clojure.set/difference</span>\n   <span>(</span><span>clojure.set/union</span> <span>%</span> <span>%2</span><span>)</span>\n   <span>(</span><span>clojure.set/union</span>\n     <span>(</span><span>clojure.set/difference</span> <span>%</span> <span>%2</span><span>)</span>\n     <span>(</span><span>clojure.set/difference</span> <span>%2</span> <span>%</span><span>)))</span>\n\n<span>; 73 chars</span>\n<span>#</span><span>(</span><span>let </span><span>[</span><span>d</span> <span>clojure.set/difference</span> <span>u</span> <span>clojure.set/union</span><span>]</span>\n   <span>(</span><span>d</span> <span>(</span><span>u</span> <span>%</span> <span>%2</span><span>)</span> <span>(</span><span>u</span> <span>(</span><span>d</span> <span>%</span> <span>%2</span><span>)</span> <span>(</span><span>d</span> <span>%2</span> <span>%</span><span>))))</span>\n\n<span>; Note that for this specific example</span>\n<span>; there is a 17-chars solution</span>\n<span>#</span><span>(</span><span>set </span><span>(</span><span>filter </span><span>%2</span> <span>%</span><span>))</span>\n</code></pre></div></figure></div>\n<h3>Other tricks</h3>\n<p>Use indexed access on vectors:</p>\n<div><figure><span></span><div><pre><code><span></span><span>; 15 chars</span>\n<span>(</span><span>first </span><span>[</span><span>:a</span> <span>:b</span> <span>:c</span><span>])</span>\n<span>; 11 chars</span>\n<span>([</span><span>:a</span> <span>:b</span> <span>:c</span><span>]</span> <span>0</span><span>)</span>\n</code></pre></div></figure></div>\n<p>Use set literals as functions:</p>\n<div><figure><span></span><div><pre><code><span></span><span>; 16 chars</span>\n<span>(</span><span>remove </span><span>#</span><span>(</span><span>= </span><span>:a</span> <span>%</span><span>)</span> <span>x</span><span>)</span>\n<span>; 14 chars</span>\n<span>(</span><span>remove </span><span>#</span><span>{</span><span>:a</span><span>}</span> <span>x</span><span>)</span>\n</code></pre></div></figure></div>\n<p>Inverse conditions to use shorter functions:</p>\n<div><figure><span></span><div><pre><code><span></span><span>; 15 chars</span>\n<span>(</span><span>if </span><span>(</span><span>empty?</span> <span>p</span><span>)</span> <span>a</span> <span>b</span><span>)</span>\n<span>; 12 chars</span>\n<span>(</span><span>if </span><span>(</span><span>seq </span><span>p</span><span>)</span> <span>b</span> <span>a</span><span>)</span>\n</code></pre></div></figure></div>\n<p>Inlined code is sometimes shorter:</p>\n<div><figure><span></span><div><pre><code><span></span><span>; 24 chars</span>\n<span>(</span><span>let </span><span>[</span><span>p</span> <span>(</span><span>* </span><span>3</span> <span>a</span><span>)]</span>\n  <span>(</span><span>if </span><span>(</span><span>&lt; </span><span>p</span> <span>5</span><span>)</span>\n    <span>a</span>\n    <span>p</span><span>))</span>\n<span>; 19 chars</span>\n<span>(</span><span>if </span><span>(</span><span>&lt; </span><span>(</span><span>* </span><span>3</span> <span>a</span><span>)</span> <span>5</span><span>)</span>\n  <span>a</span>\n  <span>(</span><span>* </span><span>3</span> <span>a</span><span>))</span>\n</code></pre></div></figure></div>\n<p>Use <code>1</code> instead of <code>:else</code>/<code>:default</code> in <code>cond</code>:</p>\n<div><figure><span></span><div><pre><code><span></span><span>; 24 chars</span>\n<span>(</span><span>cond</span>\n  <span>(</span><span>= </span><span>m</span> <span>p</span><span>)</span> <span>a</span>\n  <span>(</span><span>&lt; </span><span>m</span> <span>p</span><span>)</span> <span>b</span>\n  <span>:else</span> <span>c</span><span>)</span>\n\n<span>; 20 chars</span>\n<span>(</span><span>cond</span>\n  <span>(</span><span>= </span><span>m</span> <span>p</span><span>)</span> <span>a</span>\n  <span>(</span><span>&lt; </span><span>m</span> <span>p</span><span>)</span> <span>b</span>\n  <span>1</span> <span>c</span><span>)</span>\n</code></pre></div></figure></div>\n<p>Use maps instead of <code>if</code>s for conditions on equality (this one <em>really</em> makes\nthe code harder to read):</p>\n<div><figure><span></span><div><pre><code><span></span><span>; 13 chars</span>\n<span>(</span><span>if </span><span>(</span><span>= </span><span>&quot;L&quot;</span> <span>x</span><span>)</span> <span>a</span> <span>b</span><span>)</span>\n<span>; 12 chars</span>\n<span>(</span><span>case</span> <span>x</span> <span>&quot;L&quot;</span> <span>a</span> <span>b</span><span>)</span>\n<span>; 10 chars</span>\n<span>({</span><span>&quot;L&quot;</span> <span>a</span><span>}</span> <span>x</span> <span>b</span><span>)</span>\n</code></pre></div></figure></div>",
   :direction "ltr"},
  :updated 1575220320000,
  :entities
  [{:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "about",
    :label "Clojure"}
   {:mentions [{:text "Q&A"}],
    :id "nlp/f/entity/wd:189293",
    :salienceLevel "mention",
    :label "FAQ"}
   {:mentions [{:text "StackExchange"}],
    :id "nlp/f/entity/wd:3495447",
    :salienceLevel "mention",
    :label "Stack Exchange"}
   {:mentions [{:text "JavaScript"}],
    :id "nlp/f/entity/wd:2005",
    :salienceLevel "mention",
    :label "JavaScript"}
   {:mentions [{:text "Perl"}],
    :id "nlp/f/entity/wd:42478",
    :salienceLevel "mention",
    :label "Perl"}],
  :alternate
  [{:href
    "https://bfontaine.net/blog/2019/12/01/introduction-to-code-golf-in-clojure/",
    :type "text/html"}],
  :title "Introduction to Code-Golf in Clojure",
  :author "Baptiste Fontaine",
  :published-str "Sun Dec 01 09:12:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16ec2b43c73:1d42650:97b0c8f7",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://bfontaine.net/blog/2019/12/01/introduction-to-code-golf-in-clojure",
  :commonTopics
  [{:score 70.14572326639698,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1575220320000,
  :fingerprint "ed764cd6",
  :canonicalUrl
  "https://bfontaine.net/blog/2019/12/01/introduction-to-code-golf-in-clojure/"}
 {:engagement 5,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1575216328542,
  :recrawled 1575218497632,
  :content
  {:content
   "<p>Recently <a href=\"https://github.com/plexus\">Arne Brasseur</a> shared a pretty cool idea over at <a href=\"https://lambdaisland.com/blog/2019-11-25-advent-of-parens\">Lambda\nIsland</a> - namely to\ndo a blogging alternative to the popular <a href=\"https://adventofcode.com/\">“Advent of Code”</a> this holiday season.\nArne challenged himself to write a blog post every day from the 1st of December to\nthe 24th of December and dubbed this challenge “Advent of Parens 2019”.</p>\n<p>I loved the idea, as I desperately needed some motivation to write more. This year I’ve often\nbeen pondering about the impact that goals are having on our lives and productivity. I even wrote\na little bit on the subject in a <a href=\"http://metaredux.com/posts/2019/10/21/meta-redux-year-one.html\">previous post</a>.\nToday I pledge my intention to take part in Arne’s challenge!\nThis short post serves two purposes - it’s my declaration of participation and it’s also\nmy first entry in the “Meta Advent 2019”.<sup><a href=\"http://metaredux.com/posts/2019/12/01/meta-advent-2019.html#fn:1\">1</a></sup></p>\n<p>I haven’t thought much about the topics I’ll be tackling over the next four\nweeks, but knowing me there will be a healthy amount of Emacs, Clojure and Ruby\narticles in the mix. Unlike Arne, I don’t have any articles that I’ve already\nwritten and are ready for publishing, but I’ve got a huge backlog of ideas and I\nlove to improvise. One topic is clear - I still have to write a summary of the\nresults of <a href=\"http://metaredux.com/posts/2019/11/02/state-of-cider.html\">“The State of CIDER 2019”</a>\nsurvey.</p>\n<p>I was wondering whether I want to do a double challenge and target a blog post per day on\nboth “Meta Redux” and <a href=\"https://metaredux.com\">“Emacs Redux”</a>, but I’ve decided I shouldn’t be overly ambitious with V1.\nMaybe next year… I’m still wondering whether it’d be cheating if I spread those 24 blog posts over the two blogs.\nI guess I’ll figure this out as we go.</p>\n<p>I’d love to see more people joining our little blogging advent. I think this will be a lot of fun!\nThat’s all from me for now. See you tomorrow!</p>\n<div>\n<ol>\n<li>\n<p>I know it feels like cheating, but I’m one lazy scoundrel. <a href=\"http://metaredux.com/posts/2019/12/01/meta-advent-2019.html#fnref:1\">↩</a></p>\n</li>\n</ol>\n</div>",
   :direction "ltr"},
  :updated 1575213600000,
  :entities
  [{:mentions [{:text "Arne"}],
    :id "nlp/f/entity/wd:132276",
    :salienceLevel "about",
    :label "959 Arne"}
   {:mentions [{:text "Lambda Island"}],
    :id "nlp/f/entity/wd:3427832",
    :salienceLevel "mention",
    :label "Lambda Island"}],
  :alternate
  [{:href
    "http://metaredux.com/posts/2019/12/01/meta-advent-2019.html",
    :type "text/html"}],
  :title "Meta Advent 2019",
  :author "Bozhidar Batsov",
  :published-str "Sun Dec 01 07:20:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16ec235af5e:1d1cf67:49b12733",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "http://metaredux.com/posts/2019/12/01/meta-advent-2019",
  :updateCount 1,
  :published 1575213600000,
  :fingerprint "faba9eda",
  :canonicalUrl
  "http://metaredux.com/posts/2019/12/01/meta-advent-2019.html"}
 {:engagement 5,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1575193123187,
  :recrawled 1575214136620,
  :content
  {:content
   "<p>I'd been a professional software developer for a number of years before I came to Clojure. So, it's fair to say that by the time I went all-in on Clojure I had, thankfully, seen some things and started to form opinions around what I felt was the &quot;best&quot; way to practice software development.</p>\n<p>One of the tenets of my model? I should always be capable of growth. To me, this means accepting the opportunity to revisit and refine my <em>opinions</em> and <em>beliefs</em>. One great way to do this as a programmer is to be &quot;new&quot; at something again. For example, learn a <strong>different</strong> programming language. Clojure was that language. I chose it because it would expose me to new ideas like <a href=\"https://www.geeksforgeeks.org/functional-programming-paradigm/\">functional programming</a>, <a href=\"https://en.wikipedia.org/wiki/Lisp_(programming_language)\">lisp</a> etc.</p>\n<p>With the language chosen, I just needed to start coding Clojure. At the time, my mindset was total assimilation: I would <a href=\"https://www.youtube.com/watch?v=f84n5oFoZBc\">think</a> as they do and use the same tools as them. This meant <a href=\"https://www.gnu.org/software/emacs/\">emacs</a> because all my research and conversations up until this point with other Clojurists led me to the opinion that <code>emacs</code> was <em>the</em> tool for a Clojure developer.</p>\n<aside>Take note of the line <code>conversations up until this point with other Clojurists</code>. While &quot;use emacs&quot; is how I interpreted what they were saying, and some even used those very words, it was not actually what they were saying. By the end of this post I will hopefully transcribe the real message as I now understand it.</aside>\n<p>Turns out that for me, choosing <a href=\"https://www.gnu.org/software/emacs/\">emacs</a> was not a great choice (more on that later) and I should have stuck with the editor I knew best. This would have allowed me to spend more time focusing on Clojure.</p>\n<p>This is how it goes though. These are the lessons. It's with this in mind that I will hopefully help the next person interested in Clojure, aspiring or experienced, by walking through some of the Text Editors of Clojure.</p>\n<p>The rest of this article will be <a href=\"https://www.urbandictionary.com/define.php?term=bikeshed\">bikeshed</a> city. The hope? By documenting the thoughts and providing a few words of encouragement we can save some future Clojure developer some time. With that, this post will cover the following topics:</p>\n<ul>\n<li><a href=\"https://betweentwoparens.com/rss.xml#clojure-text-editors\">Clojure Text Editors</a></li>\n<li><a href=\"https://betweentwoparens.com/rss.xml#which-text-editor-to-use\">Which Text Editor to Use</a></li>\n<li><a href=\"https://betweentwoparens.com/rss.xml#my-text-editor-setup\">My Text Editor Setup</a></li>\n</ul>\n<aside>Text Editors are a source of furious debate among programmers. So if the opinions expressed herein enrage, please know that is not my intention. I love you. For those who just want to see how I setup my Text Editor for Clojure development, jump to the <a href=\"https://betweentwoparens.com/rss.xml#my-text-editor-setup\">third section</a> of this post. Also note that my recommendations are for both Clojure and ClojureScript.</aside>\n<h2><a href=\"https://betweentwoparens.com/rss.xml#clojure-text-editors\"></a>Clojure Text Editors</h2>\n<p>Let's start by introducing the top Text Editors for Clojure(Script) development by usage<a href=\"https://betweentwoparens.com/rss.xml#popular-editors\">:</a></p>\n<ol>\n<li><a href=\"https://www.gnu.org/software/emacs/\">Emacs</a></li>\n<li><a href=\"https://www.jetbrains.com/idea/\">IntelliJ</a></li>\n<li><a href=\"https://www.vim.org/\">Vim</a></li>\n<li><a href=\"https://code.visualstudio.com/\">VS code</a></li>\n<li><a href=\"https://atom.io/\">Atom</a></li>\n<li><a href=\"https://www.sublimetext.com/\">Sublime</a></li>\n<li><a href=\"https://www.eclipse.org/downloads/\">Eclipse</a></li>\n<li><a href=\"http://lighttable.com/\">Light Table</a></li>\n</ol>\n<p>There is nothing special about the above list. Yet, where it starts to feel prohibitive is the idea that you have to use one of the first 3 Text Editors in order to be productive in Clojure. So, if you read no further, take this with you: you <strong>don't</strong> need to use Emacs, IntelliJ or Vim to learn or be good at Clojure.</p>\n<p>This leads to the next part: which editor should you use? To answer that, try to answer the following questions:</p>\n<ol>\n<li>Are you an experienced developer through hobby or profession?</li>\n<li>Are you new to the programming game?</li>\n</ol>\n<p>If your answered yes to the <strong>first</strong> question, the choice is simple: Stick with the editor you're comfortable with!</p>\n<p>If you answered yes to the <strong>second</strong> question, my recommendation is to choose <code>Atom</code> or <code>VS Code</code>. Read on to find out why!</p>\n<h2><a href=\"https://betweentwoparens.com/rss.xml#which-text-editor-to-use\"></a>Which Text Editor to Use</h2>\n<p>A Text Editor is one of a developer's primary tools because we spend most of our work life inside of it. Given the time we work with our Text Editors, there is something to be said for the satisfaction we derive from using it.</p>\n<p>Over time, this satisfaction grows and we begin to associate the qualities of the developer with the editor itself. It becomes a <a href=\"https://www.merriam-webster.com/dictionary/zero-sum%20game\">zero sum game</a>.</p>\n<p>There are some obvious problems with this mentality and it begins with the fact that tools are tools. They either help us be productive, or they don't. Further, the productivity one human gains from a tool, the satisfaction as we called it earlier, is likely going to be different from the next person. You do you.</p>\n<p>Knowing this, let's put the cards on the table and review the qualities that allow me to feel satisfied with the Text Editor I choose. I alluded to this earlier, but for me it's mainly how productive I can be in my tool of choice. How I define productivity is by the <code>startup cost</code> and <code>utility</code> of the editor itself. What do each of these mean to me?</p>\n<p><code>Startup cost</code> is about whether or not I can use the editor regardless of my operating system and how much configuration I need to get it going on a new development environment.</p>\n<p><code>Utlity</code> is performance and customizability of the Editor. For performance, I mean that when I do things like search, open large files or use plugins the editor does not eat all of my system resources and grind to a halt. This would be intrusive to my workflow. When it comes to customization, I like it when I can configure my editor easily with languages and tool chains I already know.</p>\n<p>As you may have gathered, my definition of satisfaction has led me to prefer a spartan editor environment. Yet, this is not always how I felt. I only realized this was how I liked to work when I saw truly productive developers operate in environments devoid of frills.</p>\n<p>All of this is to say that this is my preference. This preference is one I have built through years of experimentation and questioning my workflow. If you have been developing for a while, you will also go through this learning process. This is a beautiful part of the journey because it really is about you, your likes and dislikes and how far you want to go.</p>\n<p>And now we're back to the original question about which editor you should use. I said earlier that if you're experience, go with the editor you already know. If you are a new programmer and don't have deep roots with any particular editor, choose <code>Atom</code> or <code>VS Code</code>.</p>\n<p>My rationale? All of these editors are easy to use, work on all operating systems, have active and easy to access communities and support all the modern Clojure tooling one could ever want. But there is also a more significant reason. I have learned that when learning something you should focus on learning that one thing.</p>\n<p>Choosing editors like Emacs, Vim, or Intellij mean you are going to spend more time learning and configuring the editors than programming. It's going to get in the way of the learning journey. So do yourself a favour and focus on learning Clojure. You can always try the other editors when you develop some sensibilities around the workflow you want to pursue. But that is more of an optimization strategy than a tactic which will enable you to improve the learning process.</p>\n<p>Knowing this, lets move onto how I setup Atom for my development workflow.</p>\n<h2><a href=\"https://betweentwoparens.com/rss.xml#my-text-editor-setup\"></a>My Text Editor Setup</h2>\n<p>The beauty of editors like <code>Atom</code> or <code>VS Code</code> is you get most everything you need out-of-the-box. Here are the plugins I use:</p>\n<ul>\n<li>\n<p><a href=\"https://atom.io/packages/chlorine\">Chlorine</a></p>\n<p>Integrate your Clojure REPL into your editor.</p>\n</li>\n<li>\n<p><a href=\"https://atom.io/packages/ink\">Ink</a></p>\n<p>Chlorine depends on this.</p>\n</li>\n<li>\n<p><a href=\"https://atom.io/packages/parinfer\">Parinfer</a></p>\n<p>Automatically balance your parens</p>\n</li>\n<li>\n<p><a href=\"https://github.com/tkjone/dotfiles/blob/master/atom/keymap.cson#L34\">Chlorine Keybinding Setup</a></p>\n<p>Learn the hotkeys to quickly connect to a Clojure repl and evaluate Clojure expressions</p>\n</li>\n</ul>\n<p>That's everything that I use.</p>\n<h2><a href=\"https://betweentwoparens.com/rss.xml#conclusion\"></a>Conclusion</h2>\n<p>In the end, I hope I have helped to illuminate the options available for Clojure Text Editors. The big take away is to be good to yourself in your early learning journey and choose a tool that does not get in your way and just lets you focus on learning Clojure.</p>\n<aside>\n<h3>Footnotes</h3>\n<ol>\n<li>\nThis list is based on the <a rel=\"noopener noreferrer\" href=\"https://www.surveymonkey.com/results/SM-S9JVNXNQV/\" target=\"_blank\">2019 State of Clojure Survey</a> conducted earlier this year.\n<a href=\"https://betweentwoparens.com/rss.xml#popular-editors-ref\">↩</a>\n</li>\n</ol>\n</aside>",
   :direction "ltr"},
  :updated 1575072000000,
  :entities
  [{:mentions [{:text "editor"} {:text "Text editor"}],
    :id "nlp/f/entity/wd:131212",
    :salienceLevel "about",
    :label "Text editor"}
   {:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "about",
    :label "Clojure"}
   {:mentions [{:text "Emacs"}],
    :id "nlp/f/entity/wd:189722",
    :salienceLevel "mention",
    :label "Emacs"}
   {:mentions [{:text "software developer"}],
    :id "nlp/f/entity/wd:183888",
    :salienceLevel "mention",
    :label "software developer"}
   {:mentions [{:text "VS Code"}],
    :id "nlp/f/entity/wd:19841877",
    :salienceLevel "mention",
    :label "Visual Studio Code"}],
  :alternate
  [{:href "https://betweentwoparens.com/clojure-text-editors",
    :type "text/html"}],
  :title "Clojure Text Editors",
  :author "Between Two Parens",
  :published-str "Fri Nov 29 16:00:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16ec0d39973:1ba5c2f:49b12733",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://betweentwoparens.com/clojure-text-editors",
  :updateCount 1,
  :commonTopics
  [{:score 95.604004700048,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.72,
    :id "nlp/f/topic/1585",
    :salienceLevel "mention",
    :label "nlp"}],
  :published 1575072000000,
  :fingerprint "ddb2ac67",
  :canonicalUrl "https://betweentwoparens.com/clojure-text-editors"}
 {:engagement 9,
  :unread true,
  :crawled 1575193123187,
  :content
  {:content
   "<p>Job Title:\nClojure Web Developer (Required)\nPython, JavaScript (Preferred) </p>\n<p>Reports to:\nFounding Partner</p>\n<p>Note: Please attach your resume when you apply. Must be based in NYC.</p>\n<p>About Us: Our agency is a global leader in the photography, videography &amp; mixed media, with headquarters in New York City and Los Angeles. Our core staff, along with a growing network of highly trained content creators, proudly serves a client list ranging from emerging fashion brands &amp; artists to blue chip tech firms &amp; super luxury brands.</p>\n<p>Position Summary:\nMore than a simple publishing platform, our web technology provides us with many robust features that support most functions of our business. Some of these features include but are not limited to; digital photo and video asset delivery to clients, e-commerce photo licensing, digital asset storage, permissions-based asset editing, customer support tools, FTP syndication tools, custom email alerts.</p>\n<p>The Web Developer is responsible for every aspect of development from front-end to back-end &amp; systems administration. You will work on optimizing queries, perform audits and provide solutions for any performance obstructions preventing the system from scaling. You will also implement design specs by building the front-end, endpoints, models, and tests to bring it to life. </p>\n<p>This position requires a commitment at our NYC based headquarters and the project will last for about 8-12 months. Collaboration with additional developers who built the system will be required from time to time.</p>\n<p>What you need to succeed in this position:\n· Knowledge of Clojure and ClojureScript\n· Knowledge of Datomic, ElasticSearch, Redis, AWS S3, Elastic Container Services, and Lambda.\n· Product knowledge—our own and competitors;\n· An understanding of one’s own strengths and limitations;\n· Good listening and clear communication skills;\n· Willingness to continue moving toward distant goals despite inevitable setbacks.</p>\n<p>Get information on <a href=\"https://functionaljobs.com/jobs/9194-web-developer-in-nyc-at-content-agency\">how to apply</a> for this position.</p>",
   :direction "ltr"},
  :updated 1574787314000,
  :entities
  [{:mentions [{:text "New York City"} {:text "NYC"}],
    :id "nlp/f/entity/wd:60",
    :salienceLevel "about",
    :label "New York City"}
   {:mentions [{:text "FTP"}],
    :id "nlp/f/entity/wd:42283",
    :salienceLevel "mention",
    :label "File Transfer Protocol"}
   {:mentions [{:text "Product"}],
    :id "nlp/f/entity/wd:542929",
    :salienceLevel "mention",
    :label "product"}
   {:mentions [{:text "Redis"}],
    :id "nlp/f/entity/wd:2136322",
    :salienceLevel "mention",
    :label "Redis"}],
  :alternate
  [{:href
    "https://functionaljobs.com/jobs/9194-web-developer-in-nyc-at-content-agency",
    :type "text/html"}],
  :title "Web Developer in NYC at Content Agency (Contract)",
  :author "FunctionalJobs.com",
  :published-str "Tue Nov 26 08:55:14 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16ec0d39973:1ba5c2e:49b12733",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "urn:uuid:80db12b3-98e1-32ed-a192-c11ba8a45cd3",
  :commonTopics
  [{:score 80.6769853834962,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1574787314000,
  :fingerprint "af2cd353",
  :canonicalUrl
  "https://functionaljobs.com/jobs/9194-web-developer-in-nyc-at-content-agency"}
 {:engagement 4,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1575136617928,
  :content
  {:content
   "<b>for i in * ; </b><br><b>do </b><br><b>  echo &quot;$i&quot; ;</b><br><b>  libreoffice --headless --convert-to txt:Text &quot;$i&quot; ; </b><br><b>done</b><br><br>",
   :direction "ltr"},
  :updated 1575134681000,
  :alternate
  [{:href
    "http://www.learningclojure.com/2019/11/to-convert-load-of-document-files-into.html",
    :type "text/html"}],
  :title
  "To Convert a Load of Document Files into Plain Text (In Order to Diff Them)",
  :author "John Lawrence Aspden",
  :published-str "Sat Nov 30 09:24:41 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16ebd7565c8:1849139:97b0c8f7",
  :visual {:url "none"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "tag:blogger.com,1999:blog-7056990295646173627.post-287081141560567014",
  :commonTopics
  [{:score 34.19744251835085,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1575134681000,
  :fingerprint "226e1e44",
  :canonicalUrl
  "http://www.learningclojure.com/2019/11/to-convert-load-of-document-files-into.html"}
 {:engagement 38,
  :unread true,
  :crawled 1575132764760,
  :content
  {:content
   "<div>\n<div>\n<div>\n<p>In the beginning, there was Vim Script (also known as VimL). All Vim configuration, plugins, tweaks and hacks went through that configuration DSL with a sprinkling of flow control. VimL will take you wherever you want to go, albeit in a slightly slow and clunky fashion.</p>\n</div>\n<div>\n<div>\n<pre><code><span>let</span> <span>g:my_thing</span> <span>=</span> <span>&quot;Hello, World!&quot;</span></code></pre>\n</div>\n</div>\n<div>\n<p>We’re going to explore the present and potential future in this post together.</p>\n</div>\n</div>\n</div>\n<div>\n<h2>Going beyond Vim Script</h2>\n<div>\n<div>\n<p>Eventually people started writing some plugins in Ruby or Python, a lot of great tools came out of that but not so many configuration styles (by configuration, I mean what you’d find in your dotfiles).</p>\n</div>\n<div>\n<p>Neovim introduced us to remote plugins that communicate with the editor process over a <a href=\"https://neovim.io/doc/user/api.html#msgpack-rpc\">MessagePack RPC</a> channel, this means we can write plugins in our beloved languages for our beloved text editor. This is what my long term project, <a href=\"https://github.com/Olical/conjure\">Conjure</a>, is built upon! It’s actually written mostly in <a href=\"https://clojure.org/\">Clojure</a> which is almost entirely hidden away from you.</p>\n</div>\n<div>\n<div>\n<pre><code><span>;; From Conjure.</span><span>\n</span><span>(</span><span>defn</span><span> </span><span>read-buffer</span><span>\n</span><span>&quot;Read the entire current buffer into a string.&quot;</span><span>\n</span><span>[]</span><span>\n</span><span>(</span><span>-></span><span> </span><span>(</span><span>api/get-current-buf</span><span>)</span><span> </span><span>(</span><span>api/call</span><span>)</span><span>\n</span><span>(</span><span>api/buf-get-lines</span><span> </span><span>{</span><span>:start</span><span> </span><span>0</span><span>,</span><span> </span><span>:end</span><span> </span><span>-1</span><span>})</span><span> </span><span>(</span><span>api/call</span><span>)</span><span>\n</span><span>(</span><span>util/join-lines</span><span>)))</span></code></pre>\n</div>\n</div>\n<div>\n<p>This is great and all but you’ll find that the overhead of communicating back and forth with Neovim begins to add up, especially for things that run as a user types. I found myself writing some of the more chatty functions that needed to call a lot of API functions in VimL then calling out to that from Clojure. This helped speed things up where bulk RPC calls didn’t quite cut it.</p>\n</div>\n<div>\n<p>Moving things to VimL to optimise MessagePack RPC overhead isn’t a great long term solution though. After all, we’re writing remote plugins so we <em>don’t</em> have to write complex things in VimL!</p>\n</div>\n</div>\n</div>\n<div>\n<h2>Lua to the rescue!(?)</h2>\n<div>\n<div>\n<p>Neovim has an integrated Lua interpreter, <a href=\"https://luajit.org/\">LuaJIT</a> to be precise. It’s an extremely fast runtime that has access to all the tools remote plugins have at their disposal, minus the requirement for MessagePack RPC encoding overhead. This means you get a much simpler language than VimL that’s many times faster without the encoding burden.</p>\n</div>\n<div>\n<div>\n<pre><code><span>-- Also from Conjure.</span>\n\n<span>-- Close the log window if it's open in the current tabpage.</span>\n<span>function</span> <span>conjure</span><span>.</span><span>close_log</span><span>(</span><span>log_buf_name</span><span>)</span>\n  <span>local</span> <span>match</span> <span>=</span> <span>find_log</span><span>(</span><span>log_buf_name</span><span>)</span>\n  <span>if</span> <span>match</span><span>.</span><span>win</span> <span>then</span>\n    <span>local</span> <span>win_number</span> <span>=</span> <span>vim</span><span>.</span><span>api</span><span>.</span><span>nvim_win_get_number</span><span>(</span><span>match</span><span>.</span><span>win</span><span>)</span>\n    <span>vim</span><span>.</span><span>api</span><span>.</span><span>nvim_command</span><span>(</span><span>win_number</span> <span>..</span> <span>&quot;close!&quot;</span><span>)</span>\n  <span>end</span>\n<span>end</span></code></pre>\n</div>\n</div>\n<div>\n<p>The only downside to Lua is that it’s minimal (in syntax and built in functions) almost to a fault, you end up having to use Neovim API calls as your standard library, something that gets pretty tedious to type out eventually. I, personally, struggled to move some logic from Conjure’s Clojure into pre-defined Lua functions simply for the fact that I found Lua a bit awkward to type and work with.</p>\n</div>\n</div>\n</div>\n<div>\n<h2>Best of both worlds?</h2>\n<div>\n<div>\n<p>If you know me, you’ll know that I’m a massive Clojure nerd and can’t seem to edit anything unless it’s got <a href=\"https://en.wikipedia.org/wiki/S-expression\">s-expressions</a>. That’s why I’ve written <a href=\"https://github.com/Olical/aniseed\">Aniseed</a>, a convenient way to compile <a href=\"https://github.com/bakpakin/Fennel\">Fennel</a> (a <a href=\"https://en.wikipedia.org/wiki/Lisp_(programming_language)\">Lisp</a>) into Lua ahead of time or on the fly while you’re inside Neovim. Not only does it help you compile things but it also acts as a small Clojure like standard library to help you build Neovim things with Fennel.</p>\n</div>\n<div>\n<div>\n<pre><code><span>;; From my dotfiles.</span>\n\n<span>(</span><span>local</span> <span>nvim</span> <span>(</span><span>require</span> <span>:aniseed</span><span>.</span><span>nvim</span><span>))</span>\n\n<span>;; Elided for brevity...</span>\n\n<span>(</span><span>fn</span> <span>exists?</span> <span>[</span><span>path</span><span>]</span>\n  <span>(</span><span>=</span> <span>(</span><span>nvim</span><span>.</span><span>fn</span><span>.</span><span>filereadable</span> <span>path</span><span>)</span> <span>1</span><span>))</span>\n\n<span>;; Elided for brevity...</span></code></pre>\n</div>\n</div>\n<div>\n<p>The end result is a decent Lisp that drives Neovim directly, no remote plugin overhead and a blisteringly fast JIT runtime to execute it. Once all of the code is compiled ahead of time there’s essentially zero overhead when compared to writing the underlying Lua by hand. You have access to a (subjectively or objectively?) superiour syntax you can manipulate with <a href=\"https://github.com/guns/vim-sexp\">vim-sexp</a> (and <a href=\"https://github.com/tpope/vim-sexp-mappings-for-regular-people\">vim-sexp-mappings-for-regular-people</a>) as well as all the macros your heart desires.</p>\n</div>\n</div>\n</div>\n<div>\n<h2>What does this mean for you?</h2>\n<div>\n<div>\n<p>You’ll be able to replace <em>almost</em> all of the VimL in your Neovim configuration or plugin with a Lisp that runs at Lua speeds, no more Googling around for how to compare strings in a case sensitive way regardless of editor configuration (<code>==#</code> if I’m not mistaken?).</p>\n</div>\n<div>\n<p>You can use Fennel macros to remove duplicated boilerplate code without sacrificing performance. This can be extremely useful for plugin authors who want to write clever and lengthy mappings in a concise syntax without a chain of extra function calls on startup.</p>\n</div>\n<div>\n<p>For some of you, replacing several non-Lisp languages with a Lisp will be enough to convince you to do this, I’m definitely in that camp.</p>\n</div>\n</div>\n</div>\n<div>\n<h2>Plugins</h2>\n<div>\n<div>\n<p>I wrote <a href=\"https://github.com/Olical/nvim-local-fennel\">nvim-local-fennel</a> as an example plugin that happens to be pretty damn useful in it’s own right. It allows you to write Fennel code in <code>.lnvim.fnl</code> files all the way up your directory tree (think machine local and project local configuration) and have them executed on Neovim startup automatically. The Fennel is compiled to Lua as and when the Fennel source changes, this is all really easy thanks to Aniseed.</p>\n</div>\n<div>\n<p>The majority of the plugin is contained in <a href=\"https://github.com/Olical/nvim-local-fennel/blob/249d139d64abaea7c0137213dd82fd22444a1b40/fnl/nvim-local-fennel/init.fnl\"><code>fnl/nvim-local-fennel/init.fnl</code></a>, the key chunk of code can be found around line 29 (if it hasn’t changed since then).</p>\n</div>\n<div>\n<div>\n<pre><code><span>;; Iterate over all directories from the root to the cwd.</span>\n<span>;; For every .lnvim.fnl, compile it to .lvim.lua (if required) and execute it.</span>\n<span>;; If a .lua is found without a .fnl, delete the .lua to clean up.</span>\n<span>(</span><span>let</span> <span>[</span><span>cwd</span> <span>(</span><span>cwd</span><span>)</span>\n      <span>dirs</span> <span>(</span><span>parents</span> <span>cwd</span><span>)]</span>\n  <span>(</span><span>table</span><span>.</span><span>insert</span> <span>dirs</span> <span>cwd</span><span>)</span>\n  <span>(</span><span>core</span><span>.</span><span>run!</span>\n    <span>(</span><span>fn</span> <span>[</span><span>dir</span><span>]</span>\n      <span>(</span><span>let</span> <span>[</span><span>src</span> <span>(</span><span>..</span> <span>dir</span> <span>&quot;/.lnvim.fnl&quot;</span><span>)</span>\n            <span>dest</span> <span>(</span><span>..</span> <span>dir</span> <span>&quot;/.lnvim.lua&quot;</span><span>)]</span>\n        <span>(</span><span>if</span> <span>(</span><span>file-readable?</span> <span>src</span><span>)</span>\n          <span>(</span><span>do</span>\n            <span>(</span><span>compile</span><span>.</span><span>file</span> <span>src</span> <span>dest</span><span>)</span>\n            <span>(</span><span>nvim</span><span>.</span><span>ex</span><span>.</span><span>luafile</span> <span>dest</span><span>))</span>\n          <span>(</span><span>when</span> <span>(</span><span>file-readable?</span> <span>dest</span><span>)</span>\n            <span>(</span><span>nvim</span><span>.</span><span>fn</span><span>.</span><span>delete</span> <span>dest</span><span>)))))</span>\n    <span>dirs</span><span>))</span></code></pre>\n</div>\n</div>\n<div>\n<p>There’s a <em>tiny</em> bit of Vim Script in <a href=\"https://github.com/Olical/nvim-local-fennel/blob/249d139d64abaea7c0137213dd82fd22444a1b40/plugin/nvim-local-fennel.vim\"><code>plugin/nvim-local-fennel.vim</code></a> that simply loads the compiled Lua automatically as the plugin is loaded. You could skip this if your plugin is an optional library users interact with through requiring the Lua modules.</p>\n</div>\n<div>\n<div>\n<pre><code><span>lua</span> require<span>(</span><span>&quot;nvim-local-fennel&quot;</span><span>)</span></code></pre>\n</div>\n</div>\n<div>\n<p>And the final piece of the puzzle is a small <a href=\"https://github.com/Olical/nvim-local-fennel/blob/6231efe066db8b5d53e2053309857c2ce18ecd79/Makefile\"><code>Makefile</code></a> that allows you to <code>make compile</code> the Fennel into Lua (using Aniseed) ahead of time for distribution. I commit the Fennel and Lua code into the repository to save users of my plugin from having to compile any Fennel to use the plugin itself.</p>\n</div>\n<div>\n<div>\n<pre><code><span>.PHONY</span><span>:</span> <span>compile submodules</span>\n\n<span>compile</span><span>:</span>\n\t<span>rm</span> <span>-rf</span> lua\n\tnvim <span>-c</span> <span>&quot;set rtp+=submodules/aniseed&quot;</span> <span>\\</span>\n\t\t<span>-c</span> <span>&quot;lua require('aniseed.compile').glob('**/*.fnl', 'fnl', 'lua')&quot;</span> <span>\\</span>\n\t\t+q\n\t<span>ln</span> <span>-s</span> ../../submodules/aniseed/lua/aniseed lua/nvim-local-fennel/aniseed\n\n<span>submodules</span><span>:</span>\n\tgit submodule update <span>--init</span> <span>--recursive</span></code></pre>\n</div>\n</div>\n<div>\n<p>Now users of the plugin can simply depend on our repository and have it load and execute without ever knowing about the Lisp it came from! We get a wonderfully expressive language that runs incredibly fast but the user has no idea about what’s going on under the hood.</p>\n</div>\n</div>\n</div>\n<div>\n<h2>Configuration</h2>\n<div>\n<div>\n<p>Another use for Aniseed is to replace your local Neovim configuration with Fennel, I’ve done just that with my <a href=\"https://github.com/Olical/dotfiles/tree/f1187da605f40908582c7a4356ba5771c23df816/neovim/.config/nvim\">dotfiles</a>. We start with <a href=\"https://github.com/Olical/dotfiles/blob/f1187da605f40908582c7a4356ba5771c23df816/neovim/.config/nvim/init.vim\"><code>init.vim</code></a> which ensures we have Aniseed installed and then requires the bootstrap Lua.</p>\n</div>\n<div>\n<blockquote>\n<div>\n<p>I depend upon <code>develop</code> but you should be using the latest released tag for stability. Since I’m the only one changing <code>develop</code> I know I’m not going to surprise myself with breaking changes. Hopefully.</p>\n</div>\n</blockquote>\n</div>\n<div>\n<div>\n<pre><code><span>call</span> plug#begin<span>(</span>stdpath<span>(</span><span>'data'</span><span>)</span> <span>.</span> <span>'/plugged'</span><span>)</span>\nPlug <span>'Olical/aniseed'</span><span>,</span> <span>{</span> <span>'branch'</span><span>:</span> <span>'develop'</span> <span>}</span>\n<span>call</span> plug#<span>end</span><span>()</span>\n\n<span>lua</span> require<span>(</span><span>&quot;config/bootstrap&quot;</span><span>)</span></code></pre>\n</div>\n</div>\n<div>\n<p>Then we move onto the bootstrap Lua in <a href=\"https://github.com/Olical/dotfiles/blob/f1187da605f40908582c7a4356ba5771c23df816/neovim/.config/nvim/lua/config/bootstrap.lua\"><code>lua/config/bootstrap.lua</code></a>, writing this part in VimL would also be fine to be honest.</p>\n</div>\n<div>\n<div>\n<pre><code><span>if</span> <span>not</span><span>(</span><span>pcall</span><span>(</span><span>require</span><span>,</span> <span>&quot;aniseed.compile&quot;</span><span>))</span> <span>then</span>\n  <span>vim</span><span>.</span><span>api</span><span>.</span><span>nvim_command</span><span>(</span><span>&quot;PlugInstall&quot;</span><span>)</span>\n<span>end</span>\n\n<span>local</span> <span>dir</span> <span>=</span> <span>vim</span><span>.</span><span>api</span><span>.</span><span>nvim_call_function</span><span>(</span><span>&quot;stdpath&quot;</span><span>,</span> <span>{</span><span>&quot;config&quot;</span><span>})</span>\n<span>require</span><span>(</span><span>&quot;aniseed.compile&quot;</span><span>).</span><span>glob</span><span>(</span><span>&quot;**/*.fnl&quot;</span><span>,</span> <span>dir</span> <span>..</span> <span>&quot;/fnl&quot;</span><span>,</span> <span>dir</span> <span>..</span> <span>&quot;/lua&quot;</span><span>)</span>\n<span>require</span><span>(</span><span>&quot;config&quot;</span><span>)</span></code></pre>\n</div>\n</div>\n<div>\n<p>All it does is perform a <code>:PlugInstall</code> if we don’t have Aniseed yet and then ask the newly installed Aniseed to compile all of the configuration Fennel to Lua. Once that’s done we can simply load the compiled Lua! Let’s take a peek inside <a href=\"https://github.com/Olical/dotfiles/blob/f1187da605f40908582c7a4356ba5771c23df816/neovim/.config/nvim/fnl/config/init.fnl\"><code>fnl/config/init.fnl</code></a>, the first module to be loaded.</p>\n</div>\n<div>\n<div>\n<pre><code><span>(</span><span>local</span> <span>core</span> <span>(</span><span>require</span> <span>:aniseed</span><span>.</span><span>core</span><span>))</span>\n<span>(</span><span>local</span> <span>nvim</span> <span>(</span><span>require</span> <span>:aniseed</span><span>.</span><span>nvim</span><span>))</span>\n<span>(</span><span>local</span> <span>util</span> <span>(</span><span>require</span> <span>:config</span><span>.</span><span>util</span><span>))</span>\n\n<span>;; Load all config modules in no particular order.</span>\n<span>(</span><span>->></span> <span>(</span><span>util</span><span>.</span><span>glob</span> <span>(</span><span>..</span> <span>util</span><span>.</span><span>config-path</span> <span>&quot;/lua/config/module/*.lua&quot;</span><span>))</span>\n     <span>(</span><span>core</span><span>.</span><span>run!</span> <span>(</span><span>fn</span> <span>[</span><span>path</span><span>]</span>\n                  <span>(</span><span>require</span> <span>(</span><span>string</span><span>.</span><span>gsub</span> <span>path</span> <span>&quot;.*/(.-)/(.-)/(.-)%.lua&quot;</span> <span>&quot;%1.%2.%3&quot;</span><span>)))))</span>\n\n<span>{</span><span>:aniseed/module</span> <span>:config</span><span>.</span><span>init</span><span>}</span></code></pre>\n</div>\n</div>\n<div>\n<p>That initial module loads every other module found within <a href=\"https://github.com/Olical/dotfiles/tree/f1187da605f40908582c7a4356ba5771c23df816/neovim/.config/nvim/fnl/config/module\"><code>fnl/config/module</code></a> automatically, allowing me to easily grow my configuration with well named Fennel files, keeping everything easy to find and understand. Have a browse through those modules to see what I do with plugin installation and configuration.</p>\n</div>\n</div>\n</div>\n<div>\n<h2>Interactive buffer evaluation</h2>\n<div>\n<div>\n<p>You may have noticed the <code>:aniseed/module</code> key in the return values of the modules I’ve shown, these have special meaning in Aniseed. If you have <a href=\"https://github.com/Olical/aniseed/tree/b82429053cd69d030b380dd3a2598770112ea258#evaluating-with-mappings\">Aniseed’s mappings</a> set up like I do (shown in the linked documentation), you can go into any Fennel file you like and evaluate it with <code>&lt;localleader>ef</code>. This means you can tweak and re-evaluate your library as you work on it, just like you would with Clojure and Conjure, you don’t need to restart Neovim to try something out!</p>\n</div>\n<div>\n<p>It solves a problem I found with Lua modules where it was easy to require it once, but awkward to change and then require again. This small feature makes interactive development a whole lot easier, something I feel every Lisp needs.</p>\n</div>\n</div>\n</div>\n<div>\n<h2>That’s all I’ve got for now!</h2>\n<div>\n<div>\n<p>This post has been pretty lengthy and dense but I hope it’s given you a good idea of what you can do with Neovim, Aniseed and Fennel. Please get in touch via Twitter or Email (linked below) with any thoughts or questions you may have. Sharing of this post and the linked projects around social media is greatly appreciated!</p>\n</div>\n<div>\n<p>Have a good day!</p>\n</div>\n<div>\n<div>\n<pre><code><span>(</span><span>local</span> <span>nvim</span> <span>(</span><span>require</span> <span>:aniseed</span><span>.</span><span>nvim</span><span>))</span>\n<span>(</span><span>nvim</span><span>.</span><span>ex</span><span>.</span><span>wq_</span><span>)</span></code></pre>\n</div>\n</div>\n</div>\n</div>",
   :direction "ltr"},
  :updated 1575072000000,
  :entities
  [{:mentions [{:text "fennel"}],
    :id "nlp/f/entity/wd:43511",
    :salienceLevel "mention",
    :label "Foeniculum vulgare"}
   {:mentions [{:text "Lisp"}],
    :id "nlp/f/entity/wd:132874",
    :salienceLevel "mention",
    :label "Lisp"}
   {:mentions [{:text "Lua"}],
    :id "nlp/f/entity/wd:207316",
    :salienceLevel "mention",
    :label "Lua"}
   {:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "API"}],
    :id "nlp/f/entity/wd:165194",
    :salienceLevel "mention",
    :label "application programming interface"}],
  :alternate
  [{:href
    "https://oli.me.uk/neovim-configuration-and-plugins-in-fennel-lisp",
    :type "text/html"}],
  :title "Neovim configuration and plugins in Fennel (Lisp)",
  :author "\"(ollie {:on :parens})\"",
  :published-str "Fri Nov 29 16:00:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16ebd3a9a58:180e83f:97b0c8f7",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://oli.me.uk/neovim-configuration-and-plugins-in-fennel-lisp",
  :commonTopics
  [{:score 124.66414944088999,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 37.9203910776015,
    :id "nlp/f/topic/3000",
    :salienceLevel "about",
    :label "artificial intelligence"}],
  :published 1575072000000,
  :fingerprint "2770ce8c",
  :canonicalUrl
  "https://oli.me.uk/neovim-configuration-and-plugins-in-fennel-lisp"}
 {:engagement 5,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1575065316419,
  :content
  {:content
   "<p>Each week, we discuss a different topic about Clojure and functional programming.</p>\n<p>If you have a question or topic you’d like us to discuss, tweet <a href=\"https://twitter.com/clojuredesign\">@clojuredesign</a>, send an email to <a href=\"mailto:feedback@clojuredesign.club\">feedback@clojuredesign.club</a>, or join the <code>#clojuredesign-podcast</code> channel on the <a href=\"http://clojurians.net/\">Clojurians Slack</a>.</p>\n<p>This week, the topic is: <strong>“Clojure/Conj 2019 Recap”</strong> We go through our notes and recall the most memorable talks from the Conj last week.</p>\n<p>Selected quotes:</p>\n<ul>\n<li>“Cold climate, warm people.”</li>\n<li>“Learn skills that transfer.”</li>\n<li>“The future is about immutability and composability.”</li>\n<li>“YAML! YAML! YAML! The names of an episode we have not done, and probably will not do.”</li>\n<li>“If you can make solving problems easier by using Clojure, then there is a lot of incentive to learn and use Clojure.”</li>\n<li>“You can’t get rid of bias, even when you know you have it. All you can do is change how you work.”</li>\n<li>“The Conj has become less about Clojure and more about solving problems.”</li>\n</ul>\n<p>Talks:</p>\n<ul>\n<li><a href=\"https://www.youtube.com/watch?v=jh4hMAvygjk\">Defeating the Four Horsemen of the Coding Apocalypse - Mark Bastian</a></li>\n<li><a href=\"https://www.youtube.com/watch?v=MnvtPzEH-d8\">Follow the Data: Product Development in Clojure - Derek Troy-West</a><br>\nApplication: <a href=\"https://operatr.io/\">Operatr</a></li>\n<li><a href=\"https://www.youtube.com/watch?v=5mbp3SEha38\">Love Letter To Clojure: And A Datomic Experience Report - Gene Kim</a><br>\nNew book: <a href=\"https://itrevolution.com/the-unicorn-project/\">The Unicorn Project</a></li>\n<li><a href=\"https://www.youtube.com/watch?v=yruVUkwlffk\">Goodbye YAML: Infrastructure as Code in Clojure - Eno Compton &amp; Tyler van Hensbergen</a></li>\n<li><a href=\"https://www.youtube.com/watch?v=m0rSJ9xdsdk\">Interactive Programming for Artificial Intelligence - Dragan Djuric</a><br>\nLibraries: <a href=\"https://uncomplicate.org/\">uncomplicate.org</a>, Blog: <a href=\"https://dragan.rocks/\">dragan.rocks</a>, Books: <a href=\"https://aiprobook.com\">aiprobook.com</a></li>\n<li><a href=\"https://www.youtube.com/watch?v=rGKEOMUtJfE\">Probabilistic Record Linkage of Hospital Patients - Chris Oakman</a></li>\n<li><a href=\"https://www.youtube.com/watch?v=ABQ5N9wRGNw\">Rapid Prototyping for Software Development - Sara Kimmich</a></li>\n<li><a href=\"https://www.youtube.com/watch?v=HmHOYkTVxIg\">(Architecture) Diagrams as Data - Avi Flax</a></li>\n<li><a href=\"https://www.youtube.com/watch?v=GvJm-eJ5o18\">The Hitchhikers Guide to Multiparadigm Programming - Ariel Ortiz</a></li>\n<li><a href=\"https://www.youtube.com/watch?v=LN0qG-i1iT0\">A Racket Perspective on Research, Education, and Production - Matthew Flatt</a><br>\nSite: <a href=\"https://racket-lang.org/\">racket-lang.org</a></li>\n<li><a href=\"https://www.youtube.com/watch?v=7CM7Ef-dPWQ\">Composable Tools - Alex Miller</a></li>\n<li><a href=\"https://www.youtube.com/watch?v=OUZZKtypink\">Sherlock Holmes, Consulting Developer - Stuart Halloway</a></li>\n</ul>",
   :direction "ltr"},
  :updated 1575039600000,
  :entities
  [{:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "about",
    :label "Clojure"}
   {:mentions [{:text "YAML"}],
    :id "nlp/f/entity/wd:281876",
    :salienceLevel "mention",
    :label "YAML"}
   {:mentions [{:text "functional programming"}],
    :id "nlp/f/entity/wd:193076",
    :salienceLevel "mention",
    :label "functional programming"}
   {:mentions [{:text "books"} {:text "book"}],
    :id "nlp/f/entity/wd:571",
    :salienceLevel "mention",
    :label "book"}
   {:mentions [{:text "Sherlock Holmes"}],
    :id "nlp/f/entity/wd:4653",
    :salienceLevel "mention",
    :label "Sherlock Holmes"}],
  :alternate
  [{:href
    "https://clojuredesign.club/episode/057-clojure-conj-2019-recap/",
    :type "text/html"}],
  :title "Ep 057: Clojure/Conj 2019 Recap",
  :author "Christoph Neumann and Nate Jones",
  :published-str "Fri Nov 29 07:00:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16eb9356c43:14775a3:49b12733",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://clojuredesign.club/episode/057-clojure-conj-2019-recap/",
  :commonTopics
  [{:score 80.22914027043844,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.904,
    :id "nlp/f/topic/349",
    :salienceLevel "about",
    :label "business"}
   {:score 0.87,
    :id "nlp/f/topic/603",
    :salienceLevel "about",
    :label "cybercrime"}
   {:score 0.869,
    :id "nlp/f/topic/777",
    :salienceLevel "about",
    :label "entertainment"}
   {:score 0.843,
    :id "nlp/f/topic/861",
    :salienceLevel "mention",
    :label "finance"}
   {:score 0.796,
    :id "nlp/f/topic/1695",
    :salienceLevel "mention",
    :label "parenting"}
   {:score 0.747,
    :id "nlp/f/topic/2186",
    :salienceLevel "mention",
    :label "stocks"}],
  :published 1575039600000,
  :fingerprint "7eb06da0",
  :canonicalUrl
  "https://clojuredesign.club/episode/057-clojure-conj-2019-recap/"}
 {:engagement 9,
  :unread false,
  :crawled 1574789549239,
  :recrawled 1574799999912,
  :content
  {:content
   "<p>Job Title:\nClojure Web Developer (Required)\nPython, JavaScript (Preferred) </p>\n<p>Reports to:\nFounding Partner</p>\n<p>Note: Please attach your resume when you apply. Must be based in NYC.</p>\n<p>About Us: Our agency is a global leader in the photography, videography &amp; mixed media, with headquarters in New York City and Los Angeles. Our core staff, along with a growing network of highly trained content creators, proudly serves a client list ranging from emerging fashion brands &amp; artists to blue chip tech firms &amp; super luxury brands.</p>\n<p>Position Summary:\nMore than a simple publishing platform, our web technology provides us with many robust features that support most functions of our business. Some of these features include but are not limited to; digital photo and video asset delivery to clients, e-commerce photo licensing, digital asset storage, permissions-based asset editing, customer support tools, FTP syndication tools, custom email alerts.</p>\n<p>Reporting to the Founding Partner, the Web Developer is responsible for every aspect of development from front-end to back-end &amp; systems administration. You will work on optimizing queries, perform audits and provide solutions for any performance obstructions preventing the system from scaling. You will also implement design specs by building the front-end, endpoints, models, and tests to bring it to life. </p>\n<p>This position requires a full time commitment at our NYC based headquarters. Collaboration with additional developers who built the system will be required from time to time.</p>\n<p>What you need to succeed in this position:\n· Knowledge of Clojure and ClojureScript (Mastery of Clojure is not required but a willingness to learn and an interest in functional programming languages is).\n· Knowledge of Datomic, ElasticSearch, Redis, AWS S3, Elastic Container Services, and Lambda.\n· Product knowledge—our own and competitors;\n· An understanding of one’s own strengths and limitations;\n· Good listening and clear communication skills;\n· Willingness to continue moving toward distant goals despite inevitable setbacks.</p>\n<p>Get information on <a href=\"https://functionaljobs.com/jobs/9194-8-12-month-web-developer-at-content-agency\">how to apply</a> for this position.</p>",
   :direction "ltr"},
  :updated 1574787314000,
  :entities
  [{:mentions [{:text "New York City"} {:text "NYC"}],
    :id "nlp/f/entity/wd:60",
    :salienceLevel "mention",
    :label "New York City"}
   {:mentions [{:text "FTP"}],
    :id "nlp/f/entity/wd:42283",
    :salienceLevel "mention",
    :label "File Transfer Protocol"}
   {:mentions [{:text "functional programming"}],
    :id "nlp/f/entity/wd:193076",
    :salienceLevel "mention",
    :label "functional programming"}
   {:mentions [{:text "Product"}],
    :id "nlp/f/entity/wd:542929",
    :salienceLevel "mention",
    :label "product"}
   {:mentions [{:text "Redis"}],
    :id "nlp/f/entity/wd:2136322",
    :salienceLevel "mention",
    :label "Redis"}],
  :alternate
  [{:href
    "https://functionaljobs.com/jobs/9194-8-12-month-web-developer-at-content-agency",
    :type "text/html"}],
  :title "8-12 Month Web Developer at Content Agency (Contract)",
  :author "FunctionalJobs.com",
  :published-str "Tue Nov 26 08:55:14 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16ea8c58cb7:50ceb5:49b12733",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "urn:uuid:58f55be5-4dcd-e35b-497c-5d4df3218433",
  :updateCount 1,
  :commonTopics
  [{:score 86.4218999345017,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1574787314000,
  :fingerprint "c82626eb",
  :canonicalUrl
  "https://functionaljobs.com/jobs/9194-8-12-month-web-developer-at-content-agency"}
 {:engagement 5,
  :unread false,
  :crawled 1574768565696,
  :content
  {:content
   "<p>In this episode I talk with Gene Kim. We talk his introduction to Clojure and functional programming, <em>The Phoenix Project</em> and <em>The Unicorn Project</em>, Functional Architecture, lessons learned, his Love Letter to Clojure, and much, much, more.</p>\n<h2>Our Guest, Gene Kim</h2>\n<p><a rel=\"noreferrer noopener\" href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly90d2l0dGVyLmNvbS9yZWFsZ2VuZWtpbQ%3D%3D&feed-stats-url-post-id=15468\" target=\"_blank\">@realgenekim</a> on Twitter<br><a rel=\"noreferrer noopener\" href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly93d3cubGlua2VkaW4uY29tL2luL3JlYWxnZW5la2ltLw%3D%3D&feed-stats-url-post-id=15468\" target=\"_blank\">realgenekim</a> on LinkedIn</p>\n<h3>Conference Announcements</h3>\n<p>Lambda Days 2020 will be on the 13th and 14th of February in Kraków, Poland. Visit <a rel=\"noreferrer noopener\" href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly93d3cubGFtYmRhZGF5cy5vcmcvbGFtYmRhZGF5czIwMjA%3D&feed-stats-url-post-id=15468\" target=\"_blank\">https://www.lambdadays.org/lambdadays2020</a> to find out more and to register.</p>\n<p>Code BEAM SF is taking place on March 6th and 6th. For more information visit: <a rel=\"noreferrer noopener\" href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly9jb2Rlc3luYy5nbG9iYWwvY29uZmVyZW5jZXMvY29kZS1iZWFtLXNmLw%3D%3D&feed-stats-url-post-id=15468\" target=\"_blank\">https://codesync.global/conferences/code-beam-sf/</a>.</p>\n<p>Elm in the Spring will be taking place May 1st. Check in at <a rel=\"noreferrer noopener\" href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly93d3cuZWxtaW50aGVzcHJpbmcub3JnLw%3D%3D&feed-stats-url-post-id=15468\" target=\"_blank\">https://www.elminthespring.org/</a> to keep updated as more information gets announced.</p>\n<p>If you have a conference related to functional programming, contact me, and I will be happy to announce it.</p>\n<h3>Announcements</h3>\n<p>Some of you have asked how you can support Functional Geekery, in that vein, Functional Geekery now has a Patreon Page.</p>\n<p>If that is one of the ways you would like to show your support, you can find out more at <a rel=\"noreferrer noopener\" href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly93d3cucGF0cmVvbi5jb20vZm5nZWVrZXJ5&feed-stats-url-post-id=15468\" target=\"_blank\">https://www.patreon.com/fngeekery</a>.</p>\n<h3>Topics [@2:51]</h3>\n<p>About Gene<br><a rel=\"noreferrer noopener\" href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly93d3cudHJpcHdpcmUuY29tLw%3D%3D&feed-stats-url-post-id=15468\" target=\"_blank\">Tripwire</a><br><a rel=\"noreferrer noopener\" href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly9jbG91ZC5nb29nbGUuY29tL2Jsb2cvcHJvZHVjdHMvZGV2b3BzLXNyZS90aGUtMjAxOS1hY2NlbGVyYXRlLXN0YXRlLW9mLWRldm9wcy1lbGl0ZS1wZXJmb3JtYW5jZS1wcm9kdWN0aXZpdHktYW5kLXNjYWxpbmc%3D&feed-stats-url-post-id=15468\" target=\"_blank\">State of DevOps Report</a><br><a rel=\"noreferrer noopener\" href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly9hbXpuLnRvLzM3dW9lZHo%3D&feed-stats-url-post-id=15468\" target=\"_blank\">The Phoenix Project</a><br><a rel=\"noreferrer noopener\" href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly9hbXpuLnRvLzM0cHEwZTA%3D&feed-stats-url-post-id=15468\" target=\"_blank\">The DevOps Handbook</a><br><a rel=\"noreferrer noopener\" href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly9hbXpuLnRvLzJYQk9VVnE%3D&feed-stats-url-post-id=15468\" target=\"_blank\">The Unicorn Project</a><br><a rel=\"noreferrer noopener\" href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly9jbG9qdXJlLm9yZw%3D%3D&feed-stats-url-post-id=15468\" target=\"_blank\">Clojure</a><br><a rel=\"noreferrer noopener\" href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly9pdHJldm9sdXRpb24uY29tL2xvdmUtbGV0dGVyLXRvLWNsb2p1cmUtcGFydC0xLw%3D%3D&feed-stats-url-post-id=15468\" target=\"_blank\">Love Letter to Clojure (Part 1)</a><br>Ops being where the saves were made<br><a rel=\"noreferrer noopener\" href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly9zcGFmLmNlcmlhcy5wdXJkdWUuZWR1Lw%3D%3D&feed-stats-url-post-id=15468\" target=\"_blank\">Gene Spafford</a><br><a rel=\"noreferrer noopener\" href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvTW9ycmlzX3dvcm0%3D&feed-stats-url-post-id=15468\" target=\"_blank\">Morris worm</a><br>90% of his errors go away when using Clojure<br>What put Clojure on his list to pick up<br><a rel=\"noreferrer noopener\" href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly9hbXpuLnRvLzJPdkJGa00%3D&feed-stats-url-post-id=15468\" target=\"_blank\">Ruby Reference Manual</a><br>How Ruby strings aren’t immutable<br>Reading a Clojure book and bolting upright in bed finding out that Ruby’s <code>&lt;&lt;</code> operator modifies the right hand side array<br><a rel=\"noreferrer noopener\" href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly9hbXpuLnRvLzJYRzZDWFI%3D&feed-stats-url-post-id=15468\" target=\"_blank\">Java Concurrency in Practice</a><br><a rel=\"noreferrer noopener\" href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly93d3cuZWlmZmVsLmNvbS9yZXNvdXJjZXMvZmFxcy9laWZmZWwtbGFuZ3VhZ2Uv&feed-stats-url-post-id=15468\" target=\"_blank\">Eiffel</a><br><a rel=\"noreferrer noopener\" href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly9hbXpuLnRvLzJxQlZMU3c%3D&feed-stats-url-post-id=15468\" target=\"_blank\">Object Oriented Software Construction</a><br><a rel=\"noreferrer noopener\" href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvU21hbGx0YWxr&feed-stats-url-post-id=15468\" target=\"_blank\">Smalltalk</a><br>Immutability and Value Object in Object Oriented style<br>Working in the REPL in Clojure<br>Writing a vacation notifier for Gmail<br>Rewrites note taking and tweeting app a number of times<br><a rel=\"noreferrer noopener\" href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly9kZXZlbG9wZXIuYXBwbGUuY29tL2xpYnJhcnkvYXJjaGl2ZS9kb2N1bWVudGF0aW9uL0NvY29hL0NvbmNlcHR1YWwvUHJvZ3JhbW1pbmdXaXRoT2JqZWN0aXZlQy9JbnRyb2R1Y3Rpb24vSW50cm9kdWN0aW9uLmh0bWw%3D&feed-stats-url-post-id=15468\" target=\"_blank\">Objective C</a><br><a rel=\"noreferrer noopener\" href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly93d3cudHlwZXNjcmlwdGxhbmcub3Jn&feed-stats-url-post-id=15468\" target=\"_blank\">TypeScript</a> and <a rel=\"noreferrer noopener\" href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly9yZWFjdGpzLm9yZw%3D%3D&feed-stats-url-post-id=15468\" target=\"_blank\">React</a><br>Clojure and <a rel=\"noreferrer noopener\" href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly9naXRodWIuY29tL2RheTgvcmUtZnJhbWU%3D&feed-stats-url-post-id=15468\" target=\"_blank\">re-frame</a><br>Data is immutable, but the program is very mutable<br><a rel=\"noreferrer noopener\" href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly9hbXpuLnRvLzJRUEp6clk%3D&feed-stats-url-post-id=15468\" target=\"_blank\">Flow</a> by Mihaly Csikszentmihalyi<br><a rel=\"noreferrer noopener\" href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly93d3cudGVkLmNvbS90YWxrcy9taWhhbHlfY3Npa3N6ZW50bWloYWx5aV9vbl9mbG93&feed-stats-url-post-id=15468\" target=\"_blank\">Flow, the secret to happiness</a> Ted Talk<br><a rel=\"noreferrer noopener\" href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly9hbXpuLnRvLzJYT0FGd0o%3D&feed-stats-url-post-id=15468\" target=\"_blank\">Peak</a> by Anders Ericsson<br>Deliberate Practice<br><a rel=\"noreferrer noopener\" href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly9hbXpuLnRvLzJRRjhyQ1o%3D&feed-stats-url-post-id=15468\" target=\"_blank\">Grit</a> by Angela Duckworth<br>Have a coach; Do practice<br>Podcasts<br><a rel=\"noreferrer noopener\" href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly93d3cuZnVuY3Rpb25hbGdlZWtlcnkuY29tL2VwaXNvZGUtMTA1LWRhdmlkLWtvb250ei8%3D&feed-stats-url-post-id=15468\" target=\"_blank\">David Koontz on Functional Geekery</a><br><a rel=\"noreferrer noopener\" href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly9zb3VuZGNsb3VkLmNvbS9sYW1iZGEtY2FzdA%3D%3D&feed-stats-url-post-id=15468\" target=\"_blank\">LambdaCast</a><br><a rel=\"noreferrer noopener\" href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly9jbG9qdXJlZGVzaWduLmNsdWIv&feed-stats-url-post-id=15468\" target=\"_blank\">Functional Design in Clojure</a> podcast<br>JavaScript tooling environment<br><a rel=\"noreferrer noopener\" href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly90eXBlbGV2ZWwub3JnL2NhdHMv&feed-stats-url-post-id=15468\" target=\"_blank\">Cats</a> library<br>Haskell<br>How has Clojure refreshed Gene’s thinking when going back to older programs<br>Maxine in <em>The Unicorn Project</em><br><a rel=\"noreferrer noopener\" href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly93d3cubWljaGFlbG55Z2FyZC5jb20v&feed-stats-url-post-id=15468\" target=\"_blank\">Micheal Nygard</a><br>How did the scenes resonate to Proctor<br><a rel=\"noreferrer noopener\" href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly9yYW1kYWpzLmNvbQ%3D%3D&feed-stats-url-post-id=15468\" target=\"_blank\">RamdaJs</a><br><a rel=\"noreferrer noopener\" href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly93d3cuZnVuY3Rpb25hbGdlZWtlcnkuY29tL2VwaXNvZGUtNTEtYnJpYW4tbG9uc2RvcmYv&feed-stats-url-post-id=15468\" target=\"_blank\">Brian Lonsdorf on Functional Geekery</a><br><a rel=\"noreferrer noopener\" href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly93d3cuZnVuY3Rpb25hbGdlZWtlcnkuY29tL2VwaXNvZGUtMzEtZGF2aWQtY2hhbWJlcnMv&feed-stats-url-post-id=15468\" target=\"_blank\">David Chambers covering Ramda on Functional Geekery</a><br>Seeing the shape of the data<br>Some form of a combination of <code>map</code>, <code>filter</code>, <code>reduce</code><br>“Is it good to think with”<br><a rel=\"noreferrer noopener\" href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvTGluZ3Vpc3RpY19yZWxhdGl2aXR5&feed-stats-url-post-id=15468\" target=\"_blank\">Sapir-Whorf hypothesis</a>: Language affects worldview of the speakers<br><a rel=\"noreferrer noopener\" href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly9saXNwY2FzdC5jb20vd2h5LWRvLWktcHJlZmVyLWNsb2p1cmUtdG8taGFza2VsbC8%3D&feed-stats-url-post-id=15468\" target=\"_blank\">Eric Normand on thinking in types based off experience in Haskell</a><br><a rel=\"noreferrer noopener\" href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly93d3cubWFubmluZy5jb20vYm9va3MvZ3Jva2tpbmctc2ltcGxpY2l0eQ%3D%3D&feed-stats-url-post-id=15468\" target=\"_blank\">Grokking Simplicity</a><br>Actions, Calculation, Data<br><a rel=\"noreferrer noopener\" href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly93d3cuZnVuY3Rpb25hbGdlZWtlcnkuY29tL2VwaXNvZGUtMTEtc2ltb24tcGV5dG9uLWpvbmVzLw%3D%3D&feed-stats-url-post-id=15468\" target=\"_blank\">Simon Peyton Jones on Functional Geekery</a><br><a rel=\"noreferrer noopener\" href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly9nYWxvaXMuY29tL3RlYW0vam9obi1sYXVuY2hidXJ5Lw%3D%3D&feed-stats-url-post-id=15468\" target=\"_blank\">Dr. John Launchbury</a><br>Creating Word-Cloud from bibliography and replacing “Ibid.” problem<br>“What are the types of input and output?”<br>“What is the correct answer when you have just one element ‘Ibid.’?”<br><a rel=\"noreferrer noopener\" href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly9jbG9qdXJlLm9yZy9ndWlkZXMvc3BlYw%3D%3D&feed-stats-url-post-id=15468\" target=\"_blank\">clojure.spec</a><br>How much did Functional Programming and data-focus opting to write <em>The Unicorn Project</em><br>Studying Rich Hickey videos<br><a rel=\"noreferrer noopener\" href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly93d3cueW91dHViZS5jb20vd2F0Y2g%2Fdj1WU2RuSkRPLXhkZw%3D%3D&feed-stats-url-post-id=15468\" target=\"_blank\">Rich Hickey’s 2015 JavaOne presentation</a><br>Lunch Factor: How many people do we need to take out to lunch to get something done?<br>“How do you get data where it resides […] to where developers can use it in their daily work”<br><a rel=\"noreferrer noopener\" href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly9rYWZrYS5hcGFjaGUub3JnL2RvY3VtZW50YXRpb24vc3RyZWFtcy8%3D&feed-stats-url-post-id=15468\" target=\"_blank\">Kafka</a><br><a rel=\"noreferrer noopener\" href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly9tYXJ0aW5mb3dsZXIuY29tL2VhYURldi9FdmVudFNvdXJjaW5nLmh0bWw%3D&feed-stats-url-post-id=15468\" target=\"_blank\">Event Sourcing</a><br>Self Identifying as a Developer after 25 years<br>Gene’s current view on Functional Architecture<br><a rel=\"noreferrer noopener\" href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly93d3cueW91dHViZS5jb20vd2F0Y2g%2Fdj1Gc2tJYjlTYXJpSQ%3D%3D&feed-stats-url-post-id=15468\" target=\"_blank\">Scott Havens (of Jet.com and Walmart.com) presentation</a> on turning 23 API calls to 2 API calls<br><a rel=\"noreferrer noopener\" href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly93d3cueW91dHViZS5jb20vd2F0Y2g%2Fdj1kU0N6Q2FpV2dMTQ%3D%3D&feed-stats-url-post-id=15468\" target=\"_blank\">Scott Havens’ talk about rebuilding Kafka servers</a><br><a rel=\"noreferrer noopener\" href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly9mc2hhcnAub3JnLw%3D%3D&feed-stats-url-post-id=15468\" target=\"_blank\">F#</a><br>The 5 Ideals:</p>\n<ul><li>Locality and Simplicity</li><li>Focus, Flow, and Joy</li><li>Improvement of daily work</li><li>Psychological Safety</li><li>Customer Focus</li></ul>\n<p><a rel=\"noreferrer noopener\" href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly9yZXdvcmsud2l0aGdvb2dsZS5jb20vYmxvZy90aGUtZXZvbHV0aW9uLW9mLXByb2plY3Qtb3h5Z2VuLw%3D%3D&feed-stats-url-post-id=15468\" target=\"_blank\">Project Oxygen</a> at Google<br>Core vs Context<br><a rel=\"noreferrer noopener\" href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly9pdHJldm9sdXRpb24uY29tL3RoZS11bmljb3JuLXByb2plY3Qv&feed-stats-url-post-id=15468\" target=\"_blank\">Excepts of the first 60% of The Unicorn Project</a><br><a rel=\"noreferrer noopener\" href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly9pdHJldm9sdXRpb24uY29tL3RoZS11bmljb3JuLXByb2plY3Qv&feed-stats-url-post-id=15468\" target=\"_blank\">First 8 chapters as Audiobook format</a><br><a rel=\"noreferrer noopener\" href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly93d3cueW91dHViZS5jb20vd2F0Y2g%2Fdj1Yd2FSS2Nqa0FBbw%3D%3D&feed-stats-url-post-id=15468\" target=\"_blank\">Fernando Cornago – Adidas talk on data availability across the organization</a><br><a rel=\"noreferrer noopener\" href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cDovLzIwMTkuY2xvanVyZS1jb25qLm9yZy8%3D&feed-stats-url-post-id=15468\" target=\"_blank\">Clojure Conj</a><br><a rel=\"noreferrer noopener\" href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly95b3V0dS5iZS81bWJwM1NFaGEzOA%3D%3D&feed-stats-url-post-id=15468\" target=\"_blank\">Gene’s presentation at Clojure Conj</a></p>\n<p>As always, a giant Thank You goes to <a rel=\"noreferrer noopener\" href=\"https://www.functionalgeekery.com/?feed-stats-url=aHR0cHM6Ly93d3cudHdpdHRlci5jb20vZGF2aWRqYmVsY2hlcg%3D%3D&feed-stats-url-post-id=15468\" target=\"_blank\">David Belcher</a> for the logo design.</p>\n<img width=\"1\" src=\"https://www.functionalgeekery.com/?feed-stats-post-id=15468\" height=\"1\">",
   :direction "ltr"},
  :updated 1574766000000,
  :entities
  [{:mentions [{:text "Gene Spafford"} {:text "Gene"}],
    :id "nlp/f/entity/wd:5531458",
    :salienceLevel "about",
    :label "Gene Spafford"}
   {:mentions [{:text "functional programming"}],
    :id "nlp/f/entity/wd:193076",
    :salienceLevel "about",
    :label "functional programming"}
   {:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "Data"}],
    :id "nlp/f/entity/wd:22983",
    :salienceLevel "mention",
    :label "Data"}
   {:mentions [{:text "Love Letter"}],
    :id "nlp/f/entity/wd:856096",
    :salienceLevel "mention",
    :label "ILOVEYOU"}],
  :alternate
  [{:href "https://www.functionalgeekery.com/episode-128-gene-kim/",
    :type "text/html"}],
  :title "Functional Geekery Episode 128 – Gene Kim",
  :author "functionalgeekery",
  :published-str "Tue Nov 26 03:00:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16ea7855dc0:3070b0:69b9f616",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://www.functionalgeekery.com/episode-128-gene-kim/",
  :commonTopics
  [{:score 75.03687737192433,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1574766000000,
  :fingerprint "2e916317",
  :canonicalUrl
  "https://www.functionalgeekery.com/episode-128-gene-kim/"}
 {:engagement 5,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1574711219380,
  :recrawled 1577196125368,
  :content
  {:content
   "<div><p>Ah, the advent, the four weeks leading up to Christmas. That period of glühwein\nand office year-end parties.</p><p>The last couple of years I’ve taken part in the <a shape=\"rect\" href=\"https://adventofcode.com/\">Advent of Code</a>, a series of\nprogramming puzzles posted daily. They’re generally fun to do and wrapped in a\nnice narrative. They also as the days progress start taking up way too much of\nmy time, so this year I won’t be partaking in Advent of Code, instead I’m trying\nsomething new.</p><p>From the first to the 24th of December I challenge myself to write a single\nsmall blog post every day. If my friend Sarah Mirk can do a <a shape=\"rect\" href=\"https://www.mirkwork.com/year-of-zines\">daily zine for a\nwhole year</a>, surely I can muster a few daily paragraphs for four weeks.</p><p>I’ve been keeping some notes of things I want to mention. It’ll be a hodge podge\nof topics, sharing tips and tricks about Clojure, Emacs, UNIX; pointing at cool\ntools and libraries I came across in the past year, and perhaps some end-of-year\nrumination and reflection, should the mood strike.</p><p>These posts will be a little different stylistically from the usual Lambda\nIsland material. I usually like to provide ample context and cover topics in\ndepth. This time I’ll be brief and get to the point. Another way to look at it\nis that these will be the kind of extra things that you pick up when watching\nLambda Island videos, a handy Emacs binding, a shell command you hadn’t seen\nbefore, or an elegant Clojure idiom.</p><p>If you feel inspired to do your own advent of blog posts then let me know, I’ll\nbe happy to add a link. I hope it will be adventageous ;)</p><h3>Other people doing Advent of Parens 2019:</h3><ul><li><a shape=\"rect\" href=\"https://alexanderoloo.com/\">Alexander Oloo</a></li><li><a shape=\"rect\" href=\"https://porkostomus.gitlab.io/\">Bobby Towers</a></li><li><a shape=\"rect\" href=\"http://slipset.github.io/\">Erik Assum</a> aka slipset</li><li>John Stevenson at <a shape=\"rect\" href=\"https://practicalli.github.io/blog/\">Practicalli</a></li><li>Bozhidar Batsov at <a shape=\"rect\" href=\"https://metaredux.com/posts/2019/12/01/meta-advent-2019.html\">Metaredux</a></li></ul></div>",
   :direction "ltr"},
  :updated 1577195194000,
  :entities
  [{:mentions [{:text "Lambda Island"}],
    :id "nlp/f/entity/wd:3427832",
    :salienceLevel "mention",
    :label "Lambda Island"}
   {:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "Christmas"}],
    :id "nlp/f/entity/wd:19809",
    :salienceLevel "mention",
    :label "Christmas"}
   {:mentions [{:text "Emacs"}],
    :id "nlp/f/entity/wd:189722",
    :salienceLevel "mention",
    :label "Emacs"}
   {:mentions [{:text "Sarah Mirk"}],
    :id "nlp/f/entity/wd:23770247",
    :salienceLevel "mention",
    :label "Sarah Mirk"}],
  :alternate
  [{:href "https://lambdaisland.com/blog/2019-11-25-advent-of-parens",
    :type "text/html"}],
  :title "Advent of Parens 2019",
  :author "Arne Brasseur",
  :published-str "Tue Dec 24 05:46:34 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16ea41a54b4:f477b8:49b12733",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://lambdaisland.com/blog/2019-11-25-advent-of-parens",
  :updateCount 5,
  :published 1577195194000,
  :fingerprint "341142bd",
  :canonicalUrl
  "https://lambdaisland.com/blog/2019-11-25-advent-of-parens"}
 {:engagement 5,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1574700408475,
  :content
  {:content
   "<div>\n<p><em>Issue 353 – November 25, 2019 · <a href=\"https://purelyfunctional.tv/newsletter-archives/\">Archives</a> · <a title=\"Thanks, Jeff!\" href=\"https://purelyfunctional.tv/newsletter/\">Subscribe</a></em></p>\n<h2>First Annual PurelyFunctional.tv Survey! 📋</h2>\n<p>The first annual <a title href=\"https://purelyfunctional.tv/annual-customer-survey/\">PurelyFunctional.tv Survey</a> is still open. Your answer to this quick survey will help me understand how to improve my videos and help you master Clojure faster and more deeply.</p>\n<p>There are only four questions. If you’ve watched any of my video content, please take a few minutes to <a title href=\"https://purelyfunctional.tv/annual-customer-survey/\">fill this out</a>. I appreciate any answer you can give. And a big “thank you” to everyone who has already submitted an answer.</p>\n<p><a title href=\"https://purelyfunctional.tv/annual-customer-survey/\">Fill out the survey</a></p>\n<p>The survey will run for two more weeks.</p>\n<h2>Clojure Tip 💡</h2>\n<p><em>String literals are interned</em></p>\n<p>String literals (strings that appear directly in code) are interned in Java. That means that there is a lookup table in memory where they are stored. If you use the same string literal twice (two strings that are equal), Java will look it up in the intern table and reuse the existing one.</p>\n<p>Clojure does the same thing. Try this at the REPL:</p>\n<pre><code>> (identical? &quot;a&quot; &quot;a&quot;)\ntrue\n</code></pre>\n<p>Java and Clojure do this to increase performance in two ways. First, interned strings can be compared much more quickly since, in the case where they are equal, they will have identical pointers. If the compiler can tell that all of the strings you are comparing are interned, it can use only pointer equality.</p>\n<p>Second, interned strings use less memory since the same string is reused. In general, Strings in the intern table can be garbage collected when they are no longer accessible from the program. All of this is possible because Strings are immutable.</p>\n<p>Note that a lot of the strings you use are not interned by default. When you read lines as strings from a data file, those are not interned. When you concatenate two strings, those are not interned. Etc. If for some reason you want two equal strings but don’t want them to be identical, you should construct a new one using the <code>String</code> constructor.</p>\n<pre><code>> (identical? &quot;a&quot; (String. &quot;a&quot;))\nfalse\n</code></pre>\n<p>However, it’s hard to think of why you would want that in production code.</p>\n<h2>Clojure Media 🍿</h2>\n<p><a title href=\"https://www.youtube.com/playlist?list=PLZdCLR02grLqSy15ALLAZDU6LGpAJDrAQ\">Clojure/conj 2019 videos</a></p>\n<p>Folks, it was a great conference. I didn’t catch all the talks, so I’ll be watching them online. I often prefer that anyway. Conferences are for meeting each other, and I met some great people. See you online until next time.</p>\n<h2>Awesome book 📖</h2>\n<p><a title href=\"https://itrevolution.com/the-unicorn-project/\"><em>The Unicorn Project</em></a> by Gene Kim.</p>\n<p>Gene Kim, the author, <a title href=\"https://www.youtube.com/watch?v=5mbp3SEha38\">spoke at the Conj</a> this past week. This book coming out Tuesday, November 26. I was lucky enough to be offered a preview copy. I read it and loved it. Nothing shows the developer’s experience inside the enterprise bureaucracy better than this novel.</p>\n<h2>Currently recording 🎥</h2>\n<p><em>Property-Based Testing with test.check</em> is now split into three courses, <a title href=\"https://purelyfunctional.tv/courses/property-based-testing-with-test-check/\">Beginning</a>, <a title href=\"https://purelyfunctional.tv/courses/intermediate-property-based-testing-with-test-check/\">Intermediate</a>, and <a title href=\"https://purelyfunctional.tv/courses/advanced-property-based-testing-with-test-check/\">Advanced</a>.</p>\n<p>The launch sale is still going. It will end in one week, at which point the price will go up. If you want them, now’s your chance. They will never be this inexpensive again!</p>\n<h2>Book update 📖</h2>\n<p>I have been getting such great stories from readers of <a title href=\"https://lispcast.com/gs\"><em>Grokking Simplicity</em></a>. People tell me they are making their code more organized and testable. After all of the work I put into the book, it feels good that it’s having such a great impact.</p>\n<p>You can <a title href=\"https://lispcast.com/gs\">buy the book</a> and use the coupon code <strong>TSSIMPLICITY</strong> for 50% off.</p>\n<p>Thanks for reading.</p>\n<h2>Clojure Challenge 🤔</h2>\n<h3>Last week’s challenge</h3>\n<p>The challenge in <a title href=\"https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-352-tip-use-the-right-kind-of-comment-for-the-job/\">Issue 352</a> was to write a program to find all possibilities of putting a +, a -, or nothing between the numbers 1-9, such that it equals 100.</p>\n<p>You can check out the submissions <a title href=\"https://gist.github.com/ericnormand/a3f661ad5b0868e3cc9e1f3e123f3c3e\">here</a>.</p>\n<h3>This week’s challenge</h3>\n<p><em>improvement of daily work</em></p>\n<p>What editor do you use? Whatever the answer, you can probably improve how you use it.</p>\n<p>The challenge this week is to try to improve your editing experience in one small way. Find a new setting that you think might make your life better. Read about a new command and try to learn it. Or maybe change your caps lock key to control. You choose!</p>\n<p>This week’s challenge is not a coding challenge. It’s a personal challenge to improve your daily work. Of course, some things you try won’t improve anything. They might make it worse. But it’s always worth trying.</p>\n<p>BTW, <em>improvement of daily work</em> is the third ideal in <a title href=\"https://itrevolution.com/the-unicorn-project/\"><em>The Unicorn Project</em></a>.</p>\n<p>As usual, please reply to this email and let me know what you tried. I’ll collect them up and share them in the next issue. If you don’t want me to share your submission, let me know.</p>\n<p>Rock on!<br>Eric Normand</p>\n</div>\n<p>The post <a rel=\"nofollow\" href=\"https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-353-tip-string-literals-are-interned/\">PurelyFunctional.tv Newsletter 353: Tip: String literals are interned</a> appeared first on <a rel=\"nofollow\" href=\"https://purelyfunctional.tv\">PurelyFunctional.tv</a>.</p>",
   :direction "ltr"},
  :updated 1574679600000,
  :entities
  [{:mentions [{:text "Strings"}],
    :id "nlp/f/entity/wd:1073856",
    :salienceLevel "mention",
    :label "Strings"}
   {:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "Survey"}],
    :id "nlp/f/entity/wd:1144458",
    :salienceLevel "mention",
    :label "archaeological field survey"}
   {:mentions [{:text "Java"}],
    :id "nlp/f/entity/wd:251",
    :salienceLevel "mention",
    :label "Java"}
   {:mentions [{:text "lookup table"}],
    :id "nlp/f/entity/wd:690265",
    :salienceLevel "mention",
    :label "lookup table"}],
  :alternate
  [{:href
    "https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-353-tip-string-literals-are-interned/",
    :type "text/html"}],
  :title
  "PurelyFunctional.tv Newsletter 353: Tip: String literals are interned",
  :author "Eric Normand",
  :published-str "Mon Nov 25 03:00:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16ea3755e9b:e67500:49b12733",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url "http://img.youtube.com/vi/5mbp3SEha38/0.jpg",
   :width 480,
   :height 360,
   :contentType "image/jpeg"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://purelyfunctional.tv/uncategorized/purelyfunctional-tv-newsletter-353-tip-string-literals-are-interned/",
  :commonTopics
  [{:score 93.2349564466513,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.75,
    :id "nlp/f/topic/774",
    :salienceLevel "mention",
    :label "engineering"}],
  :published 1574679600000,
  :fingerprint "ef3195bc",
  :canonicalUrl
  "https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-353-tip-string-literals-are-interned/"}
 {:engagement 6,
  :unread false,
  :crawled 1574680987443,
  :content
  {:content
   "<p>I recently encountered a slight difficulty with updating <a title=\"Datomic cardinality documentation\" href=\"https://docs.datomic.com/on-prem/schema.html#cardinality\">cardinality many</a> attributes in Datomic, so I thought I would make a short walkthrough post about it.</p>\n<h2>The Problem</h2>\n<p>In Datomic each attribute has a “cardinality”, signifying how many values an attribute is allowed. Cardinality can be either “one” or “many”. Adding values for a cardinality many attribute is fairly straightforward, but updating them to a specific set is more difficult. Let’s take the example of a simple Todo list, where each todo has a title and multiple tags. Our schema looks like this:</p>\n<pre><code>(def schema\n  [{:db/ident :todo/title\n    :db/valueType :db.type/string\n    :db/cardinality :db.cardinality/one}\n   {:db/ident :todo/tags\n    :db/valueType :db.type/string\n    :db/cardinality :db.cardinality/many}])\n</code></pre>\n<p>Creating a new todo with a set of tags is fairly straightforward:</p>\n<pre><code>(d/transact\n conn\n [{:todo/title &quot;Do the dishes&quot;\n   :todo/tags [&quot;whenever&quot;]}])\n</code></pre>\n<p>As is adding a tag to an existing todo:</p>\n<pre><code>(d/transact conn [:db/add todo-entity-id :todo/tags &quot;boring&quot;])\n</code></pre>\n<p>However, setting a todo’s tags to a specific set of values is more difficult. There’s no built-in way to do this in Datomic. Let’s say we want to set the tags for a todo to <code>[&quot;important&quot; &quot;today&quot;]</code>, how would we do that?</p>\n<h2>The Solution</h2>\n<p>One solution is to:</p>\n<ol>\n<li>Query the current values of the attribute</li>\n<li>Diff them with the new values</li>\n<li>Use that diff to create transactions to:\n<ol>\n<li>Add any new values</li>\n<li>Retract values we no longer want</li>\n</ol></li>\n<li>Apply the transactions using <code>d/transact</code></li>\n</ol>\n<p>Here’s the code to do this:</p>\n<pre><code>(defn update-attr-txs [db entity-id attr values]\n  (let [;; Step 1\n        current-vals (-> (d/q '[:find [?p ...]\n                                :where [?id :intention/parents ?p]\n                                :in $ ?id]\n                              db\n                              entity-id)\n                         (set))\n        ;; Step 2\n        [added removed] (clojure.data/diff (set values) current-vals)]\n    ;; Step 3\n    (concat \n      ;; Step 3.1\n      (->> added \n           (map #(-> [:db/add entity-id attr %])))\n      ;; Step 3.2\n      (->> removed\n           (map #(-> [:db/retract entity-id attr %]))))))\n\n ;; Step 4\n (->> (update-attr-txs (d/db conn) todo-entity-id :todo/tags #{&quot;important&quot; &quot;today&quot;})\n      (d/transact conn))\n</code></pre>\n<p>That should be all you need! I’ve created a gist containing the <code>update-attr-txs</code> function <a title=\"gist\" href=\"https://gist.github.com/DaveWM/66bced07550aaf295a3f40dbf263f171\">here</a>. You can find some alternative solutions in <a title=\"Related StackOverflow post\" href=\"https://stackoverflow.com/questions/39432061/updating-value-with-cardinality-many\">this StackOverflow post</a>, and also <a title=\"another StackOverflow post\" href=\"https://stackoverflow.com/questions/42112557/datomic-schema-for-a-to-many-relationship-with-a-reset-operation\">this one</a>.</p>\n<p>I hope this helps you out, please don’t hesitate to get in touch if you have any questions.</p>",
   :direction "ltr"},
  :updated 1574640000000,
  :entities
  [{:mentions [{:text "solution"}],
    :id "nlp/f/entity/wd:5447188",
    :salienceLevel "about",
    :label "solution"}],
  :alternate
  [{:href
    "https://clojure-conundrums.co.uk/posts/datomic-how-to-update-cardinality-many-attribute/",
    :type "text/html"}],
  :title "Datomic how-to: Update Cardinality Many Attribute",
  :author "David Martin",
  :published-str "Sun Nov 24 16:00:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16ea24d0733:ce66a0:69b9f616",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://clojure-conundrums.co.uk/posts/datomic-how-to-update-cardinality-many-attribute/",
  :published 1574640000000,
  :fingerprint "726d28ab",
  :canonicalUrl
  "https://clojure-conundrums.co.uk/posts/datomic-how-to-update-cardinality-many-attribute/"}
 {:engagement 4,
  :unread false,
  :crawled 1574680987443,
  :content
  {:content
   "<p>Consider this Clojure snippet:</p>\n<div><div><pre><code><span>(</span><span>defn</span><span> </span><span>fetch-thing</span><span> </span><span>[</span><span>db</span><span> </span><span>user-id</span><span> </span><span>thing-id</span><span>]</span><span>\n</span><span>(</span><span>if</span><span> </span><span>(</span><span>db/has-permission</span><span> </span><span>db</span><span> </span><span>user-id</span><span> </span><span>thing-id</span><span>)</span><span>\n</span><span>{</span><span>:status</span><span> </span><span>200</span><span> </span><span>:body</span><span> </span><span>(</span><span>db/fetch-thing</span><span> </span><span>db</span><span> </span><span>thing-id</span><span>)}</span><span>\n</span><span>{</span><span>:status</span><span> </span><span>400</span><span>})</span><span>\n</span></code></pre></div></div>\n<p>It’s clean, does clearly what it looks like it does, but there’s a small\nproblem; it doesn’t enforce a transaction. If db is a simple database\nconnection without a transaction and something happens in the database between\nthe second and the third line, for example if the <code>thing</code> referenced by\n<code>thing-id</code> is deleted, the output of <code>db/fetch-thing</code> can get quite\nunpredictable. Could we make this kind of programs safer?</p>\n<h2>Enter Rust</h2>\n<p>Rust is a relatively new programming language, with focus on speed and safety.\nRust has the unique notion of ‘ownership’, which enables memory safety without\nrelying on a garbage collector. Nowadays in most languages all variables are\nactually references, which are just thrown around and are either wildly mutable\nor completely immutable. Rust provides a way to write code where mutation is\nexplicit and safe.</p>\n<p>Rust implements this by providing a unique feature: the borrow checker.\nEssentially, the borrow checker is a compile-time feature which ensures that\nobjects live long enough, and at the same time prevents unsafe concurrent access\nto variables. This is implemented by following a couple of simple rules:</p>\n<ol>\n<li>If an object drops out of scope, it is destroyed</li>\n<li>An object must outlive all references to it</li>\n<li>An object can only have either multiple immutable references, or a single mutable reference</li>\n</ol>\n<p>In this blog post we are mostly concerned about the first rule – if an object\ndrops out of scope, it is destroyed.</p>\n<p>The borrow checker is mostly praised for its ability to enable manual memory\nmanagement without suffering from null pointer exceptions or segfaults – Safe\nRust doesn’t have any null or otherwise invalid references! In my opinion, the\nbest benefit of the borrow checker is not the speedup it provides by\neliminating the garbage collector, but the ability to catch logic bugs. If you\nmanage to construct your problem as a problem around ownership, the Rust\ncompiler can check your logic at compile-time!</p>\n<h2>Trait interlude</h2>\n<p>Rust doesn’t have inheritance nor interfaces. Instead, generic code is\nimplemented around <em>traits</em>. Traits are similar to interfaces in the sense that\nthey contain a bunch of methods, and certain types implement those interfaces.\nTypes can only implement traits either where the type is defined, or where the\ntrait is defined. This unfortunately means that one cannot implement a\nthird-party trait for a third-party type. However, unlike interfaces in eg.\nJava, one can implement their own traits for other types.</p>\n<p>When writing generic code, generic type parameters can receive trait bounds to\nspecify things that can be done with the types. For example, in the following\nfunction</p>\n<div><div><pre><code><span>fn</span> <span>debug_print</span><span>&lt;</span><span>T</span><span>:</span> <span>Debug</span><span>></span><span>(</span><span>t</span><span>:</span> <span>T</span><span>)</span> <span>{</span> <span>dbg!</span><span>(</span><span>t</span><span>);</span> <span>}</span>\n</code></pre></div></div>\n<p>the type T is required to implement the trait <code>Debug</code>, which allows turning the\nobject into an programmer-readable (but not necessarily human-readable) format.</p>\n<p>The generic functions are compiled similarily as in C++: any calls to the\nfunction are specialized to the types, which technically can create binary\nbloat, but practically reduces it as the compiler has better options for\noptimization.</p>\n<h2>Modeling database queries around ownership</h2>\n<p>So, we need to be able to make a single database query without a transaction,\nconvert a database connection into a transaction and make multiple queries\ninside a transaction.</p>\n<p>Sounds like while making a query without a transaction, the connection should\nrefuse any additional queries. If the queries are made within a transaction,\nadditional queries should be accepted. Furthermore, the transactions should be\ncleaned up when dropped, which <code>postgres::Transaction</code> does by default,\ndefaulting to rollback, rather than commit. Let’s sketch an API for it:</p>\n<div><div><pre><code><span>pub</span> <span>fn</span> <span>one</span><span>(</span><span>connection</span><span>:</span> <span>db</span><span>::</span><span>Connection</span><span>)</span> <span>{</span>\n    <span>db</span><span>::</span><span>find_person</span><span>(</span><span>connection</span><span>,</span> <span>&quot;Joe&quot;</span><span>);</span> <span>// OK</span>\n<span>}</span>\n<span>pub</span> <span>fn</span> <span>two</span><span>(</span><span>connection</span><span>:</span> <span>db</span><span>::</span><span>Connection</span><span>)</span> <span>{</span>\n    <span>connection</span><span>.transaction</span><span>(|</span><span>tx</span><span>|</span> <span>{</span>\n        <span>let</span> <span>person</span> <span>=</span> <span>db</span><span>::</span><span>find_person</span><span>(</span><span>&amp;</span><span>tx</span><span>,</span> <span>&quot;John&quot;</span><span>)</span><span>?</span><span>;</span>\n        <span>tx</span><span>.commit</span><span>()</span><span>?</span><span>;</span>\n        <span>Ok</span><span>(</span><span>person</span><span>)</span>\n    <span>});</span>\n<span>}</span>\n<span>pub</span> <span>fn</span> <span>three</span><span>(</span><span>connection</span><span>:</span> <span>db</span><span>::</span><span>Connection</span><span>)</span> <span>{</span>\n    <span>connection</span><span>.transaction</span><span>(|</span><span>tx</span><span>|</span> <span>{</span>\n        <span>let</span> <span>first</span> <span>=</span> <span>db</span><span>::</span><span>find_person</span><span>(</span><span>&amp;</span><span>tx</span><span>,</span> <span>&quot;Mary&quot;</span><span>)</span><span>?</span><span>;</span>\n        <span>let</span> <span>second</span> <span>=</span>  <span>db</span><span>::</span><span>find_person</span><span>(</span><span>&amp;</span><span>tx</span><span>,</span> <span>&quot;Suzy&quot;</span><span>)</span><span>?</span><span>;</span>\n        <span>tx</span><span>.commit</span><span>()</span><span>?</span><span>;</span>\n        <span>Ok</span><span>((</span><span>first</span><span>,</span> <span>second</span><span>))</span>\n    <span>});</span>\n<span>}</span>\n<span>pub</span> <span>fn</span> <span>four</span><span>(</span><span>connection</span><span>:</span> <span>db</span><span>::</span><span>Connection</span><span>)</span> <span>{</span>\n    <span>db</span><span>::</span><span>find_person</span><span>(</span><span>connection</span><span>,</span> <span>&quot;Foo&quot;</span><span>);</span>\n    <span>db</span><span>::</span><span>find_person</span><span>(</span><span>connection</span><span>,</span> <span>&quot;Bar&quot;</span><span>);</span> <span>// ERROR: two queries without a transaction</span>\n<span>}</span>\n</code></pre></div></div>\n<h2>Technical detals</h2>\n<p>The typical <code>postgres</code> connection types are modeled around typical usage rather\nthan this special case, so we clearly need some wrappers around them. Let’s\nstart by defining them:</p>\n<div><div><pre><code><span>pub</span> <span>struct</span> <span>Connection</span><span>(</span><span>Box</span><span>&lt;</span><span>postgres</span><span>::</span><span>Connection</span><span>></span><span>);</span>\n<span>pub</span> <span>struct</span> <span>Transaction</span><span>&lt;</span><span>'a</span><span>></span><span>(</span><span>Box</span><span>&lt;</span><span>postgres</span><span>::</span><span>transaction</span><span>::</span><span>Transaction</span><span>&lt;</span><span>'a</span><span>>></span><span>);</span>\n</code></pre></div></div>\n<p>These types contain exactly one member: the respective <code>postgres</code> connection\ntype, with the crucial difference that <code>Connection</code> and <code>Transaction</code> do not\nderive the <code>Clone</code> trait used to acquire new copies of the connection. Ignore\nthe <code>Box</code> and <code>'a</code>, they only tell Rust that the references to the variables\nexist long enough.</p>\n<p>Next, we need a trait and relevant implementations to convert these types to\nthe trait provided by <code>postgres</code> which provides methods such as <code>query</code>.</p>\n<div><div><pre><code><span>pub</span> <span>trait</span> <span>IntoGenericConnection</span> <span>{</span>\n    <span>type</span> <span>G</span><span>:</span> <span>postgres</span><span>::</span><span>GenericConnection</span><span>;</span>\n    <span>fn</span> <span>into_generic_connection</span><span>(</span><span>&amp;</span><span>self</span><span>)</span> <span>-></span> <span>&amp;</span><span>Self</span><span>::</span><span>G</span><span>;</span>\n<span>}</span>\n\n<span>impl</span> <span>IntoGenericConnection</span> <span>for</span> <span>Connection</span> <span>{</span>\n    <span>type</span> <span>G</span> <span>=</span> <span>postgres</span><span>::</span><span>Connection</span><span>;</span>\n\n    <span>fn</span> <span>into_generic_connection</span><span>(</span><span>&amp;</span><span>self</span><span>)</span> <span>-></span> <span>&amp;</span><span>Self</span><span>::</span><span>G</span> <span>{</span>\n        <span>&amp;</span><span>self</span><span>.</span><span>0</span>\n    <span>}</span>\n<span>}</span>\n\n<span>impl</span><span>&lt;</span><span>'a</span><span>></span> <span>IntoGenericConnection</span> <span>for</span> <span>&amp;</span><span>'a</span> <span>Transaction</span><span>&lt;</span><span>'a</span><span>></span> <span>{</span>\n    <span>type</span> <span>G</span> <span>=</span> <span>postgres</span><span>::</span><span>transaction</span><span>::</span><span>Transaction</span><span>&lt;</span><span>'a</span><span>></span><span>;</span>\n\n    <span>fn</span> <span>into_generic_connection</span><span>(</span><span>&amp;</span><span>self</span><span>)</span> <span>-></span> <span>&amp;</span><span>Self</span><span>::</span><span>G</span> <span>{</span>\n        <span>&amp;</span><span>self</span><span>.</span><span>0</span>\n    <span>}</span>\n<span>}</span>\n\n<span>impl</span> <span>Connection</span> <span>{</span>\n    <span>pub</span> <span>fn</span> <span>transaction</span><span>&lt;</span><span>F</span><span>,</span> <span>R</span><span>,</span> <span>E</span><span>></span><span>(</span><span>self</span><span>,</span> <span>callback</span><span>:</span> <span>F</span><span>)</span> <span>-></span> <span>Result</span><span>&lt;</span><span>R</span><span>,</span> <span>E</span><span>></span>\n    <span>where</span> <span>F</span><span>:</span> <span>FnOnce</span><span>(</span><span>Transaction</span><span>)</span> <span>-></span> <span>Result</span><span>&lt;</span><span>R</span><span>,</span> <span>E</span><span>></span> <span>{</span>\n        <span>let</span> <span>tx</span> <span>=</span> <span>self</span><span>.</span><span>0</span><span>.transaction</span><span>()</span><span>.unwrap</span><span>();</span>\n        <span>let</span> <span>res</span> <span>=</span> <span>callback</span><span>(</span><span>Transaction</span><span>(</span><span>Box</span><span>::</span><span>new</span><span>(</span><span>tx</span><span>)))</span><span>?</span><span>;</span>\n        <span>Ok</span><span>(</span><span>res</span><span>)</span>\n    <span>}</span>\n<span>}</span>\n</code></pre></div></div>\n<p>Then we just call <code>into_generic_connection()</code> while inside the relevant\ndatabase function:</p>\n<div><div><pre><code><span>pub</span> <span>fn</span> <span>find_person</span><span>&lt;</span><span>IGC</span><span>:</span> <span>IntoGenericConnection</span><span>></span><span>(</span><span>db</span><span>:</span> <span>IGC</span><span>,</span> <span>name</span><span>:</span> <span>&amp;</span><span>str</span><span>)</span> <span>-></span> <span>Option</span><span>&lt;</span><span>Person</span><span>></span> <span>{</span>\n    <span>let</span> <span>conn</span> <span>=</span> <span>db</span><span>.into_generic_connection</span><span>();</span>\n    <span>conn</span><span>.query</span><span>(</span><span>&quot;SELECT id, name FROM account WHERE name=$1&quot;</span><span>,</span> <span>&amp;</span><span>[</span><span>&amp;</span><span>name</span><span>])</span><span>.unwrap</span><span>()</span>\n        <span>.into_iter</span><span>()</span>\n        <span>.map</span><span>(|</span><span>row</span><span>|</span> <span>Person</span> <span>{</span> <span>id</span><span>:</span> <span>row</span><span>.get</span><span>(</span><span>0</span><span>),</span> <span>username</span><span>:</span> <span>row</span><span>.get</span><span>(</span><span>1</span><span>)</span> <span>})</span>\n        <span>.next</span><span>()</span>\n<span>}</span>\n</code></pre></div></div>\n<p>With these couple lines of code, any database accesses are guarded against\naccidental unsafe usage. The programmers still have access to the backdoor used\nto gain a reference to the connection without using a transaction (through\n<code>IntoGenericConnection</code>), but using it is explicit, rather than accidental. The\nsame wrapper types can also be used to enforce a transaction around database\nfunctions which make multiple queries simply by replacing the <code>IGC</code> generic\nwith <code>Transaction</code>.</p>\n<p>Now, the last example gives an error message around the lines of the following\nsnippet:</p>\n<div><div><pre><code>error[E0382]: use of moved value: `connection`\n --> src/backend/src/router.rs:3:20\n  |\n1 | pub fn four(connection: db::Connection) {\n  |             ---------- move occurs because `connection` has type\n  |             `db_traits::Connection`, which does not implement the\n  |             `Copy` trait\n2 |     db::find_person(connection, &quot;Foo&quot;);\n  |                     ---------- value moved here\n3 |     db::find_person(connection, &quot;Bar&quot;);\n  |                     ^^^^^^^^^^ value used here after move\n</code></pre></div></div>\n<h2>Performance</h2>\n<p>Does this provide any performance drawbacks? Both <code>Connection</code> and\n<code>Transaction</code> are exactly the size of <code>Box</code>, which means moving them around is\nessentially free. Both implementations of <code>into_generic_connection</code> are no-ops,\nas boxes are secretly just pointers, and the trait methods are referencing the\nfirst and only member of the struct – which is a no-op. Thus, there shouldn’t\nbe any performance hits when using this method.</p>\n<p>Another way to implement this would be to use a zero-sized type for connections\nand load the connection when converting to GenericConnection or Transaction,\nbut the implementations would be more complex.</p>\n<h2>Conclusion</h2>\n<p>While a relatively new language, Rust can already be used to tackle practical\nproblems. This is just one example how Rust can be used to implement safe and\nfast programs.</p>",
   :direction "ltr"},
  :updated 1574294400000,
  :entities
  [{:mentions [{:text "programming language"}],
    :id "nlp/f/entity/wd:9143",
    :salienceLevel "mention",
    :label "programming language"}
   {:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "memory management"}],
    :id "nlp/f/entity/wd:2308807",
    :salienceLevel "mention",
    :label "memory management"}
   {:mentions [{:text "error message"}],
    :id "nlp/f/entity/wd:1332193",
    :salienceLevel "mention",
    :label "error message"}
   {:mentions [{:text "C++"}],
    :id "nlp/f/entity/wd:2407",
    :salienceLevel "mention",
    :label "C++"}],
  :alternate
  [{:href
    "http://dev.solita.fi/2019/11/21/enforcing-database-transactions-with-rust.html",
    :type "text/html"}],
  :title "Enforcing database transactions with Rust",
  :author "Solita Oy",
  :published-str "Wed Nov 20 16:00:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16ea24d0733:ce669f:69b9f616",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url
   "https://dev.solita.fi/img/solita-logomark-white-on-red-400px.png",
   :width 400,
   :height 400,
   :contentType "image/png"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "http://dev.solita.fi/2019/11/21/enforcing-database-transactions-with-rust",
  :commonTopics
  [{:score 74.24829341718113,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1574294400000,
  :fingerprint "6a32f7e3",
  :canonicalUrl
  "http://dev.solita.fi/2019/11/21/enforcing-database-transactions-with-rust.html"}
 {:engagement 5,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}
   {:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/todo",
    :label "todo"}],
  :unread false,
  :crawled 1574663877295,
  :content
  {:content
   "<p>In a recent episode, I said structural similarity comes from the algebraic properties of the relationships between things. But that’s not the case. Rotislav mentioned in the comments that it actually comes from the structure in the relationships. I explore that idea in this episode.</p>\n<p></p>\n<div>\n<div><span></span><img alt=\"Video Thumbnail\" src=\"https://i.ytimg.com/vi/UIRqTMVIROE/mqdefault.jpg\"><p></p>\n<h5>Where does structural similarity come from?</h5>\n<p><span>In a recent episode, I said structural similarity comes from the algebraic properties of the relationships between things. But that's not the case. Rotislav mentioned in the comments that it actually comes from the structure in the relationships. I explore that idea in this episode. https://share.tr</span></p></div>\n</div>\n<h2>Transcript</h2>\n<p>Eric Normand: Where does structural similarity come from?</p>\n<p>In this episode I’m going to explore this idea that when we implement a real-world process on the computer, there’s got to be something that gets shared. I talked about this in a previous episode but I got a really good YouTube comment, so I’m going to go even deeper and further, and deliver a correction of what I was talking about.</p>\n<p>My name is Eric Normand, and I help people thrive with functional programming.</p>\n<p>I got this YouTube comment from — I hope that I don’t butcher the name but I will, so I apologize in advance, if I do — Rostislav Svoboda on YouTube commented on my episode called “Why are algebraic properties important?”</p>\n<p>In that I said that when we implement something, something is being translated from the real world to a digital representation. Something has to be the same or we wouldn’t get the same answer.</p>\n<p>Just like if I count apples and then I count the same number of oranges, I should get the same answer even though one is apple and one is orange. Something is the same between those two piles of fruit.</p>\n<p>I was talking about in that episode that it must be that we’re capturing a bunch of the properties of those operations. When we’re counting, we’re really adding one, adding one, adding one. We must be capturing this commutative property or the associative properties.</p>\n<p>If you do enough of the properties, the important ones for doing that algorithm or that process that you’re doing, you will succeed in translating the important stuff.</p>\n<p>Rostislav brings up a good point, which is that the relationship itself, the function itself, is what gets translated over and the properties are just kind of incidental. When I’m counting apples and I’m counting oranges, I’m adding one each time. It’s the same operation that I’m doing.</p>\n<p>When I’m translating, say, an accounting practice from a person’s head who’s doing stuff in the real world, and I’m translating that into…They’re writing stuff in notebooks and looking stuff up. They’ve got a process that they’re doing. I’m translating that into a digital algorithm, a digital program. Is it the properties of those operations that make it work?</p>\n<p>What he’s saying is, “No, there’s more structural similarity there.” There’s a relationship between the numbers on the page and the total, meaning it’s the sum.</p>\n<p>Now, I have to have a thing that is…It might not be a sum. It might be something else when I translate it, but it is structurally similar to it. It turns out it’s going to be a sum because you want to get the same number answer. You have to use the same operation.</p>\n<p>Maybe that’s not a good idea, not a good example, but the properties of it are just incidental. They are not what you want to translate. For instance, if you used multiplication, it’s still commutative and associative. You’re not going to get the same answer so it’s not going to work.</p>\n<p>Is translating the properties the thing to do? Probably not, but there are structurally similar operations going on, the relationships, the functions that you’re using. Functions and relationships and math are…A function represents a relationship between the input, the argument and the output, the return value or the domain and the range, if you will.</p>\n<p>There’s a relationship. It defines a relationship. If you define a structurally identical relationship, then you can use that in your software.</p>\n<p>Here’s an example of a structurally similar relationship. In the real world, when we talk about the days of the week — Monday, Tuesday Wednesday, Thursday, Friday, Saturday, Sunday. In the computer, it doesn’t know, it doesn’t care what the days are called. Usually, it’s like zero, one, two, three, four, five, six.</p>\n<p>Why is it possible to use numbers to represent days? It’s a totally different system. Why is it that in the human level interaction we’re using named days, and in the computer, we can use numbers?</p>\n<p>There’s a little translation if we need to print out the name of the day, that’s easy, but why is it that we’re allowed to do that and get the same answer?</p>\n<p>The reason is, structurally, there is an order to the days of the week, the names. We know the order, we memorize it as kids. We know that it cycles around, and we can apply that same thing to the numbers.</p>\n<p>There’s an order to the numbers zero, one, two, three, four, five, six, and we can make it cycle around. The easy way to do that is using mod. You just mod it by seven. Now, you get a cycle as you add one.</p>\n<p>These two things are different. They are not the same, but they share enough structure to get at the important thing, which is that there’s an order and it cycles. That is different from the algebraic properties. He was right, I was wrong about that. It’s not the algebraic properties. Those are kind of incidental.</p>\n<p>They’re still useful to know if you’ve captured what you need to capture, but you can’t just say, “This operation has these properties. This other operation has the same properties. That means we can interchange them.” It’s not true, you can’t. There needs to be some deeper structure in it, like I was talking about with the days of the week.</p>\n<p>All right. Thank you, Rostislav, for that insightful comment. I really appreciate that.</p>\n<p>There’s a lot of people out there who have thought about this much deeper than I have. I’m very curious, and I’m very grateful that people would take the time to help me understand this better, and in turn help everyone understand it better. Thank you so much.</p>\n<p>If you enjoyed this episode, you can find all the past episodes at lispcast.com/podcast. There you will find audio, video, and text transcripts of all of the past episodes. You’ll also find links to subscribe and how to get in touch with me on social media, including email, YouTube, Twitter, LinkedIn.</p>\n<p>I love this. I love the discussion. I love the back and forth. This is so great. Thank you so much for commenting.</p>\n<p>This has been my thought on functional programming. My name is Eric Normand. Thank you for listening, and rock on.</p>\n<p>The post <a rel=\"nofollow\" href=\"https://lispcast.com/where-does-structural-similarity-come-from/\">Where does structural similarity come from?</a> appeared first on <a rel=\"nofollow\" href=\"https://lispcast.com\">LispCast</a>.</p>",
   :direction "ltr"},
  :updated 1574661600000,
  :entities
  [{:mentions [{:text "YouTube"}],
    :id "nlp/f/entity/wd:866",
    :salienceLevel "about",
    :label "YouTube"}
   {:mentions [{:text "Rostislav"}],
    :id "nlp/f/entity/wd:2167906",
    :salienceLevel "mention",
    :label "Rostislav"}
   {:mentions [{:text "functional programming"}],
    :id "nlp/f/entity/wd:193076",
    :salienceLevel "mention",
    :label "functional programming"}
   {:mentions [{:text "commutative property"}],
    :id "nlp/f/entity/wd:165474",
    :salienceLevel "mention",
    :label "commutative property"}],
  :alternate
  [{:href
    "https://lispcast.com/where-does-structural-similarity-come-from/",
    :type "text/html"}],
  :title "Where does structural similarity come from?",
  :author "Eric Normand",
  :published-str "Sun Nov 24 22:00:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16ea147f2af:b6d1b5:49b12733",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url "http://img.youtube.com/vi/UIRqTMVIROE/0.jpg",
   :width 480,
   :height 360,
   :contentType "image/jpeg"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :decorations {:Pocket "https://app.getpocket.com/read/2802892841"},
  :originId "https://lispcast.com/?p=2088",
  :published 1574661600000,
  :fingerprint "7a96ad0a",
  :canonicalUrl
  "https://lispcast.com/where-does-structural-similarity-come-from/"}
 {:engagement 10,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/todo",
    :label "todo"}
   {:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1574638762761,
  :content
  {:content
   "<p>All the <a href=\"https://technomancy.itch.io/bussard\">games</a>\n<a href=\"https://technomancy.itch.io/liquid-runner\">I've</a>\n<a href=\"https://technomancy.itch.io/goo-runner\">created</a>\n<a href=\"https://technomancy.itch.io/exo-encounter-667\">previously</a>\nhave used the <a href=\"https://love2d.org\">LÖVE</a> framework,\nwhich I heartily recommend and have really enjoyed using. It's\nextremely flexible but provides just the right level of\nabstraction to let you do any kind of 2D game. I have even\ncreated <a href=\"https://git.sr.ht/~technomancy/polywell\">a text\neditor</a> in it. But for\nthe <a href=\"https://itch.io/jam/lisp-game-jam-2019\">2019 Lisp\nGame Jam</a> I teamed up again\nwith <a href=\"https://emmabukacek.com\">Emma Bukacek</a> (we first\nworked together\non <a href=\"https://technomancy.itch.io/goo-runner\">Goo Runner</a>\nfor the previous jam) and wanted to try something\nnew: <a href=\"https://tic.computer\">TIC-80</a>.</p>\n<p><img alt=\"tic-80 screenshot\" src=\"https://technomancy.us/i/tic80.gif\"></p>\n<p>TIC-80 is what's referred to as a &quot;fantasy\nconsole&quot;<sup><a href=\"https://technomancy.us#fn1\">1</a></sup>; that is, a piece of\nsoftware which embodies an imaginary computer which never actually\nexisted. Hearkening back to the days of the Commodore 64, it has a\n16-color palette, a 64kb limit on the amount of code you can load\ninto it, and 80kb of space for data (sprites, maps, sound, and\nmusic). While these limitations may sound severe, the idea is that\nthey can be liberating because there is no pressure to create\nsomething polished; the medium demands a rough, raw style.</p>\n<p>The really impressive thing about TIC-80 you notice right away is\nhow it makes game development so accessible. It's one file to\ndownload (or not even download; it runs perfectly fine in a browser)\nand you're off to the races; the code editor, sprite editor, mapper,\nsound editor, and music tracker are all built-in. But the best part\nis that you can explore other people's games (with the <tt>SURF</tt>\ncommand), and once you've played them, hit ESC to open the editor\nand see how they did it. You can make changes to the code,\nsprites, etc and immediately see them reflected. This kind of\nexplore-and-tinker approach encourages you to experiment and see for\nyourself what happens.</p>\n<p>In fact, try it now! Go\nto <a href=\"https://technomancy.itch.io/this-is-my-mech\">This is my\nMech</a> and hit <tt>ESC</tt>, then go down to &quot;close game&quot; and\npress <tt>Z</tt> to close it. You're in the console now, so\nhit <tt>ESC</tt> again to go to the editor, and press the sprite\neditor button at the top left. Change some of the character sprites,\nthen hit <tt>ESC</tt> to go back to the console and\ntype <tt>RUN</tt> to see what it does! The impact of the accessibility and\nimmediacy of the tool simply can't be overstated; it calls out to be\nhacked and fiddled and tweaked.\n</p><p>Having decided on the platform, Emma and I threw around a few game\nideas but landed on making an adventure/comedy game based on the\nmusic video <a href=\"https://m.youtube.com/watch?v=EMgsAD3D948\">I'll\nform the Head</a> by MC Frontalot, which is in turn a parody of the\n1980s\ncartoon <a href=\"https://en.m.wikipedia.org/wiki/Voltron\">Voltron</a>,\na mecha series about five different pilots who work together to form\na giant robot that fights off the monster of the week. Instead of\nmaking the game about combat, I wanted a theme of cooperation, which\nled to a gameplay focused around dialog and conversation.</p>\n<p><img alt=\"I'll form the head music video\" width=\"800\" src=\"https://technomancy.us/i/head.png\"></p>\n<p>I focused more on the coding and the art, and Emma did most of the\nwriting and all of the music. One big difference when coding on\nTIC-80 games vs LÖVE is that you can't pull in any 3rd-party\nlibraries; you have the Lua/Fennel standard library,\nthe <a href=\"https://github.com/nesbox/TIC-80/wiki#functions\">TIC-80\nAPI</a>, and whatever you write yourself. In fact, TIC-80's code\neditor supports only a single file. I'm mostly OK with\nTIC-80's limitations, but that seemed like a bit much, especially\nwhen collaborating, so I split out several different files and\nedited them in Emacs, using a Makefile to concatenate them together\nand TIC-80's &quot;watch&quot; functionality to load it in upon changes. In\nretrospect, while having functionality organized into different files\nwas nice, it wasn't worth the downside of having the line numbers\nbe incorrect, so I wouldn't do that part again.</p>\n<p>The file watch feature was pretty convenient, but it's worth noting\nthat the changes were only applied when you started a new game. (Not\nnecessarily restarting the whole TIC-80 program, just\nthe <tt>RUN</tt> command.) There's no way to load in new code from a\nfile without restarting the game. You <em>can</em> evaluate new code\nwith the <tt>EVAL</tt> command in the console and\nthen <tt>RESUME</tt> to see the effect it has on a running game, but\nthat only applies to a single line of code typed into the console,\nwhich is pretty limiting compared to LÖVE's\nfull <a href=\"https://technomancy.us/189\">support for hot-loading any module from disk at\nany time</a> that I wrote about previously. This was the biggest\ndisadvantage of developing in TIC-80 by a significant\nmargin. Luckily our game didn't have much state, so constantly\nrestarting it wasn't a big deal, but for other games it would\nbe.<sup><a href=\"https://technomancy.us#fn2\">2</a></sup></p>\n<p><b>Update</b>: I was able\nto <a href=\"https://github.com/nesbox/TIC-80/pull/840\">add the above\nfeature</a> with a small amount of code, and it was merged\npromptly. It will be included in TIC-80 version 0.80.0. You must\nlaunch the game with the <tt>-code-watch</tt> flag and run\nthe <tt>RESUME</tt> command to activate it. In order to take\nadvantage of this you need to store game state in a global and\nensure not to overwrite that global if it already has a value.</p>\n<p>Another minor downside of collaborating on a TIC-80 game is that\nthe cartridge is a single binary file. You can set it up so it loads\nthe source from an external file, but the rest of the game (sprites,\nmap, sound, and music) are all stored in one place. If you use git\nto track it, you will find that one person changing a sprite and\nanother changing a music track will result in a conflict you can't\nresolve using git. Because of this, we would claim a &quot;cartridge\nlock&quot; in chat so that only one of us was working on non-code assets\nat a time, but it would be much nicer if changes to sprites could\nhappen independently of changes to music without conflict.</p>\n<p><img alt=\"screenshot of the game\" src=\"https://technomancy.us/i/mech.gif\"></p>\n<p>Since the game consisted of mostly dialog,\nthe <a href=\"https://gitlab.com/emmabukacek/this-is-my-mech/blob/master/dialog.fnl\">conversation\nsystem</a> was the central place to start. We used coroutines to\nallow a single conversation to be written in a linear, top-to-bottom\nway and react to player input but still run without blocking the\nmain event loop. For instance, the function below moves the Adam\ncharacter, says a line, and then asks the player a question which\nhas two possible responses, and reacts differently depending on\nwhich response is chosen. In the second case, it\nsets <tt>convos.Adam</tt> so that the next time you talk to that\ncharacter, a different conversation will begin:</p>\n<pre>(<span>fn</span> <span>all.Adam2</span> []\n  (move-to <span>:Adam</span> 48 25)\n  (say <span>&quot;Hey, sorry about that.&quot;</span>)\n  (<span>let</span> [answer (ask <span>&quot;What's up?&quot;</span> [<span>&quot;What are you doing?&quot;</span>\n                                  <span>&quot;Where's the restroom?&quot;</span>])]\n    (<span>if</span> (<span>=</span> answer <span>&quot;Where's the restroom?&quot;</span>)\n        (say <span>&quot;You can pee in your pilot suit; isn't&quot;</span>\n             <span>&quot;technology amazing? Built-in&quot;</span>\n             <span>&quot;waste recyclers.&quot;</span>)\n        (<span>=</span> answer <span>&quot;What are you doing?&quot;</span>)\n        (<span>do</span> (say <span>&quot;Well... I got a bit flustered and&quot;</span>\n                 <span>&quot;forgot my password, and now I'm&quot;</span>\n                 <span>&quot;locked out of the system!&quot;</span>)\n            (<span>set</span> <span>convos.Adam</span> <span>all.Adam25</span>)\n            (<span>all.Adam25</span>)))))</pre>\n<p>There was some syntactic redundancy with the questions which could\nhave been tidied up with a macro. In older versions of Fennel, the\nmacro system is tied to the module system, which is normally fine,\nbut TIC-80's single-file restriction makes it so that style of\nmacros were unavailable. Newer versions of Fennel don't have this\nrestriction, but unfortunately the latest stable version of TIC-80\nhasn't been updated yet. Hopefully this lands soon! The new version\nof Fennel also includes pattern matching, which probably would have\nmade a custom question macro unnecessary.</p>\n<p>The vast majority of the code is dialog/conversation code; the rest\nis for walking around with collision detection, and flying around in\nthe end-game sequence. This\nis <a href=\"https://gitlab.com/emmabukacek/this-is-my-mech/blob/master/launch.fnl\">pretty\nstandard animation fare</a> but was a lot of fun to write!</p>\n<p><img alt=\"rhinos animation\" src=\"https://technomancy.us/i/rhinos.gif\"></p>\n<p>I mentioned TIC-80's size limit already; with such a dialog-heavy game\nwe did run into that on the last day. We were close enough to the\ndeadline with more we wanted to add that it caused a bit of a\npanic, but all we had to do was remove a bunch of commented code\nand we were able to squeeze what we needed in. Next time around I would use\nsingle-space indents just to save those few extra bytes.</p>\n<p>All in all I think the downsides of TIC-80 were well worth it for a\npixel-art style, short game. Being able to publish the game to an\nHTML file and easily publish it\nto <a href=\"https://itch.io\">itch.io</a> (the site hosting the jam)\nwas very convenient. It's especially helpful in a jam situation\nbecause you want to make it easy for as many people as possible to\nplay your game so they can rate it; if it's difficult to install a\nlot of people won't do it. I've never done my own art for a game\nbefore, but having all the tools built-in convinced me to give it a\ntry, and it turned out pretty good despite me not having any\nbackground in pixel art, or art of any kind.</p>\n<p>Anyway, I'd encourage you to give the game a try. The\ngame <a href=\"https://itch.io/jam/lisp-game-jam-2019/results\">won\nfirst place</a> in the game jam, and you can finish it\nin around ten minutes in your browser. And if it looks like fun, why\nnot make your own in TIC-80?</p>\n<hr>\n<p>[<a name=\"fn1\">1</a>] The term &quot;fantasy console&quot; was coined\nby <a href=\"https://lexaloffle.com/pico-8.php\">PICO-8</a>, a\ncommercial product with limitations even more severe than\nTIC-80. I've done a few short demos with PICO-8 but I much prefer\nTIC-80, not just because it's free software, but because it supports\nFennel, has a more comfortable code editor, and has a much more\nreadable font. PICO-8 only supports a fixed-precision decimal fork\nof Lua. The only two advantages of PICO-8 are the larger community\nand the ability to set flags on sprites.</p>\n<p>[<a name=\"fn2\">2</a>] I'm considering looking into adding support\nin TIC-80 for reloading the code without wiping the existing\nstate. The author has been very friendly and receptive to\ncontributions in the past, but this change might be a bit too much\nfor my meager C skills.</p>",
   :direction "ltr"},
  :updated 1574606561000,
  :entities
  [{:mentions [{:text "TIC"}],
    :id "nlp/f/entity/wd:7807996",
    :salienceLevel "mention",
    :label "Tinak Airport"}
   {:mentions [{:text "editor"} {:text "Text editor"}],
    :id "nlp/f/entity/wd:131212",
    :salienceLevel "mention",
    :label "Text editor"}
   {:mentions [{:text "ESC"}],
    :id "nlp/f/entity/wd:276",
    :salienceLevel "mention",
    :label "Eurovision Song Contest"}
   {:mentions [{:text "game jam"}],
    :id "nlp/f/entity/wd:5519943",
    :salienceLevel "mention",
    :label "game jam"}
   {:mentions [{:text "Lua"}],
    :id "nlp/f/entity/wd:207316",
    :salienceLevel "mention",
    :label "Lua"}],
  :alternate [{:href "https://technomancy.us/191", :type "text/html"}],
  :title "in which we get socially rendered",
  :author "Phil Hagelberg",
  :published-str "Sun Nov 24 06:42:41 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16e9fc8bb09:a041e4:69b9f616",
  :visual {:url "none"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "tag:technomancy.us,2007:191",
  :commonTopics
  [{:score 32.522533791854435,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 20.007906815355163,
    :id "nlp/f/topic/3029",
    :salienceLevel "about",
    :label "games"}],
  :published 1574606561000,
  :fingerprint "89726ba8",
  :canonicalUrl "https://technomancy.us/191"}
 {:engagement 5,
  :unread false,
  :crawled 1574476561834,
  :content
  {:content
   "Peter Strömberg talks about Calva, VS Code, Clojurists Together funding, and how you can contribute.. Calva on GitHub How to contribute to Calva Clojure Warrior Clojure-lsp Language Server Protocol The Calva Team Peter Strömberg Kevin Stehn Christian Fehse",
   :direction "ltr"},
  :updated 1574473446000,
  :entities
  [{:mentions [{:text "Peter Strömberg"}],
    :id "nlp/f/entity/wd:47512140",
    :salienceLevel "about",
    :label "Peter Strömberg"}
   {:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "about",
    :label "Clojure"}
   {:mentions [{:text "VS Code"}],
    :id "nlp/f/entity/wd:19841877",
    :salienceLevel "mention",
    :label "Visual Studio Code"}],
  :alternate
  [{:href "https://www.therepl.net/episodes/33/", :type "text/html"}],
  :title "33: Peter Strömberg on Calva, a Clojure plugin for VS Code",
  :author "Daniel Compton",
  :published-str "Fri Nov 22 17:44:06 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16e961dbdaa:73f86:69b9f616",
  :visual {:url "none"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://www.therepl.net/episodes/33/",
  :commonTopics
  [{:score 86.95013643312488,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 66.50666080640212,
    :id "nlp/f/topic/3024",
    :salienceLevel "about",
    :label "sport"}],
  :published 1574473446000,
  :fingerprint "c86cc838",
  :canonicalUrl "https://www.therepl.net/episodes/33/"}
 {:engagement 6,
  :unread false,
  :crawled 1574463826814,
  :content
  {:content
   "Peter Strömberg talks about Calva, VS Code, Clojurists Together funding, and how you can contribute.. Calva on GitHub How to contribute to Calva Clojure Warrior Clojure-lsp Language Server Protocol The Calva Team Peter Strömberg Kevin Stehn Christian Fehse",
   :direction "ltr"},
  :updated 1574127846000,
  :entities
  [{:mentions [{:text "Peter Strömberg"}],
    :id "nlp/f/entity/wd:47512140",
    :salienceLevel "about",
    :label "Peter Strömberg"}
   {:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "about",
    :label "Clojure"}
   {:mentions [{:text "VS Code"}],
    :id "nlp/f/entity/wd:19841877",
    :salienceLevel "mention",
    :label "Visual Studio Code"}],
  :alternate
  [{:href "https://www.therepl.net/episodes/34/", :type "text/html"}],
  :title "34: Peter Strömberg on Calva, a Clojure plugin for VS Code",
  :author "Daniel Compton",
  :published-str "Mon Nov 18 17:44:06 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16e955b6b7e:d4533b:49b12733",
  :visual {:url "none"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://www.therepl.net/episodes/34/",
  :commonTopics
  [{:score 86.95013643312488,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 66.50666080640212,
    :id "nlp/f/topic/3024",
    :salienceLevel "about",
    :label "sport"}],
  :published 1574127846000,
  :fingerprint "c8047d7b",
  :canonicalUrl "https://www.therepl.net/episodes/34/"}
 {:engagement 5,
  :unread false,
  :crawled 1574461656651,
  :content
  {:content
   "<p>Each week, we discuss a different topic about Clojure and functional programming.</p>\n<p>If you have a question or topic you’d like us to discuss, tweet <a href=\"https://twitter.com/clojuredesign\">@clojuredesign</a>, send an email to <a href=\"mailto:feedback@clojuredesign.club\">feedback@clojuredesign.club</a>, or join the <code>#clojuredesign-podcast</code> channel on the <a href=\"http://clojurians.net/\">Clojurians Slack</a>.</p>\n<p>This week, the topic is: <strong>“Opt-In Complexity”</strong> We discuss complexity and try to come up with a simple explanation for why Clojurians avoid it so ruthlessly.</p>\n<p>Selected quotes:</p>\n<ul>\n<li>“Abstraction: the thing that creates more complexity while making you feel like you have less.”</li>\n<li>“Clojure people seem to be allergic to complexity.”</li>\n<li>“Frameworks are the breeding ground for complexity.”</li>\n<li>“Complexity is the enemy of long lived code bases.”</li>\n<li>“Each part of the application is in its own vault of isolation, and they only get to come together and interact in the lobby.”</li>\n<li>“You can’t be afraid of something that hasn’t scared you yet.”</li>\n<li>“It’s very difficult to say no once you’ve said yes.”</li>\n</ul>\n<p>Links:</p>\n<ul>\n<li><a href=\"https://www.infoq.com/presentations/Simple-Made-Easy/\">Simple Made Easy</a></li>\n<li><a href=\"http://www.luminusweb.net/\">Luminus</a></li>\n<li><a href=\"http://hoplon.io/\">Hoplon</a></li>\n<li><a href=\"http://pedestal.io/\">Pedestal</a></li>\n</ul>",
   :direction "ltr"},
  :updated 1574434800000,
  :entities
  [{:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "about",
    :label "Clojure"}
   {:mentions [{:text "functional programming"}],
    :id "nlp/f/entity/wd:193076",
    :salienceLevel "about",
    :label "functional programming"}],
  :alternate
  [{:href "https://clojuredesign.club/episode/056-opt-in-complexity/",
    :type "text/html"}],
  :title "Ep 056: Opt-in Complexity",
  :author "Christoph Neumann and Nate Jones",
  :published-str "Fri Nov 22 07:00:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16e953a4e4b:d1ae35:49b12733",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://clojuredesign.club/episode/056-opt-in-complexity/",
  :commonTopics
  [{:score 36.13464060579113,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.938,
    :id "nlp/f/topic/349",
    :salienceLevel "about",
    :label "business"}
   {:score 0.828,
    :id "nlp/f/topic/1695",
    :salienceLevel "mention",
    :label "parenting"}
   {:score 0.784,
    :id "nlp/f/topic/861",
    :salienceLevel "mention",
    :label "finance"}],
  :published 1574434800000,
  :fingerprint "13c560ce",
  :canonicalUrl
  "https://clojuredesign.club/episode/056-opt-in-complexity/"}
 {:engagement 6,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1574440942313,
  :content
  {:content
   "<p><em>This is a repost. You can find the original <a title=\"Boot + Middleman: The ClojureScript development environment of my dreams\" href=\"https://hashrocket.com/blog/posts/the-front-end-development-environment-of-my-dreams\">here</a></em></p>\n<p>I’m getting closer to the frontend development environment of my dreams. The\ncombination of editor integration, live browser reload, and not having to\nmanually run commands over and over is time-saving and a pleasure to\nwork with.</p>\n<p>At Hashrocket, designers and developers work very closely\ntogether. Visual design and markup is handled by our\ndesigners, who create “stubbed out” templates in <a href=\"https://hashrocket.com/blog/posts/managing-design-handoffs-with-the-ui-controller\">the UI\ndirectory</a>.\nIt’s a process that works very well for us, and\nallows us to iteratively add features to an application.</p>\n<p>This process has served us very well in Rails using a <a href=\"https://hashrocket.com/blog/posts/managing-design-handoffs-with-the-ui-controller\">UI\ncontroller</a>,\navailable only in development mode.</p>\n<p>I’ve been using ClojureScript a lot lately, particularly with Om, and\nhave missed that directory of collaboration. After all, the designers\nat Hashrocket have a proclivity for HAML and SASS.</p>\n<p>In the past, I’ve set up a separate repository using <a href=\"https://middlemanapp.com\">Middleman</a> to\nhandle markup and styles, using <code>middleman build</code>, copying the generated\nCSS files, and eyeballing the generated markup to ensure it matched the\nOm component’s markup. Aside from being tedious, it’s really easy to\nget out of sync with a manual process like this. The static resource\ngeneration should be a part of our build process.</p>\n<p>Enter <a href=\"https://boot-clj.com\">boot</a>.</p>\n<h3>Using Boot for ClojureScript development</h3>\n<p>If you’re new to the Clojure world, you may have heard of <a href=\"https://leiningen.org\">Leiningen</a>,\nwhich is the de facto dependency management and build tool for\nClojure/Script. Boot is similar to Leiningen, but adds the ability to\ncompose tasks to create build pipelines. This composability, along with\nsome really smart architectural decisions, is what makes boot a great\nchoice for the problem at hand.</p>\n<p>Adzerk’s <a href=\"https://github.com/adzerk-oss/boot-cljs-example\">example repo</a>\nis a great way to get started with ClojureScript and boot. Of particular\nnote is the <code>build.boot</code> file. It demonstrates how one can build\nup a <code>dev</code> task that watches a directory for changes, rebuilding\nClojureScript sources, and notifying the browser to reload the code. It\nincludes the setup necessary for source maps, a development server,\nand the browser-connected REPL. But what I want to add to that pot\nof awesome is the ability to compile HAML and SASS as a part of the\npipeline.</p>\n<h3>boot-middleman: Gluing Everything Together</h3>\n<p>I had an epiphany one night after working on this problem for a while: I\ncan just use Middleman. After all, boot and the ClojureScript compiler\nrun on the JVM, and JRuby is easily embeddable. After a short bit, I\ncame up with <a href=\"https://github.com/jgdavey/boot-middleman\">boot-middleman</a>, the glue I needed to build HAML/SASS as\na part of my build process.</p>\n<p>It assumes a subdirectory is a Middleman app (<code>assets</code> by default). This\nworks nicely because my designer pals can collaborate with me without\nhaving to use the JVM at all. They just run <code>middleman</code> in the <code>assets</code>\nsubdirectory and work as normal.</p>\n<p>See the boot-middleman README for instructions on setting up.</p>\n<p>I used this workflow to create a minesweeper clone, <a href=\"https://github.com/jgdavey/minesweeper\">the\nsource</a> of which is on GitHub.\nJust clone and run <code>boot dev</code>.</p>\n<h3>The Workflow in Action</h3>\n<p>To see the workflow in action, check out the following video. It\ndemonstrates how editing front-end files do not require a manual browser\nrefresh to see the effects.</p>",
   :direction "ltr"},
  :updated 1574437732000,
  :entities
  [{:mentions [{:text "Middleman"}],
    :id "nlp/f/entity/wd:6841808",
    :salienceLevel "about",
    :label "Middleman (band)"}
   {:mentions [{:text "Leiningen"}],
    :id "nlp/f/entity/wd:205362",
    :salienceLevel "mention",
    :label "Leiningen"}
   {:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "Workflow"}],
    :id "nlp/f/entity/wd:627335",
    :salienceLevel "mention",
    :label "Workflow"}
   {:mentions [{:text "de facto"}],
    :id "nlp/f/entity/wd:712144",
    :salienceLevel "mention",
    :label "de facto"}],
  :alternate
  [{:href "http://joshuadavey.com/2015/06/04/boot-middleman/",
    :type "text/html"}],
  :title
  "Boot + Middleman: The ClojureScript development environment of my dreams",
  :author "Joshua Davey",
  :published-str "Fri Nov 22 07:48:52 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16e93fe3ae9:bbe3d1:97b0c8f7",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "http://joshuadavey.com/2015/06/04/boot-middleman/",
  :commonTopics
  [{:score 57.18928382509157,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1574437732000,
  :fingerprint "f826c829",
  :canonicalUrl
  "https://hashrocket.com/blog/posts/the-front-end-development-environment-of-my-dreams"}
 {:engagement 6,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1574339924929,
  :content
  {:content
   "<p>Of course immutable data structures are great, but are they necessary for FP? Short answer is: no. There’s a lot of functional ideas and perspectives that can be applied even if you don’t have them. And you can always make things immutable through discipline. In this episode, we explore those two ideas.</p>\n<p></p>\n<div>\n<div><span></span><img alt=\"Video Thumbnail\" src=\"https://i.ytimg.com/vi/6nlnb1uHbf0/mqdefault.jpg\"><p></p>\n<h5>Do you need immutability for functional programming?</h5>\n<p><span>Of course immutable data structures are great, but are they necessary for FP? Short answer is: no. There's a lot of functional ideas and perspectives that can be applied even if you don't have them. And you can always make things immutable through discipline. In this episode, we explore those two id</span></p></div>\n</div>\n<h2>Transcript</h2>\n<p>Eric Normand: Do you need immutability for Functional Programming? In this episode, we’re going to explore the question of whether it is necessary to have immutable data structures and other kinds of immutability in order to do Functional Programming.</p>\n<p>My name is Eric Normand, and I help people thrive with Functional Programming. I hear this a lot in podcasts. Also people ask me, they get in touch with me over email or Twitter. The ones that bug me the most are in podcasts. Those bug me. It doesn’t bug me to get questions, that’s great.</p>\n<p>I hear people say, “Oh, we can’t do Functional Programming because we need immutability.” Or, “We can’t implement this algorithm in a functional way because we need mutation.” Something like that.</p>\n<p>It’s troubling because immutability, immutable data structures, that’s all good. There’s no denying that it’s a useful tool, but it is just a tool. It’s not a requirement for Functional Programming.</p>\n<p>It helps tremendously, but you can still apply a functional thinking, a functional mindset to situations where things are mutable. That still helps. I still consider all of those things to be under the realm of Functional Programming.</p>\n<p>Just the idea that reading from a data structure that could be changing while you read it because it could come from somewhere else, it’s mutable. Something else might have a hold of the same object.</p>\n<p>Just that idea is something that’s not discussed enough outside of Functional Programming. It’s something that we know very intimately in Functional Programming. It’s something that we talk about all the time.</p>\n<p>Reading from a mutable data structure is an action. That’s simple. We would love to be doing only calculations, and ,so we need some kind of immutable data structure to do that.</p>\n<p>Now, I’ve talked about this before. I, actually, have a very pragmatic definition of immutability. It doesn’t mean that the thing can’t change because of some flag you’ve set on it, or some discipline imposed by the language or the runtime.</p>\n<p>An example of that would be, if you could make all the fields on a class final, or there’s no setters on your class, it’s only getters, it’s just a bunch of data, that would be a way of making something immutable.</p>\n<p>All the objects you talked to, that you had references to, also implemented this. You could see how you could use the language’s features to implement immutability.</p>\n<p>Another thing is maybe your language gives you immutable data structures, like Clojure does, or Haskell does. That’s very nice, but it is not enough of a definition because we can implement immutability just by programmer discipline.</p>\n<p>My practical definition of immutability is, if you don’t modify something, there’s no code that could possibly modify it, then it is effectively immutable. It’s a discipline. You could break the discipline. You could mess up and do something wrong, but it’s an ideal to strive for. It is not as hard as you might think, as a discipline.</p>\n<p>I’ve gone over this in another episode. The two main kinds, it’s really two and a half, but it’s two kinds of discipline for enforcing immutability.</p>\n<p>One is copy-on-write, which is where every time you want to make a change to a data structure, you make a copy and then change that copy. Once you’ve made the change, and you release it outside of your scope, you return it, or you send it to somebody else, some other part of the code, you can’t change it anymore.</p>\n<p>Nobody can change it. You just get this one little, tiny control period where you get to modify it. That’s copy-on-write. Every time you want to change something, you make a copy, and then change the copy while you’re the only one that has a handle on that copy.</p>\n<p>The second one is called copy-on-read. If you implement copy-on-write all throughout your code base, you’ll be fine. That’s the best way to do it. That’s how Clojure does it. It does copy-on-write. That’s how Haskell does it. It does copy-on-write.</p>\n<p>Sometimes you’re dealing with a library or a legacy code, or something that you don’t trust. Maybe you trusted it to do the wrong thing. You know it modifies stuff. It doesn’t do the copy-on-write. Since it doesn’t do copy-on-write, you can’t consider your data structures immutable, or anything that it touches to be immutable.</p>\n<p>What do you do? You do copy-on-read. If you call some API function, some library function, and you get back a data structure, you can’t trust that it’s immutable.</p>\n<p>The first thing you do when you get it is you make a deep copy. You make a deep copy of it. Now, you have a copy that you’re going to apply a copy-on-write discipline to.</p>\n<p>You don’t have to care what this library is going to do with the thing it gave you. You just throw it away. You’re like, “I have a copy of it, my own copy. I’m going to do my own thing with it.”</p>\n<p>You can now be secure that you’re using immutable data again. This is all to say that there’s a second answer to the question, do you need immutability to do Functional Programming?</p>\n<p>No. You can implement it even on top of mutable things. Even on top of mutable HashMaps, mutable objects. As long as you can make copies, shallow and deep, as long as you can do that, you’re fine. You can do Functional Programming.</p>\n<p>To recap, answer one is even before you…I say before. There’s a lot of interesting and useful thoughts, thought techniques, perspectives that you can apply to code that come from Functional Programming.</p>\n<p>These thoughts, these perspectives come from Functional Programming, you can apply it to code that doesn’t have immutable data. You would learn a lot about that code.</p>\n<p>Are you doing Functional Programming when you do that, when you apply perspectives from Functional Programming? Yes, I think you’re doing Functional Programming.</p>\n<p>Answer two is, even if your language doesn’t give you immutable data structures or a way of enforcing immutability, you can still do Functional Programming. You can still implement immutability using these disciplines, these copy-on-read and copy-on-write.</p>\n<p>You’re going to have to find the other episode where I talked about immutability to figure out what that half of a discipline is for immutability. It might surprise you what it is. It really is a half. It’s not a whole one. It’s still very useful, and it still gives you a lot of the guarantees that immutability gives you.</p>\n<p>If you liked this episode, you found it useful, you can find all the old episodes, the previous episodes, going back for over a hundred now, I’m sure, at lispcast.com/podcast. There you’ll find audio, video, and text transcripts of all the past episodes.</p>\n<p>You’ll also find links to subscribe. Just click those buttons. Subscribe any way you want, if you want it on your podcast player, you want it on YouTube. You want it just a text transcript, subscribe to that via RSS. You can do all that.</p>\n<p>You’ll also find links to social media, my email address, Twitter, LinkedIn. Just get in touch with me. A lot of the topics for these episodes come from questions and discussions that happened because of my episodes.</p>\n<p>My name is Eric Normand. This has been my thought on Functional Programming. Thank you for listening, and rock on.</p>\n<h2>Transcript</h2>\n<p>Eric Normand: Do you need immutability for Functional Programming? In this episode, we’re going to explore the question of whether it is necessary to have immutable data structures and other kinds of immutability in order to do Functional Programming.</p>\n<p>My name is Eric Normand, and I help people thrive with Functional Programming. I hear this a lot in podcasts. Also people ask me, they get in touch with me over email or Twitter. The ones that bug me the most are in podcasts. Those bug me. It doesn’t bug me to get questions, that’s great.</p>\n<p>I hear people say, “Oh, we can’t do Functional Programming because we need immutability.” Or, “We can’t implement this algorithm in a functional way because we need mutation.” Something like that.</p>\n<p>It’s troubling because immutability, immutable data structures, that’s all good. There’s no denying that it’s a useful tool, but it is just a tool. It’s not a requirement for Functional Programming.</p>\n<p>It helps tremendously, but you can still apply a functional thinking, a functional mindset to situations where things are mutable. That still helps. I still consider all of those things to be under the realm of Functional Programming.</p>\n<p>Just the idea that reading from a data structure that could be changing while you read it because it could come from somewhere else, it’s mutable. Something else might have a hold of the same object.</p>\n<p>Just that idea is something that’s not discussed enough outside of Functional Programming. It’s something that we know very intimately in Functional Programming. It’s something that we talk about all the time.</p>\n<p>Reading from a mutable data structure is an action. That’s simple. We would love to be doing only calculations, and ,so we need some kind of immutable data structure to do that.</p>\n<p>Now, I’ve talked about this before. I, actually, have a very pragmatic definition of immutability. It doesn’t mean that the thing can’t change because of some flag you’ve set on it, or some discipline imposed by the language or the runtime.</p>\n<p>An example of that would be, if you could make all the fields on a class final, or there’s no setters on your class, it’s only getters, it’s just a bunch of data, that would be a way of making something immutable.</p>\n<p>All the objects you talked to, that you had references to, also implemented this. You could see how you could use the language’s features to implement immutability.</p>\n<p>Another thing is maybe your language gives you immutable data structures, like Clojure does, or Haskell does. That’s very nice, but it is not enough of a definition because we can implement immutability just by programmer discipline.</p>\n<p>My practical definition of immutability is, if you don’t modify something, there’s no code that could possibly modify it, then it is effectively immutable. It’s a discipline. You could break the discipline. You could mess up and do something wrong, but it’s an ideal to strive for. It is not as hard as you might think, as a discipline.</p>\n<p>I’ve gone over this in another episode. The two main kinds, it’s really two and a half, but it’s two kinds of discipline for enforcing immutability.</p>\n<p>One is copy-on-write, which is where every time you want to make a change to a data structure, you make a copy and then change that copy. Once you’ve made the change, and you release it outside of your scope, you return it, or you send it to somebody else, some other part of the code, you can’t change it anymore.</p>\n<p>Nobody can change it. You just get this one little, tiny control period where you get to modify it. That’s copy-on-write. Every time you want to change something, you make a copy, and then change the copy while you’re the only one that has a handle on that copy.</p>\n<p>The second one is called copy-on-read. If you implement copy-on-write all throughout your code base, you’ll be fine. That’s the best way to do it. That’s how Clojure does it. It does copy-on-write. That’s how Haskell does it. It does copy-on-write.</p>\n<p>Sometimes you’re dealing with a library or a legacy code, or something that you don’t trust. Maybe you trusted it to do the wrong thing. You know it modifies stuff. It doesn’t do the copy-on-write. Since it doesn’t do copy-on-write, you can’t consider your data structures immutable, or anything that it touches to be immutable.</p>\n<p>What do you do? You do copy-on-read. If you call some API function, some library function, and you get back a data structure, you can’t trust that it’s immutable.</p>\n<p>The first thing you do when you get it is you make a deep copy. You make a deep copy of it. Now, you have a copy that you’re going to apply a copy-on-write discipline to.</p>\n<p>You don’t have to care what this library is going to do with the thing it gave you. You just throw it away. You’re like, “I have a copy of it, my own copy. I’m going to do my own thing with it.”</p>\n<p>You can now be secure that you’re using immutable data again. This is all to say that there’s a second answer to the question, do you need immutability to do Functional Programming?</p>\n<p>No. You can implement it even on top of mutable things. Even on top of mutable HashMaps, mutable objects. As long as you can make copies, shallow and deep, as long as you can do that, you’re fine. You can do Functional Programming.</p>\n<p>To recap, answer one is even before you…I say before. There’s a lot of interesting and useful thoughts, thought techniques, perspectives that you can apply to code that come from Functional Programming.</p>\n<p>These thoughts, these perspectives come from Functional Programming, you can apply it to code that doesn’t have immutable data. You would learn a lot about that code.</p>\n<p>Are you doing Functional Programming when you do that, when you apply perspectives from Functional Programming? Yes, I think you’re doing Functional Programming.</p>\n<p>Answer two is, even if your language doesn’t give you immutable data structures or a way of enforcing immutability, you can still do Functional Programming. You can still implement immutability using these disciplines, these copy-on-read and copy-on-write.</p>\n<p>You’re going to have to find the other episode where I talked about immutability to figure out what that half of a discipline is for immutability. It might surprise you what it is. It really is a half. It’s not a whole one. It’s still very useful, and it still gives you a lot of the guarantees that immutability gives you.</p>\n<p>If you liked this episode, you found it useful, you can find all the old episodes, the previous episodes, going back for over a hundred now, I’m sure, at lispcast.com/podcast. There you’ll find audio, video, and text transcripts of all the past episodes.</p>\n<p>You’ll also find links to subscribe. Just click those buttons. Subscribe any way you want, if you want it on your podcast player, you want it on YouTube. You want it just a text transcript, subscribe to that via RSS. You can do all that.</p>\n<p>You’ll also find links to social media, my email address, Twitter, LinkedIn. Just get in touch with me. A lot of the topics for these episodes come from questions and discussions that happened because of my episodes.</p>\n<p>My name is Eric Normand. This has been my thought on Functional Programming. Thank you for listening, and rock on.</p>\n<p>The post <a rel=\"nofollow\" href=\"https://lispcast.com/do-you-need-immutability-for-functional-programming/\">Do you need immutability for functional programming?</a> appeared first on <a rel=\"nofollow\" href=\"https://lispcast.com\">LispCast</a>.</p>",
   :direction "ltr"},
  :updated 1574337600000,
  :entities
  [{:mentions [{:text "functional programming"}],
    :id "nlp/f/entity/wd:193076",
    :salienceLevel "about",
    :label "functional programming"}
   {:mentions [{:text "copy-on-write"}],
    :id "nlp/f/entity/wd:1131607",
    :salienceLevel "mention",
    :label "copy-on-write"}
   {:mentions [{:text "data structure"}],
    :id "nlp/f/entity/wd:175263",
    :salienceLevel "mention",
    :label "data structure"}
   {:mentions [{:text "Twitter"}],
    :id "nlp/f/entity/wd:918",
    :salienceLevel "mention",
    :label "Twitter"}
   {:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}],
  :alternate
  [{:href
    "https://lispcast.com/do-you-need-immutability-for-functional-programming/",
    :type "text/html"}],
  :title "Do you need immutability for functional programming?",
  :author "Eric Normand",
  :published-str "Thu Nov 21 04:00:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16e8df8d3c1:304717:49b12733",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url "https://i.ytimg.com/vi/6nlnb1uHbf0/mqdefault.jpg",
   :width 320,
   :height 180,
   :contentType "image/jpeg"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://lispcast.com/?p=2087",
  :commonTopics
  [{:score 91.49134274973608,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1574337600000,
  :fingerprint "96fb932f",
  :canonicalUrl
  "https://lispcast.com/do-you-need-immutability-for-functional-programming/"}
 {:engagement 4,
  :unread false,
  :crawled 1574275415513,
  :content
  {:content "You don’t have to mix data coercion with business logic.",
   :direction "ltr"},
  :updated 1574269606000,
  :entities
  [{:mentions [{:text "JSON"}],
    :id "nlp/f/entity/wd:2063",
    :salienceLevel "about",
    :label "JavaScript Object Notation"}],
  :alternate
  [{:href
    "https://quanttype.net/posts/2019-11-20-coercing-json-with-malli.html",
    :type "text/html"}],
  :title "Coercing JSON with malli",
  :author "quanttype",
  :published-str "Wed Nov 20 09:06:46 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16e8a207dd9:51f5307:69b9f616",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url "https://quanttype.net/images/suolampi.jpg",
   :width 1200,
   :height 800,
   :contentType "image/jpeg"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://quanttype.net/posts/2019-11-20-coercing-json-with-malli.html",
  :commonTopics
  [{:score 18.571164989387672,
    :id "nlp/f/topic/3040",
    :salienceLevel "about",
    :label "crime"}],
  :published 1574269606000,
  :fingerprint "cf168987",
  :canonicalUrl
  "https://quanttype.net/posts/2019-11-20-coercing-json-with-malli.html"}
 {:engagement 4,
  :unread false,
  :crawled 1574173556597,
  :content
  {:content
   "<div>\n<h2><a href=\"https://clojurescript.org/feed.xml#_noteworthy_changes\"></a>Noteworthy Changes</h2>\n<div>\n<div>\n<ul>\n<li>\n<p>The behavior of <code>set/union</code> and <code>into</code> is now aligned with Clojure.</p>\n</li>\n<li>\n<p><code>subvec</code> argument checking is now aligned with Clojure.</p>\n</li>\n<li>\n<p><code>apply</code> <code>vector</code> on an array now properly clones the array.</p>\n</li>\n</ul>\n</div>\n</div>\n</div>\n<div>\n<h2><a href=\"https://clojurescript.org/feed.xml#_google_closure_namespace_analysis\"></a>Google Closure Namespace Analysis</h2>\n<div>\n<div>\n<p>The compiler now produces analysis metadata for Google Closure namespaces.\nThis means that for these namespaces:</p>\n</div>\n<div>\n<ul>\n<li>\n<p>REPL facilities like <code>doc</code>, <code>dir</code>, <code>apropos</code>, <em>etc.</em>, will now work.</p>\n</li>\n<li>\n<p>Argument lists are available, thus enabling arity checking.</p>\n</li>\n<li>\n<p>Return types are available, enhancing type inference.</p>\n</li>\n<li>\n<p>Warnings on private var usage will be generated.</p>\n</li>\n</ul>\n</div>\n<div>\n<p>To illustrate, let’s <code>(require '[goog.crypt :as crypt])</code> and explore it\nat the REPL:</p>\n</div>\n<div>\n<p>Now, <code>(dir crypt)</code> will list the functions in that namespace:</p>\n</div>\n<div>\n<div>\n<pre>byteArrayToHex\nbyteArrayToString\nhexToByteArray\n...</pre>\n</div>\n</div>\n<div>\n<p>Docstrings are available; <code>(doc crypt/hexToByteArray)</code> produces:</p>\n</div>\n<div>\n<div>\n<pre>-------------------------\ngoog.crypt/hexToByteArray\n([hexString])\n  /**\n * Converts a hex string into an integer array.\n...</pre>\n</div>\n</div>\n<div>\n<p>Arity information is available. Passing an incorrect argument count to one\nof the functions, produces an arity warning. For example,\n<code>(crypt/hexToByteArray &quot;abc&quot; 123)</code> generates:</p>\n</div>\n<div>\n<div>\n<pre>WARNING: Wrong number of args (2) passed to goog.crypt/hexToByteArray at line 1 &lt;cljs repl></pre>\n</div>\n</div>\n</div>\n</div>\n<div>\n<h2><a href=\"https://clojurescript.org/feed.xml#_type_inference_improvements\"></a>Type Inference Improvements</h2>\n<div>\n<div>\n<p>Several improvements to ClojureScript’s type inference are in this release.</p>\n</div>\n<div>\n<h3><a href=\"https://clojurescript.org/feed.xml#_direct_field_access_for_keyword_lookup_on_records\"></a>Direct field access for keyword lookup on records</h3>\n<div>\n<p>This is easily explained by way of example:</p>\n</div>\n<div>\n<div>\n<pre><code>(defrecord Complex [re im])\n\n(let [x (->Complex 1.1 2.7)]\n   (:re x))</code></pre>\n</div>\n</div>\n<div>\n<p>The code generated for the last expression will be <code>x.re</code>. This can be\nanywhere between 66% and 450% faster.</p>\n</div>\n</div>\n<div>\n<h3><a href=\"https://clojurescript.org/feed.xml#_count_specializations_for_string_and_array\"></a><code>count</code> specializations for string and array</h3>\n<div>\n<p>If you apply <code>count</code> to a value that is statically inferred to be\neither a string or an array, the JavaScript generated will\ninvolve direct access to the <code>length</code> field instead of a runtime\ncall to <code>count</code>.</p>\n</div>\n<div>\n<p>For example <code>(count &quot;abc&quot;)</code> will cause <code>&quot;abc&quot;.length</code> to be emitted.\nDepending on context, this could be several orders of magnitude faster.</p>\n</div>\n</div>\n<div>\n<h3><a href=\"https://clojurescript.org/feed.xml#_simple_qualified_predicate_induced_inference\"></a><code>simple-<strong></strong></code><strong> / <code>qualified-</code></strong> predicate-induced inference</h3>\n<div>\n<p>If <code>simple-keyword?</code> or <code>qualified-keyword?</code> is satisfied for a\nlocal then that local is inferred to be a keyword. Similarly\n<code>simple-symbol?</code> or <code>qualified-symbol?</code> results in a local being\nas a symbol.</p>\n</div>\n<div>\n<p>This essentially broadens the existing predicate-induced inferrence\nfor <code>keyword?</code> and <code>symbol?</code> to these additional core predicates.</p>\n</div>\n</div>\n<div>\n<h3><a href=\"https://clojurescript.org/feed.xml#_thread_predicate_induced_inference_through_and\"></a>Thread predicate-induced inference through <code>and</code></h3>\n<div>\n<p>This type inference improvement is perhaps best explained by way\nof an example. For the following code</p>\n</div>\n<div>\n<div>\n<pre><code>(and (string? x) (zero? (count x)))</code></pre>\n</div>\n</div>\n<div>\n<p>the compiler will now know that, if the first clause in the <code>and</code> above\nis satisfied, then, in the second clause, <code>x</code> must be of type string.\nCombined with the <code>count</code> specialization mentioned above, this causes\nefficient JavaScript to be generated:</p>\n</div>\n<div>\n<div>\n<pre><code>typeof x === &quot;string&quot; &amp;&amp; x.length === 0</code></pre>\n</div>\n</div>\n</div>\n<div>\n<h3><a href=\"https://clojurescript.org/feed.xml#_not_inferring_on_implements\"></a>Not inferring on <code>implements?</code></h3>\n<div>\n<p>This is an internal, yet important, optimization for the standard library:\nWhen the <code>implements?</code> predicate is satisfied on a local, the compiler\ngenerates more efficient function dispatch code for expressions involving\nthat local.</p>\n</div>\n</div>\n<div>\n<h3><a href=\"https://clojurescript.org/feed.xml#_improperly_widened_cross_param_loop_recur_inference\"></a>Improperly widened cross-param <code>loop</code> / <code>recur</code> inference</h3>\n<div>\n<p>A corner-case involving <code>loop</code> / <code>recur</code> widening inference was fixed where\nincorrect inferrence can occur if a <code>loop</code>-bound local is used as a <code>recur</code>\ntarget.</p>\n</div>\n</div>\n<div>\n<h3><a href=\"https://clojurescript.org/feed.xml#_dynamic_vars_are_now_properly_inferred_as_having_type_any\"></a>Dynamic Vars are now properly inferred as having type <code>any</code></h3>\n<div>\n<p>An inference bug was fixed where dynamic Vars were incorrectly inferred\nas having the type of their initialization value. This was incorrect\nbecause dynamic Vars can be re-bound at runtime with values of types\nthat differ from the initialization value type.</p>\n</div>\n</div>\n</div>\n</div>\n<div>\n<h2><a href=\"https://clojurescript.org/feed.xml#_performance_improvements\"></a>Performance Improvements</h2>\n<div>\n<div>\n<h3><a href=\"https://clojurescript.org/feed.xml#_optimize_assoc_on_iassociative_values\"></a>Optimize <code>assoc</code> on <code>IAssociative</code> values</h3>\n<div>\n<p>An optimization in the core <code>assoc</code> function makes it faster when <code>assoc</code> ing\nonto <code>IAssociative</code> values (the common case).</p>\n</div>\n<div>\n<p>For example, <code>assoc</code> ing a key-value onto a map can be 24% faster in V8 and\n11% faster in JavaScript core, a great perf boost for this frequently\nused core function.</p>\n</div>\n</div>\n<div>\n<h3><a href=\"https://clojurescript.org/feed.xml#_tag_coll_as_not_native_in_ci_reduce\"></a>Tag <code>coll</code> as <code>not-native</code> in <code>ci-reduce</code></h3>\n<div>\n<p>This is an important internal optimization affecting the standard library\nwhich improves performance when reducing collections which are <code>IIndexed</code>\nand <code>ICounted</code>.</p>\n</div>\n</div>\n<div>\n<h3><a href=\"https://clojurescript.org/feed.xml#_improve_perf_of_cljs_source_map_base64encode\"></a>Improve perf of <code>cljs.source-map.base64/encode</code></h3>\n<div>\n<p>This improves the performance of a function heavily used in the generation\nof source maps, improving the performance by 17% in one of our measurements.</p>\n</div>\n</div>\n</div>\n</div>\n<div>\n<h2><a href=\"https://clojurescript.org/feed.xml#_change_list\"></a>Change List</h2>\n<div>\n<div>\n<p>For a complete list of updates in ClojureScript 1.10.597 see\n<a href=\"https://github.com/clojure/clojurescript/blob/master/changes.md#1.10.597\">Changes</a>.</p>\n</div>\n</div>\n</div>\n<div>\n<h2><a href=\"https://clojurescript.org/feed.xml#_contributors\"></a>Contributors</h2>\n<div>\n<div>\n<p>Thanks to all of the community members who contributed to ClojureScript 1.10.597:</p>\n</div>\n<div>\n<ul>\n<li>\n<p>Dieter Komendera</p>\n</li>\n<li>\n<p>Erik Assum</p>\n</li>\n<li>\n<p>Herald</p>\n</li>\n<li>\n<p>Martin Kavalar</p>\n</li>\n<li>\n<p>Martin Kučera</p>\n</li>\n<li>\n<p>Michiel Borkent</p>\n</li>\n<li>\n<p>Roman Liutikov</p>\n</li>\n<li>\n<p>Seçkin Kükrer</p>\n</li>\n<li>\n<p>Thomas Mulvaney</p>\n</li>\n</ul>\n</div>\n</div>\n</div>",
   :direction "ltr"},
  :updated 1574056800000,
  :entities
  [{:mentions [{:text "type inference"}],
    :id "nlp/f/entity/wd:586459",
    :salienceLevel "mention",
    :label "type inference"}
   {:mentions [{:text "REPL"}],
    :id "nlp/f/entity/wd:2032810",
    :salienceLevel "mention",
    :label "Read–eval–print loop"}
   {:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "JavaScript"}],
    :id "nlp/f/entity/wd:2005",
    :salienceLevel "mention",
    :label "JavaScript"}
   {:mentions [{:text "orders of magnitude"}],
    :id "nlp/f/entity/wd:846759",
    :salienceLevel "mention",
    :label "orders of magnitude"}],
  :alternate
  [{:href "https://clojurescript.org/news/2019-11-18-release",
    :type "text/html"}],
  :title "1.10.597 Release",
  :author "ClojureScript News",
  :published-str "Sun Nov 17 22:00:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16e840e3f75:49b2bbd:69b9f616",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://clojurescript.org/news/2019-11-18-release",
  :commonTopics
  [{:score 82.1959108838476,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1574056800000,
  :fingerprint "b64fb2d7",
  :canonicalUrl "https://clojurescript.org/news/2019-11-18-release"}
 {:engagement 6,
  :unread false,
  :crawled 1574153900798,
  :recrawled 1574613053286,
  :content
  {:content
   "<p><em>Продолжение <a href=\"https://grishaev.me/clj-book-tests-1\">первой части</a></em></p>\n<h2>\nСодержание\n</h2>\n<ul>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%A2%D1%80%D0%B0%D0%BD%D0%B7%D0%B0%D0%BA%D1%86%D0%B8%D1%8F-%D1%81-%D0%BE%D1%82%D0%BA%D0%B0%D1%82%D0%BE%D0%BC\">Транзакция с откатом</a></li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%A2%D0%B5%D1%81%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5-%D0%B2%D0%B5%D0%B1-%D0%BF%D1%80%D0%B8%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D0%B9\">Тестирование веб-приложений</a></li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%A2%D0%B5%D1%81%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5-%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC\">Тестирование систем</a></li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%98%D0%BD%D1%82%D0%B5%D0%B3%D1%80%D0%B0%D1%86%D0%B8%D0%BE%D0%BD%D0%BD%D1%8B%D0%B5-%D1%82%D0%B5%D1%81%D1%82%D1%8B\">Интеграционные тесты</a></li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%94%D1%80%D1%83%D0%B3%D0%B8%D0%B5-%D1%80%D0%B5%D1%88%D0%B5%D0%BD%D0%B8%D1%8F\">Другие решения</a> <ul>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%9F%D1%80%D0%BE%D0%B4%D0%B2%D0%B8%D0%BD%D1%83%D1%82%D1%8B%D0%B5-%D0%BC%D0%BE%D0%BA%D0%B8\">Продвинутые моки</a></li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%90%D0%BB%D1%8C%D1%82%D0%B5%D1%80%D0%BD%D0%B0%D1%82%D0%B8%D0%B2%D0%BD%D1%8B%D0%B9-%D1%81%D0%B8%D0%BD%D1%82%D0%B0%D0%BA%D1%81%D0%B8%D1%81\">Альтернативный синтаксис</a></li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%92%D1%8B%D0%B2%D0%BE%D0%B4-xunit\">Вывод XUnit</a></li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%93%D0%B5%D0%BD%D0%B5%D1%80%D0%B0%D1%86%D0%B8%D1%8F-%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85\">Генерация данных</a></li>\n</ul>\n</li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%9F%D0%BE%D1%80%D1%8F%D0%B4%D0%BE%D0%BA-%D0%B0%D1%80%D0%B3%D1%83%D0%BC%D0%B5%D0%BD%D1%82%D0%BE%D0%B2\">Порядок аргументов</a></li>\n</ul>\n<h3>Транзакция с откатом</h3>\n<p>Другой способ избавиться от изменений в базе — обернуть все действия с ней в\nособую транзакцию. Такая транзакция завершается оператором не <code>COMMIT</code>, а\n<code>ROLLBACK</code>, что значит откатить все команды. С точки зрения базы это выглядит\nтак:</p>\n<div><div><pre><code><span>BEGIN</span><span>;</span>\n<span>INSERT</span> <span>INTO</span> <span>users</span> <span>...</span>\n<span>INSERT</span> <span>INTO</span> <span>profiles</span> <span>...</span>\n<span>UPDATE</span> <span>users</span> <span>SET</span> <span>name</span><span>=</span><span>...</span>\n<span>ROLLBACK</span><span>;</span>\n</code></pre></div></div>\n<p>При выходе из транзакции мы не увидим последствий <code>INSERT</code>, <code>UPDATE</code> и других\nкоманд, выполненных в ее рамках.</p>\n<p>В пакет JDBC входит функция <code>db-set-rollback-only!</code>. Она принимает\nтранзакционное соединение и выставляет ему флаг rollback. Если флаг установлен,\nJDBC завершает блок транзакции оператором ROLLBACK.</p>\n<p>Вы уже знакомы с макросом <code>with-db-transaction</code>: внутри его тела действует\nтранзакционное соединение, которые получают из JDBC-спеки. Напишем свой макрос\nwith-db-rollback, который делает то же самое, но дополнительно устанавливает\nфлаг отката:</p>\n<div><div><pre><code><span>(</span><span>defmacro</span><span> </span><span>with-db-rollback</span><span>\n</span><span>[[</span><span>t-conn</span><span> </span><span>&amp;</span><span> </span><span>bindings</span><span>]</span><span> </span><span>&amp;</span><span> </span><span>body</span><span>]</span><span>\n</span><span>`</span><span>(</span><span>jdbc/with-db-transaction</span><span> </span><span>[</span><span>~</span><span>t-conn</span><span> </span><span>~@</span><span>bindings</span><span>]</span><span>\n</span><span>(</span><span>jdbc/db-set-rollback-only!</span><span> </span><span>~</span><span>t-conn</span><span>)</span><span>\n</span><span>~@</span><span>body</span><span>))</span><span>\n</span></code></pre></div></div>\n<p>Пример его работы:</p>\n<div><div><pre><code><span>(</span><span>with-db-rollback</span><span> </span><span>[</span><span>tx</span><span> </span><span>*db*</span><span>]</span><span>\n</span><span>(</span><span>println</span><span> </span><span>&quot;Inserting the data...&quot;</span><span>)</span><span>\n</span><span>(</span><span>jdbc/insert!</span><span> </span><span>tx</span><span> </span><span>:users</span><span> </span><span>{</span><span>:name</span><span> </span><span>&quot;Ivan&quot;</span><span>})</span><span>\n</span><span>(</span><span>let</span><span> </span><span>[</span><span>...</span><span>]</span><span>\n</span><span>(</span><span>do-something</span><span>)))</span><span>\n</span></code></pre></div></div>\n<p>Разработчик следит за тем, чтобы все действия — вставка данных, логика теста —\nпротекали через <code>tx</code>, а не <code>*db*</code>. Иначе изменения в рамках обычного соединения\nостанутся в базе. Прямо сейчас загрузчик load-data данных ссылается на\nглобальную переменную <code>*db*</code>. Чтобы сообщить ему транзакционное соединение,\nпридется либо передать параметр, либо связать <code>*db*</code> с tx формой binding.</p>\n<p>Пример с параметром: все действия с базой принимают tx, который мы установили на\nвершине теста.</p>\n<div><div><pre><code><span>(</span><span>deftest</span><span> </span><span>test-user-with-rollback</span><span>\n</span><span>(</span><span>with-db-rollback</span><span> </span><span>[</span><span>tx</span><span> </span><span>*db*</span><span>]</span><span>\n</span><span>(</span><span>load-data</span><span> </span><span>tx</span><span>)</span><span>\n</span><span>(</span><span>let</span><span> </span><span>[</span><span>user</span><span> </span><span>(</span><span>get-user-by-name</span><span> </span><span>tx</span><span> </span><span>&quot;Ivan&quot;</span><span>)]</span><span>\n</span><span>(</span><span>is</span><span> </span><span>(</span><span>=</span><span> </span><span>&quot;Ivan&quot;</span><span> </span><span>(</span><span>:name</span><span> </span><span>user</span><span>))))))</span><span>\n</span></code></pre></div></div>\n<p>Вариант со связанной переменной. В этом случае мы считаем, что все функции\nссылаются на глобальную <code>*db*</code>. Внутри макроса она станет транзакционным\nсоединением с откатом.</p>\n<div><div><pre><code><span>(</span><span>deftest</span><span> </span><span>test-user-with-rollback</span><span>\n</span><span>(</span><span>with-db-rollback</span><span> </span><span>[</span><span>tx</span><span> </span><span>*db*</span><span>]</span><span>\n</span><span>(</span><span>binding</span><span> </span><span>[</span><span>*db*</span><span> </span><span>tx</span><span>]</span><span>\n</span><span>(</span><span>load-data</span><span>)</span><span>\n</span><span>(</span><span>let</span><span> </span><span>[</span><span>user</span><span> </span><span>(</span><span>get-user-by-name</span><span> </span><span>&quot;Ivan&quot;</span><span>)]</span><span>\n</span><span>(</span><span>is</span><span> </span><span>(</span><span>=</span><span> </span><span>&quot;Ivan&quot;</span><span> </span><span>(</span><span>:name</span><span> </span><span>user</span><span>)))))))</span><span>\n</span></code></pre></div></div>\n<p>Реализация зависит от того, как в проекте устроена работа с базой. Решение с\nоткатом хорошо подходит для mount и похожей архитектуры, когда база это\nглобальная переменная. В случае с системой компонентов могут возникнуть\nтрудности с передачей tx от теста к логике и наоборот.</p>\n<p>В свободное время подумайте, как оформить фикстуру с макросом\nwith-db-rollback. Будет ли она работать с системой компонентов? Что необходимо в\nэтом случае?</p>\n<h2>Тестирование веб-приложений</h2>\n<p>До сих пор мы тестировали отдельные функции, в основном связанные с\nрасчетами. Такие тесты, как говорят математики, необходимы, но недостаточны. Они\nзащищают проект от спонтанных изменений, но не обещают, что система\nустойчива. Поднимемся на уровень выше и рассмотрим, как тестировать приложение\nцеликом.</p>\n<p>В главе про веб-разработку мы пришли к важному выводу. Веб-приложение на каждом\nуровне остается функций одного аргумента. Где-то внизу это обработчик конкретной\nстраницы, условный <code>(view-profile-page [request])</code>. Комбинация маршрутов и\nmiddleware не меняет это соглашение. Конечный объект app, много раз обернутый в\nmiddleware, по-прежнему принимает словарь запроса и возвращает словарь ответа.</p>\n<p>Это определяет, как писать тесты для приложения. Типичный тест составляет запрос\nи вызывает приложение как функцию. В ответе ищут HTTP-статус и проверяют на\nуспех (200, 201) или неудачу (404, 403). Если это JSON-ответ, его тело считывают\nв коллекцию и сравнивают с образцом.</p>\n<p>Вспомним приложение из первой главы. Отдельные страницы мы соединили в маршруты\nс помощью Compojure. Получилось “голое” приложение. Так мы назвали его потому,\nчто оно многого не умеет. Например, читать параметры запроса, работать с JSON,\nкуками, сессиями и так далее. Приложение узнает все это из middleware, в которые\nмы его оборачиваем.</p>\n<div><div><pre><code><span>(</span><span>defroutes</span><span> </span><span>app-naked</span><span>\n</span><span>(</span><span>GET</span><span> </span><span>&quot;/&quot;</span><span> </span><span>request</span><span> </span><span>(</span><span>page-index</span><span> </span><span>request</span><span>))</span><span>\n</span><span>(</span><span>GET</span><span> </span><span>&quot;/hello&quot;</span><span> </span><span>request</span><span> </span><span>(</span><span>page-hello</span><span> </span><span>request</span><span>))</span><span>\n</span><span>page-404</span><span>)</span><span>\n</span><span>(</span><span>def</span><span> </span><span>app</span><span>\n</span><span>(</span><span>-></span><span> </span><span>app-naked</span><span>\n</span><span>wrap-session</span><span>\n</span><span>wrap-keyword-params</span><span>\n</span><span>wrap-params</span><span>\n</span><span>wrap-json-body</span><span>\n</span><span>wrap-json-response</span><span>))</span><span>\n</span></code></pre></div></div>\n<p>Напишем несколько тестов для этого приложения. Пусть это будет главная страница\nи любая другая, которой нет в дереве маршрутов. Для экономии места проверим\nтолько статус ответа.</p>\n<div><div><pre><code><span>(</span><span>deftest</span><span> </span><span>test-app-index</span><span>\n</span><span>(</span><span>let</span><span> </span><span>[</span><span>request</span><span> </span><span>{</span><span>:request-method</span><span> </span><span>:get</span><span> </span><span>:uri</span><span> </span><span>&quot;/&quot;</span><span>}</span><span>\n</span><span>response</span><span> </span><span>(</span><span>app</span><span> </span><span>request</span><span>)</span><span>\n</span><span>{</span><span>:keys</span><span> </span><span>[</span><span>status</span><span> </span><span>body</span><span>]}</span><span> </span><span>response</span><span>]</span><span>\n</span><span>(</span><span>is</span><span> </span><span>(</span><span>=</span><span> </span><span>200</span><span> </span><span>status</span><span>))))</span><span>\n</span><span>(</span><span>deftest</span><span> </span><span>test-app-page-not-found</span><span>\n</span><span>(</span><span>let</span><span> </span><span>[</span><span>request</span><span> </span><span>{</span><span>:request-method</span><span> </span><span>:get</span><span> </span><span>:uri</span><span> </span><span>&quot;/missing&quot;</span><span>}</span><span>\n</span><span>response</span><span> </span><span>(</span><span>app</span><span> </span><span>request</span><span>)</span><span>\n</span><span>{</span><span>:keys</span><span> </span><span>[</span><span>status</span><span> </span><span>body</span><span>]}</span><span> </span><span>response</span><span>]</span><span>\n</span><span>(</span><span>is</span><span> </span><span>(</span><span>=</span><span> </span><span>404</span><span> </span><span>status</span><span>))))</span><span>\n</span></code></pre></div></div>\n<p>Как видно из примеров, писать тесты для веб-приложения нетрудно. Однако, мы не\nбросим читателя на этом месте. Перечислим несколько приемов, которые облегчат\nработу с тестами.</p>\n<p><strong>Приложение целиком.</strong> Избегайте ситуации, когда тест вызывает не приложение, а\nодин из обработчиков. Плохой пример: (page-index request) вместо app. На текущем\nуровне вызов конкретной функции ничего не дает. Даже если страница работает по\nотдельности, нет гарантии, что запрос пройдет сквозь маршруты и все\nmiddleware. В боевых проектах middleware несут весомую логику. Это права\nдоступа, разбор токенов и JWT, данные из прошлых запросов в сессии. Убрав все\nэто из теста, вы тем самым обманываете себя. Объект app, который вы тестируете,\nдолжен быть максимально “заряжен”, т.е. близок к настоящему веб-серверу.</p>\n<p><strong>Библиотека запросов.</strong> Выше мы объявили запрос в виде словаря. Это работает\nтолько для простых случаев, когда нет ни параметров строки, ни тела. Если не\nпозаботиться об инструментах, вы дойдете до уровня</p>\n<div><div><pre><code>/users/?page=2&amp;order=name&amp;name_contains=smith&amp;search_type=relevance\n</code></pre></div></div>\n<p>, что совершенно нечитаемо и тяжело в поддержке. В словаре запроса легко\nперепутать ключи :request-method и :method, что автор и сделал при написании\nкниги.</p>\n<p>Чтобы избежать подобных ошибок, воспользуйтесь <code>ring-mock</code> — библиотекой для\nзапросов к Ring-приложениям. Ее функции покрывают основные сценарии в\nтестах. Так, функция request принимает метод и путь. Если добавить словарь\nпараметров, то для GET они станут строкой запроса, а для POST — его\nтелом. URL-кодировку библиотека берет на себя. Другая функция json-body пишет в\nзапрос тело из коллекции. Рассмотрим несколько примеров.</p>\n<p>Простая страница, запрос <code>GET /help</code>:</p>\n<div><div><pre><code><span>(</span><span>mock/request</span><span> </span><span>:get</span><span> </span><span>&quot;/help&quot;</span><span>)</span><span>\n</span></code></pre></div></div>\n<p>Ввод данных в форму поиска, <code>GET /movies?search=batman&amp;page=1</code>:</p>\n<div><div><pre><code><span>(</span><span>mock/request</span><span> </span><span>:get</span><span> </span><span>&quot;/movies&quot;</span><span> </span><span>{</span><span>:search</span><span> </span><span>&quot;batman&quot;</span><span> </span><span>:page</span><span> </span><span>1</span><span>})</span><span>\n</span></code></pre></div></div>\n<p>Новый пользователь из формы, <code>POST /users</code>. В этом запросе тело (ключ :body)\nстанет классом <code>ByteArrayInputStream</code>. Заголовок Content-Type примет значение\n<code>&quot;application/x-www-form-urlencoded&quot;</code>.</p>\n<div><div><pre><code><span>(</span><span>mock/request</span><span> </span><span>:post</span><span> </span><span>&quot;/users&quot;</span><span> </span><span>{</span><span>:name</span><span> </span><span>&quot;Ivan&quot;</span><span> </span><span>:email</span><span> </span><span>&quot;test@test.com&quot;</span><span>})</span><span>\n</span></code></pre></div></div>\n<p>Случай для JSON-API. Адрес /users ожидает не поля формы, а JSON-тело.Такой\nзапрос составляют из двух функций:</p>\n<div><div><pre><code><span>(</span><span>-></span><span> </span><span>(</span><span>mock/request</span><span> </span><span>:post</span><span> </span><span>&quot;/users&quot;</span><span>)</span><span>\n</span><span>(</span><span>mock/json-body</span><span> </span><span>{</span><span>:name</span><span> </span><span>&quot;Ivan&quot;</span><span> </span><span>:email</span><span> </span><span>&quot;test@test.com&quot;</span><span>}))</span><span>\n</span></code></pre></div></div>\n<p><code>Проверка тела.</code> В тестах выше мы проверяли только статус ответа. На практике\nодного статуса недостаточно: число 200 еще не говорит, что в ответе именно то,\nчто нужно. Проверка тела зависит от типа содержимого. Если это текст или HTML,\nиногда хватит и регулярного выражения. Например, по фразе “Login” мы определим,\nчто на этой странице пользователь не авторизован.</p>\n<p>Гораздо интересней вариант с JSON-API. В этом случае нужно восстановить данные\nиз ответа и сравнить с образцом. Для простоты вызовем приложение\nsites-handler. Это заглушка, которой мы пользовались для тестировании\nкарт. Проверка ниже гарантирует, что при изменении ответа мы получим\nошибку. По-другому говорят, что ответ зафиксирован:</p>\n<div><div><pre><code><span>(</span><span>let</span><span> </span><span>[</span><span>request</span><span> </span><span>(</span><span>mock/request</span><span> </span><span>:get</span><span> </span><span>&quot;/search/v1/&quot;</span><span> </span><span>{</span><span>:lat</span><span> </span><span>11</span><span> </span><span>:lon</span><span> </span><span>22</span><span>})</span><span>\n</span><span>response</span><span> </span><span>(</span><span>sites-handler</span><span> </span><span>request</span><span>)</span><span>\n</span><span>body</span><span> </span><span>(</span><span>-></span><span> </span><span>response</span><span> </span><span>:body</span><span> </span><span>(</span><span>cheshire.core/parse-string</span><span> </span><span>true</span><span>))]</span><span>\n</span><span>(</span><span>is</span><span> </span><span>(</span><span>=</span><span> </span><span>{</span><span>...</span><span>}</span><span> </span><span>body</span><span>)))</span><span>\n</span></code></pre></div></div>\n<p>Недостаток в том, что мы сравниваем данные как есть. Прием не сработает, если в\nответе даты, уникальные идентификаторы (UUID) или машинные номера. Перед\nсравнением их исключают с помощью dissoc и map. Представим, что поиск кафе\nвернул результат в таком виде:</p>\n<div><div><pre><code><span>{</span><span>:sites</span><span> </span><span>[{</span><span>:name</span><span> </span><span>&quot;Site1&quot;</span><span> </span><span>:date-updated</span><span> </span><span>&quot;2019-11-12&quot;</span><span> </span><span>:id</span><span> </span><span>42</span><span>}</span><span>\n</span><span>{</span><span>:name</span><span> </span><span>&quot;Site2&quot;</span><span> </span><span>:date-updated</span><span> </span><span>&quot;2019-11-10&quot;</span><span> </span><span>:id</span><span> </span><span>99</span><span>}]}</span><span>\n</span></code></pre></div></div>\n<p>Код ниже вернет только те данные, которые не меняются от запроса к запросу. Их и\nсравнивают с образцом.</p>\n<div><div><pre><code><span>(</span><span>update</span><span> </span><span>body</span><span> </span><span>:sites</span><span>\n</span><span>(</span><span>fn</span><span> </span><span>[</span><span>sites</span><span>]</span><span>\n</span><span>(</span><span>map</span><span> </span><span>(</span><span>fn</span><span> </span><span>[</span><span>site</span><span>]</span><span>\n</span><span>(</span><span>dissoc</span><span> </span><span>site</span><span> </span><span>:id</span><span> </span><span>:date-updated</span><span>))</span><span>\n</span><span>sites</span><span>)))</span><span>\n</span><span>;; {:sites ({:name &quot;Site1&quot;} {:name &quot;Site2&quot;})}</span><span>\n</span></code></pre></div></div>\n<p>Иногда проверяют не конкретные значения, а структуру ответа. Это удобно на\nбольших данных, например, когда в каждом элементе двадцать и более полей. В\nтаком случае ответ проверяют спекой или JSON-схемой.</p>\n<div><div><pre><code><span>(</span><span>let</span><span> </span><span>[</span><span>;; obtain the response</span><span>\n</span><span>body</span><span> </span><span>(</span><span>-></span><span> </span><span>response</span><span> </span><span>:body</span><span> </span><span>(</span><span>cheshire.core/parse-string</span><span> </span><span>true</span><span>))]</span><span>\n</span><span>(</span><span>is</span><span> </span><span>(</span><span>s/valid?</span><span> </span><span>:api.search/handler</span><span> </span><span>body</span><span>)))</span><span>\n</span></code></pre></div></div>\n<p>Затраты на спеку или схему окупаются в будущем. Ими проверяют входные параметры,\nгенерируют данные для тестов, описывают REST API (Swagger, RAML).</p>\n<h2>Тестирование систем</h2>\n<p>Коротко о том, как пишут тесты в проектах с системами, о которых мы говорили в\nотдельной главе. Напомним, система это набор компонентов со связями между\nними. Покрыть каждый компонент тестами нетрудно; проблемы возникают на стыке при\nвзаимодействии. В проекте обязательно должен быть тест, где система работает как\nединое целое.</p>\n<p>Очевидно, чтобы тест прошел, кто-то должен запустить систему и остановить ее\nпосле. На эту роль подходит фикстура. Будем полагать, что переменная системы и\nфункции ее запуска и останова находятся в модуле system.clj. Напишем фикстуру\n<code>fix-system</code>:</p>\n<div><div><pre><code><span>(</span><span>defn</span><span> </span><span>fix-system</span><span> </span><span>[</span><span>t</span><span>]</span><span>\n</span><span>(</span><span>system/start!</span><span>)</span><span>\n</span><span>(</span><span>t</span><span>)</span><span>\n</span><span>(</span><span>system/stop!</span><span>))</span><span>\n</span></code></pre></div></div>\n<p>На время ее работы в переменной <code>system/system</code> будет рабочая система. Другие\nфикстуры, например, для работы с базой, могут обратиться к ее компонентам\nнапрямую. Важно только, чтобы в вызове use-fixtures они шли в правильном порядке\n(левее — раньше), иначе вы получите Null-ошибки и другие неприятности.</p>\n<div><div><pre><code><span>(</span><span>defn</span><span> </span><span>fix-db-data</span><span> </span><span>[</span><span>t</span><span>]</span><span>\n</span><span>(</span><span>let</span><span> </span><span>[{</span><span>:keys</span><span> </span><span>[</span><span>db</span><span>]}</span><span> </span><span>system/system</span><span>]</span><span>\n</span><span>(</span><span>prepare-test-data</span><span> </span><span>db</span><span>)</span><span>\n</span><span>(</span><span>t</span><span>)</span><span>\n</span><span>(</span><span>clear-test-data</span><span> </span><span>db</span><span>)))</span><span>\n</span><span>(</span><span>use-fixtures</span><span> </span><span>:once</span><span> </span><span>fix-system</span><span> </span><span>fix-db-data</span><span>)</span><span>\n</span></code></pre></div></div>\n<p>Читатель заметит, что это противоречит правилу, о котором мы говорили в главе\nпро системы. Что к системе нельзя обращаться напрямую и копаться в ее\nкомпонентах. Что ж, признаем, для тестов в этом плане действуют\nпослабления. Обращаться к системе нельзя в промышленном коде. Но тесты это не\nпромышленный код, поэтому на небольшие нарушения в них порой закрывают\nглаза. Главное, чтобы программист понимал, что он намерен выиграть. В нашем\nслучае выигрыш в том, что мы не пробрасываем компонент базы в фикстуру. Это было\nбы честнее, но заняло больше строк кода.</p>\n<p>Фикстура <code>fix-system</code> неслучайно стоит под ключом <code>:once</code>. Запуск и остановка\nсистемы занимают много времени. В наших интересах прогнать как можно больше\nтестов, пока система работает. Если же делать это поштучно, процесс затянется\nнадолго. Именно с этой проблемой вы столкнетесь при запуске тестов из CIDER. При\nпопытке выполнить один тест вы будете ждать, пока сработают все фикстуры, в том\nчисле fix-system.</p>\n<p>Кажется, что пять-десять секунд это немного. Но представьте, что работаете над\nзадачей и запускаете тест раз за разом — подобные паузы раздражают и сбивают с\nритма. Поделимся с читателем техникой, которая решит эту проблему.</p>\n<p>Потребуется два шага. Первый — научить систему, чтобы она знала о своем\nсостоянии. Например, включена ли она сейчас или выключена. Проще всего это\nсделать через поле с метаданными. Вынесем имя поля в отдельную\nпеременную. Перепишем start! так, чтобы в метаданных системы появился флаг со\nзначением true. Аналогично работает stop!, только флаг принимает ложь. Функция\nstarted? возвращает флаг значение из текущей системы.</p>\n<div><div><pre><code><span>(</span><span>def</span><span> </span><span>state-field</span><span> </span><span>::started?</span><span>)</span><span>\n</span><span>(</span><span>defn</span><span> </span><span>start!</span><span> </span><span>[]</span><span>\n</span><span>(</span><span>let</span><span> </span><span>[</span><span>sys</span><span> </span><span>(</span><span>-></span><span> </span><span>system</span><span>\n</span><span>component/start-system</span><span>\n</span><span>(</span><span>with-meta</span><span> </span><span>{</span><span>state-field</span><span> </span><span>true</span><span>}))]</span><span>\n</span><span>(</span><span>alter-var-root</span><span> </span><span>#</span><span>'system</span><span> </span><span>(</span><span>constantly</span><span> </span><span>sys</span><span>))))</span><span>\n</span><span>(</span><span>defn</span><span> </span><span>started?</span><span> </span><span>[]</span><span>\n</span><span>(</span><span>some-></span><span> </span><span>system</span><span> </span><span>meta</span><span> </span><span>(</span><span>get</span><span> </span><span>state-field</span><span>)))</span><span>\n</span></code></pre></div></div>\n<p>Второй шаг — перед тем, как включить систему в фикстуре, определить, была ли она\nзапущена вручную. Если нет, фикстура работает как обычно: запуск, тест,\nостановка. Если да, это значит, что системой управляют в ручном режиме. В таком\nслучае фикстура только выполняет тест, что гораздо быстрее, чем полный цикл.</p>\n<div><div><pre><code><span>(</span><span>defn</span><span> </span><span>fixture-system</span><span> </span><span>[</span><span>t</span><span>]</span><span>\n</span><span>(</span><span>let</span><span> </span><span>[</span><span>started-manually?</span><span> </span><span>(</span><span>system/started?</span><span>)]</span><span>\n</span><span>(</span><span>when-not</span><span> </span><span>started-manually?</span><span>\n</span><span>(</span><span>start!</span><span>))</span><span>\n</span><span>(</span><span>t</span><span>)</span><span>\n</span><span>(</span><span>when-not</span><span> </span><span>started-manually?</span><span>\n</span><span>(</span><span>stop!</span><span>))))</span><span>\n</span></code></pre></div></div>\n<p>Выполните в REPL (system/start!). Теперь можно вызвать тест сколько угодно раз —\nне придется ждать, пока запустится система.</p>\n<h2>Интеграционные тесты</h2>\n<p>Не протяжении главы мы постепенно усложняли тесты. С каждым шагом они все меньше\nзависят от технических деталей и делают упор на бизнес-логику. По-другому этот\nпринцип называют пирамидой тестов. В ее основании лежат юнит-тесты — множество\nотдельных проверок. Поднимаясь к вершине, мы абстрагируемся от технического\nслоя: в какой-то момент тестируем не отдельные функции, а часть приложения.</p>\n<p>Каждый уровень в пирамиде требует специальных знаний. Полагаем, читатель готов к\nтому, чтобы подняться на последний этаж — освоить интеграционное\nтестирование. Это особая фаза тестов, когда окружение максимально похоже на\nпромышленное. По-другому их еще называют UI- или Selenium-тестами в честь\nодноименного фреймворка. Для большей реалистичности мы не шлем запросы\nпрограммно, а имитируем действия человека. Например, управляем браузером: вводим\nданные в форму, нажимаем кнопку и проверяем, что появился нужный текст.</p>\n<p>Интеграционные тесты выполняются медленно, потому что включают полный цикл\nприложения. Это загрузка страницы, выполнение скриптов, ожидание запроса, во\nвремя которого сервер ходит в базу или очередь задач. Если возникнет ошибка, ее\nтрудно расследовать из-за длины цепи. Представьте, что вы нажали на кнопку, но\nтекст не появился. Возможны десятки причин, почему этого не произошло.</p>\n<p>В этом разделе мы рассмотрим, как писать UI-тесты на Clojure. С подготовительной\nчастью вы уже знакомы: запускаем систему и наполняем базу тестовыми данными. А\nвот тест ведет себя по-новому. Он захватывает контроль над браузером и командует\nим. Например, открывает страницу <code>http://127.0.0.1:8080/</code> и щелкает по\nссылкам. В любой момент мы получим адрес страницы, ее заголовок и HTML-код. В\nтест добавляют формы <code>(is (= ...))</code>, чтобы проверить, на какой странице мы\nоказались или видит ли пользователь этот виджет.</p>\n<p>Чтобы управлять браузером, понадобится драйвер и библиотека к нему. Под\nдрайвером понимают утилиту командной строки. Когда драйвер запущен, он принимает\nзапросы от библиотеки по протоколу HTTP. Одновременно драйвер запускает браузер\nв особом режиме, и между ними образуется связь. Фактически, драйвер это\nпосредник между двумя акторами. Его работа сводится к переводу HTTP-команд в\nбинарный протокол браузера и наоборот.</p>\n<p>Каждый браузер работает со своим драйвером. Для Chrome он называется\n<code>chromedriver</code>, для FireFox — <code>geckodriver</code>. Одноименные утилиты ставятся из\nпакетных менеджеров <code>apt</code>, <code>yum</code> или <code>brew</code> в зависимости от операционной\nсистемы. Пользователи Windows скачают бинарные файлы с сайта проекта. Драйвер к\nSafari называется <code>safaridriver</code>. С версии 13 он идет в комплекте с Mac OS.</p>\n<p>Для работы с драйвером подойдет библиотека Etaoin. Добавьте ее в зависимости\nпрофиля :dev (библиотека нужна только для тестов):</p>\n<div><div><pre><code><span>:dev</span><span> </span><span>{</span><span>:dependencies</span><span> </span><span>[[</span><span>etaoin</span><span> </span><span>&quot;0.3.6&quot;</span><span>]]}</span><span>\n</span></code></pre></div></div>\n<p>Убедитесь, что драйвер находится в одной из папок, перечисленных в PATH,\nнапример, <code>/usr/local/bin</code>. Другими словами, его можно вызвать в терминале,\nпросто выполнив <code>chromedriver</code> или <code>geckodriver</code>. Путь до драйвера можно задать\nв опциях библиотеки, но пока что мы сами положим его в нужное место.</p>\n<p>Теперь напишем первый тест. Представим, что локальный сервер работает на\nпорту 8080. Тест открывает форму входа, заполняет поля и нажимает кнопку\n“Login”. Страница обновляется, наверху видно приветствие. Пользователь видит\nэлементы, которые прежде были скрыты (ссылки “My profile”, “Logout”).</p>\n<div><div><pre><code><span>(</span><span>ns</span><span> </span><span>project.integration-tests</span><span>\n</span><span>(</span><span>:require</span><span> </span><span>[</span><span>etaoin.api</span><span> </span><span>:as</span><span> </span><span>e</span><span>]))</span><span>\n</span><span>(</span><span>deftest</span><span> </span><span>test-ui-login-ok</span><span>\n</span><span>(</span><span>e/with-chrome</span><span> </span><span>{}</span><span> </span><span>driver</span><span>\n</span><span>(</span><span>e/go</span><span> </span><span>driver</span><span> </span><span>&quot;http://127.0.0.1:8080/login&quot;</span><span>)</span><span>\n</span><span>(</span><span>e/wait-visible</span><span> </span><span>driver</span><span> </span><span>{</span><span>:fn/has-text</span><span> </span><span>&quot;Login&quot;</span><span>})</span><span>\n</span><span>(</span><span>e/fill</span><span> </span><span>driver</span><span> </span><span>{</span><span>:tag</span><span> </span><span>:input</span><span> </span><span>:name</span><span> </span><span>:email</span><span>}</span><span> </span><span>&quot;test@test.com&quot;</span><span>)</span><span>\n</span><span>(</span><span>e/fill</span><span> </span><span>driver</span><span> </span><span>{</span><span>:tag</span><span> </span><span>:input</span><span> </span><span>:name</span><span> </span><span>:password</span><span>}</span><span> </span><span>&quot;J3QQ4-H7H2V&quot;</span><span>)</span><span>\n</span><span>(</span><span>e/click</span><span> </span><span>driver</span><span> </span><span>{</span><span>:tag</span><span> </span><span>:button</span><span> </span><span>:fn/text</span><span> </span><span>&quot;Login&quot;</span><span>})</span><span>\n</span><span>(</span><span>e/wait-visible</span><span> </span><span>driver</span><span> </span><span>{</span><span>:fn/has-text</span><span> </span><span>&quot;Welcome&quot;</span><span>})</span><span>\n</span><span>(</span><span>is</span><span> </span><span>(</span><span>e/visible?</span><span> </span><span>driver</span><span> </span><span>{</span><span>:tag</span><span> </span><span>:a</span><span> </span><span>:fn/text</span><span> </span><span>&quot;My profile&quot;</span><span>}))</span><span>\n</span><span>(</span><span>is</span><span> </span><span>(</span><span>e/visible?</span><span> </span><span>driver</span><span> </span><span>{</span><span>:tag</span><span> </span><span>:button</span><span> </span><span>:fn/text</span><span> </span><span>&quot;Logout&quot;</span><span>}))))</span><span>\n</span></code></pre></div></div>\n<p>Разберем отдельные выражения из этого теста. Форма <code>with-chrome</code> это макрос,\nкоторый запускает Хром на время исполнения тела. Макрос необходим, чтобы\nгарантированно закрыть драйвер при выходе или в случае ошибки. Без него пришлось\nбы писать код с ручным <code>try/catch</code>, что порождает вложенность и в целом\nнеудобно:</p>\n<div><div><pre><code><span>(</span><span>let</span><span> </span><span>[</span><span>driver</span><span> </span><span>(</span><span>e/chrome</span><span>)]</span><span>\n</span><span>(</span><span>try</span><span>\n</span><span>(</span><span>e/go</span><span> </span><span>driver</span><span> </span><span>&quot;http://...&quot;</span><span>)</span><span>\n</span><span>(</span><span>e/click</span><span> </span><span>driver</span><span> </span><span>{</span><span>:tag</span><span> </span><span>:button</span><span>})</span><span>\n</span><span>(</span><span>finally</span><span>\n</span><span>(</span><span>e/quit</span><span> </span><span>driver</span><span>))))</span><span>\n</span></code></pre></div></div>\n<p>Функция <code>wait-visible</code> ждет до тех пор, пока элемент не появится на экране. К\nней прибегают довольно часто, чтобы дождаться, пока браузер отрисует\nверстку. Если не разделить две инструкции ожиданием, между ними будет разница в\nнесколько миллисекунд. Второе действие либо не успеет выполниться, либо будет\nотброшено.</p>\n<p>Ожидание в UI-тестах это нормально. Основное время уходит на то, чтобы дождаться\nзагрузки и выполнить действия с задержкой, как это свойственно\nчеловеку. <code>Wait-visible</code> это лишь одна из семейства wait-функций. В их число\nвходит <code>wait-has-text</code> (дождаться текст на экране), <code>wait-has-class</code> (ждать,\nпока у элемента не появится класс) и многие другие.</p>\n<p>Драйвер ищет элементы на странице с помощью селекторов. Это строки с особыми\nвыражениями; различают CSS- и XPath-селекторы. Сейчас мы не будем разбирать их\nсинтаксис: это долго и заслуживает отдельной главы. Для простоты рассмотрим\nальтернативный прием. На элемент можно сослаться, задав его свойства\nсловарем. Ключи tag и id означают имя тега и его идентификатор. Другие ключи\nстановятся атрибутами тега. В примере выше селектор <code>{:tag :input :name :email}</code>\nстановится выражением <code>input[@name='email']</code> на языке XPath.</p>\n<p>Подумаем, как улучшить наш тест? Для начала рассмотрим порт 8080. Мы уже знаем,\nчто подобные значения приходят из конфигурации. Исправьте тест так, чтобы и\nсервер, и драйвер работали с одним и тем же портом.</p>\n<p>Вспомним, как работает <code>with-chrome</code>: он создает новый драйвер, выполняет тело и\nвыключает его. Если каждый тест обернут в <code>with-chrome</code>, мы теряем время,\nмногократно повторяя эти шаги. Сделаем так, чтобы драйвер работал на протяжении\nвсего прогона тестов. Объявим динамическую переменную и фикстуру, которая\nсвязывает драйвер на время тестов. Зарегистрируем ее с ключом <code>:once</code>.</p>\n<div><div><pre><code><span>(</span><span>defonce</span><span> </span><span>^</span><span>:dynamic</span><span> </span><span>*driver*</span><span> </span><span>nil</span><span>)</span><span>\n</span><span>(</span><span>defn</span><span> </span><span>fix-chrome</span><span> </span><span>[</span><span>t</span><span>]</span><span>\n</span><span>(</span><span>e/with-chrome</span><span> </span><span>{}</span><span> </span><span>driver</span><span>\n</span><span>(</span><span>binding</span><span> </span><span>[</span><span>*driver*</span><span> </span><span>driver</span><span>]</span><span>\n</span><span>(</span><span>t</span><span>))))</span><span>\n</span></code></pre></div></div>\n<p>Мы тестируем приложение в Хроме, самом популярном браузере. Но вот приходит\nзадача — убедиться, что мы также поддерживаем Firefox. Технически это значит,\nчто все тесты, которые мы написали для Хрома, должны сработать еще раз в другом\nбраузере. Скопировать их и заменить with-chrome на with-firefox — сомнительное\nрешение. Представьте, что через месяц нас попросят добавить Safari. Должен быть\nспособ, который не влечет за собой разрастание кода.</p>\n<p>Поможет мульти-фикстура, с которой мы знакомились в середине главы. Она\nпробегает по списку типов браузеров; в примере ниже это <code>:firefox</code> и\n<code>:chrome</code>. Макрос <code>with-driver</code> это общий случай <code>with-chrome</code> и\nаналогов. Отличие в том, что <code>with-driver</code> ожидает первым аргументом тип\nбраузера. На каждом шаге фикстура связывает драйвер и выполняет тест.</p>\n<div><div><pre><code><span>(</span><span>defn</span><span> </span><span>fix-multi-driver</span><span> </span><span>[</span><span>t</span><span>]</span><span>\n</span><span>(</span><span>doseq</span><span> </span><span>[</span><span>driver-type</span><span> </span><span>[</span><span>:firefox</span><span> </span><span>:chrome</span><span>]]</span><span>\n</span><span>(</span><span>e/with-driver</span><span> </span><span>driver-type</span><span> </span><span>{}</span><span> </span><span>driver</span><span>\n</span><span>(</span><span>binding</span><span> </span><span>[</span><span>*driver*</span><span> </span><span>driver</span><span>]</span><span>\n</span><span>(</span><span>testing</span><span> </span><span>(</span><span>format</span><span> </span><span>&quot;Browser %s&quot;</span><span> </span><span>(</span><span>name</span><span> </span><span>driver-type</span><span>))</span><span>\n</span><span>(</span><span>t</span><span>))))))</span><span>\n</span></code></pre></div></div>\n<p>Теперь тесты по очереди сработают в каждом из браузеров. Для ясности мы\nоборачиваем тест в сообщение о том, в рамках какого браузера его\nвызывают. Поддержка нового браузера сводится к тому, чтобы добавить в список\nключ <code>:safari</code>, <code>:edge</code> и другие.</p>\n<p>Еще один способ улучшить тесты — вынести одинаковые действия в фикстуру или\nфункцию. Например, каждый тест начинается с авторизации и заканчивается выходом\nиз системы. Чтобы не копировать эти действия каждый раз, напишем фикстуру\n<code>fix-login-logout</code>. В отличии от предыдущих фикстур, ее регистрируют с ключом\n<code>:each</code>.</p>\n<div><div><pre><code><span>(</span><span>defn</span><span> </span><span>fix-login-logout</span><span> </span><span>[</span><span>t</span><span>]</span><span>\n</span><span>(</span><span>doto</span><span> </span><span>*driver*</span><span>\n</span><span>(</span><span>e/go</span><span> </span><span>&quot;http://127.0.0.1:8080/login&quot;</span><span>)</span><span>\n</span><span>(</span><span>e/fill</span><span> </span><span>{</span><span>:tag</span><span> </span><span>:input</span><span> </span><span>:name</span><span> </span><span>:email</span><span>}</span><span> </span><span>&quot;test@test.com&quot;</span><span>)</span><span>\n</span><span>(</span><span>e/click</span><span> </span><span>{</span><span>:tag</span><span> </span><span>:button</span><span> </span><span>:fn/text</span><span> </span><span>&quot;Login&quot;</span><span>}))</span><span>\n</span><span>(</span><span>t</span><span>)</span><span>\n</span><span>(</span><span>doto</span><span> </span><span>*driver*</span><span>\n</span><span>(</span><span>e/click</span><span> </span><span>{</span><span>:tag</span><span> </span><span>:button</span><span> </span><span>:fn/text</span><span> </span><span>&quot;Logout&quot;</span><span>})</span><span>\n</span><span>(</span><span>e/wait-has-text</span><span> </span><span>&quot;Login&quot;</span><span>)))</span><span>\n</span></code></pre></div></div>\n<p>Попутно мы внедрили еще одну хорошую практику. Когда несколько функций принимают\nодинаковый первый аргумент, их объединяют в макрос doto. Он подставит <code>*driver*</code>\nна второе место в каждый список тела. С <code>doto</code> код становится немного короче и\nчище.</p>\n<h2>Другие решения</h2>\n<p>В последнем разделе мы перечислим другие библиотеки, полезные для тестов. Мы не\nбудем рассматривать их досконально: ограничимся кратким описанием и примером\nкода. Все ответы ищите в документации к проектам.</p>\n<h3>Продвинутые моки</h3>\n<p>На минуту вернемся к мокам — подмене функции через <code>with-redefs</code>. Этот макрос\nслишком многословен, чтобы работать с ним напрямую. Появились библиотеки,\nкоторые описывают мокинг короче и выразительнее. Одна из них называется\n<code>mockery</code>. Библиотека предлагает макрос <code>with-mock</code> следующего вида:</p>\n<div><div><pre><code><span>(</span><span>with-mock</span><span> </span><span>mock</span><span>\n</span><span>{</span><span>:target</span><span> </span><span>:project.path/get-geo-point</span><span>\n</span><span>:return</span><span> </span><span>{</span><span>:lat</span><span> </span><span>14.23</span><span> </span><span>:lng</span><span> </span><span>52.52</span><span>}}</span><span>\n</span><span>(</span><span>get-geo-point</span><span> </span><span>&quot;cafe&quot;</span><span> </span><span>&quot;200m&quot;</span><span>))</span><span>\n</span></code></pre></div></div>\n<p>В примере выше мы “замокали” <code>get-geo-point</code>, которая, судя по названию,\nобращается к стороннему сервису карт. Внутри макроса объект <code>mock</code> это атом,\nвнутри которого словарь. Он наполняется данными по мере того, как мы вызываем\nцель. Например, сколько раз ее вызвали и с какими аргументами. В выражении ниже\nмы добавили проверки на то, что функцию вызвали один раз с аргументами “cafe” и\n“200m”.</p>\n<div><div><pre><code><span>(</span><span>let</span><span> </span><span>[{</span><span>:keys</span><span> </span><span>[</span><span>called?</span><span> </span><span>call-count</span><span> </span><span>call-args</span><span>]}</span><span> </span><span>@</span><span>mock</span><span>]</span><span>\n</span><span>(</span><span>is</span><span> </span><span>called?</span><span>)</span><span>\n</span><span>(</span><span>is</span><span> </span><span>(</span><span>=</span><span> </span><span>1</span><span> </span><span>call-count</span><span>))</span><span>\n</span><span>(</span><span>is</span><span> </span><span>(</span><span>=</span><span> </span><span>'</span><span>(</span><span>&quot;cafe&quot;</span><span> </span><span>&quot;200m&quot;</span><span>)</span><span> </span><span>call-args</span><span>)))</span><span>\n</span></code></pre></div></div>\n<p>Библиотека <code>spy</code> устроена похожим образом. На функцию навешивается “шпион”,\nкоторый копит данные о вызове.</p>\n<div><div><pre><code><span>(</span><span>defn</span><span> </span><span>adder</span><span> </span><span>[</span><span>x</span><span> </span><span>y</span><span>]</span><span> </span><span>(</span><span>+</span><span> </span><span>x</span><span> </span><span>y</span><span>))</span><span>\n</span><span>(</span><span>def</span><span> </span><span>spy-adder</span><span> </span><span>(</span><span>spy/spy</span><span> </span><span>adder</span><span>))</span><span>\n</span><span>(</span><span>testing</span><span> </span><span>&quot;calling the function&quot;</span><span>\n</span><span>(</span><span>is</span><span> </span><span>(</span><span>=</span><span> </span><span>3</span><span> </span><span>(</span><span>spy-adder</span><span> </span><span>1</span><span> </span><span>2</span><span>))))</span><span>\n</span><span>(</span><span>testing</span><span> </span><span>&quot;calls to the spy can be accessed via spy/calls&quot;</span><span>\n</span><span>(</span><span>is</span><span> </span><span>(</span><span>=</span><span> </span><span>[[</span><span>1</span><span> </span><span>2</span><span>]]</span><span> </span><span>(</span><span>spy/calls</span><span> </span><span>spy-adder</span><span>))))</span><span>\n</span></code></pre></div></div>\n<h3>Альтернативный синтаксис</h3>\n<p>Проект <code>midje</code> предлагает другой способ писать тесты. В этой библиотеке мы имеем\nдело с фактами. Факт это набор проверок, сгруппированных по смыслу. В примере\nниже факты о функции <code>split</code>:</p>\n<div><div><pre><code><span>(</span><span>facts</span><span> </span><span>&quot;about `split`&quot;</span><span>\n</span><span>(</span><span>str/split</span><span> </span><span>&quot;a/b/c&quot;</span><span> </span><span>#</span><span>&quot;/&quot;</span><span>)</span><span> </span><span>=></span><span> </span><span>[</span><span>&quot;a&quot;</span><span> </span><span>&quot;b&quot;</span><span> </span><span>&quot;c&quot;</span><span>]</span><span>\n</span><span>(</span><span>str/split</span><span> </span><span>&quot;&quot;</span><span> </span><span>#</span><span>&quot;irrelvant&quot;</span><span>)</span><span> </span><span>=></span><span> </span><span>[</span><span>&quot;&quot;</span><span>])</span><span>\n</span></code></pre></div></div>\n<p>Стрелка между выражениями это особый оператор, который называется extended\nequality, продвинутое равенство. С ее помощью сравнение величин записывается\nкороче. Например, форма <code>1 => even?</code> приходит к виду <code>(even? 1)</code>. В <code>midje</code>\nвстречаются и другие, более сложные стрелки для проверки коллекций и макросов.</p>\n<h3>Вывод XUnit</h3>\n<p>Плагин <code>test2junit</code> делает так, что отчет о тестах пишется в XML-файл формата\nXUnit. Системы непрерывной интеграции, например, CircleCI или TeamCity понимают,\nкак отобразить его графически. Такой отчет легче просматривать, чем вывод\nконсоли. Проблемные места выделены красным, стектрейсы спрятаны под выпадающие\nэлементы. Плагину нужно задать путь к папке, куда писать файл.</p>\n<div><div><pre><code><span>:plugins</span><span> </span><span>[[</span><span>test2junit</span><span> </span><span>&quot;1.1.2&quot;</span><span>]]</span><span>\n</span><span>:test2junit-output-dir</span><span> </span><span>&quot;target/test2junit&quot;</span><span>\n</span></code></pre></div></div>\n<h3>Генерация данных</h3>\n<p>Возможно, вы столкнетесь с тем, что для тестов нужен большой объем данных,\nнапример, сто или двести тысяч записей. При этом данные должны быть разнообразны\n— нас не устроит один и тот же набор, скопированный тысячу раз. Поможет\nбиблиотека <code>test.check</code>. Ее модуль gen генерирует случайные данные по заданным\nправилам. Особенно полезна генерация записей. В примере ниже мы получаем кортеж\nстроки, числа и булева типа. Затем применяем его к конструктору <code>->User</code>.</p>\n<div><div><pre><code><span>(</span><span>defrecord</span><span> </span><span>User</span><span> </span><span>[</span><span>user-name</span><span> </span><span>user-id</span><span> </span><span>active?</span><span>])</span><span>\n</span><span>(</span><span>def</span><span> </span><span>user-gen</span><span>\n</span><span>(</span><span>gen/fmap</span><span> </span><span>(</span><span>partial</span><span> </span><span>apply</span><span> </span><span>->User</span><span>)</span><span>\n</span><span>(</span><span>gen/tuple</span><span> </span><span>(</span><span>gen/not-empty</span><span> </span><span>gen/string-alphanumeric</span><span>)</span><span>\n</span><span>gen/nat</span><span>\n</span><span>gen/boolean</span><span>)))</span><span>\n</span><span>(</span><span>last</span><span> </span><span>(</span><span>gen/sample</span><span> </span><span>user-gen</span><span>))</span><span>\n</span><span>;; => #user.User{:user-name &quot;dfgJKSHF3&quot;</span><span>\n</span><span>;; :user-id 5</span><span>\n</span><span>;; :active? false}</span><span>\n</span></code></pre></div></div>\n<p>Библиотека <code>clojure.spec</code>, которой мы посвятили главу, идет еще дальше. С\nпомощью <code>test.check</code> она генерирует данные по спеке. Так проявляется еще одно\nсвойство спек: кроме проверки, они подходят для тестовых данных.</p>\n<div><div><pre><code><span>(</span><span>s/def</span><span> </span><span>:user/id</span><span> </span><span>int?</span><span>)</span><span>\n</span><span>(</span><span>s/def</span><span> </span><span>:user/name</span><span> </span><span>string?</span><span>)</span><span>\n</span><span>(</span><span>s/def</span><span> </span><span>:user/active?</span><span> </span><span>boolean?</span><span>)</span><span>\n</span><span>(</span><span>s/def</span><span> </span><span>::user</span><span> </span><span>(</span><span>s/keys</span><span> </span><span>:req-un</span><span> </span><span>[</span><span>:user/id</span><span> </span><span>:user/name</span><span> </span><span>:user/active?</span><span>]))</span><span>\n</span><span>(</span><span>gen/generate</span><span> </span><span>(</span><span>s/gen</span><span> </span><span>::user</span><span>))</span><span>\n</span><span>{</span><span>:id</span><span> </span><span>88546920</span><span>,</span><span> </span><span>:name</span><span> </span><span>&quot;Z4MO7GH80k3mRD&quot;</span><span>,</span><span> </span><span>:active?</span><span> </span><span>true</span><span>}</span><span>\n</span></code></pre></div></div>\n<p>Возможности <code>spec.gen</code> обширны. С ее помощью порождают связанные данные,\nнапример, пользователей, которые ссылаются на профили и наоборот. Вместо\nслучайных величин можно опираться на допустимые значения (списки имен,\nгородов). Спеки бывают быть любой вложенности, что открывает поле для\nэкспериментов.</p>\n<h2>Порядок аргументов</h2>\n<p>Необычный вопрос: как писать правильно, <code>(is (= 200 status))</code> или <code>(is (= status\n200))</code>? На первый взгляд это абсурд. Разве может порядок аргументов влиять на\nравенство? Значения либо равны, либо нет. Однако, макрос <code>is</code> устроен сложнее,\nчем мы думаем. Он разбирает выражение <code>(= 200 status)</code> и выделяет ожидаемую и\nфактическую части. По-английски они называются expected и actual.</p>\n<p>Ожидаемое это значение, на которое рассчитывает тест. Как правило, это готовое\nчисло или коллекция, которую посчитали заранее. Фактическое значение — то, к\nкоторому мы пришли самостоятельно, например, вызвав функцию. Так, число 68 это\nожидаемое, а <code>(int (->fahr 20))</code> — действительное. Статус 200 это ожидаемое, а\n<code>(:status response)</code> — действительное.</p>\n<p>Такое разделение необходимо для отчетов. Когда значения не равны, нам бы\nхотелось увидеть, где мы ошиблись. Предположим, что в отчете написано: <code>failed\n(= 200 403)</code>. Не совсем ясно, как это трактовать. Мы ожидали успешный ответ, но\nне хватило прав доступа? Или это брешь в безопасности — ожидали, что прав на эту\nстраницу нет, но пользовать все-таки ее увидел? Если же написано expected 200,\ngot 403, то все ясно — это первый случай (не хватило прав).</p>\n<p>Теперь запомните правило: ожидаемое стоит на первом месте, а действительное на\nвтором. Поэтому пишите <code>(is (= 200 status))</code> вместо <code>(is (= status 200))</code>. Автор\nсогласен, что это непривычно и противоречит здравому смыслу. Как правило,\nфактическое это число, а действительное — длинное выражение, поэтому хочется\nзаписать их как слева. Увы, придется побороть себя и писать как справа:</p>\n<div><div><pre><code><span>;; wrong ;; correct</span><span>\n</span><span>(</span><span>=</span><span> </span><span>(</span><span>int</span><span> </span><span>(</span><span>->fahr</span><span> </span><span>20</span><span>))</span><span> </span><span>68</span><span>)</span><span> </span><span>(</span><span>=</span><span> </span><span>68</span><span> </span><span>(</span><span>int</span><span> </span><span>(</span><span>->fahr</span><span> </span><span>20</span><span>)))</span><span>\n</span></code></pre></div></div>\n<p>Это не ошибка дизайна; правило уходит корнями в прошлое. Первый тестовый\nфреймворк <code>JUnit</code> утвердил именно такой порядок в методах сравнения. Хорошо это\nили плохо, судить уже поздно — принцип “expected слева” стал промышленным\nстандартом. Аналогичное правило работает в языках Python, Ruby и\nдругих. Отдельные фреймворки предлагают модули, чтобы “перестать говорить как\nЙодо”, то есть поменять семантику аргументов. Технически это возможно и в\nClojure, но сейчас мы не будем это рассматривать.</p>\n<p>Особенность expected и actual видна при запуске тестов в CIDER. Один и тот же\nтест проверяет статус ответа на 200. Пока все идет хорошо, нет разницы, в каком\nпорядке мы записали аргументы. Но в случе ошибки вариант слева вносит\nпутаницу. Согласно ему, нормальным считается статус 404, а не 200. Вариант\nсправа выводит статусы правильно.</p>\n<div><div><pre><code>;; wrong                ;; correct\n(is (= status 200))     (is (= 200 status))\n\nFail in test-...        Fail in test-...\nexpected: 404           expected: 200\n  actual: 200             actual: 404\n    diff: - 404             diff: - 200\n          + 200                   + 404\n</code></pre></div></div>\n<p>Тем не менее, не стоит соблюдать это правило слишком рьяно. Иногда равенство с\nперепутанными аргументами смотрится лучше, и потому код легче\nподдерживать. Следить за порядком или нет остается на усмотрение команды. Автор\nпризнаётся, что на этапе черновика перепутал аргументы везде, где это возможно.</p>",
   :direction "ltr"},
  :updated 1574121600000,
  :entities
  [{:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "user name"} {:text "user"}],
    :id "nlp/f/entity/wd:26403005",
    :salienceLevel "mention",
    :label "username"}
   {:mentions [{:text "JSON"}],
    :id "nlp/f/entity/wd:2063",
    :salienceLevel "mention",
    :label "JavaScript Object Notation"}
   {:mentions [{:text "JDBC"}],
    :id "nlp/f/entity/wd:722772",
    :salienceLevel "mention",
    :label "Java Database Connectivity"}
   {:mentions [{:text "INSERT"}],
    :id "nlp/f/entity/wd:1076017",
    :salienceLevel "mention",
    :label "INSERT"}],
  :alternate
  [{:href "https://grishaev.me/clj-book-tests-2/", :type "text/html"}],
  :title "Тесты в Clojure (второй фрагмент)",
  :author "Ivan Grishaev",
  :published-str "Mon Nov 18 16:00:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16e82e252fe:4823f91:97b0c8f7",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://grishaev.me/clj-book-tests-2/",
  :updateCount 1,
  :commonTopics
  [{:score 66.47592877878228,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1574121600000,
  :fingerprint "ed91d069",
  :canonicalUrl "https://grishaev.me/clj-book-tests-2/"}
 {:engagement 6,
  :unread false,
  :crawled 1574098916244,
  :content
  {:content
   "<div><h1>Senior UI Developer</h1><div>Apstra | Menlo Park, CA</div><div><a href=\"https://apstra.com/company/about-apstra/\">https://apstra.com/company/about-apstra/</a></div><br><div><p>Apstra is looking for UI engineers to work on our growing platform. Our core product is an infrastructure management tool that allows networking architects and operators to design, deploy, validate and operate large network infrastructures end-to-end. </p><p>Engineering challenges include building UI forms, visualizations, and interactions that will simplify complex Network operation workflows for the end-users.</p><h2>Responsibilities</h2>\n<ul>\n<li>Working with product management and back-end engineering teams to define how new features will work from the UI perspective based on user stories and available API definitions</li>\n<li>Implement new features in ClojureScript and re-frame</li>\n<li>Working with testing teams to optimize UI for testing automation</li>\n<li>Optimize UI architecture and UX to work well for large scale deployments and growing amounts of real-time data</li>\n</ul><h2>Requirements</h2><h3>Must</h3>\n<ul>\n<li>Recent experience working with ClojureScript or experience building front-ends written in a functional style and willingness to learn ClojureScript</li>\n<li>Experience building medium to large size Single-page applications (SPAs)</li>\n<li>Experience working with RESTful and REST-like APIs</li>\n<li>Understanding of JavaScript and React ecosystems</li>\n<li>Ability to take ownership of the feature and drive its delivery with minimal supervision</li>\n<li>Ability to create UIs based on a minimal set of requirements</li>\n</ul><h3>Nice to have</h3>\n<ul>\n<li>Experience using Reagent and re-frame</li>\n<li>Experience building visualizations for real-time data</li>\n<li>Understanding of Networking and/or Infrastructure Management domains</li>\n<li>Basic design skills</li>\n<li>Experience working in a startup environment</li>\n</ul><p>What We Do</p><p>Apstra pioneered Intent-Based Networking for the data center and Intent-Based Analytics.</p><p>Apstra's intent-based networking for the data center enables enterprises, cloud providers, and telcos to increase application reliability and availability simplifies deployments and operations through automation, and dramatically reduces OpEx and CapEx costs. Apstra enables vendor-agnostic data center lifecycle automation and is deployed by many businesses around the world including Fortune 100 Enterprises. These companies are taking advantage of game-changing agility, reliability and significantly lower TCO with complete flexibility to deploy the hardware and network operating system of their choice. Apstra is headquartered in Menlo Park, California and privately funded. Apstra is a Gartner Cool Vendor and Best of VMworld winner. </p><p>For more information visit: <a href=\"https://www.apstra.com/company/careers/\">https://www.apstra.com/company/careers/</a></p></div></div>",
   :direction "ltr"},
  :updated 1574097243000,
  :entities
  [{:mentions [{:text "Menlo Park, California"} {:text "Menlo Park"}],
    :id "nlp/f/entity/wd:74195",
    :salienceLevel "mention",
    :label "Menlo Park"}
   {:mentions [{:text "Network"}],
    :id "nlp/f/entity/wd:572165",
    :salienceLevel "mention",
    :label "Network"}
   {:mentions [{:text "functional style"}],
    :id "nlp/f/entity/wd:2313235",
    :salienceLevel "mention",
    :label "style"}
   {:mentions [{:text "API"}],
    :id "nlp/f/entity/wd:165194",
    :salienceLevel "mention",
    :label "application programming interface"}
   {:mentions [{:text "network operating system"}],
    :id "nlp/f/entity/wd:282080",
    :salienceLevel "mention",
    :label "network operating system"}],
  :alternate
  [{:href
    "https://jobs.braveclojure.com/jobs/17592186047135/senior-ui-developer-apstra",
    :type "text/html"}],
  :title "Senior UI Developer",
  :author "Brave Clojure Jobs",
  :published-str "Mon Nov 18 09:14:03 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16e7f9b5394:43cc4c5:49b12733",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://jobs.braveclojure.com/jobs/17592186047135/senior-ui-developer-apstra",
  :commonTopics
  [{:score 43.351700354156804,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1574097243000,
  :fingerprint "2f58d755",
  :canonicalUrl
  "https://jobs.braveclojure.com/jobs/17592186047135/senior-ui-developer-apstra"}
 {:engagement 9,
  :unread false,
  :crawled 1574081227904,
  :recrawled 1574346473849,
  :content
  {:content
   "<p>When we look at the definitions of algebraic properties, we often see that we are defining how things compose. This is one of the main advantages of using algebraic properties to constrain our operations. If we define how they should compose before we implement them (as a unit test, for instance) we can guarantee that things will compose.</p>\n<p></p>\n<div>\n<div><span></span><img alt=\"Video Thumbnail\" src=\"https://i.ytimg.com/vi/tDS7-YRKu_4/mqdefault.jpg\"><p></p>\n<h5>Algebra is about composition</h5>\n<p><span>When we look at the definitions of algebraic properties, we often see that we are defining how things compose. This is one of the main advantages of using algebraic properties to constrain our operations. If we define how they should compose before we implement them (as a unit test, for instance) we</span></p></div>\n</div>\n<h2>Transcript</h2>\n<p>Eric Normand: Algebra is all about composition. In this episode, I’m going to follow up with a previous episode I did, all about algebra and algebraic properties, and why they were important.</p>\n<p>It’s something I forgot to talk about, which is that one of the reasons that we use algebra is that it helps us to find how things compose.</p>\n<p>My name is Eric Normand, and I help people thrive with Functional Programming.</p>\n<p>Like I said before, a few episodes ago, I talked all about algebra and why I liked the ideas. As soon as it was published and everything, I realized, “Oh, man. I left out the why. Why is this important?”</p>\n<p>Functional programmers talk a lot about composition, about building things out of small, simple pieces that compose really well. That’s how you make more complex, more useful things. You make them out of smaller things by composing.</p>\n<p>That’s all well and good. It’s true. But then, what does the composition really mean? How do you ensure that things compose well? Algebra and algebraic properties are really the study of that kind of composition. I want to try to explain why.</p>\n<p>If you have some algebraic property, usually it is about…OK, I don’t want to say “usually,” because I haven’t done a full, exhaustive study. Very often, if you take something like associativity, this is the case.</p>\n<p>Very often, it’s a formula, right? It’s some equation, some equality, that this thing is equal to that thing. They’re equivalent, so you could swap between them in your code, those two things. What are the two things that are equivalent?</p>\n<p>In associativity, it’s calling something with the first two…if you’re calling an operator or a function with the first two elements, and then using the result of that with a third element in the same function, is equal to calling the first one with the operation applied to the second two.</p>\n<p>What are you doing? You’re comparing the function call with itself. You’re basically showing how these function calls can compose. Take commutativity. Commutativity says, “F of A and B is equal to F of B and A.” You’re comparing the function to itself, OK?</p>\n<p>There’s no real composition there, except in the sense that with a lot of arguments like the arguments they’re composing in a certain order, but associativity is actually a better example.</p>\n<p>What you’re doing is, you’re showing that these things can compose in certain regular ways. By ensuring that you have that property, you’re ensuring that you can do things down the line later with those operators, with those functions.</p>\n<p>Often, we talk about composition, but we don’t know how to build it in. Maybe we use our intuitions. Maybe we use our experience like, “Oh, if I do something this way, I know I’ll be able to do this other thing later with it.”</p>\n<p>These algebraic properties, at least many of them, are ways of doing that up front, ahead of time. That is one of the reasons why I think algebraic properties are important for functional programming.</p>\n<p>We talk about composition. This is where composition comes from. These are the ways that we compose things. Now, I’m not a stickler for the mathematical algebraic properties, meaning I think you could come up with new ones.</p>\n<p>You could come up with new ways of composing functions that either haven’t been named yet by mathematicians, or they have, but you don’t have to know the name. You can make up your own formulas. You can start with the formulas and modify them a little bit.</p>\n<p>I think that’s all great. Just know that when you go off the path, you don’t have as much to rely on, but sometimes you don’t need it. Most of the time you don’t need it, so that’s fine.</p>\n<p>An example of going off the path is, I like to talk about merge, so merging two hash maps. It is associative. Everyone would agree, it’s associative. It’s a clear example of associativity. However, it’s not commutative in general. The order does matter, the order of the arguments.</p>\n<p>If you have two hash maps and they share a key but they have different values, one of those is going to have to win. One of them is going to overwrite the other. That usually depends on which position it’s in. If it’s in the first argument position versus the second argument position, usually higher numbered arguments overwrite the lower number arguments.</p>\n<p>Order matters. It’s not commutative, except if you put an if statement around it, you could say it’s commutative. It is commutative if they don’t share keys, right? There’s no keys to overwrite the other, it’s commutative.</p>\n<p>Very often, at least in Clojure and other languages where you use hash maps a lot, you often know the keys that you have. You often know that there are no shared keys. Merge in those case, is commutative.</p>\n<p>How would that translate into something useful, or something practical? If you were doing a property-based test, you could put that as a condition on the data that gets generated.</p>\n<p>OK, generated means two random hash maps and filter out all the ones that have keys in common. Now, those two hash maps, they don’t share any keys. It’s commutative with those two arguments.</p>\n<p>I like to play with it. I start with the standard definitions, and then change it from there. Often, you’re not dealing with strict equality, you’re dealing with some other kind of equality that doesn’t take into account timestamps, or something like that.</p>\n<p>It’s not really equals, that equals is flexible, etc. You’re still dealing with composition, and that’s what I wanted to talk about.</p>\n<p>OK, I feel like I’ve touched on this enough, so I’m going to wrap it up. If you like this episode, you can find all the past episodes at lispcast.com/podcast. There, you’ll find all the past episodes with audio, video, and text transcripts, however you want to consume it.</p>\n<p>You’ll also find links to subscribe. Please do subscribe, so that you’ll get all the new episodes as they come out, and links to find me on social media, where you can get in touch with me and ask me questions, comment. A lot of these topics come from questions.</p>\n<p>This has been my thought on Functional Programming. My name is Eric Normand. Thank you for listening, and rock on.</p>\n<p>The post <a rel=\"nofollow\" href=\"https://lispcast.com/algebra-is-about-composition/\">Algebra is about composition</a> appeared first on <a rel=\"nofollow\" href=\"https://lispcast.com\">LispCast</a>.</p>",
   :direction "ltr"},
  :updated 1574078400000,
  :entities
  [{:mentions [{:text "algebra"}],
    :id "nlp/f/entity/wd:3968",
    :salienceLevel "about",
    :label "algebra"}
   {:mentions [{:text "functional programming"}],
    :id "nlp/f/entity/wd:193076",
    :salienceLevel "mention",
    :label "functional programming"}
   {:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}],
  :alternate
  [{:href "https://lispcast.com/algebra-is-about-composition/",
    :type "text/html"}],
  :title "Algebra is about composition",
  :author "Eric Normand",
  :published-str "Mon Nov 18 04:00:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16e7e8d6c80:423daa0:49b12733",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url "https://i.ytimg.com/vi/tDS7-YRKu_4/mqdefault.jpg",
   :width 320,
   :height 180,
   :contentType "image/jpeg"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://lispcast.com/?p=2085",
  :updateCount 1,
  :commonTopics
  [{:score 35.80162254938399,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1574078400000,
  :fingerprint "8a47a1",
  :canonicalUrl "https://lispcast.com/algebra-is-about-composition/"}
 {:engagement 9,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1574076829294,
  :content
  {:content
   "<div>\n<p><em>Issue 352 – November 18, 2019 · <a href=\"https://purelyfunctional.tv/newsletter-archives/\">Archives</a> · <a title=\"Thanks, Jeff!\" href=\"https://purelyfunctional.tv/newsletter/\">Subscribe</a></em></p>\n<h2>First Annual PurelyFunctional.tv Survey! 📋</h2>\n<p>I’m happy to announce the first annual <a title href=\"https://purelyfunctional.tv/annual-customer-survey/\">PurelyFunctional.tv Survey</a>. Your answer to this quick survey will help me understand how to improve my videos and help you master Clojure faster and more deeply.</p>\n<p>There are only four questions. If you’ve watched any of my video content, please take a few minutes to <a title href=\"https://purelyfunctional.tv/annual-customer-survey/\">fill this out</a>. I appreciate any answer you can give.</p>\n<p><a title href=\"https://purelyfunctional.tv/annual-customer-survey/\">Fill out the survey</a></p>\n<p>The survey will run for a few weeks.</p>\n<h2>Clojure Tip 💡</h2>\n<p><em>use the right comment for the job</em></p>\n<p>Let’s face it: sometimes commenting out code is useful. Sometimes you want to test a large piece of code without launching the missile just yet. Comment out the code! And many Clojurists keep snippets of code in a comment at the end of a file to facilitate Repl-Driven Development. And then, of course, there are comments that are actually comments on the code.</p>\n<p>Clojure has three ways to ignore input. Each is different in significant ways. Each has found a use in the community. Let’s go over each of them.</p>\n<p><strong>Line comments</strong></p>\n<p>If you put a semicolon in your code (anywhere outside of a string or a character literal) it starts a comment that goes till the end of the line. Anything characters are allowed in that comment. It won’t be read or parsed, just ignored. People use these for two purposes:</p>\n<p>1. To add a note in natural language to the code.</p>\n<pre><code>;; 1002 works. I don't know why. Change at your own risk.\n(run-me 1002) ; here is the magic number\n</code></pre>\n<p>As a community, and in many editors, double semicolons indicate comments that shouldn’t be grossly indented. Single semicolons are for comments that come after other code on the same line.</p>\n<p>2. To comment out a single line of code.</p>\n<p>Sometimes the code you want to comment out is all on one line at the end of the line, and you just want to insert a single <code>;</code>. Go for it.</p>\n<pre><code>(doseq [task tasks]\n  ;;(println task)\n  (run-task task))\n</code></pre>\n<p><strong><code>comment</code> macro</strong></p>\n<p>There’s a macro called <code>comment</code> that will comment out any number of forms. All you have to do is surround the forms with the <code>comment</code> macro. There are some gotchas:</p>\n<ol>\n<li>It’s a macro, so the forms inside have to be valid for the Clojure reader. That means you have to obey all the syntax rules for numbers, symbols, and braces matching.</li>\n<li>The <code>comment</code> form itself is still an expression in your program. It evaluates to <code>nil</code>. That could have an effect on any surrounding forms.</li>\n</ol>\n<p>In short, it’s just a way to avoid executing code, but not useful for text. It’s also not very useful for commenting out sub-expressions since it evaluates to <code>nil</code>.</p>\n<p>So what do people use this for? Mostly for code they want to run during development but not in the normal flow of production code. It’s common to put a <code>comment</code> block at the end of a file with expressions to evaluate for testing.</p>\n<p>It sounds weird, but it’s better than typing in the same expressions over and over into the REPL prompt. Most editors have a setting so you can evaluate expressions inside the <code>comment</code> just like top-level expressions.</p>\n<p><strong><code>#_</code> reader macro</strong></p>\n<p>Clojure’s reader has a reader macro (different from a regular macro) that directs the reader to ignore the next form. That is, it reads a form and then throws it away. It’s a nice way to ignore an entire expression.</p>\n<pre><code>#_(println a\n    b\n    c\n    d)\n</code></pre>\n<p>Notice that this one works really well for multi-line expressions. Unlike <code>;</code>, which ignores everything up to the end of the line, <code>#_</code> ignores the entire next expression. It’s the perfect way to “turn off” one expression. It even works for sub-expressions—it is truly ignored by the reader, not replaced with <code>nil</code>. It’s great for dropping an argument, for instance.</p>\n<p>But get this: they stack. Often, we want to ignore two expressions, not just one. Here’s a case:</p>\n<pre><code>(def mappings {:a 1 :b 2 :c 3})\n</code></pre>\n<p>What if we want to get rid of the mapping of <code>:a</code> to <code>1</code>? We could do this:</p>\n<pre><code>(def mappings {#_:a #_1 :b 2 :c 3})\n</code></pre>\n<p>But because <code>#_</code> ignores the next expression, there is a better way. Two <code>#_</code>s will ignore the next 2 expressions:</p>\n<pre><code>(def mappings {#_#_:a 1 :b 2 :c 3})\n</code></pre>\n<p>Now there’s just one thing to delete if you want to turn it back on.</p>\n<p><em>Thanks to Ray McDermott and the rest of the panel at <a title href=\"https://www.youtube.com/channel/UC1UxEQuBvfLJgWR5tk_XIXA\">Apropos Clojure</a> for this final tip.</em></p>\n<h2>Conference alert 🚨</h2>\n<p>I booked my tickets to the 2019 Clojure/conj in Durham, North Carolina. If you’re going, let me know! I haven’t been to a Conj in a couple of years and I’m really excited.</p>\n<p>Ask me about my book and I’ll give you a discount code.</p>\n<p>I am considering bringing a board game to play at the board game night.</p>\n<h2>Currently recording 🎥</h2>\n<p><em>Property-Based Testing with test.check</em> is now split into three courses, <a title href=\"https://purelyfunctional.tv/courses/property-based-testing-with-test-check/\">Beginning</a>, <a title href=\"https://purelyfunctional.tv/courses/intermediate-property-based-testing-with-test-check/\">Intermediate</a>, and <a title href=\"https://purelyfunctional.tv/courses/advanced-property-based-testing-with-test-check/\">Advanced</a>. </p>\n<p>Last week I promised a flood but all I’ve got is a trickle. Coming back from vacation is hard :). However, they are now available to purchase for a low price for the launch sale. I will end the sale after the Conj. That gives you two weeks to buy them. They will never be this inexpensive again!</p>\n<h2>Book update 📖</h2>\n<p>I have been getting such great stories from readers of <a title href=\"https://lispcast.com/gs\"><em>Grokking Simplicity</em></a>. People tell me they are making their code more organized and testable. After all of the work I put into the book, it feels good that it’s having such a great impact.</p>\n<p>You can <a title href=\"https://lispcast.com/gs\">buy the book</a> and use the coupon code <strong>TSSIMPLICITY</strong> for 50% off.</p>\n<p>Thanks for reading.</p>\n<h2>Clojure Challenge 🤔</h2>\n<h3>Last week’s challenge</h3>\n<p>Well, I got no submissions from last week.</p>\n<h3>This week’s challenge</h3>\n<p>Write a program that outputs all possibilities to put a + or – or nothing between the numbers 1-9 (in order) such that the result is 100. For example:</p>\n<pre><code>1 + 2 + 34 - 5 + 67 - 8 + 9 = 100\n</code></pre>\n<p>The function should output a list of strings with these formulas.</p>\n<p>Hint: this is a recursive problem. Use divide and conquer.</p>\n<p>As usual, please reply to this email to send me your submissions. I’ll collect them up and share them in the next issue. If you don’t want me to share your submission, let me know.</p>\n<p>Rock on!<br>Eric Normand</p>\n</div>\n<p>The post <a rel=\"nofollow\" href=\"https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-352-tip-use-the-right-kind-of-comment-for-the-job/\">PurelyFunctional.tv Newsletter 352: Tip: use the right kind of comment for the job</a> appeared first on <a rel=\"nofollow\" href=\"https://purelyfunctional.tv\">PurelyFunctional.tv</a>.</p>",
   :direction "ltr"},
  :updated 1574074800000,
  :entities
  [{:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "Survey"}],
    :id "nlp/f/entity/wd:1144458",
    :salienceLevel "mention",
    :label "archaeological field survey"}
   {:mentions [{:text "REPL"}],
    :id "nlp/f/entity/wd:2032810",
    :salienceLevel "mention",
    :label "Read–eval–print loop"}
   {:mentions [{:text "natural language"}],
    :id "nlp/f/entity/wd:33742",
    :salienceLevel "mention",
    :label "natural language"}
   {:mentions [{:text "magic number"}],
    :id "nlp/f/entity/wd:11606",
    :salienceLevel "mention",
    :label "magic number"}],
  :alternate
  [{:href
    "https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-352-tip-use-the-right-kind-of-comment-for-the-job/",
    :type "text/html"}],
  :title
  "PurelyFunctional.tv Newsletter 352: Tip: use the right kind of comment for the job",
  :author "Eric Normand",
  :published-str "Mon Nov 18 03:00:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16e7e4a4e6e:41d6c8f:49b12733",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://purelyfunctional.tv/?p=35102",
  :commonTopics
  [{:score 23.829620968585793,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.844,
    :id "nlp/f/topic/774",
    :salienceLevel "mention",
    :label "engineering"}
   {:score 0.8209235780933606,
    :id "nlp/f/topic/10100",
    :salienceLevel "about",
    :label "digest"}],
  :published 1574074800000,
  :fingerprint "416337b6",
  :canonicalUrl
  "https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-352-tip-use-the-right-kind-of-comment-for-the-job/"}
 {:engagement 4,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1573929506746,
  :recrawled 1573931695343,
  :content
  {:content
   "<p>At the risk of diluting the brand message (i.e. testing kafka stuff\nusing Clojure), in this post, I’m going to introduce some code for\nextracting a report on the status of Kafka Connect jobs. I’d argue\nit’s still “on-message”, falling as it does under the\nobservability/metrics umbrella and since observability is an integral\npart of <a href=\"https://medium.com/@copyconstruct/testing-in-production-the-safe-way-18ca102d0ef1\">testing in\nproduction</a>\nthen I think we’re on safe ground.</p>\n<p>I know I promised a deep-dive on the test-machine journal but it’s\nbeen a crazy week and I needed to self-sooth by writing about\nsomething simpler that was mostly ready to go.</p>\n<h2>Kafka Connect API</h2>\n<p>The distributed version of Kafka Connect provides an HTTP API for\nmanaging jobs and providing access to their configuration and current\nstatus, including any errors that have caused the job to stop\nworking. It also provides metrics over JMX but that requires</p>\n<ol>\n<li>Server configuration that is not enabled by default</li>\n<li>Access to a port which is often only exposed inside the production\nstack and is intended to support being queried by a “proper”\nmonitoring system</li>\n</ol>\n<p>This is not to say that you shouldn’t go ahead and setup proper\nmonitoring. You definitely should. But you needn’t let the absence of\nit prevent you from quickly getting an idea of overall health of your\nKafka Connect system.</p>\n<p>For this script we’ll be hitting two of the endpoints provided by\nKafka Connect</p>\n<h2>GET /connectors</h2>\n<p>Here’s the function that hits the <code>/connectors</code> endpoint. It uses Zach\nTellman’s <a href=\"https://github.com/ztellman/aleph\">aleph</a> and\n<a href=\"https://github.com/ztellman/manifold\">manifold</a> libraries. The\n<code>http/get</code> function returns a deferred that allows the API call to be\nhandled asynchronously by setting up a “chain” of operations to deal\nwith the response when it arrives.</p>\n<figure><pre><code><span>(</span><span>ns</span><span> </span><span>grumpybank.observability.kc</span><span>\n</span><span>(</span><span>:require</span><span>\n</span><span>[</span><span>aleph.http</span><span> </span><span>:as</span><span> </span><span>http</span><span>]</span><span>\n</span><span>[</span><span>manifold.deferred</span><span> </span><span>:as</span><span> </span><span>d</span><span>]</span><span>\n</span><span>[</span><span>clojure.data.json</span><span> </span><span>:as</span><span> </span><span>json</span><span>]</span><span>\n</span><span>[</span><span>byte-streams</span><span> </span><span>:as</span><span> </span><span>bs</span><span>]))</span><span>\n</span><span>(</span><span>defn</span><span> </span><span>connectors</span><span>\n</span><span>[</span><span>connect-url</span><span>]</span><span>\n</span><span>(</span><span>d/chain</span><span> </span><span>(</span><span>http/get</span><span> </span><span>(</span><span>format</span><span> </span><span>&quot;%s/connectors&quot;</span><span> </span><span>connect-url</span><span>))</span><span>\n</span><span>#</span><span>(</span><span>update</span><span> </span><span>%</span><span> </span><span>:body</span><span> </span><span>bs/to-string</span><span>)</span><span>\n</span><span>#</span><span>(</span><span>update</span><span> </span><span>%</span><span> </span><span>:body</span><span> </span><span>json/read-str</span><span>)</span><span>\n</span><span>#</span><span>(</span><span>:body</span><span> </span><span>%</span><span>)))</span></code></pre></figure>\n<h2>GET /connectors/:connector-id/status</h2>\n<p>Here’s the function that hits the <code>/connectors/:connector-id/status</code>\nendpoint. Again, we invoke the API endpoint and setup a chain to deal\nwith the response by first converting the raw bytes to a string, and\nthen reading the JSON string into a Clojure map. Just the same as\nbefore.</p>\n<figure><pre><code><span>(</span><span>defn</span><span> </span><span>connector-status</span><span>\n</span><span>[</span><span>connect-url</span><span> </span><span>connector</span><span>]</span><span>\n</span><span>(</span><span>d/chain</span><span> </span><span>(</span><span>http/get</span><span> </span><span>(</span><span>format</span><span> </span><span>&quot;%s/connectors/%s/status&quot;</span><span>\n</span><span>connect-url</span><span>\n</span><span>connector</span><span>))</span><span>\n</span><span>#</span><span>(</span><span>update</span><span> </span><span>%</span><span> </span><span>:body</span><span> </span><span>bs/to-string</span><span>)</span><span>\n</span><span>#</span><span>(</span><span>update</span><span> </span><span>%</span><span> </span><span>:body</span><span> </span><span>json/read-str</span><span>)</span><span>\n</span><span>#</span><span>(</span><span>:body</span><span> </span><span>%</span><span>)))</span></code></pre></figure>\n<h2>Generating a report</h2>\n<p>Depending on how big your Kafka Connect installation becomes and how\nyou deploy connectors you might easily end up with 100s of connectors\nreturned by the request above. Submitting a request to the status\nendpoint for each one in serial would take quite a while. On the\nother-hand, the server on the other side is capable of handling many\nrequests in parallel. This is especially true if there are a few Kafka\nConnect nodes co-operating behind a load-balancer.</p>\n<p>This is why it is advantageous to use aleph here for the HTTP requests\ninstead of the more commonly used clj-http. Once we have our list of\nconnectors, we can fire off simultaneous requests for the status of\neach connector, and collect the results asynchronously.</p>\n<figure><pre><code><span>(</span><span>defn</span><span> </span><span>connector-report</span><span>\n</span><span>[</span><span>connect-url</span><span>]</span><span>\n</span><span>(</span><span>let</span><span> </span><span>[</span><span>task-failed?</span><span> </span><span>#</span><span>(</span><span>=</span><span> </span><span>&quot;FAILED&quot;</span><span> </span><span>(</span><span>get</span><span> </span><span>%</span><span> </span><span>&quot;state&quot;</span><span>))</span><span>\n</span><span>task-running?</span><span> </span><span>#</span><span>(</span><span>=</span><span> </span><span>&quot;RUNNING&quot;</span><span> </span><span>(</span><span>get</span><span> </span><span>%</span><span> </span><span>&quot;state&quot;</span><span>))</span><span>\n</span><span>task-paused?</span><span> </span><span>#</span><span>(</span><span>=</span><span> </span><span>&quot;PAUSED&quot;</span><span> </span><span>(</span><span>get</span><span> </span><span>%</span><span> </span><span>&quot;state&quot;</span><span>))]</span><span>\n</span><span>(</span><span>d/chain</span><span> </span><span>(</span><span>connectors</span><span> </span><span>connect-url</span><span>)</span><span>\n</span><span>#</span><span>(</span><span>apply</span><span> </span><span>d/zip</span><span> </span><span>(</span><span>map</span><span> </span><span>(</span><span>partial</span><span> </span><span>connector-status</span><span> </span><span>connect-url</span><span>)</span><span> </span><span>%</span><span>))</span><span>\n</span><span>#</span><span>(</span><span>map</span><span> </span><span>(</span><span>fn</span><span> </span><span>[</span><span>s</span><span>]</span><span>\n</span><span>{</span><span>:connector</span><span> </span><span>(</span><span>get</span><span> </span><span>s</span><span> </span><span>&quot;name&quot;</span><span>)</span><span>\n</span><span>:failed?</span><span> </span><span>(</span><span>failed?</span><span> </span><span>s</span><span>)</span><span>\n</span><span>:total-tasks</span><span> </span><span>(</span><span>count</span><span> </span><span>(</span><span>get</span><span> </span><span>s</span><span> </span><span>&quot;tasks&quot;</span><span>))</span><span>\n</span><span>:failed-tasks</span><span> </span><span>(</span><span>->></span><span> </span><span>(</span><span>get</span><span> </span><span>s</span><span> </span><span>&quot;tasks&quot;</span><span>)</span><span>\n</span><span>(</span><span>filter</span><span> </span><span>task-failed?</span><span>)</span><span>\n</span><span>count</span><span>)</span><span>\n</span><span>:running-tasks</span><span> </span><span>(</span><span>->></span><span> </span><span>(</span><span>get</span><span> </span><span>s</span><span> </span><span>&quot;tasks&quot;</span><span>)</span><span>\n</span><span>(</span><span>filter</span><span> </span><span>task-running?</span><span>)</span><span>\n</span><span>count</span><span>)</span><span>\n</span><span>:paused-tasks</span><span> </span><span>(</span><span>->></span><span> </span><span>(</span><span>get</span><span> </span><span>s</span><span> </span><span>&quot;tasks&quot;</span><span>)</span><span>\n</span><span>(</span><span>filter</span><span> </span><span>task-paused?</span><span>)</span><span>\n</span><span>count</span><span>)</span><span>\n</span><span>:trace</span><span> </span><span>(</span><span>when</span><span> </span><span>(</span><span>failed?</span><span> </span><span>s</span><span>)</span><span>\n</span><span>(</span><span>traces</span><span> </span><span>s</span><span>))})</span><span> </span><span>%</span><span>))))</span></code></pre></figure>\n<p>Here we first define a few helper predicates (<code>task-failed?</code>,\n<code>task-running?</code>, and <code>task-paused?</code>) for classifying the status\neventually returned by <code>connector-status</code>. Then we kick off the\nasynchronous pipeline by requesting a list of connectors using\n<code>connectors</code>.</p>\n<p>The first operation on the chain is to apply the result to <code>d/zip</code>\nwhich as described above will invoke the status API calls concurrently\nand return a vector with all the responses once they are all complete.</p>\n<p>Then we simply map the results over an anonymous function which builds\na map out of with the connector id together with whether it has\nfailed, how many of its tasks are in each state, and when the connector\n<em>has</em> failed, the stacktrace provided by the status endpoint.</p>\n<p>If you have a huge number of connect jobs you might need to split the\ninitial list into smaller batches and submit each batch in\nparallel. This can easily be done using Clojure’s built-in <code>partition</code>\nfunction but I didn’t find this to be necessary on our fairly large\ncollection of kafka connect jobs.</p>\n<p>Wrap these functions up in a simple command line script and run it\nafter making any changes to your kafka-connect configuration to make\nsure everything is still hunky-dory.</p>\n<p>Here’s a <a href=\"https://gist.github.com/cddr/da5215ed83653872bee3febdbb435e65\">gist</a>\nthat wraps these functions up into a quick and dirty script that reports the\nresults to STDOUT. Feel free to re-use, refactor, and integrate with\nyour own script to make sure after making changes to your deployed Kafka\nConnect configuration, everything remains hunky-dory.</p>",
   :direction "ltr"},
  :updated 1573862400000,
  :entities
  [{:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "API"}],
    :id "nlp/f/entity/wd:165194",
    :salienceLevel "mention",
    :label "application programming interface"}
   {:mentions [{:text "metrics"}],
    :id "nlp/f/entity/wd:192624",
    :salienceLevel "mention",
    :label "metre"}
   {:mentions [{:text "JSON"}],
    :id "nlp/f/entity/wd:2063",
    :salienceLevel "mention",
    :label "JavaScript Object Notation"}
   {:mentions [{:text "JMX"}],
    :id "nlp/f/entity/wd:941133",
    :salienceLevel "mention",
    :label "Java Management Extensions"}],
  :alternate
  [{:href "https://grumpyhacker.com/kafka-connect-status-report/",
    :type "text/html"}],
  :title "Reporting on Kafka Connect Jobs",
  :author "Andy Chambers",
  :published-str "Fri Nov 15 16:00:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16e758257ba:392210a:97b0c8f7",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://grumpyhacker.com/kafka-connect-status-report",
  :updateCount 1,
  :commonTopics
  [{:score 31.11636312130113,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1573862400000,
  :fingerprint "47961948",
  :canonicalUrl
  "https://grumpyhacker.com/kafka-connect-status-report/"}
 {:engagement 8,
  :unread false,
  :crawled 1573870465365,
  :content
  {:content
   "<p>Each week, we discuss a different topic about Clojure and functional programming.</p>\n<p>If you have a question or topic you’d like us to discuss, tweet <a href=\"https://twitter.com/clojuredesign\">@clojuredesign</a>, send an email to <a href=\"mailto:feedback@clojuredesign.club\">feedback@clojuredesign.club</a>, or join the <code>#clojuredesign-podcast</code> channel on the <a href=\"http://clojurians.net/\">Clojurians Slack</a>.</p>\n<p>This week, the topic is: <strong>“Sets! What are they good for?”</strong> We examine one of the lesser used data structures in Clojure and talk about its unique characteristics and uses.</p>\n<p>Selected quotes:</p>\n<ul>\n<li>“Sets aren’t going to get top billing.”</li>\n<li>“Sets are really about uniqueness.”</li>\n<li>“Sets let us calculate differences cheaply.”</li>\n<li>“Clever is a word I used to like when I was a younger programmer.”</li>\n<li>“Clever now equals hours of suffering!”</li>\n</ul>",
   :direction "ltr"},
  :updated 1573830000000,
  :entities
  [{:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "about",
    :label "Clojure"}
   {:mentions [{:text "functional programming"}],
    :id "nlp/f/entity/wd:193076",
    :salienceLevel "mention",
    :label "functional programming"}
   {:mentions [{:text "uniqueness"}],
    :id "nlp/f/entity/wd:2502253",
    :salienceLevel "mention",
    :label "uniqueness quantification"}],
  :alternate
  [{:href
    "https://clojuredesign.club/episode/055-sets-what-are-they-good-for/",
    :type "text/html"}],
  :title "Ep 055: Sets! What Are They Good For?",
  :author "Christoph Neumann and Nate Jones",
  :published-str "Fri Nov 15 07:00:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16e71fd7155:351853a:69b9f616",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://clojuredesign.club/episode/055-sets-what-are-they-good-for/",
  :commonTopics
  [{:score 55.841158332857724,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.836,
    :id "nlp/f/topic/861",
    :salienceLevel "mention",
    :label "finance"}
   {:score 0.75,
    :id "nlp/f/topic/1695",
    :salienceLevel "mention",
    :label "parenting"}],
  :published 1573830000000,
  :fingerprint "6ff38a92",
  :canonicalUrl
  "https://clojuredesign.club/episode/055-sets-what-are-they-good-for/"}
 {:engagement 38,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1573756065037,
  :recrawled 1573829216627,
  :content
  {:content
   "<p>There is a lot of hype around functional programming(FP) and a lot of cool kids are doing it but it is not a silver bullet. Like other programming paradigms/styles, functional programming also has its pros and cons and one may prefer one paradigm over the other. If you are a Rust developer and wants to venture into functional programming, do not worry, you don't have to learn functional programming oriented languages like Haskell or Clojure(or even Scala or JavaScript though they are not pure functional programming languages) since Rust has you covered and this post is for you.</p>\n<p>If you are looking for functional programming in Java, Golang or TypeScript check other posts in the series.</p>\n<p>I'm not gonna dive into all functional programming concepts in detail, instead, I'm gonna focus on things that you can do in Rust which are in line with functional programming concepts. I'm also not gonna discuss the pros and cons of functional programming in general.</p>\n<p>Please note that some introductions in this post are repeated from my other posts in the series for your ease of reading.</p>\n<h2>\n<a href=\"https://dev.to/feed#what-is-functional-programming\">\n</a>\nWhat is functional programming?\n</h2>\n<p>As per Wikipedia,</p>\n<blockquote>\n<p>Functional programming is a programming paradigm—a style of building the structure and elements of computer programs—that treats computation as the evaluation of mathematical functions and avoids changing-state and mutable data.</p>\n</blockquote>\n<p>Hence in functional programming, there are two very important rules</p>\n<ul>\n<li> <strong>No Data mutations</strong>: It means a data object should not be changed after it is created.</li>\n<li> <strong>No implicit state</strong>: Hidden/Implicit state should be avoided. In functional programming state is not eliminated, instead, its made visible and explicit</li>\n</ul>\n<p>This means:</p>\n<ul>\n<li> <strong>No side effects</strong>: A function or operation should not change any state outside of its functional scope. I.e, A function should only return a value to the invoker and should not affect any external state. This means programs are easier to understand.</li>\n<li> <strong>Pure functions only</strong>: Functional code is idempotent. A function should return values only based on the arguments passed and should not affect(side-effect) or depend on the global state. Such functions always produce the same result for the same arguments.</li>\n</ul>\n<p>Apart from these there are functional programming concepts below that can be applied in Rust, we will touch upon these further down.</p>\n<ul>\n<li> <a href=\"https://en.wikipedia.org/wiki/Higher-order_function\">Higher-order-functions</a>\n</li>\n<li> <a href=\"https://en.wikipedia.org/wiki/Closure_(computer_programming)\">Closures</a>\n</li>\n<li> <a href=\"https://en.wikipedia.org/wiki/Currying\">Currying</a>\n</li>\n<li> <a href=\"https://en.wikipedia.org/wiki/Recursion_(computer_science)\">Recursion</a>\n</li>\n<li> <a href=\"https://en.wikipedia.org/wiki/Evaluation_strategy\">Lazy evaluations</a>\n</li>\n<li> <a href=\"https://en.wikipedia.org/wiki/Referential_transparency\">Referential transparency</a>\n</li>\n</ul>\n<p>Using functional programming doesn't mean its all or nothing, you can always use functional programming concepts to complement Object-oriented or imperative concepts in Rust. The benefits of functional programming can be utilized whenever possible regardless of the paradigm or language you use. And that is exactly what we are going to see.</p>\n<h2>\n<a href=\"https://dev.to/feed#functional-programming-in-rust\">\n</a>\nFunctional programming in Rust\n</h2>\n<p>Rust is primarily geared towards procedural/imperative style of programming but it also lets you do a little bit of functional and object-oriented style of programming as well. And that is my favorite kind of mix. So let us see how we can apply some of the functional programming concepts above in Rust using the language features.</p>\n<h3>\n<a href=\"https://dev.to/feed#firstclass-and-higherorder-functions\">\n</a>\nFirst-class and higher-order functions\n</h3>\n<p>First-class functions(function as a first-class citizen) means you can assign functions to variables, pass a function as an argument to another function or return a function from another. Functions in Rust are a bit more complex than other languages, it's not as straightforward as in Go or JavaScript. There are different kinds of functions and two different ways of writing them. The first one is a function that cannot memoize its outer context and the second one is closures which can memoize its outer context. Hence concepts like currying and higher-order-functions are possible in Rust but may not be as easy to wrap your head around as in other languages. Also, functions that accept a closure can also accept a pointer to a function depending on the context. In many places, Rust functions and closures can be interchangeable. It would have been nicer if functions were simple and we could do all the below without having to rely on closures. But Rust chose these compromises for better memory safety and performance.</p>\n<p>A function can be considered as a higher-order-function only if it takes one or more functions as parameters or if it returns another function as a result.<br>\nIn Rust, this is quite easy to do with closures, it might look a bit verbose but if you are familiar with Rust then you should be fine.<br>\n</p>\n<div><pre><code><span>fn</span> <span>main</span><span>()</span> <span>{</span>\n    <span>let</span> <span>list</span> <span>=</span> <span>vec!</span><span>[</span>\n        <span>String</span><span>::</span><span>from</span><span>(</span><span>&quot;Orange&quot;</span><span>),</span>\n        <span>String</span><span>::</span><span>from</span><span>(</span><span>&quot;Apple&quot;</span><span>),</span>\n        <span>String</span><span>::</span><span>from</span><span>(</span><span>&quot;Banana&quot;</span><span>),</span>\n        <span>String</span><span>::</span><span>from</span><span>(</span><span>&quot;Grape&quot;</span><span>),</span>\n    <span>];</span>\n    <span>// we are passing the array and a closure as arguments to map_for_each method.</span>\n    <span>let</span> <span>out</span> <span>=</span> <span>map_for_each</span><span>(</span><span>list</span><span>,</span> <span>|</span><span>it</span><span>:</span> <span>&amp;</span><span>String</span><span>|</span> <span>-></span> <span>usize</span> <span>{</span>\n        <span>return</span> <span>it</span><span>.len</span><span>();</span>\n    <span>});</span>\n\n    <span>println!</span><span>(</span><span>&quot;{:?}&quot;</span><span>,</span> <span>out</span><span>);</span> <span>// [6, 5, 6, 5]</span>\n<span>}</span>\n\n<span>// The higher-order-function takes an array and a closure as arguments</span>\n<span>fn</span> <span>map_for_each</span><span>(</span><span>list</span><span>:</span> <span>Vec</span><span>&lt;</span><span>String</span><span>></span><span>,</span> <span>fun</span><span>:</span> <span>fn</span><span>(</span><span>&amp;</span><span>String</span><span>)</span> <span>-></span> <span>usize</span><span>)</span> <span>-></span> <span>Vec</span><span>&lt;</span><span>usize</span><span>></span> <span>{</span>\n    <span>let</span> <span>mut</span> <span>new_array</span><span>:</span> <span>Vec</span><span>&lt;</span><span>usize</span><span>></span> <span>=</span> <span>Vec</span><span>::</span><span>new</span><span>();</span>\n    <span>for</span> <span>it</span> <span>in</span> <span>list</span><span>.iter</span><span>()</span> <span>{</span>\n        <span>// We are executing the closure passed</span>\n        <span>new_array</span><span>.push</span><span>(</span><span>fun</span><span>(</span><span>it</span><span>));</span>\n    <span>}</span>\n    <span>return</span> <span>new_array</span><span>;</span>\n<span>}</span>\n</code></pre></div>\n<p>There are also more complex versions that you can write with generics like below for an example<br>\n</p>\n<div><pre><code><span>fn</span> <span>main</span><span>()</span> <span>{</span>\n    <span>let</span> <span>list</span> <span>=</span> <span>vec!</span><span>[</span><span>2</span><span>,</span> <span>5</span><span>,</span> <span>8</span><span>,</span> <span>10</span><span>];</span>\n    <span>// we are passing the array and a closure as arguments to map_for_each method.</span>\n    <span>let</span> <span>out</span> <span>=</span> <span>map_for_each</span><span>(</span><span>list</span><span>,</span> <span>|</span><span>it</span><span>:</span> <span>&amp;</span><span>usize</span><span>|</span> <span>-></span> <span>usize</span> <span>{</span>\n        <span>return</span> <span>it</span> <span>*</span> <span>it</span><span>;</span>\n    <span>});</span>\n\n    <span>println!</span><span>(</span><span>&quot;{:?}&quot;</span><span>,</span> <span>out</span><span>);</span> <span>// [4, 25, 64, 100]</span>\n<span>}</span>\n\n<span>// The higher-order-function takes an array and a closure as arguments, but uses generic types</span>\n<span>fn</span> <span>map_for_each</span><span>&lt;</span><span>A</span><span>,</span> <span>B</span><span>></span><span>(</span><span>list</span><span>:</span> <span>Vec</span><span>&lt;</span><span>A</span><span>></span><span>,</span> <span>fun</span><span>:</span> <span>fn</span><span>(</span><span>&amp;</span><span>A</span><span>)</span> <span>-></span> <span>B</span><span>)</span> <span>-></span> <span>Vec</span><span>&lt;</span><span>B</span><span>></span> <span>{</span>\n    <span>let</span> <span>mut</span> <span>new_array</span><span>:</span> <span>Vec</span><span>&lt;</span><span>B</span><span>></span> <span>=</span> <span>Vec</span><span>::</span><span>new</span><span>();</span>\n    <span>for</span> <span>it</span> <span>in</span> <span>list</span><span>.iter</span><span>()</span> <span>{</span>\n        <span>// We are executing the closure passed</span>\n        <span>new_array</span><span>.push</span><span>(</span><span>fun</span><span>(</span><span>it</span><span>));</span>\n    <span>}</span>\n    <span>return</span> <span>new_array</span><span>;</span>\n<span>}</span>\n</code></pre></div>\n<p>But then we could also simply do it this way using built-in functional methods like map, fold(reduce) and so on which is much less verbose. Rust provides a lot of useful functional style methods for working on collections like <code>map</code>, <code>fold</code>, <code>for_each</code>, <code>filter</code> and so on.<br>\n</p>\n<div><pre><code><span>fn</span> <span>main</span><span>()</span> <span>{</span>\n    <span>let</span> <span>list</span> <span>=</span> <span>[</span><span>&quot;Orange&quot;</span><span>,</span> <span>&quot;Apple&quot;</span><span>,</span> <span>&quot;Banana&quot;</span><span>,</span> <span>&quot;Grape&quot;</span><span>];</span>\n\n    <span>// we are passing a closure as arguments to the built-in map method.</span>\n    <span>let</span> <span>out</span><span>:</span> <span>Vec</span><span>&lt;</span><span>usize</span><span>></span> <span>=</span> <span>list</span><span>.iter</span><span>()</span><span>.map</span><span>(|</span><span>x</span><span>|</span> <span>x</span><span>.len</span><span>())</span><span>.collect</span><span>();</span>\n\n    <span>println!</span><span>(</span><span>&quot;{:?}&quot;</span><span>,</span> <span>out</span><span>);</span> <span>// [6, 5, 6, 5]</span>\n<span>}</span>\n</code></pre></div>\n<p>Closures in Rust can memorize and mutate its outer context but due to the concept of ownership in Rust, you cannot have multiple closures mutating the same variables in the outer context. Currying is also possible in Rust but again due to ownership and lifetime concepts, it might feel a bit more verbose.<br>\n</p>\n<div><pre><code><span>fn</span> <span>main</span><span>()</span> <span>{</span>\n    <span>// this is a higher-order-function that returns a closure</span>\n    <span>fn</span> <span>add</span><span>(</span><span>x</span><span>:</span> <span>usize</span><span>)</span> <span>-></span> <span>impl</span> <span>Fn</span><span>(</span><span>usize</span><span>)</span> <span>-></span> <span>usize</span> <span>{</span>\n        <span>// A closure is returned here</span>\n        <span>// variable x is obtained from the outer scope of this method and memorized in the closure by moving ownership</span>\n        <span>return</span> <span>move</span> <span>|</span><span>y</span><span>|</span> <span>-></span> <span>usize</span> <span>{</span> <span>x</span> <span>+</span> <span>y</span> <span>};</span>\n    <span>};</span>\n\n    <span>// we are currying the add method to create more variations</span>\n    <span>let</span> <span>add10</span> <span>=</span> <span>add</span><span>(</span><span>10</span><span>);</span>\n    <span>let</span> <span>add20</span> <span>=</span> <span>add</span><span>(</span><span>20</span><span>);</span>\n    <span>let</span> <span>add30</span> <span>=</span> <span>add</span><span>(</span><span>30</span><span>);</span>\n\n    <span>println!</span><span>(</span><span>&quot;{}&quot;</span><span>,</span> <span>add10</span><span>(</span><span>5</span><span>));</span> <span>// 15</span>\n    <span>println!</span><span>(</span><span>&quot;{}&quot;</span><span>,</span> <span>add20</span><span>(</span><span>5</span><span>));</span> <span>// 25</span>\n    <span>println!</span><span>(</span><span>&quot;{}&quot;</span><span>,</span> <span>add30</span><span>(</span><span>5</span><span>));</span> <span>// 35</span>\n<span>}</span>\n</code></pre></div>\n<h3>\n<a href=\"https://dev.to/feed#pure-functions\">\n</a>\nPure functions\n</h3>\n<p>As we saw already a pure function should return values only based on the arguments passed and should not affect or depend on the global state. It is possible to do this in Rust easily.</p>\n<p>Take the below, this is a pure function. It will always return the same output for the given input and its behavior is highly predictable. We can safely cache the method if needed.<br>\n</p>\n<div><pre><code><span>fn</span> <span>sum</span><span>(</span><span>a</span><span>:</span> <span>usize</span><span>,</span> <span>b</span><span>:</span> <span>usize</span><span>)</span> <span>-></span> <span>usize</span> <span>{</span>\n    <span>return</span> <span>a</span> <span>+</span> <span>b</span><span>;</span>\n<span>}</span>\n</code></pre></div>\n<p>But since Rust variables are immutable by default, unless specified a function cannot mutate any variables passed to it and cannot capture any variable in its context. So if we try to affect external state like below the compiler will complain &quot;can't capture dynamic environment in a fn item&quot;<br>\n</p>\n<div><pre><code><span>use</span> <span>std</span><span>::</span><span>collections</span><span>::</span><span>HashMap</span><span>;</span>\n\n<span>fn</span> <span>main</span><span>()</span> <span>{</span>\n    <span>let</span> <span>mut</span> <span>holder</span> <span>=</span> <span>HashMap</span><span>::</span><span>new</span><span>();</span>\n\n    <span>fn</span> <span>sum</span><span>(</span><span>a</span><span>:</span> <span>usize</span><span>,</span> <span>b</span><span>:</span> <span>usize</span><span>)</span> <span>-></span> <span>usize</span> <span>{</span>\n        <span>let</span> <span>c</span> <span>=</span> <span>a</span> <span>+</span> <span>b</span><span>;</span>\n        <span>holder</span><span>.insert</span><span>(</span><span>String</span><span>::</span><span>from</span><span>(</span><span>format!</span><span>(</span><span>&quot;${a}+${b}&quot;</span><span>,</span> <span>a</span> <span>=</span> <span>a</span><span>,</span> <span>b</span> <span>=</span> <span>b</span><span>)),</span> <span>c</span><span>);</span>\n        <span>return</span> <span>c</span><span>;</span>\n    <span>}</span>\n<span>}</span>\n</code></pre></div>\n<p>In Rust, in order to capture external state, we would have to use closures, so we can rewrite the above as<br>\n</p>\n<div><pre><code><span>use</span> <span>std</span><span>::</span><span>collections</span><span>::</span><span>HashMap</span><span>;</span>\n\n<span>fn</span> <span>main</span><span>()</span> <span>{</span>\n    <span>let</span> <span>mut</span> <span>holder</span> <span>=</span> <span>HashMap</span><span>::</span><span>new</span><span>();</span>\n\n    <span>let</span> <span>sum</span> <span>=</span> <span>|</span><span>a</span><span>:</span> <span>usize</span><span>,</span> <span>b</span><span>:</span> <span>usize</span><span>|</span> <span>-></span> <span>usize</span> <span>{</span>\n        <span>let</span> <span>c</span> <span>=</span> <span>a</span> <span>+</span> <span>b</span><span>;</span>\n        <span>holder</span><span>.insert</span><span>(</span><span>String</span><span>::</span><span>from</span><span>(</span><span>format!</span><span>(</span><span>&quot;${a}+${b}&quot;</span><span>,</span> <span>a</span> <span>=</span> <span>a</span><span>,</span> <span>b</span> <span>=</span> <span>b</span><span>)),</span> <span>c</span><span>);</span>\n        <span>return</span> <span>c</span><span>;</span>\n    <span>};</span>\n\n    <span>println!</span><span>(</span><span>&quot;{}&quot;</span><span>,</span> <span>sum</span><span>(</span><span>10</span><span>,</span> <span>20</span><span>));</span>\n<span>}</span>\n</code></pre></div>\n<p>But the compilation will still fail with the message &quot;cannot borrow <code>sum</code> as mutable, as it is not declared as mutable&quot;. So in order to do external state mutation, we would have to explicitly specify the function as mutable like <code>let mut sum = ...</code></p>\n<p>So Rust will help you keep your functions pure and simple by default. Of course, that doesn't mean you can avoid side effects that don't involve variable mutations, for those you have to take care of it yourself.</p>\n<h3>\n<a href=\"https://dev.to/feed#recursion\">\n</a>\nRecursion\n</h3>\n<p>Functional programming favors recursion over looping. Let us see an example for calculating the factorial of a number.</p>\n<p>In traditional iterative approach:<br>\n</p>\n<div><pre><code><span>fn</span> <span>main</span><span>()</span> <span>{</span>\n    <span>fn</span> <span>factorial</span><span>(</span><span>mut</span> <span>num</span><span>:</span> <span>usize</span><span>)</span> <span>-></span> <span>usize</span> <span>{</span>\n        <span>let</span> <span>mut</span> <span>result</span> <span>=</span> <span>1</span><span>;</span>\n        <span>while</span> <span>num</span> <span>></span> <span>0</span> <span>{</span>\n            <span>result</span> <span>*=</span> <span>num</span><span>;</span>\n            <span>num</span> <span>=</span> <span>num</span> <span>-</span> <span>1</span><span>;</span>\n        <span>}</span>\n        <span>return</span> <span>result</span><span>;</span>\n    <span>}</span>\n\n    <span>println!</span><span>(</span><span>&quot;{}&quot;</span><span>,</span> <span>factorial</span><span>(</span><span>20</span><span>));</span> <span>// 2432902008176640000</span>\n<span>}</span>\n</code></pre></div>\n<p>The same can be done using recursion as below which is favored in functional programming -- But recursion is not the solution always, for some cases a simple loop is more readable.<br>\n</p>\n<div><pre><code><span>fn</span> <span>main</span><span>()</span> <span>{</span>\n    <span>fn</span> <span>factorial</span><span>(</span><span>num</span><span>:</span> <span>usize</span><span>)</span> <span>-></span> <span>usize</span> <span>{</span>\n        <span>return</span> <span>match</span> <span>num</span> <span>{</span>\n            <span>0</span> <span>=></span> <span>1</span><span>,</span>\n            <span>_</span> <span>=></span> <span>num</span> <span>*</span> <span>factorial</span><span>(</span><span>num</span> <span>-</span> <span>1</span><span>),</span>\n        <span>};</span>\n    <span>}</span>\n\n    <span>println!</span><span>(</span><span>&quot;{}&quot;</span><span>,</span> <span>factorial</span><span>(</span><span>20</span><span>));</span> <span>// 2432902008176640000</span>\n<span>}</span>\n</code></pre></div>\n<p>The downside of the recursive approach is that it will be slower compared to an iterative approach most of the times(The advantage we are aiming for is code simplicity and readability) and might result in stack overflow errors since every function call needs to be saved as a frame to the stack. To avoid this tail recursion is preferred, especially when the recursion is done too many times. In tail recursion, the recursive call is the last thing executed by the function and hence the functions stack frame need not be saved by the compiler. Most compilers can optimize the tail recursion code the same way iterative code is optimized hence avoiding the performance penalty. But unfortunately, Rust does not support this yet.</p>\n<p>Consider using recursion when writing Rust code for readability and immutability, but if performance is critical or if the number of iterations will be huge use the standard iterative approach.</p>\n<h3>\n<a href=\"https://dev.to/feed#lazy-evaluation\">\n</a>\nLazy evaluation\n</h3>\n<p>Lazy evaluation or non-strict evaluation is the process of delaying the evaluation of an expression until it is needed. In general, Rust does strict/eager evaluation. We can utilize higher-order-functions, closures, and <a href=\"https://en.wikipedia.org/wiki/Memoization\">memoization</a> techniques to do lazy evaluations.</p>\n<p>Take this example where Rust eagerly evaluates everything.<br>\n</p>\n<div><pre><code><span>fn</span> <span>main</span><span>()</span> <span>{</span>\n    <span>fn</span> <span>add</span><span>(</span><span>x</span><span>:</span> <span>usize</span><span>)</span> <span>-></span> <span>usize</span> <span>{</span>\n        <span>println!</span><span>(</span><span>&quot;executing add&quot;</span><span>);</span> <span>// this is printed since the functions are evaluated first</span>\n        <span>return</span> <span>x</span> <span>+</span> <span>x</span><span>;</span>\n    <span>}</span>\n\n    <span>fn</span> <span>multiply</span><span>(</span><span>x</span><span>:</span> <span>usize</span><span>)</span> <span>-></span> <span>usize</span> <span>{</span>\n        <span>println!</span><span>(</span><span>&quot;executing multiply&quot;</span><span>);</span> <span>// this is printed since the functions are evaluated first</span>\n        <span>return</span> <span>x</span> <span>*</span> <span>x</span><span>;</span>\n    <span>}</span>\n\n    <span>fn</span> <span>add_or_multiply</span><span>(</span><span>add</span><span>:</span> <span>bool</span><span>,</span> <span>on_add</span><span>:</span> <span>usize</span><span>,</span> <span>on_multiply</span><span>:</span> <span>usize</span><span>)</span> <span>-></span> <span>usize</span> <span>{</span>\n        <span>if</span> <span>add</span> <span>{</span>\n            <span>on_add</span>\n        <span>}</span> <span>else</span> <span>{</span>\n            <span>on_multiply</span>\n        <span>}</span>\n    <span>}</span>\n    <span>println!</span><span>(</span><span>&quot;{}&quot;</span><span>,</span> <span>add_or_multiply</span><span>(</span><span>true</span><span>,</span> <span>add</span><span>(</span><span>4</span><span>),</span> <span>multiply</span><span>(</span><span>4</span><span>)));</span> <span>// 8</span>\n    <span>println!</span><span>(</span><span>&quot;{}&quot;</span><span>,</span> <span>add_or_multiply</span><span>(</span><span>false</span><span>,</span> <span>add</span><span>(</span><span>4</span><span>),</span> <span>multiply</span><span>(</span><span>4</span><span>)));</span> <span>// 16</span>\n<span>}</span>\n</code></pre></div>\n<p>This will produce the below output and we can see that both functions are executed always<br>\n</p>\n<div><pre><code>executing add\nexecuting multiply\n8\nexecuting add\nexecuting multiply\n16\n</code></pre></div>\n<p>We can use higher-order-functions to rewrite this into a lazily evaluated version<br>\n</p>\n<div><pre><code><span>fn</span> <span>main</span><span>()</span> <span>{</span>\n    <span>fn</span> <span>add</span><span>(</span><span>x</span><span>:</span> <span>usize</span><span>)</span> <span>-></span> <span>usize</span> <span>{</span>\n        <span>println!</span><span>(</span><span>&quot;executing add&quot;</span><span>);</span> <span>// this is printed since the functions are evaluated first</span>\n        <span>return</span> <span>x</span> <span>+</span> <span>x</span><span>;</span>\n    <span>}</span>\n\n    <span>fn</span> <span>multiply</span><span>(</span><span>x</span><span>:</span> <span>usize</span><span>)</span> <span>-></span> <span>usize</span> <span>{</span>\n        <span>println!</span><span>(</span><span>&quot;executing multiply&quot;</span><span>);</span> <span>// this is printed since the functions are evaluated first</span>\n        <span>return</span> <span>x</span> <span>*</span> <span>x</span><span>;</span>\n    <span>}</span>\n\n    <span>type</span> <span>FnType</span> <span>=</span> <span>fn</span><span>(</span><span>t</span><span>:</span> <span>usize</span><span>)</span> <span>-></span> <span>usize</span><span>;</span>\n\n    <span>// This is now a higher-order-function hence evaluation of the functions are delayed in if-else</span>\n    <span>fn</span> <span>add_or_multiply</span><span>(</span><span>add</span><span>:</span> <span>bool</span><span>,</span> <span>on_add</span><span>:</span> <span>FnType</span><span>,</span> <span>on_multiply</span><span>:</span> <span>FnType</span><span>,</span> <span>t</span><span>:</span> <span>usize</span><span>)</span> <span>-></span> <span>usize</span> <span>{</span>\n        <span>if</span> <span>add</span> <span>{</span>\n            <span>on_add</span><span>(</span><span>t</span><span>)</span>\n        <span>}</span> <span>else</span> <span>{</span>\n            <span>on_multiply</span><span>(</span><span>t</span><span>)</span>\n        <span>}</span>\n    <span>}</span>\n    <span>println!</span><span>(</span><span>&quot;{}&quot;</span><span>,</span> <span>add_or_multiply</span><span>(</span><span>true</span><span>,</span> <span>add</span><span>,</span> <span>multiply</span><span>,</span> <span>4</span><span>));</span> <span>// 8</span>\n    <span>println!</span><span>(</span><span>&quot;{}&quot;</span><span>,</span> <span>add_or_multiply</span><span>(</span><span>false</span><span>,</span> <span>add</span><span>,</span> <span>multiply</span><span>,</span> <span>4</span><span>));</span> <span>// 16</span>\n<span>}</span>\n</code></pre></div>\n<p>This outputs the below and we can see that only required functions were executed<br>\n</p>\n<div><pre><code>executing add\n8\nexecuting multiply\n16\n</code></pre></div>\n<p>You can also use memoization/caching techniques to avoid unwanted evaluations in pure and referentially transparent functions like below<br>\n</p>\n<div><pre><code><span>use</span> <span>std</span><span>::</span><span>collections</span><span>::</span><span>HashMap</span><span>;</span>\n\n<span>fn</span> <span>main</span><span>()</span> <span>{</span>\n    <span>let</span> <span>mut</span> <span>cached_added</span> <span>=</span> <span>HashMap</span><span>::</span><span>new</span><span>();</span>\n\n    <span>let</span> <span>mut</span> <span>add</span> <span>=</span> <span>|</span><span>x</span><span>:</span> <span>usize</span><span>|</span> <span>-></span> <span>usize</span> <span>{</span>\n        <span>return</span> <span>match</span> <span>cached_added</span><span>.get</span><span>(</span><span>&amp;</span><span>x</span><span>)</span> <span>{</span>\n            <span>Some</span><span>(</span><span>&amp;</span><span>val</span><span>)</span> <span>=></span> <span>val</span><span>,</span>\n            <span>_</span> <span>=></span> <span>{</span>\n                <span>println!</span><span>(</span><span>&quot;{}&quot;</span><span>,</span> <span>&quot;executing add&quot;</span><span>);</span>\n                <span>let</span> <span>out</span> <span>=</span> <span>x</span> <span>+</span> <span>x</span><span>;</span>\n                <span>cached_added</span><span>.insert</span><span>(</span><span>x</span><span>,</span> <span>out</span><span>);</span>\n                <span>out</span>\n            <span>}</span>\n        <span>};</span>\n    <span>};</span>\n\n    <span>let</span> <span>mut</span> <span>cached_multiplied</span> <span>=</span> <span>HashMap</span><span>::</span><span>new</span><span>();</span>\n\n    <span>let</span> <span>mut</span> <span>multiply</span> <span>=</span> <span>|</span><span>x</span><span>:</span> <span>usize</span><span>|</span> <span>-></span> <span>usize</span> <span>{</span>\n        <span>return</span> <span>match</span> <span>cached_multiplied</span><span>.get</span><span>(</span><span>&amp;</span><span>x</span><span>)</span> <span>{</span>\n            <span>Some</span><span>(</span><span>&amp;</span><span>val</span><span>)</span> <span>=></span> <span>val</span><span>,</span>\n            <span>_</span> <span>=></span> <span>{</span>\n                <span>println!</span><span>(</span><span>&quot;executing multiply&quot;</span><span>);</span>\n                <span>let</span> <span>out</span> <span>=</span> <span>x</span> <span>*</span> <span>x</span><span>;</span>\n                <span>cached_multiplied</span><span>.insert</span><span>(</span><span>x</span><span>,</span> <span>out</span><span>);</span>\n                <span>out</span>\n            <span>}</span>\n        <span>};</span>\n    <span>};</span>\n\n    <span>fn</span> <span>add_or_multiply</span><span>(</span><span>add</span><span>:</span> <span>bool</span><span>,</span> <span>on_add</span><span>:</span> <span>usize</span><span>,</span> <span>on_multiply</span><span>:</span> <span>usize</span><span>)</span> <span>-></span> <span>usize</span> <span>{</span>\n        <span>if</span> <span>add</span> <span>{</span>\n            <span>on_add</span>\n        <span>}</span> <span>else</span> <span>{</span>\n            <span>on_multiply</span>\n        <span>}</span>\n    <span>}</span>\n\n    <span>println!</span><span>(</span><span>&quot;{}&quot;</span><span>,</span> <span>add_or_multiply</span><span>(</span><span>true</span><span>,</span> <span>add</span><span>(</span><span>4</span><span>),</span> <span>multiply</span><span>(</span><span>4</span><span>)));</span> <span>// 8</span>\n    <span>println!</span><span>(</span><span>&quot;{}&quot;</span><span>,</span> <span>add_or_multiply</span><span>(</span><span>false</span><span>,</span> <span>add</span><span>(</span><span>4</span><span>),</span> <span>multiply</span><span>(</span><span>4</span><span>)));</span> <span>// 16</span>\n<span>}</span>\n\n</code></pre></div>\n<p>This outputs the below and we can see that functions were executed only once for the same values.<br>\n</p>\n<div><pre><code>executing add\nexecuting multiply\n8\n16\n</code></pre></div>\n<p>These may not look that elegant especially to seasoned Rust programmers. Fortunately, most of the functional APIs, like the iterators, provided by Rust do lazy evaluations and there are libraries like <a href=\"https://github.com/reem/rust-lazy\">rust-lazy</a> and <a href=\"https://docs.rs/thunk/0.3.0/thunk/\">Thunk</a> which can be used to make functions lazy. Also, Rust provides some advanced types with which lazy evaluations can be implemented.</p>\n<p>Doing Lazy evaluations in Rust might not be worth the code complexity some of the times, but if the functions in question are heavy in terms of processing then it is absolutely worth it to lazy evaluate them.</p>\n<h3>\n<a href=\"https://dev.to/feed#type-system\">\n</a>\nType system\n</h3>\n<p>Rust is a strong statically typed language and also has great type inference. There are also advanced concepts like type aliasing and so on.</p>\n<h3>\n<a href=\"https://dev.to/feed#referential-transparency\">\n</a>\nReferential transparency\n</h3>\n<p>From Wikipedia:</p>\n<blockquote>\n<p>Functional programs do not have assignment statements, that is, the value of a variable in a functional program never changes once defined. This eliminates any chances of side effects because any variable can be replaced with its actual value at any point of execution. So, functional programs are referentially transparent.</p>\n</blockquote>\n<p>Rust has great ways to ensure referential transparency, variables in Rust are immutable by default and even reference passing is immutable by default. So you would have to explicitly mark variables or references as mutable to do so. So in Rust, it is actually quite easy to avoid mutations.</p>\n<p>For example, the below will produce an error<br>\n</p>\n<div><pre><code><span>fn</span> <span>main</span><span>()</span> <span>{</span>\n    <span>let</span> <span>list</span> <span>=</span> <span>[</span><span>&quot;Apple&quot;</span><span>,</span> <span>&quot;Orange&quot;</span><span>,</span> <span>&quot;Banana&quot;</span><span>,</span> <span>&quot;Grape&quot;</span><span>];</span>\n\n    <span>list</span> <span>=</span> <span>[</span><span>&quot;John&quot;</span><span>,</span> <span>&quot;Raju&quot;</span><span>,</span> <span>&quot;Sabi&quot;</span><span>,</span> <span>&quot;Vicky&quot;</span><span>];</span>\n<span>}</span>\n</code></pre></div>\n<p>And so does all of the below<br>\n</p>\n<div><pre><code><span>fn</span> <span>main</span><span>()</span> <span>{</span>\n    <span>let</span> <span>list</span> <span>=</span> <span>vec!</span><span>[</span>\n        <span>String</span><span>::</span><span>from</span><span>(</span><span>&quot;Orange&quot;</span><span>),</span>\n        <span>String</span><span>::</span><span>from</span><span>(</span><span>&quot;Apple&quot;</span><span>),</span>\n        <span>String</span><span>::</span><span>from</span><span>(</span><span>&quot;Banana&quot;</span><span>),</span>\n        <span>String</span><span>::</span><span>from</span><span>(</span><span>&quot;Grape&quot;</span><span>),</span>\n    <span>];</span>\n\n    <span>list</span><span>.push</span><span>(</span><span>String</span><span>::</span><span>from</span><span>(</span><span>&quot;Strawberry&quot;</span><span>));</span> <span>// This will fail as the reference is immutable</span>\n\n    <span>fn</span> <span>mutating_fn</span><span>(</span><span>val</span><span>:</span> <span>String</span><span>)</span> <span>{</span>\n        <span>val</span><span>.push</span><span>(</span><span>'!'</span><span>);</span> <span>// this will fail unless the argument is marked mutable reference or value passed is marked mutable reference</span>\n    <span>}</span>\n\n    <span>mutating_fn</span><span>(</span><span>String</span><span>::</span><span>from</span><span>(</span><span>&quot;Strawberry&quot;</span><span>));</span> <span>// this will fail if the reference is not passed as mutable</span>\n<span>}</span>\n</code></pre></div>\n<p>In order to compile these, we would have to riddle it with <code>mut</code> keywords<br>\n</p>\n<div><pre><code><span>fn</span> <span>main</span><span>()</span> <span>{</span>\n    <span>let</span> <span>mut</span> <span>list</span> <span>=</span> <span>vec!</span><span>[</span>\n        <span>String</span><span>::</span><span>from</span><span>(</span><span>&quot;Orange&quot;</span><span>),</span>\n        <span>String</span><span>::</span><span>from</span><span>(</span><span>&quot;Apple&quot;</span><span>),</span>\n        <span>String</span><span>::</span><span>from</span><span>(</span><span>&quot;Banana&quot;</span><span>),</span>\n        <span>String</span><span>::</span><span>from</span><span>(</span><span>&quot;Grape&quot;</span><span>),</span>\n    <span>];</span>\n\n    <span>list</span><span>.push</span><span>(</span><span>String</span><span>::</span><span>from</span><span>(</span><span>&quot;Strawberry&quot;</span><span>));</span> <span>// This will work as the reference is mutable</span>\n\n    <span>fn</span> <span>mutating_fn</span><span>(</span><span>val</span><span>:</span> <span>&amp;</span><span>mut</span> <span>String</span><span>)</span> <span>{</span>\n        <span>val</span><span>.push</span><span>(</span><span>'!'</span><span>);</span> <span>// this will work as the argument is marked as a mutable reference</span>\n    <span>}</span>\n\n    <span>mutating_fn</span><span>(</span><span>&amp;</span><span>mut</span> <span>String</span><span>::</span><span>from</span><span>(</span><span>&quot;Strawberry&quot;</span><span>));</span> <span>// this will work as the reference is passed as mutable</span>\n<span>}</span>\n\n</code></pre></div>\n<p>There are even more advanced concepts in Rust when it comes to data mutation and all that makes it easier to write immutable code.</p>\n<h3>\n<a href=\"https://dev.to/feed#data-structures\">\n</a>\n<a href=\"https://en.wikipedia.org/wiki/Purely_functional_data_structure\">Data structures</a>\n</h3>\n<p>When using functional programming techniques it is encouraged to use data types such as Stacks, Maps, and Queues as they also have functional implementations. Hence Hashmaps are better than arrays or hash sets as data stores in functional programming. Rust provides such data types and is hence conforms to the functional specifications regarding data structures.</p>\n<h2>\n<a href=\"https://dev.to/feed#conclusion\">\n</a>\nConclusion\n</h2>\n<p>This is just an introduction for those who are trying to apply some functional programming techniques in Rust. There are a lot more that can be done in Rust. As I said earlier functional programming is not a silver bullet but it offers a lot of useful techniques for more understandable, maintainable and testable code. It can co-exist perfectly well with imperative and object-oriented programming styles. In fact, we all should be using the best of everything to solve the problem at hand instead of getting too obsessed about a single methodology.</p>\n<p>I hope you find this useful. If you have any questions or if you think I missed something please add a comment.</p>\n<p>If you like this article, please leave a like or a comment.</p>\n<p>You can follow me on <a href=\"https://twitter.com/deepu105\">Twitter</a> and <a href=\"https://www.linkedin.com/in/deepu05/\">LinkedIn</a>.</p>",
   :direction "ltr"},
  :updated 1573753864000,
  :entities
  [{:mentions [{:text "functional programming"}],
    :id "nlp/f/entity/wd:193076",
    :salienceLevel "about",
    :label "functional programming"}
   {:mentions [{:text "functional"} {:text "higher-order function"}],
    :id "nlp/f/entity/wd:1474542",
    :salienceLevel "mention",
    :label "higher-order function"}
   {:mentions [{:text "functional style"} {:text "style"}],
    :id "nlp/f/entity/wd:2313235",
    :salienceLevel "mention",
    :label "style"}
   {:mentions [{:text "referential transparency"}],
    :id "nlp/f/entity/wd:1754278",
    :salienceLevel "mention",
    :label "referential transparency"}
   {:mentions [{:text "JavaScript"}],
    :id "nlp/f/entity/wd:2005",
    :salienceLevel "mention",
    :label "JavaScript"}],
  :alternate
  [{:href
    "https://dev.to/deepu105/easy-functional-programming-techniques-in-rust-for-everyone-nae",
    :type "text/html"}],
  :title "Easy functional programming techniques in Rust for everyone",
  :author "Deepu K Sasidharan",
  :published-str "Thu Nov 14 09:51:04 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16e6b2bd50d:2c4c3cf:69b9f616",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url
   "https://res.cloudinary.com/practicaldev/image/fetch/s--z-gD5yK6--/c_imagga_scale,f_auto,fl_progressive,h_500,q_auto,w_1000/https://thepracticaldev.s3.amazonaws.com/i/8jy8jkp8bwlufob52bgu.png",
   :width 1000,
   :height 500,
   :contentType "image/jpeg"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://dev.to/deepu105/easy-functional-programming-techniques-in-rust-for-everyone-nae",
  :updateCount 1,
  :commonTopics
  [{:score 158.01221814647587,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1573753864000,
  :fingerprint "78701745",
  :canonicalUrl
  "https://dev.to/deepu105/easy-functional-programming-techniques-in-rust-for-everyone-nae"}
 {:engagement 6,
  :unread false,
  :crawled 1573734693190,
  :recrawled 1574164730550,
  :content
  {:content
   "<p>Product and sum types allow us to exactly model any number of states with a lot of flexibility.</p>\n<p></p>\n<div>\n<div><span></span><img alt=\"Video Thumbnail\" src=\"https://i.ytimg.com/vi/Mi30JdVAcH4/mqdefault.jpg\"><p></p>\n<h5>What do product and sum types have to do with data modeling?</h5>\n<p><span>Product and sum types allow us to exactly model any number of states with a lot of flexibility. https://share.transistor.fm/e/fd5088aa https://www.youtube.com/watch?v=Mi30JdVAcH4 Transcript Eric Normand: What do product and sum types have to do with data modeling? By the end of this episode, I hope</span></p></div>\n</div>\n<h2>Transcript</h2>\n<p>Eric Normand: What do product and sum types have to do with data modeling? By the end of this episode, I hope to answer that question, because I missed it when I talked about product and sum types the last time.</p>\n<p>Hi, my name is Eric Normand and I help people thrive with functional programming. A few episodes back, I talked about product and sum types and explained what they were. I’m not going to go over that again, because you can go listen to that one and get it all.</p>\n<p>I did get a couple questions about why I mentioned them, and what they have to do with data modeling at all. I realized I had explained what they were, but I totally forgot to talk about why you would want to use them at all. Now, I’m going to try to explain that.</p>\n<p>Let’s look at a simple case, all right? You’re modeling this domain, and there’s certain cases that you have to capture. Let’s say that there are 10 cases.</p>\n<p>Now, one thing you could do is simply enumerate all of the cases. Let’s say, it’s 10 states that the system can be in. You can enumerate them so you have one type that has all 10 cases. That would be a sum type that has the 10 different constructors, let’s say.</p>\n<p>There’s other ways you can hit the number 10 as well. You could have two 5s. You could have two types, let’s say a five each, and then have an either between them. An either is a sum type, so it’s going to sum the five and the five. That gives you 10.</p>\n<p>Now, another way you could do it is, you could have a two times five, so not five plus five, but two times five. Meaning, you use a product type where the first, let’s say a tuple — a tuple is a product type — so, the first element of the tuple has two cases and the second element has five. Now you’ve got the 2 x 5 and you’ve got 10 again.</p>\n<p>This is the kind of thinking that you can do once you realize that there are these product and sum types that you can use.</p>\n<p>Why do you want to target the number of cases exactly? I’ve done a very detailed analysis for my book of this. It’s not going to be in the book, because it’s boring.</p>\n<p>If you’ve got too many cases in your domain model, that means a case that doesn’t really exist in the real world but it exists in your software, like it’s possible. Let’s say you did 5 plus 6, and so that’s 11.</p>\n<p>There’s 11 cases, but one of them shouldn’t be used. At some point, you’re going to either use it or have a conditional to make sure it’s not being used.</p>\n<p>Conditionals add complexity to your code. If you have extra cases, you’re adding complexity.</p>\n<p>What if you had 9 cases when there’s really 10 cases in your domain? If you only have nine cases in your code, that means that you’re probably going to be overloading one of those cases to make up for it.</p>\n<p>You’re probably going to be using one of those cases in two different ways and your code is going to have to have a conditional to figure out which one of the cases it really should be.</p>\n<p>In both cases, in both of those situations, you are missing the perfect fit between your domain model and the domain itself, and adding complexity because of it.</p>\n<p>An example of something very simple, an almost silly example of a time when you might have a misfit is…and this happens a lot. You have something like you’re reading a sensor, like a thermometer.</p>\n<p>Sometimes when you do a read, it doesn’t give you a number. But the API you’re given, doesn’t have a way to not return a number because it’s C or something. The return value is always a number.</p>\n<p>What does it do? It overloads zero to be either zero or, oops, I didn’t get a reading when you asked me for it, because the sensor was down, or you’re trying to ask too quickly, or something like that.</p>\n<p>It’s overloading zero because there’s this case that doesn’t fit within the type. The type that they chose was int. There’s this extra case that they want to represent and that’s not in the type, so they had to overload one of the values of int with this number.</p>\n<p>Now, maybe they could have chosen a better number, something that you’re unlikely to ever read, like negative one million, or something like that.</p>\n<p>Even if you had that, you still have a conditional that you’re going to have to deal with. If you want it to convert it to a better type, you’d still have a conditional in there, at least it would be in one place in the conversion code.</p>\n<p>These things happen in real life. I have a memory of a system where you could accept both credit card and PayPal. With credit card, they were using Stripe and PayPal has its own ID.</p>\n<p>The Stripe’s ID and PayPal’s ID were stored in the same database table. To know if someone was a Stripe customer, it would take that ID and run a regex on it to see if it looked like a Stripe ID. To save it as PayPal, they’d run another regex on it to see if it looked like a PayPal ID.</p>\n<p>Everywhere where you had to use this, you wanted to get the ID or figure out what to do with it, you had to run this regex on the field.</p>\n<p>Instead, they should have realized that if they had known about product and sum types, they would have realized that this is actually a sum type. Instead of overloading this one field for the two, we should have an either PayPal or Stripe, or some other system like that, that would better fit the domain.</p>\n<p>In fact, I have heard that in a recent upgrade, they have made that change because it was causing them a lot of pain. A lot of code which was just checking for, “Is this a Stripe ID or a PayPal ID?” Very duplicative code.</p>\n<p>If you have these products and sum types, notice you’ve got plus and times. Product is times and sum is plus. You’re able to target any number that you want, in different ways, in multiple ways.</p>\n<p>Like I said at the beginning, you can have all 10 cases enumerated in one type, or you could break it up into two 5s and sum them. Or you break it up into three and seven and sum them. Or you could have two six and another two. There’s all sorts of ways that you can break it up.</p>\n<p>That’s what the product and sum type gives you. It gives you this flexibility to really dig deep into the domain and model it both correctly, because you can just do the math and know, yes, these have all the possible cases, and I’m not missing any and I don’t have any extra. You have the flexibility to choose whatever way you want it.</p>\n<p>If you want to break it down into two, like I said, two fives, and then sum them, you can do that. You don’t have to have the one 10. If you want to break it down like I said before into 2 and 5 and multiply them, then you can get the 10. You can do two fours and then add a two, two times four and then add a two to get the 10.</p>\n<p>Once you open this door, you can see how easy it is to target a specific number of cases and it lets you analyze whether you’re actually getting the right number of cases and avoid the problems of using a product type and not realizing that…</p>\n<p>Let’s say you wanted to target nine things. You used a two times five thinking “Oh, that 10th one, I’m never going to use it. It’s going to be fine.”</p>\n<p>You don’t realize the problems. What if you did three times four and you had three extra cases?</p>\n<p>That’s even worse. You’re adding complexity to your software. You’re creating conditions where a value is possible to be created, but not meaningful in your domain. You’re asking for trouble. If you can avoid it, you might as well avoid it at the beginning.</p>\n<p>Just to recap, we have product and sum types, which let you easily model any particular number of cases that you might have. They let you easily analyze how many cases you do have. They’re very useful for having all the flexibility to target particular numbers, and being able to know how many you actually have.</p>\n<p>You have both. It’s both easy to create and very flexible, and easy to see how many you have, so in analysis.</p>\n<p>All right, if you liked this episode, you should go to lispcast.com/podcast. There you’ll find all the past episodes, including the one where I explain product and sum types and all the other ones with audio, video, and text transcripts.</p>\n<p>You’ll also find links to subscribe and to find me on social media. Get in touch. I love getting these questions. I love answering them on the podcast.</p>\n<p>My name is Eric Normand. This has been my thought on functional programming. Thank you for listening, and rock on.</p>\n<p>The post <a rel=\"nofollow\" href=\"https://lispcast.com/what-do-product-and-sum-types-have-to-do-with-data-modeling/\">What do product and sum types have to do with data modeling?</a> appeared first on <a rel=\"nofollow\" href=\"https://lispcast.com\">LispCast</a>.</p>",
   :direction "ltr"},
  :updated 1573732800000,
  :entities
  [{:mentions [{:text "data modeling"}],
    :id "nlp/f/entity/wd:367664",
    :salienceLevel "about",
    :label "data modeling"}
   {:mentions [{:text "Stripe"}],
    :id "nlp/f/entity/wd:7624104",
    :salienceLevel "mention",
    :label "Stripe"}
   {:mentions [{:text "PayPal"}],
    :id "nlp/f/entity/wd:483959",
    :salienceLevel "mention",
    :label "PayPal"}
   {:mentions [{:text "functional programming"}],
    :id "nlp/f/entity/wd:193076",
    :salienceLevel "mention",
    :label "functional programming"}
   {:mentions [{:text "credit card"}],
    :id "nlp/f/entity/wd:161380",
    :salienceLevel "mention",
    :label "credit card"}],
  :alternate
  [{:href
    "https://lispcast.com/what-do-product-and-sum-types-have-to-do-with-data-modeling/",
    :type "text/html"}],
  :title
  "What do product and sum types have to do with data modeling?",
  :author "Eric Normand",
  :published-str "Thu Nov 14 04:00:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16e69e5b946:2a89745:49b12733",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url "https://i.ytimg.com/vi/Mi30JdVAcH4/mqdefault.jpg",
   :width 320,
   :height 180,
   :contentType "image/jpeg"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://lispcast.com/?p=2083",
  :updateCount 1,
  :commonTopics
  [{:score 80.49697372036724,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1573732800000,
  :fingerprint "f952cfee",
  :canonicalUrl
  "https://lispcast.com/what-do-product-and-sum-types-have-to-do-with-data-modeling/"}
 {:engagement 13,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1573661661207,
  :content
  {:content
   "More of a memory aid for me as I’ll forget….. Kafka Connect’s default logging goes to the console, I prefer …<p><a href=\"https://dataissexy.wordpress.com/2019/11/13/adding-file-logging-to-kafka-connect-kafka-connect-streaming-data-devops/\">Continue reading <span>→</span></a></p>",
   :direction "ltr"},
  :updated 1573660374000,
  :alternate
  [{:href
    "https://dataissexy.wordpress.com/2019/11/13/adding-file-logging-to-kafka-connect-kafka-connect-streaming-data-devops/",
    :type "text/html"}],
  :title
  "Adding file logging to Kafka Connect – #Kafka #Connect #Streaming #Data #Devops",
  :author "Jason Bell",
  :published-str "Wed Nov 13 07:52:54 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16e658b5817:24964ab:49b12733",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url
   "https://dataissexy.files.wordpress.com/2017/12/cropped-24961595908_e21a3d155c_k.jpg",
   :width 960,
   :height 317,
   :contentType "image/jpeg"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "http://dataissexy.wordpress.com/?p=1840",
  :published 1573660374000,
  :fingerprint "c68c7bed",
  :canonicalUrl
  "https://dataissexy.wordpress.com/2019/11/13/adding-file-logging-to-kafka-connect-kafka-connect-streaming-data-devops/"}
 {:engagement 10,
  :unread false,
  :crawled 1573626999233,
  :content
  {:content
   "Derek Troy-West talks about scaling systems with Clojure, Kafka, and building systems with pure data. “I write Clojure almost every day” Troy-West OPERATR OPERATR demo Follow The Data - Derek Troy-West - Clojure/Conj 2019 Verrency Apache Kafka Three Ways",
   :direction "ltr"},
  :updated 1573624800000,
  :entities
  [{:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "about",
    :label "Clojure"}
   {:mentions [{:text "Apache Kafka"}],
    :id "nlp/f/entity/wd:16235208",
    :salienceLevel "mention",
    :label "Apache Kafka"}],
  :alternate
  [{:href "https://www.therepl.net/episodes/32/", :type "text/html"}],
  :title "32: Clojure, Kafka, and OPERATR with Derek Troy-West",
  :author "Daniel Compton",
  :published-str "Tue Nov 12 22:00:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16e637a71c1:213faeb:69b9f616",
  :visual {:url "none"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://www.therepl.net/episodes/32/",
  :commonTopics
  [{:score 35.266675169674116,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1573624800000,
  :fingerprint "b42ba3b2",
  :canonicalUrl "https://www.therepl.net/episodes/32/"}
 {:engagement 5,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1573611851543,
  :content
  {:content
   "<p>In <a href=\"https://grumpyhacker.com/test-machine-test-jdbc-sink/\">A Test Helper for JDBC Sinks</a> one\npart of the testing process that I glossed over a bit was the line\n“Generate some example records to load into the input topic”. I said\nthis like it was no big deal but actually there are a few moving parts\nthat all need to come together for this to work and it’s something I\nstruggled to get to grips with at the beginning of our journey and\nhave seen other experienced engineers struggle with too. Part of the\nproblem I think is that a lot of the Kafka eco-system is made up of\nfolks using statically typed languages like Scala, Kotlin etc. It does\nall work with dynamically typed languages like Clojure but there are\njust fewer of us around which makes it all the more important to share\nwhat we learn. So here’s a quick guide to generating\ntest-data and getting it into Kafka using the test-machine from Jackdaw</p>\n<h2>Basic Data Generator</h2>\n<p>You may recall the fields enumerated in the whitelist from the example\nsink config. They were as follows:-</p>\n<ul>\n<li>customer-id</li>\n<li>current-balance</li>\n<li>updated-at</li>\n</ul>\n<p>So a nice easy first step is to write a function to generate a map\nwith these fields</p>\n<figure><pre><code><span>(</span><span>ns</span><span> </span><span>io.grumpybank.generators</span><span>\n</span><span>(</span><span>:require</span><span>\n</span><span>[</span><span>java-time</span><span> </span><span>:as</span><span> </span><span>t</span><span>]))</span><span>\n</span><span>(</span><span>defn</span><span> </span><span>gen-customer-balance</span><span>\n</span><span>[]</span><span>\n</span><span>{</span><span>:customer-id</span><span> </span><span>(</span><span>str</span><span> </span><span>(</span><span>java.util.UUID/randomUUID</span><span>))</span><span>\n</span><span>:current-balance</span><span> </span><span>(</span><span>rand-int</span><span> </span><span>1000</span><span>)</span><span>\n</span><span>:updated-at</span><span> </span><span>(</span><span>t/to-millis-from-epoch</span><span> </span><span>(</span><span>t/instant</span><span>))})</span></code></pre></figure>\n<h2>Schema Definition</h2>\n<p>However this is not enough on it’s own. The target database has a schema\nwhich is only implicit in the function above. The JDBC sink connector\nwill create and evolve the schema for us if we allow it, but in\norder to do that, we need to write the data using the Avro serialization\nformat. Here is Jay Kreps from Confluent <a href=\"https://www.confluent.io/blog/avro-kafka-data/\">making the case for Avro</a>\nand much of the confluent tooling leverages various aspects of this particular\nserialization format so it’s a good default choice unless you have a good\nreason to choose otherwise.</p>\n<p>So let’s assume the app that produces the customer-balances topic has\nalready defined a Avro schema. The thing we’re trying to test is a\nconsumer of that topic but as a tester, we have to wear the producer\nhat for for a while so we take a copy of the schema from the upstream\napp and make it available to our connector test.</p>\n<figure><pre><code><span>{</span><span>\n</span><span>&quot;type&quot;</span><span>:</span><span> </span><span>&quot;record&quot;</span><span>,</span><span>\n</span><span>&quot;name&quot;</span><span>:</span><span> </span><span>&quot;CustomerBalance&quot;</span><span>,</span><span>\n</span><span>&quot;namespace&quot;</span><span>:</span><span> </span><span>&quot;io.grumpybank.tables.CustomerBalance&quot;</span><span>,</span><span>\n</span><span>&quot;fields&quot;</span><span>:</span><span> </span><span>[</span><span>\n</span><span>{</span><span>\n</span><span>&quot;name&quot;</span><span>:</span><span> </span><span>&quot;customer_id&quot;</span><span>,</span><span>\n</span><span>&quot;type&quot;</span><span>:</span><span> </span><span>&quot;string&quot;</span><span>\n</span><span>},</span><span>\n</span><span>{</span><span>\n</span><span>&quot;name&quot;</span><span>:</span><span> </span><span>&quot;updated_at&quot;</span><span>,</span><span>\n</span><span>&quot;type&quot;</span><span>:</span><span> </span><span>{</span><span>\n</span><span>&quot;type&quot;</span><span>:</span><span> </span><span>&quot;long&quot;</span><span>,</span><span>\n</span><span>&quot;logicalType&quot;</span><span>:</span><span> </span><span>&quot;timestamp-millis&quot;</span><span>\n</span><span>}</span><span>\n</span><span>},</span><span>\n</span><span>{</span><span>\n</span><span>&quot;name&quot;</span><span>:</span><span> </span><span>&quot;current_balance&quot;</span><span>,</span><span>\n</span><span>&quot;type&quot;</span><span>:</span><span> </span><span>[</span><span>&quot;null&quot;</span><span>,</span><span> </span><span>&quot;long&quot;</span><span>],</span><span>\n</span><span>&quot;default&quot;</span><span>:</span><span> </span><span>null</span><span>\n</span><span>}</span><span>\n</span><span>]</span><span>\n</span><span>}</span></code></pre></figure>\n<p>We can use the schema above to create an Avro\n<a href=\"https://www.apache.org/dist/kafka/2.3.0/javadoc/org/apache/kafka/common/serialization/Serde.html\">Serde</a>.\nSerde is just the name given to the composition of the Serialization\nand Deserialization operations. Since one is the opposite of the other\nit has become a strong convention that that they are defined together\nand the Serde interface captures that convention.</p>\n<p>The Serde will be used by the KafkaProducer to serialize the message\nvalue into a ByteArray before sending it off to the broker to be\nappended to the specified topic and replicated as per the topic\nsettings. Here’s a helper function for creating the Serde for a schema\nrepresented as JSON in a file using jackdaw.</p>\n<figure><pre><code><span>(</span><span>ns</span><span> </span><span>io.grumpybank.avro-helpers</span><span>\n</span><span>(</span><span>:require</span><span>\n</span><span>[</span><span>jackdaw.serdes.avro</span><span> </span><span>:as</span><span> </span><span>avro</span><span>]</span><span>\n</span><span>[</span><span>jackdaw.serdes.avro.schema-registry</span><span> </span><span>:as</span><span> </span><span>reg</span><span>]))</span><span>\n</span><span>(</span><span>def</span><span> </span><span>schema-registry-url</span><span> </span><span>&quot;http://localhost:8081&quot;</span><span>)</span><span>\n</span><span>(</span><span>def</span><span> </span><span>schema-registry-client</span><span> </span><span>(</span><span>reg/client</span><span> </span><span>schema-registry-url</span><span> </span><span>32</span><span>))</span><span>\n</span><span>(</span><span>defn</span><span> </span><span>value-serde</span><span>\n</span><span>[</span><span>filename</span><span>]</span><span>\n</span><span>(</span><span>avro/serde</span><span> </span><span>{</span><span>:avro.schema-registry/client</span><span> </span><span>schema-registry-client</span><span>\n</span><span>:avro.schema-registry/url</span><span> </span><span>schema-registry-url</span><span>}</span><span>\n</span><span>{</span><span>:avro/schema</span><span> </span><span>(</span><span>slurp</span><span> </span><span>filename</span><span>)</span><span>\n</span><span>:key?</span><span> </span><span>false</span><span>}))</span></code></pre></figure>\n<p>The Avro Serdes in jackdaw ultimately use the KafkaAvroSerializer/KafkaAvroDeserializer\nwhich share schemas via the Confluent Schema Registry and optionally\nchecks for various levels of compatability. The Schema Registry is yet\nanother topic worthy of it’s own blog-post but fortunately Gwen\nShapira has already <a href=\"https://www.confluent.io/blog/schema-registry-kafka-stream-processing-yes-virginia-you-really-need-one/\">written\nit</a>.\nThe Jackdaw avro serdes convert clojure data structures like the one\noutput by <code>gen-customer-balance</code> into an <a href=\"https://avro.apache.org/docs/1.8.2/api/java/org/apache/avro/generic/GenericRecord.html\">Avro\nGenericRecord</a>\nI’ll get into more gory detail about this some other time but for now,\nlet’s move quickly along and discuss the concept of “Topic Metadata”.</p>\n<h2>Topic Metadata</h2>\n<p>In Jackdaw, the convention adopted for associating Serdes with\ntopics is known as “Topic Metadata”. This is just a Clojure map so you\ncan put all kinds of information in there if it helps fulfill some\nrequirement. Here are a few bits of metadata that jackdaw will act upon</p>\n<h3>When creating a topic</h3>\n<ul>\n<li><code>:topic-name</code></li>\n<li><code>:replication-factor</code></li>\n<li><code>:partition-count</code></li>\n</ul>\n<h3>When serializing a message</h3>\n<ul>\n<li><code>:key-serde</code></li>\n<li><code>:value-serde</code></li>\n<li><code>:key-fn</code></li>\n<li><code>:partition-fn</code></li>\n</ul>\n<figure><pre><code><span>(</span><span>ns</span><span> </span><span>io.grumpybank.connectors.test-helpers</span><span>\n</span><span>(</span><span>:require</span><span>\n</span><span>[</span><span>jackdaw.serdes</span><span> </span><span>:as</span><span> </span><span>serde</span><span>]</span><span>\n</span><span>[</span><span>io.grumpybank.avro-helpers</span><span> </span><span>:as</span><span> </span><span>avro</span><span>]))</span><span>\n</span><span>(</span><span>defn</span><span> </span><span>topic-config</span><span>\n</span><span>[</span><span>topic-name</span><span>]</span><span>\n</span><span>{</span><span>:topic-name</span><span> </span><span>topic-name</span><span>\n</span><span>:replication-factor</span><span> </span><span>1</span><span>\n</span><span>:key-serde</span><span> </span><span>(</span><span>serde/string-serde</span><span>)</span><span>\n</span><span>:value-serde</span><span> </span><span>(</span><span>avro/value-serde</span><span> </span><span>(</span><span>str</span><span> </span><span>&quot;./test/resources/schemas/&quot;</span><span>\n</span><span>topic-name</span><span>\n</span><span>&quot;.json&quot;</span><span>))})</span></code></pre></figure>\n<h2>Revisit the helper</h2>\n<p>Armed with all this new information, we can revisit the helper defined\nin the previous post and understand a bit more clearly what’s going on\nand how it all ties together. For illustrative purposes, we’ve\nexplicitly defined a few variables that were a bit obscured in the\noriginal example.</p>\n<figure><pre><code><span>(</span><span>def</span><span> </span><span>kconfig</span><span> </span><span>{</span><span>&quot;bootstrap.servers&quot;</span><span> </span><span>&quot;localhost:9092&quot;</span><span>})</span><span>\n</span><span>(</span><span>def</span><span> </span><span>topics</span><span> </span><span>{</span><span>:customer-balances</span><span> </span><span>(</span><span>topic-config</span><span> </span><span>&quot;customer-balances&quot;</span><span>)})</span><span>\n</span><span>(</span><span>def</span><span> </span><span>seed-data</span><span> </span><span>(</span><span>repeatedly</span><span> </span><span>5</span><span> </span><span>gen-customer-balance</span><span>))</span><span>\n</span><span>(</span><span>def</span><span> </span><span>topic-id</span><span> </span><span>:customer-balances</span><span>)</span><span>\n</span><span>(</span><span>def</span><span> </span><span>key-fn</span><span> </span><span>:id</span><span>)</span><span>\n</span><span>(</span><span>fix/with-fixtures</span><span> </span><span>[(</span><span>fix/topic-fixture</span><span> </span><span>kconfig</span><span> </span><span>topics</span><span>)]</span><span>\n</span><span>(</span><span>jdt/with-test-machine</span><span> </span><span>(</span><span>jdt/kafka-transport</span><span> </span><span>kconfig</span><span> </span><span>topics</span><span>)</span><span>\n</span><span>(</span><span>fn</span><span> </span><span>[</span><span>machine</span><span>]</span><span>\n</span><span>(</span><span>jdt/run-test</span><span> </span><span>machine</span><span> </span><span>(</span><span>concat</span><span>\n</span><span>(</span><span>->></span><span> </span><span>seed-data</span><span>\n</span><span>(</span><span>map</span><span> </span><span>(</span><span>fn</span><span> </span><span>[</span><span>record</span><span>]</span><span>\n</span><span>[</span><span>:write!</span><span> </span><span>topic-id</span><span> </span><span>record</span><span> </span><span>{</span><span>:key-fn</span><span> </span><span>key-fn</span><span>}])))</span><span>\n</span><span>[[</span><span>:watch</span><span> </span><span>watch-fn</span><span> </span><span>{</span><span>:timeout</span><span> </span><span>5000</span><span>}]])))))</span></code></pre></figure>\n<p>The vars <code>kconfig</code> and <code>topics</code> are used by both the <code>topic-fixture</code> (to create the\nrequired topic before starting to write test-data to it), and the <code>kafka-transport</code>\nwhich teaches the test-machine how read and write data from the listed topics. In\nfact the test-machine will start reading data from all listed topics straight\naway even before it is instructed to write anything.</p>\n<p>Finally we write the test-data to kafka by supplying a list of commands to the\n<code>run-test</code> function. The <code>:write!</code> command takes a topic-identifier (one of the\nkeys in the topics map), the message value, and a map of options in this case\nspecifying that the message key can be derived from the message by invoking\n<code>(:id record)</code>. We could also specify things like the <code>:partition-fn</code>,\n<code>:timestamp</code> etc. When the command is executed by the test-machine, it looks up\nthe topic-metadata for the specified identifier and uses it to build a ProducerRecord\nand send it off to the broker.</p>\n<p>Next up will be a deep-dive into the test-machine journal and the watch command.</p>",
   :direction "ltr"},
  :updated 1573603200000,
  :entities
  [{:mentions [{:text "Serde"}],
    :id "nlp/f/entity/wd:7666174",
    :salienceLevel "mention",
    :label "Sêrdê"}
   {:mentions [{:text "Jackdaw"}],
    :id "nlp/f/entity/wd:25394",
    :salienceLevel "mention",
    :label "Western Jackdaw"}
   {:mentions [{:text "Avro"}],
    :id "nlp/f/entity/wd:249190",
    :salienceLevel "mention",
    :label "Avro"}
   {:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "JDBC"}],
    :id "nlp/f/entity/wd:722772",
    :salienceLevel "mention",
    :label "Java Database Connectivity"}],
  :alternate
  [{:href "https://grumpyhacker.com/generating-test-data/",
    :type "text/html"}],
  :title "Generating Test Data",
  :author "Andy Chambers",
  :published-str "Tue Nov 12 16:00:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16e62934f17:20619d6:97b0c8f7",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://grumpyhacker.com/generating-test-data",
  :commonTopics
  [{:score 38.460778463700024,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.968,
    :id "nlp/f/topic/1430",
    :salienceLevel "about",
    :label "medical devices"}
   {:score 0.71,
    :id "nlp/f/topic/2148",
    :salienceLevel "mention",
    :label "spiritual"}],
  :published 1573603200000,
  :fingerprint "cc067ba6",
  :canonicalUrl "https://grumpyhacker.com/generating-test-data/"}
 {:engagement 5,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1573472719373,
  :content
  {:content
   "<div>\n<p><em>Issue 351 – November 11, 2019 · <a href=\"https://purelyfunctional.tv/newsletter-archives/\">Archives</a> · <a title=\"Thanks, Jeff!\" href=\"https://purelyfunctional.tv/newsletter/\">Subscribe</a></em></p>\n<h2>Clojure Tool 🔨</h2>\n<p><a title href=\"https://github.com/borkdude/babashka\"><em>babashka</em></a></p>\n<p>It’s Clojure for your Bash scripts. It uses Graal to compile Clojure to native, so it starts up fast. It can run Clojure commands over lines of input, so it works with the Unix philosophy.</p>\n<p>You should know that I’m just starting to experiment with this tool, but I already love the potential. I’m not afraid of Bash, but let’s be honest: it’s not the best language for complex data structure manipulation. Clojure fits that bill, and babashka seems to be tuned to slip right into an existing Bash script where Bash isn’t so great.</p>\n<h2>Follow-up 🙃</h2>\n<p>In the last couple of <a title href=\"https://purelyfunctional.tv/issues\">issues</a>, I talked about monoids and associativity. I mentioned that <code>clojure.core/merge</code> was a monoid but that it doesn’t follow the monoid pattern.</p>\n<p>An astute reader (and awesome community member) mentions that the order of arguments to <code>merge</code> does matter. For instance:</p>\n<pre><code>=> (merge {:a 1} {:a 2})\n{:a 2}\n=> (merge {:a 2} {:a 1})\n{:a 1}\n</code></pre>\n<p>Same arguments, different order.</p>\n<p>They are right that the argument order matters, but this doesn’t affect its status as a monoid. This is a common misunderstanding between associativity and commutativity. I received a couple of monoid implementations that did not maintain argument order.</p>\n<p>To understand associativity vs commutativity, let’s review.</p>\n<p>Monoids are associative operations that have an identity. Associativity means <em>the order of operations doesn’t matter</em>. That is, where you put the parentheses doesn’t change the output.</p>\n<pre><code>=> (merge {:a 1} (merge {:a 2} {:a 3}))\n{:a 3}\n=> (merge (merge {:a 1} {:a 2}) {:a 3})\n{:a 3}\n</code></pre>\n<p>More abstractly:</p>\n<pre><code>(= (f a (f b c))\n   (f (f a b) c))\n</code></pre>\n<p>With Clojure’s monoid pattern, you can write:</p>\n<pre><code>(f a b c)\n</code></pre>\n<p>Notice we did not change the order of <code>a b c</code>. Associativity means the order of operations doesn’t matter, but the order of arguments <em>might</em> matter.</p>\n<p>Commutativity means that an operation’s argument order doesn’t matter. For instance:</p>\n<pre><code>=> (+ 1 2 3)\n6\n=> (+ 2 1 3)\n6\n</code></pre>\n<p>This example is confusing because <code>+</code> is both associative and commutative. It’s hard to find operations that are commutative but not associative. But we can easily make one.</p>\n<pre><code>(defn average [a b]\n  (/ (+ a b) 2.0))\n\n=> (average 10 7)\n8.5\n=> (average 7 10)\n8.5\n</code></pre>\n<p>That means it’s commutative (argument order doesn’t matter). But you can’t use this two-argument average to do an average of three numbers. It’s not associative. Try it.</p>\n<p>So, to recap:</p>\n<p><code>merge</code> is associative and it has an identity (<code>{}</code>). It is a monoid! It is not commutative, however. Order of arguments does matter.</p>\n<h2>Conference alert 🚨</h2>\n<p>I booked my tickets to the 2019 Clojure/conj in Durham, North Carolina. If you’re going, let me know! I haven’t been to a Conj in a couple of years and I’m really excited.</p>\n<h2>Currently recording 🎥</h2>\n<p><em>Property-Based Testing with test.check</em> is now split into three courses, <a title href=\"https://purelyfunctional.tv/courses/property-based-testing-with-test-check/\">Beginning</a>, <a title href=\"https://purelyfunctional.tv/courses/intermediate-property-based-testing-with-test-check/\">Intermediate</a>, and <a title href=\"https://purelyfunctional.tv/courses/advanced-property-based-testing-with-test-check/\">Advanced</a>. The launch begins next week. Stay tuned for a flood of ideas, tips, and tricks around property-based testing.</p>\n<h2>Book update 📖</h2>\n<p>I have been getting such great stories from readers of <a title href=\"https://lispcast.com/gs\"><em>Grokking Simplicity</em></a>. People tell me they are making their code more organized and testable. After all of the work I put into the book, it feels good that it’s having such a great impact.</p>\n<p>You can <a title href=\"https://lispcast.com/gs\">buy the book</a> and use the coupon code <strong>TSSIMPLICITY</strong> for 50% off.</p>\n<p>Thanks for reading.</p>\n<h2>Clojure Challenge 🤔</h2>\n<h3>This week’s challenge</h3>\n<p>This week’s challenge is a treasure hunt. Find monoids in the Clojure ecosystem. You can find them in Clojure’s core libraries or elsewhere in contributed libraries. If you find 10, consider yourself a novice monoid hunter. 20 and you’re an expert.</p>\n<p>For extra credit, determine if they implement the Clojure monoid pattern and whether they are also commutative.</p>\n<p>As usual, please reply to this email to send me your submissions. I’ll collect them up and share them in the next issue. If you don’t want me to share your submission, let me know.</p>\n<p>Rock on!<br>Eric Normand</p>\n</div>\n<p>The post <a rel=\"nofollow\" href=\"https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-351-clojure-tool-babashka/\">PurelyFunctional.tv Newsletter 351: Clojure tool: babashka</a> appeared first on <a rel=\"nofollow\" href=\"https://purelyfunctional.tv\">PurelyFunctional.tv</a>.</p>",
   :direction "ltr"},
  :updated 1573470000000,
  :entities
  [{:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "about",
    :label "Clojure"}
   {:mentions [{:text "Bash"}],
    :id "nlp/f/entity/wd:189248",
    :salienceLevel "mention",
    :label "GNU Bash"}
   {:mentions [{:text "Unix philosophy"}],
    :id "nlp/f/entity/wd:14652",
    :salienceLevel "mention",
    :label "Unix philosophy"}
   {:mentions [{:text "data structure"}],
    :id "nlp/f/entity/wd:175263",
    :salienceLevel "mention",
    :label "data structure"}
   {:mentions [{:text "Durham, North Carolina"}],
    :id "nlp/f/entity/wd:49229",
    :salienceLevel "mention",
    :label "Durham"}],
  :alternate
  [{:href
    "https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-351-clojure-tool-babashka/",
    :type "text/html"}],
  :title "PurelyFunctional.tv Newsletter 351: Clojure tool: babashka",
  :author "Eric Normand",
  :published-str "Mon Nov 11 03:00:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16e5a48520d:14ef40a:49b12733",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://purelyfunctional.tv/?p=32453",
  :commonTopics
  [{:score 50.33356508816375,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.9565448537946938,
    :id "nlp/f/topic/10100",
    :salienceLevel "about",
    :label "digest"}],
  :published 1573470000000,
  :fingerprint "14ed795b",
  :canonicalUrl
  "https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-351-clojure-tool-babashka/"}
 {:engagement 7,
  :unread false,
  :crawled 1573455742843,
  :content
  {:content
   "<p>I was asked a great question by a listener about whether it’s always possible to find a good domain model. Sometimes, the business rules are so messy, how can we find something clean and stable? In this episode, I explore how we can find a stable and clean domain model within the chaos.</p>\n<p></p>\n<div>\n<div><span></span><img alt=\"Video Thumbnail\" src=\"https://i.ytimg.com/vi/p4GJ6ygZ04Q/mqdefault.jpg\"><p></p>\n<h5>Can you have a clean domain model?</h5>\n<p><span>I was asked a great question by a listener about whether it's always possible to find a good domain model. Sometimes, the business rules are so messy, how can we find something clean and stable? In this episode, I explore how we can find a stable and clean domain model within the chaos. https://shar</span></p></div>\n</div>\n<h2>Transcript</h2>\n<p>Eric Normand: Can you have a clean domain model? In this episode, we will explore what can you do with a messy talking, messy set of business rules. My name is Eric Normand, and I help people thrive with functional programming.</p>\n<p>I got this great question from Niels Bom. He actually recorded it on audio and emailed it to me. That was pretty cool. The question was whether it was always possible to find a nice clean domain model.</p>\n<p>For example, a lot of times we don’t really control the business rules. They come from laws, or it’s we work at a big company and they have a bunch of regulations and there’s no central body controlling whether there is some kind of coherency between all the ideas in there, whether it even makes sense.</p>\n<p>Is it possible to come up with a domain model in those kinds of situations where it is just a mess? It’s a mess. I think, yes but I think it might require a little bit of deeper understanding of what I mean by domain model.</p>\n<p>I’m going to use this story. I worked on in Election Registration System. It was also a notification system. It’d notify you if you had an election coming up. It was supposed to work all across the US. That was the goal of the system, is to have any US person notified of elections that they could vote in.</p>\n<p>Increase democracy, more voters is more democracy. That was the theory.</p>\n<p>Now, to tell this story, because I know a lot of my listeners are not in the US. The US is a big country divided into 50 states. When you register to vote, you actually register to vote with your state. Every state has different rules, laws, regulations about how to register, who can register, how the elections are run, how to show up for an election.</p>\n<p>Do you need ID? All sorts of stuff like that. Where do you go? Every state, all 50 of them, have different rules. Some have better rules than others — like cleaner, easier to follow rules — and some have pretty convoluted rules.</p>\n<p>In order to serve people all over the country, we needed to have all those rules in our system. You can imagine we could start with something like a function that takes an election and a person, and tells us whether that person can vote in the election.</p>\n<p>It’s just like a can-vote function. We just start with the rules, like if you live in this state and the election is in this state, then yes. Otherwise, no.</p>\n<p>We have this really hairy, nasty nested if statement. Just a bunch of ifs, just a bunch of conditionals. You look at that and you’re like, “OK. I got it working.” A rule changes and you pull your hair out because you’ve got to go in and figure out where to put this new rule or change what rule.</p>\n<p>If we take a step back, I actually think the can-vote function is a pretty good start. It boils it down to the essential, like yes/no. There’s all these other underlying concepts. This concept of a person being eligible, that is part of the domain model because that’s not going to change. The fact that they may or may not be eligible for an election, that is an unchanging thing.</p>\n<p>Regardless of the state that they are in, regardless of laws that change, this is something stable that we can relax about. We can put it into our domain model.</p>\n<p>What about residency? Is that something? I don’t know. I don’t know the answer. Maybe this is something that is a universal that a person is a resident of a particular state, or maybe it’s a one-to-many relationship. Maybe a person can be a resident in multiple states, depends on the rules of the state.</p>\n<p>If there’s one state that lets you be resident of it and another state, then we have to make it multiple. A person is a resident of one or more, maybe zero or more. I don’t know. We have to do the modeling. I don’t know what the answer is, but you can do that. You can just sit there and do that modeling.</p>\n<p>Find something that is timeless that works for all of the states. Notice, we haven’t implemented the rules like who is eligible for one election. We haven’t done that, but we have decided that there is a concept of eligibility, that is like a Boolean. It’s like a yes or no.</p>\n<p>Maybe we would be even more specific. Maybe it’s no. You’re not eligible because there are some very clear cases. No. You don’t live in that state. You cannot vote in that election. There’s definitely some things like that. Maybe it’s no and maybe. I’ve done my best to implement these rules, and maybe you can vote.</p>\n<p>That could be the best answer we can give. You might be able to vote in that election. We think you can. We can’t find any reason you can’t. When you get there, they might have some rule that knew that day. There’s also this concept working in the system. I know this domain a little bit.</p>\n<p>There’s the concept of, “You have to be registered to vote in some states.” Some of them say, “You have to register 30 days before the election,” or it doesn’t count.</p>\n<p>“You can’t register the day off, and then walk into the booth because we need time to print out the books, the tables with everybody’s information in them. You have to register 30 days before.”</p>\n<p>This idea that you have to capture whether they are registered and what date they registered, that might be a universal thing. Maybe they don’t need to register, but it doesn’t hurt that it’s part of the data model, that they have potentially registered yes or no for the state.</p>\n<p>States are divided into districts. If you’re a resident of the state, you probably registered in a particular district. That could be part of the data model. Like I said, you’d have to do the modeling, but you can do it. It’s not anything more than that.</p>\n<p>What I’m saying is, you have to take a step back from the code that when you try to lay it all out at once, it’s like this big if statement. It’s nested hairy, nasty thing, spaghetti. If you go down deeper, there’s a lot of stuff in there that is, for sure, universal. You just have to go out and you got to explore.</p>\n<p>You got to look at all the rules, and say, “There’s an awful lot of rules about residency.” That could be an important concept. What does it mean to be a resident? You dig deeper, and you dig into it into the domain and you see, “Oh, I see. Residency is a one-to-many relationship.”</p>\n<p>You do it. You just put it. There you go, you modeled it. That’s part of your domain model. The business rules can still be a mess, except now you’re starting to talk about, “Well, this can vote.”</p>\n<p>Let’s not talk about election and person to Boolean. Let’s say it’s for a particular election just to make it easier. Can this person vote? It has one argument, a person, and returns true or false. Think of that as a thing, as an abstraction. I don’t know how it’s implemented.</p>\n<p>Just for a moment, let me step back and say, “If I had a magical function that told me this, would this be enough? Would this solve my problem?” Maybe it is. Maybe that’s it.</p>\n<p>Now you’re saying, “This type signature, this function signature is actually part of my domain model. I just have to find a particular implementation of this function signature that matches all the laws and stuff, and then I’m done. This is the signature I’m looking for.</p>\n<p>Now that I know the signature, that’s something I can use as a higher order function to pass to other things. It’s a fixed thing. It’s a point that I can rely on as like an interface point. It’s another timeless thing.”</p>\n<p>What I’m trying to show is that by breaking it down, by analyzing it, by learning about the domain and stepping back from the code that actually implements the thing, you can move quite a lot from your business rules down into the domain model. There have to be things that you can rely on in there. There have to be. There might be two domain models.</p>\n<p>Let me use this as a way to bring in a related tangent, related similar situation. Aristotle versus Newton. Aristotle had a system of physics. It was a very messy physics compared to what we consider physics today. It had a lot of rules.</p>\n<p>It said stuff like heavy stuff sinks to the bottom of the ocean while light stuff stays on top. Big things travel slower than small things. Big things tend to go downhill. It’s like big things fall faster than little things. It’s all sorts of rules about how stuff works in the world.</p>\n<p>For a lot of things, it works. For a lot of things, it doesn’t. Those, you could call corner cases. For thousands of years, this was the system of physics that people used. It was mostly like a philosophical exercise. They weren’t doing engineering based on this stuff.</p>\n<p>They were just trying to find like, “Well, when Aristotle said big things roll downhill, but this thing goes up the hill, or this is a big thing or a heavy thing that floats on water like a boat. How does a boat, which is really heavy, float on the water?”</p>\n<p>They would come up with some other reason like some other if statement to show that, yes, it still makes sense. They’re fleshing out this huge, big if statement, nested, messy thing, and along comes Newton. What does he do?</p>\n<p>He says, “You know what? It’s not really size that matters. It’s mass. We don’t care about the shape or the size and stuff.” He broke it down into these little smaller…Pulled things apart into little constituent things.</p>\n<p>He made mechanics which has four laws, Newton’s laws of motion, where we’re all familiar with those, and are just a handful of concepts, force, mass, time, distance, and then how they all relate together in the system.</p>\n<p>I’ve used this before as an example of a really nice domain model that he’s made, all these messy rules. Now you have this clean, four-law domain model that you can build those other things on top of. You can see, “Oh, I see. We’ve got heavy things. That’s mass, big things.”</p>\n<p>What they meant was massive things. The density is the size, mass divided by its size. That’s what makes buoyancy. You can start defining all the things that you saw before, all the phenomena that Aristotle was trying to explain, except that it’s not really. It’s not really all of it because it talks nothing about a lot of the physics. It’s just about motion.</p>\n<p>Newton also had to define optics, and light, and color. This is a totally different domain model. This has totally different rules. Doesn’t interact at all with the mechanics. I guess what I’m saying is if you’re seeing a big messy system, it doesn’t mean that there’s one clean domain model. There could be two. There could be three. There could be four.</p>\n<p>You do have to look past trying to unify everything. Newton didn’t unify all that stuff. He unified some stuff. He unified the heavens, stars and planets, and stuff that we could see with the stuff that we deal with on earth. He unified the laws and said, “Look, they are obeying the same laws. This is how it could all work.”</p>\n<p>Mechanics says nothing about light. It says nothing about color, or prisms, or anything like that. It’s just in the point masses. Doesn’t even say shape, how stuff rolls. Anyway, what I’m trying to get at is you can have multiple different things in there. The other thing I’m trying to get at is that just because the rules are messy, like the Aristotelian rules…</p>\n<p>The rules are messy, like the laws that your country or your state has implemented might be messy and not make sense. There’s just no clean way to do it besides a bunch of if statements. That doesn’t mean that it’s not based on something a little bit more timeless underneath.</p>\n<p>Just because they have this term that they’re using doesn’t mean you can’t find a better term or a way to define that in a better way and then translate. When Aristotle was talking about heavy things sink to the bottom of the ocean, and light things stay on top, or big things move slow, what does he mean big things move slow?</p>\n<p>They don’t move slow. We know that now. Big things don’t move slow. What does he mean? He probably meant that it takes more energy to increase the velocity of a massive object. That’s what he probably meant. You can translate between them a little bit.</p>\n<p>The next thing I want to talk about in this because this is a really great question. I want to do a justice. Stratified design can help. I’ve talked about this thing before where you have this function that can-vote that takes an election and a person and returns a Boolean.</p>\n<p>This signature can be timeless, even though any particular implementation depends on the current regulations and laws and stuff. This signature can be timeless. You can start to say, “What can we do with this signature?”</p>\n<p>You could have something that lets you compose them. You can build a rule that says, “If the state of the election is Colorado, then the person has to live in Colorado.” If they don’t live in Colorado, that returns false. If they do live in Colorado, return maybe. Like I said before, return a maybe. It could be a true.</p>\n<p>You have another rule that’s got the same signature. The election and person returns Boolean. It says, “If they registered, look at the date that they registered and the date of the election. If there’s at least 30 days between them, then true. Otherwise, false.”</p>\n<p>Now you can compose them together. You can make a system to compose up these smaller signatures into bigger ones. What you are really looking for is something better than if statements. The if statement is not a good enough mechanism for composing up a bunch of messy rules.</p>\n<p>Maybe something like this, where you can compose them up with ands and ors is. I don’t know. You’d have to experiment with it. You now have this freedom because you’ve made a fixed point in your domain model, something that you are considering — at least for the time being — to be timeless, this function signature.</p>\n<p>Now, we can start building on top of that in our business rules.</p>\n<p>I hope I’ve thoroughly answered this question. I don’t think it’s easy. I actually consider this to be a pretty advanced functional programming skill mostly because you can get by with if statements. You can. You don’t have to think about data modeling so much.</p>\n<p>If you are having a mess, if you are in a mess right now, if you have a mess of business rules, you probably could use something like this. That’s my contention. That’s a good sign that you’re ready for this.</p>\n<p>If you liked this episode, you can find all the past episodes at lispcast.com/podcast. There you’ll find audio, video, and text versions of every past episode. You’ll also find links to subscribe and please do, because if you liked this one, you’ll get more. There will be more.</p>\n<p>Also, links to find me on social media so that you can ask me a question, disagree with me, clarify something, I might have said something incorrect. Please, I’d love to know. If you disagree, if you have better sources than I do, if you’re smarter than me and I just don’t get it. Please, come on. Hit me up.</p>\n<p>This is from a question from a person who emailed me the other day, Niels. I’m really glad that I’m getting cool international audience members. This has been my thought on functional programming. My name is Eric Normand. Thank you for listening, and rock on.</p>\n<p>The post <a rel=\"nofollow\" href=\"https://lispcast.com/can-you-have-a-clean-domain-model/\">Can you have a clean domain model?</a> appeared first on <a rel=\"nofollow\" href=\"https://lispcast.com\">LispCast</a>.</p>",
   :direction "ltr"},
  :updated 1573452000000,
  :entities
  [{:mentions [{:text "Aristotle"}],
    :id "nlp/f/entity/wd:868",
    :salienceLevel "mention",
    :label "Aristotle"}
   {:mentions [{:text "the States"} {:text "the US"}],
    :id "nlp/f/entity/wd:30",
    :salienceLevel "mention",
    :label "United States of America"}
   {:mentions [{:text "Boolean"}],
    :id "nlp/f/entity/wd:520777",
    :salienceLevel "mention",
    :label "Boolean data type"}
   {:mentions [{:text "Niels"}],
    :id "nlp/f/entity/wd:364751",
    :salienceLevel "mention",
    :label "Niels"}
   {:mentions [{:text "Colorado"}],
    :id "nlp/f/entity/wd:1261",
    :salienceLevel "mention",
    :label "Colorado"}],
  :alternate
  [{:href "https://lispcast.com/can-you-have-a-clean-domain-model/",
    :type "text/html"}],
  :title "Can you have a clean domain model?",
  :author "Eric Normand",
  :published-str "Sun Nov 10 22:00:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16e5945477b:139ac06:97b0c8f7",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url "https://i.ytimg.com/vi/p4GJ6ygZ04Q/mqdefault.jpg",
   :width 320,
   :height 180,
   :contentType "image/jpeg"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://lispcast.com/?p=2076",
  :commonTopics
  [{:score 43.375007709948555,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.738,
    :id "nlp/f/topic/1339",
    :salienceLevel "mention",
    :label "lifestyle"}],
  :published 1573452000000,
  :fingerprint "c9c7adc9",
  :canonicalUrl
  "https://lispcast.com/can-you-have-a-clean-domain-model/"}
 {:engagement 11,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1573308353721,
  :content
  {:content
   "<p>The Confluent JDBC Sink allows you to configure Kafka Connect to take\ncare of moving data reliably from Kafka to a relational database. Most\nof the usual suspects (e.g. PostgreSQL, MySQL, Oracle etc) are\nsupported out the box and in theory, you could connect your data to\nany database with a JDBC driver.</p>\n<p>This is great because Kafka Connect takes care of</p>\n<ul>\n<li>Splitting the job between a <a href=\"https://kafka.apache.org/documentation/#connect_connectorsandtasks\">configurable number of Tasks</a></li>\n<li>Keeping track of tasks’ progress using <a href=\"https://kafka.apache.org/documentation/#intro_consumers\">Kafka Consumer Groups</a></li>\n<li>Making the current status of workers available over an <a href=\"https://kafka.apache.org/documentation/#connect_rest\">HTTP API</a></li>\n<li>Publishing <a href=\"https://kafka.apache.org/documentation/#connect_monitoring\">metrics</a> that facilitate the monitoring of all connectors in\na standard way</li>\n</ul>\n<p>Assuming your infrastructure has an instance of Kafka Connect up and\nrunning, all you need to do as a user of this system is submit a JSON\nHTTP request to register a “job” and Kafka Connect will take care of\nthe rest.</p>\n<p>To make things concrete, imagine we’re implementing an event-driven\nbank and we have some process (or at scale, a collection of processes)\nthat keeps track of customer balances by applying a transaction\nlog. Each time a customer balance is updated for some transaction, a\nrecord is written to the customer-balances topic and we’d like to sink\nthis topic into a database table so that other systems can quickly\nlook up the current balance for some customer without having to apply\nall the transactions themselves.</p>\n<p>The configuration for such a sink might look something like this…</p>\n<figure><pre><code><span>{</span><span>\n</span><span>&quot;name&quot;</span><span>:</span><span> </span><span>&quot;customer-balances-sink&quot;</span><span>,</span><span>\n</span><span>&quot;connector.class&quot;</span><span>:</span><span> </span><span>&quot;io.confluent.connect.jdbc.JdbcSinkConnector&quot;</span><span>,</span><span>\n</span><span>&quot;table.name.format&quot;</span><span>:</span><span> </span><span>&quot;customer_balances&quot;</span><span>,</span><span>\n</span><span>&quot;connection.url&quot;</span><span>:</span><span> </span><span>&quot;jdbc:postgresql://DB_HOST:DB_PORT/DB_NAME&quot;</span><span>,</span><span>\n</span><span>&quot;connection.user&quot;</span><span>:</span><span> </span><span>&quot;DB_USER&quot;</span><span>,</span><span>\n</span><span>&quot;connection.password&quot;</span><span>:</span><span> </span><span>&quot;DB_PASSWORD&quot;</span><span>,</span><span>\n</span><span>&quot;key.converter&quot;</span><span>:</span><span> </span><span>&quot;org.apache.kafka.connect.storage.StringConverter&quot;</span><span>,</span><span>\n</span><span>&quot;value.converter&quot;</span><span>:</span><span> </span><span>&quot;io.confluent.connect.avro.AvroConverter&quot;</span><span>,</span><span>\n</span><span>&quot;value.converter.schema.registry.url&quot;</span><span>:</span><span> </span><span>&quot;SCHEMA_REGISTRY_URL&quot;</span><span>,</span><span>\n</span><span>&quot;topics&quot;</span><span>:</span><span> </span><span>&quot;customer-balances&quot;</span><span>,</span><span>\n</span><span>&quot;auto.create&quot;</span><span>:</span><span> </span><span>&quot;true&quot;</span><span>,</span><span>\n</span><span>&quot;auto.evolve&quot;</span><span>:</span><span> </span><span>&quot;true&quot;</span><span>,</span><span>\n</span><span>&quot;pk.mode&quot;</span><span>:</span><span> </span><span>&quot;record_value&quot;</span><span>,</span><span>\n</span><span>&quot;pk.fields&quot;</span><span>:</span><span> </span><span>&quot;customer_id&quot;</span><span>,</span><span>\n</span><span>&quot;fields.whitelist&quot;</span><span>:</span><span> </span><span>&quot;customer_id,current_balance,updated_at&quot;</span><span>,</span><span>\n</span><span>&quot;insert.mode&quot;</span><span>:</span><span> </span><span>&quot;upsert&quot;</span><span>,</span><span>\n</span><span>}</span></code></pre></figure>\n<p>It may be argued that since this is all just configuration, there is no\nneed for testing. Or if you try to test this, aren’t you just testing\nKafka Connect itself? I probably would have agreed with this sentiment until\nthe 2nd or 3rd time I had to reset the UAT environment after deploying a\nslightly incorrect kafka connect job.</p>\n<p>It is difficult to get these things perfectly correct first time and\nan error can be costly to fix even if they happen in a test\nenvironment (especially if the test environment is shared by other\ndevelopers and needs to be fixed or reset before trying again). For\nthis reason, it’s really nice to be able to quickly test it out in\nyour local environment and/or run some automated tests as part of your\ncontinuous integration flow before any code gets merged.</p>\n<p>So how <em>do</em> we test such a thing? Here’s a list of some of the steps we\ncould take. We could go further but this seems to catch most of the\nerrors that I’ve seen go wrong in practice.</p>\n<ul>\n<li>Create the “customer-balances” topic from which data will be fed\ninto the the sink</li>\n<li>Register the “customer-balance-sink” connector with a kafka-connect\ninstance provided by the test environment (and wait until it gets\ninto the “RUNNING” state)</li>\n<li>Generate some example records to load into the input topic</li>\n<li>Wait until the last of the generated records appears in the sink\ntable</li>\n<li>Check that all records written to the input topic made it into the\nsink table</li>\n</ul>\n<h2>Top-down, meet Bottom-up</h2>\n<p>As an aside, and to provide a bit of background to my thought\nprocesses, many years ago, I came across the web.py project by the\nlate Aaron Swartz. The philosophy for that framework was</p>\n<blockquote>\n<p>Think about the ideal way to write a web app. Write the code to make it happen.</p>\n<p>– Aaron Swartz (<a href=\"http://webpy.org/philosophy\">http://webpy.org/philosophy</a>)</p>\n</blockquote>\n<p>This was one of many things he wrote that has stuck with me over the\nyears and it always comes to mind whenever I’m attempting to solve a new problem.\nSo when I thought about “the ideal way to write a test for a kafka connect sink”,\nsomething like the following came to mind. This is the Top-down part of the\ndevelopment process.</p>\n<figure><pre><code><span>(</span><span>deftest</span><span> </span><span>^</span><span>:connect</span><span> </span><span>test-customer-balances</span><span>\n</span><span>(</span><span>test-jdbc-sink</span><span> </span><span>{</span><span>:connector-name</span><span> </span><span>&quot;customer-balances-sink&quot;</span><span>\n</span><span>:config</span><span> </span><span>(</span><span>config/load-config</span><span>)</span><span>\n</span><span>:topic</span><span> </span><span>&quot;customer-balances&quot;</span><span>\n</span><span>:spec</span><span> </span><span>::customer-balances</span><span>\n</span><span>:size</span><span> </span><span>2</span><span>\n</span><span>:poll-fn</span><span> </span><span>(</span><span>help/poll-table</span><span> </span><span>:customer-balances</span><span> </span><span>:customer-id</span><span>)</span><span>\n</span><span>:watch-fn</span><span> </span><span>(</span><span>help/found-last?</span><span> </span><span>:customer-balances</span><span> </span><span>:customer-id</span><span>)}</span><span>\n</span><span>(</span><span>comp</span><span>\n</span><span>(</span><span>help/table-counts?</span><span> </span><span>{</span><span>:customer-balances</span><span> </span><span>2</span><span>})</span><span>\n</span><span>(</span><span>help/table-columns?</span><span> </span><span>{</span><span>:customer-balances</span><span>\n</span><span>#</span><span>{</span><span>:customer-id</span><span>\n</span><span>:current-balance</span><span>\n</span><span>:updated-at</span><span>}}))))</span></code></pre></figure>\n<p>The first parameter to this function is simply a map that provides\ninformation to the test helper about things like</p>\n<ul>\n<li>How to identify the connector so that it can be found and loaded into the test environment</li>\n<li>Where to write the test data</li>\n<li>How to generate the test data (and how much test data to generate)</li>\n<li>How to find the data in the database after the connect job has loaded it\ninto the database</li>\n<li>How to decide when the all data has appeared in the sink</li>\n</ul>\n<p>The second parameter is a function that will be invoked with all the\ndata that has been collected by the test-machine journal during the\ntest run (specifically the generated seed data, and the data retrieved\nfrom the sink table by periodically polling the database with the\ntest-specific query defined by the <code>help/poll-table</code> helper).</p>\n<p>For this, we use regular functional composition to build a single\nassertion function from any number of single purpose assertion\nfunctions like <code>help/table-counts?</code> and <code>help/table-columns?</code>. Each\nassertion helper returns a function that receives the journal, runs\nsome assertions, and then returns the journal so that it may be\ncomposed with other helpers. If any new testing requirements are\nidentified they can be easily added independently of the existing\nassertion helpers.</p>\n<p>With these basic testing primitives in mind we now need to “write the\ncode to make it happen”. i.e. The Bottom-up part of the development\nprocess. With a bit of luck, they will meet in the middle.</p>\n<h2>Test Environment Additions</h2>\n<p>In addition to the base docker-compose config included in the\n<a href=\"https://grumpyhacker.com/test-machine-test-env/\">previous post</a>, we\nneed a couple of extra services. We can either put those in their own\nfile and combine the two compose files using the <code>-f</code> option of\ndocker-compose, or we can just bundle it all up into a single compose\nfile. Each option has it’s trade-offs. I don’t feel too strongly\neither way. Use whichever option fits best with your team’s workflow.\nThis will also depend on the particular database you use. We use PostgreSQL\nhere because it’s awesome.</p>\n<figure><pre><code><span>version</span><span>:</span> <span>'</span><span>3'</span>\n<span>services</span><span>:</span>\n  <span>connect</span><span>:</span>\n    <span>image</span><span>:</span> <span>confluentinc/cp-kafka-connect:5.1.0</span>\n    <span>expose</span><span>:</span>\n      <span>-</span> <span>&quot;</span><span>8083&quot;</span>\n    <span>ports</span><span>:</span>\n      <span>-</span> <span>&quot;</span><span>8083:8083&quot;</span>\n    <span>environment</span><span>:</span>\n      <span>KAFKA_HEAP_OPTS</span><span>:</span> <span>&quot;</span><span>-Xms256m</span><span> </span><span>-Xmx512m&quot;</span>\n      <span>CONNECT_REST_ADVERTISED_HOST_NAME</span><span>:</span> <span>connect</span>\n      <span>CONNECT_GROUP_ID</span><span>:</span> <span>jdbc-sink-test</span>\n      <span>CONNECT_BOOTSTRAP_SERVERS</span><span>:</span> <span>broker:9092</span>\n      <span>CONNECT_CONFIG_STORAGE_TOPIC</span><span>:</span> <span>docker-connect-configs</span>\n      <span>CONNECT_CONFIG_STORAGE_REPLICATION_FACTOR</span><span>:</span> <span>1</span>\n      <span>CONNECT_OFFSET_FLUSH_INTERVAL_MS</span><span>:</span> <span>10000</span>\n      <span>CONNECT_OFFSET_STORAGE_TOPIC</span><span>:</span> <span>docker-connect-offsets</span>\n      <span>CONNECT_OFFSET_STORAGE_REPLICATION_FACTOR</span><span>:</span> <span>1</span>\n      <span>CONNECT_STATUS_STORAGE_TOPIC</span><span>:</span> <span>docker-connect-status</span>\n      <span>CONNECT_STATUS_STORAGE_REPLICATION_FACTOR</span><span>:</span> <span>1</span>\n      <span>CONNECT_KEY_CONVERTER</span><span>:</span> <span>org.apache.kafka.connect.storage.StringConverter</span>\n      <span>CONNECT_VALUE_CONVERTER</span><span>:</span> <span>io.confluent.connect.avro.AvroConverter</span>\n      <span>CONNECT_VALUE_CONVERTER_SCHEMA_REGISTRY_URL</span><span>:</span> <span>http://schema-registry:8081</span>\n      <span>CONNECT_INTERNAL_KEY_CONVERTER</span><span>:</span> <span>&quot;</span><span>org.apache.kafka.connect.json.JsonConverter&quot;</span>\n      <span>CONNECT_INTERNAL_VALUE_CONVERTER</span><span>:</span> <span>&quot;</span><span>org.apache.kafka.connect.json.JsonConverter&quot;</span>\n      <span>CONNECT_ZOOKEEPER_CONNECT</span><span>:</span> <span>'</span><span>zookeeper:2181'</span>\n      <span>CONNECT_PLUGIN_PATH</span><span>:</span> <span>'</span><span>/usr/share/java'</span>\n\n  <span>pg</span><span>:</span>\n    <span>image</span><span>:</span> <span>postgres:9.5</span>\n    <span>ports</span><span>:</span>\n      <span>-</span> <span>&quot;</span><span>5432:5432&quot;</span>\n    <span>environment</span><span>:</span>\n      <span>-</span> <span>POSTGRES_PASSWORD=yolo</span>\n      <span>-</span> <span>POSTGRES_DB=jdbc_sink_test</span>\n      <span>-</span> <span>POSTGRES_USER=postgres</span></code></pre></figure>\n<h2>Implementing the Test Helpers</h2>\n<p>The test helpers are a collection of higher-order functions that\nallow the <code>test-jdbc-sink</code> function to pass control back to the test\nauthor in order to run test-specific tasks. Let’s look at those\nbefore delving into <code>test-jdbc-sink</code> itself which is a bit more\ninvolved. The helpers are all fairly straight-forward so hopefully\nthe docstrings will be enough to understand what’s going on.</p>\n<figure><pre><code><span>(</span><span>defn</span><span> </span><span>poll-table</span><span>\n</span><span>&quot;Returns a function that will be periodically executed by the `test-connector`\nto fetch data from the sink table. The returned function is invoked with the\ngenerated seed-data as a parameter so that it can ignore any data added by\ndifferent test runs.&quot;</span><span>\n</span><span>[</span><span>table-name</span><span> </span><span>key-name</span><span>]</span><span>\n</span><span>(</span><span>fn</span><span> </span><span>[</span><span>seed-data</span><span> </span><span>db</span><span>]</span><span>\n</span><span>(</span><span>let</span><span> </span><span>[</span><span>result</span><span> </span><span>(</span><span>let</span><span> </span><span>[</span><span>query</span><span> </span><span>(</span><span>format</span><span> </span><span>&quot;select *\nfrom %s\nwhere %s in (%s)&quot;</span><span>\n</span><span>(</span><span>if</span><span> </span><span>(</span><span>keyword?</span><span> </span><span>table-name</span><span>)</span><span>\n</span><span>(</span><span>underscore</span><span> </span><span>table-name</span><span>)</span><span>\n</span><span>(</span><span>format</span><span> </span><span>&quot;\\&quot;%s\\&quot;&quot;</span><span> </span><span>table-name</span><span>))</span><span>\n</span><span>(</span><span>if</span><span> </span><span>(</span><span>keyword?</span><span> </span><span>key-name</span><span>)</span><span>\n</span><span>(</span><span>underscore</span><span> </span><span>key-name</span><span>)</span><span>\n</span><span>(</span><span>format</span><span> </span><span>&quot;\\&quot;%s\\&quot;&quot;</span><span> </span><span>key-name</span><span>))</span><span>\n</span><span>(</span><span>->></span><span> </span><span>seed-data</span><span>\n</span><span>(</span><span>map</span><span> </span><span>key-name</span><span>)</span><span>\n</span><span>(</span><span>map</span><span> </span><span>#</span><span>(</span><span>format</span><span> </span><span>&quot;'%s'&quot;</span><span> </span><span>%</span><span>))</span><span>\n</span><span>(</span><span>string/join</span><span> </span><span>&quot;,&quot;</span><span>)))]</span><span>\n</span><span>(</span><span>try</span><span>\n</span><span>(</span><span>jdbc/query</span><span> </span><span>db</span><span> </span><span>query</span><span> </span><span>{</span><span>:identifiers</span><span> </span><span>hyphenate</span><span>})</span><span>\n</span><span>(</span><span>catch</span><span> </span><span>Exception</span><span> </span><span>e</span><span>\n</span><span>(</span><span>log/error</span><span> </span><span>&quot;failed: &quot;</span><span> </span><span>query</span><span>))))]</span><span>\n</span><span>(</span><span>log/info</span><span> </span><span>(</span><span>format</span><span> </span><span>&quot;%s rows: %s&quot;</span><span> </span><span>table-name</span><span> </span><span>(</span><span>count</span><span> </span><span>result</span><span>)))</span><span>\n</span><span>result</span><span>)))</span><span>\n</span><span>(</span><span>defn</span><span> </span><span>found-last?</span><span>\n</span><span>&quot;Builds a watch function that is invoked whenever the test-machine journal\nis updated (the journal is updated whenever the poll function successfully finds\ndata). When the watch function returns `true`, that denotes the completion of\nthe test and the current state of the journal is passed to the test assertion\nfunction&quot;</span><span>\n</span><span>[</span><span>table-name</span><span> </span><span>key-name</span><span>]</span><span>\n</span><span>(</span><span>fn</span><span> </span><span>[</span><span>seed-data</span><span> </span><span>journal</span><span>]</span><span>\n</span><span>(</span><span>let</span><span> </span><span>[</span><span>last-id</span><span> </span><span>(</span><span>:id</span><span> </span><span>(</span><span>last</span><span> </span><span>seed-data</span><span>))]</span><span>\n</span><span>(</span><span>->></span><span> </span><span>(</span><span>get-in</span><span> </span><span>journal</span><span> </span><span>[</span><span>:tables</span><span> </span><span>table-name</span><span>])</span><span>\n</span><span>(</span><span>filter</span><span> </span><span>#</span><span>(</span><span>=</span><span> </span><span>last-id</span><span> </span><span>(</span><span>:id</span><span> </span><span>%</span><span>)))</span><span>\n</span><span>first</span><span>\n</span><span>not-empty</span><span>))))</span><span>\n</span><span>(</span><span>defn</span><span> </span><span>table-counts?</span><span>\n</span><span>&quot;Builds an assertion function that checks whether the journal contains\nthe expected number of records in the specified table. `m` is a map\nof table-ids to expected counts. The returned function returns the\njournal so that it can be composed with other assertion functions&quot;</span><span>\n</span><span>[</span><span>m</span><span>]</span><span>\n</span><span>(</span><span>fn</span><span> </span><span>[</span><span>journal</span><span>]</span><span>\n</span><span>(</span><span>doseq</span><span> </span><span>[[</span><span>k</span><span> </span><span>exp-count</span><span>]</span><span> </span><span>m</span><span>]</span><span>\n</span><span>(</span><span>testing</span><span> </span><span>(</span><span>format</span><span> </span><span>&quot;count %s&quot;</span><span> </span><span>k</span><span>)</span><span>\n</span><span>(</span><span>is</span><span> </span><span>(</span><span>=</span><span> </span><span>exp-count</span><span> </span><span>(</span><span>-></span><span> </span><span>(</span><span>get-in</span><span> </span><span>journal</span><span> </span><span>[</span><span>:tables</span><span> </span><span>k</span><span>])</span><span>\n</span><span>count</span><span>)))))</span><span>\n</span><span>journal</span><span>))</span><span>\n</span><span>(</span><span>defn</span><span> </span><span>table-columns?</span><span>\n</span><span>&quot;Builds an assertion function that checks whether the sink tables logged in\ntest-machine journal contain the expected columns&quot;</span><span>\n</span><span>[</span><span>m</span><span>]</span><span>\n</span><span>(</span><span>fn</span><span> </span><span>[</span><span>journal</span><span>]</span><span>\n</span><span>(</span><span>doseq</span><span> </span><span>[[</span><span>k</span><span> </span><span>field-set</span><span>]</span><span> </span><span>m</span><span>]</span><span>\n</span><span>(</span><span>testing</span><span> </span><span>(</span><span>format</span><span> </span><span>&quot;table %s has columns %s&quot;</span><span>\n</span><span>k</span><span> </span><span>field-set</span><span>)</span><span>\n</span><span>(</span><span>is</span><span> </span><span>(</span><span>=</span><span> </span><span>field-set</span><span>\n</span><span>(</span><span>->></span><span> </span><span>(</span><span>get-in</span><span> </span><span>journal</span><span> </span><span>[</span><span>:tables</span><span> </span><span>k</span><span>])</span><span>\n</span><span>last</span><span>\n</span><span>keys</span><span>\n</span><span>set</span><span>)))))</span><span>\n</span><span>journal</span><span>))</span><span>\n</span><span>(</span><span>defn-</span><span> </span><span>load-seed-data</span><span>\n</span><span>&quot;This is where we actually use the test-machine. We use the seed-data to generate\na list of :write! commands, and just tack on a :watch command at the end that uses\nthe `watch-fn` provided by the test-author. When the watch function is satisfied,\nthis will return the test-machine journal that has been collecting data produced\nby the poller which we can then use as part of our test assertions&quot;</span><span>\n</span><span>[</span><span>machine</span><span> </span><span>topic-id</span><span> </span><span>seed-data</span><span>\n</span><span>{</span><span>:keys</span><span> </span><span>[</span><span>key-fn</span><span> </span><span>watch-fn</span><span>]</span><span>\n</span><span>:or</span><span> </span><span>{</span><span>key-fn</span><span> </span><span>:id</span><span>}}]</span><span>\n</span><span>(</span><span>jdt/run-test</span><span> </span><span>machine</span><span> </span><span>(</span><span>concat</span><span>\n</span><span>(</span><span>->></span><span> </span><span>seed-data</span><span>\n</span><span>(</span><span>map</span><span> </span><span>(</span><span>fn</span><span> </span><span>[</span><span>record</span><span>]</span><span>\n</span><span>[</span><span>:write!</span><span> </span><span>topic-id</span><span> </span><span>record</span><span> </span><span>{</span><span>:key-fn</span><span> </span><span>key-fn</span><span>}])))</span><span>\n</span><span>[[</span><span>:watch</span><span> </span><span>watch-fn</span><span> </span><span>{</span><span>:timeout</span><span> </span><span>5000</span><span>}]])))</span><span>\t</span></code></pre></figure>\n<p>Finally, here is the annotated code for <code>test-jdbc-sink</code>. This has not yet\nbeen properly extracted from the project which uses these tests so it\ncontains a bit of accidental complexity but hopefully I’ll be able to get\nsome version of this into jackdaw soon. In the meantime I’m hoping it serves\nas a nice bit of documentation for using the test-machine outside of contrived\nexamples.</p>\n<figure><pre><code><span>(</span><span>defn</span><span> </span><span>test-jdbc-sink</span><span>\n</span><span>{</span><span>:style/indent</span><span> </span><span>1</span><span>}</span><span>\n</span><span>[{</span><span>:keys</span><span> </span><span>[</span><span>connector-name</span><span> </span><span>config</span><span> </span><span>topic</span><span> </span><span>spec</span><span> </span><span>size</span><span> </span><span>watch-fn</span><span> </span><span>poll-fn</span><span> </span><span>key-fn</span><span>]}</span><span> </span><span>test-fn</span><span>]</span><span>\n</span><span>;; `config` is a global config map loaded from an EDN file. We fetch the</span><span>\n</span><span>;; configured schema-registry url and create a schema-registry-client and assign</span><span>\n</span><span>;; them to dynamic variables which are used when &quot;resolving&quot; the avro serdes that</span><span>\n</span><span>;; are to be associated with the input topic</span><span>\n</span><span>(</span><span>binding</span><span> </span><span>[</span><span>t/*schema-registry-url*</span><span> </span><span>(</span><span>get-in</span><span> </span><span>config</span><span> </span><span>[</span><span>:schema-registry</span><span> </span><span>:url</span><span>])</span><span>\n</span><span>t/*schema-registry-client*</span><span> </span><span>(</span><span>reg/client</span><span> </span><span>(</span><span>get-in</span><span> </span><span>config</span><span> </span><span>[</span><span>:schema-registry</span><span> </span><span>:url</span><span>])</span><span> </span><span>100</span><span>)]</span><span>\n</span><span>;; You may have noticed in the JSON configuration above that there were placeholders for</span><span>\n</span><span>;; database paramters (e.g. DB_USER, DB_NAME etc). These are expanded using a &quot;mustache&quot;</span><span>\n</span><span>;; template language renderer. That's all `load-connector` is doing here</span><span>\n</span><span>(</span><span>let</span><span> </span><span>[</span><span>connector</span><span> </span><span>(</span><span>load-connector</span><span> </span><span>config</span><span> </span><span>connector-name</span><span>)</span><span>\n</span><span>;; `spec` represents a clojure.spec &quot;entity map&quot;</span><span>\n</span><span>seed-data</span><span> </span><span>(</span><span>gen/sample</span><span> </span><span>(</span><span>s/gen</span><span> </span><span>spec</span><span>)</span><span> </span><span>size</span><span>)</span><span>\n</span><span>;; `topic-config` takes the topic specified as a string, and finds the corresponding</span><span>\n</span><span>;; topic-metadata in the project configuration. topic-metadata is where we specify things</span><span>\n</span><span>;; like how to create a topic, how to serialize a record, how to generate a key from</span><span>\n</span><span>;; a record value</span><span>\n</span><span>topics</span><span> </span><span>(</span><span>topic-config</span><span> </span><span>topic</span><span>)</span><span>\n</span><span>;; `topic-id` is just a symbolic id representing the topic</span><span>\n</span><span>topic-id</span><span> </span><span>(</span><span>-></span><span> </span><span>topics</span><span>\n</span><span>keys</span><span>\n</span><span>first</span><span>)</span><span>\n</span><span>;; here we fetch the name of the sink table from the connector config</span><span>\n</span><span>sink-table</span><span> </span><span>(</span><span>-></span><span> </span><span>(</span><span>get</span><span> </span><span>connector</span><span> </span><span>&quot;table.name.format&quot;</span><span>)</span><span>\n</span><span>hyphenate</span><span>\n</span><span>keyword</span><span>)</span><span>\n</span><span>;; the kafka-config tells us where the kafka bootstrap.servers are. This is required</span><span>\n</span><span>;; to connect to kafka in order to create the test topic and write our example test</span><span>\n</span><span>;; data</span><span>\n</span><span>kconfig</span><span> </span><span>(</span><span>kafka-config</span><span> </span><span>config</span><span>)]</span><span>\n</span><span>;; This is just the standard way to acquire a jdbc connection in Clojure. We're getting</span><span>\n</span><span>;; the connection parameters from the same global project config we got the schema-registry</span><span>\n</span><span>;; parameters from</span><span>\n</span><span>(</span><span>jdbc/with-db-connection</span><span> </span><span>[</span><span>db</span><span> </span><span>{</span><span>:dbtype</span><span> </span><span>&quot;postgresql&quot;</span><span>\n</span><span>:dbname</span><span> </span><span>(</span><span>get-in</span><span> </span><span>config</span><span> </span><span>[</span><span>:jdbc-sink-db</span><span> </span><span>:name</span><span>])</span><span>\n</span><span>:host</span><span> </span><span>&quot;localhost&quot;</span><span>\n</span><span>:port</span><span> </span><span>(</span><span>get-in</span><span> </span><span>config</span><span> </span><span>[</span><span>:jdbc-sink-db</span><span> </span><span>:port</span><span>])</span><span>\n</span><span>:user</span><span> </span><span>(</span><span>get-in</span><span> </span><span>config</span><span> </span><span>[</span><span>:jdbc-sink-db</span><span> </span><span>:username</span><span>])</span><span>\n</span><span>:password</span><span> </span><span>(</span><span>get-in</span><span> </span><span>config</span><span> </span><span>[</span><span>:jdbc-sink-db</span><span> </span><span>:password</span><span>])}]</span><span>\n</span><span>;; `with-fixtures` is one of the few macros used. It takes a vector of fixtures each of</span><span>\n</span><span>;; which is a function that performs some setup before invoking a test function. The</span><span>\n</span><span>;; test function ends up being defined by the body of the macro. The fixtures here</span><span>\n</span><span>;; create the test topic, wait for kafka-connect to be up and running (important when</span><span>\n</span><span>;; the tests are running in CircleCI immediately after starting kafka-connect), then</span><span>\n</span><span>;; load the connector, </span><span>\n</span><span>(</span><span>fix/with-fixtures</span><span> </span><span>[(</span><span>fix/topic-fixture</span><span> </span><span>kconfig</span><span> </span><span>topics</span><span>)</span><span>\n</span><span>(</span><span>fix/service-ready?</span><span> </span><span>{</span><span>:http-url</span><span> </span><span>&quot;http://localhost:8083&quot;</span><span>})</span><span>\n</span><span>(</span><span>tfx/connector-fixture</span><span> </span><span>{</span><span>:base-url</span><span> </span><span>&quot;http://localhost:8083&quot;</span><span>\n</span><span>:connector</span><span> </span><span>{</span><span>&quot;config&quot;</span><span> </span><span>connector</span><span>}})]</span><span>\n</span><span>;; Finally we acquire a test-machine using the kafka-config and the topic-metadata we</span><span>\n</span><span>;; derived earlier. This will be used to write the test data and record the results</span><span>\n</span><span>;; of polling the target table</span><span>\n</span><span>(</span><span>jdt/with-test-machine</span><span> </span><span>(</span><span>jdt/kafka-transport</span><span> </span><span>kconfig</span><span> </span><span>topics</span><span>)</span><span>\n</span><span>(</span><span>fn</span><span> </span><span>[</span><span>machine</span><span>]</span><span>\n</span><span>;; Before writing any test-data, we setup the db-poller. This uses Zach Tellman's</span><span>\n</span><span>;; manifold to periodically invoke the supplied function on a fixed pool of threads.</span><span>\n</span><span>;; The `poll-fn` is actually provided as a parameter to `test-connector` so at this</span><span>\n</span><span>;; point we're passing control back to the caller. They need to provide a polling</span><span>\n</span><span>;; function that takes the seed-data we generated, and the db handle, and execute</span><span>\n</span><span>;; a query that will find the records that correspond with the seed data. We take</span><span>\n</span><span>;; the result, and put it in the test-machine journal which will make it available</span><span>\n</span><span>;; to both the `watch-fn` and the test assertions.</span><span>\n</span><span>(</span><span>let</span><span> </span><span>[</span><span>db-poller</span><span> </span><span>(</span><span>mt/every</span><span> </span><span>1000</span><span>\n</span><span>(</span><span>fn</span><span> </span><span>[]</span><span>\n</span><span>(</span><span>let</span><span> </span><span>[</span><span>poll-result</span><span> </span><span>(</span><span>poll-fn</span><span> </span><span>seed-data</span><span> </span><span>db</span><span>)]</span><span>\n</span><span>(</span><span>send</span><span> </span><span>(</span><span>:journal</span><span> </span><span>machine</span><span>)</span><span>\n</span><span>(</span><span>fn</span><span> </span><span>[</span><span>journal</span><span> </span><span>poll-data</span><span>]</span><span>\n</span><span>(</span><span>assoc-in</span><span> </span><span>journal</span><span> </span><span>[</span><span>:tables</span><span> </span><span>sink-table</span><span>]</span><span> </span><span>poll-data</span><span>))</span><span>\n</span><span>poll-result</span><span>))))]</span><span>\n</span><span>(</span><span>try</span><span>\n</span><span>;; All that's left now is to write the example data to the input topic and</span><span>\n</span><span>;; wait for it to appear in the sink table. That's what `load-seed-data` does.</span><span>\n</span><span>;; Note how again we're handing control back to the test author by using their</span><span>\n</span><span>;; `watch-fn` (again passing in the seed data we generated for them so they can</span><span>\n</span><span>;; figure out what to watch for).</span><span>\n</span><span>(</span><span>log/info</span><span> </span><span>&quot;load seed data&quot;</span><span> </span><span>(</span><span>map</span><span> </span><span>:id</span><span> </span><span>seed-data</span><span>))</span><span>\n</span><span>(</span><span>load-seed-data</span><span> </span><span>machine</span><span> </span><span>topic-id</span><span> </span><span>seed-data</span><span>\n</span><span>{</span><span>:key-fn</span><span> </span><span>key-fn</span><span>\n</span><span>:watch-fn</span><span> </span><span>(</span><span>partial</span><span> </span><span>watch-fn</span><span> </span><span>seed-data</span><span>)})</span><span>\n</span><span>;; Now the test-machine journal contains all the data we need to verify that the</span><span>\n</span><span>;; the connector is working as expected. So we just pass the current state of the</span><span>\n</span><span>;; journal to the `test-fn` which is expected to run some test assertions against</span><span>\n</span><span>;; the data</span><span>\n</span><span>(</span><span>test-fn</span><span> </span><span>@</span><span>(</span><span>:journal</span><span> </span><span>machine</span><span>))</span><span>\n</span><span>(</span><span>finally</span><span>\n</span><span>;; Manifold's `manifold.time/every` returns a function that can be invoked in</span><span>\n</span><span>;; the finally clause to cancel the polling operation when the test is finished</span><span>\n</span><span>;; regardless of what happens during the test</span><span>\n</span><span>(</span><span>db-poller</span><span>)))))))))))</span></code></pre></figure>\n<p>And that’s it for now! Thanks for reading. Look forward to hearing\nyour thoughts and questions about this on Twitter. I tried to keep it\nas short as possible so let me know if there’s anything I glossed over\nwhich you’d like to see explained in more detail in subsequent posts.</p>",
   :direction "ltr"},
  :updated 1573171200000,
  :entities
  [{:mentions [{:text "JDBC"}],
    :id "nlp/f/entity/wd:722772",
    :salienceLevel "about",
    :label "Java Database Connectivity"}
   {:mentions [{:text "PostgreSQL"}],
    :id "nlp/f/entity/wd:192490",
    :salienceLevel "mention",
    :label "PostgreSQL"}
   {:mentions [{:text "Aaron Swartz"}],
    :id "nlp/f/entity/wd:302817",
    :salienceLevel "mention",
    :label "Aaron Swartz"}
   {:mentions [{:text "JSON"}],
    :id "nlp/f/entity/wd:2063",
    :salienceLevel "mention",
    :label "JavaScript Object Notation"}
   {:mentions [{:text "transaction log"}],
    :id "nlp/f/entity/wd:948454",
    :salienceLevel "mention",
    :label "transaction log"}],
  :alternate
  [{:href "https://grumpyhacker.com/test-machine-test-jdbc-sink/",
    :type "text/html"}],
  :title "A Test Helper for JDBC Sinks",
  :author "Andy Chambers",
  :published-str "Thu Nov 07 16:00:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16e507c4cb9:aa7bd2:69b9f616",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://grumpyhacker.com/test-machine-test-jdbc-sink",
  :commonTopics
  [{:score 34.71611990646867,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.974,
    :id "nlp/f/topic/1430",
    :salienceLevel "about",
    :label "medical devices"}
   {:score 0.867,
    :id "nlp/f/topic/2148",
    :salienceLevel "about",
    :label "spiritual"}],
  :published 1573171200000,
  :fingerprint "5ee04b47",
  :canonicalUrl
  "https://grumpyhacker.com/test-machine-test-jdbc-sink/"}
 {:engagement 12,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1573297090097,
  :content
  {:content
   "<p>In <a href=\"https://www.confluent.io/blog/testing-event-driven-systems\">Testing Event Driven\nSystems</a>,\nI introduced the test-machine, (a Clojure library for testing kafka\napplications) and included a simple example for demonstration\npurposes. I made the claim that however your system is implemented, as\nlong as its input and output can be represented in Kafka, the\ntest-machine would be an effective tool for testing it. Now we’ve had\nsome time to put that claim to the…ahem test, I thought it might be\ninteresting to explore some actual use-cases in a bit more detail.</p>\n<p>Having spent a year or so of using the test-machine, I can now say\nwith increased confidence that it is an effective tool for\ntesting a variety of Kafka based systems. However with the benefit of\nexperience, I’d add that you might want to define your own domain\nspecific layer of helper functions on top so that your tests may bear\nsome resemblance to the discussion that happens in your sprint\nplanning meetings. The raw events represent a layer beneath what we\ntypically discuss with product owners.</p>\n<p>Hopefully the use-cases described in this forthcoming mini-series\nwill help clarify this concept and get you thinking about\nhow you might be able to apply the test-machine to solve your own\ntesting problems.</p>\n<p>Before getting into the actual use-cases though, let’s get a test environment\nsetup so we can quickly run experiments locally without having to deploy\nour code to a shared testing environment.</p>\n<h2>Service Composition</h2>\n<p>For each of these tests, we’ll be using docker-compose to setup the\ntest environment. There are other ways of providing a test-environment\nbut the nice thing about docker-compose is that when things go awry\nyou can blow away all test state and start again with a clean\nenvironment. This makes the process of acquiring a test-environment\n<em>repeatable</em>, and at least after the first time you do it, pretty\nfast. On my machine, <code>docker-compose down &amp;&amp; docker-compose up -d</code>\ndoesn’t usually take more than 5-10 seconds or so. If you have not\nused the confluent images before, it might take a while to download\nthe images if you’re not on the end of a fat internet pipe.</p>\n<p>Ideally you should be able to run your tests against a\ntest-environment with existing data. Your tests should create all the\ndata they need themselves and ignore any data that has been already\nentered so acquiring a fresh test environment is not something you\nshould be doing for each test-run. Sometimes while developing a test,\nit can help avoid confusing behavior to have a completely clean environment\nbut I wouldn’t consider the test to be complete until it can be run\nagainst a test environment with old data.</p>\n<p>Below is a base docker-compose file containing the core services from\nConfluent that will be required to run these tests. Depending on what’s being\ntested, we will need additional services to fully exercise the system\nunder test. The configuration choices are made with a view to minimizing\nthe memory required by the collection of services. This is tailored\nfor the use-case of running small tests on a local laptop that\ntypically has zoom, firefox and chrome all clamoring for their share\nof RAM. It is not intended for production workloads.</p>\n<figure><pre><code><span>version</span><span>:</span> <span>'</span><span>3'</span>\n<span>services</span><span>:</span>\n  <span>zookeeper</span><span>:</span>\n    <span>image</span><span>:</span> <span>confluentinc/cp-zookeeper:5.1.0</span>\n    <span>expose</span><span>:</span>\n      <span>-</span> <span>&quot;</span><span>2181&quot;</span>\n    <span>ports</span><span>:</span>\n      <span>-</span> <span>&quot;</span><span>2181:2181&quot;</span>\n    <span>environment</span><span>:</span>\n      <span>KAFKA_OPTS</span><span>:</span> <span>'</span><span>-Xms256m</span><span> </span><span>-Xmx256m'</span>\n      <span>ZOOKEEPER_CLIENT_PORT</span><span>:</span> <span>2181</span>\n      <span>ZOOKEEPER_TICK_TIME</span><span>:</span> <span>2000</span>\n\n  <span>broker</span><span>:</span>\n    <span>image</span><span>:</span> <span>confluentinc/cp-kafka:5.1.0</span>\n    <span>depends_on</span><span>:</span>\n      <span>-</span> <span>zookeeper</span>\n    <span>expose</span><span>:</span>\n      <span>-</span> <span>&quot;</span><span>9092&quot;</span>\n    <span>ports</span><span>:</span>\n      <span>-</span> <span>&quot;</span><span>9092:9092&quot;</span>\n      <span>-</span> <span>&quot;</span><span>19092:19092&quot;</span>\n    <span>environment</span><span>:</span>\n      <span>KAFKA_BROKER_ID</span><span>:</span> <span>1</span>\n      <span>KAFKA_ZOOKEEPER_CONNECT</span><span>:</span> <span>'</span><span>zookeeper:2181'</span>\n      <span>KAFKA_LISTENER_SECURITY_PROTOCOL_MAP</span><span>:</span> <span>PLAINTEXT:PLAINTEXT,PLAINTEXT_HOST:PLAINTEXT</span>\n      <span>KAFKA_ADVERTISED_LISTENERS</span><span>:</span> <span>PLAINTEXT://broker:9092,PLAINTEXT_HOST://localhost:19092</span>\n      <span>KAFKA_ADVERTISED_HOST_NAME</span><span>:</span> <span>localhost</span>\n      <span>KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR</span><span>:</span> <span>1</span>\n      <span>KAFKA_GROUP_INITIAL_REBALANCE_DELAY_MS</span><span>:</span> <span>0</span>\n      <span>KAFKA_TRANSACTION_STATE_LOG_REPLICATION_FACTOR</span><span>:</span> <span>1</span>\n      <span>KAFKA_AUTO_CREATE_TOPICS_ENABLE</span><span>:</span> <span>&quot;</span><span>false&quot;</span>\n      <span>KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR</span><span>:</span> <span>1</span>\n      <span>KAFKA_OFFSETS_TOPIC_NUM_PARTITIONS</span><span>:</span> <span>1</span>\n      <span>KAFKA_OPTS</span><span>:</span> <span>'</span><span>-Xms256m</span><span> </span><span>-Xmx256m'</span>\n      <span>KAFKA_TRANSACTION_STATE_LOG_REPLICATION_FACTOR</span><span>:</span> <span>1</span>\n      <span>KAFKA_TRANSACTION_STATE_LOG_MIN_ISR</span><span>:</span> <span>1</span>\n      <span>KAFKA_AUTO_OFFSET_RESET</span><span>:</span> <span>&quot;</span><span>latest&quot;</span>\n      <span>KAFKA_ENABLE_AUTO_COMMIT</span><span>:</span> <span>&quot;</span><span>false&quot;</span>\n\n  <span>schema-registry</span><span>:</span>\n    <span>image</span><span>:</span> <span>confluentinc/cp-schema-registry:5.1.0</span>\n    <span>depends_on</span><span>:</span>\n      <span>-</span> <span>zookeeper</span>\n      <span>-</span> <span>broker</span>\n    <span>expose</span><span>:</span>\n      <span>-</span> <span>&quot;</span><span>8081&quot;</span>\n    <span>ports</span><span>:</span>\n      <span>-</span> <span>&quot;</span><span>8081:8081&quot;</span>\n    <span>environment</span><span>:</span>\n      <span>KAFKA_OPTS</span><span>:</span> <span>'</span><span>-Xms256m</span><span> </span><span>-Xmx256m'</span>\n      <span>SCHEMA_REGISTRY_HOST_NAME</span><span>:</span> <span>schema-registry</span>\n      <span>SCHEMA_REGISTRY_KAFKASTORE_CONNECTION_URL</span><span>:</span> <span>'</span><span>zookeeper:2181'</span></code></pre></figure>\n<h2>Test Environment Healthchecks</h2>\n<p>It’s always a good idea to make sure the composition of services is\nbehaving as expected before trying to write tests against\nthem. Otherwise you might spend hours scratching your head wondering\nwhy your system isn’t working when the problem is actually\nmis-configuration of the test environment.</p>\n<p>The most basic health-check you can do is to run <code>docker-compose ps</code>. This\nwill show at least that the services came up without exiting\nimmediately due to mis-configuration. In the happy case, the state of\nall services should be “Up”. This command also shows which ports are\nexposed by each service which will be important information when it comes\nto configuring the system under test.</p>\n<p><img alt=\"docker-compose ps\" src=\"https://grumpyhacker.com/images/docker-compose-ps.png\"></p>\n<h3>Accessing the logs</h3>\n<p>When something goes wrong there is often a clue in the logs although it\nwill take a bit of experience with them before you’ll know what to look\nfor. Familiarizing yourself with them will payoff eventually though\nboth in “dev mode” when you’re trying to figure out why the code you’re\nwriting doesn’t work, and also in “ops mode” when you’re trying to\nfigure out what’s gone wrong in a deployed system. Getting access to\nthem in the test environment described here is the same as any other\ndocker-compose based system. The snippets below demonstrate a few of\nthe common use-cases and the full documentation is available\nat <a href=\"https://docs.docker.com/compose/reference/logs/\">docs.docker.com</a></p>\n<figure><pre><code><span># get all the logs</span>\n<span>$ </span>docker-compose logs\n\n<span># get just the broker logs</span>\n<span>$ </span>docker-compose logs broker\n\n<span># get the schema-registry logs and print more as they appear</span>\n<span>$ </span>docker-compose logs <span>-f</span> schema-registry</code></pre></figure>\n<h3>Testing Connectivity</h3>\n<p>Another diagnostic tool that helps when debugging connectivity\nissues is telnet. Experienced engineers will probably know this already\nbut for example, to ensure that you can reach kafka from your system under\ntest (assuming the system you’re testing runs on the host OS), you can try\nto reach the port exposed by the docker-compose configuration.</p>\n<figure><pre><code>telnet localhost 19092</code></pre></figure>\n<p>If the problem is more gnarly than basic connectivity issues, then Julia Evans’\n<a href=\"https://jvns.ca/debugging-zine.pdf\">debugging zine</a> contains very useful advice\nabout debugging <em>any</em> problem you have with Linux based systems.</p>\n<p>That’s all for now. In the next article, I’ll use this test environment\ntogether with the <a href=\"https://github.com/FundingCircle/jackdaw/blob/master/doc/test-machine.md\">test-machine</a>\nlibrary to build a helper function for testing Kafka Connect JDBC Sinks.</p>",
   :direction "ltr"},
  :updated 1573084800000,
  :entities
  [{:mentions [{:text "mini-series"}],
    :id "nlp/f/entity/wd:1259759",
    :salienceLevel "mention",
    :label "miniseries"}
   {:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "Linux"}],
    :id "nlp/f/entity/wd:388",
    :salienceLevel "mention",
    :label "Linux"}
   {:mentions [{:text "RAM"}],
    :id "nlp/f/entity/wd:5295",
    :salienceLevel "mention",
    :label "random-access memory"}
   {:mentions [{:text "JDBC"}],
    :id "nlp/f/entity/wd:722772",
    :salienceLevel "mention",
    :label "Java Database Connectivity"}],
  :alternate
  [{:href "https://grumpyhacker.com/test-machine-test-env/",
    :type "text/html"}],
  :title "A Test Environment for Kafka Applications",
  :author "Andy Chambers",
  :published-str "Wed Nov 06 16:00:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16e4fd06e31:a3b251:49b12733",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url "https://grumpyhacker.com/images/docker-compose-ps.png",
   :width 1730,
   :height 242,
   :contentType "image/png"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://grumpyhacker.com/test-machine-test-env",
  :commonTopics
  [{:score 52.18753299885937,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.842,
    :id "nlp/f/topic/1430",
    :salienceLevel "mention",
    :label "medical devices"}],
  :published 1573084800000,
  :fingerprint "be47a3bb",
  :canonicalUrl "https://grumpyhacker.com/test-machine-test-env/"}
 {:engagement 6,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1573246638670,
  :content
  {:content
   "<p>Each week, we discuss a different topic about Clojure and functional programming.</p>\n<p>If you have a question or topic you’d like us to discuss, tweet <a href=\"https://twitter.com/clojuredesign\">@clojuredesign</a>, send an email to <a href=\"mailto:feedback@clojuredesign.club\">feedback@clojuredesign.club</a>, or join the <code>#clojuredesign-podcast</code> channel on the <a href=\"http://clojurians.net/\">Clojurians Slack</a>.</p>\n<p>This week, the topic is: <strong>“Working with heavily nested trees.”</strong> We discuss three powerful libraries (Specter, Spectacles, and clojure.walk) and where they might fit into our Clojure programs.</p>\n<p>Selected quotes:</p>\n<ul>\n<li>“Tree manipulation is like surgery, you need to get down to the right level before you start making changes.”</li>\n<li>“I’ve seen people come up with novel and interesting solutions to problems that other people just don’t have.”</li>\n<li>“Spec is a structural type checker, instead of a name-based type checker, which is far more useful.”</li>\n<li>“Every time you reach for a tool, you’re inviting its complexity into your project.”</li>\n<li>“The structure of your data will lead you toward a particular tool.”</li>\n</ul>\n<p>Related episodes:</p>\n<ul>\n<li><a href=\"https://clojuredesign.club/episode/020-data-dessert\">020: Data Dessert</a> - Summary episode for the time log series</li>\n</ul>\n<p>Links:</p>\n<ul>\n<li><a href=\"https://clojuredocs.org/clojure.walk\">clojure.walk</a></li>\n<li><a href=\"https://github.com/redplanetlabs/specter\">Specter</a></li>\n<li><a href=\"https://github.com/stathissideris/spectacles\">Spectacles</a></li>\n</ul>",
   :direction "ltr"},
  :updated 1573225200000,
  :entities
  [{:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "about",
    :label "Clojure"}
   {:mentions [{:text "functional programming"}],
    :id "nlp/f/entity/wd:193076",
    :salienceLevel "about",
    :label "functional programming"}],
  :alternate
  [{:href
    "https://clojuredesign.club/episode/054-the-forest-in-the-trees/",
    :type "text/html"}],
  :title "Ep 054: The Forest in the Trees",
  :author "Christoph Neumann and Nate Jones",
  :published-str "Fri Nov 08 07:00:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16e4cce9a4e:70915b:97b0c8f7",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://clojuredesign.club/episode/054-the-forest-in-the-trees/",
  :commonTopics
  [{:score 22.98191341459227,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.943,
    :id "nlp/f/topic/349",
    :salienceLevel "about",
    :label "business"}],
  :published 1573225200000,
  :fingerprint "8e965d7f",
  :canonicalUrl
  "https://clojuredesign.club/episode/054-the-forest-in-the-trees/"}
 {:unread false,
  :crawled 1573222023307,
  :content
  {:content
   "<p><img alt=\"Screenshot of datalog linting in editor.\" src=\"https://lambdaforge/images/clj_kondo.png\"></p>\n<h1>TLDR; How do I use it?</h1>\n<p>It is very simple, just use the newest\n<a href=\"https://github.com/borkdude/clj-kondo/\">clj-kondo</a>\n<a href=\"https://github.com/borkdude/clj-kondo/releases/tag/v2019.11.07\">version</a> and\nyou are good to go. We are able to detect Datalog in the position of first\nargument to DataScript’s, Datomic’s and Datahike’s <code>q</code> function. I am not sure\nwhether there are other situations where you know that a data structure\ncorresponds to a query of these functions, but we could also support a metadata\nhint for example.</p>\n<h1>Why support linting for Datalog?</h1>\n<p>We use <a href=\"https://en.wikipedia.org/wiki/Datalog\">Datalog</a> daily, either to build\nfrontends with <a href=\"https://github.com/tonsky/datascript/\">DataScript</a>, backends\nwith <a href=\"https://www.datomic.com/\">Datomic</a> or with our composable database stack\n<a href=\"https://github.com/replikativ/datahike\">Datahike</a>. These three systems all use\nthe Datalog dialect that has first been introduced by Datomic. A benefit of this\ndialect is that it is simply described as a symbolic expression built out of\n<a href=\"https://github.com/edn-format/edn\">edn</a>. Its ability to bind and join input\ndata over multiple data sources as well as invoke pure Clojure functions <a href=\"https://www2.eecs.berkeley.edu/Pubs/TechRpts/2010/EECS-2010-90.pdf\">is\nextremely\npowerful</a> even\nwithout managing durable data. But also, whether beginner or expert, one still\noften makes mistakes in query formulations and you need to invoke a query first\nbefore you get feedback. Datalog is a very concise language for which we have an\ninformative parser that both checks syntax and part of its semantics, so my\ncolleague Konrad suggested that it would be very useful to extend the linter of\n<code>clj-kondo</code> and tighten the feedback loop for writing Datalog queries as shown\nin the picture above. So I just did that.</p>\n<h1>Implementing a linter</h1>\n<p>Let’s see how easy implementing static analysis can be. Static analysis means\nthat your code is not really run, i.e. it is interpreted in a way to prove its\n(in)consistencies without causing any side effects, e.g. in a type checker or a\nverification tool. <code>clj-kondo</code> is a linter, a tool that does analysis on your\ncode in a separate context, that means it is not interfering with the REPL and\nnot stopping you from running inconsistent code. This allows you to care of\nconsistency whenever you have figured out what you actually want to do, compared\nto languages that need intrinsic type safety to be run. So <code>clj-kondo</code> needs to\nanalyze your code, but instead of executing (compiling and running) it, it just\ntries to find (likely) inconsistencies, e.g. unbound variable errors or\nredundant code warnings. To add the Datalog analyzer I have added a case in the\n<a href=\"https://github.com/borkdude/clj-kondo/blob/e5f8af54590b084cc119263698bdc786bfc6434f/src/clj_kondo/impl/analyzer.clj#L1123\">analysis of function\ncalls</a>\nfor the three query functions of DataScript, Datomic and Datahike for the\nfollowing function:</p>\n<div><div><pre><code><span>(</span><span>defn</span><span> </span><span>analyze-datalog</span><span> </span><span>[{</span><span>:keys</span><span> </span><span>[</span><span>:findings</span><span>]</span><span> </span><span>:as</span><span> </span><span>ctx</span><span>}</span><span> </span><span>expr</span><span>]</span><span>\n</span><span>(</span><span>let</span><span> </span><span>[</span><span>children</span><span> </span><span>(</span><span>next</span><span> </span><span>(</span><span>:children</span><span> </span><span>expr</span><span>))</span><span>\n</span><span>query-raw</span><span> </span><span>(</span><span>first</span><span> </span><span>children</span><span>)</span><span>\n</span><span>quoted?</span><span> </span><span>(</span><span>when</span><span> </span><span>query-raw</span><span>\n</span><span>(</span><span>=</span><span> </span><span>:quote</span><span> </span><span>(</span><span>tag</span><span> </span><span>query-raw</span><span>)))</span><span>\n</span><span>;; 1. Let's try to unpack the first argument (query) if it is a quoted literal.</span><span>\n</span><span>datalog-node</span><span> </span><span>(</span><span>when</span><span> </span><span>quoted?</span><span>\n</span><span>(</span><span>when-let</span><span> </span><span>[</span><span>edn-node</span><span> </span><span>(</span><span>first</span><span> </span><span>(</span><span>:children</span><span> </span><span>query-raw</span><span>))]</span><span>\n</span><span>(</span><span>when</span><span> </span><span>(</span><span>one-of</span><span> </span><span>(</span><span>tag</span><span> </span><span>edn-node</span><span>)</span><span> </span><span>[</span><span>:vector</span><span> </span><span>:map</span><span>])</span><span>\n</span><span>edn-node</span><span>)))]</span><span>\n</span><span>(</span><span>when</span><span> </span><span>datalog-node</span><span>\n</span><span>(</span><span>try</span><span>\n</span><span>;; 2. Call the external parser.</span><span>\n</span><span>(</span><span>datalog/parse</span><span> </span><span>(</span><span>sexpr</span><span> </span><span>datalog-node</span><span>))</span><span>\n</span><span>nil</span><span>\n</span><span>(</span><span>catch</span><span> </span><span>Exception</span><span> </span><span>e</span><span>\n</span><span>;; 3. Finally we can extract the error from the exception</span><span>\n</span><span>;; and point to the source.</span><span>\n</span><span>(</span><span>findings/reg-finding!</span><span> </span><span>findings</span><span>\n</span><span>(</span><span>node->line</span><span> </span><span>(</span><span>:filename</span><span> </span><span>ctx</span><span>)</span><span> </span><span>query-raw</span><span>\n</span><span>:error</span><span> </span><span>:datalog-syntax</span><span>\n</span><span>(</span><span>.getMessage</span><span> </span><span>e</span><span>))))))))</span><span>\n</span></code></pre></div></div>\n<p>This code mainly follows 3 steps. First it uses\n<a href=\"https://github.com/xsc/rewrite-clj\">rewrite-clj</a> to extract the symbolic\nexpression for the first argument and tries to unpack it into a Datalog literal.\nSecond it calls our\n<a href=\"https://github.com/lambdaforge/datalog-parser/\">datalog-parser</a>, which is\nderived from DataScript, to check whether it would succeed. Third if it throws\nan Exception we extract the error message from the parser and register it with\n<code>reg-finding!</code> for the original <code>query-raw</code> expression. The only thing missing\nis to define the <code>:datalog-syntax</code> type in the default configuration map in\n<a href=\"https://github.com/borkdude/clj-kondo/blob/e5f8af54590b084cc119263698bdc786bfc6434f/src/clj_kondo/impl/config.clj#L31\">config.clj</a>.\nWe also had to make sure that the parser does not use reflection so that it is\ncompatible with <a href=\"https://www.graalvm.org/docs/getting-started/#native-images\">GraalVM’s native image\nsupport</a> that is\nused to compile <code>clj-kondo</code>. This functionality has only added a few hundred\nkilobytes to the final static binary. Overall it was a very pleasing experience\nand doable in two afternoons. Done.</p>\n<h1>Pushing things further</h1>\n<p>Depending on how much you work in a specific domain with formally specified\nlanguage abstractions providing a linter for it can pay off quickly. I am sure\nit was even worth the effort if I would just have done it for myself. It might\nalso be good to improve your parser/checker from the perspective of an\ninteractive helper, maybe we should try to catch more errors by making sure <a href=\"https://dodisturb.me/doc/slide/semmle19.pdf\">all\nvariables passed to predicates are properly\nbound</a>?</p>\n<p>In general I think static analysis is extremely underexplored in Clojure,\npartially because of the very good arguments <a href=\"https://www.youtube.com/watch?v=2V1FtfBDsLU\">Rich Hickey\nmade</a> against global static type\nchecking and the resulting puzzling mentality that distracts from the actual\nproblem solving in the vaguely formalized domains of everyday programming. Here\nis a good clarifying <a href=\"https://lispcast.com/clojure-and-types/\">article</a> about\nhis talk . But we can try to proof consistencies locally and for some domains\nstronger static guarantees might be worth it, e.g. if the cost of uncaught\ndownstream errors is high. Clojure’s immutable nature makes it a superb\ntarget for such analysis. <code>clj-kondo</code> already provides a simple extrinsic type\nsystem that works very well for me. Static analysis for Clojure is also provided\nby <a href=\"https://github.com/candid82/joker/\">joker</a> and\n<a href=\"https://cursive-ide.com/\">Cursive</a>.</p>\n<p>The Clojure ecosystem can borrow plenty of good ideas in this direction\nfrom the <a href=\"https://www.youtube.com/watch?v=-cLI3GHvLOM\">tower of languages</a> and\nlibraries provided in <a href=\"https://racket-lang.org/\">Racket</a>. While this community\nis much more academic, they are our friendly cousins in parenthesis. I interact\nwith researchers working in Racket daily and I am pretty sure they would help\nyou if you want to port one of their languages or libraries to Clojure.\n<a href=\"https://github.com/typedclojure/core.typed\">core.typed</a> is a port of <a href=\"https://docs.racket-lang.org/ts-guide/\">Typed\nRacket</a> for instance.</p>\n<p>A pretty mind boggling approach is to use Datalog itself for analysis, e.g. with\n<a href=\"https://github.com/jpmonettas/clindex\">clindex</a>, which I plan to use in <a href=\"https://gitlab.com/whilo/foppl-compiler\">my\nresearch compiler</a>. Facebook is using a\nsimilar approach in <a href=\"https://www.youtube.com/watch?v=-OPN7QPsYKE\">Glean</a> and\nRust’s borrow checker <a href=\"https://smallcultfollowing.com/babysteps/blog/2019/01/17/polonius-and-region-errors/\">can be\ndescribed</a>\nin Datalog. <a href=\"https://semmle.com\">Semmle</a> has been bought by Github and is\nintegrating its Datalog based static analysis now. There are also many other\ninteresting ideas around Datalog in the programming language community. e.g.\n<a href=\"https://github.com/teyjus/teyjus\">Lambda Prolog</a> and\n<a href=\"https://github.com/rntz/datafun\">datafun</a>. I will try to collect some\ninteresting type system related resources for <code>clj-kondo</code>\n<a href=\"https://github.com/borkdude/clj-kondo/wiki\">here</a>, feel free to reach out to me\nor <a href=\"https://michielborkent.nl/\">Michiel Borkent</a> if you have ideas and want to\ncontribute.</p>\n<p>Finally I want to thank Michiel Borkent for <code>clj-kondo</code> and for guiding me\nthrough the process, <a href=\"http://tonsky.me/\">Nikita Tonsky</a> for providing the\noriginal Datalog parser, <a href=\"https://dodisturb.me/\">Mistral Constratin</a> for\npointers to static analysis and his work on <a href=\"https://dodisturb.me/doc/slide/semmle19.pdf\">data flow analysis for Datalog\nitself</a> and <a href=\"https://www.cs.ubc.ca/~rxg/\">Ron\nGarcia</a> for teaching me a thing or two about\nstatic analysis ;).</p>\n<p><em>Let’s bring more static analysis and Datalog to Clojure for even more fun and\nprofit!</em></p>",
   :direction "ltr"},
  :updated 1573192800000,
  :entities
  [{:mentions [{:text "Datalog"}],
    :id "nlp/f/entity/wd:1172264",
    :salienceLevel "about",
    :label "Datalog"}
   {:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "TLDR"}],
    :id "nlp/f/entity/wd:16886840",
    :salienceLevel "mention",
    :label "TL;DR"}
   {:mentions [{:text "data structure"}],
    :id "nlp/f/entity/wd:175263",
    :salienceLevel "mention",
    :label "data structure"}
   {:mentions [{:text "type safety"}],
    :id "nlp/f/entity/wd:736866",
    :salienceLevel "mention",
    :label "type safety"}],
  :alternate
  [{:href
    "https://lambdaforge/2019/11/08/clj-kondo-datalog-support.html",
    :type "text/html"}],
  :title "Linting Datalog with clj-kondo",
  :author "Christian Weilbach",
  :published-str "Thu Nov 07 22:00:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16e4b57008b:4c660c:69b9f616",
  :visual {:url "none"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://lambdaforge/2019/11/08/clj-kondo-datalog-support",
  :commonTopics
  [{:score 133.97488770772122,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1573192800000,
  :fingerprint "867e1b89"}
 {:engagement 5,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1573219787829,
  :content
  {:content
   "<p>Talk at CodeMesh now given, because of a demo god intervention (I discovered a Purerl compiler bug mid-demo, how's that for luck?) I didn't have time to receive questions during my actual session, but I kept a note of questions asked afterwards and will cover them here for those not present during their discussion.</p>\n<p>I'll carry on linking these Purerl posts from each other before that however, 'cos it serves as a handy indexing mechanism in lieu of having a real blog engine..</p>\n<ul>\n<li><a href=\"http://codeofrob.com/entries/introducing-pinto-and-stetson---opinionated-purescript-bindings-to-otp-and-cowboy.html\">Introduction to Pinto/Stetson - Opinionated Bindings to OTP/Cowboy</a></li>\n<li><a href=\"http://codeofrob.com/entries/the-structure-of-an-end-to-end-purescript-otp-project.html\">The structure of an end-to-end purescript OTP project</a></li>\n<li><a href=\"http://codeofrob.com/entries/building-on-top-of-otp-with-purescript-with-pinto.html\">Building on top of OTP with Purescript with Pinto</a></li>\n<li><a href=\"http://codeofrob.com/entries/building-a-purescript-web-server-with-stetson-and-pinto.html\">Building a Purescript web server with Stetson and Pinto</a></li>\n<li><a href=\"http://codeofrob.com/entries/shared-code-twixt-purescript-server-and-client.html\">Shared code twixt Purescript server and client</a></li>\n<li><a href=\"http://codeofrob.com/entries/purescript-interop-with-native-erlang---interacting-with-redis.html\">Purescript interop with native Erlang, interaction with Redis</a></li>\n<li><a href=\"http://codeofrob.com/entries/codemesh-2019---purerl-and-otp-talk.html\">Codemesh 2019 - Purerl and OTP</a></li>\n</ul>\n<h1>Useful links</h1>\n<ul>\n<li><a href=\"https://github.com/id3as/demo-ps\">demo-ps</a> The demo codebase we're talking about here</li>\n<li><a href=\"https://github.com/id3as/purescript-erl-pinto\">erl-pinto</a> (the opinionated bindings to OTP we're using)</li>\n<li><a href=\"https://github.com/id3as/purescript-erl-stetson\">erl-stetson</a> (the opinionated bindings to Cowboy we're using)</li>\n</ul>\n<h1>Some questions then.</h1>\n<ul>\n<li>What if I use the wrong types in my FFI</li>\n<li>What if I don't use Effect in my FFI</li>\n<li>How do you map complex union types back into Purerl when doing FFI (specifically, errors)</li>\n<li>Are there any situations where you feel the types in Purescript would get in the way and you'd just write Erlang instead?</li>\n</ul>\n<h1>Wrong types</h1>\n<p>In one demo I did a very simple import of the base64 module from base Erlang:</p>\n<pre><code><span>-module</span><span>(cool@foreign)</span>.\n\n<span>-export</span><span>([base64/<span>1</span>])</span>.\n\n<span><span>base64</span><span>(String)</span> -></span> base64:encode(String).\n</code></pre>\n<p>Consumed in purescript with the following import</p>\n<pre><code>\n<span>foreign</span> <span>import</span> base64 :: <span>String</span> -> <span>String</span>\n</code></pre>\n<p>And all is right and proper, from the erlang shell, I can call this function</p>\n<pre><code>Eshell V10.5  (abort with ^G)\n1> l(cool@ps).\n{module,cool@ps}\n2> cool@ps:base64(&lt;&lt;<span>&quot;foo&quot;</span>>>).\n&lt;&lt;<span>&quot;Zm9v&quot;</span>>>\n3></code></pre>\n<p>So.. what if we lie about the types at play here?</p>\n<pre><code>\n<span>foreign</span> <span>import</span> base64 :: <span>String</span> -> <span>Int</span>\n</code></pre>\n<p>Well, the result of calling the purescript function from Erlang isn't going to change because it doesn't care about types</p>\n<pre><code>Eshell V10.5  (abort with ^G)\n1> l(cool@ps).\n{module,cool@ps}\n2> cool@ps:base64(&lt;&lt;<span>&quot;foo&quot;</span>>>).\n&lt;&lt;<span>&quot;Zm9v&quot;</span>>>\n3></code></pre>\n<p>How about using it in a purescript application?</p>\n<pre><code>\n<span>doSomething</span> :: <span>Effect</span> <span>Unit</span>\n<span>doSomething</span> = <span>do</span>\n  <span>let</span> result = base64 <span>&quot;wow&quot;</span>\n  _ &lt;- <span>Console</span>.log $ show result\n  pure unit\n</code></pre>\n<pre><code>\n> (cool@ps:doSomething())().\n** exception error: bad argument\n     <span>in</span> <span>function</span>  integer_to_binary/1\n        called as integer_to_binary(&lt;&lt;<span>&quot;d293&quot;</span>>>)\n     <span>in</span> call from data_show@foreign:showIntImpl/1 (output/Data.Show/data_show@foreign.erl, line 4)\n     <span>in</span> call from main@ps:<span>'-doSomething/0-fun-0-'</span>/1 (/home/robashton/talks/purescript_beam/demo_2/src/Main.purs, line 19)\n</code></pre>\n<p>Passing the variable around in Purescript land, nothing cares - it is assumed that if you've said something is a certain type, that it is that type and all type checking will be done on that basis - sooner or later, every bit of data will end up getting somewhere where it needs to be serialized whether for display, storage or transmission and that will involve passing the data into code that makes assumptions based on the type being passed in and you'll get a runtime crash.</p>\n<p>So obviously the answer is &quot;don't do it&quot; - when building FFI, getting types correct is essential - definitely something worth testing.</p>\n<h1>What if I don't use Effect in my FFI</h1>\n<p>You maniac, why would you want to lie about side effects??! Well it turns out to not actually be a big deal, the main reason you're telling the type system about side effects is for your own benefit and if you choose to lie then at some point you will be hoisted on your own petard and we will all laugh at you. An example of places where this could happen is with legacy code and logging, I guess, probably, maybe.</p>\n<pre><code>\n<span>-module</span><span>(cool@foreign)</span>.\n<span>-export</span><span>([ add/<span>2</span> ])</span>.\n\n<span><span>add</span><span>(X,Y)</span> -></span>\n  io:format(user, <span>&quot;WOW, I AM ADDING ~p and ~p&quot;</span>, [ X, Y ]),\n  X + Y.\n</code></pre>\n<pre><code>\n<span>foreign</span> <span>import</span> add :: <span>Int</span> -> <span>Int</span> -> <span>Int</span>\n\n<span>doSomething</span> :: <span>Effect</span> <span>Unit</span>\n<span>doSomething</span> = <span>do</span>\n  <span>let</span> result = add <span>5</span> <span>6</span>\n  _ &lt;- <span>Console</span>.log $ show result\n  pure unit\n</code></pre>\n<pre><code>8> (main@ps:doSomething())().\nWOW, I AM ADDING 5 and 611\nunit</code></pre>\n<p>Is this the future you want to be a part of? No I didn't think so - friends don't let friends write effectful code without declaring it as effectful.</p>\n<h1>How do you map complex union types back into Purerl </h1>\n<p>Consider the <a href=\"http://erlang.org/documentation/doc-6.2/lib/kernel-3.0.3/doc/html/file.html#list_dir-1\">read_dir API</a> in classic Erlang: </p>\n<pre><code>  list_dir(Dir) -> {ok, Filenames} | {error, Reason}\n\n  Types:\n\n  Dir = name_all()\n  Filenames = [filename()]\n  Reason = posix()\n         | badarg\n         | {no_translation, Filename :: unicode:latin1_binary()}\n</code></pre>\n<p>There are some decisions to be made when writing code that exposes this API to the Purerl world, and none of them are <em>wrong</em> per se. The default position is usually &quot;Map the exact API across as it is, and if you don't like it then fix it by writing a somewhat more Purescripty wrapper&quot;.</p>\n<p>So that would be.</p>\n<pre><code>\n<span>module</span> Erl.File <span>where</span>\n\n<span>ListDir</span>  :: <span>String</span> -> <span>Effect</span> (<span>Either</span> <span>ListDirFailure</span> (<span>List</span> <span>String</span>))\n\n<span><span>data</span> <span>ListDirFailure</span> = <span>ListDirPosixFailure</span> <span>Atom</span></span>\n                    | <span>ListDirBadArg</span>\n                    | <span>ListDirNoTranslation</span> <span>Binary</span>\n</code></pre>\n<p>Which means then passing in the constructors to the FFI so this can be constructed in Erlang without knowing about these types at the top level.</p>\n<pre><code>\n<span>foreign</span> <span>import</span> <span>ListDir_</span> :: (<span>Atom</span> -> <span>ListDirFailure</span>)  \n                            -> <span>ListDirFailure</span> \n                            -> (<span>Binary</span> -> <span>ListDirFailure</span>) \n                            -> <span>ListDirFailure</span> -> (<span>Either</span> <span>ListDirFailure</span> (<span>List</span> <span>String</span>))\n                            -> (<span>List</span> <span>String</span> -> (<span>Either</span> <span>ListDirFailure</span> (<span>List</span> <span>String</span>)))\n                            -> <span>String</span> -> <span>Effect</span> (<span>Either</span> <span>ListDirFailure</span> (<span>List</span> <span>String</span>))\n\n<span>ListDir</span>  :: <span>String</span> -> <span>Effect</span> (<span>Either</span> <span>ListDirFailure</span> (<span>List</span> <span>String</span>))\n<span>listDir</span> = listDir_ <span>ListDirPosixFailure</span> <span>ListDirBadArg</span> <span>ListDirNoTranslation</span> <span>Left</span> <span>Right</span>\n\n<span><span>data</span> <span>ListDirFailure</span> = <span>ListDirPosixFailure</span> <span>Atom</span></span>\n                    | <span>ListDirBadArg</span>\n                    | <span>ListDirNoTranslation</span> <span>Binary</span>\n</code></pre>\n<p>Youch that's a mouthful, obviously we can make that a bit more legible with</p>\n<pre><code>\n<span>foreign</span> <span>import</span> <span>ListDir_</span> :: (<span>Atom</span> -> <span>ListDirFailure</span>)  \n                            -> <span>ListDirFailure</span> \n                            -> (<span>Binary</span> -> <span>ListDirFailure</span>) \n                            -> <span>ListDirFailure</span> -> <span>ListDirResult</span>\n                            -> (<span>List</span> <span>String</span> -> <span>ListDirResult</span>\n                            -> <span>String</span> -> <span>Effect</span> <span>ListDirResult</span>\n\n<span>ListDir</span>  :: <span>String</span> -> <span>Effect</span> (<span>Either</span> <span>ListDirFailure</span> (<span>List</span> <span>String</span>))\n<span>ListDir</span> = listDir_ <span>ListDirPosixFailure</span> <span>ListDirBadArg</span> <span>ListDirNoTranslation</span> <span>Left</span> <span>Right</span>\n\n<span><span>type</span> <span>ListDirResult</span> = <span>Either</span> <span>ListDirResult</span> (<span>List</span> <span>String</span>)</span>\n<span><span>data</span> <span>ListDirFailure</span> = <span>ListDirPosixFailure</span> <span>Atom</span></span>\n                    | <span>ListDirBadArg</span>\n                    | <span>ListDirNoTranslation</span> <span>Binary</span>\n</code></pre>\n<p>And the FFI then looks like</p>\n<pre><code>\n<span><span>listDir_</span><span>(ListDirPosixFailure, ListDirBadArg, NoTranslationError, Failure, Success, Dir)</span> -></span>\n  <span>fun</span>() ->\n    <span>case</span> file:list_dir(Dir) <span>of</span>\n      { ok, Filenames } -> Success(Filenames);\n      { error, { no_translation, Encoded } } -> Failure(NoTranslationError(Encoded));\n      { error, badarg } -> Failure(ListDirBadArg);\n      { error, Posix } -> Failure(ListDirPosixFailure(Posix));\n  <span>end</span>.\n</code></pre>\n<p>If you wanted a nicer API on top of this, let's call it &quot;CoolFileApi&quot; for example, you'd then wrap <em>that</em> binding with something nicer - having at least type-safe-ified the original API in all of its glory, and then you're doing the work in Purescript rather than Erlang, I haven't ran this through a compiler so I probably got it a bit wrong but you'll get picture..</p>\n<pre><code><span>module</span> CoolFileApi <span>where</span>\n\n<span>import</span> Erl.File <span>as</span> File\n<span>import</span> Data.Newtype (<span>unwrap</span>, <span>wrap</span>)\n\n<span><span>newtype</span> <span>Filepath</span> = <span>Filepath</span> <span>String</span></span>\n<span>derive</span> <span>instance</span> ntFilepath :: <span>Newtype</span> <span>Filepath</span> _\n\n<span>ListDir</span> :: <span>Filepath</span> -> <span>Effect</span> (<span>Either</span> <span>CoolListDirFailureReason</span> (<span>List</span> <span>Filepath</span>))\n<span>ListDir</span> <span>Filepath</span> = <span>do</span>\n  result &lt;- <span>File</span>.<span>ListDir</span> $ unwrap <span>Filepath</span>\n  pure $ either (<span>Left</span> &lt;&lt;&lt; nativeFailureToShinyFailure) (<span>Right</span> &lt;&lt;&lt; wrap)\n\n\n<span>nativeFailureToShinyFailure</span> :: <span>File</span>.<span>ListDirFailure</span> -> <span>CoolListDirFailureReason</span>\n<span>nativeFailureToShinyFailure</span> reason =\n  <span>case</span> reason <span>of</span>\n    <span>ListDirBadArg</span> -> <span>CoolListDirBadArg</span>\n    <span>ListDirNoTranslation</span> filename -> <span>CoolListDirNoTranslation</span> filename\n    <span>ListDirPosixFailure</span> a -> <span>CoolListDirPosixFailure</span> (atomToCool a)\n\n<span>atomToCool</span>  :: <span>Erl</span>.<span>Atom</span> -> <span>CoolListDirPosixFailure</span>\n<span>atomToCool</span> a = \n  <span>case</span> a <span>of</span>\n    (atom <span>&quot;eacces&quot;</span>) -> <span>Eaccess</span>\n    (atom <span>&quot;enoent&quot;</span>) -> <span>Enoent</span>\n    <span>--- etc</span>\n</code></pre>\n<p>Essentially getting rid of those arbitary atoms and Erlang data types and representing them as native Purerl data types. You <em>could</em> just write your binding directly in this way from the get-go, but it's considered polite to write the low level bindings as directly as possible to the original API because it saves on mental load (and doing as little work as possible in the Erlang code), the documentation for the original API is then applicable to the low level bindings too.</p>\n<h1>Aren't types a huge pain in the ass?</h1>\n<p>I mean that's what I heard for this question, and it's a bit of a loaded one - people that aren't used to working in a sensibly typed environment tend to look at the typed environment as being a form of burden, instead of an aid to help you write better code. Some of the conversation around this was about whether we'd be re-writing some of our core functionality in Purescript, and whether that would even be desirable as the types might get in the way of productivity.</p>\n<p>I think that actually there is a lot of desire internally for us to do our next re-write of our orchestration logic in Purerl for example, but because we're in a different language with a different way of looking at the world, the API and even the design of that would probably not look anything like the original (and the same goes for our media workflow engine too). We're not afraid of re-writes, we write code to be thrown away after all - but usually when doing a re-write of a module, you get to learn from the previous iterations and Do It Better this time - the pendulum of compensation from past mistakes slowly zeroes in around an ideal design and by version 3 or 4 you're laughing.</p>\n<p>The main pain of having to do things differently is while there will be some lessons that can be passed into the rewrites into Purescript, a lot of the design decisions don't come through to the new world and you're essentially going back to version 1/2 again for that component. That'll be the pain that we'll go through but we'll come out the other side as better Purescript developers so we're not afraid of that.</p>\n<p>I really can't see a point where I'd say that types are going to get in the way of Just Getting Stuff Done, in my experience so far, the type system is just a more honest way of looking at effort, when you're working in a sloppy-typed environment you can pretend that it's really easy and fun and you're dead smart so it's okay, but you end up paying the cost in bugs and mistakes eventually - the upfront cost might not be there but you've just shifted it elsewhere. Types also typically enable you to write better abstractions to lessen the load of repeated operations - you can be a lot more clever when the compiler has your back.</p>\n<p>It's very hard to currently view what a typed version of some of our core IP would look like, but that's down to our inexperience rather than it being an impossible task; it'll come in time.</p>\n<h1>Anyway</h1>\n<p>That's some answers, if you have more questions about Purerl/Stetson/Pinto <a href=\"http://twitter.com/robashton\">hit me up on Twitter</a> and I'll do my best to help..</p>",
   :direction "ltr"},
  :updated 1573119000000,
  :entities
  [{:mentions [{:text "Erlang"}],
    :id "nlp/f/entity/wd:334879",
    :salienceLevel "mention",
    :label "Erlang"}
   {:mentions [{:text "FFI"}],
    :id "nlp/f/entity/wd:862872",
    :salienceLevel "mention",
    :label "fatal familial insomnia"}
   {:mentions [{:text "API"}],
    :id "nlp/f/entity/wd:165194",
    :salienceLevel "mention",
    :label "application programming interface"}
   {:mentions [{:text "filename"}],
    :id "nlp/f/entity/wd:1144928",
    :salienceLevel "mention",
    :label "filename"}
   {:mentions [{:text "Dir"}],
    :id "nlp/f/entity/wd:277012",
    :salienceLevel "mention",
    :label "DIR"}],
  :alternate
  [{:href
    "http://codeofrob.com/entries/purerl---some-questions-from-codemeshldn.html",
    :type "text/html"}],
  :title "Purerl - Some questions from #CodeMeshLdn",
  :author "Rob Ashton",
  :published-str "Thu Nov 07 01:30:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16e4b34e435:4c18f2:97b0c8f7",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "http://codeofrob.com/entries/purerl---some-questions-from-codemeshldn.html",
  :commonTopics
  [{:score 74.37658155030242,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.829,
    :id "nlp/f/topic/630",
    :salienceLevel "mention",
    :label "deep learning"}],
  :published 1573119000000,
  :fingerprint "9829b0ef",
  :canonicalUrl
  "http://codeofrob.com/entries/purerl---some-questions-from-codemeshldn.html"}
 {:engagement 5,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1573186555911,
  :content
  {:content
   "Joel Holdbrooks talks about Meander, interpreters, operational semantics, and Clojurists Together funding.. Meander “Meander: Declarative Explorations at the Limits of FP” by Jimmy Miller Small step interpreter Matt Might - Abstract interpreters for free [PDF] Matt Might - Writing an interpreter, CESK-style SECD versus CEK Mind in Motion, Barbara Tversky Shaun Mahood renaming Garden files",
   :direction "ltr"},
  :updated 1573183804000,
  :entities
  [{:mentions [{:text "Meander"}],
    :id "nlp/f/entity/wd:211089",
    :salienceLevel "about",
    :label "Büyük Menderes River"}
   {:mentions [{:text "Matt Might"}],
    :id "nlp/f/entity/wd:47035471",
    :salienceLevel "mention",
    :label "Matt Might"}
   {:mentions [{:text "operational semantics"}],
    :id "nlp/f/entity/wd:1930895",
    :salienceLevel "mention",
    :label "operational semantics"}
   {:mentions [{:text "Jimmy Miller"}],
    :id "nlp/f/entity/wd:59477",
    :salienceLevel "mention",
    :label "Jimmy Miller"}
   {:mentions [{:text "Barbara Tversky"}],
    :id "nlp/f/entity/wd:4859373",
    :salienceLevel "mention",
    :label "Barbara Tversky"}],
  :alternate
  [{:href "https://www.therepl.net/episodes/31/", :type "text/html"}],
  :title "31: Joel Holdbrooks on Meander",
  :author "Daniel Compton",
  :published-str "Thu Nov 07 19:30:04 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16e4939d007:1e6c67:69b9f616",
  :visual {:url "none"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://www.therepl.net/episodes/31/",
  :published 1573183804000,
  :fingerprint "18113d87",
  :canonicalUrl "https://www.therepl.net/episodes/31/"}
 {:engagement 5,
  :unread false,
  :crawled 1573146957367,
  :content
  {:content
   "<p><em>В последней главе мы поговорим о тестировании приложений. Читатель узнает, что\nтакое тесты и каких типов они бывают. Мы рассмотрим методы тестирования и\nхорошие практики. Постараемся избежать лишней сложности: не будем злоупотреблять\nтерминами вроде TDD и BDT. Покажем, что в мире Clojure легко писать и\nподдерживать тесты.</em></p>\n<h2>\nСодержание\n</h2>\n<ul>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%9E%D1%81%D0%BD%D0%BE%D0%B2%D0%BD%D1%8B%D0%B5-%D0%BF%D0%BE%D0%BD%D1%8F%D1%82%D0%B8%D1%8F\">Основные понятия</a> <ul>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%9A%D0%B5%D0%B9%D1%81%D1%8B-%D0%B8-%D0%BF%D0%BE%D0%BA%D1%80%D1%8B%D1%82%D0%B8%D0%B5\">Кейсы и покрытие</a></li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%9D%D0%B5-%D1%82%D0%BE%D0%BB%D1%8C%D0%BA%D0%BE-%D1%87%D0%B8%D1%81%D0%BB%D0%B0\">Не только числа</a></li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%9A%D0%BE%D0%B3%D0%B4%D0%B0-%D0%BF%D0%B8%D1%81%D0%B0%D1%82%D1%8C-%D1%82%D0%B5%D1%81%D1%82%D1%8B\">Когда писать тесты</a></li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%9E-%D1%87%D0%B8%D1%81%D1%82%D0%BE%D1%82%D0%B5-%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D0%B9\">О чистоте функций</a></li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%9F%D1%80%D0%BE%D0%B8%D0%B7%D0%B2%D0%BE%D0%B4%D1%81%D1%82%D0%B2%D0%BE\">Производство</a></li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%A3%D1%81%D1%82%D1%80%D0%BE%D0%B9%D1%81%D1%82%D0%B2%D0%BE-%D1%82%D0%B5%D1%81%D1%82%D0%BE%D0%B2\">Устройство тестов</a></li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%A2%D0%B8%D0%BF%D1%8B-%D1%82%D0%B5%D1%81%D1%82%D0%BE%D0%B2\">Типы тестов</a></li>\n</ul>\n</li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%A2%D0%B5%D1%81%D1%82%D1%8B-%D0%B2-clojure\">Тесты в Clojure</a> <ul>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%9A%D0%BE%D0%BC%D0%B0%D0%BD%D0%B4%D0%BD%D0%B0%D1%8F-%D1%81%D1%82%D1%80%D0%BE%D0%BA%D0%B0\">Командная строка</a></li>\n<li><a href=\"https://grishaev.me/feed.xml#repl\">REPL</a></li>\n</ul>\n</li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%9F%D0%BE%D0%BB%D0%B5%D0%B7%D0%BD%D1%8B%D0%B5-%D0%BF%D1%80%D0%B0%D0%BA%D1%82%D0%B8%D0%BA%D0%B8\">Полезные практики</a> <ul>\n<li><a href=\"https://grishaev.me/feed.xml#testing\">Testing</a></li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%98%D1%81%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%BD%D0%B8%D1%8F\">Исключения</a></li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%9F%D0%B0%D0%BA%D0%B5%D1%82%D0%BD%D0%B0%D1%8F-%D0%BF%D1%80%D0%BE%D0%B2%D0%B5%D1%80%D0%BA%D0%B0\">Пакетная проверка</a></li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%98%D0%BC%D0%B5%D0%BD%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5\">Именование</a></li>\n</ul>\n</li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%A4%D0%B8%D0%BA%D1%81%D1%82%D1%83%D1%80%D1%8B\">Фикстуры</a> <ul>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%A0%D0%B5%D0%B3%D0%B8%D1%81%D1%82%D1%80%D0%B0%D1%86%D0%B8%D1%8F\">Регистрация</a></li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%9F%D1%80%D0%B8%D0%BC%D0%B5%D1%80\">Пример</a></li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%9D%D0%B0-%D0%BD%D0%B8%D0%B6%D0%BD%D0%B5%D0%BC-%D1%83%D1%80%D0%BE%D0%B2%D0%BD%D0%B5\">На нижнем уровне</a></li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%A1%D0%B2%D1%8F%D0%B7%D0%B0%D0%BD%D0%BD%D1%8B%D0%B5-%D0%BF%D0%B5%D1%80%D0%B5%D0%BC%D0%B5%D0%BD%D0%BD%D1%8B%D0%B5\">Связанные переменные</a></li>\n</ul>\n</li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%9C%D1%83%D0%BB%D1%8C%D1%82%D0%B8-%D1%84%D0%B8%D0%BA%D1%81%D1%82%D1%83%D1%80%D1%8B\">Мульти-фикстуры</a> <ul>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%9C%D0%B8%D0%BD%D1%83%D1%82%D0%BA%D0%B0-%D0%BD%D0%B5%D0%B0%D0%B4%D0%B5%D0%BA%D0%B2%D0%B0%D1%82%D0%BD%D0%BE%D1%81%D1%82%D0%B8\">Минутка неадекватности</a></li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%A4%D0%B8%D0%BA%D1%81%D1%82%D1%83%D1%80%D1%8B-%D1%81-%D1%83%D1%81%D0%BB%D0%BE%D0%B2%D0%B8%D1%8F%D0%BC%D0%B8\">Фикстуры с условиями</a></li>\n</ul>\n</li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%9C%D0%B5%D1%82%D0%BA%D0%B8-%D0%B8-%D1%81%D0%B5%D0%BB%D0%B5%D0%BA%D1%82%D0%BE%D1%80%D1%8B\">Метки и селекторы</a> <ul>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%A2%D0%B5%D1%81%D1%82%D1%8B-%D0%B2-depsedn\">Тесты в deps.edn</a></li>\n</ul>\n</li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%9F%D1%80%D0%BE%D0%B1%D0%BB%D0%B5%D0%BC%D0%B0-%D0%BE%D0%BA%D1%80%D1%83%D0%B6%D0%B5%D0%BD%D0%B8%D1%8F\">Проблема окружения</a> <ul>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%9C%D0%BE%D0%BA%D0%B8\">Моки</a></li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%92%D1%8B%D0%BD%D0%B5%D1%81%D1%82%D0%B8-%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D0%B5-%D0%B2-%D1%84%D0%B0%D0%B9%D0%BB\">Вынести данные в файл</a></li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%9F%D0%B5%D1%80%D0%B5%D0%BD%D0%B5%D1%81%D1%82%D0%B8-%D0%BC%D0%BE%D0%BA-%D0%B2-%D1%84%D0%B8%D0%BA%D1%81%D1%82%D1%83%D1%80%D1%83\">Перенести мок в фикстуру</a></li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%9D%D0%B5%D0%B3%D0%B0%D1%82%D0%B8%D0%B2%D0%BD%D1%8B%D0%B5-%D1%81%D1%86%D0%B5%D0%BD%D0%B0%D1%80%D0%B8%D0%B8\">Негативные сценарии</a></li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%A1%D0%B1%D0%BE%D1%80-%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85\">Сбор данных</a></li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%9D%D0%B5%D0%B4%D0%BE%D1%81%D1%82%D0%B0%D1%82%D0%BA%D0%B8\">Недостатки</a></li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%A1%D1%82%D0%B0%D0%B1%D1%8B\">Стабы</a></li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%A0%D0%B5%D1%81%D1%83%D1%80%D1%81%D1%8B-%D0%B8-%D0%BF%D1%83%D1%82%D0%B8\">Ресурсы и пути</a></li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%91%D0%B0%D0%B7%D0%B0-%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85\">База данных</a></li>\n</ul>\n</li>\n</ul>\n<h2>Основные понятия</h2>\n<p>На тему тестов написано много книг и статей, придуманы разные методологии. Их\nсторонники отстаивают позиции в бесконечных спорах. Начинающих сбивает с толку\nобилие терминов и фрагментация мнений. Вводный раздел к этой главе поможет\nчитателю погрузиться в тему. Расскажем основные моменты тестирования простыми\nсловами.</p>\n<p>Тест — это код, который проверяет другой код. Например, мы написали функцию для\nперевода температуры из Цельсия в Фаренгейты:</p>\n<div><div><pre><code><span>(</span><span>defn</span><span> </span><span>->fahr</span><span> </span><span>[</span><span>cel</span><span>]</span><span>\n</span><span>(</span><span>+</span><span> </span><span>(</span><span>*</span><span> </span><span>cel</span><span> </span><span>1.8</span><span>)</span><span> </span><span>32</span><span>))</span><span>\n</span></code></pre></div></div>\n<p>Мы вызвали ее вручную несколько раз убедились, что результаты такие же, как в\nшкольном справочнике. Зафиксируем расчеты в специальной функции\nпроверки. Функция сравнивает вызов <code>->fahr</code> с каноничными значениями 68 и 212. Их\nпосчитали заранее и расценивают как верные.</p>\n<div><div><pre><code><span>(</span><span>defn</span><span> </span><span>test-fahr</span><span> </span><span>[]</span><span>\n</span><span>(</span><span>assert</span><span> </span><span>(</span><span>=</span><span> </span><span>(</span><span>int</span><span> </span><span>(</span><span>->fahr</span><span> </span><span>20</span><span>))</span><span> </span><span>68</span><span>))</span><span>\n</span><span>(</span><span>assert</span><span> </span><span>(</span><span>=</span><span> </span><span>(</span><span>int</span><span> </span><span>(</span><span>->fahr</span><span> </span><span>100</span><span>))</span><span> </span><span>212</span><span>)))</span><span>\n</span></code></pre></div></div>\n<p>Макрос assert бросает исключение, если его тело вычисляется в ложь. На данный\nмомент вызов <code>(test-fahr)</code> вернет nil без ошибок. Если внести в алгоритм\nизменения, функция бросит исключение:</p>\n<div><div><pre><code><span>(</span><span>defn</span><span> </span><span>->fahr</span><span> </span><span>[</span><span>cel</span><span>]</span><span>\n</span><span>(</span><span>+</span><span> </span><span>(</span><span>*</span><span> </span><span>cel</span><span> </span><span>1.9</span><span>)</span><span> </span><span>32</span><span>))</span><span>\n</span><span>(</span><span>test-fahr</span><span>)</span><span>\n</span><span>Assert</span><span> </span><span>failed</span><span>:</span><span> </span><span>(</span><span>=</span><span> </span><span>(</span><span>int</span><span> </span><span>(</span><span>->fahr</span><span> </span><span>20</span><span>))</span><span> </span><span>68</span><span>)</span><span>\n</span></code></pre></div></div>\n<p>Функция <code>test-fahr</code> и есть тест. Она проверяет, что никто не изменил код\n<code>->fahr</code> так, что мы получим другие результаты. В наших интересах вызвать\n<code>(test-fahr)</code> перед сборкой программы. Так мы не допустим, чтобы алгоритм с\nошибкой попал в производство.</p>\n<p>Техническая деталь: в тесте выше мы сравниваем результат ->fahr с целым\nчислом. Без обертки в (int …) функция вернет число с плавающей запятой,\nкоторое трудно сравнить с другим таким же числом. Поэтому мы приводим значение к\nцелому.</p>\n<p>Тест не знает о внутреннем устройстве функции, которую проверяет. Мы вправе\nменять алгоритм до тех пор, пока тест выполняется без ошибок. Предположим, мы\nтестируем функцию факториала. Первая версия работает как линейное перемножение\nчисел, что не эффективно. Но уже для первой версии мы написали тест, который\nпроверяют, что (= (fact 5) 120). Если заменить линейный алгоритм на дерево или\nтаблицу значений, тест должен пройти без ошибок. В противном случае это значит,\nчто в новом алгоритме ошибка.</p>\n<h3>Кейсы и покрытие</h3>\n<p>Близкие по семантике тесты объединяются в тест-кейсы. Вспомним школьную задачу с\nквадратным уравнением. Требуется найти корни по заданным коэффициентам a, b,\nc. Особенность этой задачи в том, что ее логика ветвится. В зависимости от\nпараметров может быть два корня, один или ни одного.</p>\n<div><div><pre><code><span>(</span><span>defn</span><span> </span><span>square-roots</span><span> </span><span>[</span><span>a</span><span> </span><span>b</span><span> </span><span>c</span><span>]</span><span>\n</span><span>(</span><span>let</span><span> </span><span>[</span><span>D</span><span> </span><span>(</span><span>-</span><span> </span><span>(</span><span>*</span><span> </span><span>b</span><span> </span><span>b</span><span>)</span><span> </span><span>(</span><span>*</span><span> </span><span>4</span><span> </span><span>a</span><span> </span><span>c</span><span>))]</span><span>\n</span><span>(</span><span>cond</span><span>\n</span><span>(</span><span>pos?</span><span> </span><span>D</span><span>)</span><span> </span><span>[(</span><span>/</span><span> </span><span>(</span><span>+</span><span> </span><span>(</span><span>-</span><span> </span><span>b</span><span>)</span><span> </span><span>(</span><span>Math/sqrt</span><span> </span><span>D</span><span>))</span><span> </span><span>(</span><span>*</span><span> </span><span>2</span><span> </span><span>a</span><span>))</span><span>\n</span><span>(</span><span>/</span><span> </span><span>(</span><span>-</span><span> </span><span>(</span><span>-</span><span> </span><span>b</span><span>)</span><span> </span><span>(</span><span>Math/sqrt</span><span> </span><span>D</span><span>))</span><span> </span><span>(</span><span>*</span><span> </span><span>2</span><span> </span><span>a</span><span>))]</span><span>\n</span><span>(</span><span>zero?</span><span> </span><span>D</span><span>)</span><span> </span><span>(</span><span>/</span><span> </span><span>(</span><span>-</span><span> </span><span>b</span><span>)</span><span> </span><span>(</span><span>*</span><span> </span><span>2</span><span> </span><span>a</span><span>))</span><span>\n</span><span>(</span><span>neg?</span><span> </span><span>D</span><span>)</span><span> </span><span>nil</span><span>)))</span><span>\n</span></code></pre></div></div>\n<p>Чтобы проверить алгоритм, тест вызывает функцию (square-roots a b c) минимум три\nраза. Параметры должны быть подобраны таким образом, чтобы отработала каждая\nветка. Еще лучше, если на каждую ветку приходится отдельный тест с разными\nзначениями. Каждый тест можно расширить в будущем. Три теста ниже образуют кейс,\nкоторый проверяет алгоритм целиком.</p>\n<div><div><pre><code><span>(</span><span>defn</span><span> </span><span>test-square-roots-two-roots</span><span> </span><span>[]</span><span>\n</span><span>(</span><span>let</span><span> </span><span>[[</span><span>x1</span><span> </span><span>x2</span><span>]</span><span> </span><span>(</span><span>square-roots</span><span> </span><span>1</span><span> </span><span>-5</span><span> </span><span>6</span><span>)]</span><span>\n</span><span>(</span><span>assert</span><span> </span><span>(</span><span>=</span><span> </span><span>[(</span><span>int</span><span> </span><span>x1</span><span>)</span><span> </span><span>(</span><span>int</span><span> </span><span>x2</span><span>)]</span><span> </span><span>[</span><span>3</span><span> </span><span>2</span><span>]))))</span><span>\n</span><span>(</span><span>defn</span><span> </span><span>test-square-roots-one-root</span><span> </span><span>[]</span><span>\n</span><span>(</span><span>assert</span><span> </span><span>(</span><span>=</span><span> </span><span>(</span><span>square-roots</span><span> </span><span>1</span><span> </span><span>6</span><span> </span><span>9</span><span>)</span><span> </span><span>-3</span><span>)))</span><span>\n</span><span>(</span><span>defn</span><span> </span><span>test-square-roots-no-roots</span><span> </span><span>[]</span><span>\n</span><span>(</span><span>assert</span><span> </span><span>(</span><span>=</span><span> </span><span>(</span><span>square-roots</span><span> </span><span>2</span><span> </span><span>4</span><span> </span><span>7</span><span>)</span><span> </span><span>nil</span><span>)))</span><span>\n</span></code></pre></div></div>\n<p>Как правило, в объектно-ориентированных языках кейсы это классы, а тесты — их\nметоды. Но в мире Clojure тест это просто функция.</p>\n<p>В разговорах о тестах часто упоминают их покрытие. Под этим словом имеют в виду\nдолю кода, которая сработала в момент запуска теста. Предположим, мы написали\nтесты только для двух корней. В этом случае ветки (zero? D) и (neg? D) не\nвыполнятся. Специальный модуль в тестовом фреймворке читает общее число строк в\nисходной функции, количество исполненных строк и коэффициент\nпокрытия. Продвинутые фреймворки строят отчет, где выполненные строки помечены\nзеленым (плюсом), а пропущенные красным (минусом).</p>\n<div><div><pre><code><span>+(defn square-roots [a b c]\n+ (let [D (- (* b b) (* 4 a c))]\n+ (cond\n+ (pos? D) [(/ (+ (- b) (Math/sqrt D)) (* 2 a))\n+ (/ (- (- b) (Math/sqrt D)) (* 2 a))]\n</span><span>- (zero? D) (/ (- b) (* 2 a))\n- (neg? D) nil)))\n</span></code></pre></div></div>\n<p>В функции square-roots всего 7 строк. При запуске test-square-roots-two-roots\nсработали 5 из них. Покрытие составит 5/7, что приблизительно 71%.</p>\n<p>Принято считать, что покрытия 80% достаточно для того, чтобы код работал\nнадежно. Значения ниже говорят о недостаточном покрытии. Это значит, в проекте\nвстречается код, который не защищен от спонтанных изменений. При попытке\nприблизиться к 100% возрастают затраты на разработку и поддержку тестов. Поэтому\nв каждой команде придерживаются той величины, которая удобна для производства.</p>\n<p>Процентная величина не должна затмевать здравый смысл. В примере выше цифра 71%\nкажется большой только на первый взгляд. Из покрытия видно, что мы проверяем\nодну ветку алгоритма из трех. Если в двух других затаились ошибки, мы не узнаем\nо них. При оценке покрытия программист смотрит не на процентную величину, а на\nветвления алгоритма. Надежные тесты гарантируют, что сработала каждая ветка.</p>\n<h3>Не только числа</h3>\n<p>У начинающих складывается мнение, что тесты пишут в основном для математических\nрасчетов. Это не так. Тесты подходят для всех функций, поведение которых хотят\nзафиксировать. Это может быть обработка коллекций, криптография, операции с\nтекстом, словом — что угодно.</p>\n<p>Рассмотрим пример с подписью командной строки. Функция sign-params принимает\nсловарь параметров и секретный ключ. Алгоритм подписи следующий:</p>\n<ul>\n<li>отсортировать параметры по именам ключей;</li>\n<li>составить строку вида <code>param1=value1&amp;param2=value2...</code>;</li>\n<li>экранировать некоторые символы, например, пробел, знак плюса и другие;</li>\n<li>получить сигнатуру строки по алгоритму HMAC SHA256 и секретному ключу;</li>\n<li>вернуть словарь параметров с полем <code>:signature</code></li>\n</ul>\n<p>По такому принципу работает авторизация в API популярных сервисов и социальных\nсетей. Напишем простой тест для функции подписи. Проверим, что входные параметры\nдополнены сигнатурой, которую мы посчитали заранее.</p>\n<div><div><pre><code><span>(</span><span>defn</span><span> </span><span>test-sign-params</span><span> </span><span>[]</span><span>\n</span><span>(</span><span>let</span><span> </span><span>[</span><span>api-key</span><span> </span><span>&quot;2Ag48&amp;@%776^634Tsdf23&quot;</span><span>\n</span><span>params</span><span> </span><span>{</span><span>:action</span><span> </span><span>:postComment</span><span>\n</span><span>:user_id</span><span> </span><span>42</span><span>\n</span><span>:post_id</span><span> </span><span>1999</span><span>\n</span><span>:comment</span><span> </span><span>&quot;This is a great article!&quot;</span><span>}</span><span>\n</span><span>signature</span><span> </span><span>&quot;e36b331823b...&quot;</span><span>]</span><span>\n</span><span>(</span><span>assert</span><span> </span><span>(</span><span>=</span><span> </span><span>(</span><span>sign-params</span><span> </span><span>params</span><span> </span><span>api-key</span><span>)</span><span>\n</span><span>(</span><span>assoc</span><span> </span><span>params</span><span> </span><span>:signature</span><span> </span><span>signature</span><span>)))))</span><span>\n</span></code></pre></div></div>\n<p>Заметим, что sign-params работает не с числами, а коллекциями, строками и\nкриптографией. Это не помешало написать для нее тест. Чтобы улучшить нашу\nработу, добавьте проверку на пустой ключ, экранирование символов, кириллические\nязыки, эмодзи и так далее.</p>\n<h3>Когда писать тесты</h3>\n<p>Начинающие разработчики иногда не понимают, какие функции покрывать\nтестами. Случается и другая крайность: тесты пишут строго для каждой функции из\nмодуля. Это приводит к их избыточности и замедляет разработку. Верное решение,\nкак всегда, находится посередине.</p>\n<p>Покрывать тестами следует те функции, которые атомарны с точки зрения\nбизнес-логики. Например, подпись запроса состоит из множества других функций\nрангом ниже: сортировки, экранирования и других. Но это технические шаги, детали\nреализации. На высоком уровне подпись — один из промежуточных шагов\nбизнес-логики, и технические тонкости отходят на задний план.</p>\n<p>Разделять бизнес-логику и код это особый навык программиста. Пишите тесты так,\nчтобы они проверяли именно логику, а не код. Это абстрактный навык, и его трудно\nпередать на словах. Здесь и помогут тесты: они подтолкнут вас писать код с\nупором на потребности бизнеса.</p>\n<h3>О чистоте функций</h3>\n<p>Из примеров выше следует важное правило. Функцию удобно тестировать, если она не\nнесет побочных эффектов. Это значит, что функция не обращается к диску или сети,\nне меняет глобальные переменные. Ее результат зависит только от входных\nпараметров.</p>\n<p>Представим, что функция читает данные из файла. Это значит, что перед запуском\nтеста мы обязаны записать файл в нужное место, а после запуска удалить\nего. Технически это возможно, но тесты становятся сложнее: теперь они зависят от\nокружающей среды.</p>\n<p>Чтобы облегчить тестирование, функцию разделяют на две. Первая читает содержимое\nфайла и передает на обработку второй. Тогда мы сможем тестировать вторую\nфункцию, вызывая ее со строкой.</p>\n<p>Было:</p>\n<div><div><pre><code><span>(</span><span>defn</span><span> </span><span>process-csv</span><span> </span><span>[</span><span>path</span><span>]</span><span>\n</span><span>(</span><span>let</span><span> </span><span>[</span><span>content</span><span> </span><span>(</span><span>slurp</span><span> </span><span>path</span><span>)]</span><span>\n</span><span>(</span><span>for</span><span> </span><span>[</span><span>line</span><span> </span><span>(</span><span>clojure.string/split</span><span> </span><span>content</span><span> </span><span>#</span><span>&quot;\\n&quot;</span><span>)]</span><span>\n</span><span>(</span><span>remap-line</span><span> </span><span>line</span><span>))))</span><span>\n</span></code></pre></div></div>\n<p>Стало:</p>\n<div><div><pre><code><span>(</span><span>defn</span><span> </span><span>process-csv-content</span><span> </span><span>[</span><span>content</span><span>]</span><span>\n</span><span>(</span><span>for</span><span> </span><span>[</span><span>line</span><span> </span><span>(</span><span>clojure.string/split</span><span> </span><span>content</span><span> </span><span>#</span><span>&quot;\\n&quot;</span><span>)]</span><span>\n</span><span>(</span><span>remap-line</span><span> </span><span>line</span><span>)))</span><span>\n</span><span>(</span><span>defn</span><span> </span><span>process-csv</span><span> </span><span>[</span><span>path</span><span>]</span><span>\n</span><span>(</span><span>process-csv-content</span><span> </span><span>(</span><span>slurp</span><span> </span><span>path</span><span>)))</span><span>\n</span></code></pre></div></div>\n<p>Напишем тест для process-csv-content:</p>\n<div><div><pre><code><span>(</span><span>def</span><span> </span><span>CONTENT</span><span>\n</span><span>(</span><span>str</span><span> </span><span>&quot;Ivan;ivan@test.ru;http://example.ru&quot;</span><span>\n</span><span>\\n</span><span>ewline</span><span>\n</span><span>&quot;John;john@test.com;http://example.com&quot;</span><span>))</span><span>\n</span><span>(</span><span>assert</span><span> </span><span>(</span><span>=</span><span> </span><span>(</span><span>process-csv-content</span><span> </span><span>CONTENT</span><span>)</span><span>\n</span><span>[{</span><span>:name</span><span> </span><span>&quot;Ivan&quot;</span><span> </span><span>:email</span><span> </span><span>...</span><span>}</span><span>\n</span><span>{</span><span>:name</span><span> </span><span>&quot;John&quot;</span><span> </span><span>:email</span><span> </span><span>...</span><span>}]))</span><span>\n</span></code></pre></div></div>\n<p>Другой способ в том, чтобы заменить функцию на мультиметод. Его реализация\nзависит от типа первого аргумента. Если это java.io.File, мы читаем файл и\nвызываем метод с содержимым. Для String срабатывает разбор данных.</p>\n<p>Чистая функция — это идеальный случай тестирования. На практике мы столкнемся с\nтем, что промышленный код трудно изолировать от побочных эффектов. В некоторых\nслучаях это даже невозможно. Чтобы тестировать код с эффектами, прибегают к\nрасширенным практикам: используют объекты-заглушки (стабы), подменяют объекты в\nпамяти (моки). Эти и другие приемы мы рассмотрим ниже.</p>\n<p>Запомните, что подмена среды это вынужденная мера, и к ней прибегают в последнюю\nочередь. Перед тестированием проверьте, можно ли выделить из кода его чистую\nчасть. Если да, создайте отдельную функцию и тестируйте ее.</p>\n<h3>Производство</h3>\n<p>Тесты не только проверяют логику приложения. Они помогают проекту на разных\nстадиях производства. Например, ветку с изменениями нельзя слить в мастер до тех\nпор, пока не пройдут все тесты. Этим вы обезопасите код от случайных изменений.</p>\n<p>Если разработчик добавил код, не не покрыл его тестами, это снизит долю\nпокрытия. Можно задать правило, что при значении ниже заданного слияние такой\nветки запрещено. Сервисы GitHub, CircleCI и другие гибко реагируют на ошибки в\nтестах. Они шлют письма с отчетом, пишут сообщения в Slack, всячески\nсигнализируют о проблеме.</p>\n<p>В некоторых случаях тесты заменяют документацию. Это утверждение нельзя\nвоспринимать буквально — настоящую документацию не заменит ничто. Но в open\nsource-проектах ее недостаток иногда компенсируют тестами. Это нормально, потому\nчто на качественную документацию уходит столько же времени, сколько на\nтехническую часть. Если вы не уверены, как работает та или иная функция,\nвозможно, ее поведение прояснится из тестов.</p>\n<h3>Устройство тестов</h3>\n<p>Функции с макросом assert это сильно упрощенные тесты. Они пригодятся на раннем\nэтапе разработки, когда автор только обозначил контуры программы. Assert-ы это\nвременные меры чтобы сдержать код от изменений. Для полноценной работы с тестами\nпонадобится фремворк. Это библиотека, которая определяет, где и как описаны\nтесты.</p>\n<p>Когда выполнить команду lein test в папке проекта, тем самым мы запустим\nтестовый фреймворк. Это сложный цикл из нескольких шагов. Мы рассмотрим основные\nиз них, чтобы читатель понимал так называемый стек тестов.</p>\n<p>На первом этапе фреймворк ищет тесты в кодовой базе проекта. По-другому фаза\nназывается test discovery. Это не простая задача: фреймворк загружает все модули\nи ищет среди них тесты. Каждый найденный тест попадает в глобальный регистр.</p>\n<p>Тест должен носить какой-то признак, по которому его можно отличить от обычной\nфункции. В примере выше test-sign-params это именно функция, а не тест (префикс\ntest- не делает функцию тестом). Далее мы рассмотрим, как превратить ее в тест.</p>\n<p>Когда тесты найдены, система определяет, какие из них будут запущены. Если\nфильтры не заданы, сработают все тесты. Иногда нужно выполнить тесты только из\nопределенного модуля или по признаку. Ести такие параметры заданы, сработает\nфильтрация тестов.</p>\n<p>На этапе прогона фреймворк выполняет тесты один за другим как функции. Система\nфиксирует их количество и имена. Вызов теста обернут в try/catch, чтобы\nисключение не прервало процесс. Каждая проверка попадает в глобальную\nпеременную. Эти сведения необходимы, чтобы построить отчет.</p>\n<p>На этапе отчета система выводит накопленные данные в консоль. Качественный\nфреймворк отличает удобство вывода — насколько он понятен человеку. Проблемные\nтесты должны быть обозначены красным цветом. Для неудачных сравнений мы ожидаем\nполные формы, а не финальные значения. Например, <code>(= (int (->fahr 20)) 68)</code>\nвместо <code>(= 69 68)</code>.</p>\n<p>Промышленные фреймворки показывают отчет в разных форматах. Кроме текста в\nконсоли это может быть HTML-файл. Систему сборки настраивают так, что отчет о\nтестах публикуется на внутреннем веб-сервере по адресу\n<code>/&lt;project>-&lt;artifact>-test.html</code>. Часть <code>&lt;artifact></code> это имя ветки или хэш\nкоммита.</p>\n<p>Стандарт XUnit определяет, как записать отчет в виде XML-файла. Промышленные\nсистемы вроде TeamCity и Atlassian понимают, как вывести этот файл в удобном\nвиде. XUnit удобен тем, что это стандарт. У вас могут быть тесты на Python,\nJavaScript или Clojure, но если прогон запущен с флагом –xunit (или подобным),\nотчеты будут выглядеть одинаково.</p>\n<p>Это был поверхностный обзор того, как устроен обычный тестовый фреймворк. В\nпоследующих разделах мы рассмотрим, как управлять им на каждом этапе.</p>\n<h3>Типы тестов</h3>\n<p>Прежде чем писать тесты, разберемся каких видов они бывают. Возможно, читатель\nслышал термины “юнит”, “интеграционные” и другие. На первый взгляд кажется, что\nэто излишняя классификация. На практике тесты из разных категорий отличаются\nстилем, окружением и порядком запуска.</p>\n<p>Понятие “юнит-тест” происходит от английского unit, модуль. Термин пришел из\nмира Java и фреймворка JUnit. Согласно его идеологии, тесты группируют по\nмодулям. На каждый модуль из кодовой базы приходится одноименный тестовый,\nкоторый проверяет функциональность первого.</p>\n<p>Юнит-тесты это простой способ зафиксировать логику приложения. Чаще всего проект\nвключает только эту категорию тестов. Юнит-тестирование поощряет чистые\nфункции. Чем меньше требований к окружению тестов, тем они удобней в\nподдержке. Рассматривайте юнит-тесты как проверку отдельных частей приложения\n(но не всего разом). Примеры выше подходят под категорию юнит-тестов.</p>\n<p>Интеграционные тесты решают проблему, с которой не справляются юнит-тесты. Даже\nкогда отдельные части приложения проверены, в их совместной работе может что-то\nпойти не так. Это известный феномен; про него говорят, что целое больше суммы\nего частей.</p>\n<p>В качестве примера вспомним регистрацию на сайте. Это сложный процесс из\nнескольких шагов:</p>\n<ul>\n<li>проверить, что такого пользователя нет в базе;</li>\n<li>создать временную учетную запись;</li>\n<li>сгенерировать ссылку для подтверждения записи;</li>\n<li>отправить письмо с этой ссылкой;</li>\n<li>проверить, что ссылка не подделана и не вышел срок ее действия;</li>\n<li>активировать учетную запись.</li>\n</ul>\n<p>Даже если каждый шаг обильно покрыт тестами, это не гарантирует работу всей\nцепи. Например, письмо не уйдет адресату или попадет в спам. В одном из\nбраузеров не сработает AJAX-запрос или поедет верстка. Причины такого уровня\nслишком абстрактны, чтобы решать их на уровне юнит-тестов.</p>\n<p>Интеграционные тесты проверяют, что отдельные части системы согласованы друг с\nдругом. Такой тест выполняется в среде, максимально приближенный к\nреальности. Это главное отличие юнит-тестов от интеграционных: в первом случае\nокружение сужают, во втором расширяют.</p>\n<p>Чтобы проиграть сценарий регистрации, понадобится запущенная система и смежные\nресурсы: веб-сервер, почтовый сервер, база данных. Интеграционный тест\nподключается к браузеру по протоколу WebDriver и командует им. Открывает\nстраницу регистрации, вводит данные и нажимает кнопку. Проверяет, что появилось\nсообщение с просьбой проверить почту. По протоколу SMTP скачивает последнее\nписьмо. Ищет ссылку активации регулярным выражением. Открывает ссылку в новой\nвкладке. Переходит на страницу авторизации и вводит почту и пароль. Убеждается,\nчто попал в личный кабинет.</p>\n<p>Интеграционные тесты сложнее юнит-аналогов. Их труднее организовать, потому что\nтребуется настроить компоненты друг на друга и привести к нужному\nсостоянию. Например, если выполнить тест повторно, пользователь уже будет в базе\nданных, и сценарий оборвется.</p>\n<p>Интеграционные тесты выполняются дольше. Открыть страницу, дождаться ее загрузки\nи заполнить поля занимает больше времени, чем отправить запрос машинным\nспособом. Иногда управление браузером намеренно замедляют, чтобы согласовать\nкоманды с содержимым. Например, не кликнуть на кнопку, которую браузер еще не\nуспел отрисовать.</p>\n<p>Ошибки в интеграционных тестах требуют расследования. Юнит-тесты выводят отчет\nоб ошибках, где четко указано, какое выражение не равно чему. В интеграционных\nтестах причина ошибки чаще всего не ясна. Например, после отправки формы мы\nожидаем сообщение с просьбой проверить почту. Но оно не появилось. Была ли это\nошибка на сервере? И пользователь уже существует? Или в форме новое обязательное\nполе, которое мы не заполнили? Или сообщение изменилось так, что не ищется\nселектором? Ответ требует вмешательства человека.</p>\n<p>Чтобы проверить, как проект ведет себя под нагрузкой, прибегают к нагрузочному\nтестированию. Приложению посылают запросы и фиксируют множество показателей:\nвремя ответа, общее число запросов, сколько из них параллельны, потребление\nпроцессора и памяти. По этим данным строят отчеты и графики.</p>\n<p>Нагрузочное тестирование находит медленные части в проекте. С помощью него можно\nузнать, насколько готова новая функциональность к промышленному\nзапуску. Например, если боевой сервер обслуживает в среднем сто запросов в\nсекунду, а новая страница выдает только двадцать, ее отправят на доработку.</p>\n<p>К другим категориям тестов относятся Smoke-, Sanity-, регрессионные и\nдругие. Полный их список состоит из десяти и более пунктов. Мы не ставим цель\nрассмотреть их все. В этой главе мы глубоко изучим юнит- и интеграционные\nтесты. На этих двух категориях основаны остальные. Читателю хватит знаний, чтобы\nразобраться с ними самостоятельно.</p>\n<h2>Тесты в Clojure</h2>\n<p>Переходим к практике. В этом разделе мы познакомимся со стандартным тестовым\nфреймворком Clojure. Мы напишем настоящие тесты — такие, которые отвечают\nтребованиям фреймворка. Будем тестировать функции Фаренгейта и квадратного\nуравнения из примеров выше.</p>\n<p>Предположим, что функция ->fahr находится в модуле src/book/util.clj. Создайте\nфайл test/book/util_test.clj с содержимым:</p>\n<div><div><pre><code><span>(</span><span>ns</span><span> </span><span>book.util-test</span><span>\n</span><span>(</span><span>:require</span><span> </span><span>[</span><span>book.util</span><span> </span><span>:refer</span><span> </span><span>[</span><span>->fahr</span><span>]]</span><span>\n</span><span>[</span><span>clojure.test</span><span> </span><span>:refer</span><span> </span><span>[</span><span>deftest</span><span> </span><span>testing</span><span> </span><span>is</span><span>]]))</span><span>\n</span><span>(</span><span>deftest</span><span> </span><span>test-fahr</span><span>\n</span><span>(</span><span>is</span><span> </span><span>(</span><span>=</span><span> </span><span>(</span><span>int</span><span> </span><span>(</span><span>->fahr</span><span> </span><span>20</span><span>))</span><span> </span><span>68</span><span>))</span><span>\n</span><span>(</span><span>is</span><span> </span><span>(</span><span>=</span><span> </span><span>(</span><span>int</span><span> </span><span>(</span><span>->fahr</span><span> </span><span>100</span><span>))</span><span> </span><span>212</span><span>)))</span><span>\n</span></code></pre></div></div>\n<p>Получился тестовый модуль. Он импортирует ->fahr и объявляет для нее один тест\ntest-fahr. Макросы is и deftest заимствованы из пакета clojure.test. Это\nтестовый фреймворк из поставки Clojure.</p>\n<p>Шесть строк выше несут много новой информации. У читателя появятся резонные\nвопросы. Почему тесты лежат в папке test, а не src? Разве не логично хранить\nтесты рядом с тем, что они проверяют? Как система найдет их? Почему тест\nобъявляют особым макросом deftest? Автор утверждал, что тест это функция, или\nэто не так? Зачем было менять assert на is? Ответим на эти вопросы по порядку.</p>\n<p>В Clojure разделяют код приложения и тестов. Код приложения находится в папке\nsrc/, а тесты в test/. Такой подход несет преимущества. Во-первых, делит код на\nсмысловые части. Чтобы найти неисправный тест, мы сужаем область поиска до папки\ntest/, а не ищем по всему проекту. Во-вторых, когда тесты отделены, это снижает\nриск того, что они станут частью скомпилированного результата. В этом нет\nсмысла, потому что тесты запускают только на этапе разработки. Мы только\nувеличим время сборки и объем конечного файла.</p>\n<p>Во время тестов проект запускается с особым параметром. Он определяет, где еще\nкроме src/ искать исходные файлы. Технически это список, в котором по умолчанию\nодин путь src/. В режиме тестов система добавляет к нему путь test/. Когда\nкомпилятор ищет файл, он по очереди просматривает пути из списка. С точки зрения\nпрограммиста пути как будто сливаются друг с другом. Далее в главе мы\nрассмотрим, как настроить пути под нужды проекта.</p>\n<p>Мы упоминали, что фреймворку необходим какой-то признак, чтобы отличить тест от\nобычной функции. Макрос deftest объявляет функцию и сообщает ее метаданными\nособое поле :test. Чтобы выбрать все тесты, фреймворк сканирует пространства\nимен и читает метаданные каждой переменной. Если среди полей есть :test,\nпеременная считается тестом.</p>\n<p>Заметим, что deftest не оставляет возможности задать аргументы теста. Это\nсделано нарочно: в Clojure тест не зависит от внешних данных. Если тесту нужны\nособые условия, их задают фикстурами. Мы рассмотрим в фикстуры в отдельном\nразделе.</p>\n<p>Макрос is отличается от assert побочными эффектами. Assert это чистое сравнение:\nмы получим либо nil, либо исключение. Макрос is изменяет глобальные\nпеременные. Он записывает данные о том, сколько раз и с какими параметрами его\nвызвали. Из этих данных фреймворк строит отчет. Например, покажет все выражения\nкак они записаны в коде, которые не прошли проверку.</p>\n<p>Пока что мы только написали тест, но не запустили его. Clojure предлагает\nнесколько способов сделать это.</p>\n<h3>Командная строка</h3>\n<p>Самый простой способ — поручить прогон утилите для сопровождения проекта. Если\nпроект основан на Leiningen, достаточно вызвать в терминале lein\ntest. Потребуется некоторое время, чтобы загрузить код из папок src/ и test/,\nнайти тесты и выполнить их. Вы увидите следующий отчет:</p>\n<div><div><pre><code>lein test book.util-test\n\nRan 1 tests containing 2 assertions.\n0 failures, 0 errors.\n</code></pre></div></div>\n<p>Clojure группирует тесты по пространствам имен. Под каждым пространством сводная\nинформация о том, сколько выполнено тестов (объявлений deftest) и проверок\n(вызовов is). В нашем случае это один тест test-fahr с двумя проверками is.</p>\n<p>Выражени lein test book.util-test напечатано для того, чтобы его можно было\nскопировать и запустить в терминале. Тогда сработают тесты только из\nпространства book.util-test.</p>\n<p>Фреймворк различает т.н. failures и errors. Failure (анг. неудача) — это ошибка\nв проверке. Например, мы утверждаем, что (= (int (->fahr 20)) 68). Если формула\nизменится и значения станут не верны, счетчик failures увеличится на\nединицу. Каждое неудачное утверждение помнит о том, с какими параметрами его\nзапустили. Если была хотя бы одна неудача, мы увидим отчет об ошибке.</p>\n<p>Откройте определение ->fahr и измените коэффициент 1.8 на 1.9. Сохраните файл и\nзапустите в терминале lein test:</p>\n<div><div><pre><code>$ lein test\n\nlein test :only book.util-test/test-fahr\n\nFAIL in (test-fahr) (util_test.clj:6)\nexpected: (= (int (->fahr 20)) 68)\n  actual: (not (= 70 68))\n\nlein test :only book.util-test/test-fahr\n\nFAIL in (test-fahr) (util_test.clj:7)\nexpected: (= (int (->fahr 100)) 212)\n  actual: (not (= 222 212))\n\nRan 1 tests containing 2 assertions.\n2 failures, 0 errors.\nTests failed.\n</code></pre></div></div>\n<p>Отчет показывает 2 failures, что верно: в теле test-fahr макрос is встречается\nдва раза. Обе проверки неверны, потому что опираются на ->fahr. Для каждой из\nних отчет показывает исходное выражение (= (int (->fahr 100)) 212) и конечные\nзначения (= 222 212).</p>\n<p>Выражение</p>\n<div><div><pre><code>lein test :only book.util-test/test-fahr\n</code></pre></div></div>\n<p>, которое отчет выводит над каждой проверкой, запустит только указанный\nтест. Это полезно, когда вы работаете над определенным участком кода запускаете\nодин и тот же тест много раз.</p>\n<p>Errors или ошибки это непойманные исключения, которые случились во время работы\nтеста. Чаще всего ошибки возникают, когда в функции передают некорректные\nданные. Например, мы решили проверить поведение ->fahr с nil. Добавим второй\nтест:</p>\n<div><div><pre><code><span>(</span><span>deftest</span><span> </span><span>test-fahr-nil</span><span>\n</span><span>(</span><span>is</span><span> </span><span>(</span><span>nil?</span><span> </span><span>(</span><span>->fahr</span><span> </span><span>nil</span><span>))))</span><span>\n</span></code></pre></div></div>\n<p>Отчет будет таким:</p>\n<div><div><pre><code><span>$</span><span> </span><span>lein</span><span> </span><span>test</span><span>\n</span><span>lein</span><span> </span><span>test</span><span> </span><span>:only</span><span> </span><span>book.util-test/test-fahr-nil</span><span>\n</span><span>ERROR</span><span> </span><span>in</span><span> </span><span>(</span><span>test-fahr-nil</span><span>)</span><span> </span><span>(</span><span>Numbers.java</span><span>:3849</span><span>)</span><span>\n</span><span>expected</span><span>:</span><span> </span><span>(</span><span>nil?</span><span> </span><span>(</span><span>->fahr</span><span> </span><span>nil</span><span>))</span><span>\n</span><span>actual</span><span>:</span><span> </span><span>java.lang.NullPointerException</span><span>:</span><span> </span><span>null</span><span>\n</span><span>at</span><span> </span><span>clojure.lang.Numbers.multiply</span><span> </span><span>(</span><span>Numbers.java</span><span>:3849</span><span>)</span><span>\n</span><span>book.util$__GT_fahr.invokeStatic</span><span> </span><span>(</span><span>util.clj</span><span>:5</span><span>)</span><span>\n</span><span>book.util$__GT_fahr.invoke</span><span> </span><span>(</span><span>util.clj</span><span>:4</span><span>)</span><span>\n</span><span>book.util_test$fn__370.invokeStatic</span><span> </span><span>(</span><span>util_test.clj</span><span>:10</span><span>)</span><span>\n</span><span>book.util_test/fn</span><span> </span><span>(</span><span>util_test.clj</span><span>:9</span><span>)</span><span>\n</span><span>...</span><span> </span><span>&lt;truncated></span><span>\n</span><span>Ran</span><span> </span><span>2</span><span> </span><span>tests</span><span> </span><span>containing</span><span> </span><span>3</span><span> </span><span>assertions.</span><span>\n</span><span>0</span><span> </span><span>failures,</span><span> </span><span>1</span><span> </span><span>errors.</span><span>\n</span><span>Tests</span><span> </span><span>failed.</span><span>\n</span></code></pre></div></div>\n<p>Вызов (->fahr nil) приводит к выбросу NullPointerException. Фреймворк\nоборачивает тест в try/catch и запоминает исключение. Для ошибок отчет выводит\nих стек-трейс. В примере выше мы сократили его для экономии места.</p>\n<p>Непойманные исключения говорят о том, что тесты спроектированы неудачно. Скорее\nвсего, тест вышел из-под контроля и делает что-то не то. Например, вы не\nпроверили, что результат функции положительный перед тем, как передать его в\nдругую функцию.</p>\n<p>Иногда мы ожидаем, что функция действительно бросит исключение при определенных\nпараметрах. Фреймворк готов к такому сценарию. Макрос is, записанный в особой\nформе, выражает это как обычное утверждение. Мы рассмотрим пример с исключениями\nв следующем разделе.</p>\n<h3>REPL</h3>\n<p>У тестов в консоли один недостаток: это долго. Код на Clojure, когда загружен в\nпамять, выполняется быстро, но его загрузка занимает от трех до десяти\nсекунд. Время зависит от подключенных библиотек, размера кодовой базы и мощности\nкомпьютера. Даже если вы запускаете один тест, lein стартует новую копию\nпроекта, что неэффективно.</p>\n<p>Когда вы работаете с проектом, скорее всего, вы подключены к его сеансу\nREPL. Будет удобно выполнить тест прямо в REPL по команде, не запуская новый\nпроект. Тогда издержки на загрузку кода станут равны нулю.</p>\n<p>Наивный способ выполнить тест — запустить его как функцию. Выражение (test-fahr)\nвернет nil, что означает, что все утверждения сработали верно. Теперь исправим\nтест: пусть одно из утверждений заведомо ошибочно:</p>\n<div><div><pre><code><span>(</span><span>is</span><span> </span><span>(</span><span>=</span><span> </span><span>(</span><span>int</span><span> </span><span>(</span><span>->fahr</span><span> </span><span>20</span><span>))</span><span> </span><span>999</span><span>))</span><span>\n</span></code></pre></div></div>\n<p>Даже если сохранить файл и вызвать (test-fahr), по-прежнему получим результат\nбез ошибок. Это происходит потому, что мы только сохранили файл, но не загрузили\nновый теста в память JVM. То, как изменения в файле перетекают в память\nLisp-машины, зависит от вашего окружения.</p>\n<p>Если это Emacs/CIDER, выполните одно из действий. Переместите курсор за\nпоследнюю закрывающую скобку формы (deftest test-fahr …) и нажмите C-c\nC-e. Сработает команда cider-eval-last-sexp, которая выполняет последнее\nS-выражение. Другой способ в том, чтобы выполнить весь буфер. Независимо от\nтого, где сейчас курсор, нажмите C-c C-k (или M-x cider-eval-buffer ). Эта\nкоманда равносильна тому, чтобы скопировать буфер и вставить в сеанс REPL.</p>\n<p>Повторный вызов (test-fahr) вернет nil, но в консоли появятся строки:</p>\n<div><div><pre><code><span>FAIL</span><span> </span><span>in</span><span> </span><span>(</span><span>test-fahr</span><span>)</span><span> </span><span>(</span><span>util_test.clj</span><span>:14</span><span>)</span><span>\n</span><span>expected</span><span>:</span><span> </span><span>68</span><span>\n</span><span>actual</span><span>:</span><span> </span><span>(</span><span>999</span><span>)</span><span>\n</span></code></pre></div></div>\n<p>Если вызвать тест (test-fahr-nil), который мы все еще не исправили, увидим\nданные об исключении:</p>\n<div><div><pre><code><span>ERROR</span><span> </span><span>in</span><span> </span><span>(</span><span>test-fahr-nil</span><span>)</span><span> </span><span>(</span><span>Numbers.java</span><span>:3849</span><span>)</span><span>\n</span><span>expected</span><span>:</span><span> </span><span>(</span><span>nil?</span><span> </span><span>(</span><span>->fahr</span><span> </span><span>nil</span><span>))</span><span>\n</span><span>actual</span><span>:</span><span> </span><span>java.lang.NullPointerException</span><span>:</span><span> </span><span>null</span><span>\n</span><span>at</span><span> </span><span>clojure.lang.Numbers.multiply</span><span> </span><span>(</span><span>Numbers.java</span><span>:3849</span><span>)</span><span>\n</span><span>book.util$__GT_fahr.invokeStatic</span><span> </span><span>(</span><span>form-init3606582116051051694.clj</span><span>:5</span><span>)</span><span>\n</span><span>book.util$__GT_fahr.invoke</span><span> </span><span>(</span><span>form-init3606582116051051694.clj</span><span>:4</span><span>)</span><span>\n</span><span>...</span><span>\n</span></code></pre></div></div>\n<p>Заметим, это только вывод в консоль, а не брошенное исключение. Тест устроен\nтак, что его тело обернуто в try/catch. Поэтому дополнительно оборачивать вызов\nтеста не нужно.</p>\n<p>Когда тест запускают вручную как функцию, к нему не применяются фикстуры. Это\nпре- и пост-обработчики, которые подготавливают среду для теста. О фикстурах мы\nпоговорим в дальнейших разделах главы. Пока что отметим, что функция test-vars\nвыполняет тесты с учетом фикстур. Она принимает вектор объектов Var:</p>\n<div><div><pre><code><span>(</span><span>require</span><span> </span><span>'</span><span>[</span><span>clojure.test</span><span> </span><span>:refer</span><span> </span><span>[</span><span>test-vars</span><span>]])</span><span>\n</span><span>(</span><span>test-vars</span><span> </span><span>[</span><span>#</span><span>'test-fahr</span><span> </span><span>#</span><span>'test-fahr-nil</span><span>])</span><span>\n</span></code></pre></div></div>\n<p>Функция run-test запускает все тесты пространства (текущего или\nуказанного). Технически она сводится к вызову test-vars со всеми переменными из\nэтого пространства:</p>\n<div><div><pre><code><span>(</span><span>require</span><span> </span><span>'</span><span>[</span><span>clojure.test</span><span> </span><span>:refer</span><span> </span><span>[</span><span>run-tests</span><span>]])</span><span>\n</span><span>(</span><span>run-tests</span><span>)</span><span>\n</span></code></pre></div></div>\n<p>Еще одна функция run-all-tests из выполняет тесты для всех загруженных\nпространств:</p>\n<div><div><pre><code><span>(</span><span>require</span><span> </span><span>'</span><span>[</span><span>clojure.test</span><span> </span><span>:refer</span><span> </span><span>[</span><span>run-all-tests</span><span>]])</span><span>\n</span><span>(</span><span>run-all-tests</span><span>)</span><span>\n</span></code></pre></div></div>\n<p>Запустив это выражение, вы увидете, как тестовый фреймворк перебирает все\nзагруженные модули:</p>\n<div><div><pre><code>Testing nrepl.middleware.interruptible-eval\nTesting cider.nrepl.middleware.util.nrepl\nTesting clojure.test\nTesting clojure.core.server\nTesting clojure.core.specs.alpha\nTesting book.util\n...\n</code></pre></div></div>\n<p>Чтобы отбросить лишние пространства, в run-all-tests передают регулярное\nвыражение. С этим выражением сверяют имена пространств. Например, чтобы\nвыполнить только наши тесты, укажем, что имя модуля начинается с book:</p>\n<div><div><pre><code><span>(</span><span>run-all-tests</span><span> </span><span>#</span><span>&quot;$book&quot;</span><span>)</span><span>\n</span></code></pre></div></div>\n<p>Emacs/CIDER</p>\n<p>Модуль CIDER для редактора Emacs упрощает работу с тестами. CIDER предлагает\nкоманды и комбинации клавиш, чтобы выполнить один или несколько тестов. Он же\nпоказывает отчет об ошибках в отдельном буфере. Вызвать тест клавишей гораздо\nбыстрее, чем печатать команду в REPL.</p>\n<p>Чтобы запустить один тест, переместите на него курсор и нажмите C-c C-t t (или\nM-x cider-test-run-test). Курсор может быть в любом месте (deftest …). Если\nтест прошел без ошибок, вы увидите в области сообщений зеленый текст. Если\nслучились ошибки, откроется специальный буфер <em>cider-test-report</em>.</p>\n<p>Этот буфер выводит отчет в более удобной форме. Ошибки в утверждениях подсвечены\nкрасным цветом, а непойманные исключения желтым. Буфер интерактивен: если\nподвести курсор к блоку с ошибкой и нажать Enter, соседний буфер покажет\nисходный код теста. То же самое работает для исключений: чтобы не засорять\nотчет, CIDER показывает только класс и сообщение. По Enter открывается отдельный\nбуфер с полным стек-трейсом.</p>\n<p>Перечислим другие полезные команды:</p>\n<ul>\n<li>\n<p><code>cider-test-rerun-failed-tests (C-c C-t f)</code> повторно выполняет неудачный тест\nиз прошлого запуска. Это удобно, если в первый раз вы запустили блок тестов, и\nошибка случилась где-то на середине.</p>\n</li>\n<li>\n<p><code>cider-test-run-ns-tests (C-c C-t n)</code> выполняет тесты для определенного\nпространства. С помощью этой команды можно запустить тесты без перехода в их\nмодуль. Чтобы сопоставить пространство и тесты, CIDER добавляет к имени\n“-test”. Например, для book.util целевой модуль получится <code>book.util-test</code>.</p>\n</li>\n</ul>\n<p>Запуск тестов это рутинная операция; избегайте ее ручного вызова. Чтобы не\nтерять время, изучите, как это сделать напрямую из редактора или IDE.</p>\n<h2>Полезные практики</h2>\n<p>В этом разделе мы рассмотрим несколько практик по написанию тестов. Поскольку\nтесты это тоже код, логично, что они нуждается в поддержке. Небрежные тесты\nпричиняют столько же проблем, сколько и основное приложение. Следующие приемы\nсделают тесты удобней в чтении, навигации и поддержке.</p>\n<h3>Testing</h3>\n<p>Макрос <code>testing</code> оборачивает произвольное тело строкой. Это сообщение, которое\nговорит о том, что мы собираемся делать:</p>\n<div><div><pre><code><span>(</span><span>deftest</span><span> </span><span>test-square-roots</span><span>\n</span><span>(</span><span>testing</span><span> </span><span>&quot;Two roots&quot;</span><span>\n</span><span>(</span><span>let</span><span> </span><span>[</span><span>result</span><span> </span><span>(</span><span>square-roots</span><span> </span><span>1</span><span> </span><span>-5</span><span> </span><span>6</span><span>)]</span><span>\n</span><span>(</span><span>is</span><span> </span><span>(</span><span>=</span><span> </span><span>(</span><span>mapv</span><span> </span><span>int</span><span> </span><span>result</span><span>)</span><span> </span><span>[</span><span>3</span><span> </span><span>2</span><span>]))))</span><span>\n</span><span>(</span><span>testing</span><span> </span><span>&quot;One root&quot;</span><span>\n</span><span>(</span><span>is</span><span> </span><span>(</span><span>=</span><span> </span><span>(</span><span>square-roots</span><span> </span><span>1</span><span> </span><span>6</span><span> </span><span>9</span><span>)</span><span> </span><span>-3</span><span>)))</span><span>\n</span><span>(</span><span>testing</span><span> </span><span>&quot;No roots&quot;</span><span>\n</span><span>(</span><span>is</span><span> </span><span>(</span><span>nil?</span><span> </span><span>(</span><span>square-roots</span><span> </span><span>2</span><span> </span><span>4</span><span> </span><span>7</span><span>)))))</span><span>\n</span></code></pre></div></div>\n<p>Сообщение важно по двум причинам: визуальной и технической. Оно разбивает тест\nна логические блоки, заменяет комментарии, делает тест понятнее. Если\nутверждение не сработало, в отчете будет указано сообщение, в которое оно\nобернуто.</p>\n<div><div><pre><code>(is (= (square-roots 1 6 10) -3))\n\nFail in test-square-roots\nOne root\nexpected: nil\n  actual: -3\n</code></pre></div></div>\n<p>Макросы testing могут быть вложенными. Тогда каждое следующее сообщение\nдобавляется к предыдущему через пробел. Тест ниже проверяет, что API createUser\nдействительно заносит пользователя его в базу данных. Дополнительно мы\nубеждаемся, что пароль в базе зашифрован. Если отбросить основной код, получим\nскелет теста из форм testing:</p>\n<div><div><pre><code><span>(</span><span>deftest</span><span> </span><span>test-some-api</span><span>\n</span><span>(</span><span>testing</span><span> </span><span>&quot;API call&quot;</span><span>\n</span><span>...</span><span>\n</span><span>(</span><span>testing</span><span> </span><span>&quot;HTTP response&quot;</span><span>\n</span><span>...</span><span>))</span><span>\n</span><span>(</span><span>testing</span><span> </span><span>&quot;DB checks&quot;</span><span>\n</span><span>...</span><span>\n</span><span>(</span><span>testing</span><span> </span><span>&quot;common user fields&quot;</span><span>\n</span><span>...</span><span>)</span><span>\n</span><span>(</span><span>testing</span><span> </span><span>&quot;password is hashed&quot;</span><span>\n</span><span>...</span><span>)))</span><span>\n</span></code></pre></div></div>\n<h3>Исключения</h3>\n<p>Мы все еще не решили вопрос о том, как проверять код с исключениями. Хотелось бы\nубедиться, что вызов (->fahr nil) порождает ошибку, а не возвращает nil. Если\nтеста на исключение нет, код не защищен от таких изменений:</p>\n<div><div><pre><code><span>(</span><span>defn</span><span> </span><span>->fahr</span><span> </span><span>[</span><span>cel</span><span>]</span><span>\n</span><span>(</span><span>when</span><span> </span><span>cel</span><span>\n</span><span>(</span><span>+</span><span> </span><span>(</span><span>*</span><span> </span><span>cel</span><span> </span><span>1.8</span><span>)</span><span> </span><span>32</span><span>)))</span><span>\n</span></code></pre></div></div>\n<p>В этом случае nil провалится ниже по стеку вызовов, что усложнит поиск причины.</p>\n<p>Пример ниже с try/catch решает проблему лишь отчасти. В таком виде (is true)\nдействительно сработает. Если же заменить (->fahr nil) на (->fahr 1), то\nисключения не произойдет, и ветка (catch…) будет отброшена вместе с\nсодержимым. Это значит, что исключение, которое не выбросили там, где его\nожидают, — тоже ошибка.</p>\n<div><div><pre><code><span>(</span><span>deftest</span><span> </span><span>test-fahr-nil</span><span>\n</span><span>(</span><span>try</span><span>\n</span><span>(</span><span>->fahr</span><span> </span><span>nil</span><span>)</span><span>\n</span><span>(</span><span>catch</span><span> </span><span>NullPointerException</span><span> </span><span>e</span><span>\n</span><span>(</span><span>is</span><span> </span><span>true</span><span>))))</span><span>\n</span></code></pre></div></div>\n<p>Макрос <code>(is (thrown?...))</code> решает эту проблему. Форма thrown? принимает класс\nисключения и произвольное тело. Если в момент исполнения было брошено исключение\nэтого класса (с учетом наследования), внешний (is…) сработает\nположительно. Если исключения не было, получим ошибку в утверждении:</p>\n<div><div><pre><code><span>(</span><span>deftest</span><span> </span><span>test-fahr-nil</span><span>\n</span><span>(</span><span>is</span><span> </span><span>(</span><span>thrown?</span><span> </span><span>NullPointerException</span><span>\n</span><span>(</span><span>->fahr</span><span> </span><span>nil</span><span>))))</span><span>\n</span></code></pre></div></div>\n<p>Исправьте nil на любое число и убедитесь, что тест не проходит.</p>\n<p>Иногда одной проверки на класс недостаточно. Когда тестируют большой участок\nкода, NullPointerException возникает на разных уровнях программы. Например, если\nкто-то изменит ->fahr так, что она возвращает nil, ошибка придет из другой\nфункции, которая принимает результат ->fahr. Это приводит к ложному\nтестированию: тест проходит, но на самом деле не фиксирует поведение программы.</p>\n<p>Проблему решают двумя шагами. Первый — исправить функцию так, чтобы она бросала\nчто-то более осмысленное, чем NPE. Например, специальное исключение\nIllegalArgumentException. Его дополняют сообщением о том, что пошло не так:</p>\n<div><div><pre><code><span>(</span><span>defn</span><span> </span><span>->fahr</span><span> </span><span>[</span><span>cel</span><span>]</span><span>\n</span><span>(</span><span>if</span><span> </span><span>cel</span><span>\n</span><span>(</span><span>+</span><span> </span><span>(</span><span>*</span><span> </span><span>cel</span><span> </span><span>1.8</span><span>)</span><span> </span><span>32</span><span>)</span><span>\n</span><span>(</span><span>throw</span><span> </span><span>(</span><span>new</span><span> </span><span>IllegalArgumentException</span><span>\n</span><span>&quot;Fahrenheit temperature should be a real number&quot;</span><span>))))</span><span>\n</span></code></pre></div></div>\n<p>Второй шаг — убедиться, что исключение пришло именно из ->fahr. Форма (is\n(thrown-with-msg?…)) проверяет, что текст исключения совпадает с регулярным\nвыражением. Тест ниже покрывает все перечисленные требования:</p>\n<div><div><pre><code><span>(</span><span>deftest</span><span> </span><span>test-fahr-nil</span><span>\n</span><span>(</span><span>is</span><span> </span><span>(</span><span>thrown-with-msg?</span><span>\n</span><span>IllegalArgumentException</span><span> </span><span>#</span><span>&quot;Fahrenheit temperature&quot;</span><span>\n</span><span>(</span><span>->fahr</span><span> </span><span>nil</span><span>))))</span><span>\n</span></code></pre></div></div>\n<h3>Пакетная проверка</h3>\n<p>Вспомним, как выглядит test-fahr:</p>\n<div><div><pre><code><span>(</span><span>deftest</span><span> </span><span>test-fahr</span><span>\n</span><span>(</span><span>is</span><span> </span><span>(</span><span>=</span><span> </span><span>(</span><span>int</span><span> </span><span>(</span><span>->fahr</span><span> </span><span>20</span><span>))</span><span> </span><span>68</span><span>))</span><span>\n</span><span>(</span><span>is</span><span> </span><span>(</span><span>=</span><span> </span><span>(</span><span>int</span><span> </span><span>(</span><span>->fahr</span><span> </span><span>100</span><span>))</span><span> </span><span>212</span><span>)))</span><span>\n</span></code></pre></div></div>\n<p>Второе утверждение это копия первого и отличается только числами. Чтобы добавить\nновую проверку, придется снова копировать одну из форм (is…). Подход с\nкопированием зашумляет код и в целом выходит боком. Очевидно, что из похожих\n(is…) можно выделить постоянную и переменную части и переписать тест в\nкороткой форме.</p>\n<p>Макрос are (анг. множественная форма глагола is) выполняет несколько is по\nшаблону. Он принимает форму связывания, шаблон выражения и произвольные\nаргументы. Число аргументов должно быть кратно переменным из формы\nсвязывания. На каждом шаге макрос связывает часть аргументов с переменными и\nвыполняет шаблон в рамках is:</p>\n<div><div><pre><code><span>(</span><span>deftest</span><span> </span><span>test-fahr</span><span>\n</span><span>(</span><span>are</span><span> </span><span>[</span><span>f</span><span> </span><span>c</span><span>]</span><span> </span><span>(</span><span>=</span><span> </span><span>(</span><span>int</span><span> </span><span>(</span><span>->fahr</span><span> </span><span>f</span><span>))</span><span> </span><span>c</span><span>)</span><span>\n</span><span>20</span><span> </span><span>68</span><span>\n</span><span>100</span><span> </span><span>212</span><span>))</span><span>\n</span></code></pre></div></div>\n<p>Аргументы записывают столбиком по принципу одна строка — один is. В примере выше\nf и c означают цифры по Фаренгейту и Цельсию, то есть исходное и ожидаемое\nзначения. Выражение (int (->fahr f)) переехало в шаблон, поэтому нет смысла\nповторять его каждый раз.</p>\n<p>Макрос are удобен для небольших выражений. С ростом логики он становится трудным\nв поддержке. В этом случае тест переписывают на doseq, который пробегает по\nданным.</p>\n<p>Предположим, мы тестируем HTTP API для создания пользователя. Один из тестов\nпроверяет входные параметры. Мы ожидаем негативный ответ для случаев, когда нет\nобязательного поля или оно в неверном формате. В переменную params-ok запишем\nудачные параметры:</p>\n<div><div><pre><code><span>(</span><span>def</span><span> </span><span>params-ok</span><span> </span><span>{</span><span>:name</span><span> </span><span>&quot;John Smith&quot;</span><span> </span><span>:email</span><span> </span><span>&quot;john@test.com&quot;</span><span>})</span><span>\n</span></code></pre></div></div>\n<p>Чтобы проверить негативные случаи, объявим вектор params-variations. Каждый его\nэлемент это пара: словарь и текст. Словарь это измененные параметры, которые мы\nдобавим к params-ok функцией merge. Текст это сообщение с описанием проблемы,\nнапример, неверный адрес почты, слишком длинное имя и тд.</p>\n<div><div><pre><code><span>(</span><span>def</span><span> </span><span>params-variations</span><span>\n</span><span>[[{</span><span>:name</span><span> </span><span>nil</span><span>}</span><span> </span><span>&quot;Empty name&quot;</span><span>]</span><span>\n</span><span>[{</span><span>:name</span><span> </span><span>(</span><span>apply</span><span> </span><span>str</span><span> </span><span>(</span><span>repeat</span><span> </span><span>999</span><span> </span><span>&quot;A&quot;</span><span>))}</span><span> </span><span>&quot;Name is too long&quot;</span><span>]</span><span>\n</span><span>[{</span><span>:email</span><span> </span><span>&quot;dunno&quot;</span><span>}</span><span> </span><span>&quot;Wrong email&quot;</span><span>]</span><span>\n</span><span>[{</span><span>:email</span><span> </span><span>nil</span><span>}</span><span> </span><span>&quot;No email&quot;</span><span>]</span><span>\n</span><span>[{</span><span>:extra</span><span> </span><span>42</span><span>}</span><span> </span><span>&quot;Extra field&quot;</span><span>]])</span><span>\n</span></code></pre></div></div>\n<p>Тест ниже пробегает по params-variations. На каждом шаге он вызывает\napi-create-user с испорченными параметрами. Обратите внимание, что вызов обернут\nв форму testing с сообщением. Если на одном из шагов утверждение не сработает,\nмы узнаем причину по сообщению из отчета.</p>\n<div><div><pre><code><span>(</span><span>deftest</span><span> </span><span>test-api-create-user-bad-params</span><span>\n</span><span>(</span><span>testing</span><span> </span><span>&quot;Sending bad parameters&quot;</span><span>\n</span><span>(</span><span>doseq</span><span> </span><span>[[</span><span>params*</span><span> </span><span>description</span><span>]</span><span> </span><span>params-variations</span><span>]</span><span>\n</span><span>(</span><span>testing</span><span> </span><span>description</span><span>\n</span><span>(</span><span>let</span><span> </span><span>[</span><span>params</span><span> </span><span>(</span><span>merge</span><span> </span><span>params-ok</span><span> </span><span>params*</span><span>)</span><span>\n</span><span>response</span><span> </span><span>(</span><span>api-create-user</span><span> </span><span>params</span><span>)</span><span>\n</span><span>{</span><span>:keys</span><span> </span><span>[</span><span>status</span><span>]}</span><span> </span><span>response</span><span>]</span><span>\n</span><span>(</span><span>is</span><span> </span><span>(</span><span>=</span><span> </span><span>400</span><span> </span><span>status</span><span>)))))))</span><span>\n</span></code></pre></div></div>\n<p>Когда тест разделяет данные и проверку, его легко поддерживать. Если в API\nпоявятся новые поля, достаточно расширить params-variations, не изменяя тест.</p>\n<h3>Именование</h3>\n<p>Приучите себя к правилу: имя теста всегда начинается с префикса test-. Мы\nупоминали, что с точки зрения Clojure это необязательно. Тестовый фремворк\nнаходит тесты по метаданным, а не имени. Поэтому выражения (defn\ntest-if-suspended [user]) и (deftest if-suspended) останутся функцией и тестом.</p>\n<p>Префикс необходим для навигации по коду. В модуле может быть гораздо больше\nтестов, чем влезает на экран. Вперемешку с тестами идут вспомогательные\nпеременные и функции. С ростом модуля станет трудно понять, где функция, а где\nтест. С префиксом такой ошибки быть не может.</p>\n<p>Emacs предлагает навигацию по коду командой imenu и ее улучшенной версией\nhelm-imenu. При вызове команды открывается буфер со списком определений. С\nвводом текста в буфере останутся только те элементы, имена которых содержат\nтекст. Называйте определения так, чтобы по команде M-x helm-imenu test в\nсписке остались только тесты.</p>\n<p>В общем случае имя теста устроено по правилу <code>test-&lt;what>-&lt;case></code>, где <code>&lt;what></code>\nозначает что мы тестируем, а <code>&lt;case></code> — сценарий. Например,\n<code>test-create-user-ok</code> означает, что это положительный сценарий для создания\nпользователя. Имя <code>test-create-user-bad-params</code> говорит о попытке создать\nпользователя с неправильными параметрами. От теста\n<code>test-user-login-signature-expired</code> мы ожидаем, что пользователь не смог\nавторизоваться, потому что подпись устарела.</p>\n<h2>Фикстуры</h2>\n<p>До сих пор мы рассматривали простые тесты. Они запускаются в любой момент,\nпотому что не зависят от сторонних ресурсов. Выдержать это условие удается не\nвсегда. Чем сложнее код, тем больше у него требований к базе данных, файлам и\nсети. Все вместе это называется окружением теста.</p>\n<p>В этом разделе мы рассмотрим, как сообщить тесту его окружение. Для этого служат\nфикстуры. Термин пришел из промышленности и означает стенд, на котором собирают\nи испытывают изделие. В программировании фикстура это объект или функция,\nкоторая работает до или после теста. Фикстура готовит окружение и очищает его.</p>\n<p>Перечислим несколько случаев, когда фикстуры полезны.</p>\n<p><strong>Файлы на диске.</strong> Код, который мы тестируем, ожидает, что по заданному пути\nнаходится файл с данными. Фикстура копирует файл в нужную папку и по завершению\nтеста удаляет его. Такой подход гарантирует, что не оставит следов на диске\nпосле работы.</p>\n<p><strong>Данные в базе</strong> — частный случай фикстуры по подготовке данных. Например,\nчтобы проверить авторизацию, необходимо заранее записать в базу пользователя с\nизвестным паролем. Возможно, понадобятся и другие данные о пользователе: его\nпрофиль или история заказов. Фикстура, которая готовит данные в базе, очищает\nтаблицы перед записью, чтобы следующий тест не зависел от действий предыдущего.</p>\n<p><strong>Запуск и остановка системы.</strong> Иногда фикстуры управляют глобальным состоянием\nпрограммы. Например, для интеграционного теста необходимы все компоненты системы\n(веб-сервер, база, почта и тд). Логику запуска и остановки системы логично\nвынести в фикстуру.</p>\n<p>По ходу главы мы рассмотрим эти и другие сценарии, когда прибегают к\nфикстурам. Прямо сейчас разберемся, как они устроены технически.</p>\n<p>С точки зрения фреймворка фикстура это функция, которая принимает тест. Функция\nвыполняет любые действия, в том числе вызывает тест. Вопрос в какой момент это\nсделать остается на усмотрение разработчика. Например, если фикстура готовит\nданные в базе, логично сперва очистить таблицы и выполнить несколько запросов:</p>\n<div><div><pre><code><span>(</span><span>def</span><span> </span><span>db</span><span> </span><span>{</span><span>:dbtype</span><span> </span><span>&quot;postgres&quot;</span><span> </span><span>:dbname</span><span> </span><span>&quot;book&quot;</span><span>\n</span><span>;; other JDBC fields go here...</span><span>\n</span><span>})</span><span>\n</span><span>(</span><span>defn</span><span> </span><span>fix-db-data</span><span> </span><span>[</span><span>t</span><span>]</span><span>\n</span><span>;; purge</span><span>\n</span><span>(</span><span>jdbc/execute!</span><span> </span><span>db</span><span> </span><span>&quot;truncate users cascade;&quot;</span><span>)</span><span>\n</span><span>(</span><span>jdbc/execute!</span><span> </span><span>db</span><span> </span><span>&quot;truncate orders cascade;&quot;</span><span>)</span><span>\n</span><span>;; write</span><span>\n</span><span>(</span><span>jdbc/insert!</span><span> </span><span>db</span><span> </span><span>:users</span><span> </span><span>user-data</span><span>)</span><span>\n</span><span>(</span><span>jdbc/insert!</span><span> </span><span>db</span><span> </span><span>:profile</span><span> </span><span>profile-data</span><span>)</span><span>\n</span><span>;; execute</span><span>\n</span><span>(</span><span>t</span><span>))</span><span>\n</span></code></pre></div></div>\n<p>В этом примере мы сначала готовим окружение, а затем вызываем тест. Но бывает и\nнаоборот: тест нуждается в финальных штрихах. Предположим, код из теста пишет\nпромежуточные файлы на диск. Чтобы очистить папку при выходе из теста, напишем\nфикстуру:</p>\n<div><div><pre><code><span>(</span><span>import</span><span> </span><span>'java.io.File</span><span>\n</span><span>'org.apache.commons.io.FileUtils</span><span>)</span><span>\n</span><span>(</span><span>defn</span><span> </span><span>fix-clear-files</span><span> </span><span>[</span><span>t</span><span>]</span><span>\n</span><span>(</span><span>t</span><span>)</span><span>\n</span><span>(</span><span>FileUtils/cleanDirectory</span><span> </span><span>(</span><span>new</span><span> </span><span>File</span><span> </span><span>&quot;/tmp/tests/reports&quot;</span><span>)))</span><span>\n</span></code></pre></div></div>\n<p>Иногда фикстура сообщает тесту и предварительные, и финальные шаги. В этом\nслучае вызов (t) располагается где-то посередине.</p>\n<p>Надеемся, читатель заметил, что имена фикстур начинаются с префикса fix-. В\nотношении фикстур действует то же правило, что и для тестов. Это особые\nсущности, поэтому их отделяют префиксом от обычных функций.</p>\n<h3>Регистрация</h3>\n<p>Если запустить тест прямо сейчас, фикстура не сработает. Мы только объявили\nфикстуру, но не указали фреймворку взять ее в работу. Это делают отдельным шагом\n– регистрацией фикстуры. На первый взгляд это выглядит странно. Если фреймворк\nсам находит тесты, почему бы ему не искать фикстуры и применять их?</p>\n<p>Причина в том, что фикстура может быть запущена на разных этапах\nтеста. Фреймворк Clojure выделяет стадии :each и :once. Зарегистрировать\nфикстуру означает связать ее с одним из этих ключей. Значение :each означает,\nчто фикстура сработает для каждого теста из текущего пространства. С ключом\n:once фикстура выполняется только однажды в рамках пространства.</p>\n<p>Одна и та же фикстура может быть :each или :once в зависимости от семантики\nтеста. Вспомним фикстуру fix-clear-files, которая очищает директорию. Если\nкаждый тест порождает случайные имена файлов, логично очистить их единоразово в\nконце. Это значит, что фикстуру регистрируют с ключом :once. В случае, если\nимена файлов одинаковы, возрастает риск их коллизии (чтение файла из другого\nтеста и тд). Тогда фикстуру связывают с ключом :each.</p>\n<p>Другой пример — фикстура базы данных. На время теста она добавляет в таблицы\nданные и очищает их. Если точно известно, что тесты только читают данные,\nфикстуру регистрируют с :once. Это дает выигрыш в производительности: для\nтридцати тестов фикстура сработает единожды. Для тестов на запись важно, чтобы\nни один из них не влиял на другой. Поэтому фикстуру регистрируют с :each. Чтобы\nне было коллизий, тесты на чтение и запись разносят по разным модулям.</p>\n<p>Функция use-fixtures из пакета clojure.test принимает ключ и переменное число\nфикстур:</p>\n<div><div><pre><code><span>(</span><span>use-fixtures</span><span> </span><span>:once</span><span> </span><span>fix-db-server</span><span> </span><span>fix-clear-files</span><span>)</span><span>\n</span><span>(</span><span>use-fixtures</span><span> </span><span>:each</span><span> </span><span>fix-db-data</span><span>)</span><span>\n</span></code></pre></div></div>\n<p>Эти выражения обычно ставят в верхней части файла до тестов. Технически они\nмогут располагаться и в конце. Но чем раньше программист узнает о том, какие\nтесты участвуют в тестах, тем лучше.</p>\n<h3>Пример</h3>\n<p>Чтобы лучше понять, в какой момент срабатывает фикстура, добавим в нее побочный\nэффект. Функция fix-factory принимает тип фикстуры, ее номер и возвращает\nфункцию-фикстуру. Такая фикстура обрамляет тест выводом в консоль.</p>\n<div><div><pre><code><span>(</span><span>defn</span><span> </span><span>fix-factory</span><span> </span><span>[</span><span>type</span><span> </span><span>number</span><span>]</span><span>\n</span><span>(</span><span>fn</span><span> </span><span>[</span><span>t</span><span>]</span><span>\n</span><span>(</span><span>println</span><span> </span><span>(</span><span>format</span><span> </span><span>&quot;%s %s starts&quot;</span><span> </span><span>type</span><span> </span><span>number</span><span>))</span><span>\n</span><span>(</span><span>t</span><span>)</span><span>\n</span><span>(</span><span>println</span><span> </span><span>(</span><span>format</span><span> </span><span>&quot;%s %s ends&quot;</span><span> </span><span>type</span><span> </span><span>number</span><span>))))</span><span>\n</span></code></pre></div></div>\n<p>Добавим по две фикстуры каждого типа:</p>\n<div><div><pre><code><span>(</span><span>use-fixtures</span><span> </span><span>:once</span><span>\n</span><span>(</span><span>fix-factory</span><span> </span><span>:once</span><span> </span><span>1</span><span>)</span><span>\n</span><span>(</span><span>fix-factory</span><span> </span><span>:once</span><span> </span><span>2</span><span>))</span><span>\n</span><span>(</span><span>use-fixtures</span><span> </span><span>:each</span><span>\n</span><span>(</span><span>fix-factory</span><span> </span><span>:each</span><span> </span><span>3</span><span>)</span><span>\n</span><span>(</span><span>fix-factory</span><span> </span><span>:each</span><span> </span><span>4</span><span>))</span><span>\n</span></code></pre></div></div>\n<p>Если запустить тесты, увидим следующий текст. Фикстуры 1 и 2 типа :once\nсработали однажды на границах. Обратите внимание, что в момент завершения из\nпорядок меняется на противоположный: сначала завершается фикстура 2 и только\nпотом 1. В нашем модуле 4 теста, поэтому фикстуры 3 и 4 встречаются столько же\nраз. Чтобы отобразить процесс наглядней, мы добавили отступы в каждое\nсообщение. С ними становится ясна иерархия фикстур.</p>\n<div><div><pre><code>:once 1 starts\n :once 2 starts\n  :each 3 starts   +\n   :each 4 starts  | test1\n   :each 4 ends    |\n  :each 3 ends     +\n  :each 3 starts   +\n   :each 4 starts  | test2\n   :each 4 ends    |\n  :each 3 ends     +\n  :each 3 starts   +\n   :each 4 starts  | test3\n   :each 4 ends    |\n  :each 3 ends     +\n  :each 3 starts   +\n   :each 4 starts  | test4\n   :each 4 ends    |\n  :each 3 ends     +\n :once 2 ends\n:once 1 ends\n</code></pre></div></div>\n<h3>На нижнем уровне</h3>\n<p>Пытливому читателю будет интересно узнать, где лежит информация о\nфикстурах. Очевидно, вызов use-fixtures меняет глобальное состояние. Это не атом\nи не переменная, а нечто другое, с чем мы еще не работали — метаданные текущего\nпространства. Проверим его ключи:</p>\n<div><div><pre><code><span>(</span><span>keys</span><span> </span><span>(</span><span>meta</span><span> </span><span>*ns*</span><span>))</span><span>\n</span><span>(</span><span>:clojure.test/each-fixtures</span><span> </span><span>:clojure.test/once-fixtures</span><span>)</span><span>\n</span></code></pre></div></div>\n<p>Под каждым ключом находится список функций, который мы передали в use-fixtures с\n:each или :once. Вызов use-fixtures заменяет в метаданных все фикстуры этого\nтипа. Важно, что это полная замена, а не запись в конец списка. Например, чтобы\nотказаться от всех фикстур типа :each без перезагрузки REPL, запустите\nвыражение:</p>\n<div><div><pre><code><span>(</span><span>use-fixtures</span><span> </span><span>:each</span><span> </span><span>nil</span><span>)</span><span>\n</span></code></pre></div></div>\n<p>Другой способ – удалите эту строку и выполните весь буфер целиком. Тогда\nопределение (ns…) сработает еще раз с новыми метаданными.</p>\n<p>Другие языки и фреймворки выделяют еще одну стадию :session. Это когда фикстура\nзапускается в разрезе всего прогона тестов. Можно сказать, что это\nфикстура-синглтон: система гарантирует, что даже для нескольких модулей она\nсработает один раз. В Clojure нет такой стадии. Если бы она была, это бы\nзначило, что несколько пространств связаны друг с другом, что идеологически\nневерно. Начинающим на Clojure часто не хватает session-фикстур, но мы научимся\nобходиться без них.</p>\n<h3>Связанные переменные</h3>\n<p>Особенно выразительны фикстуры в связке с динамическими переменными. Мы\nрассматривали их в главе про изменяемость. Напомним, динамические переменные это\nформы def с тегом ^:dynamic и <em>ушками</em> по краям имени. Макрос binding выполняет\nтело в рамках нового значения этой переменной.</p>\n<p>Форма deftest порождает функцию без аргументов; мы не можем сообщить тесту его\nпараметры как обычной функции. А ведь тесту нужны имена файлов, сессия БД и\nмногое другое. Чтобы пробросить эти данные, применяют binding-фикстуры. Это\nфикстура, которая выполняет тест в теле binding. При этом глобальная переменная\nсвязана с актуальным значением. Сослаться на переменную можно только из теста.</p>\n<p>Предположим, мы тестируем функцию, которая принимает путь к файлу и пишет в него\nPNG-картинку (карту, график). Объявим фикстуру, которая на время теста свяжет\nпеременную <em>file</em> с временным файлом. С точки зрения теста это <em>file</em> будет\nэкземпляром java.util.File. При выходе из теста он будет удален, а переменная\nвосстановится в nil.</p>\n<div><div><pre><code><span>(</span><span>defonce</span><span> </span><span>^</span><span>:dynamic</span><span> </span><span>*file*</span><span> </span><span>nil</span><span>)</span><span>\n</span><span>(</span><span>defn</span><span> </span><span>with-fix-tmp-file</span><span> </span><span>[</span><span>t</span><span>]</span><span>\n</span><span>(</span><span>let</span><span> </span><span>[</span><span>^</span><span>File</span><span> </span><span>tmp-file</span><span> </span><span>(</span><span>TmpFile/createFile</span><span> </span><span>&quot;....&quot;</span><span>)]</span><span>\n</span><span>(</span><span>binding</span><span> </span><span>[</span><span>*file*</span><span> </span><span>tmp-file</span><span>]</span><span>\n</span><span>(</span><span>t</span><span>))</span><span>\n</span><span>(</span><span>.delete</span><span> </span><span>tmp-file</span><span>)))</span><span>\n</span><span>(</span><span>use-fixture</span><span> </span><span>:each</span><span> </span><span>with-fix-tmp-file</span><span>)</span><span>\n</span></code></pre></div></div>\n<p>Тест мог бы выглядеть следующим образом. Мы вызываем plot-chart с текущим\nвременным файлом. Остается проверить, что функция действительно записала в него\nPNG-изображение. Класс PngImage предлагает простейший парсер PNG. Мы читаем\nразрешение файла, его размер и проверяем их.</p>\n<div><div><pre><code><span>(</span><span>import</span><span> </span><span>'some.path.PngImage</span><span>)</span><span>\n</span><span>(</span><span>deftest</span><span> </span><span>test-plot-chart-png</span><span>\n</span><span>(</span><span>let</span><span> </span><span>[</span><span>dataset</span><span> </span><span>[[</span><span>...</span><span>]</span><span> </span><span>[</span><span>...</span><span>]</span><span> </span><span>[</span><span>...</span><span>]]</span><span>\n</span><span>filepath</span><span> </span><span>(</span><span>.getAbsPath</span><span> </span><span>*file*</span><span>)]</span><span>\n</span><span>(</span><span>plot-chart</span><span> </span><span>dataset</span><span> </span><span>filepath</span><span>)</span><span>\n</span><span>(</span><span>let</span><span> </span><span>[</span><span>png</span><span> </span><span>(</span><span>new</span><span> </span><span>PngImage</span><span> </span><span>*file*</span><span>)</span><span>\n</span><span>width</span><span> </span><span>(</span><span>.getWidth</span><span> </span><span>png</span><span>)</span><span>\n</span><span>height</span><span> </span><span>(</span><span>.getHeight</span><span> </span><span>png</span><span>)])</span><span>\n</span><span>(</span><span>is</span><span> </span><span>(</span><span>=</span><span> </span><span>[</span><span>640</span><span> </span><span>480</span><span>]</span><span> </span><span>[</span><span>width</span><span> </span><span>height</span><span>]))))</span><span>\n</span></code></pre></div></div>\n<p>Для полноты картины рассмотрим случай с базой данных. Пусть это будет Cassandra,\nа не привычный JDBC-драйвер. Фикстура with-fix-db связывает <em>db</em> с текущей\nсессией. Поскольку установка соединения это дорогая операция, вынесем ее в\nразовую фикстуру:</p>\n<div><div><pre><code><span>(</span><span>defonce</span><span> </span><span>^</span><span>:dynamic</span><span> </span><span>^</span><span>Session</span><span> </span><span>*db*</span><span> </span><span>nil</span><span>)</span><span>\n</span><span>(</span><span>defn</span><span> </span><span>with-fix-db</span><span> </span><span>[</span><span>t</span><span>]</span><span>\n</span><span>(</span><span>let</span><span> </span><span>[</span><span>cluster</span><span> </span><span>...</span><span>\n</span><span>session</span><span> </span><span>...</span><span>]</span><span>\n</span><span>(</span><span>binding</span><span> </span><span>[</span><span>*db*</span><span> </span><span>session</span><span>]</span><span>\n</span><span>(</span><span>t</span><span>))</span><span>\n</span><span>(</span><span>.close</span><span> </span><span>session</span><span>)</span><span>\n</span><span>(</span><span>.close</span><span> </span><span>cluster</span><span>)))</span><span>\n</span><span>(</span><span>use-fixture</span><span> </span><span>:once</span><span> </span><span>with-fix-db</span><span>)</span><span>\n</span></code></pre></div></div>\n<p>Другая фикстура восстанавливает данные для каждого теста. Фикстуры :once\nзапускаются раньше, чем :each. Поэтому при подготовке данных мы уже будем внутри\n<code>(binding [*db* ...])</code> из тела with-fix-db. Это значит, фикстура\nfix-db-prepare-data свободно обращается к <code>*db*</code> как к сессии:</p>\n<div><div><pre><code><span>(</span><span>defn</span><span> </span><span>fix-db-prepare-data</span><span> </span><span>[</span><span>t</span><span>]</span><span>\n</span><span>(</span><span>alia/execute!</span><span> </span><span>*db*</span><span> </span><span>&quot;truncate project.users;&quot;</span><span>)</span><span>\n</span><span>(</span><span>alia/execute!</span><span> </span><span>*db*</span><span> </span><span>&quot;truncate project.orders;&quot;</span><span>)</span><span>\n</span><span>(</span><span>alia/execute!</span><span> </span><span>*db*</span><span> </span><span>&quot;insert into project.users (name, email) values (%s, %s)&quot;</span><span> </span><span>user-data</span><span>)</span><span>\n</span><span>(</span><span>t</span><span>))</span><span>\n</span><span>(</span><span>use-fixture</span><span> </span><span>:each</span><span> </span><span>fix-db-prepare-data</span><span>)</span><span>\n</span></code></pre></div></div>\n<h2>Мульти-фикстуры</h2>\n<p>Любопытный вопрос: что произойдет, фикстура вызывает тест несколько раз?\nНапример, объявим такую фикстуру:</p>\n<div><div><pre><code><span>(</span><span>defn</span><span> </span><span>fix-multi</span><span> </span><span>[</span><span>t</span><span>]</span><span>\n</span><span>(</span><span>t</span><span>)</span><span> </span><span>(</span><span>t</span><span>)</span><span> </span><span>(</span><span>t</span><span>))</span><span>\n</span><span>(</span><span>use-fixtures</span><span> </span><span>:each</span><span> </span><span>fix-multi</span><span>)</span><span>\n</span></code></pre></div></div>\n<p>и запустим один тест. С точки зрения фреймворка прошло три теста, о чем написано\nв отчете:</p>\n<div><div><pre><code>book.util-test: Ran 6 assertions, in 3 test functions. 0 failures, 0 errors.\n</code></pre></div></div>\n<p>На первый взгляд в этом нет никакого смысла. Многократный прогон теста не несет\nпользы, а только потребляет ресурсы и время. (Если же число запусков теста на\nчто-то влияет, это плохой тест.) Но в паре с динамическими переменными такая\nфикстура дает полезный эффект. Один и тот же тест можно запустить в разных\nокружениях.</p>\n<p>Предположим, наша программа работает с базой данных. В системных требованиях\nуказано, что это может быть PostgreSQL или MySQL. Мы должны убедиться, что\nпрограмма действительно поддерживает обе СУБД. Чтобы не дублировать тесты под\nкаждый тип базы, эту логику выносят в фикстуру.</p>\n<p>Объявим JDBC-подключения к базам данных:</p>\n<div><div><pre><code><span>(</span><span>def</span><span> </span><span>db-pg</span><span> </span><span>{</span><span>:dbtype</span><span> </span><span>&quot;postgresql&quot;</span><span> </span><span>:host</span><span> </span><span>&quot;...&quot;</span><span>})</span><span>\n</span><span>(</span><span>def</span><span> </span><span>db-mysql</span><span> </span><span>{</span><span>:dbtype</span><span> </span><span>&quot;mysql&quot;</span><span> </span><span>:host</span><span> </span><span>&quot;...&quot;</span><span>})</span><span>\n</span></code></pre></div></div>\n<p>Добавим динамическую переменную <code>*db*</code>. Новая фикстура перебирает список\nподключений и связывает их с <code>*db*</code> на каждом шаге. Когда переменная связана,\nзапускается тест. Он зависит от текущего подключения и таким образом обращается\nлибо в PostgreSQL, либо в MySQL.</p>\n<div><div><pre><code><span>(</span><span>defonce</span><span> </span><span>^</span><span>:dynamic</span><span> </span><span>*db*</span><span> </span><span>nil</span><span>)</span><span>\n</span><span>(</span><span>defn</span><span> </span><span>fix-multi-db-backend</span><span> </span><span>[</span><span>t</span><span>]</span><span>\n</span><span>(</span><span>doseq</span><span> </span><span>[</span><span>db</span><span> </span><span>[</span><span>db-pg</span><span> </span><span>db-mysql</span><span>]]</span><span>\n</span><span>(</span><span>binding</span><span> </span><span>[</span><span>*db*</span><span> </span><span>db</span><span>]</span><span>\n</span><span>(</span><span>testing</span><span> </span><span>(</span><span>format</span><span> </span><span>&quot;Testing with DB: %s&quot;</span><span> </span><span>(</span><span>:dbtype</span><span> </span><span>*db*</span><span>))</span><span>\n</span><span>(</span><span>t</span><span>)))))</span><span>\n</span></code></pre></div></div>\n<p>Обратите внимание, что вызов (t) дополнительно обернут в форму testing. В ней мы\nуказываем тип базы. Если произошла ошибка, нам важно знать, с какой базой мы\nработали в тот момент. Пример теста на чтение пользователя:</p>\n<div><div><pre><code><span>(</span><span>defn</span><span> </span><span>test-get-user-by-id</span><span>\n</span><span>(</span><span>let</span><span> </span><span>[</span><span>user</span><span> </span><span>(</span><span>com.system.orm/get-user</span><span> </span><span>*db*</span><span> </span><span>1</span><span>)]</span><span>\n</span><span>(</span><span>is</span><span> </span><span>(</span><span>=</span><span> </span><span>user</span><span> </span><span>{</span><span>:name</span><span> </span><span>&quot;Ivan&quot;</span><span>}))))</span><span>\n</span></code></pre></div></div>\n<p>Перечислим другие сценарии для мульти-фикстур. Это может быть запуск\nинтеграционных тестов в нескольких браузерах (Chrome, Firefox). Или мы хотим\nубедиться, что логика не зависит от формата передачи данных (JSON, YAML,\nXML). Если программа работает с изображениями, тесты прогоняют на разных типах\nфайлов (PNG, jpeg) и разрешениях.</p>\n<h3>Минутка неадекватности</h3>\n<p>(Просим не воспринимать этот раздел слишком серьезно.) Перейдем в другую\nкрайность: что случится, если фикстура не вызовет тест ни разу? Например:</p>\n<div><div><pre><code><span>(</span><span>defn</span><span> </span><span>fix-mute</span><span> </span><span>[</span><span>t</span><span>])</span><span>\n</span><span>(</span><span>use-fixtures</span><span> </span><span>:each</span><span> </span><span>fix-mute</span><span>)</span><span>\n</span></code></pre></div></div>\n<p>Это приведет к тому, что ни один тест не будет выполнен. Объясним это на\nтехническом уровне. Такая фикстура не отменяет тесты, и они по-прежнему видны\nтестовому фреймворку. В отчете вы увидите их список, но для каждого будет\nуказано 0 assertions. Формально мы запустили тест, но его тело так и не\nсработало из-за фикстуры fix-mute. Она заглушает любой тест в текущем\nпространстве.</p>\n<p>Если включить fix-mute и запустить тест из Emacs, мы увидим предупреждение:</p>\n<div><div><pre><code>No assertions (or no tests) were run.Did you forget to use ‘is’ in your tests?\n</code></pre></div></div>\n<p>Модуль Cider считает подозрительным, что в тесте не было ни одного is. Это\nсправедливо: без is тест может подать сигнал об ошибке только исключением, что\nведет к ряду проблем. Исключение и неверный результат это разные\nсигналы. Например, функция может давать верный результат, а деление на ноль\nпроисходит только в особых случаях. Если заменить деление на умножение, мы\nбольше никогда не получим ArithmeticException, но результат будет далек от\nистины.</p>\n<p>Чтобы обмануть Cider, улучшим фикстуру. Вместо запуска теста добавим в нее is,\nкоторый всегда истинен. Даже если тест с ошибками, его тело не сработает, но в\nотчете будет как минимум 1 assertion. Назовем такую фикстуру fix-this-is-fine:</p>\n<div><div><pre><code><span>(</span><span>defn</span><span> </span><span>fix-this-is-fine</span><span> </span><span>[</span><span>t</span><span>]</span><span>\n</span><span>(</span><span>is</span><span> </span><span>true</span><span>))</span><span>\n</span><span>(</span><span>use-fixtures</span><span> </span><span>:each</span><span> </span><span>fix-this-is-fine</span><span>)</span><span>\n</span></code></pre></div></div>\n<p>С ее помощью мы пройдем тест Оруэлла:</p>\n<div><div><pre><code><span>(</span><span>deftest</span><span> </span><span>test-1984</span><span>\n</span><span>(</span><span>is</span><span> </span><span>(</span><span>=</span><span> </span><span>(</span><span>*</span><span> </span><span>2</span><span> </span><span>2</span><span>)</span><span> </span><span>5</span><span>)))</span><span>\n</span><span>;; OK, ran 1 assertions</span><span>\n</span></code></pre></div></div>\n<p>Задание читателю: напишите фикстуру, которая портит любой тест. Добейтесь, чтобы\n100% тестов завершились с ошибкой. Если ваша система версий поддерживает\nотложенные коммиты, запланируйте такую фикстуру на 1 апреля.</p>\n<p>Теперь вернемся к серьезному повествованию.</p>\n<h3>Фикстуры с условиями</h3>\n<p>Из примеров выше ясно, что фикстура не только вызывает тест, но и несет\nдополнительную логику. Обращение к тесту может быть обернуто в цикл, условие или\nдругую форму. Разберемся с условием. В каких случаях тест ставят под if или when\nи какой в этом смысл?</p>\n<p>К условной фикстуре прибегают, когда мы не знаем заранее, сможем ли выполнить\nэтот тест. Например, часть программы не работает на платформе Windows или\nMac. Тогда фикстура проверяет тип операционной системы и не вызывает тест, если\nон заведомо не работает.</p>\n<div><div><pre><code><span>(</span><span>defn</span><span> </span><span>fix-mac-only</span><span> </span><span>[</span><span>t</span><span>]</span><span>\n</span><span>(</span><span>when</span><span> </span><span>(</span><span>=</span><span> </span><span>(</span><span>System/getProperty</span><span> </span><span>&quot;os.name&quot;</span><span>)</span><span> </span><span>&quot;Mac OS X&quot;</span><span>)</span><span>\n</span><span>(</span><span>t</span><span>)))</span><span>\n</span></code></pre></div></div>\n<p>Эта фикстура выполнит тест только на платформе Mac семейства X. Недостаток в\nтом, что мы сравниваем конкретные значения в лоб. Это наивный подход. В системах\nWindows или Linux имена различаются даже в рамках одного семейства. Чтобы\nопределить платформу правильно, свойство “os.name” проверяют на вхождение строки\nили регулярным выражением.</p>\n<p>Доработаем фикстуру: во-первых, сделаем ее подробнее. Обернем тест в форму\ntesting, чтобы видеть в отчете, в рамках какой ОС был выполнен тест. Если мы не\nподдерживаем систему, добавим заведомо ложное утверждение:</p>\n<div><div><pre><code><span>(</span><span>defn</span><span> </span><span>fix-mac-only</span><span> </span><span>[</span><span>t</span><span>]</span><span>\n</span><span>(</span><span>let</span><span> </span><span>[</span><span>os</span><span> </span><span>(</span><span>System/getProperty</span><span> </span><span>&quot;os.name&quot;</span><span>)]</span><span>\n</span><span>(</span><span>if</span><span> </span><span>(</span><span>=</span><span> </span><span>os</span><span> </span><span>&quot;Mac OS X&quot;</span><span>)</span><span>\n</span><span>(</span><span>testing</span><span> </span><span>(</span><span>format</span><span> </span><span>&quot;OS: %s&quot;</span><span> </span><span>os</span><span>)</span><span>\n</span><span>(</span><span>t</span><span>))</span><span>\n</span><span>(</span><span>testing</span><span> </span><span>(</span><span>format</span><span> </span><span>&quot;Unsupported OS: %s&quot;</span><span> </span><span>os</span><span>)</span><span>\n</span><span>(</span><span>is</span><span> </span><span>false</span><span>)))))</span><span>\n</span></code></pre></div></div>\n<p>Каким способом лучше зарегистрировать фикстуру — :once или :each? Это зависит от\nхарактера условия. В нашем примере тип системы не меняется от теста к тесту,\nпоэтому условие может быть выполнено лишь однажды (:once). Если же фикстура\nпроверяет файл на диске, это условие выполняют для каждого теста.</p>\n<p>Рассмотрим другие сценарии, когда фикстуры несут условия. Например, это версия\nбазы данных: если она ниже определенного значения, мы не можем выполнить\nтест. Некоторые приложения зависят от системных утилит, которые вызывают в\nотдельных процессах. Фикстура определяет, установлена ли такая утилита или\nнет. Иногда тест работает с большими файлами. Фикстура проверяет, что на диске\nдостаточно места до того, как скачать файл с сетевого ресурса.</p>\n<h2>Метки и селекторы</h2>\n<p>Фикстуры с условиями похожи на систему фильтров. С их помощью запускают не все\nтесты, а подмножество, которое подходит текущему окружению. Однако, избегайте\nситуаций, когда фикстуры перегружены условиями сверх меры. Clojure предлагает\nособые средства для выборочного прогона. Это метки и селекторы тестов.</p>\n<p>Метки устроены проще, чем фикстуры с условием. Это метаданные, которые вы\nсообщаете тесту при его описании. Например, тесту ниже</p>\n<div><div><pre><code><span>(</span><span>deftest</span><span> </span><span>^</span><span>:special</span><span> </span><span>test-special-case</span><span>\n</span><span>(</span><span>is</span><span> </span><span>true</span><span>))</span><span>\n</span></code></pre></div></div>\n<p>мы сообщили флаг :special со значением true. Напомним, что выражение ^:field это\nсокращенная форма ^{:field true}. Сокращенная форма полезна, чтобы задать\nнесколько флагов за один раз:</p>\n<div><div><pre><code><span>(</span><span>deftest</span><span> </span><span>^</span><span>:special</span><span> </span><span>^</span><span>:backend</span><span> </span><span>^</span><span>:no-db</span><span>\n</span><span>test-special-case</span><span>\n</span><span>(</span><span>is</span><span> </span><span>true</span><span>))</span><span>\n</span></code></pre></div></div>\n<p>Когда тегов два и более, имя теста переносят на следующую строку, чтобы\nвизуально отделить их.</p>\n<p>По такому набору тегов легко догадаться, что это тест на серверную логику\n(backend); он не зависит от базы данных (no-db); это какой-то особый тест\n(special). Семантика тегов зависит от соглашений в команде. Проверим флаги:\nпрочитаем метаданные переменной ‘test-special-case. Среди прочих полей вы\nнайдете special и остальные:</p>\n<div><div><pre><code><span>(</span><span>meta</span><span> </span><span>#</span><span>'test-special-case</span><span>)</span><span>\n</span><span>{</span><span>:special</span><span> </span><span>true</span><span> </span><span>:backend</span><span> </span><span>true</span><span> </span><span>:no-db</span><span> </span><span>true</span><span> </span><span>...</span><span>}</span><span>\n</span></code></pre></div></div>\n<p>Логично, что если тестам назначены теги, можно выбрать подмножество\nтестов. Например, только особые (special) или на серверную логику\n(backend). Такая выборка называется селектором тестов. Селекторы полезны по\nнескольким причинам.</p>\n<p>Подмножество тестов отработает быстрее, чем полный набор. Если мы работаем над\nзадачей и точно знаем, какие тесты она затрагивает, то нет смысла запускать все\nдоступные тесты. Назначим тег и будем запускать только подмножество. Иногда\nокружение разработчика не настроено должным образом, и выполнить тесты целиком\nневозможно.</p>\n<p>Даже если окружение в порядке, отдельные тесты могут занять много\nвремени. Например, интеграционный тест длится на порядок дольше модульного и\nвдобавок требует инфраструктуру: очередь задач, сторонние API. Поэтому\nинтеграционные тесты выносят в отдельный шаг Continuous Integration-процесса. В\nобщих чертах он выглядит так:</p>\n<ul>\n<li>запускается минимальное окружение (база данных);</li>\n<li>выполняются модульные тесты (селектор :default);</li>\n<li>если не было ошибок, то запускается дополнительное окружение (Kafka, заглушки\nAPI);</li>\n<li>выполняются интеграционные тесты (селектор :integration).</li>\n</ul>\n<p>Чем сложнее проект, тем больше в нем тестов и дополнительных шагов по их\nзапуску.</p>\n<p>В тестовом фреймворке Clojure нет селекторов. Он запускает либо один тест, либо\nпространство, либо все тесты целиком. Селекторы доступны в сторонних библиотеках\nи утилитах. Рассмотрим, как задать их в проекте на базе Leiningen.</p>\n<p>Откройте файл project.clj. Внутри defproject добавьте ключ :test-selectors. Это\nсловарь, где ключ это метка селектора, а значение — функция одного\nаргумента. Если при запуске тестов сообщить метку, каждый тест проходит проверку\nэтой функцией. В нее передают метаданные теста. Если функция вернула ложь или\nnil, тест не попадает в набор.</p>\n<p>Поскольку кейворд в Clojure это функция, селектором может быть сам тег. Пример\nниже можно прочитать как “набор тестов :special, у которых тег :special”:</p>\n<div><div><pre><code><span>:test-selectors</span><span> </span><span>{</span><span>:special</span><span> </span><span>:special</span><span>\n</span><span>:backend</span><span> </span><span>:backend</span><span>}</span><span>\n</span></code></pre></div></div>\n<p>Чтобы запустить тесты по селектору, передайте его метку в команду test:</p>\n<div><div><pre><code>lein test :special\n</code></pre></div></div>\n<p>Если метка не задана, фреймворк назначит ей значение :default. Этому селектору\nудовлетворяет любой тест (функция всегда вернет true). Ниже пример из реального\nпроекта. Для :default мы задали селектор, который вернет все не интеграционные\nтесты. Этим мы добьемся того, что команда lein test запустит только модульные\nтесты. На случай, когда нужно прогнать весь проект, мы завели метку\n:all. Функция identity вернет исходный словарь метаданных, который вырождается в\ntrue.</p>\n<div><div><pre><code><span>:test-selectors</span><span> </span><span>{</span><span>:default</span><span> </span><span>(</span><span>complement</span><span> </span><span>:integration</span><span>)</span><span>\n</span><span>:integration</span><span> </span><span>:integration</span><span>\n</span><span>:all</span><span> </span><span>identity</span><span>}</span><span>\n</span></code></pre></div></div>\n<p>Селектор может быть и полноценной функцией, а не только ключом. Предположим,\nпрограмма должна работать с разными версиями БД, чтобы обеспечить\nсовместимость. Для каждого теста укажем минимальную версию базы. Это поле\n:pg/version и числовое значение. Тогда можно задать селектор так, чтобы выбрать\nтесты по версиям. В примере ниже тест, который проверяет экспериментальные\nразработки на новой версии базы.</p>\n<div><div><pre><code><span>(</span><span>deftest</span><span> </span><span>^</span><span>{</span><span>:pg/version</span><span> </span><span>11</span><span>}</span><span>\n</span><span>test-db-experimental-feature</span><span>\n</span><span>(</span><span>is</span><span> </span><span>true</span><span>))</span><span>\n</span></code></pre></div></div>\n<p>С точки зрения селектора тест экспериментальный, если поле :pg/version больше\nили равно 11:</p>\n<div><div><pre><code><span>:test-selectors</span><span>\n</span><span>{</span><span>:db-experimental</span><span>\n</span><span>(</span><span>fn</span><span> </span><span>[</span><span>test-meta</span><span>]</span><span>\n</span><span>(</span><span>some-></span><span> </span><span>test-meta</span><span> </span><span>:pg/version</span><span> </span><span>(</span><span>>=</span><span> </span><span>11</span><span>)))}</span><span>\n</span></code></pre></div></div>\n<p>Запустите их командой <code>lein test :db-experimental</code>.</p>\n<p>Когда в модуле много тестов, расставлять теги утомительно. Вдобавок повышается\nриск забыть тег, и тест выпадет из набора. Если все тесты модуля связаны по\nсмыслу, тег назначают не тесту, а пространству. С точки зрения lein тест\nнаследует теги пространства, в котором он объявлен:</p>\n<div><div><pre><code><span>(</span><span>ns</span><span> </span><span>^</span><span>:integration</span><span>\n</span><span>book.integration-test</span><span>\n</span><span>(</span><span>:require</span><span> </span><span>[</span><span>clojure.test</span><span> </span><span>:refer</span><span> </span><span>:all</span><span>]))</span><span>\n</span><span>(</span><span>deftest</span><span> </span><span>test-user-login-ok</span><span>\n</span><span>...</span><span>)</span><span>\n</span></code></pre></div></div>\n<p>В примере выше нет смысла указывать ^:integration каждому тесту, поскольку это\nсделано на уровне модуля. Селектор интеграционных тестов не изменится: его метка\nи функция равны ключу :integration. Тесты запускаются как обычно:</p>\n<div><div><pre><code>lein test :integration\n</code></pre></div></div>\n<h3>Тесты в deps.edn</h3>\n<p>Не все Clojure-проекты используют lein; некоторые перешли на deps.edn. Это\nутилита, разработанная в фирме Cognitect. Основная задача утилиты — управлять\nзависимостями проекта. С версии 1.9 deps.edn идет в поставке с Clojure.</p>\n<p>Если проект работает на deps, мы теряем часть функциональности lein (в отдельных\nслучаях их удается скрестить, но об этом в другой раз). В том числе это прогон\nтестов, команда lein test. В deps замещают возможности lein сторонними\nбиблиотеками. Проект test-runner это библиотека, которая делает то же самое:\nнаходит тесты, запускает их и выводит отчет.</p>\n<p>Чтобы включить библиотеку в проект, добавьте в файл deps.edn новую сущность:</p>\n<div><div><pre><code><span>:aliases</span><span>\n</span><span>{</span><span>:test</span><span>\n</span><span>{</span><span>:extra-paths</span><span> </span><span>[</span><span>&quot;test&quot;</span><span>]</span><span>\n</span><span>:extra-deps</span><span> </span><span>{</span><span>com.cognitect/test-runner</span><span>\n</span><span>{</span><span>:git/url</span><span> </span><span>&quot;https://github.com/cognitect-labs/test-runner.git&quot;</span><span>\n</span><span>:sha</span><span> </span><span>&quot;209b64504cb3bd3b99ecfec7937b358a879f55c1&quot;</span><span>}}</span><span>\n</span><span>:main-opts</span><span> </span><span>[</span><span>&quot;-m&quot;</span><span> </span><span>&quot;cognitect.test-runner&quot;</span><span>]}}</span><span>\n</span></code></pre></div></div>\n<p>Объясним этот словарь. Ключ :aliases это примерно то же самое, что профили в\nlein: дополнительные опции, которые включаются, если указан этот профиль. Ключ\n:extra-paths это список дополнительных путей для поиска файлов с кодом. Поле\n:extra-deps указывает зависимости, с которыми запустится проект с этим\nпрофилем. Поскольку test-runner нужен только для тестов, нет смысла вносить его\nв глобальные зависимости. В примере выше библиотека скачивается прямиком с\nGitHub; поле :sha означает номер коммита. Это коренное отличие deps от lein:\nпоследний скачивает зависимости только из репозиториев (maven, clojars). Ключ\n:main-opts задает входную точку программы. Это функция -main из пространства\ncognitect.test-runner.</p>\n<p>Библиотека предлагает несколько ключей для выборки тестов с логикой “только с\nэтим тегом” (-i, include, включить ) или “без этого тега” (-e, exclude,\nисключить). Команда ниже выполнит все тесты кроме интеграционных:</p>\n<div><div><pre><code>clj -Atest -e :integration\n</code></pre></div></div>\n<p>В плане селекторов test-runner устроен проще lein. Он учитывает только\nлогические теги и не работает со сложным функциями, как мы делали это в lein на\nпримере версий БД. С другой стороны, test-runner умеет искать пространства по\nрегулярному выражению (ключ -r, namespace-regex). Например, выражение\n#”project.api.\\w+-test$” найдет тесты из модулей project.api.users-test,\nproject.api.tasks-test и так далее.</p>\n<h2>Проблема окружения</h2>\n<p>До сих пор мы писали примитивные тесты, которые проверяют вычисления. На\nпрактике вы столкнетесь с проблемой: в обычном коде преобладают не вычисления, а\nввод-вывод данных. Это обращение к сторонним ресурсам: базе данных, очереди\nзадач, HTTP API. Такой код трудно тестировать по двум причинам.</p>\n<p>Во-первых, не всегда возможно настроить локальное окружение. У вас может не быть\nключей доступа или сертификатов. Во-вторых, тесты плохо работают с данными,\nкоторые не контролируют. Например, если тест посылает запросы к стороннему\nсервису, то в какой-то момент данные изменятся, и мы получим сломанный билд на\nровном месте.</p>\n<p>Чтобы тест зависел от окружения, применяют две техники: моки и стабы. В\nследующих разделах мы рассмотрим их устройство, преимущества и недостатки.</p>\n<h3>Моки</h3>\n<p>Мок (анг. mock — ложный, фиктивный) — это объект, который временно заменяет\nдругой объект. Цель такой подмены в том, чтобы при обращении к объекту сработал\nне исходный код, а тот, который нужен именно сейчас. Чаще всего моки накладывают\nна методы и функции с доступом в сеть. С их помощью проверяют, как поведет себя\nфункция при различных сценариях: данные получены, пришел код ошибки, соединение\nне удалось.</p>\n<p>В ООП-языках моки заменяют не только объект, но и отдельные его поля, методы или\nдаже класс. В Clojure основной строительный элемент это функция, поэтому ниже мы\nрассмотрим, как заменять функции на время тестирования.</p>\n<p>Представим, что пишем веб-сервер для мобильного приложения. Его тематика —\nразвлечение и отдых. На главном экране пользователь видит карту, на которую\nнанесены кафе, рестораны и ближайшие события: фильмы, выставки,\nфестивали. Сервер работает по протоколу HTTP/JSON API. Данные для главного\nэкрана возвращает функция view-main-page. Она извлекает из запроса координаты\nпользователя, собирает сведения о местах общепита и событиях и отсылает\nмобильному приложению:</p>\n<div><div><pre><code><span>(</span><span>ns</span><span> </span><span>book.views</span><span>\n</span><span>(</span><span>:require</span><span> </span><span>[</span><span>clj-http.client</span><span> </span><span>:as</span><span> </span><span>client</span><span>]))</span><span>\n</span><span>(</span><span>defn</span><span> </span><span>view-main-page</span><span> </span><span>[</span><span>request</span><span>]</span><span>\n</span><span>(</span><span>let</span><span> </span><span>[</span><span>location</span><span> </span><span>(</span><span>-></span><span> </span><span>request</span><span> </span><span>:params</span><span> </span><span>(</span><span>select-keys</span><span> </span><span>[</span><span>:lat</span><span> </span><span>:lon</span><span>]))</span><span>\n</span><span>sites</span><span> </span><span>(</span><span>get-sites-by-location</span><span> </span><span>location</span><span>)</span><span>\n</span><span>events</span><span> </span><span>(</span><span>get-events-by-location</span><span> </span><span>location</span><span>)]</span><span>\n</span><span>{</span><span>:status</span><span> </span><span>200</span><span>\n</span><span>:body</span><span> </span><span>{</span><span>:sites</span><span> </span><span>sites</span><span> </span><span>:events</span><span> </span><span>events</span><span>}}))</span><span>\n</span></code></pre></div></div>\n<p>Проблема в том, что у сервера нет этих данных. Мы извлекаем из сторонних\nсервисов, например, условных Яндекс.Карт и Яндекс.Афиши. Функции get-sites… и\nget-events… общаются с ними по протоколу HTTP. Вот так может выглядеть функция\nget-sites-by-location для поиска кафе и ресторанов в радиусе 300 метров:</p>\n<div><div><pre><code><span>(</span><span>defn</span><span> </span><span>get-sites-by-location</span><span>\n</span><span>[{</span><span>:keys</span><span> </span><span>[</span><span>lat</span><span> </span><span>lon</span><span>]}]</span><span>\n</span><span>(</span><span>-></span><span> </span><span>{</span><span>:method</span><span> </span><span>:get</span><span>\n</span><span>:url</span><span> </span><span>&quot;https://maps.yandex.ru/search/v1/&quot;</span><span>\n</span><span>:as</span><span> </span><span>:json</span><span>\n</span><span>:query-params</span><span> </span><span>{</span><span>:apikey</span><span> </span><span>&quot;.....&quot;</span><span>\n</span><span>:lat</span><span> </span><span>lat</span><span> </span><span>:lon</span><span> </span><span>lon</span><span> </span><span>:distance</span><span> </span><span>300</span><span>\n</span><span>:type</span><span> </span><span>&quot;cafe,restaurant&quot;</span><span>}}</span><span>\n</span><span>client/request</span><span>\n</span><span>:body</span><span>))</span><span>\n</span></code></pre></div></div>\n<p>Функция get-events-by-location для поиска мероприятий аналогична первой. Разница\nлишь в URL-адресе (не maps.yandex.ru, a events.yandex.ru) и query-параметрах.</p>\n<p>Очевидно, view-main-page совершает два сетевых вызова, что затрудняет ее\nтестирование. Это значит, нам нужно два API-ключа; если запускать тесты часто,\nмы исчерпаем квоты на число запросов. Поскольку мы получим настоящие, живые\nданные, мы не можем быть уверены в их надежности (завтра в этом месте откроется\nновое кафе или закроется старое). Решим эту проблему моками.</p>\n<p>В главе про изменяемость мы работали с макросом with-redefs. Он заменяет\nпеременную по ее пути на что-то другое. Простейший мок — это подмена функции с\nсетевым вызовом на анонимную функцию, которая возвращает заведомо известный\nрезультат. Напомним, что получить функцию из результата можно с помощью формы\nconstantly.</p>\n<p>Напишем тест главного экрана с двумя моками. Данные моков удобно вынести в\nотдельные переменные в let. Важно, что view-main-page должна быть выполнена\nвнутри with-redefs, иначе эффект моков теряется.</p>\n<div><div><pre><code><span>(</span><span>deftest</span><span> </span><span>test-main-page</span><span>\n</span><span>(</span><span>let</span><span> </span><span>[</span><span>sites</span><span> </span><span>[{</span><span>:name</span><span> </span><span>&quot;Cafe1&quot;</span><span>}</span><span> </span><span>{</span><span>:name</span><span> </span><span>&quot;Cafe2&quot;</span><span>}]</span><span>\n</span><span>events</span><span> </span><span>[{</span><span>:name</span><span> </span><span>&quot;Event1&quot;</span><span>}</span><span> </span><span>{</span><span>:name</span><span> </span><span>&quot;Event2&quot;</span><span>}]]</span><span>\n</span><span>(</span><span>with-redefs</span><span>\n</span><span>[</span><span>book.views/get-sites-by-location</span><span> </span><span>(</span><span>constantly</span><span> </span><span>sites</span><span>)</span><span>\n</span><span>book.views/get-events-by-location</span><span> </span><span>(</span><span>constantly</span><span> </span><span>events</span><span>)]</span><span>\n</span><span>(</span><span>let</span><span> </span><span>[</span><span>request</span><span> </span><span>{</span><span>:params</span><span> </span><span>{</span><span>:lat</span><span> </span><span>55.751244</span><span>\n</span><span>:lon</span><span> </span><span>37.618423</span><span>}}</span><span>\n</span><span>result</span><span> </span><span>(</span><span>view-main-page</span><span> </span><span>request</span><span>)]</span><span>\n</span><span>(</span><span>is</span><span> </span><span>(</span><span>=</span><span> </span><span>(</span><span>:body</span><span> </span><span>result</span><span>)</span><span>\n</span><span>{</span><span>:sites</span><span> </span><span>sites</span><span> </span><span>:events</span><span> </span><span>events</span><span>}))))))</span><span>\n</span></code></pre></div></div>\n<p>С этим подходом мы избежали похода в сеть. Тест не зависит от API-ключей, прав\nдоступа и новых заведений. Можно запустить его в любое время дня и ночи, и\nрезультат будет одинаковым. Теперь рассмотрим, как улучшить этот тест.</p>\n<h3>Вынести данные в файл</h3>\n<p>Переменные sites и events, которые мы якобы получили от сторонних сервисов,\nкрайне скудны. Будет правильным сообщить им данные, скопированные из реального\nисточника, например, десять ресторанов и семь мероприятий. Чтобы не засорять код\nогромными массивами данных, поместите их в .json-файлы в папку с\nресурсами. Считайте их один раз на уровне модуля в переменную:</p>\n<div><div><pre><code><span>(</span><span>def</span><span> </span><span>data-events</span><span>\n</span><span>(</span><span>-></span><span> </span><span>&quot;data/events.json&quot;</span><span>\n</span><span>clojure.java.io/resource</span><span>\n</span><span>slurp</span><span>\n</span><span>(</span><span>cheshire.core/parse-string</span><span> </span><span>true</span><span>)))</span><span>\n</span></code></pre></div></div>\n<p>В промышленном запуске функция get-sites-by-location устроена сложнее, чем в\nнашем примере. Скорее всего, данные от сервиса карт придется обработать согласно\nбизнес-логике нашего приложения. Например, отбросить заведения с низкой оценкой\nи те, что сейчас закрыты. Это логику можно проверить тестом: добавить в\njson-файл заведение с низким рейтингом и убедиться, что в его нет в ответе.</p>\n<h3>Перенести мок в фикстуру</h3>\n<p>Если требуется больше одного теста на главный экран, оборачивать каждый из них в\nwith-redefs будет утомительно. Логично вынести мок в фикстуру. Тем самым мы\nснизим число повторов в коде, а другие тесты смогут ее переиспользовать:</p>\n<div><div><pre><code><span>(</span><span>defn</span><span> </span><span>fix-mock-main-view</span><span> </span><span>[</span><span>t</span><span>]</span><span>\n</span><span>(</span><span>with-redefs</span><span> </span><span>[</span><span>...</span><span>]</span><span>\n</span><span>(</span><span>t</span><span>)))</span><span>\n</span><span>(</span><span>use-fixtures</span><span> </span><span>:each</span><span> </span><span>fix-mock-main-view</span><span>)</span><span>\n</span></code></pre></div></div>\n<p>Недостаток фикстуры в том, что для всех тестов она устанавливает позитивный\nсценарий (обе функции сработали без ошибок). Для полноты картины мы должны\nпроверить, что случится, если сервисы недоступны. Об этом — в следующем пункте.</p>\n<h3>Негативные сценарии</h3>\n<p>Недоступность одного сервиса не должна влиять на работу приложения в целом. Если\nвозникла накладка с кафе, пользователь все равно должен увидеть мероприятия и\nнаоборот. Возможно, он даже не заметит проблемы: если ответ не был получен,\nприложение покажет старые данные.</p>\n<p>Чтобы проверить главный экран на устойчивость, необходимы негативные сценарии:</p>\n<ul>\n<li>получили кафе, но не мероприятия;</li>\n<li>наоборот: с кафе все в порядке, ошибка с мероприятиями;</li>\n<li>не работают оба сервиса.</li>\n</ul>\n<p>Кроме того, под общими словами “не работают” имеют в виду варианты:</p>\n<ul>\n<li>проблемы доступа или квот: статусы 403 и 429;</li>\n<li>недоступность сервиса: статусы 500 и 503;</li>\n<li>проблемы связи: исключение по таймауту и поиску хоста.</li>\n</ul>\n<p>Чтобы сократить код с with-redefs, напишем его краткую версию. Макрос with-mock\nпринимает путь к функции, результат функции-мока и произвольное тело.</p>\n<div><div><pre><code><span>(</span><span>defmacro</span><span> </span><span>with-mock</span><span>\n</span><span>[</span><span>path</span><span> </span><span>result</span><span> </span><span>&amp;</span><span> </span><span>body</span><span>]</span><span>\n</span><span>`</span><span>(</span><span>with-redefs</span><span>\n</span><span>[</span><span>~</span><span>path</span><span> </span><span>(</span><span>fn</span><span> </span><span>[</span><span>&amp;</span><span> </span><span>~</span><span>'_</span><span>]</span><span> </span><span>~</span><span>result</span><span>)]</span><span>\n</span><span>~@</span><span>body</span><span>))</span><span>\n</span></code></pre></div></div>\n<p>Важный момент: для замены path мы создаем анонимную функцию с помощью fn, а не\nconstantly. Иначе невозможно смоделировать выброс исключения. Поскольку\nconstantly это функция, ее аргументы вычисляются до того, как она\nсработает. Поэтому выражение</p>\n<div><div><pre><code><span>(</span><span>constantly</span><span> </span><span>(</span><span>throw</span><span> </span><span>(</span><span>new</span><span> </span><span>Exception</span><span> </span><span>&quot;error&quot;</span><span>)))</span><span>\n</span></code></pre></div></div>\n<p>бросит исключение еще на этапе связывания.</p>\n<p>С помощью with-mock мы собираем комбинации успехов и неудач. Тест ниже проверяет\nсценарий, когда сервис карт сработал без ошибок, а с мероприятиями что-то пошло\nне так. Если запустить тест, окажется, что test-main-page не отлавливает\nисключения. Это значит, пользователь не увидит ничего.</p>\n<div><div><pre><code><span>(</span><span>deftest</span><span> </span><span>test-sites-ok-events-err</span><span>\n</span><span>(</span><span>with-mock</span><span> </span><span>book.views/get-sites-by-location</span><span> </span><span>[</span><span>...</span><span>]</span><span>\n</span><span>(</span><span>with-mock</span><span> </span><span>book.views/get-events-by-location</span><span>\n</span><span>(</span><span>throw</span><span> </span><span>(</span><span>new</span><span> </span><span>java.net.UnknownHostException</span><span> </span><span>&quot;DNS error&quot;</span><span>))</span><span>\n</span><span>(</span><span>let</span><span> </span><span>[</span><span>response</span><span> </span><span>(</span><span>view-main-page</span><span> </span><span>{})]</span><span>\n</span><span>(</span><span>is</span><span> </span><span>(</span><span>:body</span><span> </span><span>response</span><span>)</span><span> </span><span>{</span><span>...</span><span>})))))</span><span>\n</span></code></pre></div></div>\n<p>Доработайте view-main-page так, чтобы тест увидел ответ со статусом 200 и полем\n:sites. Добавьте тесты с другими комбинациями: ошибка соединения в get-sites,\nстатусы 403 и 500, недоступность сразу двух сервисов.</p>\n<h3>Сбор данных</h3>\n<p>Не заглядывая в конец главы, подумайте, как организовать мок промышленного\nуровня. Такой мок не только возвращает результат, но и:</p>\n<ul>\n<li>считает, сколько раз его вызвали;</li>\n<li>запоминает аргументы каждого вызова;</li>\n<li>принимает список результатов и возвращает их поочередно, например, в первый и\nвторой раз словари, а на третий раз исключение;</li>\n<li>предлагает удобный доступ к этим данным.</li>\n</ul>\n<p>Моки с такими возможностями следят за особой логикой программы. Например, поиск\nресторанов вернет только базовые сведения о них. Чтобы получить детальную\nинформацию о заведении, придется слать отдельный запрос к сервису карт. Чтобы\nсетевой трафик не рос линейно, мы извлекаем данные только для трех лучших\nресторанов. Продвинутый мок для условной функции get-site-details проверяет, что\nее вызвали не более трех раз. В конце главы мы рассмотрим продвинутые решения\nдля мокинга в Clojure.</p>\n<h3>Недостатки</h3>\n<p>На первый взгляд кажется, что моки решили проблему окружения. Теперь тесты\nавтономны и не зависят от сторонних сервисов. Но есть у моков и недостатки;\nперечислим основные из них.</p>\n<p>Мок нарушает принцип закрытости (черного ящика). При написании теста мы\nподглядываем в исходный код, чтобы узнать, какие функции подменить. Это не\nкритично, но чем меньше тест знает о коде, который тестирует, тем он надежней.</p>\n<p>Мок исключает сетевое взаимодействие, что иногда выходит боком. Передача данных\nпо HTTP это многоступенчатый процесс, где на каждом участке может возникнуть\nошибка. Подмена HTTP-запроса на чистую функцию это грубое приближение. С его\nпомощью нельзя предугадать все возможные ошибки.</p>\n<p>Наконец, мок повышает связанность тестов с логикой. Если переименовать функцию\nget-sites-by-location, форма (with-redefs…) перестанет работать. Косметические\nисправления в коде повлекут правки в тестах, что неудобно и неверно\nидеологически.</p>\n<p>Эти проблемы решают стабы, о которых речь в следующем разделе.</p>\n<h3>Стабы</h3>\n<p>Стаб (анг. stub, заглушка) — это сущность, которая заменяет объект или часть\nсистемы на время тестов. От моков она отличается тем, что тест не может ей\nуправлять. Если в тестах с моками мы сами указываем что и чем заменить, то стаб\nэто черный ящик с точки зрения теста.</p>\n<p>Удачный пример стаба это локальный HTTP-сервер, имитирующий сторонний сервис,\nнапример, поиск мест на карте. Такой сервер запущен на порту 8808 и по адресу\n<code>/search/v1/</code> возвращает JSON-данные, которые мы взяли из настоящего\nисточника. Теперь мы не будем мокать функцию get-sites-by-location. Изменим ее\nтак, чтобы поле :url запроса указывало не на <code>https://maps.yandex.ru/</code>, а на\n<code>http://127.0.0.1:8808/</code>. Если запустить тест, функция выполнит запрос к\nлокальному серверу и прочитает его ответ.</p>\n<p>Подход со стабами несет колоссальное преимущество. Легко увидеть, что стаб\nсводит к нулю зависимость теста от логики. Теперь тест ничего не знает о\nфункциях приложения; ему и не положено это знать. От нас требуется только\nперенацелить запросы на другой адрес. Это вопрос конфигурации, а в логике\nпрограммы ничего не меняется.</p>\n<p>Другое достоинство в том, что во время теста происходит настоящий обмен данными\nпо сети. Да, это локальный хост без зашифрованного соединения и проверки\nсертификатов. Но основная часть HTTP-взаимодействия протекает так же, как и в\nпромышленном запуске. Это разбор заголовков, чтение и парсинг JSON-данных,\nлогика на базе статуса ответа.</p>\n<p>Локальные сервера-заглушки еще называют фейки (анг. fake, подделка). С помощью\nфейка программист моделирует нештатное поведение сервера. Например, ситуацию,\nкогда в ответе не JSON-данные, а просто текст. Или когда сервер принимает\nсоединение, но не отвечает. Или полную недоступность сервера, когда мы выключаем\nего перед тестом.</p>\n<p>Достичь таких эффектов моком невозможно. С его помощью мы можем только кидать\nисключения, которые, согласно документации, бросает настоящий HTTP-клиент. Но\nтесты на исключениях это хрупки и далеки от реального положения дел.</p>\n<p>С технической стороны стаб это фикстура. До запуска теста она включает сервер, а\nпосле выключает его. Сервер это Jetty или другой адаптер для Ring-обработчика\nзапроса. Мы подробно рассмотрели Ring и Jetty в главе по веб-разработку. Напишем\nфикстуру для фейкового сервера карт.</p>\n<p>В блок require добавим зависимости:</p>\n<div><div><pre><code><span>[</span><span>ring.middleware.json</span><span> </span><span>:refer</span><span> </span><span>[</span><span>wrap-json-response</span><span>]]</span><span>\n</span><span>[</span><span>ring.middleware.params</span><span> </span><span>:refer</span><span> </span><span>[</span><span>wrap-params</span><span>]]</span><span>\n</span><span>[</span><span>ring.middleware.keyword-params</span><span> </span><span>:refer</span><span> </span><span>[</span><span>wrap-keyword-params</span><span>]]</span><span>\n</span><span>[</span><span>ring.adapter.jetty</span><span> </span><span>:refer</span><span> </span><span>[</span><span>run-jetty</span><span>]]</span><span>\n</span></code></pre></div></div>\n<p>Напишем обработчик запроса. Это функция, которая принимает запрос. Для пути\nsearch/v1 она возвращает JSON-данные, для всего остального ответ 404:</p>\n<div><div><pre><code><span>(</span><span>defn</span><span> </span><span>sites-handler*</span><span> </span><span>[{</span><span>:keys</span><span> </span><span>[</span><span>uri</span><span>]}]</span><span>\n</span><span>(</span><span>case</span><span> </span><span>uri</span><span>\n</span><span>&quot;/search/v1/&quot;</span><span>\n</span><span>{</span><span>:status</span><span> </span><span>200</span><span>\n</span><span>:body</span><span> </span><span>[{</span><span>:name</span><span> </span><span>&quot;Cafe1&quot;</span><span> </span><span>:address</span><span> </span><span>&quot;...&quot;</span><span>}</span><span>\n</span><span>{</span><span>:name</span><span> </span><span>&quot;Cafe2&quot;</span><span> </span><span>:address</span><span> </span><span>&quot;...&quot;</span><span>}]}</span><span>\n</span><span>{</span><span>:status</span><span> </span><span>404</span><span>\n</span><span>:body</span><span> </span><span>&quot;page not found&quot;</span><span>}))</span><span>\n</span></code></pre></div></div>\n<p>Обернем функцию в набор middleware. Во-первых, мы хотим, чтобы тело-коллекция\nприводилось к JSON автоматически. Во-вторых, позже нам понадобятся параметры\nстроки:</p>\n<div><div><pre><code><span>(</span><span>def</span><span> </span><span>sites-handler</span><span>\n</span><span>(</span><span>-></span><span> </span><span>sites-handler*</span><span>\n</span><span>wrap-keyword-params</span><span>\n</span><span>wrap-params</span><span>\n</span><span>wrap-json-response</span><span>))</span><span>\n</span></code></pre></div></div>\n<p>Напишем и подключим фикстуру. Сервер не меняет состояние от теста к тесту (мы\nтолько читаем данные), поэтому фикстура срабатывает один раз (ключ :once):</p>\n<div><div><pre><code><span>(</span><span>defn</span><span> </span><span>fix-fake-sites-server</span><span> </span><span>[</span><span>t</span><span>]</span><span>\n</span><span>(</span><span>let</span><span> </span><span>[</span><span>opt</span><span> </span><span>{</span><span>:port</span><span> </span><span>8808</span><span> </span><span>:join?</span><span> </span><span>false</span><span>}</span><span>\n</span><span>server</span><span> </span><span>(</span><span>run-jetty</span><span> </span><span>sites-handler</span><span> </span><span>opt</span><span>)]</span><span>\n</span><span>(</span><span>t</span><span>)</span><span>\n</span><span>(</span><span>.stop</span><span> </span><span>server</span><span>)))</span><span>\n</span><span>(</span><span>use-fixtures</span><span> </span><span>:once</span><span> </span><span>fix-fake-sites-server</span><span>)</span><span>\n</span></code></pre></div></div>\n<p>Исправим функцию get-sites-by-location так, чтобы клиент обращался к локальному\nхосту. Очевидно, базовый URL сервиса приходит из конфигурации. Вы уже знаете,\nкак устроена конфигурация из предыдущих глав, поэтому весь код приводить мы не\nбудем. Для краткости представим, что глобальная переменная config это словарь\nпараметров. Тогда полный URL для сервиса карт формируется так:</p>\n<div><div><pre><code><span>:url</span><span> </span><span>(</span><span>str</span><span> </span><span>(</span><span>:maps-base-url</span><span> </span><span>config</span><span> </span><span>)</span><span> </span><span>&quot;/search/v1/&quot;</span><span>)</span><span>\n</span></code></pre></div></div>\n<p>Напишем тест главного экрана. На этот раз нам не нужны моки, поэтому тест\nсводится к вызову view-main-page. Прямо сейчас тест не пройдет, потому что мы\nрешили проблему только с поиском заведений. Поиск событий по-прежнему обращается\nк чужому серверу. Чтобы убедиться, стаб работает нормально, на время\nзакомментируем вызов get-events-by-location, а поле :events сделаем nil. После\nэтого тест сработает без ошибок: в поле :sites ответа окажутся данные, что\nвозвращает стаб.</p>\n<div><div><pre><code><span>(</span><span>deftest</span><span> </span><span>test-main-page</span><span>\n</span><span>(</span><span>let</span><span> </span><span>[</span><span>request</span><span> </span><span>{</span><span>:params</span><span> </span><span>{</span><span>:lat</span><span> </span><span>55.751244</span><span>\n</span><span>:lon</span><span> </span><span>37.618423</span><span>}}</span><span>\n</span><span>result</span><span> </span><span>(</span><span>view-main-page</span><span> </span><span>request</span><span>)]</span><span>\n</span><span>(</span><span>is</span><span> </span><span>(</span><span>=</span><span> </span><span>(</span><span>:body</span><span> </span><span>result</span><span>)</span><span> </span><span>{</span><span>:sites</span><span> </span><span>[</span><span>...</span><span>]</span><span> </span><span>:events</span><span> </span><span>nil</span><span>}))))</span><span>\n</span></code></pre></div></div>\n<p>Теперь верните все как было и напишите похожую заглушку для поиска\nсобытий. Оформите ее в фикстуру и убедитесь, что тест проходит. Это задание для\nсамостоятельной работы. Далее мы рассмотрим, что еще интересного предлагают\nстабы.</p>\n<p>Как и в случае с моками, удобно, когда данные лежат в файлах. Чтобы фейковый\nсервер читал файл, измените ответ следующим образом:</p>\n<div><div><pre><code><span>{</span><span>:status</span><span> </span><span>200</span><span>\n</span><span>:body</span><span> </span><span>(</span><span>-></span><span> </span><span>&quot;data/events.json&quot;</span><span>\n</span><span>clojure.java.io/resource</span><span>\n</span><span>clojure.java.io/file</span><span>)}</span><span>\n</span></code></pre></div></div>\n<p>В файл resources/data/events.json запишите ответ реального сервера.</p>\n<p>На текущий момент стаб всегда возвращает успешный ответ. Расширим его логику:\nсделаем так, чтобы при особых условиях мы получали негативные ответы. Проще\nвсего это сделать в зависимости от входных параметров. Договоримся, что\nнекоторые координаты, которые передает пользователь, особые. Например, для пары\n0,0 сервер вернет пустой результат; при 66,66 получим ошибку доступа. С\nкоординатами 42,42 сервер отвечает с задержкой в 35 секунд, что больше\nстандартного ожидания в 30 секунд. Усложним <code>sites-handler*</code>:</p>\n<div><div><pre><code><span>(</span><span>defn</span><span> </span><span>sites-handler*</span><span> </span><span>[</span><span>request</span><span>]</span><span>\n</span><span>(</span><span>let</span><span> </span><span>[{</span><span>:keys</span><span> </span><span>[</span><span>uri</span><span> </span><span>params</span><span>]}</span><span> </span><span>request</span><span>\n</span><span>{</span><span>:keys</span><span> </span><span>[</span><span>lat</span><span> </span><span>lon</span><span>]}</span><span> </span><span>params</span><span>]</span><span>\n</span><span>(</span><span>case</span><span> </span><span>uri</span><span>\n</span><span>&quot;/search/v1/&quot;</span><span>\n</span><span>(</span><span>case</span><span> </span><span>[</span><span>lat</span><span> </span><span>lon</span><span>]</span><span>\n</span><span>[</span><span>&quot;0&quot;</span><span> </span><span>&quot;0&quot;</span><span>]</span><span> </span><span>{</span><span>:status</span><span> </span><span>200</span><span> </span><span>:body</span><span> </span><span>[]}</span><span>\n</span><span>[</span><span>&quot;66&quot;</span><span> </span><span>&quot;66&quot;</span><span>]</span><span> </span><span>{</span><span>:status</span><span> </span><span>403</span><span> </span><span>:body</span><span> </span><span>{</span><span>:error</span><span> </span><span>&quot;ACCESS_ERROR&quot;</span><span>}}</span><span>\n</span><span>[</span><span>&quot;42&quot;</span><span> </span><span>&quot;42&quot;</span><span>]</span><span> </span><span>(</span><span>do</span><span> </span><span>(</span><span>Thread/sleep</span><span> </span><span>(</span><span>*</span><span> </span><span>1000</span><span> </span><span>35</span><span>))</span><span>\n</span><span>{</span><span>:status</span><span> </span><span>200</span><span> </span><span>:body</span><span> </span><span>[]})</span><span>\n</span><span>{</span><span>:status</span><span> </span><span>200</span><span>\n</span><span>:body</span><span> </span><span>[{</span><span>:name</span><span> </span><span>&quot;Cafe1&quot;</span><span> </span><span>:address</span><span> </span><span>&quot;...&quot;</span><span>}</span><span>\n</span><span>{</span><span>:name</span><span> </span><span>&quot;Cafe2&quot;</span><span> </span><span>:address</span><span> </span><span>&quot;...&quot;</span><span>}]})</span><span>\n</span><span>{</span><span>:status</span><span> </span><span>404</span><span> </span><span>:body</span><span> </span><span>&quot;page not found&quot;</span><span>})))</span><span>\n</span></code></pre></div></div>\n<p>Теперь напишите тесты для этих координат. Особенно интересен случай с долгим\nответом (пара 42). Мы должны убедиться, что если сервис карт не отвечает, мы\nждем какое-то разумное время, а не стандартные 30 секунд. Передайте в параметры\n<code>(client/get)</code> поля <code>:socket-timeout</code> и <code>:connection-timeout</code> значения 5000, что\nравно пяти секундам. Этого ожидания достаточно для промышленного\nзапуска. Замерьте время выполнения view-main-page. Добавьте в тест утверждение\nis, что ожидание не превышает 5 секунд с небольшой погрешностью.</p>\n<p>Можно добавить тест для экстремального случая: что произойдет, если сервер\nфизически недоступен. Чтобы смоделировать эту ситуацию, фикстура должна\nпредоставить доступ к переменной server. Проще всего это сделать через\nдинамическую переменную:</p>\n<div><div><pre><code><span>(</span><span>defonce</span><span> </span><span>^</span><span>:dynamic</span><span> </span><span>*server*</span><span> </span><span>nil</span><span>)</span><span>\n</span><span>(</span><span>defn</span><span> </span><span>fix-fake-sites-server</span><span> </span><span>[</span><span>t</span><span>]</span><span>\n</span><span>(</span><span>let</span><span> </span><span>[</span><span>opt</span><span> </span><span>{</span><span>:port</span><span> </span><span>8808</span><span> </span><span>:join?</span><span> </span><span>false</span><span>}]</span><span>\n</span><span>(</span><span>binding</span><span> </span><span>[</span><span>*server*</span><span> </span><span>(</span><span>run-jetty</span><span> </span><span>sites-handler</span><span> </span><span>opt</span><span>)]</span><span>\n</span><span>(</span><span>t</span><span>)</span><span>\n</span><span>(</span><span>.stop</span><span> </span><span>*server*</span><span>))))</span><span>\n</span></code></pre></div></div>\n<p>Напишем тест, в котором мы временно отключим сервер. Обратите внимание, что в\nконце его нужно включить, иначе мы испортим все следующие тесты.</p>\n<div><div><pre><code><span>(</span><span>deftest</span><span> </span><span>test-the-website-is-down</span><span>\n</span><span>(</span><span>.stop</span><span> </span><span>*server*</span><span>)</span><span>\n</span><span>(</span><span>let</span><span> </span><span>[</span><span>request</span><span> </span><span>{</span><span>:params</span><span> </span><span>{</span><span>:lat</span><span> </span><span>1</span><span> </span><span>:lon</span><span> </span><span>2</span><span>}}</span><span>\n</span><span>result</span><span> </span><span>(</span><span>view-main-page</span><span> </span><span>request</span><span>)]</span><span>\n</span><span>(</span><span>is</span><span> </span><span>(</span><span>=</span><span> </span><span>(</span><span>:body</span><span> </span><span>result</span><span>)</span><span> </span><span>{</span><span>...</span><span>})))</span><span>\n</span><span>(</span><span>.start</span><span> </span><span>*server*</span><span>))</span><span>\n</span></code></pre></div></div>\n<p>Сейчас тест не сработает из-за ошибки “Connection refused”. Доработайте логику\nтак, чтобы пользователю ушел пустой результат.</p>\n<h3>Ресурсы и пути</h3>\n<p>Выше мы упомянули, что данные для моков или стабов хранят в файлах. Так мы не\nзагромождаем код объемными списками и словарями. Файлы в папке resources\nназываются ресурсами приложения и играют особую роль: при сборке jar-файла они\nстановятся его частью. Код, запущенный из jar получает доступ к той его части,\nгде располагаются ресурсы. С точки зрения системы это один файл, а изнутри JVM\nнам доступны все те файлы, что были в resources на этапе сборки.</p>\n<p>В одном из примеров мы поместили файл events.json в папку resources/data и\nчитали его как ресурс. Недостаток в том, что эти данные нужны только для\nтестов. Если собрать проект, events.json станет частью выходного jar-файла. Это\nнапрасно увеличит его объем.</p>\n<p>Чтобы отбросить лишние ресурсы при сборке, в проекте настраивают\n:resource-paths. Это поле-список, в котором перечислены возможные пути поиска\nресурсов. По умолчанию оно равно вектору [“resources”]. При объединении профилей\nвектора соединяются в один. Если другой профиль задал ресурсы иначе:</p>\n<div><div><pre><code><span>:resource-paths</span><span> </span><span>[</span><span>&quot;resources_test&quot;</span><span>]</span><span>\n</span></code></pre></div></div>\n<p>то в итоге программа будет искать их в папках resources и resources_test. Во\nвремя финальной сборки оставим только resources, чтобы не вбирать в jar ресурсы\nдля тестов.</p>\n<p>Заметим, что путь resources_test выбран неудачно. Существует другой, более\nудобный способ связать файловую систему и окружение. Это так называемая\nenv-директория, в которой мы говорили в главе про изменяемость. На ее первом\nуровне находятся папки с именами профилей, а внутри src и resources с кодом и\nресурсами. Эти пути задают профилям в описании проекта.</p>\n<p>Создайте нужные пути и переместите данные для теста:</p>\n<div><div><pre><code>mkdir -p env/test/resources/data\nmv resources/data/events.json env/test/resources/data/\nrm -rf resources/data\n</code></pre></div></div>\n<p>В настройках проекта задайте профили и их пути к ресурсам:</p>\n<div><div><pre><code><span>:profiles</span><span> </span><span>{</span><span>:test</span><span> </span><span>{</span><span>:resource-paths</span><span> </span><span>[</span><span>&quot;env/test/resources&quot;</span><span>]}</span><span>\n</span><span>:dev</span><span> </span><span>{</span><span>:resource-paths</span><span> </span><span>[</span><span>&quot;env/test/resources&quot;</span><span>]}}</span><span>\n</span></code></pre></div></div>\n<p>На первый взгляд странно, что для :dev и :test мы указали один и тот же\nпуть. Это потому, что по умолчанию сеанс REPL запускается с профилем dev, но не\ntest. В режиме разработки у нас не будет доступа к ресурсам из env/test. Это\nвлечет неудобства: например, мы исправили код и тут же вызвали тест из REPL, но\nон не проходит из-за неверных путей. Проблему решают двумя способами.</p>\n<p>Первый — запускают REPL с ключом <code>with-profile +test</code>, что значить добавить к\nпрофилю по умолчанию test. Знак плюса означает выполнить слияние; без него\nстандартный профиль будет отброшен. Второй способ, который мы уже рассмотрели —\nпродублировать пути из test в dev.</p>\n<p>В обоих случаях выражение</p>\n<div><div><pre><code><span>(</span><span>def</span><span> </span><span>data-events</span><span>\n</span><span>(</span><span>-></span><span> </span><span>&quot;data/events.json&quot;</span><span>\n</span><span>clojure.java.io/resource</span><span>\n</span><span>slurp</span><span>\n</span><span>(</span><span>cheshire.core/parse-string</span><span> </span><span>true</span><span>)))</span><span>\n</span></code></pre></div></div>\n<p>будет работать одинаково. Физически вы переместили файл с данными, но с точки\nзрения JVM это один и тот же ресурс.</p>\n<p>Особо любознательным предлагаем эксперимент. Скомпилируйте uberjar с разными\nресурсами: в первый раз как обычно, а во второй опцией :resource-paths:</p>\n<div><div><pre><code><span>:profiles</span><span> </span><span>{</span><span>:uberjar</span><span> </span><span>{</span><span>:resource-paths</span><span> </span><span>[</span><span>&quot;env/test/resources&quot;</span><span>]}</span><span>\n</span></code></pre></div></div>\n<p>Перед второй сборкой скопируйте файл target/uberjar/.jar в другую\nпапку, чтобы не затереть его. Распакуйте оба архива командой jar:</p>\n<div><div><pre><code>jar xf &lt;project>.jar\n</code></pre></div></div>\n<p>Среди файлов из второго архива вы найдете data/events.json. Убедитесь, что его\nнет в первом случае. Очевидно, если вы распространяете программу в виде\njar-архива, любой желающий может распаковать его. Поэтому в ресурсах не должно\nбыть приватных данных, например, конфигурации с паролями и ключами. Это касается\nи данных для тестирования — включать их в jar будет ошибкой.</p>\n<p>Пользуясь случаем, исследуйте другие файлы, которые вы получили из jar, их\nструктуру и содержимое.</p>\n<h3>База данных</h3>\n<p>При написании тестов вы столкнетесь с проблемой. Почти каждое действие требует,\nчтобы в базе были определенные данные. Например, для создания пользователя нужна\nучетка администратора. Чтобы добавить пользователя в группу, нужна эта\nгруппа. Чтобы оформить заказ, нужны товары, история покупок для расчета скидки и\nмногое другое. Чем шире логика приложения, тем больше понадобится тестовых\nданных.</p>\n<p>Если каждый тест создает данные под себя, у вас возникнут проблемы с поддержкой\nтаких тестов. Очевидно, требуется единая точка входа, такая, чтобы каждый тест\nимел доступ к одинаковым данным. В идеале они заданы декларативно в файле. Чтобы\nдобавить новые записи, мы должны исправить проект только в одном месте. Когда\nтесты закончились, все, что мы записали в базу, бесследно исчезает. Недопустимо,\nчтобы один тест зависел от изменений, выполненных в другом тесте.</p>\n<p>В этом разделе мы рассмотрим, как работать с базой во время тестов. Начнем с\nпервого шага — подготовки новой базы. Под этим мы понимаем создание всех таблиц,\nиндексов и других сущностей без вставки данных.</p>\n<p>Физически базу создают еще до того, как запустились тесты. Способ зависит от\nтого, как работает база: локально или в Докере. Если локально, достаточно\nвызвать несколько утилит. В примере ниже createuser и createdb входят в поставку\nPostgreSQL.</p>\n<div><div><pre><code>createuser book_test -S -W\ncreatedb -O book_test book_test\n</code></pre></div></div>\n<p>Первая команда создает нового пользователя БД с именем book_test. Ключ -S\nозначает, что это суперпользователь, т.е. обладатель высших\nпривилегий. Супердоступ необходим, чтобы подключать расширения: триграммный\nпоиск, прогрев индексов и другие. В промышленном запуске, наоборот, приложению\nвыделяют минимальные права, но для тестов это неважно. Вторая команда создает\nодноименную пустую базу. Ключ -O (owner) задает владельца базы. Владелец имеет\nполный доступ ко всем ее сущностям.</p>\n<p>Если база работает в Докере, обратитесь к главе про системы. В одноименном\nразделе мы рассмотрели, как задать параметры базы в .yaml-файле и переменными\nсреды.</p>\n<p>Пустую базу наполняют таблицами. Если приложение поддерживает миграции,\nнапример, с помощью библиотек migratus или ragtime, их запускают до тестов из\nкомандной строки:</p>\n<div><div><pre><code>lein migratus migrate\nlein test\n</code></pre></div></div>\n<p>Шага с миграциями можно избежать, если скопировать их в папку Докер-образа\n/docker-entrypoint-initdb.d. Специальный скрипт выполнит все sql-файлы из этой\nпапки на старте образа. Убедитесь, что скопировали только up-миграции, иначе их\ndown-версии сведут пользу на нет.</p>\n<p>К этому моменту в базе уже созданы таблицы и индексы, но нет данных. Мы\nпереходим к основной задаче: перечислим способы их вставки и очистки во время\nтестов.</p>\n<p><strong>Ручная вставка</strong></p>\n<p>В простейшем случае данные для базы хранят в виде коллекции. Специальная функция\nпробегает по списку словарей; каждый словарь это запись в базе. Функцию\nоборачивают в фикстуру, которая запускает тест после вставки всех записей.</p>\n<div><div><pre><code><span>(</span><span>def</span><span> </span><span>db-data</span><span>\n</span><span>[[</span><span>:users</span><span> </span><span>{</span><span>:name</span><span> </span><span>&quot;Ivan&quot;</span><span> </span><span>:email</span><span> </span><span>&quot;ivan@test.com&quot;</span><span>}]</span><span>\n</span><span>[</span><span>:users</span><span> </span><span>{</span><span>:name</span><span> </span><span>&quot;Juan&quot;</span><span> </span><span>:email</span><span> </span><span>&quot;Juan@test.com&quot;</span><span>}]</span><span>\n</span><span>[</span><span>:groups</span><span> </span><span>{</span><span>:name</span><span> </span><span>&quot;Dog fans&quot;</span><span> </span><span>:topics</span><span> </span><span>6</span><span>}]</span><span>\n</span><span>[</span><span>:groups</span><span> </span><span>{</span><span>:name</span><span> </span><span>&quot;Cat fans&quot;</span><span> </span><span>:topics</span><span> </span><span>7</span><span>}]])</span><span>\n</span></code></pre></div></div>\n<p>Здесь и ниже мы полагаем, что глобальная переменная <code>*db*</code> указывает на\nJDBC-спеку. Мы не будем задаваться вопросом, откуда пришла эта\nпеременная. Читатель уже знаком с системами и конфигурацией и вправе задать\n<code>*db*</code> так, как это удобно в проекте.</p>\n<div><div><pre><code><span>(</span><span>defn</span><span> </span><span>load-data</span><span> </span><span>[]</span><span>\n</span><span>(</span><span>doseq</span><span> </span><span>[[</span><span>table</span><span> </span><span>row</span><span>]</span><span> </span><span>db-data</span><span>]</span><span>\n</span><span>(</span><span>jdbc/insert!</span><span> </span><span>*db*</span><span> </span><span>table</span><span> </span><span>row</span><span>)))</span><span>\n</span><span>(</span><span>defn</span><span> </span><span>with-db-data</span><span> </span><span>[</span><span>t</span><span>]</span><span>\n</span><span>(</span><span>load-data</span><span>)</span><span> </span><span>(</span><span>t</span><span>))</span><span>\n</span></code></pre></div></div>\n<p>Заметим, что для каждой записи нужно знать ее таблицу. Это может быть элемент\nпары или поле метаданных. Когда записей одного типа много, имя таблицы\nстановится избыточным. Логично сгруппировать записи по таблицам и вставлять их\nне по одной, а разом, что быстрее.</p>\n<div><div><pre><code><span>(</span><span>def</span><span> </span><span>db-data</span><span>\n</span><span>[[</span><span>:users</span><span> </span><span>[{</span><span>:name</span><span> </span><span>&quot;Ivan&quot;</span><span> </span><span>:email</span><span> </span><span>&quot;ivan@test.com&quot;</span><span>}</span><span>\n</span><span>{</span><span>:name</span><span> </span><span>&quot;Juan&quot;</span><span> </span><span>:email</span><span> </span><span>&quot;Juan@test.com&quot;</span><span>}]]</span><span>\n</span><span>[</span><span>:groups</span><span> </span><span>[{</span><span>:name</span><span> </span><span>&quot;Dog fans&quot;</span><span> </span><span>:topics</span><span> </span><span>6</span><span>}</span><span>\n</span><span>{</span><span>:name</span><span> </span><span>&quot;Cat fans&quot;</span><span> </span><span>:topics</span><span> </span><span>7</span><span>}]]])</span><span>\n</span><span>(</span><span>defn</span><span> </span><span>load-data</span><span> </span><span>[]</span><span>\n</span><span>(</span><span>doseq</span><span> </span><span>[[</span><span>table</span><span> </span><span>rows</span><span>]</span><span> </span><span>db-data</span><span>]</span><span>\n</span><span>(</span><span>jdbc/insert-multi!</span><span> </span><span>*db*</span><span> </span><span>table</span><span> </span><span>rows</span><span>)))</span><span>\n</span></code></pre></div></div>\n<p><strong>Вставка из CSV</strong></p>\n<p>Иногда записей бывает так много, что хранить их в виде словарей\nзатруднительно. В этом случае поможет формат CSV. Это файл с текстом, где каждая\nстрока означает запись, а поля разделены запятой. В первой строке обычно\nразмещают заголовок — имена полей с тем же разделителем.</p>\n<p>У CSV несколько преимуществ. Записи в нем это массивы, а не словари, поэтому они\nне дублируют имена полей. В целом CSV компактней JSON и аналогов. С ним работают\nтабличные редакторы, например Excel и OpenOffice. Это значит, всегда можно\nоткрыть CSV как лист ячеек, добавить или удалить столбец, пересчитать ячейки по\nформуле и сохранить результат.</p>\n<p>Наконец, отдельные базы данных читают и пишут CSV напрямую. Чтобы получить\nданные из определенной таблицы с прода, выборку из нее пишут в CSV, а из него\nвосстанавливают в локальную базу. На больших объемах вставка из CSV работает\nбыстрее, чем обычный INSERT.</p>\n<p>Предположим, нам скинули данные о пользователях с прода в CSV-файле. Вот\nнесколько его первых строк:</p>\n<div><div><pre><code>name,email\nivan,ivan@test.me\njuan,juan@example.com\nioan,ioan@dunno.org\n</code></pre></div></div>\n<p>Данные для тестов это ресурс, сохраним его адресу\nenv/test/resources/data/users.csv, как делали это раньше. Есть два способа\nпоместить данные из него в таблицу: запросом и кодом. Рассмотрим оба из них.</p>\n<p>Вариант с запросом: составим SQL-выражение с командой COPY. Нужно указать\nтаблицу, путь к файлу с данными и его свойства. Под свойствами понимают тип\nразделителя (это может быть не только запятая, но и точка с запятой или\nтабуляция), формат файла и признак заголовка. Последний флаг означает, что\nпервую строку следует пропустить.</p>\n<div><div><pre><code><span>(</span><span>jdbc/execute!</span><span> </span><span>*db*</span><span>\n</span><span>&quot;\nCOPY users(name, email)\nFROM '/Users/ivan/work/book/env/test/resources/data/users.csv'\nDELIMITER ',' CSV HEADER\n&quot;</span><span>)</span><span>\n</span></code></pre></div></div>\n<p>Заметим, что запрос ожидает полный путь к файлу, что мешает командной\nработе. Вероятность того, что коллеги держат проект в папке\n<code>/Users/ivan/work/book</code> равна нулю. Доработайте запрос так, чтобы вместо\nлокального пути подставлялась текущая рабочая директория.</p>\n<p>Выполним то же самое средствами Clojure. Усложним задачу тем, что в файле\nusers.csv очень много записей, и потому он сжат архиватором gzip. Это хорошая\nпрактика: все большие файлы в репозитории должны быть сжаты. Чтобы читать такой\nфайл на лету (т.е. без выгрузки во временную папку), понадобятся импорты:</p>\n<div><div><pre><code><span>(</span><span>:import</span><span> </span><span>java.io.FileInputStream</span><span>\n</span><span>java.util.zip.GZIPInputStream</span><span>\n</span><span>org.postgresql.copy.CopyManager</span><span>)</span><span>\n</span></code></pre></div></div>\n<p>Класс CopyManager делает то же, что и команда COPY. Чтобы создать его экземпляр,\nтребуется соединение с базой (именно TCP-соединение, а не словарь\nспеки). Получим его функцией jdbc/get-connection. Метод copyIn принимает\nSQL-запрос и стрим с данными CSV. Этот стрим мы получим из ресурса\n<code>data/users.csv.gz</code>, пропустив его через серию функций и классов. Последний\nGZIPInputStream занимается тем, что по мере чтения приводит сжатые данные к их\nнормальному виду. В конце работы мы закрываем соединение с базой.</p>\n<div><div><pre><code><span>(</span><span>defn</span><span> </span><span>load-data-gz</span><span> </span><span>[]</span><span>\n</span><span>(</span><span>let</span><span> </span><span>[</span><span>conn</span><span> </span><span>(</span><span>jdbc/get-connection</span><span> </span><span>*db*</span><span>)</span><span>\n</span><span>copy</span><span> </span><span>(</span><span>CopyManager.</span><span> </span><span>conn</span><span>)</span><span>\n</span><span>stream</span><span> </span><span>(</span><span>-></span><span> </span><span>&quot;data/users.csv.gz&quot;</span><span>\n</span><span>clojure.java.io/resource</span><span>\n</span><span>clojure.java.io/file</span><span>\n</span><span>FileInputStream.</span><span>\n</span><span>GZIPInputStream.</span><span>)]</span><span>\n</span><span>(</span><span>.copyIn</span><span> </span><span>copy</span><span> </span><span>&quot;COPY users(name, email)\nFROM STDIN (FORMAT CSV, HEADER true)&quot;</span><span>\n</span><span>stream</span><span>)</span><span>\n</span><span>(</span><span>.close</span><span> </span><span>conn</span><span>)))</span><span>\n</span></code></pre></div></div>\n<p>Нельзя загрузить CSV-файл сразу в несколько таблиц. Соблюдайте правило “один\nфайл — одна таблица”. Если файлов несколько, перепишите функцию так, чтобы она\nпринимала путь к файлу и имя таблицы. Помните, что импорт в разные таблицы может\nпротекать параллельно с помощью футур и pmap.</p>\n<p><strong>Проблема ключей</strong></p>\n<p>Редко бывает так, что таблицы существуют сами по себе. Чаще всего они логически\nсвязаны: пользователь ссылается на профиль, заказ на пользователя и так далее. В\nклассических базах для этого служат первичный и внешний ключи. Первичный ключ\n(PK, Primary key) это поле, которое однозначно определяет запись в\nтаблице. Внешний ключ (FK, Foreign key) это другое поле, которое ссылается на\nодин из PK из другой таблицы. Все вместе это называют отношением таблиц.</p>\n<p>Как правило, первичные ключи это целые числа с автоматической нумерацией. Чтобы\nдобавить запись в таблицу, не нужно подбирать новый PK. Если ключ с\nавтонумерацией, база данных ведет для него уникальный счетчик. Для очередной\nзаписи мы получим новый PK, увеличив счетчик на единицу. Имя счетчика строится\nпо шаблону <code>&lt;table>_&lt;pk>_seq</code>, например, <code>users_id_seq</code>.</p>\n<p>При вставке связанных данных мы должны убедиться, что их PK и FK равны. Проще\nвсего задать им одинаковые значения, например, 3. Тогда в примере ниже\nпользователь действительно ссылается на группу:</p>\n<div><div><pre><code><span>(</span><span>jdbc/insert!</span><span> </span><span>*db*</span><span> </span><span>:groups</span><span> </span><span>{</span><span>:id</span><span> </span><span>3</span><span> </span><span>:name</span><span> </span><span>&quot;Clojure fans&quot;</span><span>})</span><span>\n</span><span>(</span><span>jdbc/insert!</span><span> </span><span>*db*</span><span> </span><span>:users</span><span> </span><span>{</span><span>:group_id</span><span> </span><span>3</span><span> </span><span>:name</span><span> </span><span>&quot;Ivan&quot;</span><span>})</span><span>\n</span></code></pre></div></div>\n<p>Проблема в том, что случайно взятый PK может вступить в конфликт со\nсчетчиком. Предположим, что в момент вставки groups ее счетчик был равен\nнулю. Поскольку мы задали id явно, счетчик не увеличился. Но в одном из тестов\nмы создали еще несколько групп, чтобы проверить какой-то сценарий (например,\nмаксимальное число групп, в которых можно состоять без платной подписки). С\nпервыми двумя группами проблем не возникнет: для них база вычислит ключи 1 и 2\nиз счетчика. Для третьей группы получим ошибку:</p>\n<div><div><pre><code>ERROR:  duplicate key value violates unique constraint 'groups_pkey'\nDETAIL:  Key (id)=(3) already exists\n</code></pre></div></div>\n<p>Новый ключ 3 вступил в конфликт с записью, которую мы добавили раньше. Избежать\nэтого можно двумя способами: коррекцией счетчиков и особым загрузчиком\nданных. Разница в том, кто контролирует счетчики: вы или база данных.</p>\n<p>Под ручной коррекцией имеем в виду следующее. В тестовых данных вы указываете\nпервичные ключи для всех записей. Для удобства некоторые из них выносят в\nпеременную. Например, если на пользователя-админа ссылаются несколько сущностей,\nлогично записать это так:</p>\n<div><div><pre><code><span>(</span><span>def</span><span> </span><span>id-user-admin</span><span> </span><span>1</span><span>)</span><span>\n</span><span>(</span><span>def</span><span> </span><span>db-data</span><span>\n</span><span>[[</span><span>:users</span><span> </span><span>[{</span><span>:id</span><span> </span><span>id-user-admin</span><span> </span><span>:name</span><span> </span><span>&quot;Ivan&quot;</span><span>}]]</span><span>\n</span><span>[</span><span>:profiles</span><span> </span><span>[{</span><span>:id</span><span> </span><span>1</span><span> </span><span>:user_id</span><span> </span><span>id-user-admin</span><span> </span><span>:avatar</span><span> </span><span>&quot;...&quot;</span><span>}]</span><span>\n</span><span>:posts</span><span> </span><span>[{</span><span>:id</span><span> </span><span>1</span><span> </span><span>:user_id</span><span> </span><span>id-user-admin</span><span> </span><span>:title</span><span> </span><span>&quot;New book&quot;</span><span>}</span><span>\n</span><span>{</span><span>:id</span><span> </span><span>2</span><span> </span><span>:user_id</span><span> </span><span>id-user-admin</span><span> </span><span>:title</span><span> </span><span>&quot;Some post&quot;</span><span>}]]])</span><span>\n</span></code></pre></div></div>\n<p>После вставки данных поправьте счетчики так, чтобы они перескочили значения,\nкоторые мы использовали. Предположим, если в тестовый набор входит семь\nпользователей, и мы назначили им ключи от 1 до 7. Тогда установка счетчика в\nзначение 100 решит проблему. Все дальнейшие записи в таблице users получат ключи\n100, 101 и так далее.</p>\n<p>Чтобы сбросить счетчик, выполните запрос ниже:</p>\n<div><div><pre><code><span>(</span><span>jdbc/execute!</span><span> </span><span>*db*</span><span> </span><span>&quot;ALTER SEQUENCE users_id_seq RESTART WITH 100&quot;</span><span>)</span><span>\n</span></code></pre></div></div>\n<p>Если все первичные ключи называются id (что рекомендуется), достаточно знать\nтолько имя таблицы. Их даже не обязательно перечислять: таблицы указаны в\ndb-data. Добавьте в конец функции load-data код:</p>\n<div><div><pre><code><span>(</span><span>let</span><span> </span><span>[</span><span>value</span><span> </span><span>100</span><span>\n</span><span>tables</span><span> </span><span>(</span><span>set</span><span> </span><span>(</span><span>map</span><span> </span><span>first</span><span> </span><span>db-data</span><span>))</span><span>\n</span><span>query</span><span> </span><span>&quot;ALTER SEQUENCE %s_id_seq RESTART WITH %s&quot;</span><span>]</span><span>\n</span><span>(</span><span>doseq</span><span> </span><span>[</span><span>table</span><span> </span><span>tables</span><span>]</span><span>\n</span><span>(</span><span>jdbc/execute!</span><span> </span><span>*db*</span><span> </span><span>(</span><span>format</span><span> </span><span>query</span><span> </span><span>(</span><span>name</span><span> </span><span>table</span><span>)</span><span> </span><span>value</span><span>))))</span><span>\n</span></code></pre></div></div>\n<p>Он подхватит все таблицы, указанные в db-data и выставит счетчик в точное\nзначение. На больших данных, например, из CSV, цифру 100 придется увеличить на\nпорядок или два. Технически мы можем отличить исходные записи от добавленных в\nпроцессе, если это потребуется (id &lt; 100 и наоборот).</p>\n<p>Теперь рассмотрим свой загрузчик. В этом случае мы полагаемся на ключи, которые\nвернула база данных. Конкретные их значения не важны. Главное, чтобы у связанных\nсущностей первичный и внешний ключи были одинаковы. Для этого пойдем на\nхитрость.</p>\n<p>Для начала удалим первичные ключи из тестовых данных. Ни в одно словаре не\nдолжно быть поля :id с конкретным значением. Сущностям, на которые нужно\nссылаться, присвоим псевдонимы. Проще всего это сделать через метаданные (поле\n:entity, :alias и т.д). В связных сущностях в поле-ссылке укажем псевдоним.</p>\n<div><div><pre><code><span>;; user</span><span>\n</span><span>^</span><span>{</span><span>:entity</span><span> </span><span>:users/admin</span><span>}</span><span> </span><span>{</span><span>:name</span><span> </span><span>&quot;Ivan&quot;</span><span> </span><span>:email</span><span> </span><span>&quot;ivan@test.com&quot;</span><span>}</span><span>\n</span><span>;; profile</span><span>\n</span><span>{</span><span>:user_id</span><span> </span><span>:users/admin</span><span> </span><span>:avatar</span><span> </span><span>&quot;/images/ivan.png&quot;</span><span>}</span><span>\n</span><span>;; posts</span><span>\n</span><span>{</span><span>:user_id</span><span> </span><span>:users/admin</span><span> </span><span>:title</span><span> </span><span>&quot;New book&quot;</span><span>}</span><span>\n</span><span>{</span><span>:user_id</span><span> </span><span>:users/admin</span><span> </span><span>:title</span><span> </span><span>&quot;Some post&quot;</span><span>}</span><span>\n</span></code></pre></div></div>\n<p>Загрузчик перебирает записи и делает следующие проверки. Если у записи\nпсевдоним, мы связываем его с ключом, который вернула база. На старте загрузчик\nобъявляет атом с пустым словарем и наполняет его в процессе, например,\n{:users/admin 42}. Ключ мы получим из ответа функции jdbc/insert!. В зависимости\nот типа базы ответ будет разным:</p>\n<div><div><pre><code><span>(</span><span>jdbc/insert!</span><span> </span><span>*db*</span><span> </span><span>:users</span><span> </span><span>{</span><span>:name</span><span> </span><span>&quot;Ivan&quot;</span><span>})</span><span>\n</span><span>({</span><span>:id</span><span> </span><span>42</span><span> </span><span>:name</span><span> </span><span>&quot;</span><span>Ivan</span><span>})</span><span> </span><span>;; for PostgreSQL</span><span>\n</span><span>({</span><span>:generated_key</span><span> </span><span>42</span><span>})</span><span> </span><span>;; for MariaDB</span><span>\n</span></code></pre></div></div>\n<p>Перед вставкой загрузчик проверяет поля записи. Если это ключ, например,\n{:user_id :users/admin}, мы считаем, что это ссылка. Заменяем ссылку на значение\nиз атома по ключу. Если в атоме нет такого ключа, кидаем исключение. Предлагаем\nчитателю написать такой загрузчик самостоятельно.</p>\n<p><strong>Удаление данных</strong></p>\n<p>Мы достаточно много сказали про вставку данных и переходим к их\nудалению. Очистка базы важна не меньше, чем ее наполнение. Она должна вызывать\nминимум усилий и не оставлять после себя артефактов.</p>\n<p>Наивный способ очистить базу — послать запрос <code>DELETE FROM &lt;table></code> для всех\nтаблиц, с которыми мы работаем. Проблема DELETE в том, что он учитывает\nзависимость ключей. Например, если запись из другой таблицы ссылается на users,\nудалить пользователей не получится. Придется вызвать DELETE в правильном\nпорядке: сначала для связной таблицы, затем users. Чем больше у вас таблиц, тем\nсложнее будет заполнить порядок.</p>\n<p>Такое поведение не относится к недостаткам: наоборот, без контроля за ссылками\nбаза станет неконсистентной. Параметры контроля можно задать в объявлении\nвнешнего ключа (см. справку по foreign key). Но вообще, нас интересует как\nочистить данные независимо от того, как объявлены ссылки.</p>\n<p>Команда TRUNCATE (анг. “усечь, подрезать”) нужна для быстрой очистки таблицы. В\nотличии от DELETE она не вызывает триггеры удаления и не сканирует всю\nтаблицу. TRUNCATE принимает несколько несколько таблиц за раз. Еще одно ее\nпреимущество в каскадном режиме. Если передан флаг CASCADE, все таблицы, которые\nтак или иначе входят в граф связей, тоже очищаются. На практике выходит, что\nкаскадная очистка пары таблиц вызывает цепную реакцию по всей базе.</p>\n<p>Напишем функцию очистки. Она посылает запрос, в котором через запятую\nперечислены все таблицы из данных для тестов. Добавьте ее в фикстуру\nwith-db-data сразу после вызова (t).</p>\n<div><div><pre><code><span>(</span><span>defn</span><span> </span><span>delete-data</span><span> </span><span>[]</span><span>\n</span><span>(</span><span>let</span><span> </span><span>[</span><span>tables</span><span> </span><span>(</span><span>set</span><span> </span><span>(</span><span>map</span><span> </span><span>first</span><span> </span><span>db-data</span><span>))</span><span>\n</span><span>tables-comma</span><span> </span><span>(</span><span>clojure.string/join</span><span> </span><span>&quot;,&quot;</span><span> </span><span>(</span><span>map</span><span> </span><span>name</span><span> </span><span>tables</span><span>))</span><span>\n</span><span>query</span><span> </span><span>(</span><span>format</span><span> </span><span>&quot;TRUNCATE %s CASCADE&quot;</span><span> </span><span>tables-comma</span><span>)]</span><span>\n</span><span>(</span><span>jdbc/execute!</span><span> </span><span>*db*</span><span> </span><span>query</span><span>)))</span><span>\n</span></code></pre></div></div>\n<p><em>Продолжение следует.</em></p>",
   :direction "ltr"},
  :updated 1573084800000,
  :entities
  [{:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "REPL"}],
    :id "nlp/f/entity/wd:2032810",
    :salienceLevel "mention",
    :label "Read–eval–print loop"}
   {:mentions [{:text "API"}],
    :id "nlp/f/entity/wd:165194",
    :salienceLevel "mention",
    :label "application programming interface"}
   {:mentions [{:text "cider"}],
    :id "nlp/f/entity/wd:167296",
    :salienceLevel "mention",
    :label "cider"}
   {:mentions [{:text "File"}],
    :id "nlp/f/entity/wd:2429918",
    :salienceLevel "mention",
    :label "file folder"}],
  :alternate
  [{:href "https://grishaev.me/clj-book-tests-1/", :type "text/html"}],
  :title "Тесты в Clojure (фрагмент главы)",
  :author "Ivan Grishaev",
  :published-str "Wed Nov 06 16:00:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16e46dd9637:12c0976f:ad5391a1",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://grishaev.me/clj-book-tests-1/",
  :commonTopics
  [{:score 83.7866660267589,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1573084800000,
  :fingerprint "d8d809ec",
  :canonicalUrl "https://grishaev.me/clj-book-tests-1/"}
 {:engagement 5,
  :unread false,
  :crawled 1573134205448,
  :content
  {:content
   "<p>Another day, another hard topic to tackle! How do you (hard) restart CIDER?\nThat should be simple, right? Well, it really depends on your perspective\nand on your definition of a “restart”.</p>\n<p>CIDER has two commands with the word “restart” in their name - one is\n<code>cider-restart</code> and the other is <code>sesman-restart</code>. I’ve noticed that the majority\nof CIDER’s users define “restart” as:</p>\n<ul>\n<li>Restart the nREPL server</li>\n<li>Reconnect CIDER to the newly started nREPL server</li>\n</ul>\n<p>I’ve also noticed the majority of the users expect the command <code>cider-restart</code> to do exactly this.\nIt might come as a shock to some people, but this command does something pretty different -\nit simply kills the current nREPL connection (which in CIDER is the same as a REPL buffer) and\ncreates a new one to the same nREPL server. I like to think of this as “soft restart”.\nStill, the question remains - how can we do a “hard restart”?</p>\n<p>Enter <code>sesman-restart</code>. This command is a whole different beast - it will actually restart\nthe underlying nREPL server and re-create all connections within the same CIDER session.\nI guess that’s more aligned with the expectation of most people.</p>\n<p>The way I see it there are two primary reasons for the confusion:</p>\n<ul>\n<li><code>cider-restart</code> used to behave differently before we introduced the concept of multiple connections grouped\nin a single session (the <code>sesman</code> library provides this session abstraction)</li>\n<li>most people don’t understand very well the concept of sessions in CIDER and the relationship between CIDER and <code>sesman</code>.\nAs a corollary - they won’t think to look for commands that are not prefixed with <code>cider-</code>.</li>\n</ul>\n<p>There’s also the fact that the name <code>cider-restart</code> is probably not ideal. Perhaps a better name would be <code>cider-restart-repl</code>\nor <code>cider-restart-connection</code>? Naming is hard…</p>\n<p>I’ll ruminate on the subject of what’s the best course of action. As usual -\nfeedback and ideas from you would be welcome! In the mean time I plan to work\non improving the <a href=\"https://docs.cider.mx/cider/usage/managing_connections.html\">connection management\ndocumentation</a>, so\nit’s clearer how the two command differ.</p>\n<p>That’s all I have for you today. This episode was brought to you by <a href=\"https://www.clojuriststogether.org/\">Clojurists Together</a>.\nThey are awesome and so are all of you! Keep hacking!</p>",
   :direction "ltr"},
  :updated 1573084800000,
  :entities
  [{:mentions [{:text "hard cider"} {:text "cider"}],
    :id "nlp/f/entity/wd:167296",
    :salienceLevel "about",
    :label "cider"}
   {:mentions [{:text "REPL"}],
    :id "nlp/f/entity/wd:2032810",
    :salienceLevel "mention",
    :label "Read–eval–print loop"}],
  :alternate
  [{:href
    "http://metaredux.com/posts/2019/11/07/hard-cider-hard-restart.html",
    :type "text/html"}],
  :title "Hard CIDER: Hard Restart",
  :author "Bozhidar Batsov",
  :published-str "Wed Nov 06 16:00:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16e461b0208:12ad01b3:ad5391a1",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "http://metaredux.com/posts/2019/11/07/hard-cider-hard-restart",
  :published 1573084800000,
  :fingerprint "d50a2264",
  :canonicalUrl
  "http://metaredux.com/posts/2019/11/07/hard-cider-hard-restart.html"}
 {:engagement 6,
  :unread false,
  :crawled 1573110696148,
  :content
  {:content
   "<p>We use the term ‘abstraction’ all the time. But what does it mean? If it’s such an important concept, we should have a clear idea of its meaning. In this episode, I go over two related definitions from two important sources.</p>\n<p></p>\n<div>\n<div><span></span><img alt=\"Video Thumbnail\" src=\"https://i.ytimg.com/vi/z36ARq1yQWk/mqdefault.jpg\"><p></p>\n<h5>What is abstraction?</h5>\n<p><span>We use the term 'abstraction' all the time. But what does it mean? If it's such an important concept, we should have a clear idea of its meaning. In this episode, I go over two related definitions from two important sources. https://share.transistor.fm/e/3cbdac71 https://www.youtube.com/watch?v=z36A</span></p></div>\n</div>\n<h2>Transcript</h2>\n<p>Eric Normand: What is abstraction? What is unabstraction? This episode, by the end of it, I hope to get to the bottom of this common term. Probably won’t get all the way to the bottom.</p>\n<p>My name is Eric Normand. I help people thrive with functional programming. This is an important topic. It’s a term we use all the time. I hear it used. I read it.</p>\n<p>People say, “Oh, I built this abstraction. Here’s an abstraction. Let’s make an abstraction.” Do we really know what it means? I think most of the time we use it incorrectly. That’s why I wanted to start researching it and decided to make a little episode about my research.</p>\n<p>I recently listened to the CoRecursive Podcast. It’s another great functional programming podcast by Adam Bell.</p>\n<p>He does interviews. He had on Hal Ableson, who was the co-author of “Structure and Interpretation of Computer Programs.” Adam asked him a lot about the origins of the book and why it was important because it’s, I don’t know, 40 years old now, almost.</p>\n<p>He said something really interesting I didn’t know which was, at the time that it was written, most programming books were like, “OK. Here’s your data types and here’s your syntax.”</p>\n<p>Their book, “Structure and Interpretation of Computer Programs,” does a little bit of talk about data types and stuff, and it really starts pretty early with abstraction and what does it mean.</p>\n<p>This idea that computer programs are written for people to read primarily, that you’re building up, you’re composing up abstractions. It just starts really early with that.</p>\n<p>That was new. At that time people, weren’t using the term abstraction quite so much.</p>\n<p>I got curious. I’ve done research before about what abstraction means. When I say research, I’m talking about light, light research.</p>\n<p>I look it up on Wikipedia. I ask my friends what they think it means. [laughs] It’s not heavy duty research.</p>\n<p>Sometimes, you have friends that have good insights and tell you exactly what to read. That happens to be the case. Let me get into this.</p>\n<p>The way I hear people use “abstraction” all the time is they’ll say, “That’s the wrong abstraction or I’m building an abstraction.” What they mean is they’re composing up pieces from their language that they’ve built already into something new. They’re building a class or a function or something. They’re calling that an abstraction. Are these really abstractions?</p>\n<p>“Structure and Interpretation of Computer Programs” defines abstractions as naming and manipulating. It’s not about the composition. It’s about giving that composition a name and being able to treat that composition as a unit, as a thing that can be further used in your program.</p>\n<p>It’s a way of ignoring how the thing is made. You’re giving it a name. Now, you don’t care where it came from. You’re just going to refer it by name. It’s a way of ignoring that origin.</p>\n<p>In the book, they also have a quote from John Locke about abstraction. In that, John Locke talks about different ways of understanding an idea. One of the ways is to take that idea by itself completely out of context not related to anything else and just look at the idea alone. That’s what John Locke calls abstraction.</p>\n<p>It’s this ignoring the context. It’s removing it from its concrete origins. Both of these are kind of similar. You can see that maybe that the [inaudible 5:02] definition is a refinement of this definition for use in programming and not just as thinking and philosophizing as John Locke was doing. They’re all about reification.</p>\n<p>We take this thing that has some meaning in a context and we take it from that context so that we can look at it alone. We take this function or this class that we’ve built out of parts. We put them together and now we’re just going to ignore where it came from and just refer to it by name and now manipulate it based on its name. Totally removing it from context.</p>\n<p>This is the kind of abstraction that you might think of like something is very abstract. It has no context. It has no real world part to it. I’m just talking about in the abstract outside of the context.</p>\n<p>There’s another definition. There’s a different definition. Zach Tellman is a Clojure programmer, pretty well known Clojure programmer. He’s written a book called “The Elements of Clojure.”</p>\n<p>To write that book, the research — better research than I do let me tell you — he read a lot of books to put this book together. He was looking for a definition of abstraction for that book.</p>\n<p>He eventually discovered and settled on Barbara Liskov’s definition, which he says is the best one, so clear. After searching and searching, this was just like, “Yes, that’s it.” Why couldn’t I formulate that? She has come up with such a nice definition of it.</p>\n<p>I’m paraphrasing. I don’t know the particular words she uses, but it’s basically treating two different things as if they were the same. You’re ignoring the differences and just treating them as if they were the same. This is stuff like modularity.</p>\n<p>I have these two different modules. They’re different, but they have the same API so I can swap them out. We do this in the real world, the whole idea of interchangeable parts. “Oh, this piece broke on my vacuum cleaner. I can just order another part and it pops right in.” It’s a different part. It is a totally different part.</p>\n<p>It’s not the same part, but it still works in there because it’s made to have the same interface as the other part. They might even be made on the same machine, but they are different. We’re ignoring those differences and using them like they were the same.</p>\n<p>This is where we get polymorphism from. Two classes that implement the same interface are supposed to be interchangeable.</p>\n<p>Also, you see this idea of reification, that you can start talking about the interface itself and not the particular instances of that interface.</p>\n<p>Reification is coming up in both. You’re able to manipulate the abstraction as it is without caring about its origins. That’s kind of a reification. You’re talking about it and manipulating it by name.</p>\n<p>This other kind of reification where the thing that is similar about them, the interface between two things, is the thing you’re talking about. Both are about reification.</p>\n<p>Looking at these two definitions that are…they’re different. One is more primarily about reification, this naming and manipulating. I have a whole episode on reification.</p>\n<p>Reification basically means making something real so you name an idea and now you can talk about the idea as if it were a thing, even though, it was just an idea. That’s reification.</p>\n<p>Philosophers do this all the time. They make an idea real. They flesh it out. That’s reification. We do that in computer programs by saying, “Let’s make this relationship first class.”</p>\n<p>A person has a bike. I don’t know of that’s a good example, [laughs] but you can make that first class, like a possession. It’s a thing now.</p>\n<p>The second definition is more about ignoring differences between two things that are different. In the first case, you just have one thing and you’re ignoring something. You’re ignoring its origin, how it was created.</p>\n<p>Then, the second thing, you’re talking about two different things and how they are similar. How they are similar becomes reified. They’re very different. Neither of them really is how we use the term. It’s not about building something up and calling that an abstraction. It’s about something else.</p>\n<p>It’s about this idea of treating two things the same, so in the sense of like, an algebraic property is an abstraction, because, as far as associativity goes, we are treating addition and multiplication the same. They’re both associative so we have this thing that ignores the actual operation and just says these things are the same.</p>\n<p>At the same time, we’ve named it and now we can manipulate it as a thing. That is the other definition of abstraction.</p>\n<p>I don’t think we have gotten to the bottom of this. I think that we are closer. I think I have a better idea of abstraction. I hope you do, too. I’ll just recap really quick.</p>\n<p>We often say build an abstraction or have the wrong abstraction and really we’re not talking about an abstraction. We are talking about something we’ve composed up. It’s more like a concretion. We’ve taken a hash map and mashed it up with a vector and now we’re calling that an abstraction. It’s not an abstraction.</p>\n<p>The abstraction is naming that thing and being able to manipulate it or seeing that we can treat it the same as some other thing and doing so. Treating them the same even though they’re different.</p>\n<p>All right. If you’ve enjoyed this meandering explorational episode…I have a feeling some people would really like this and would want to discuss further, especially since I haven’t really come to any firm conclusions or anything useful. Probably get more feedback on this one than I get on most episodes.</p>\n<p>Well, if you liked this one, you can find all the other episodes at lispcast.com/podcast. There you’ll find audio and video and text versions of all the past episodes.</p>\n<p>You’ll also find link to subscribe and please do so that you get the new episodes and links to find me on social media so that you can get in touch with me with all that great feedback, all those great thoughts that you’re having right now. I’d love to hear them.</p>\n<p>This has been my thought on functional programming. My name is Eric Normand. Thank you for listening and rock on.</p>\n<p>The post <a rel=\"nofollow\" href=\"https://lispcast.com/what-is-abstraction-2/\">What is abstraction?</a> appeared first on <a rel=\"nofollow\" href=\"https://lispcast.com\">LispCast</a>.</p>",
   :direction "ltr"},
  :updated 1573106400000,
  :entities
  [{:mentions [{:text "John Locke"}],
    :id "nlp/f/entity/wd:9353",
    :salienceLevel "mention",
    :label "John Locke"}
   {:mentions [{:text "functional programming"}],
    :id "nlp/f/entity/wd:193076",
    :salienceLevel "mention",
    :label "functional programming"}
   {:mentions
    [{:text "Structure and Interpretation of Computer Programs"}],
    :id "nlp/f/entity/wd:1249747",
    :salienceLevel "mention",
    :label "Structure and Interpretation of Computer Programs"}
   {:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "Wikipedia"}],
    :id "nlp/f/entity/wd:52",
    :salienceLevel "mention",
    :label "Wikipedia"}],
  :alternate
  [{:href "https://lispcast.com/what-is-abstraction-2/",
    :type "text/html"}],
  :title "What is abstraction?",
  :author "Eric Normand",
  :published-str "Wed Nov 06 22:00:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16e44b448d4:1333f56e:69b9f616",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url "http://img.youtube.com/vi/z36ARq1yQWk/0.jpg",
   :width 480,
   :height 360,
   :contentType "image/jpeg"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://lispcast.com/?p=2075",
  :commonTopics
  [{:score 58.88973889267761,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1573106400000,
  :fingerprint "b67d90b8",
  :canonicalUrl "https://lispcast.com/what-is-abstraction-2/"}
 {:engagement 18,
  :unread false,
  :crawled 1573049677770,
  :recrawled 1573082662297,
  :content
  {:content
   "<div>\n<div>\n<div>\n<p><a href=\"https://github.com/Olical/conjure\">Conjure</a> is my attempt at <a href=\"https://clojure.org/\">Clojure</a> and <a href=\"https://clojurescript.org/\">ClojureScript</a> tooling for <a href=\"https://neovim.io/\">Neovim</a> without relying on any existing <a href=\"https://nrepl.org/\">nREPL</a> based dependencies. Instead it relies on the <a href=\"https://oli.me.uk/exploring-repl-tooling-with-prepl/\">socket prepl</a> which is built into all newer versions of the language.</p>\n</div>\n<div>\n<p>Here’s a quick demo of Conjure in action for those of you that haven’t seen it before.</p>\n</div>\n<div>\n<p>I’m going to help you get Clojure code evaluating in a matter of minutes, you’ll be able to try Conjure for yourself and see what it’s all about. All you’re going to need are the following.</p>\n</div>\n<div>\n<ul>\n<li>\n<p>The <a href=\"https://clojure.org/guides/getting_started\">Clojure CLI</a> - I installed it through the Arch Linux package manager, you can probably do something similar.</p>\n</li>\n<li>\n<p><a href=\"https://neovim.io/\">Neovim</a></p>\n</li>\n<li>\n<p>A hot beverage to enjoy as you follow along.</p>\n</li>\n</ul>\n</div>\n</div>\n</div>\n<div>\n<h2>Grab plugin manager</h2>\n<div>\n<div>\n<p>I’m assuming you have nothing set up for Neovim right now, let’s get started with a plugin manager. Skip ahead if you already have a preferred way to install plugins!</p>\n</div>\n<div>\n<p>I’ve used <a href=\"https://github.com/junegunn/vim-plug\">vim-plug</a> for years and I highly recommend it. Setup is really easy, let’s start out by fetching the script.</p>\n</div>\n<div>\n<div>\n<pre><code>curl <span>-fLo</span> ~/.local/share/nvim/site/autoload/plug.vim <span>--create-dirs</span> <span>\\</span>\n    https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim</code></pre>\n</div>\n</div>\n<div>\n<p>Now we need to edit <code>~/.config/nvim/init.vim</code> to initialise it. I’m going to get you started with <a href=\"https://github.com/liuchengxu/vim-better-default\">vim-better-default</a>, as you’d expect, it’s a set of great default configuration values.</p>\n</div>\n<div>\n<div>\n<pre><code><span>&quot; Specify a directory for plugins.</span>\n<span>call</span> plug#begin<span>(</span>stdpath<span>(</span><span>'data'</span><span>)</span> <span>.</span> <span>'/plugged'</span><span>)</span>\n\n<span>&quot; Specify your required plugins here.</span>\nPlug <span>'liuchengxu/vim-better-default'</span>\n\n<span>&quot; Initialize plugin system.</span>\n<span>call</span> plug#<span>end</span><span>()</span></code></pre>\n</div>\n</div>\n<div>\n<p>Now we can open Neovim and execute <code>:PlugInstall</code>. Have a look around the <a href=\"https://github.com/junegunn/vim-plug\">vim-plug</a> documentation to find more commands you can run for things like updating or pruning of unused plugins.</p>\n</div>\n<div>\n<p>Whenever you make a change to your plugin configuration in <code>init.vim</code> you’ll need to reload the file by restarting Neovim. I think you might be able to <code>:source %</code> too but restarting Neovim is really quick. Once you’ve done that you can install or update whatever was specified.</p>\n</div>\n</div>\n</div>\n<div>\n<h2>Optional (amazing) plugins</h2>\n<div>\n<div>\n<p>Although you can get away with <em>just</em> Conjure, I’d highly recommend you also add at least some of these too. They’ll greatly improve your experience!</p>\n</div>\n<div>\n<h3><a href=\"https://github.com/easymotion/vim-easymotion\">EasyMotion</a></h3>\n<div>\n<p><em>The</em> way to move around your buffer with ease, extremely useful when you’re jumping from form to form performing evaluations. The only downside is that editing without it in any other editor now feels far too cumbersome.</p>\n</div>\n<div>\n<div>\n<pre><code>Plug <span>'easymotion/vim-easymotion'</span></code></pre>\n</div>\n</div>\n</div>\n<div>\n<h3><a href=\"https://github.com/guns/vim-sexp\">vim-sexp</a> and <a href=\"https://github.com/tpope/vim-sexp-mappings-for-regular-people\">vim-sexp-mappings-for-regular-people</a></h3>\n<div>\n<p>These will take you a while to get the hang of but they’re so worth it. They allow you to structurally edit any lisp language, this means you can turn <code>(+ 10 20) 30</code> into <code>(+ 10 20 30)</code> with a key press all while keeping your cursor in the same place.</p>\n</div>\n<div>\n<p>The learning curve is steep but optional, you can always edit the text manually. The more you learn the faster and more fluid you’ll get, it’s well worth investing some time into.</p>\n</div>\n<div>\n<div>\n<pre><code>Plug <span>'guns/vim-sexp'</span>\nPlug <span>'tpope/vim-sexp-mappings-for-regular-people'</span></code></pre>\n</div>\n</div>\n</div>\n<div>\n<h3><a href=\"https://github.com/Shougo/deoplete.nvim\">Deoplete</a> and <a href=\"https://github.com/ncm2/float-preview.nvim\">float-preview</a></h3>\n<div>\n<blockquote>\n<div>\n<p>Make sure you have Python <code>3.6.1</code> or greater installed before attempting to use Deoplete!</p>\n</div>\n</blockquote>\n</div>\n<div>\n<p>Conjure has completion built in via Neovim’s native <a href=\"https://vim.fandom.com/wiki/Omni_completion\">Omnicompletion</a> but I’d recommend you add an asynchronous autocompleter for maximum convinience.</p>\n</div>\n<div>\n<div>\n<pre><code>Plug <span>'Shougo/deoplete.nvim'</span>\nPlug <span>'ncm2/float-preview.nvim'</span>\n\n<span>&quot; Place configuration AFTER `call plug#end()`!</span>\n<span>let</span> <span>g:deoplete</span>#enable_at_startup <span>=</span> <span>1</span>\n<span>call</span> deoplete#custom#<span>option</span><span>(</span><span>'keyword_patterns'</span><span>,</span> <span>{</span><span>'clojure'</span><span>:</span> <span>'[\\w!$%&amp;*+/:&lt;=>?@\\^_~\\-\\.#]*'</span><span>})</span>\n<span>set</span> completeopt<span>-=</span>preview\n\n<span>let</span> <span>g:float_preview</span>#docked <span>=</span> <span>0</span>\n<span>let</span> <span>g:float_preview</span>#max_width <span>=</span> <span>80</span>\n<span>let</span> <span>g:float_preview</span>#max_height <span>=</span> <span>40</span></code></pre>\n</div>\n</div>\n<div>\n<p>Conjure comes bundled with the Python code required to hook itself into Deoplete automatically, combine that with float-preview and suddenly you have automatic completions popping up with their documentation alongside it as you type.</p>\n</div>\n<div>\n<blockquote>\n<div>\n<p>If Deoplete isn’t your thing you might want to try <a href=\"https://github.com/neoclide/coc.nvim\">Conquer of Completion</a> (Coc for short!). <a href=\"https://github.com/jlesquembre/coc-conjure\">coc-conjure</a> will provide Conjure support, I think Coc works with language servers out of the box too, it’s definitely worth considering.</p>\n</div>\n<div>\n<p>I’ve just always been a Deoplete fan and don’t find myself using language servers. The plugins being JavaScript dependencies always felt a little odd to me too although that’s a minor silly point.</p>\n</div>\n</blockquote>\n</div>\n</div>\n<div>\n<h3><a href=\"https://github.com/jiangmiao/auto-pairs\">auto-pairs</a></h3>\n<div>\n<p>Simply a really handy way to keep your pairs of characters in check, not quite essential but nice to have.</p>\n</div>\n<div>\n<div>\n<pre><code>Plug <span>'jiangmiao/auto-pairs'</span><span>,</span> <span>{</span> <span>'tag'</span><span>:</span> <span>'v2.0.0'</span> <span>}</span></code></pre>\n</div>\n</div>\n</div>\n<div>\n<h3><a href=\"https://github.com/w0rp/ale\">ALE</a></h3>\n<div>\n<p>The Asynchronous Lint Engine, when combined with <a href=\"https://github.com/borkdude/clj-kondo\">clj-kondo</a> and <a href=\"https://github.com/candid82/joker\">joker</a>, is an indispensable tool. It’s caught countless typos and brain farts for me <em>before</em> I’ve had a chance to evaluate the code.</p>\n</div>\n<div>\n<div>\n<pre><code>Plug <span>'w0rp/ale'</span>\n\n<span>&quot; Place configuration AFTER `call plug#end()`!</span>\n<span>let</span> <span>g:ale_linters</span> <span>=</span> <span>{</span>\n<span> \\</span> <span>'clojure'</span><span>:</span> <span>[</span><span>'clj-kondo'</span><span>,</span> <span>'joker'</span><span>]</span>\n<span> \\</span><span>}</span></code></pre>\n</div>\n</div>\n</div>\n</div>\n</div>\n<div>\n<h2><a href=\"https://github.com/liuchengxu/vim-clap\">vim-clap</a></h2>\n<div>\n<div>\n<p>If you want to get into Neovim properly you’re probably going to want a way to find things in your project, that’s where <a href=\"https://github.com/liuchengxu/vim-clap\">vim-clap</a> comes in.</p>\n</div>\n<div>\n<p>It allows you to hook into various searching tools such <a href=\"https://github.com/BurntSushi/ripgrep\">ripgrep</a> in a pretty floating window. You’ll have to spend a little while setting up your mappings to each command but it’s well worth the investment. You can find my configuration in <a href=\"https://github.com/Olical/dotfiles/blob/29f47aaaa279769ea82367a4ff4a3c5916d2c082/neovim/.config/nvim/modules/plugins/vim-clap.vim\">my dotfiles</a>.</p>\n</div>\n<div>\n<div>\n<pre><code>Plug <span>'liuchengxu/vim-clap'</span>\n\n<span>&quot; Configuration from my dotfiles.</span>\n<span>let</span> <span>g:clap_provider_grep_delay</span> <span>=</span> <span>50</span>\n<span>let</span> <span>g:clap_provider_grep_opts</span> <span>=</span> <span>'-H --no-heading --vimgrep --smart-case --hidden -g &quot;!.git/&quot;'</span>\n\nnnoremap <span>&lt;</span>leader<span>></span>* <span>:</span>Clap <span>grep</span> <span>++</span>query<span>=&lt;</span>cword<span>>&lt;</span><span>cr</span><span>></span>\nnnoremap <span>&lt;</span>leader<span>></span>fg <span>:</span>Clap <span>grep</span><span>&lt;</span><span>cr</span><span>></span>\nnnoremap <span>&lt;</span>leader<span>></span>ff <span>:</span>Clap <span>files</span> <span>--</span>hidden<span>&lt;</span><span>cr</span><span>></span>\nnnoremap <span>&lt;</span>leader<span>></span>fb <span>:</span>Clap <span>buffers</span><span>&lt;</span><span>cr</span><span>></span>\nnnoremap <span>&lt;</span>leader<span>></span>fw <span>:</span>Clap windows<span>&lt;</span><span>cr</span><span>></span>\nnnoremap <span>&lt;</span>leader<span>></span>fr <span>:</span>Clap <span>history</span><span>&lt;</span><span>cr</span><span>></span>\nnnoremap <span>&lt;</span>leader<span>></span>fh <span>:</span>Clap command_history<span>&lt;</span><span>cr</span><span>></span>\nnnoremap <span>&lt;</span>leader<span>></span>fj <span>:</span>Clap <span>jumps</span><span>&lt;</span><span>cr</span><span>></span>\nnnoremap <span>&lt;</span>leader<span>></span>fl <span>:</span>Clap blines<span>&lt;</span><span>cr</span><span>></span>\nnnoremap <span>&lt;</span>leader<span>></span>fL <span>:</span>Clap lines<span>&lt;</span><span>cr</span><span>></span>\nnnoremap <span>&lt;</span>leader<span>></span>ft <span>:</span>Clap filetypes<span>&lt;</span><span>cr</span><span>></span>\nnnoremap <span>&lt;</span>leader<span>></span>fm <span>:</span>Clap <span>marks</span><span>&lt;</span><span>cr</span><span>></span></code></pre>\n</div>\n</div>\n</div>\n</div>\n<div>\n<h2>Adding Conjure</h2>\n<div>\n<div>\n<p>Installing the plugin is the same as any other apart from one minor detail: We have to specify a &quot;compile&quot; script that gets executed upon update to ensure Conjure starts quickly. Luckily, this is easy to do with vim-plug!</p>\n</div>\n<div>\n<blockquote>\n<div>\n<p>I’m specifying the latest tagged version at the time of writing this post, have a look at the <a href=\"https://github.com/Olical/conjure\">Conjure</a> repository to find the latest version and decide if you would like to use that instead.</p>\n</div>\n<div>\n<p>I’d highly recommend you subscribe to new releases through GitHub’s UI, that way you can be notified automatically and update to newer versions when it suits you.</p>\n</div>\n</blockquote>\n</div>\n<div>\n<div>\n<pre><code>Plug <span>'Olical/conjure'</span><span>,</span> <span>{</span> <span>'tag'</span><span>:</span> <span>'v2.0.0'</span><span>,</span> <span>'do'</span><span>:</span> <span>'bin/compile'</span> <span>}</span></code></pre>\n</div>\n</div>\n<div>\n<p>We’ve essentially asked vim-plug to install <code>v2.0.0</code> and then execute <code>bin/compile</code> whenever changes occur (it won’t re-compile if the code hasn’t changed, don’t worry).</p>\n</div>\n<div>\n<p>If you haven’t already, be sure to execute <code>:PlugInstall</code> within Neovim to ensure all of your plugins are installed and set up correctly.</p>\n</div>\n</div>\n</div>\n<div>\n<h2>Using Conjure to evaluate Clojure</h2>\n<div>\n<div>\n<p>Conjure is actually written in Clojure which means it starts a small Clojure instance when you open a Clojure file. The cool thing about this is that Conjure will automatically connect to this JVM when you haven’t configured any projects to connect to, this means we can already open any Clojure file and start evaluating things!</p>\n</div>\n<div>\n<p>Try it for yourself, open up a new Clojure file with <code>nvim foo.clj</code>, write some Clojure (such as <code>(+ 10 20)</code>) and evaluate it with <code>&lt;localleader>ee</code>. By default your <code>&lt;localleader></code> will be set to the <code>\\</code> key, I set mine to the <code>,</code> key but this is entirely up to you.</p>\n</div>\n<div>\n<p>If everything’s set up correctly you’ll hopefully see something like this.</p>\n</div>\n<div>\n<blockquote>\n<div>\n<p>Bear in mind I’ve added all of the optional plugins I mentioned previously to get things like autocompletion working.</p>\n</div>\n</blockquote>\n</div>\n<div>\n<p>My full <code>~/.config/nvim/init.vim</code> looks like this.</p>\n</div>\n<div>\n<div>\n<pre><code><span>&quot; Specify a directory for plugins.</span>\n<span>call</span> plug#begin<span>(</span>stdpath<span>(</span><span>'data'</span><span>)</span> <span>.</span> <span>'/plugged'</span><span>)</span>\n\n<span>&quot; Specify your required plugins here.</span>\nPlug <span>'liuchengxu/vim-better-default'</span>\n\n<span>&quot; Optional useful plugins I highly recommend.</span>\nPlug <span>'easymotion/vim-easymotion'</span>\nPlug <span>'guns/vim-sexp'</span>\nPlug <span>'tpope/vim-sexp-mappings-for-regular-people'</span>\nPlug <span>'Shougo/deoplete.nvim'</span>\nPlug <span>'ncm2/float-preview.nvim'</span>\nPlug <span>'jiangmiao/auto-pairs'</span><span>,</span> <span>{</span> <span>'tag'</span><span>:</span> <span>'v2.0.0'</span> <span>}</span>\nPlug <span>'w0rp/ale'</span>\n\n<span>&quot; I skipped vim-clap but feel free to add it!</span>\n\n<span>&quot; Conjure! :D</span>\nPlug <span>'Olical/conjure'</span><span>,</span> <span>{</span> <span>'tag'</span><span>:</span> <span>'v2.0.0'</span><span>,</span> <span>'do'</span><span>:</span> <span>'bin/compile'</span> <span>}</span>\n\n<span>&quot; Initialize plugin system.</span>\n<span>call</span> plug#<span>end</span><span>()</span>\n\n<span>&quot; Configuration for various plugins.</span>\n<span>let</span> <span>g:deoplete</span>#enable_at_startup <span>=</span> <span>1</span>\n<span>call</span> deoplete#custom#<span>option</span><span>(</span><span>'keyword_patterns'</span><span>,</span> <span>{</span><span>'clojure'</span><span>:</span> <span>'[\\w!$%&amp;*+/:&lt;=>?@\\^_~\\-\\.#]*'</span><span>})</span>\n<span>set</span> completeopt<span>-=</span>preview\n\n<span>let</span> <span>g:float_preview</span>#docked <span>=</span> <span>0</span>\n<span>let</span> <span>g:float_preview</span>#max_width <span>=</span> <span>80</span>\n<span>let</span> <span>g:float_preview</span>#max_height <span>=</span> <span>40</span>\n\n<span>let</span> <span>g:ale_linters</span> <span>=</span> <span>{</span>\n<span> \\</span> <span>'clojure'</span><span>:</span> <span>[</span><span>'clj-kondo'</span><span>,</span> <span>'joker'</span><span>]</span>\n<span> \\</span><span>}</span></code></pre>\n</div>\n</div>\n<div>\n<p>There’s not much to it but we’ve already got a fully Clojure integrated editor! Head over to the <a href=\"https://github.com/Olical/conjure\">Conjure</a> repo and <a href=\"https://github.com/Olical/conjure/wiki\">wiki</a> to find out more about configuration, mappings and features.</p>\n</div>\n</div>\n</div>\n<div>\n<h2>Connecting to a real project</h2>\n<div>\n<div>\n<p>This &quot;self prepl&quot; is very handy for trying things out quickly in any directory as well as following along with books and tutorials but at some point you’re probably going to want your own <code>deps.edn</code> (or <code>project.clj</code>) file in your own project.</p>\n</div>\n<div>\n<p>There’s already a lot of resources around the internet to help you set up your projects. <a href=\"https://oli.me.uk/clojure-projects-from-scratch/\">Clojure projects from scratch</a> will help you structure your repository and <code>deps.edn</code> file, for example. Some of the versions may be a little out of date but the content should still be completely valid.</p>\n</div>\n<div>\n<p>Once you have a project you’ll want to start your own socket prepl instead of relying on Conjure’s internal one. You can do that through some simple JVM args, a small amount of Clojure or with my own tool, <a href=\"https://github.com/Olical/propel\">Propel</a>. You can read about starting prepls without Propel in the <a href=\"https://oli.me.uk/clojure-socket-prepl-cookbook/\">Clojure socket prepl cookbook</a> or with Propel in <a href=\"https://oli.me.uk/repling-into-projects-with-prepl-and-propel/\">REPLing into projects with prepl and Propel</a>.</p>\n</div>\n<div>\n<p>Once your socket prepl is up and running you can configure Conjure to connect to it automatically by writing your own <code>.conjure.edn</code> file.</p>\n</div>\n<div>\n<div>\n<pre><code><span>;; This will connect to a prepl on port 5656 when you open a Clojure file.</span><span>\n</span><span>;; It'll also connect to a ClojureScript prepl on 8899 when you open a ClojureScript file!</span><span>\n</span><span>{</span><span>:conns</span><span> </span><span>{</span><span>:dev</span><span> </span><span>{</span><span>:port</span><span> </span><span>5656</span><span>}</span><span>\n</span><span>:ui</span><span> </span><span>{</span><span>:port</span><span> </span><span>8899</span><span>,</span><span> </span><span>:lang</span><span> </span><span>:cljs</span><span>}}}</span></code></pre>\n</div>\n</div>\n<div>\n<p>You can also configure Conjure to connect to the port specified in <code>.prepl-port</code> (when it exists) automatically. Propel will write this file for you when you provide the <code>-w</code> argument. I specify this in my global <code>~/.config/conjure/conjure.edn</code> file so Conjure will connect to any project that spits out a <code>.prepl-port</code> file automatically.</p>\n</div>\n<div>\n<div>\n<pre><code><span>{</span><span>:conns</span><span> </span><span>{</span><span>:local</span><span> </span><span>{</span><span>:port</span><span> </span><span>#</span><span>slurp-edn</span><span> </span><span>&quot;.prepl-port&quot;</span><span>}}}</span></code></pre>\n</div>\n</div>\n<div>\n<p>I hope this post as well as the others I’ve linked to are enough to get you started and hooked on Conjure. Please do get in touch with any questions, thoughts or feelings on the project. You can find me on twitter (link in the footer) as well as <code>#conjure</code> in the <a href=\"http://clojurians.net/\">Clojurians Slack</a>.</p>\n</div>\n</div>\n</div>",
   :direction "ltr"},
  :updated 1572998400000,
  :entities
  [{:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "about",
    :label "Clojure"}
   {:mentions [{:text "Python"}],
    :id "nlp/f/entity/wd:28865",
    :salienceLevel "mention",
    :label "Python"}
   {:mentions [{:text "ALE"}],
    :id "nlp/f/entity/wd:4735469",
    :salienceLevel "mention",
    :label "Alpine-Casparis Municipal Airport"}
   {:mentions [{:text "Arch Linux"}],
    :id "nlp/f/entity/wd:185576",
    :salienceLevel "mention",
    :label "Arch Linux"}
   {:mentions [{:text "learning curve"}],
    :id "nlp/f/entity/wd:1368723",
    :salienceLevel "mention",
    :label "learning curve"}],
  :alternate
  [{:href
    "https://oli.me.uk/getting-started-with-clojure-neovim-and-conjure-in-minutes",
    :type "text/html"}],
  :title "Getting started with Clojure, Neovim and Conjure in minutes",
  :author "\"(ollie {:on :parens})\"",
  :published-str "Tue Nov 05 16:00:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16e411137ca:12386d38:ad5391a1",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://oli.me.uk/getting-started-with-clojure-neovim-and-conjure-in-minutes",
  :updateCount 1,
  :commonTopics
  [{:score 88.75313074770816,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1572998400000,
  :fingerprint "ebaf4fb2",
  :canonicalUrl
  "https://oli.me.uk/getting-started-with-clojure-neovim-and-conjure-in-minutes"}
 {:engagement 18,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1572976552418,
  :content
  {:content
   "<p>One of my favorite aspects of working in different languages on various client projects is seeing how concepts learned in one paradigm bleed into others.\nMy latest professional work is written in Python, but I find myself using many strategies that I've picked up from working in other languages.\nThis post surveys some of the influences my past experience has had on the way I write Python today.\nI should note that the other languages mentioned here are definitely not the <em>original sources</em> of these concepts; rather, they're simply where I personally first or most often encountered them.</p>\n<h3>Static Types (TypeScript, Scala)</h3>\n<p>I first used static typing during my apprenticeship on our classic Java HTTP server project, but I didn't really appreciate the full value of types until I used them on production client code.\nWrapping my mind around React for the first time was challenging, but I remember thinking it would've been exponentially more difficult were I not using TypeScript.\nThe compiler was invaluable, reminding me time and again what values were and weren't available in my components' props and states.</p>\n<p>Later, a different client was all-in on Scala, and the benefits became even more obvious as we pushed more and more rules into the type system.\nCompile-time checks eliminated an entire category of unit tests, allowing us to focus the tests we <em>did</em> still need to write (types and tests aren't mutually exclusive!) on actual business logic.\nLarge refactorings were performed with confidence, at times seemingly driven by the compiler error messages (this phenomenon is especially common, and delightful, in Elm).</p>\n<p>Python, of course, is a dynamic language, but it has a &quot;gradual typing&quot; library called <a href=\"https://mypy.readthedocs.io/en/latest/\">MyPy</a>.\nGradual typing basically means you can add type annotations to parts of your codebase and type check those areas, without necessarily covering the entire codebase.\nUnlike true static languages, Python does not have a compilation step; rather, the developer runs a <code>mypy</code> Python task against the codebase, and it reports typechecking results.\nConfiguring this to run immediately before your unit test suite simulates the &quot;compile and run&quot; process of other languages.</p>\n<p>Leveraging MyPy doesn't require sacrificing the benefits of dynamic typing even in the areas where you do provide type annotations.\nAt the simplest level, MyPy includes an <code>Any</code> type that you can use as an escape hatch in a pinch.\nA more sophisticated technique is to use a <code>Protocol</code>, which in some respects can be thought of as &quot;formalized duck typing.&quot;\nA tic-tac-toe game, for example, might have a function that takes one of any number of different kinds of &quot;players,&quot; each of which can choose a spot to play on the board.\nWe can represent this with a protocol (the ellipses are exactly what you'd write in production for the protocol, but the <code>pass</code> calls would actually be returning some <code>Spot</code> object):</p>\n<div><pre><code><span></span><span>class</span> <span>Player</span><span>(</span><span>Protocol</span><span>):</span>\n    <span>def</span> <span>pick_spot</span><span>(</span><span>self</span><span>,</span> <span>board</span><span>:</span> <span>Board</span><span>)</span> <span>-></span> <span>Spot</span><span>:</span>\n        <span>...</span>\n\n\n<span>class</span> <span>HumanPlayer</span><span>:</span>\n    <span>def</span> <span>pick_spot</span><span>(</span><span>self</span><span>,</span> <span>board</span><span>:</span> <span>Board</span><span>)</span> <span>-></span> <span>Spot</span><span>:</span>\n        <span># implementation elided, maybe reads stdin from the terminal</span>\n        <span>pass</span>\n\n\n<span>class</span> <span>SimpleAIPlayer</span><span>:</span>\n    <span>def</span> <span>pick_spot</span><span>(</span><span>self</span><span>,</span> <span>board</span><span>:</span> <span>Board</span><span>)</span> <span>-></span> <span>Spot</span><span>:</span>\n        <span># implementation elided, maybe just chooses a random open spot on the board</span>\n        <span>pass</span>\n</code></pre></div>\n<p>Note that I don't need to explicitly state that <code>HumanPlayer</code> and <code>SimpleAIPlayer</code> implement the <code>Player</code> protocol.\nJust having the <code>pick_spot</code> method defined is enough for MyPy to understand that instances of these classes can be passed to something expecting the <code>Player</code> protocol.\nI still get the essence of duck typing, but with an extra set of eyes checking for mistakes before runtime.\nI'd much rather MyPy tell me I accidentally named a new player's method <code>choose_spot</code> instead of <code>pick_spot</code>, or required a different argument instead of a <code>Board</code>, before a user experiences an error.</p>\n<p>Finally, because MyPy is a separate process and Python does not have a compilation step, you can always run your Python code even while MyPy is reporting type errors.\nThis can be really useful if your types are complicated and you're pretty sure everything should work as-is, but can't figure out why the compiler is complaining;\nrather than being forced to resolve the type issues first, you can start up the application and explore what happens in different live scenarios.\nPerhaps seeing an actual runtime error will help you identify what needs to change.\nThese situations in general can be fascinating: the compiler asserts some guarantee is not being met, but the developer &quot;knows&quot; the code should work given their knowledge of the domain.\nOften times the resolution to these disagreements is a combination of adding more nuance to the type annotations (perhaps something is <code>Optional</code>, or needs to be made generic?) and rethinking how data flows through the system.</p>\n<h3>Data Objects (Clojure, Scala)</h3>\n<p>The first new language I learned at 8th Light was Clojure.\nComing from Ruby, I initially found it very disorienting.\nWhat do you mean I can't define a class or object?\n<em>Everything</em> is supposed to be an object!</p>\n<p>Before long, however, something clicked.\nClojure was forcing me to separate <strong>data</strong> (e.g. lists, dictionaries, integers, etc.) from <strong>behavior</strong> (i.e. functions).\nIn Clojure this separation is particularly extreme, but I started seeing it in other places, too (and—swoon—with types!).\nScala's &quot;case classes&quot; and Rust's &quot;structs&quot; are two excellent tools for modeling immutable data.\nIn both of these cases, as with the Python equivalent below, methods can still be defined on the objects themselves, but their essence lies in defining the structure of data.</p>\n<p>Python 3.7 introduced the <code>dataclasses</code> module.\nAt first glance, this just looks like syntax sugar for Plain Old Python Objects:</p>\n<div><pre><code><span></span><span>from</span> <span>dataclasses</span> <span>import</span> <span>dataclass</span>\n\n<span>@dataclass</span>\n<span>class</span> <span>Car</span><span>:</span>\n    <span>make</span><span>:</span> <span>str</span>\n    <span>model</span><span>:</span> <span>str</span>\n\n\n<span>class</span> <span>Auto</span><span>():</span>\n    <span>def</span> <span>__init__</span><span>(</span><span>self</span><span>,</span> <span>make</span><span>:</span> <span>str</span><span>,</span> <span>model</span><span>:</span> <span>str</span><span>):</span>\n        <span>self</span><span>.</span><span>make</span> <span>=</span> <span>make</span>\n        <span>self</span><span>.</span><span>model</span> <span>=</span> <span>model</span>\n</code></pre></div>\n<p>However, dataclasses provide quite a bit more convenience.\nPerhaps the greatest example is equality; 99% of the time, when I'm comparing data, I want to know if the <em>values</em> are identical, not whether two variables are pointing to the same instance in memory:</p>\n<div><pre><code><span></span><span>>>></span> <span>car</span> <span>=</span> <span>Car</span><span>(</span><span>&quot;honda&quot;</span><span>,</span> <span>&quot;civic&quot;</span><span>)</span>\n<span>>>></span> <span>car</span> <span>==</span> <span>Car</span><span>(</span><span>&quot;honda&quot;</span><span>,</span> <span>&quot;civic&quot;</span><span>)</span>\n<span>True</span>\n\n<span>>>></span> <span>auto</span> <span>=</span> <span>Auto</span><span>(</span><span>&quot;honda&quot;</span><span>,</span> <span>&quot;civic&quot;</span><span>)</span>\n<span>>>></span> <span>auto</span> <span>==</span> <span>Auto</span><span>(</span><span>&quot;honda&quot;</span><span>,</span> <span>&quot;civic&quot;</span><span>)</span>\n<span>False</span>\n</code></pre></div>\n<p>Also, it's common to need a copy of an existing data class instance with just a few modifications.\nThe <code>replace</code> function provides something akin to &quot;immutable updates&quot; like Scala's <code>copy</code> on case classes or Elm's update on records:</p>\n<div><pre><code><span></span><span>>>></span> <span>civic</span> <span>=</span> <span>Car</span><span>(</span><span>&quot;honda&quot;</span><span>,</span> <span>&quot;civic&quot;</span><span>)</span>\n<span>>>></span> <span>accord</span> <span>=</span> <span>dataclasses</span><span>.</span><span>replace</span><span>(</span><span>civic</span><span>,</span> <span>model</span><span>=</span><span>&quot;accord&quot;</span><span>)</span>\n<span>>>></span> <span>print</span><span>(</span><span>civic</span><span>)</span>\n<span>Car</span><span>(</span><span>make</span><span>=</span><span>'honda'</span><span>,</span> <span>model</span><span>=</span><span>'civic'</span><span>)</span>\n<span>>>></span> <span>print</span><span>(</span><span>accord</span><span>)</span>\n<span>Car</span><span>(</span><span>make</span><span>=</span><span>'honda'</span><span>,</span> <span>model</span><span>=</span><span>'accord'</span><span>)</span>\n</code></pre></div>\n<p>Python has long had first-class support for functions (by which I mean a function can stand alone and does not need to be defined within some arbitrary class).\nDataclasses now allow you to write Python in an even more functional and less object-oriented style.</p>\n<h3>Injecting the Environment as a Dependency (Clojure)</h3>\n<p>My latest project leans heavily on AWS's &quot;serverless&quot; offerings, including Lambda and Fargate.\nThese tools use environment variables as the primary way to set runtime configuration for their tasks.\nIn most contexts, setting these values is straightfoward:\nan <code>.env</code> file can be read when running locally;\nTerraform configuration is pretty clear;\nthe AWS web console lets you type them in like a form before launching; etc.</p>\n<p>Unfortunately, <em>unit testing</em> code that depends on environment variables can be a tremendous pain.\nResetting them between tests is easy to mess up, and local <code>.env</code> files used for running the code locally can interfere with the test environment config.</p>\n<p>While combatting this issue, I remembered a Clojure library called <a href=\"https://8thlight.com/blog/feed/component\">Component</a>.\nThis library's primary concern is the lifecycle management of stateful dependencies—one classic example is a database to which various functions in your codebase share a connection.\nOn one of my first client projects, we refactored our Clojure application away from a globally available database connection reference to explicitly pass that connection object to any function querying that database.\nThis had two neat benefits:\nfirst, it became clear just by reading function signatures which parts of the code were doing something database-related and which were not (since the database could no longer &quot;magically appear&quot; at some very low level).\nSecond, it became easier to test, as a mock database could just as easily be passed to any function requiring it.</p>\n<p>I realized that a similar technique could be used in my serverless Python code.\nRather than importing <code>os</code> at some low level of the code to call <code>os.environ.get(&quot;MY_VAR&quot;)</code>, I can import <code>os</code> at the very top-most level and pass the entire environment in and down to wherever it is needed.</p>\n<div><pre><code><span></span><span>import</span> <span>os</span>\n<span>from</span> <span>typing</span> <span>import</span> <span>Dict</span>\n\n<span>def</span> <span>main</span><span>(</span><span>environment</span><span>:</span> <span>Dict</span><span>[</span><span>str</span><span>,</span> <span>str</span><span>]):</span>\n    <span>_uses_env_var</span><span>(</span><span>environment</span><span>)</span>\n    <span>_does_not_use_env_var</span><span>()</span>\n\n\n<span>def</span> <span>_uses_env_var</span><span>(</span><span>environment</span><span>:</span> <span>Dict</span><span>[</span><span>str</span><span>,</span> <span>str</span><span>]):</span>\n    <span>foo</span> <span>=</span> <span>environment</span><span>.</span><span>get</span><span>(</span><span>&quot;FOO&quot;</span><span>)</span>\n    <span>print</span><span>(</span><span>f</span><span>&quot;FOO was set to {foo}&quot;</span><span>)</span>\n\n\n<span>def</span> <span>_does_not_use_env_var</span><span>():</span>\n    <span>print</span><span>(</span><span>&quot;Hello world!&quot;</span><span>)</span>\n\n\n<span>if</span> <span>__name__</span> <span>==</span> <span>&quot;__main__&quot;</span><span>:</span>\n    <span>main</span><span>(</span><span>os</span><span>.</span><span>environ</span><span>)</span>\n</code></pre></div>\n<p>Notice the MyPy annotation for the environment: <code>Dict[str, str]</code>.\nThis technique makes it much easier to test code that depends on environment variables in production, because from the perspective of those functions, they aren't using <em>environment</em> variables anymore at all—they're just using a regular dictionary!</p>\n<h3>Hide Concrete Constructors and only Expose Protocols (Elm)</h3>\n<p>Rob Looby wrote a great <a href=\"https://8thlight.com/blog/rob-looby/2017/08/08/elm-and-the-ocp.html\">post</a> about Elm and the Open-Closed Principle.\nIn it, he describes how the specific variants of a union type can be kept private to clients of that type, allowing new variants to be added without affecting all the functions throughout the codebase consuming that union type.</p>\n<p>There are some caveats to attempting something like Rob's approach in Python, none greater than the fact that Python has no concept of &quot;public&quot; vs. &quot;private.&quot;\nHowever, Python code often uses an underscore prefix to signal &quot;this is intended to be private&quot; to the reader.\nI use that convention in the snippet below.</p>\n<p>Recently I needed to support reading data from various files, but those files could be located either on my local machine or in an S3 bucket.\nI created a <code>DataSource</code> protocol to define the functionality I needed, namely returning each line from the file, and the file's path (meaning its location or address):</p>\n<div><pre><code><span></span><span>class</span> <span>DataSource</span><span>(</span><span>Protocol</span><span>):</span>\n    <span>def</span> <span>as_lines</span><span>(</span><span>self</span><span>)</span> <span>-></span> <span>Iterable</span><span>[</span><span>str</span><span>]:</span>\n        <span>...</span>\n\n    <span>def</span> <span>path</span><span>(</span><span>self</span><span>)</span> <span>-></span> <span>str</span><span>:</span>\n        <span>...</span>\n</code></pre></div>\n<p>Next, I defined my implementations.\nNote the underscore prefixes in the class names.\nMy goal here is that nothing outside this module should know about or be able to distinguish between these two types.\nEverything external should only need to know that it has &quot;some&quot; <code>DataSource</code>.</p>\n<div><pre><code><span></span><span>class</span> <span>_LocalSource</span><span>:</span>\n    <span>def</span> <span>__init__</span><span>(</span><span>self</span><span>,</span> <span>filepath</span><span>):</span>\n        <span>self</span><span>.</span><span>filepath</span> <span>=</span> <span>filepath</span>\n\n    <span>def</span> <span>as_lines</span><span>(</span><span>self</span><span>):</span>\n        <span>return</span> <span>[</span><span>line</span><span>.</span><span>rstrip</span><span>(</span><span>b</span><span>&quot;</span><span>\\n</span><span>&quot;</span><span>)</span> <span>for</span> <span>line</span> <span>in</span> <span>open</span><span>(</span><span>self</span><span>.</span><span>path</span><span>,</span> <span>&quot;rb&quot;</span><span>)]</span>\n\n    <span>def</span> <span>path</span><span>(</span><span>self</span><span>):</span>\n        <span>return</span> <span>self</span><span>.</span><span>filepath</span>\n\n\n<span>class</span> <span>_S3Source</span><span>:</span>\n    <span>def</span> <span>__init__</span><span>(</span><span>self</span><span>,</span> <span>bucket</span><span>,</span> <span>key</span><span>,</span> <span>s3_client</span><span>):</span>\n        <span>self</span><span>.</span><span>bucket</span> <span>=</span> <span>bucket</span>\n        <span>self</span><span>.</span><span>key</span> <span>=</span> <span>key</span>\n        <span>self</span><span>.</span><span>s3_client</span> <span>=</span> <span>s3_client</span>\n\n    <span>def</span> <span>as_lines</span><span>(</span><span>self</span><span>):</span>\n        <span>body</span> <span>=</span> <span>self</span><span>.</span><span>s3_client</span><span>.</span><span>get_object</span><span>(</span><span>Bucket</span><span>=</span><span>self</span><span>.</span><span>bucket</span><span>,</span> <span>Key</span><span>=</span><span>self</span><span>.</span><span>key</span><span>)[</span><span>&quot;Body&quot;</span><span>]</span>\n        <span>return</span> <span>body</span><span>.</span><span>iter_lines</span><span>()</span>\n\n    <span>def</span> <span>path</span><span>(</span><span>self</span><span>):</span>\n        <span>return</span> <span>f</span><span>&quot;s3://{self.bucket}/{self.key}&quot;</span>\n</code></pre></div>\n<p>Lastly, since the concrete implementations' constructors are (intended to be) private, I need to define some way of getting a <code>DataSource</code>.\nAs described above, this will be configured with environment variables (some boilerplate error handling removed for clarity):</p>\n<div><pre><code><span></span><span>def</span> <span>get_data_source</span><span>(</span><span>environment</span><span>:</span> <span>Dict</span><span>[</span><span>str</span><span>,</span> <span>str</span><span>])</span> <span>-></span> <span>DataSource</span><span>:</span>\n    <span>location_type</span> <span>=</span> <span>environment</span><span>.</span><span>get</span><span>(</span><span>&quot;DATA_FILE_LOCATION_TYPE&quot;</span><span>)</span>\n\n    <span>if</span> <span>location_type</span> <span>==</span> <span>&quot;s3&quot;</span><span>:</span>\n        <span>source</span> <span>=</span> <span>_build_s3_source</span><span>(</span><span>environment</span><span>)</span>\n    <span>elif</span> <span>location_type</span> <span>==</span> <span>&quot;local&quot;</span><span>:</span>\n        <span>source</span> <span>=</span> <span>_build_local_source</span><span>(</span><span>environment</span><span>)</span>\n    <span>else</span><span>:</span>\n        <span>raise</span> <span>DataSourceConfigError</span><span>(</span><span>&quot;DATA_FILE_LOCATION_TYPE must be 's3' or 'local'&quot;</span><span>)</span>\n\n    <span>return</span> <span>source</span>\n\n<span>def</span> <span>_build_s3_source</span><span>(</span><span>environment</span><span>:</span> <span>Dict</span><span>[</span><span>str</span><span>,</span> <span>str</span><span>])</span> <span>-></span> <span>_S3Source</span><span>:</span>\n    <span>bucket</span> <span>=</span> <span>environment</span><span>.</span><span>get</span><span>(</span><span>&quot;DATA_FILE_S3_BUCKET&quot;</span><span>)</span>\n    <span>key</span> <span>=</span> <span>environment</span><span>.</span><span>get</span><span>(</span><span>&quot;DATA_FILE_S3_KEY&quot;</span><span>)</span>\n    <span>client</span> <span>=</span> <span>aws</span><span>.</span><span>build_s3_client</span><span>(</span><span>environment</span><span>)</span>\n\n    <span>return</span> <span>S3Source</span><span>(</span><span>bucket</span><span>,</span> <span>key</span><span>,</span> <span>client</span><span>)</span>\n\n\n<span>def</span> <span>_build_local_source</span><span>(</span><span>environment</span><span>:</span> <span>Dict</span><span>[</span><span>str</span><span>,</span> <span>str</span><span>])</span> <span>-></span> <span>_LocalSource</span><span>:</span>\n    <span>filepath</span> <span>=</span> <span>environment</span><span>.</span><span>get</span><span>(</span><span>&quot;DATA_FILE_LOCAL_PATH&quot;</span><span>)</span>\n    <span>return</span> <span>LocalSource</span><span>(</span><span>filepath</span><span>)</span>\n</code></pre></div>\n<p>The end result is a single public function, <code>get_data_source</code>, that takes in environment configuration and returns some implementation of the <code>DataSource</code> protocol.\nEvery other part of the application can call this function and know that whatever it receives will have <code>as_lines</code> and <code>path</code> defined.\nIf later on we need to get data from some third location type—be it a database, Azure Blob storage, whatever—we only need to change this one file to parse the relevent configuration from the environment, and <em>nothing else</em> needs to change.</p>\n<h3>Polyglot Pragmatism</h3>\n<p>Python made the most sense for this client project given the team's skill set, some existing applications, and the problem domain.\nHowever, coming into the engagement, I personally hadn't written a single line of Python.\nI took time to learn some of Python's conventions and style, and asked many questions of my teammate with extensive Python experience.\nHowever, my experience with many other languages in similar problem domains meant I wasn't going in to this project completely empty-handed;\nto the contrary, I have an arsenal of techniques that can be applied in a variety of contexts.</p>\n<p>Of course, there is a fine line to this stuff.\nI still remember a conversation with one of my teams from several years ago.\nWe were working in a legacy Rails app and debating a few implementation options to some problem.\nOne teammate, a burgeoning ML enthusiast (now expert), suggested creating a <code>Result</code> class with <code>Error</code> and <code>Success</code> &quot;variants&quot; that we could use for error handling.\nAnother, well versed in JavaScript, demonstrated how we could define callbacks for success and failure cases, passing them in from a controller.\nAfter some discussion, we ultimately landed on... a <code>succeeded?</code> method and an <code>if/else</code> statement.</p>\n<p>Conventions, existing patterns, team experience levels, and business priorities all factor into how the code gets written.\nThe goal is not to turn dynamic languages into statically typed ones, nor needlessly reinvent wheels.\nOn the other hand, there might be a technique that isn't common in your current language but could work really well in your current context.\nAt the end of the day, pragmatism should always win out.\nDeveloping enough experience to recognize what is and isn't pragmatic takes time, but that timeline can be shortened by exposing yourself to a wide variety of languages, paradigms, and problems, and paying attention to what works well and why.</p>",
   :direction "ltr"},
  :updated 1572933600000,
  :entities
  [{:mentions [{:text "Python"}],
    :id "nlp/f/entity/wd:28865",
    :salienceLevel "about",
    :label "Python"}
   {:mentions [{:text "Elm"}],
    :id "nlp/f/entity/wd:131113",
    :salienceLevel "mention",
    :label "Ulmus"}
   {:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "Player"}],
    :id "nlp/f/entity/wd:1551573",
    :salienceLevel "mention",
    :label "The Player"}
   {:mentions [{:text "duck typing"}],
    :id "nlp/f/entity/wd:374282",
    :salienceLevel "mention",
    :label "duck typing"}],
  :alternate
  [{:href
    "https://8thlight.com/blog/mike-knepper/2019/11/05/polyglot-influence-in-python.html",
    :type "text/html"}],
  :title "Polyglot Influences in Python",
  :author "Mike Knepper",
  :published-str "Mon Nov 04 22:00:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16e3cb569e2:1286517e:69b9f616",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url
   "https://8thlight.com/blog/assets/posts/2019-11-05-polyglot-influence-in-python/python-tools-b3b40597b6af404464d20c5e49e8692ad38a37335dd44c84a16c6854c4ae91ee.png",
   :width 2400,
   :height 1256,
   :contentType "image/png"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://8thlight.com/blog/mike-knepper/2019/11/05/polyglot-influence-in-python.html",
  :commonTopics
  [{:score 146.67530339679575,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 15.921565633528198,
    :id "nlp/f/topic/3049",
    :salienceLevel "about",
    :label "automotive"}
   {:score 0.921,
    :id "nlp/f/topic/1381",
    :salienceLevel "about",
    :label "machine learning"}],
  :published 1572933600000,
  :fingerprint "d4cbd829",
  :canonicalUrl
  "https://8thlight.com/blog/mike-knepper/2019/11/05/polyglot-influence-in-python.html"}
 {:engagement 5,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1572961816500,
  :content
  {:content
   "<p>Just a note that I'll be appearing at <a href=\"https://www.codemesh.io/conferences/code-mesh-ldn/\">Codemesh</a> on Thursday (11:25) to give a talk where I go over some of the stuff we've been working on at <a href=\"https://www.id3as.com/home\">Work</a>(tm) this year - with a focus on some of the implementation details and nitty gritty/etc.</p>\n<p>I silently blogged some of this recently, basically showing off how we've now got the ability to write OTP applications in Purescript these days, and indeed are. The posts are all linked below for the majority of folk who are sensible enough not to not subscribe to this sorry excuse for a blog.</p>\n<p>Here is a sneaky peek as to what a gen server looks like in this world, tasty no?</p>\n<pre><code>\n<span>findByIsbn</span> :: <span>String</span> -> <span>Effect</span> (<span>Maybe</span> <span>Book</span>)\n<span>findByIsbn</span> isbn = \n  <span>Gen</span>.doCall serverName \\state@{ connection } -> <span>do</span>\n    result &lt;- <span>Redis</span>.get (dbId isbn) connection\n    pure $ <span>CallReply</span> result state\n\n<span>findAll</span> :: <span>Effect</span> (<span>List</span> <span>Book</span>)\n<span>findAll</span> = \n  <span>Gen</span>.doCall serverName \\state@{ connection } -> <span>do</span>\n    books &lt;- <span>Redis</span>.findAll dbPrefix connection\n    pure $ <span>CallReply</span> books state\n\n<span>-- Nothing special about this, just a function that returns a certain type</span>\n<span>-- We can supply arbitrary arguments to this via the gensup</span>\n<span>startLink</span> :: <span>BookLibraryStartArgs</span> -> <span>Effect</span> <span>StartLinkResult</span>\n<span>startLink</span> args =\n  <span>Gen</span>.startLink serverName $ init args\n\n<span>-- And those arguments can then end up in here, which just needs to return an effect of our State type</span>\n<span>init</span> :: <span>BookLibraryStartArgs</span> -> <span>Effect</span> <span>State</span>\n<span>init</span> args = <span>do</span>\n  connection &lt;- <span>Redis</span>.open args.connectionString\n  pure $ { connection }\n</code></pre>\n<h1>The blog entries</h1>\n<ul>\n<li><a href=\"http://codeofrob.com/entries/introducing-pinto-and-stetson---opinionated-purescript-bindings-to-otp-and-cowboy.html\">Introduction to Pinto/Stetson - Opinionated Bindings to OTP/Cowboy</a></li>\n<li><a href=\"http://codeofrob.com/entries/the-structure-of-an-end-to-end-purescript-otp-project.html\">The structure of an end-to-end purescript OTP project</a></li>\n<li><a href=\"http://codeofrob.com/entries/building-on-top-of-otp-with-purescript-with-pinto.html\">Building on top of OTP with Purescript with Pinto</a></li>\n<li><a href=\"http://codeofrob.com/entries/building-a-purescript-web-server-with-stetson-and-pinto.html\">Building a Purescript web server with Stetson and Pinto</a></li>\n<li><a href=\"http://codeofrob.com/entries/shared-code-twixt-purescript-server-and-client.html\">Shared code twixt Purescript server and client</a></li>\n<li><a href=\"http://codeofrob.com/entries/purescript-interop-with-native-erlang---interacting-with-redis.html\">Purescript interop with native Erlang, interaction with Redis</a></li>\n</ul>\n<h1>Useful links</h1>\n<ul>\n<li><a href=\"https://github.com/id3as/demo-ps\">demo-ps</a> The demo codebase we're talking about here</li>\n<li><a href=\"https://github.com/id3as/purescript-erl-pinto\">erl-pinto</a> (the opinionated bindings to OTP we're using)</li>\n<li><a href=\"https://github.com/id3as/purescript-erl-stetson\">erl-stetson</a> (the opinionated bindings to Cowboy we're using)</li>\n</ul>",
   :direction "ltr"},
  :updated 1572946200000,
  :entities
  [{:mentions [{:text "args"}],
    :id "nlp/f/entity/wd:2005914",
    :salienceLevel "about",
    :label "entry point"}
   {:mentions [{:text "web server"}],
    :id "nlp/f/entity/wd:11288",
    :salienceLevel "mention",
    :label "web server"}
   {:mentions [{:text "Erlang"}],
    :id "nlp/f/entity/wd:334879",
    :salienceLevel "mention",
    :label "Erlang"}
   {:mentions [{:text "Redis"}],
    :id "nlp/f/entity/wd:2136322",
    :salienceLevel "mention",
    :label "Redis"}],
  :alternate
  [{:href
    "http://codeofrob.com/entries/codemesh-2019---purerl-and-otp-talk.html",
    :type "text/html"}],
  :title "Codemesh 2019 - Purerl and OTP talk",
  :author "Rob Ashton",
  :published-str "Tue Nov 05 01:30:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16e3bd48fb4:12507538:97b0c8f7",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "http://codeofrob.com/entries/codemesh-2019---purerl-and-otp-talk.html",
  :commonTopics
  [{:score 29.623347816011396,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1572946200000,
  :fingerprint "1d23d4a9",
  :canonicalUrl
  "http://codeofrob.com/entries/codemesh-2019---purerl-and-otp-talk.html"}
 {:engagement 5,
  :unread false,
  :crawled 1572952866232,
  :recrawled 1572978723713,
  :content
  {:content
   "<p>At Pisano, we build a sophisticated customer experience solution for organizations. Since our motto is <strong>speed and reliability</strong>, we choose robust, scalable and productive tools to build the platform, so this is where Clojure comes into play.</p><p>Clojure is a functional programming language (a Lisp dialect), that runs on <strong>JVM</strong> (<em>Java Virtual Machine</em>), <strong>CLR</strong> (<em>Common Language Runtime</em>) and <strong>JavaScript</strong> (ClojureScript) platforms.</p><figure><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/1024/1*CrvrNQqlok4doG7mKh6Kig.jpeg\"></figure><h3>Choosing Clojure</h3><p>Before I joined the team, there were only 2 team members with professional Clojure experience. After a radical and bold decision, we started to rewrite the dashboard in ClojureScript; therefore, teaching and guiding the team with a new language and platform.</p><figure><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/1024/1*7fA_e-91yG3XlBbCNQ6ABQ.jpeg\"></figure><h3>Building a Team</h3><p>In the beginning, we had some concerns because the team had to learn a new <strong>paradigm</strong> and write <strong>production-ready</strong> code. Our junior developers learned the platform and language quicker than I expected. The more they wrote in Clojure, the more they loved the language. Of course, it did not seem idiomatic at first glance.</p><p>We were very aware that it was a medium/long term investment. We had witnessed that our team members were not willing to develop upon the old codebase. I assume, as all Clojure developers might, they were fascinated by the simplicity of the language.</p><p>It is difficult to find a user familiar with Clojure and there were approximately 10 or fewer people who developed the production code like us (in Turkey). If you plan to switch to this platform, your options are to train your team or hire an international Clojure developer.</p><h3>Feedbacks</h3><p>The reason why we decided to proceed with Clojure was not only because of its niche and visionary language but because of its time efficiency and productibility. Therefore, taking the executive decision to implement and enhance an enterprise product, Pisano.</p><ul><li>Our junior team members started to develop the code for production within <strong>almost 2 months</strong>.</li><li>The team is much <strong>happier, productive and efficient</strong>. Since they’ve embraced the functional paradigm, they’ve developed <strong>different ways of problem-solving</strong>.</li><li>We provide very fast output by responding to demands regarding bug fixes and features — (<strong>our biggest achievement</strong>).</li></ul><h3>Technical Acquirements</h3><ul><li>Recently, we have implemented our new dashboard and it exhibits much better performance compared to the old one.</li><li>We benefit from the Google Closure Compiler.</li><li>Deployment periods are shorter and easier.</li><li>Thanks to Lisp’s macros, our codebase decreased and is more meaningful on a bigger scale.</li><li>Since we serve our frontend code through JVM, we can utilize it more when compared to the old Node platform (hardware-wise).</li><li>We received lots of feedback, from our customers, regarding the performance improvement. One of our customers stated that “It runs like Usain Bolt” which made our day :).</li></ul><h3><strong>Benchmark</strong></h3><p>Comparing <strong>old</strong> codebase (first image) and new codebase (second image):</p><figure><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/598/1*-x_8Q7F6NBQS1Lhu3UU1_w.png\">Old codebase</figure><figure><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/594/1*s8KEoV2GiQ1i1701B5Q6Hg.png\">New codebase — <strong>ClojureScript</strong></figure><h3>What is the Next Step?</h3><p>At the moment we have 2 Clojure services: Dashboard (ClojureScript) and Event Analytics (Clojure). Our goal is to move all services to Clojure and only use one language for <strong>backend and frontend</strong> to increase optimization/productivity within our development cycle.</p><p>One of the advantages which Clojure enabled is establishing a more efficient and pleasant environment to work with; especially when developing an <strong>enterprise</strong> platform, the outputs are <strong>very clear</strong>. The following list displays several well-known organizations using Clojure…</p><ul><li>Walmart</li><li>Facebook</li><li>Apple</li><li>Boeing</li><li>Amazon</li><li>Netflix</li></ul><p>I want to thank Pisano team; <a href=\"https://medium.com/u/4e4b14b23a46\">Muhammet S. AYDIN</a>, <a href=\"https://medium.com/u/1855ce1e444f\">Sabire Avcı</a>, <a href=\"https://medium.com/u/38dd1f5cd4b0\">Burkay Durdu</a>, <a href=\"https://medium.com/u/c3505b239512\">Oguzhan Aydin</a>, <a href=\"https://medium.com/u/e64c0b7c87a4\">Ergenekon Yiğit</a> and <a href=\"https://medium.com/u/301058193e72\">Alican Çelik</a></p><p><strong>Note</strong>: To learn more about Clojure, you can read <a href=\"https://medium.com/@ertu.ctn/why-clojure-seriously-why-9f5e6f24dc29\">my other Medium post.</a></p><p>Ertuğrul Çetin, Software Development Team Lead @<a href=\"https://medium.com/u/ca7d43c2ed7f\">Pisano</a></p><p>Would you like to be a part of this journey? We are looking for software engineers to join us! You can drop an email to <strong>hello@pisano.co </strong>with your <strong>CV </strong>attached.</p><img width=\"1\" src=\"https://medium.com/_/stat?event=post.clientViewed&referrerSource=full_rss&postId=c50e27fd18fb\" height=\"1\"><hr><p><a href=\"https://medium.com/pisanoeng/why-is-pisano-happy-with-clojure-c50e27fd18fb\">Why is Pisano happy with Clojure?</a> was originally published in <a href=\"https://medium.com/pisanoeng\">pisanoeng</a> on Medium, where people are continuing the conversation by highlighting and responding to this story.</p>",
   :direction "ltr"},
  :updated 1572951079000,
  :entities
  [{:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "about",
    :label "Clojure"}
   {:mentions [{:text "Pisano"}],
    :id "nlp/f/entity/wd:22560",
    :salienceLevel "mention",
    :label "Pisano"}
   {:mentions [{:text "JVM"} {:text "Java Virtual Machine"}],
    :id "nlp/f/entity/wd:193321",
    :salienceLevel "mention",
    :label "Java Virtual Machine"}
   {:mentions [{:text "Common Language Runtime"} {:text "CLR"}],
    :id "nlp/f/entity/wd:733134",
    :salienceLevel "mention",
    :label "Common Language Runtime"}
   {:mentions [{:text "Lisp"}],
    :id "nlp/f/entity/wd:132874",
    :salienceLevel "mention",
    :label "Lisp"}],
  :alternate
  [{:href
    "https://medium.com/pisanoeng/why-is-pisano-happy-with-clojure-c50e27fd18fb?source=rss----40ed638f2704---4",
    :type "text/html"}],
  :title "Why is Pisano happy with Clojure?",
  :author "Ertuğrul Çetin",
  :published-str "Tue Nov 05 02:51:19 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16e3b4bfdb8:1243275c:97b0c8f7",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url
   "https://cdn-images-1.medium.com/max/1024/1*CrvrNQqlok4doG7mKh6Kig.jpeg",
   :width 1024,
   :height 620,
   :contentType "image/jpeg"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://medium.com/p/c50e27fd18fb",
  :updateCount 2,
  :commonTopics
  [{:score 88.97363457263442,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.779,
    :id "nlp/f/topic/774",
    :salienceLevel "mention",
    :label "engineering"}
   {:score 0.711,
    :id "nlp/f/topic/651",
    :salienceLevel "mention",
    :label "devops"}],
  :published 1572951079000,
  :fingerprint "6849f515",
  :canonicalUrl
  "https://medium.com/pisanoeng/why-is-pisano-happy-with-clojure-c50e27fd18fb?source=rss-4a9faeeccbe4------2"}
 {:engagement 5,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1572944888034,
  :recrawled 1572993416007,
  :content
  {:content
   "<div>\n<div>\n<div>\n<p>I’ve written pretty extensively about <a href=\"https://oli.me.uk/repling-into-projects-with-prepl-and-propel/\">how to start a prepl</a> as well as <a href=\"https://oli.me.uk/clojure-socket-prepl-cookbook/\">what prepls are</a>. I’ve also written a few tools such as <a href=\"https://github.com/Olical/conjure\">Conjure</a> and <a href=\"https://github.com/Olical/propel\">Propel</a> that wouldn’t exist without it.</p>\n</div>\n<div>\n<p>Since fantastic tools such as <a href=\"https://github.com/thheller/shadow-cljs\">shadow-cljs</a> are beginning to <a href=\"https://github.com/thheller/shadow-cljs/issues/508\">implement their own prepls</a> I thought it was about time I transcribed my understating of how the prepl should be implemented, as well as how you should interface with it.</p>\n</div>\n<div>\n<blockquote>\n<div>\n<p>I’ve actually found discrepancies between the Clojure and ClojureScript’s official prepl implementations, I’ve had some patches merged already and some will have fixes in future releases (Clojure(Script) <code>1.11</code> etc). I’ll be showing you what I see as the canonical implementation and contract that we should all strive for, even if there’s still a few small differences in Clojure core right now.</p>\n</div>\n</blockquote>\n</div>\n</div>\n</div>\n<div>\n<h2>High level essentials</h2>\n<div>\n<div>\n<p>The prepl is a essentially an agreement of how output from a socket will be wrapped in EDN data structures, the only input to a prepl is Clojure or ClojureScript code as a string over a socket. If you start a prepl, through any means, you should be able to <code>netcat</code> into it from your terminal and send code to it. It should respond in a predictable way with some EDN data structures.</p>\n</div>\n<div>\n<p>That data structure is simple enough that any language that can parse fairly basic EDN should be able to work with it. This means you could write a tool in Rust that simply sent off code for evaluation then parsed the resulting strings out with an EDN library.</p>\n</div>\n<div>\n<p>Sending <code>:repl/quit</code> or an &quot;end of file&quot; should kick you off of the socket prepl. All evaluations are blocking and will be evaluated and returned in order, if you want async evaluations you should implement it yourself by wrapping code for evaluation in a framework of futures, for example.</p>\n</div>\n<div>\n<p>Sending two forms in one go should result in at least two responses. Evaluating <code>(foo) (bar)</code>, for example, shouldn’t hide the result of <code>(foo)</code>, it should return the result of both top level forms one after the other. Evaluations are <em>not</em> wrapped in an implicit <code>(do …​)</code>.</p>\n</div>\n<div>\n<p>You <strong>need</strong> to allow the use of reader conditionals inside the evaluation (like <code>#?(:clj 10, :cljs 20)</code>), make sure you test this! Clojure <code>1.10</code> doesn’t currently allow them but you can work around it by wrapping the code to be evaluated in an evaluation call that does allow it (Conjure does this). I’ve fixed this and it should be released with <code>1.11</code>.</p>\n</div>\n</div>\n</div>\n<div>\n<h2>Messages</h2>\n<div>\n<div>\n<p>There are four kinds of messages denoted by the <code>:tag</code> of the response, it’s possible that prepl implementors may add their own but support for them will depend on the tool (shadow-cljs might let you know if the browser was disconnected, for example).</p>\n</div>\n<div>\n<blockquote>\n<div>\n<p>If you’re building something that connects to a prepl, think about what you could do with message types you don’t recognise. Maybe just show them somewhere?</p>\n</div>\n</blockquote>\n</div>\n<div>\n<ul>\n<li>\n<p><code>:ret</code> - returned result from an evaluation.</p>\n</li>\n<li>\n<p><code>:out</code> - from <code>*out*</code>.</p>\n</li>\n<li>\n<p><code>:err</code> - from <code>*err*</code>.</p>\n</li>\n<li>\n<p><code>:tap</code> - data sent through a call to <code>(tap> …​)</code>.</p>\n</li>\n</ul>\n</div>\n<div>\n<p>Let’s look at the messages in turn and I’ll highlight some key things to pay attention to.</p>\n</div>\n</div>\n</div>\n<div>\n<h2><code>:ret</code></h2>\n<div>\n<div>\n<div>\n<pre><code><span>(</span><span>+</span><span> </span><span>10</span><span> </span><span>20</span><span>)</span><span>\n</span><span>{</span><span>:tag</span><span> </span><span>:ret,</span><span> </span><span>:val</span><span> </span><span>&quot;30&quot;</span><span>,</span><span> </span><span>:ns</span><span> </span><span>&quot;user&quot;</span><span>,</span><span> </span><span>:ms</span><span> </span><span>3</span><span>,</span><span> </span><span>:form</span><span> </span><span>&quot;(+ 10 20)&quot;</span><span>}</span></code></pre>\n</div>\n</div>\n<div>\n<ul>\n<li>\n<p>The type of the message (<code>:ret</code>) is a keyword under <code>:tag</code>, as already mentioned.</p>\n</li>\n<li>\n<p>The result of the evaluation is a <strong>string</strong> stored under the <code>:val</code> key.</p>\n</li>\n<li>\n<p>The namespace that you ended up in <strong>after</strong> the evaluation is stored as a <strong>string</strong> under <code>:ns</code>.</p>\n</li>\n<li>\n<p>The time it took to perform the evaluation is stored as an integer under the <code>:ms</code> key.</p>\n</li>\n<li>\n<p>Finally, the form that was evaluated is stored as a <strong>string</strong> under <code>:form</code>.</p>\n</li>\n</ul>\n</div>\n<div>\n<p>Pay close attention to the fact that <code>:val</code> and <code>:ns</code> have both been turned into strings, do not be tempted to put the original data as nested EDN here, that is incorrect.</p>\n</div>\n<div>\n<p>When an exception occurs in an evaluation you will also get an <code>:exception true</code> inside the message body. The <code>:val</code> in that case will be the error after it’s been run through <code>Throwable→map</code> (or <code>Error→map</code> in the case of ClojureScript) then <code>pr-str</code>.</p>\n</div>\n<div>\n<div>\n<pre><code><span>(</span><span>throw</span><span> </span><span>(</span><span>Error.</span><span> </span><span>&quot;oh no&quot;</span><span>))</span><span>\n</span><span>{</span><span>:tag</span><span> </span><span>:ret,</span><span> </span><span>:val</span><span> </span><span>&quot;{:via [...ELIDED FOR READABILITY ...] :cause \\&quot;oh no\\&quot;, :phase :execution}&quot;</span><span>,</span><span> </span><span>:ns</span><span> </span><span>&quot;user&quot;</span><span>,</span><span> </span><span>:form</span><span> </span><span>&quot;(throw (Error. \\&quot;oh no\\&quot;))&quot;</span><span>,</span><span> </span><span>:exception</span><span> </span><span>true</span><span>}</span></code></pre>\n</div>\n</div>\n<div>\n<p>This is enough information to let a client know when something went wrong as well as what it was.</p>\n</div>\n<div>\n<blockquote>\n<div>\n<p>ClojureScript <code>1.10.520</code> doesn’t yet mark them with <code>:exception true</code>, I’ve fixed this but it hasn’t been released yet.</p>\n</div>\n</blockquote>\n</div>\n</div>\n</div>\n<div>\n<h2><code>:out</code></h2>\n<div>\n<div>\n<div>\n<pre><code><span>(</span><span>println</span><span> </span><span>&quot;Hello, World!&quot;</span><span>)</span><span>\n</span><span>{</span><span>:tag</span><span> </span><span>:out,</span><span> </span><span>:val</span><span> </span><span>&quot;Hello, World!\\n&quot;</span><span>}</span><span>\n</span><span>{</span><span>:tag</span><span> </span><span>:ret,</span><span> </span><span>:val</span><span> </span><span>&quot;nil&quot;</span><span>,</span><span> </span><span>:ns</span><span> </span><span>&quot;user&quot;</span><span>,</span><span> </span><span>:ms</span><span> </span><span>2</span><span>,</span><span> </span><span>:form</span><span> </span><span>&quot;(println \\&quot;Hello, World!\\&quot;)&quot;</span><span>}</span></code></pre>\n</div>\n</div>\n<div>\n<ul>\n<li>\n<p>All data written to <code>*out*</code> should appear under <code>:tag :out</code>.</p>\n</li>\n<li>\n<p>The actual data is stored as a string under <code>:val</code>, just like <code>:ret</code> messages.</p>\n</li>\n<li>\n<p>New lines are preserved if the user performed a <code>println</code>, for example. Don’t trim anything!</p>\n</li>\n<li>\n<p>You may want to flush on every prepl evaluation to ensure that things like <code>pr</code> or <code>print</code> appear under <code>:out</code> as they happen.</p>\n</li>\n<li>\n<p>Things like <code>println</code> will return <code>nil</code>, so you will see an <code>:out</code> message as well as a <code>:ret</code> when you evaluate this sort of thing.</p>\n</li>\n</ul>\n</div>\n</div>\n</div>\n<div>\n<h2><code>:err</code></h2>\n<div>\n<div>\n<p>See <code>:out</code>, it’s the same but for data sent to <code>*err*</code>, as you might expect.</p>\n</div>\n</div>\n</div>\n<div>\n<h2><code>:tap</code></h2>\n<div>\n<div>\n<div>\n<pre><code><span>(</span><span>tap></span><span> </span><span>:foo</span><span>)</span><span>\n</span><span>{</span><span>:tag</span><span> </span><span>:ret,</span><span> </span><span>:val</span><span> </span><span>&quot;true&quot;</span><span>,</span><span> </span><span>:ns</span><span> </span><span>&quot;user&quot;</span><span>,</span><span> </span><span>:ms</span><span> </span><span>2</span><span>,</span><span> </span><span>:form</span><span> </span><span>&quot;(tap> :foo)&quot;</span><span>}</span><span>\n</span><span>{</span><span>:tag</span><span> </span><span>:tap,</span><span> </span><span>:val</span><span> </span><span>&quot;:foo&quot;</span><span>}</span></code></pre>\n</div>\n</div>\n<div>\n<ul>\n<li>\n<p>When someone executes <code>tap></code> it returns true to let the user know it worked, more <code>tap</code> functions may exist in the future that avoid this <code>true</code>. If you want to use it you may want to use <code>(doto (my-thing) tap>)</code> to <code>tap</code> the result as well as return it.</p>\n</li>\n<li>\n<p><code>tap</code> messages have a <code>:tag</code> of <code>:tap</code>, which is thankfully unsurprising by this point.</p>\n</li>\n<li>\n<p>The <code>:val</code> contains the body of the <code>tap</code> as a string.</p>\n</li>\n<li>\n<p>If you’re implementing a prepl you’ll need to hook yourself into Clojure’s <code>tap</code> infrastructure although that’s beyond the scope of this post.</p>\n</li>\n</ul>\n</div>\n</div>\n</div>\n<div>\n<h2>Wrapping up</h2>\n<div>\n<div>\n<p>That’s actually all there is to it! Just make sure you’re returning strings, not data, in the right places.</p>\n</div>\n<div>\n<p>Pay special attention to how exceptions work and when you’re flushing to <code>*out*</code> or <code>*err*</code> to avoid surprising <code>print</code> behaviour for the client.</p>\n</div>\n<div>\n<p>Please do get in touch if you have questions or thoughts about how to build or use a prepl as a Clojure (or ClojureScript) tool author.</p>\n</div>\n</div>\n</div>",
   :direction "ltr"},
  :updated 1572825600000,
  :entities
  [{:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "about",
    :label "Clojure"}
   {:mentions [{:text "incorrect"} {:text "error"} {:text "wrong"}],
    :id "nlp/f/entity/wd:29485",
    :salienceLevel "about",
    :label "error"}
   {:mentions [{:text "data structure"}],
    :id "nlp/f/entity/wd:175263",
    :salienceLevel "mention",
    :label "data structure"}],
  :alternate
  [{:href "https://oli.me.uk/clojure-prepl-for-tool-authors",
    :type "text/html"}],
  :title "Clojure prepl for tool authors",
  :author "\"(ollie {:on :parens})\"",
  :published-str "Sun Nov 03 16:00:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16e3ad240e2:1237f166:97b0c8f7",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://oli.me.uk/clojure-prepl-for-tool-authors",
  :updateCount 1,
  :commonTopics
  [{:score 73.82192453071497,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1572825600000,
  :fingerprint "91058e54",
  :canonicalUrl "https://oli.me.uk/clojure-prepl-for-tool-authors"}
 {:engagement 8,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1572944888034,
  :recrawled 1573049677770,
  :content
  {:content
   "<p>I recently came across a blog post by John Jacobsen with the title:\n<a href=\"http://johnj.com/from-elegance-to-speed.html\"><em>From Elegance to Speed</em></a>. The author had a short function written in Clojure that he\nported to Common Lisp for an impressive performance improvement. Along the way, he made\nsome changes in the approach for his Common Lisp implementation but didn’t apply those ideas\nto his Clojure code. I thought it was worth a try to see what we could do with Clojure.</p>\n<p>First, any microbenchmarking experiment should be taken with a grain of salt. The goal of\nClojure is to be a powerful tool for writing large programs to solve complex problems. It’s\nnot necessarily optimized for snippets of simple arithmetic. For more information about\nClojure, please see the <a href=\"https://clojure.org/about/rationale\">Rationale</a>.</p>\n<p>With that disclaimer out of the way, let’s look at the original Clojure function, called <code>smt-8</code>.</p>\n<div><div><pre><code><span>\n</span><span>(</span><span>defn</span><span> </span><span>smt-8</span><span> </span><span>[</span><span>times</span><span>]</span><span>\n</span><span>(</span><span>->></span><span> </span><span>times</span><span>\n</span><span>(</span><span>partition</span><span> </span><span>8</span><span> </span><span>1</span><span>)</span><span>\n</span><span>(</span><span>map</span><span> </span><span>(</span><span>juxt</span><span> </span><span>identity</span><span>\n</span><span>(</span><span>comp</span><span> </span><span>(</span><span>partial</span><span> </span><span>apply</span><span> </span><span>-</span><span>)</span><span>\n</span><span>(</span><span>juxt</span><span> </span><span>last</span><span> </span><span>first</span><span>))))</span><span>\n</span><span>(</span><span>filter</span><span> </span><span>(</span><span>comp</span><span> </span><span>(</span><span>partial</span><span> </span><span>></span><span> </span><span>1000</span><span>)</span><span> </span><span>second</span><span>))))</span><span>\n</span></code></pre></div></div>\n<p>The input is a monotonically increasing sequence of long integers representing time data.\nThe function walks through the sequence looking for clusters (in a sliding window of size 8)\nthat are close in time (within a 1000 milliseconds). The result is a sequence of the\ndesired clusters and their widths. From domain knowledge, we expect that such clusters are\nrelatively rare in the input data set.</p>\n<p>I think the original <code>smt-8</code> is reasonable. It uses a few higher-order functions that might\nnot be recognized by non-Clojure programmers. Here’s a slightly modified Clojure\nimplementation that runs a bit faster for me.</p>\n<div><div><pre><code><span>;; modest improvement using `keep`, about 20% faster</span><span>\n</span><span>(</span><span>defn</span><span> </span><span>smt-8a</span><span> </span><span>[</span><span>times</span><span>]</span><span>\n</span><span>(</span><span>->></span><span> </span><span>times</span><span>\n</span><span>(</span><span>partition</span><span> </span><span>8</span><span> </span><span>1</span><span>)</span><span>\n</span><span>(</span><span>keep</span><span> </span><span>(</span><span>fn</span><span> </span><span>[</span><span>part</span><span>]</span><span>\n</span><span>(</span><span>let</span><span> </span><span>[</span><span>diff</span><span> </span><span>(</span><span>-</span><span> </span><span>(</span><span>last</span><span> </span><span>part</span><span>)</span><span> </span><span>(</span><span>first</span><span> </span><span>part</span><span>))]</span><span>\n</span><span>(</span><span>when</span><span> </span><span>(</span><span>></span><span> </span><span>1000</span><span> </span><span>diff</span><span>)</span><span>\n</span><span>[</span><span>part</span><span> </span><span>diff</span><span>]))))))</span><span>\n</span></code></pre></div></div>\n<p>The <code>keep</code> function is a something like a combination of <code>map</code> and <code>filter</code> and I think it\nmakes the code a bit more readable, but that’s naturally a matter of taste.</p>\n<p>In another <a href=\"http://johnj.com/lazy-physics.html\">post</a>, the author explains how he was experimenting with laziness and\ninfinite sequences when he wrote the original <code>smt-8</code>. Many of the core functions in\nClojure support lazy sequences which makes Clojure an excellent tool for this kind of\nexploration. However, for his comparison with Common Lisp, he decided to punt on the\nquestion of laziness. That’s fine if you don’t need laziness, but I want to point out to\ncasual readers that laziness can be a useful feature especially when working with large data\nsets. However, laziness does require a bit of overhead that you might prefer to avoid when\ndoing competitive benchmarking. Common Lisp is not lazy by default so you would need to do\nsome extra work or find a good library if you wanted a lazy solution in Common Lisp.</p>\n<p>If we don’t need a lazy solution, and we have a finite input sequence, we can make things\nsignificantly faster using a vector as input. In particular, we don’t have to create\nintermediate partitions anymore. We can just check the values at the appropriate indices.\n(Remember the input is monotonic so only the end points of a potential cluster matter.)\nAssuming it’s safe to convert the input to a vector, we can try something like the\nfollowing.</p>\n<div><div><pre><code><span>\n</span><span>;; for better performance, the original data should already by a vector</span><span>\n</span><span>(</span><span>defn</span><span> </span><span>smt-8for</span><span> </span><span>[</span><span>times</span><span>]</span><span>\n</span><span>(</span><span>let</span><span> </span><span>[</span><span>v</span><span> </span><span>(</span><span>vec</span><span> </span><span>times</span><span>)</span><span>\n</span><span>width</span><span> </span><span>8</span><span>]</span><span>\n</span><span>(</span><span>for</span><span> </span><span>[</span><span>i</span><span> </span><span>(</span><span>range</span><span> </span><span>(</span><span>-</span><span> </span><span>(</span><span>count</span><span> </span><span>v</span><span>)</span><span> </span><span>(</span><span>dec</span><span> </span><span>width</span><span>)))</span><span>\n</span><span>:let</span><span> </span><span>[</span><span>diff</span><span> </span><span>(</span><span>-</span><span> </span><span>(</span><span>v</span><span> </span><span>(</span><span>+</span><span> </span><span>i</span><span> </span><span>(</span><span>dec</span><span> </span><span>width</span><span>)))</span><span> </span><span>(</span><span>v</span><span> </span><span>i</span><span>))]</span><span>\n</span><span>:when</span><span> </span><span>(</span><span>></span><span> </span><span>1000</span><span> </span><span>diff</span><span>)]</span><span>\n</span><span>[(</span><span>subvec</span><span> </span><span>v</span><span> </span><span>i</span><span> </span><span>(</span><span>+</span><span> </span><span>i</span><span> </span><span>width</span><span>))</span><span> </span><span>diff</span><span>])))</span><span>\n</span></code></pre></div></div>\n<p>In <code>smt-8for</code>, we’re using a <code>for</code> comprehension to drive the calculations. We’re also\ntaking subvectors out of the original vector to make our clusters, but only if we have\nalready determined that the cluster belongs in the result. We are eliminating the creation\nof many partitions that would end up being filtered out. The <code>subvec</code> function does not\ncopy, it just keeps an offset into the original vector. It’s fast but it prevents garbage\ncollecting the original vector as long as the subvectors are alive. If that’s not\nacceptable, you can make a copy of the cluster instead. In my tests, <code>smt-8for</code> is more\nthan 30 times as fast as the original <code>smt-8</code>.</p>\n<p>You can get a bit more performance if you’re careful about boxed math. Normally, you\nshouldn’t care so please don’t get carried away with this next tip. You can read the\ndocumentation on <a href=\"https://clojure.org/reference/java_interop#typehints\">type hints</a>, <em>*warn-on-reflection*</em> and <em>*unchecked-math*</em> for more\ninformation.</p>\n<div><div><pre><code><span>\n</span><span>(</span><span>set!</span><span> </span><span>*unchecked-math*</span><span> </span><span>:warn-on-boxed</span><span>)</span><span>\n</span><span>(</span><span>defn</span><span> </span><span>smt-8forh</span><span> </span><span>[</span><span>v</span><span>]</span><span>\n</span><span>(</span><span>let</span><span> </span><span>[</span><span>width</span><span> </span><span>8</span><span>]</span><span>\n</span><span>(</span><span>for</span><span> </span><span>[</span><span>^</span><span>long</span><span> </span><span>i</span><span> </span><span>(</span><span>range</span><span> </span><span>(</span><span>-</span><span> </span><span>(</span><span>count</span><span> </span><span>v</span><span>)</span><span> </span><span>(</span><span>dec</span><span> </span><span>width</span><span>)))</span><span>\n</span><span>:let</span><span> </span><span>[</span><span>diff</span><span> </span><span>(</span><span>-</span><span> </span><span>^</span><span>long</span><span> </span><span>(</span><span>v</span><span> </span><span>(</span><span>+</span><span> </span><span>i</span><span> </span><span>(</span><span>dec</span><span> </span><span>width</span><span>)))</span><span> </span><span>^</span><span>long</span><span> </span><span>(</span><span>v</span><span> </span><span>i</span><span>))]</span><span>\n</span><span>:when</span><span> </span><span>(</span><span>></span><span> </span><span>1000</span><span> </span><span>diff</span><span>)]</span><span>\n</span><span>(</span><span>list</span><span> </span><span>(</span><span>subvec</span><span> </span><span>v</span><span> </span><span>i</span><span> </span><span>(</span><span>+</span><span> </span><span>i</span><span> </span><span>width</span><span>))</span><span> </span><span>diff</span><span>))))</span><span>\n</span></code></pre></div></div>\n<p>Adding the type hints squeezes a bit more performance out of the same code. I measured\nbetter than 20% increase in performance, but remember this code is doing simple arithmetic\nand almost no “business logic” so we’re mostly measuring what would normally be considered\noverhead costs.</p>\n<p>Clojure has another feature called <a href=\"https://clojure.org/reference/transducers\">Transducers</a> that can improve performance for chains\nof operations over input sequences. Here’s a slightly complicated implementation using\ntransducers. To get extra speed, this version builds a <em>list</em> of results, which is slightly\nfaster than appending to a vector. It runs the <code>range</code> calculation in reverse to compensate\nfor the natural addition at the head of the output list. I have to admit that the slight\nperformance improvement isn’t worth increasing the obscurity of the code as I’ve done in\nthis case. However, the general point is that transducers are often a win for performance\nand clarity. In my tests, the this transducer version is marginally faster than the\nprevious solution.</p>\n<div><div><pre><code><span>\n</span><span>(</span><span>defn</span><span> </span><span>smt-8x</span><span> </span><span>[</span><span>v</span><span>]</span><span>\n</span><span>(</span><span>let</span><span> </span><span>[</span><span>width</span><span> </span><span>8</span><span>]</span><span>\n</span><span>(</span><span>into</span><span> </span><span>()</span><span>\n</span><span>(</span><span>keep</span><span> </span><span>(</span><span>fn</span><span> </span><span>[</span><span>i</span><span>]</span><span>\n</span><span>(</span><span>let</span><span> </span><span>[</span><span>d</span><span> </span><span>(</span><span>-</span><span> </span><span>^</span><span>long</span><span> </span><span>(</span><span>v</span><span> </span><span>(</span><span>+</span><span> </span><span>(</span><span>dec</span><span> </span><span>width</span><span>)</span><span> </span><span>^</span><span>long</span><span> </span><span>i</span><span>))</span><span> </span><span>^</span><span>long</span><span> </span><span>(</span><span>v</span><span> </span><span>i</span><span>))]</span><span>\n</span><span>(</span><span>when</span><span> </span><span>(</span><span>></span><span> </span><span>1000</span><span> </span><span>d</span><span>)</span><span>\n</span><span>(</span><span>list</span><span> </span><span>(</span><span>subvec</span><span> </span><span>v</span><span> </span><span>i</span><span> </span><span>(</span><span>+</span><span> </span><span>^</span><span>long</span><span> </span><span>i</span><span> </span><span>width</span><span>))</span><span> </span><span>d</span><span>)))))</span><span>\n</span><span>(</span><span>range</span><span> </span><span>(</span><span>-</span><span> </span><span>(</span><span>count</span><span> </span><span>v</span><span>)</span><span> </span><span>(</span><span>inc</span><span> </span><span>width</span><span>))</span><span> </span><span>-1</span><span> </span><span>-1</span><span>))))</span><span>\n</span></code></pre></div></div>\n<p>Now, if you’re desperate for better performance and you have control over your input data,\nyou can use Java arrays, which have built-in support in Clojure. For appropriate\nsituations, they are faster than the more refined Clojure collections, especially for direct\naccess to data that is not shared. Of course, you can cause bugs with wanton mutations so\nyou have to be careful. Frankly, I would rarely make this trade-off in real code. On the\nother hand, array access is a useful tool when playing the microbenchmark game. If you have\na Clojure collection, you can populate a Java array of longs with the Clojure function\n<code>long-array</code>. Elements are accessed with <code>aget</code>. Our new <code>smt-8arr</code> is similar to\n<code>smt-8forh</code> but adapted for the Java array input.</p>\n<div><div><pre><code><span>\n</span><span>;; use Java array for speed</span><span>\n</span><span>(</span><span>defn</span><span> </span><span>smt-8arr</span><span> </span><span>[</span><span>^</span><span>longs</span><span> </span><span>larr</span><span>]</span><span>\n</span><span>(</span><span>let</span><span> </span><span>[</span><span>width</span><span> </span><span>8</span><span>]</span><span>\n</span><span>(</span><span>for</span><span> </span><span>[</span><span>^</span><span>long</span><span> </span><span>i</span><span> </span><span>(</span><span>range</span><span> </span><span>(</span><span>-</span><span> </span><span>(</span><span>alength</span><span> </span><span>larr</span><span>)</span><span> </span><span>(</span><span>dec</span><span> </span><span>width</span><span>)))</span><span>\n</span><span>:let</span><span> </span><span>[</span><span>diff</span><span> </span><span>(</span><span>-</span><span> </span><span>(</span><span>aget</span><span> </span><span>larr</span><span> </span><span>(</span><span>+</span><span> </span><span>i</span><span> </span><span>(</span><span>dec</span><span> </span><span>width</span><span>)))</span><span> </span><span>(</span><span>aget</span><span> </span><span>larr</span><span> </span><span>i</span><span>))]</span><span>\n</span><span>:when</span><span> </span><span>(</span><span>></span><span> </span><span>1000</span><span> </span><span>diff</span><span>)]</span><span>\n</span><span>(</span><span>list</span><span> </span><span>(</span><span>for</span><span> </span><span>[</span><span>j</span><span> </span><span>(</span><span>range</span><span> </span><span>i</span><span> </span><span>(</span><span>+</span><span> </span><span>i</span><span> </span><span>width</span><span>))]</span><span> </span><span>(</span><span>aget</span><span> </span><span>larr</span><span> </span><span>j</span><span>))</span><span> </span><span>diff</span><span>))))</span><span>\n</span></code></pre></div></div>\n<p>On my machine, I get about a 200x improvement over the original code. Of course, I’m\nassuming the data can be stored in the appropriate <code>long-array</code> in advance. In real world\napplications that do more than arithmetic, the business logic usually dominates so the\noverhead of laziness and persistent data structures is minimal by comparison. As I remarked\nearlier, I would not normally resort to Java arrays unless I had to inter-operate with Java\ncode.</p>\n<p>The big win in this case was avoiding object creation for partitions that were immediately\ndiscarded. I think most peole would prefer the <code>for</code> comprehension as shown in my\n<code>smt-8for</code> example. That version gave respectable peformance from clean code (IMHO).</p>\n<p>Execution times from <a href=\"https://github.com/hugoduncan/criterium/\">Criterium</a> on my oldish iMac.</p>\n<hr>\n<table>\n<thead>\n<tr>\n<th>Function</th>\n<th>Time (ms)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>smt-8</td>\n<td>1572</td>\n</tr>\n<tr>\n<td>smt-8a</td>\n<td>1341</td>\n</tr>\n<tr>\n<td>smt-8for</td>\n<td>47</td>\n</tr>\n<tr>\n<td>smt-8forh</td>\n<td>31</td>\n</tr>\n<tr>\n<td>smt-8x</td>\n<td>25</td>\n</tr>\n<tr>\n<td>smt-8arr</td>\n<td>7</td>\n</tr>\n</tbody>\n</table>\n<hr>\n<p>The source code for this post is available as a <a href=\"https://gist.github.com/miner/bf8b8221a8e31e3438c8620a81fbc16c\">gist</a>.</p>",
   :direction "ltr"},
  :updated 1572825600000,
  :entities
  [{:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "about",
    :label "Clojure"}
   {:mentions [{:text "Common Lisp"}],
    :id "nlp/f/entity/wd:849146",
    :salienceLevel "mention",
    :label "Common Lisp"}
   {:mentions [{:text "Speed"}],
    :id "nlp/f/entity/wd:108006",
    :salienceLevel "mention",
    :label "Speed"}
   {:mentions [{:text "laziness"}],
    :id "nlp/f/entity/wd:484",
    :salienceLevel "mention",
    :label "laziness"}
   {:mentions [{:text "Java"}],
    :id "nlp/f/entity/wd:251",
    :salienceLevel "mention",
    :label "Java"}],
  :alternate
  [{:href "http://miner.github.io/2019/11/04/smt-microbenchmark.html",
    :type "text/html"}],
  :title "SMT Microbenchmark",
  :author "Steve Miner",
  :published-str "Sun Nov 03 16:00:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16e3ad240e2:1237f165:97b0c8f7",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "http://miner.github.io/2019/11/04/smt-microbenchmark.html",
  :updateCount 1,
  :commonTopics
  [{:score 71.0309935722637,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1572825600000,
  :fingerprint "811ddd96",
  :canonicalUrl
  "http://miner.github.io/2019/11/04/smt-microbenchmark.html"}
 {:engagement 6,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1572850546481,
  :content
  {:content
   "<p>Stratified design is one where you build more specific things on top of more general things, typically with many layers. But why is this powerful? In this episode, we explore why it’s sometimes easier to solve a more general problem than a specific one.</p>\n<p></p>\n<div>\n<div><span></span><img alt=\"Video Thumbnail\" src=\"https://i.ytimg.com/vi/9S5KxZgjDNk/mqdefault.jpg\"><p></p>\n<h5>Why does stratified design work?</h5>\n<p><span>Stratified design is one where you build more specific things on top of more general things, typically with many layers. But why is this powerful? In this episode, we explore why it's sometimes easier to solve a more general problem than a specific one. https://share.transistor.fm/e/42cd94e8 https:/</span></p></div>\n</div>\n<h2>Transcript</h2>\n<p>Eric Normand: Why does stratified design work? In this episode, we will explore the idea that some problems are easier to solve in the general case, which is pretty weird when you think about it.</p>\n<p>My name is Eric Normand, and I help people thrive with functional programming. Stratified design is a way to structure your code so that more specific code is built on top of more general code.</p>\n<p>Just as an example, we all do it. Our programming language has a bunch of general constructs. It has functions, for loops, variables. They’re not specific to any particular domain, but then we write our software in terms of those things. It’s obviously going to be more specific, unless we’re writing a more general language on top.</p>\n<p>Usually we’re writing an accounting system or something right on top of all these for loops and stuff. It’s much more specific about what it’s doing. Specific code on top of less specific code. That’s just two layers.</p>\n<p>You could break it up into smaller and smaller layers, but you always have this property that the more specific stuff has to be built on top of the less specific stuff.</p>\n<p>I was reading this book called “Elixir in Action,” trying to learn Elixir, trying to broaden my mind, find some new stuff to wrap my head around. In one of the earlier chapters, they build a to-do list.</p>\n<p>To do that, you build a multimap, which is just a hash map that can have multiple elements at a key. It’s like a list. There is a key, and instead of a value, there is a list of values. It’s not hard to write this little extension to a map. You just have a multimap ad or multimap put that puts a new key and value. It checks, is there a list there already?</p>\n<p>If there is, then add this to the list and store that as the value in the map. If it doesn’t exist, then do a singletonMap where the value should go. You could see how to write this pretty simply. On top of that, they build the to-do list. The to-do list, the key is using a multimap. The key was the day, the date, the day that the to-do item was due or something like that.</p>\n<p>You would put in a date, and you would get out a list of to-dos. This is a great example of stratified design. I was very happy to see that this was in the book. I don’t know if this is true because I’m not really into the Elixir community that much, but it’s a good sign that they understand this idea of building the layers.</p>\n<p>You could imagine writing the to-do list directly without writing this intermediate layer of the multimap. You just try to write the to-do list itself in terms of a map. It’s doable. It’s not that hard to do but it’s going to be harder than writing the multimap separate.</p>\n<p>Why? Why is it harder to write it in one step than to write it in two steps? This is a weird thing to me and I don’t think I’m the first to identify this, that there are a lot of problems that are easier to solve in the general case.</p>\n<p>The general case is, “Hey, we are storing a list of values per key. Let’s just do that. Instead of making a new type that stores a date and a list of to-do elements, we’re going to make this more general thing that stores any key and any list of values.” Seems weird that this happens and I just want to explore this a little bit because I think it’s at the key to why stratified design works at all.</p>\n<p>The stratified design, when you’re making the layers, it actually is easier to do it with layers than to try to write it from the ground up with just the basics that your language gives you. In the “Structure and Interpretation of Computer Programs” book, there is a system that…It’s not completely developed, but it’s developed enough that you get the idea of how it works.</p>\n<p>It’s how to draw pictures in a certain way and how to compose them up. You can see that it’s a pretty powerful system. It lets you draw MC Escher-esque pictures where you start with one picture, and now you duplicate it over here, but one-quarter of the size and then, you see, you can make a fractal pattern. You repeat that over and over and it makes cool patterns.</p>\n<p>If the image you start with is cool enough, it makes a cool MC Escher style repeating, tiling pattern. If I were to try to write that myself using the primitives that I have, like draw an image, loop, add certain width to the image, then draw another image over here, I don’t know if I would ever solve that problem. I don’t know if I could generate cool MC Escher style art.</p>\n<p>I could draw something. I could get something working but it would not be where I felt like, “Oh, I have all this liberty and expressivity to make all this whole style of art.” In the book, they do it.</p>\n<p>How do they do it? It’s by building layers. The first layer is just how do you draw an image and then how do you compose two images up comes up from that. The next layer up is I can draw two pictures next to each other, or I can flip the one image, or I could scale an image.</p>\n<p>When I put two images next to each other, that gives me an image. I can put two images next to each other, scale it down, flip it, meaning make a copy that is now flipped above it, and flip it, and flip it. You’re building these small operations that are each easy to write. That’s important. The general operations are often much easier to write.</p>\n<p>Now, by the time you build up layer after layer of things you can do, at the top, you see how to build all this whole style of art. It’s not just one picture. It’s a whole style that’s now available to you through these operations. Like I said, I don’t think I could start from the beginning and try to implement the top layer directly.</p>\n<p>I couldn’t do that out of the primitives of the language, but by building up stuff that you do know how to do, one layer at a time, where each layer is built out of the previous layer, I can get to a height that I couldn’t get to before. That’d be really hard, let’s say.</p>\n<p>It has something to do with when you go general, you’re actually going more abstract, which means you’re ignoring more stuff, which means it’s easier to fit in your head.</p>\n<p>I don’t have to worry about what the pixels look like. I don’t have to worry about how this is going to be used. What it’s going to look like when I draw it. I’m just making a simple operation. It’s pretty dumb. It just flips an image. That’s all I’m doing. That flipping operation, I understand how to do it.</p>\n<p>I just reverse. I’d just zero minus the x coordinate, and that flips it. Flip it vertically is zero minus the y coordinate. I understand how to do that. Putting two things side by side, also easy, translate the second one by the width of the first one or translate it by the height of the first one. That’s it. It’s very simple. Very easy. I understand. It’s just addition.</p>\n<p>I just add the height of image A to the y coordinate of image B. Done. Easy. I can do that, and because I have a simple brain like all humans, we have a limited capacity. We can’t think of how to make the whole thing from the top, but by building up these things that we do know how to build at the top, we can get to the top like a step ladder.</p>\n<p>I’ll just build one little more piece of my staircase, and then boom at the top. You can look down and see the whole thing. OK. I just wanted to explore this idea. I think it’s one of the reasons why stratified design works so well.</p>\n<p>It’s basically because we have limited mental capacity as limited beings. We need to have some way of ignoring stuff so that we can focus on a small piece of it at a time. When you go deeper in the layers, you’re actually ignoring more. Remember the stuff at the bottom is more general. Stuff at the top is more specific.</p>\n<p>At the top, you’ve got a whole accounting system, but at the bottom you’ve got for loops. On that, on top of that, you have account records. You’re not even doing anything with them yet. This idea of being able to move down and ignore more and more stuff, it makes it easier to program at that level. I don’t think I need a recap in this one.</p>\n<p>It’s just been a freeform exploration. Maybe I will recap. I started with this idea of stratified design comes from structure and interpretation of computer programs, that name does, and it’s just a way of layering your code so that at the bottom, you have the more general code like your language constructs. At the top, you have the more specific.</p>\n<p>You can have multiple layers building up to that most specific part. I was reading Elixir in Action and they built a multimap. The language gave them maps, hash maps. They build a multimap, and then on top of the multi map, they built a to-do list. Very cool. I wanted to know, why not do that in one step? What is the use of building this multimap first?</p>\n<p>I know that the multimap is conceivably reusable, but I also think that it’s easier to build this general purpose multimap than it is to build the single purpose one. It’s easier because we don’t have to think about to-dos and dates and that kind of thing. We’re just thinking, I just need to store values in a list. Some problems are just easier to solve with that general layer.</p>\n<p>We can ignore more things. It fits in our brain more easily. If you’ve enjoyed this episode, you should go to lispcast.com/podcast. There you’ll find all the old episodes, including audio, video, and text transcripts. You’ll also find links to subscribe and to find me on social media. Get in touch, if you have questions, comments, love to hear from you.</p>\n<p>I always love to answer questions about my ideas. I’m very open. I hope that it comes across that I don’t know all of this stuff. This is just an exploration.</p>\n<p>If you have a better explanation than I do about why this works, why general problems are easier to solve, let me know. I really want to get into this and understand. All right. This has been my thought on functional programming.</p>\n<p>My name is Eric Normand. Thank you for listening, and rock on.</p>\n<p>The post <a rel=\"nofollow\" href=\"https://lispcast.com/why-does-stratified-design-work/\">Why does stratified design work?</a> appeared first on <a rel=\"nofollow\" href=\"https://lispcast.com\">LispCast</a>.</p>",
   :direction "ltr"},
  :updated 1572847200000,
  :entities
  [{:mentions [{:text "Elixir"}],
    :id "nlp/f/entity/wd:5362035",
    :salienceLevel "mention",
    :label "Elixir"}
   {:mentions [{:text "functional programming"}],
    :id "nlp/f/entity/wd:193076",
    :salienceLevel "mention",
    :label "functional programming"}
   {:mentions
    [{:text "Structure and Interpretation of Computer Programs"}],
    :id "nlp/f/entity/wd:1249747",
    :salienceLevel "mention",
    :label "Structure and Interpretation of Computer Programs"}
   {:mentions [{:text "programming language"}],
    :id "nlp/f/entity/wd:9143",
    :salienceLevel "mention",
    :label "programming language"}],
  :alternate
  [{:href "https://lispcast.com/why-does-stratified-design-work/",
    :type "text/html"}],
  :title "Why does stratified design work?",
  :author "Eric Normand",
  :published-str "Sun Nov 03 22:00:00 PST 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16e3532b731:11deaaa1:69b9f616",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url "https://i.ytimg.com/vi/9S5KxZgjDNk/mqdefault.jpg",
   :width 320,
   :height 180,
   :contentType "image/jpeg"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://lispcast.com/?p=2073",
  :commonTopics
  [{:score 34.16740213151174,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1572847200000,
  :fingerprint "acf5653e",
  :canonicalUrl
  "https://lispcast.com/why-does-stratified-design-work/"}
 {:engagement 31,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1572720667671,
  :recrawled 1572767524988,
  :content
  {:content
   "<p>One of the hardest things for any project author is to figure out whether their\nperspective on a project is aligned with perspective of the project’s\nusers. Henry Ford supposedly knew better than his customers what they needed,\nbut if that’s true I’d say he was a rather special case. I’m often guessing what\npeople need and would find useful, what their issues are and what tools are they\nusing. From time to time I guess right, but often I guess wrong. A couple of\nnotable examples immediately come to my mind.</p>\n<p>I always assumed that people didn’t care much about the minimum supported\nEmacs version, as it’s pretty easy to upgrade Emacs, so I was dropping support\nfor older Emacsen quite aggressively. Last year, however, I got some feedback\nafter my “Clojurists Together” funding round that people who were working\nin corporate environments were really suffering, because they couldn’t upgrade\nthe software on their machines. I was enlightened.</p>\n<p>I always assumed that people don’t care much about changing the keybindings of some commands\nand I was doing this quite a lot in the early days of CIDER. Now I know better…</p>\n<p>Similarly when I introduced <code>cider-nrepl</code> many years ago I thought that having\npeople set it up manually won’t be a big deal, and I grossly underestimated how\ncomplex this task was for many people. Fun trivia - automating\nthis setup in CIDER 0.10 was one of the most celebrated changes ever.</p>\n<p>At some point I foolishly believed that everyone read CIDER’s manual before starting to use it.\nIf only that were true!<sup><a href=\"http://metaredux.com/posts/2019/11/02/state-of-cider.html#fn:1\">1</a></sup></p>\n<p>I’ve always loved the concept of surveys like “State of Clojure” and the insight\nthey bring. I’ve meant to do something similar for CIDER for quite a while now -\nprobably for at least 5 years. For one reason or another, however, this task\njust kept sitting in my backlog. Until today…<sup><a href=\"http://metaredux.com/posts/2019/11/02/state-of-cider.html#fn:2\">2</a></sup></p>\n<p>Please, allow to me to introduce to you the first ever <a href=\"https://forms.gle/TJMVMEgUrNew1Cf8A\">State of CIDER\nsurvey</a>! It’s far from perfect, but it’s a\nstart. I’d really like to connect with more of you - the people who are actually\nusing CIDER. I want to understand what’s the environment you’re working in, I\nwant to learn what’s your background and how are you using CIDER. I want to\nlearn what do you like and what do you hate. Long story short - I want to align\nthe things I’m working on with your needs.</p>\n<p>I also want to get a feeling for how many people would be consider supporting\nthe project financially down the road. I’m hoping to inspire a few more\ncompanies and individuals to pitch in to our\n<a href=\"https://opencollective.com/cider\">OpenCollective</a> and <a href=\"https://github.com/sponsors/bbatsov\">GitHub\nSponsors</a> campaigns. I’m a dreamer, but I’m\nnot the only one… The subject of the economics of OSS development is something I plan\nto discuss at length in a dedicated article.</p>\n<p>The survey will be open until the end of next week. Looking forward to your responses!</p>\n<div>\n<ol>\n<li>\n<p>Not that I ever read any manual before diving into something. <a href=\"http://metaredux.com/posts/2019/11/02/state-of-cider.html#fnref:1\">↩</a></p>\n</li>\n<li>\n<p>All the credit here goes to the “Clojurists Together”. Having goals to work towards makes a big difference! <a href=\"http://metaredux.com/posts/2019/11/02/state-of-cider.html#fnref:2\">↩</a></p>\n</li>\n</ol>\n</div>",
   :direction "ltr"},
  :updated 1572652800000,
  :entities
  [{:mentions [{:text "cider"}],
    :id "nlp/f/entity/wd:167296",
    :salienceLevel "about",
    :label "cider"}
   {:mentions [{:text "Henry Ford"}],
    :id "nlp/f/entity/wd:8768",
    :salienceLevel "mention",
    :label "Henry Ford"}
   {:mentions [{:text "OSS"}],
    :id "nlp/f/entity/wd:1130645",
    :salienceLevel "mention",
    :label "open-source software"}],
  :alternate
  [{:href "http://metaredux.com/posts/2019/11/02/state-of-cider.html",
    :type "text/html"}],
  :title "State of CIDER Survey (2019)",
  :author "Bozhidar Batsov",
  :published-str "Fri Nov 01 17:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16e2d74ec17:1165b0fb:69b9f616",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "http://metaredux.com/posts/2019/11/02/state-of-cider",
  :updateCount 1,
  :commonTopics
  [{:score 0.784,
    :id "nlp/f/topic/1339",
    :salienceLevel "mention",
    :label "lifestyle"}],
  :published 1572652800000,
  :fingerprint "6adde11e",
  :canonicalUrl
  "http://metaredux.com/posts/2019/11/02/state-of-cider.html"}
 {:engagement 12,
  :unread false,
  :crawled 1572692682383,
  :content
  {:content
   "<p>There are many mysteries in life, but few are as perplexing as the\neternal question “What exactly happens during <code>cider-jack-in</code>?”. Today it’s time\nto unravel this mystery!</p>\n<h2>The Basics</h2>\n<p>At its heart <code>cider-jack-in</code> does something super simple - it just executes a shell\ncommand (e.g. <code>lein repl</code>) that starts an nREPL server, waits for this server to come\nto life, and then connects CIDER to it. It’s really as simple as this. If I had to explain it in\nmore details I’d probably do it like:</p>\n<ul>\n<li>CIDER shells out and runs a command like <code>lein repl :headless</code>.</li>\n<li>CIDER waits for the nREPL server to start.\nCIDER figures out this by parsing the output from the command and waiting for a line like\n<code>nREPL server started on port 53005 on host localhost - nrepl://localhost:53005</code> to appear there.</li>\n<li>CIDER extracts the port of the nREPL from the preceding message.</li>\n<li>It connects to the running nREPL server.</li>\n</ul>\n<p>Basically it’s a combination of auto-starting an nREPL server and doing\n<code>cider-connect</code> to it afterwards. <sup><a href=\"http://metaredux.com/posts/2019/11/02/hard-cider-understanding-the-jack-in-process.html#fn:1\">1</a></sup> Or is it? If it were so simple why does\nthe shell command executed by <code>cider-jack-in</code> for Leiningen project look like:</p>\n<div><div><pre><code>[nREPL] Starting server via /usr/local/bin/lein update-in :dependencies conj \\[nrepl\\ \\&quot;0.6.0\\&quot;\\] -- update-in :plugins conj \\[cider/cider-nrepl\\ \\&quot;0.23.0-SNAPSHOT\\&quot;\\] -- repl :headless :host localhost\n</code></pre></div></div>\n<p>It’s time to explain another confusing concept - namely auto-injection of Clojure dependencies.</p>\n<h2>Auto-Injecting Dependencies</h2>\n<p>While CIDER’s core functionality requires nothing more than an nREPL server,\nthere are many advanced features<sup><a href=\"http://metaredux.com/posts/2019/11/02/hard-cider-understanding-the-jack-in-process.html#fn:2\">2</a></sup> that depend on the presence of additional nREPL\nmiddleware (e.g. <code>cider-nrepl</code>). In the early versions of CIDER\n(up to CIDER 0.11) users had to add those dependencies themselves, which was a\npainful and error-prone process. Fortunately today that’s handled\nauto-magically when you’re using <code>cider-jack-in</code>.</p>\n<p>If your project uses <code>lein</code>, <code>boot</code> or <code>tools.deps</code> (<code>deps.edn</code>), CIDER will\nautomatically inject all the necessary nREPL dependencies (e.g. <code>cider-nrepl</code> or\n<code>piggieback</code>) when it starts the server. The injection process is extremely\nsimple - CIDER simply passes the extra dependencies and nREPL configuration to\nyour build tool in the command in runs to start the nREPL server. Here’s how\nthis looks for <code>tools.deps</code>:</p>\n<p>$ clojure -Sdeps ‘ cider/cider-nrepl {:mvn/version “0.22.4”}}}’ -m nrepl.cmdline –middleware ‘[“cider.nrepl/cider-middleware”]’</p>\n<p>Here’s a tip for you - if you don’t want <code>cider-jack-in</code> to inject dependencies automatically, set\n<code>cider-inject-dependencies-at-jack-in</code> to <code>nil</code>. Note that you’ll have to setup\nthe dependencies yourself (e.g. by adding them to your project)\njust as in CIDER 0.10 and older. There are few reason why you’d want to do something like this,\nbut the option exists.</p>\n<p>Normally <code>cider-jack-in</code> would inject only <code>cider-nrepl</code> and <code>cider-jack-in-cljs</code> would\nadd <code>piggieback</code> as well. The injection, however, mechanism is configurable and\nyou can easily add more libraries there. Some CIDER extensions (e.g. <code>sayid</code> and <code>clj-refactor</code>) would use\nthis mechanism to auto-inject their own dependencies.</p>\n<p>CIDER would also inject the most recent version of nREPL that it supports. This is a simple\ntrick to override the version of nREPL bundled with your build tool, so you can gain\naccess to the newest nREPL features. Generally that’s one aspect of CIDER’s inner workings\nthat end-users will rarely have to think about.</p>\n<p>CIDER can also inject a Clojure dependency into your project, which is useful,\nfor example, if your project defaults to an older version of Clojure than that\nsupported by the CIDER middleware. Set <code>cider-jack-in-auto-inject-clojure</code>\nappropriately to enable this.</p>\n<p>There are other nuances of the auto-injection - e.g. for Leiningen you\ncan inject both dependencies and plugins, but that’s outside the scope of this article.</p>\n<p>Now it’s time for a little quiz! Can you guess why CIDER does not currently\nsupport dependency auto-injection for Gradle projects? Yeah, you’re totally\nright! Unfortunately there’s no way to pass extra dependencies to Gradle via its\ncommand-line interface.</p>\n<h2>Jacking-in without a Project</h2>\n<p>If you try to run <code>cider-jack-in</code> outside a project\ndirectory, CIDER will warn you and ask you to confirm whether you\nreally want to do this; more often than not, this is an accident. If\nyou decide to proceed, CIDER will invoke the command configured in\n<code>cider-jack-in-default</code>. Prior to CIDER 0.17, this defaulted to <code>lein</code>\nbut was subsequently switched to <code>clj</code>, Clojure’s basic startup command.</p>\n<p>Here’s another useless tip - you can set <code>cider-allow-jack-in-without-project</code> to\n<code>t</code> if you’d like to disable the warning displayed when jacking-in outside a\nproject. I never run CIDER outside of projects, but you might have a different style\nand, as you probably noticed by now, CIDER is infinitely configurable.</p>\n<h2>Customizing the Jack-in Command Behaviour</h2>\n<p>We now made it to my favourite part of our exploration of CIDER’s jack-in - how can we\ntweak the shell command it runs? There are many reasons to want to do this - most\noften you’d like to include some extra profiles (e.g. the famous <code>fig</code> profile if you\nare using <code>tools.deps</code>), but I can imagine some people would have to do more\ncreative tweaks as well.</p>\n<p>Let’s start with the simplest possible option, that’s idea for one-off customizations.\nYou can use <code>C-u M-x cider-jack-in</code> (<code>C-u C-c C-x j j</code>) to\nspecify the exact command that <code>cider-jack-in</code> would run.\nThis option is very useful is you want to specify a something like a <code>lein</code>\nor <code>deps.edn</code> profile.</p>\n<p>Alternatively you can <code>C-u C-u M-x cider-jack-in</code>, which is a\nvariation of the previous command. This command will first prompt you for the\nproject you want to launch <code>cider-jack-in</code> in, which is pretty handy if you’re\nin some other directory currently. This option is also useful if your project\ncontains some combination of <code>project.clj</code>, <code>build.boot</code> and <code>deps.edn</code> and you want\nto launch a REPL for one or the other.</p>\n<p>Keep in mind that the examples here use only <code>cider-jack-in</code>, but this behaviour is consistent\nfor all <code>cider-jack-in-*</code> commands.</p>\n<p>You can further customize the command line CIDER uses for <code>cider-jack-in</code> by\nmodifying the following string options:</p>\n<ul>\n<li><code>cider-lein-global-options</code>, <code>cider-boot-global-options</code>,\n<code>cider-clojure-cli-global-options</code>, <code>cider-gradle-global-options</code>:\nthese are passed to the command directly, in first position\n(e.g., <code>-o</code> to <code>lein</code> enables offline mode).</li>\n<li><code>cider-lein-parameters</code>, <code>cider-boot-parameters</code>,\n<code>cider-clojure-cli-parameters</code>, <code>cider-gradle-parameters</code>: these are\nusually task names and their parameters (e.g., <code>dev</code> for launching\nboot’s dev task instead of the standard <code>repl -s wait</code>).</li>\n</ul>\n<p>Don’t forget that those variables can be configured <a href=\"http://metaredux.com/posts/2019/10/05/hard-cider-project-specific-configuration.html\">on a per-project basis</a>.</p>\n<h2>A Note about <code>tools.deps</code> and Windows</h2>\n<p>You’ve probably figured out by now that using <code>tools.deps</code> with Windows\ncan be a bit painful. Fortunately CIDER can help with that.</p>\n<p>To use <code>cider-jack-in</code> with <code>tools.deps</code> on Windows set the\n<code>cider-clojure-cli-command</code> to <code>&quot;powershell&quot;</code>. This happens by default\nif you are on Windows and no <code>clojure</code> executable is found. Using\n<code>&quot;powershell&quot;</code> will Base64 encode the <code>clojure</code> launch command before\npassing it to PowerShell and avoids shell-escaping issues.</p>\n<p>You might be wondering why CIDER uses <code>clojure</code> instead of <code>clj</code>, right? It’s\npretty simple actually - <code>clj</code> simply wraps <code>clojure</code> with some\nterminal-friendly functionality (<code>rlwrap</code>), that explodes if you’re not in an\nactual terminal. Another great mystery has been resolved!</p>\n<h2>Epilogue</h2>\n<p>Phew! That’s a lot of information! I hope now you’ve got a much better idea how\nthe jack-in process is working and that this will help you use CIDER more\neffectively down the road.</p>\n<p>There’s a lot more that can be said about jack-in, but I do feel we’ve covered everything\nessential. I’m also a bit lazy and I don’t feel like writing anymore. :-)</p>\n<p>That’s all I have for you today. This episode was brought to you by <a href=\"https://www.clojuriststogether.org/\">Clojurists Together</a>.\nThey are awesome and so are all of you! Keep hacking!</p>\n<div>\n<ol>\n<li>\n<p>With a pretty confusing Neuromancer/Matrix-inspired name. <a href=\"http://metaredux.com/posts/2019/11/02/hard-cider-understanding-the-jack-in-process.html#fnref:1\">↩</a></p>\n</li>\n<li>\n<p>“Advanced” is a bit of stretch here - there’s no ClojureScript support without Piggieback. <a href=\"http://metaredux.com/posts/2019/11/02/hard-cider-understanding-the-jack-in-process.html#fnref:2\">↩</a></p>\n</li>\n</ol>\n</div>",
   :direction "ltr"},
  :updated 1572652800000,
  :entities
  [{:mentions [{:text "hard cider"} {:text "cider"}],
    :id "nlp/f/entity/wd:167296",
    :salienceLevel "about",
    :label "cider"}
   {:mentions [{:text "project"}],
    :id "nlp/f/entity/wd:170584",
    :salienceLevel "mention",
    :label "project"}
   {:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "REPL"}],
    :id "nlp/f/entity/wd:2032810",
    :salienceLevel "mention",
    :label "Read–eval–print loop"}
   {:mentions [{:text "command-line interface"} {:text "CLI"}],
    :id "nlp/f/entity/wd:189053",
    :salienceLevel "mention",
    :label "command-line interface"}],
  :alternate
  [{:href
    "http://metaredux.com/posts/2019/11/02/hard-cider-understanding-the-jack-in-process.html",
    :type "text/html"}],
  :title "Hard CIDER: Understanding the Jack-in Process",
  :author "Bozhidar Batsov",
  :published-str "Fri Nov 01 17:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16e2bc9e68f:11486d17:69b9f616",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "http://metaredux.com/posts/2019/11/02/hard-cider-understanding-the-jack-in-process",
  :commonTopics
  [{:score 38.635879882677756,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 15.384393784703834,
    :id "nlp/f/topic/3049",
    :salienceLevel "about",
    :label "automotive"}
   {:score 0.738,
    :id "nlp/f/topic/1544",
    :salienceLevel "mention",
    :label "navy"}],
  :published 1572652800000,
  :fingerprint "78218e9b",
  :canonicalUrl
  "http://metaredux.com/posts/2019/11/02/hard-cider-understanding-the-jack-in-process.html"}
 {:engagement 6,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1572649694946,
  :content
  {:content
   "<p>Each week, we answer a different question about Clojure and functional programming.</p>\n<p>If you have a question you’d like us to discuss, tweet <a href=\"https://twitter.com/clojuredesign\">@clojuredesign</a>, send an email to <a href=\"mailto:feedback@clojuredesign.club\">feedback@clojuredesign.club</a>, or join the <code>#clojuredesign-podcast</code> channel on the <a href=\"http://clojurians.net/\">Clojurians Slack</a>.</p>\n<p>This week, the question is: <strong>“How can I save my data from serialization?”</strong> We record our thoughts on the many trade-offs we have encountered preserving our data when it leaves our programs.</p>\n<p>Selected quotes:</p>\n<ul>\n<li>“Clojure has the best data structures on the planet.”</li>\n<li>“One of the reasons why JSON is so popular is because XML was so overbearingly hard.”</li>\n<li>“XML decided that trees aren’t dimensional enough, so they added another dimension in attributes.”</li>\n<li>“Serialization formats aren’t for humans, Nate, what are you talking about?!”</li>\n<li>“EDN isn’t horrible to look at because it’s just Clojure data structures.”</li>\n<li>“We don’t want freezer burn!”</li>\n</ul>\n<p>Related episodes:</p>\n<ul>\n<li><a href=\"https://clojuredesign.club/episode/014-fiddle-with-the-repl\">014: Fiddle with the REPL</a></li>\n</ul>\n<p>Links:</p>\n<ul>\n<li><a href=\"https://github.com/edn-format/edn\">EDN</a></li>\n<li><a href=\"https://github.com/cognitect/transit-format\">Transit</a></li>\n<li><a href=\"https://github.com/ptaoussanis/nippy\">Nippy</a></li>\n<li><a href=\"https://github.com/Datomic/fressian\">Fressian</a></li>\n<li><a href=\"https://github.com/pkpkpk/fress\">fress: Fressian for Clojure(Script) <em>AND</em> WASM!</a></li>\n</ul>",
   :direction "ltr"},
  :updated 1572620400000,
  :entities
  [{:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "about",
    :label "Clojure"}
   {:mentions [{:text "XML"}],
    :id "nlp/f/entity/wd:2115",
    :salienceLevel "mention",
    :label "Extensible Markup Language"}
   {:mentions [{:text "functional programming"}],
    :id "nlp/f/entity/wd:193076",
    :salienceLevel "mention",
    :label "functional programming"}
   {:mentions [{:text "JSON"}],
    :id "nlp/f/entity/wd:2063",
    :salienceLevel "mention",
    :label "JavaScript Object Notation"}
   {:mentions [{:text "REPL"}],
    :id "nlp/f/entity/wd:2032810",
    :salienceLevel "mention",
    :label "Read–eval–print loop"}],
  :alternate
  [{:href
    "https://clojuredesign.club/episode/053-how-can-i-save-my-data-from-serialization/",
    :type "text/html"}],
  :title "Ep 053: How Can I Save My Data From Serialization?",
  :author "Christoph Neumann and Nate Jones",
  :published-str "Fri Nov 01 08:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16e2939f6e2:107b5455:ad5391a1",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://clojuredesign.club/episode/053-how-can-i-save-my-data-from-serialization/",
  :commonTopics
  [{:score 50.55125292666995,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.973,
    :id "nlp/f/topic/349",
    :salienceLevel "about",
    :label "business"}],
  :published 1572620400000,
  :fingerprint "90884ea8",
  :canonicalUrl
  "https://clojuredesign.club/episode/053-how-can-i-save-my-data-from-serialization/"}
 {:engagement 6,
  :unread false,
  :crawled 1572504813051,
  :content
  {:content
   "<p>We often write software to automate an existing physical process. But what makes this possible? When translating from physical to digital, something must be preserved. In this episode, we look into what is preserved across that translation and why algebraic properties might help us find it.</p>\n<p></p>\n<div>\n<div><span></span><img alt=\"Video Thumbnail\" src=\"https://i.ytimg.com/vi/MX4kXVyKrzc/mqdefault.jpg\"><p></p>\n<h5>Why are algebraic properties important?</h5>\n<p><span>We often write software to automate an existing physical process. But what makes this possible? When translating from physical to digital, something must be preserved. In this episode, we look into what is preserved across that translation and why algebraic properties might help us find it. https://</span></p></div>\n</div>\n<h2>Transcript</h2>\n<p>Eric Normand: Why are algebraic properties important? In this episode we ask, “How can we even write programs that do really useful work?” My name is Eric Normand, and I help people thrive with Functional Programming.</p>\n<p>This is an important topic. We write software often to automate an existing physical, real-world process. Maybe we did it by moving papers around. Maybe we talked to each other, but it’s a physical process.</p>\n<p>What makes it possible to translate this physical process into software? Put another way, a computer is just a big complex circuit that controls the flow of electrons. How can it be a bank? How is it possible that this thing is a bank?</p>\n<p>Banks nowadays run on computer software, so there must be some similarity between a bank and banking software. Now, when I say a bank, I mean like an old-school bank before computers existed. They basically did the same function, which is keeping track of money, who owes who what, the loans and stuff like that. That’s what the bank did.</p>\n<p>When it was translated from a physical process with people moving papers around, writing, and stuff like that to software, something had to be preserved. What was preserved so that the bankers, the accountants look at the bank software and say, “Yes, that’s doing what we did?”</p>\n<p>It’s not doing what they did. There’s not moving papers around. It’s not writing in a book. It’s not getting a check, copying it into an account record or a ledger, and summing columns. It’s not doing any of that. It’s just electrons. Why would they say that it is the same?</p>\n<p>Something must be preserved. What is that preserved thing? I’m not sure about this, but I think the answer is that there is a similar structure between the bank and the bank software. Something in the structure of it is the same. There’s no atoms shared. There’s not even subatomic particles shared between them.</p>\n<p>It’s not the same, but the structure could be similar. What do I mean by “structure?” There are certain relationships. In this ledger, this book that represents your account in the old-style bank, this is one account. It’s a book. There is a relationship between the transactions that are recorded in this book and, let’s say, rows in a database table. They have similar fields.</p>\n<p>It’s got a debit column and a credit column. The database table has a debit column. There are relationships. There’s arity. One person can have multiple accounts that are captured in both. There’s the order. Here’s the order that the transactions were processed in. There’s also a similar order in the relational database that got stored in the table.</p>\n<p>Quantity — you write down a number for the amount of money that was transferred from one account to another. That quantity was written in pen in decimal digits. In the database, it’s stored in memory as some binary number, but there’s the quantity. We know how to relate the two. We understand mathematically that they’re both representing the same quantity.</p>\n<p>There are all those things that are pretty straightforward that any programmer could start to piece apart. There are other things that we don’t look at often enough, and those are the algebraic properties. These are things like associativity or commutativity. Associativity says that I can basically sum the debits and credits in any kind of grouping.</p>\n<p>When you write the transactions into your book, they’re going to arbitrarily land on different pages, depending on where on the page you start, how many transactions happened before this transaction. It’s going to be on this page, or the next page, or whatever.</p>\n<p>I could go page by page, summing that page, writing the sum at the bottom, go to the next page, writing the sum of the bottom. They’re arbitrarily grouped by page. It’s like these 30 transactions, and then the next 30 transactions, and then the next 30 transactions.</p>\n<p>I make the sum of each page, and then I could just sum the sum from each page. That will give me the total in the whole book. What if they had a book with 20 lines per page, not 30 lines per page? Would that break anything?</p>\n<p>No, it wouldn’t break anything. We know that if you group it by 20, you’re going to get the same answer as if you group it by 30. It’s not going to break anything. Meanwhile, our database table, we just sum the whole thing all at once.</p>\n<p>Except maybe not. It’s stored as a B-tree on the disk. How does the sum function work in Postgres? Does it work on the B-tree level? Does it get all the data and then sum it all up in one go? We don’t know. The thing is, we don’t have to know. It doesn’t matter. That is associativity. It doesn’t matter how it’s grouped.</p>\n<p>It doesn’t matter if you break it up into a million pieces and then put those pieces together, or break it in half and put those pieces together. It doesn’t matter. That is a thing that’s shared between these two things. That, to me, is an important property.</p>\n<p>Here’s another thing. Let’s say I write some checks, give one check to my plumber, one check to my electrician, one check to my gardener. I’m just making this up. I give them in a certain order, plumber, electrician, gardener. Will they arrive at the bank in that order? Probably not.</p>\n<p>They are all going to go to the bank at different times, depending on what they have to do that day. Maybe the gardener always goes every day, and the electrician goes on Fridays. Who knows? Maybe they want to send it in the mail. The mail doesn’t arrive in order. They arrive at the bank in some random order and then end up inside the bank.</p>\n<p>They’re not ordered in any particular way. They’re just put on someone’s desk. Maybe they’re put on two different people’s desks. Does that matter? The order in a bank doesn’t matter.</p>\n<p>Transactions are coming in, out of order. You write them in the book. They only order a little bit because banks want to collect fees when they write a negative number in the book. Like, “Oh, we summed it up, and it was negative at the end of the day.” In theory, they only do that at the end of the day. They allow out-of-order transactions to happen.</p>\n<p>For instance, I pay my gardener. My account happens to go negative, but in the stack, at the bank, there’s a check to me for more than what I owed the gardener. It should go back positive. It doesn’t matter if they do the gardener’s check or my check first. There are little wrinkles like that, but in general, the order of the checks doesn’t matter.</p>\n<p>The order of transactions doesn’t matter, because we know we’re going to sum them up at the end of the day. That is preserved in the database. The order of the transactions shouldn’t matter. Why am I bringing these up? When we’re writing our software, we need tools to help us search for things in the real world that are important.</p>\n<p>We’re observing this process. We’re hired by the bank. They’re like, “Automate this, please. It’s so inefficient. We want to do it digital.” You have to observe what they’re doing. You’re not going to make the system do just that. You’re not building a robot to replace a person. You’re building a pure information system.</p>\n<p>What do you look for? We’re taught a lot in school, and in books, and in our workplace training, we’re trained to look for has-a relationships, order is important, quantity, whether duplicates are important, that kind of thing. We’re trained to look for that, but we’re not trained to look for these algebraic properties.</p>\n<p>I think we should be looking for them, because it’s stuff that mathematicians have spent a lot of time studying and figuring out. These things have a lot of history behind them, a lot of person years of study. They’ve identified them.</p>\n<p>They’ve identified them in the world, abstracted them, and talked about their properties independently of the thing. These are things that can be abstracted, separated from their context, and translated into our software.</p>\n<p>We should do that, because the more clues we have, the more tools we have for analyzing the thing that we are automating, the better. The more tools, the better. We need more help. We don’t want to be reinventing things every time. We should look at these algebraic properties.</p>\n<p>I’m going to recap. We write software to automate processes very often, some kind of bureaucracy, some kind of information system turned into a digital system. How is it possible that this circuit, this software is able to do the same work as a physical process?</p>\n<p>There must be something translated, something that’s preserved when we translate, and that’s the structure. We talked about a bunch of structures, relationships, arity, order, quantity, has-a relationships, is-a relationships, things like that.</p>\n<p>It’s also important to look at some things that are less commonly looked at, like idempotence, associativity, commutativity, whether there’s an identity or a zero. These are called “algebraic properties.” Mathematicians have studied these. There’s a lot of prior work on them.</p>\n<p>They give us more insights, more places to look when we’re trying to translate stuff into software.</p>\n<p>If you like this episode, you can go to lispcast.com/podcast. There, you’ll find audio, video, and text transcripts — wow, all three — of all the past episodes. You’ll also find links to subscribe and to find me on social media where you can talk to me.</p>\n<p>Ask me questions. I will throw up a podcast episode trying to answer them, giving my opinions. I am very aware that these are just opinions. I would love it if you had a differing opinion, or would like a clarification, or something like that. Love it.</p>\n<p>This has been my thought on Functional Programming. My name is Eric Normand. Thank you for listening, and rock on.</p>\n<p>The post <a rel=\"nofollow\" href=\"https://lispcast.com/why-are-algebraic-properties-important/\">Why are algebraic properties important?</a> appeared first on <a rel=\"nofollow\" href=\"https://lispcast.com\">LispCast</a>.</p>",
   :direction "ltr"},
  :updated 1572501600000,
  :entities
  [{:mentions [{:text "electrons"}],
    :id "nlp/f/entity/wd:2225",
    :salienceLevel "mention",
    :label "electron"}
   {:mentions [{:text "B-tree"}],
    :id "nlp/f/entity/wd:677051",
    :salienceLevel "mention",
    :label "B-tree"}
   {:mentions [{:text "relational database"}],
    :id "nlp/f/entity/wd:192588",
    :salienceLevel "mention",
    :label "relational database"}
   {:mentions [{:text "Postgres"}],
    :id "nlp/f/entity/wd:192490",
    :salienceLevel "mention",
    :label "PostgreSQL"}],
  :alternate
  [{:href
    "https://lispcast.com/why-are-algebraic-properties-important/",
    :type "text/html"}],
  :title "Why are algebraic properties important?",
  :author "Eric Normand",
  :published-str "Wed Oct 30 23:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16e20973dfb:fc1821a:ad5391a1",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url "https://i.ytimg.com/vi/MX4kXVyKrzc/mqdefault.jpg",
   :width 320,
   :height 180,
   :contentType "image/jpeg"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://lispcast.com/?p=2072",
  :commonTopics
  [{:score 24.374290393482767,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.71,
    :id "nlp/f/topic/867",
    :salienceLevel "mention",
    :label "fintech"}],
  :published 1572501600000,
  :fingerprint "3083e7b2",
  :canonicalUrl
  "https://lispcast.com/why-are-algebraic-properties-important/"}
 {:engagement 8,
  :unread false,
  :crawled 1572446462222,
  :content
  {:content
   "<blockquote>\n<p>Clojurists Together is an organisation run by Clojars, dedicated to funding and supporting open source software, infrastructure, and documentation that is important to the Clojure and ClojureScript community.</p>\n</blockquote>\n<p><a href=\"https://www.clojuriststogether.org\">Clojurists Together</a> was started at the tail end of 2017 and has been running now for about two years. Solita was one of the founding company members and has been a member ever since. Clojurists Together works by collecting monthly (or yearly) donations from its individual and company members. These funds are then used to support open source software development on a quarterly basis. Each quarter a few projects are chosen for funding.</p>\n<p>The current on-going funding for Q3 of 2019 (August - November) targets four projects: <a href=\"http://shadow-cljs.org/\">Shadow CLJS</a>, <a href=\"https://github.com/noprompt/meander\">Meander</a>, <a href=\"https://github.com/BetterThanTomorrow/calva\">Calva</a> and <a href=\"https://cider.mx/\">CIDER</a>. Each project gets paid $9,000 over three months. <a href=\"https://www.clojuriststogether.org/news/q3-2019-funding-announcement/\">In their funding announcement posts</a> Clojurists Together provide detailed explanations of what the projects are and what their developers aim to achieve with the funding they receive. These coupled with monthly updates from the projects (<a href=\"https://www.clojuriststogether.org/news/august-2019-monthly-update/\">August update</a>, <a href=\"https://www.clojuriststogether.org/news/september-2019-monthly-update/\">September update</a>) make it easy for the members and the wider Clojure community to see and understand what is being funded and how the work is progressing.</p>\n<p>In my opinion, Clojurists Together has done a great job selecting the projects to fund. For example, looking at the projects currently being funded, CIDER is a massively important piece of software for clojurists. Even if you aren’t using emacs with CIDER, its infrastructure in nREPL, cider-nrepl and orchard provide a better REPL and development environment for clojurists regardless of their editor of choice. This is very well visible in another currently funded project, Calva. Calva aims to provide a first-class Clojure development environment in Visual Studio Code and builds on top of all these infrastructure pieces that are powering CIDER. As Visual Studio Code is an immensely popular editor these days, providing an easy and well-working Clojure environment for it can make Clojure much more accessible to beginners.</p>\n<p>Another currently funded project, Shadow CLJS, is quickly becoming the best ClojureScript build tool out there. With current funding round going towards React Native and expo support, coupled with the existing Node.js features and npm support, it is the easiest tool for ClojureScript projects, especially when targeting something else than the browser. This makes it easy and viable to choose ClojureScript in these kinds of projects, adding to the use cases of the language.</p>\n<p>Looking back at the previously funded projects, most Clojure developers have probably used at least a couple of them at some point: <a href=\"https://github.com/dakrone/clj-http\">clj-http</a>, <a href=\"https://figwheel.org\">Figwheel</a>, and <a href=\"https://clojurescript.org\">ClojureScript</a> itself, to name a few, are fundamental building blocks of many projects and as such deserve to be funded to make their continued support viable. Funding such widely used projects also provides advantages to a large part of the Clojure community. Another funded project to highlight is <a href=\"https://cljdoc.org\">cljdoc</a>, which provides a central place for documentations of Clojure libraries.</p>\n<p>Clojurists Together just recently published <a href=\"https://www.clojuriststogether.org/news/q4-2019-survey-results/\">results of their membership survey for Q4</a>. Through this survey the members can give feedback on what kind of projects they would like to see funded in the future and also give feedback on how the program is being run. The results provide some interesting insights, so it’s worth checking out even if you are not a member.</p>\n<p>Solita has gained a lot through the use of both open source and Clojure. Clojurists Together provides us an easy way to give back to these communities and help the continued support of established tools, as well as helping new shiny things come into life. If you or your company wants to support open source, I can wholeheartedly recommend Clojurists Together as a way to do so.</p>",
   :direction "ltr"},
  :updated 1572393600000,
  :entities
  [{:mentions [{:text "open source"} {:text "open source software"}],
    :id "nlp/f/entity/wd:1130645",
    :salienceLevel "about",
    :label "open-source software"}
   {:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "about",
    :label "Clojure"}
   {:mentions [{:text "cider"}],
    :id "nlp/f/entity/wd:167296",
    :salienceLevel "mention",
    :label "cider"}
   {:mentions [{:text "Visual Studio Code"}],
    :id "nlp/f/entity/wd:19841877",
    :salienceLevel "mention",
    :label "Visual Studio Code"}
   {:mentions [{:text "REPL"}],
    :id "nlp/f/entity/wd:2032810",
    :salienceLevel "mention",
    :label "Read–eval–print loop"}],
  :alternate
  [{:href "http://dev.solita.fi/2019/10/30/clojurists_together.html",
    :type "text/html"}],
  :title
  "Supporting Open Source Clojure Software Through Clojurists Together",
  :author "Solita Oy",
  :published-str "Tue Oct 29 17:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16e1d1ce10e:ff0b604:97b0c8f7",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url
   "https://dev.solita.fi/img/solita-logomark-white-on-red-400px.png",
   :width 400,
   :height 400,
   :contentType "image/png"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "http://dev.solita.fi/2019/10/30/clojurists_together",
  :commonTopics
  [{:score 49.87506975867426,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.897,
    :id "nlp/f/topic/750",
    :salienceLevel "about",
    :label "electronics"}
   {:score 0.855,
    :id "nlp/f/topic/774",
    :salienceLevel "about",
    :label "engineering"}],
  :published 1572393600000,
  :fingerprint "c441107d",
  :canonicalUrl
  "http://dev.solita.fi/2019/10/30/clojurists_together.html"}
 {:engagement 7,
  :unread false,
  :crawled 1572433811456,
  :content
  {:content
   "<p>How to use <code>spec</code> for form validation and return human understandable errors? Should you at all?</p>\n<p>(this article is also a solution for <code>clojure.spec</code> on backend when you need to return human readable errors for invalid values)</p>",
   :direction "ltr"},
  :updated 1572307200000,
  :alternate
  [{:href "https://clojure.wladyka.eu/posts/form-validation/",
    :type "text/html"}],
  :title "How to validate form in ClojureScript using spec?",
  :author "Krzysztof Wladyka",
  :published-str "Mon Oct 28 17:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16e1c5bd800:ff89c4a:69b9f616",
  :visual {:url "none"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://clojure.wladyka.eu/posts/form-validation/",
  :published 1572307200000,
  :fingerprint "13819262",
  :canonicalUrl "https://clojure.wladyka.eu/posts/form-validation/"}
 {:engagement 5,
  :unread false,
  :crawled 1572405717199,
  :content
  {:content
   "<p>My <a href=\"https://betweentwoparens.com/deoploy-clojurescript-to-github-pages\">first blog post</a> outlined how to deploy a static ClojureScript website to Github Pages. This is an excellent choice for personal websites, or an open source project's documentation because you get free hosting infrastructure with relatively little effort. Having said this, what happens if you can't use static hosting providers like Github Pages or <a href=\"https://www.netlify.com/\">Netlify</a>? What if you need to control more of the hosting service? This post will show you how to deploy your ClojureScript site on a webserver you control. Specifically, we will cover the following topics:</p>\n<ul>\n<li><a href=\"https://betweentwoparens.com/rss.xml#the-deploy-process\">The Deploy Process</a></li>\n<li><a href=\"https://betweentwoparens.com/housekeeping\">Housekeeping</a></li>\n<li><a href=\"https://betweentwoparens.com/rss.xml#create-app\">Create App</a></li>\n<li><a href=\"https://betweentwoparens.com/rss.xml#sanity-check-webserver\">Sanity Check Webserver</a></li>\n<li><a href=\"https://betweentwoparens.com/rss.xml#build-production-artifacts\">Build Production Artifacts</a></li>\n<li><a href=\"https://betweentwoparens.com/rss.xml#move-production-artifacts-to-webserver\">Move Production Artifacts to Webserver</a></li>\n<li><a href=\"https://betweentwoparens.com/rss.xml#teach-webserver-to-serve-artifacts\">Teach Webserver to Serve Artifacts</a></li>\n<li><a href=\"https://betweentwoparens.com/rss.xml#automate-process\">Automate Process</a></li>\n</ul>\n<p>By the time we are finished I hope to have clarified the general steps involved in hosting your own ClojureScript app (<strong>spoiler:</strong> it's the same as hosting a JavaScript app).</p>\n<aside>Beyond creating a simple ClojureScript app, this post is not really about ClojureScript. I see it's role as clearing up the process of deploying a static site. Specifically, we will focus on deploying ClojureScript to a webserver (<a rel=\"noopener noreferrer\" href=\"https://www.nginx.com/\" target=\"_blank\">Nginx</a>). If you are following along, you can see the <a rel=\"noopener noreferrer\" href=\"https://github.com/tkjone/demo-clojurescript-nginx\" target=\"_blank\">source code here</a>.</aside>\n<h2><a href=\"https://betweentwoparens.com/rss.xml#the-deploy-process\"></a>The Deploy Process</h2>\n<p>In order to make our site available to the internet we need a <code>physical webserver</code> and <code>software webserver</code>. Once we have these, we just have to:</p>\n<ol>\n<li>Store your website's artifacts (<code>html</code>, <code>css</code> and <code>js</code>) on a <code>physical server</code></li>\n<li>Teach your <code>software webserver</code> where those files live</li>\n</ol>\n<p>In order to do the above, we need to perform the following steps:</p>\n<ol>\n<li>Build your website's production artifacts</li>\n<li>Move your website's production artifacts to a <code>physical webserver</code></li>\n<li>Configure your <code>software webserver</code> to deliver your website's artifacts to users</li>\n</ol>\n<p>These steps are the same whether you are writing <code>JavaScript</code>, <code>ClojureScript</code>, <code>Reason</code> or any other web ready language.</p>\n<p>In order to illustrate the deploy process we are going to:</p>\n<ol>\n<li>use the computer you are on right now as your <code>physical server</code></li>\n<li>use <a href=\"https://www.nginx.com/\">Nginx</a> as our <code>software server</code></li>\n<li>use <code>ClojureScript</code> for our static website</li>\n<li>use <a href=\"https://www.docker.com/\">docker</a> to make the deploy consistent and predictable</li>\n</ol>\n<aside>We are using <code>Nginx</code> because as far as webservers go it's easy to setup, configure and find documentation for. Finally, because it's ready to use you can use this solution in your workplace today to quickly deploy static documentation or a prototype app.</aside>\n<h2><a href=\"https://betweentwoparens.com/rss.xml#housekeeping\"></a>Housekeeping</h2>\n<p>If you are going to follow along with this post please make sure you have the following tools installed:</p>\n<ul>\n<li>Install <a href=\"https://docs.docker.com/v17.09/engine/installation/\">Docker</a><a href=\"https://betweentwoparens.com/rss.xml#why-docker\"></a></li>\n<li>Install <a href=\"https://clojurescript.org/guides/quick-start\">Clojure</a></li>\n</ul>\n<h2><a href=\"https://betweentwoparens.com/rss.xml#create-app\"></a>Create App</h2>\n<aside>This whole process starts with a ClojureScript app. If you already have an app you can skip this part. If you don't have an app, please follow along with this section and we will set you up with your very own ClojureScript app.</aside>\n<p>We will create our ClojureScript app using <a href=\"https://github.com/tkjone/create-reagent-app\">Create Reagent App</a>. This is a tool which automatically builds a modern ClojureScript/Reagent (READ: React) app for us. All you need to do is move to a directory where you want your project to live and run the following command:</p>\n<div><pre><code>clj -Sdeps <span>'{:deps\n{seancorfield/clj-new {:mvn/version &quot;0.7.7&quot;}}}'</span> <span>\\</span>\n  -m clj-new.create <span>\\</span>\n  https://github.com/tkjone/create-reagent-app@4444cb8d4192bbfc6ba1304381c62fe3aa46ea17 <span>\\</span>\n  demo-clojurescript-nginx/demo-clojurescript-nginx</code></pre></div>\n<p>Once the above is complete you should have a project that looks like this:</p>\n<div><pre><code><span>.</span>\n├── README.md\n├── deps.edn\n├── dev.cljs.edn\n├── resources\n│   └── public\n│       ├── index.html\n│       └── style.css\n├── src\n│   └── demo_clojurescript_nginx\n│       └── demo_clojurescript_nginx.cljs\n└── <span>test</span>\n    └── demo_clojurescript_nginx\n        └── demo_clojurescript_nginx_test.cljs</code></pre></div>\n<aside>This app comes with commands for running the app in <code>dev</code> and building a <code>production</code> version of the app. The commands are <code>clj -A:dev</code> and <code>clj -A:prod</code> respectively. Feel free to play with the app.</aside>\n<h2><a href=\"https://betweentwoparens.com/rss.xml#sanity-check-webserver\"></a>Sanity Check Webserver</h2>\n<p>In this section, I want to spend some time making sure the lightbulbs are working before we decorate the tree. We are going to verify that we can use docker to pull and run an <code>Nginx</code> container locally. To begin, <code>pull</code> an nginx docker image into your local filesystem:</p>\n<div><pre><code>docker pull nginx</code></pre></div>\n<p>We can verify that the image was successfully pulled in by running the following command</p>\n<div><pre><code>docker images</code></pre></div>\n<p>and if all went well we should see an <code>Nginx</code> image in your local filesystem like:</p>\n<div><pre><code>REPOSITORY  TAG    IMAGE ID     CREATED     SIZE\nnginx       latest 540a289bab6c <span>3</span> days ago  126MB</code></pre></div>\n<p>If that went well, we can try to run our nginx docker container</p>\n<div><pre><code>docker run --name demo-clojurescript-nginx -p <span>80</span>:80 -d nginx</code></pre></div>\n<p>and once again we will verify that the container is running</p>\n<div><pre><code>docker <span>ps</span> -a</code></pre></div>\n<p>and you should see something like</p>\n<div><pre><code>CONTAINER ID  IMAGE  COMMAND                  CREATED        STATUS\n9118c08ed0a6  nginx  <span>&quot;nginx -g 'daemon of…&quot;</span>   <span>6</span> seconds ago  Up <span>4</span> seconds</code></pre></div>\n<p>and now you should be able to visit your docker container at <code>http://localhost:80</code>. This step was like checking that the all the lightbulbs work before you hang them on the tree. With this, we can go on to the meat and potatoes of the excercise. Before continuing on, be sure to stop your <code>Nginx</code> docker container:</p>\n<p>If this worked, we are ready to deploy our site <code>Nginx</code>. What we are going to do is start by manually deploying our app so we can understand the manual steps and then automate things using <code>docker</code> (because we're lazy boys).</p>\n<p>Before we continue, make sure you stop your <code>Nginx</code> docker container and remove it like so:</p>\n<div><pre><code>docker stop demo-clojurescript-nginx <span>\\</span>\n<span>&amp;&amp;</span> docker <span>rm</span> demo-clojurescript-nginx</code></pre></div>\n<p>and let's start it again except this time we will start it on port <code>4001</code>.</p>\n<div><pre><code>docker run --name demo-clojurescript-nginx -p <span>4001</span>:4001 -d nginx</code></pre></div>\n<h2><a href=\"https://betweentwoparens.com/rss.xml#build-production-artifacts\"></a>Build Production Artifacts</h2>\n<p>This section is about building production artifacts. To clear things up, when I say <code>artifact</code> I mean the code that will be run by our webserver. In the case of a web development project, the <code>artifact</code> will be the minified and dead code eliminated JavaScript produced by the ClojureScript compiler.</p>\n<p>To create this artifact we have to tell the ClojureScript compiler to build it for us. We do this with the following command:</p>\n<div><pre><code>clojure -A:prod</code></pre></div>\n<p>After the above command is run we can verify that we have a production <code>artifact</code> by looking into the <code>out</code> directory and finding a file called <code>dev-main.js</code></p>\n<div><pre><code>out\n├── cljs\n│   ├── core\n│   ├── core.cljs\n│   └── core.js\n├── dev-main.js\n<span>..</span>.more stuff</code></pre></div>\n<p>If that has worked, we can move to the next step: putting our production artifacts on the <code>physical webserver</code> (docker container).</p>\n<h2><a href=\"https://betweentwoparens.com/rss.xml#move-production-artifacts-to-webserver\"></a>Move Production Artifacts to Webserver</h2>\n<p>This step is about creating a place for our production artifacts to live. To do this, we are going to manually go inside our nginx container and create the folder structure.</p>\n<div><pre><code>docker <span>exec</span> -it demo-clojurescript-nginx <span>bash</span></code></pre></div>\n<p>and how create the folder like this:</p>\n<div><pre><code><span>mkdir</span> -p var/www/app/cljs-out</code></pre></div>\n<p>and then exit the docker container. From here we can move the production artifacts from our local machine to the docker container.</p>\n<div><pre><code><span># move the js artifact</span>\ndocker <span>cp</span> out/dev-main.js demo-clojurescript-nginx:var/www/app/cljs-out/\n<span># move the css artifact</span>\ndocker <span>cp</span> resources/public/style.css demo-clojurescript-nginx:var/www/app/style.css\n<span># move the html artifact</span>\ndocker <span>cp</span> resources/public/index.html demo-clojurescript-nginx:var/www/app/index.html</code></pre></div>\n<p>From here, we just have to teach our webserver how to serve these files.</p>\n<h2><a href=\"https://betweentwoparens.com/rss.xml#teach-webserver-to-serve-artifacts\"></a>Teach Webserver to Serve Artifacts</h2>\n<p>At this point we just have to configure our <code>Nginx</code> server to know where our production artifacts live. To do this, we have to remove the default <code>Nginx</code> configuration file and replace it with a new one.</p>\n<p>Start by execing into the <code>Nginx</code> docker container:</p>\n<div><pre><code>docker <span>exec</span> -it demo-clojurescript-nginx <span>bash</span></code></pre></div>\n<p>Remove the old configuration file:</p>\n<div><pre><code><span>rm</span> /etc/nginx/nginx.conf</code></pre></div>\n<p>Then exit out of the docker container. At this point, we want to create a custom configuration file called <code>nginx.conf</code>. This configuration file will live in the root of our ClojureScript app in a folder structure like <code>tools/nginx/nginx.conf</code> inside the root of our <code>demo-clojurescript-nginx</code> ClojureScript app. So go ahead and create the folder structure:</p>\n<div><pre><code><span>mkdir</span> -p tools/nginx <span>&amp;&amp;</span> <span>touch</span> tools/nginx/nginx.conf</code></pre></div>\n<p>and then you can open <code>nginx.conf</code> and make it look like this:</p>\n<div><pre><code>events <span>{</span><span>}</span>\n\nhttp <span>{</span>\n\n  include mime.types<span>;</span>\n\n  <span>gzip</span> on<span>;</span>\n  server_tokens off<span>;</span>\n\n  server <span>{</span>\n    listen <span>4001</span><span>;</span>\n    root /var/www/app<span>;</span>\n  <span>}</span>\n<span>}</span></code></pre></div>\n<p>Now we want give this <code>nginx.conf</code> file to our <code>Nginx</code> container so it knows how and where to serve our project from. To do this, run the following command:</p>\n<div><pre><code>docker <span>cp</span> tools/nginx/nginx.conf demo-clojurescript-nginx:etc/nginx/nginx.conf</code></pre></div>\n<p>at this point we want to stop our docker container so the configuration file takes effect</p>\n<div><pre><code>docker stop demo-clojurescript-nginx</code></pre></div>\n<p>and then we can start the container again.</p>\n<div><pre><code>docker start demo-clojurescript-nginx</code></pre></div>\n<p>Now we should be able to visit our site at <code>http://localhost:4001</code> and see the following:</p>\n<p><span>\n<span></span>\n<img alt=\"demo clojurescript nginx\" title=\"demo clojurescript nginx\" src=\"https://betweentwoparens.com/static/242200797c1bbc2aa8624eb65d62f1f7/b9e4f/005-demo-clojurescript-nginx-final.png\">\n</span></p>\n<h2><a href=\"https://betweentwoparens.com/rss.xml#automate-process\"></a>Automate Process</h2>\n<p>You may have noticed, but the above process is a manualy process. The point was to show you exactly what the process looks like if you have to manually run it. Now though, we want to show the automated flow using docker.</p>\n<h3><a href=\"https://betweentwoparens.com/rss.xml#automate-prod-artifact-builds\"></a>Automate Prod Artifact Builds</h3>\n<p>Go into the <code>tools/nginx</code> directory and create a file called <code>Dockerfile.build</code> and make it look like this:</p>\n<div><pre><code><span># base image</span>\n<span>FROM</span> clojure<span>:</span>openjdk<span>-</span>11<span>-</span>tools<span>-</span>deps<span>-</span>slim<span>-</span>buster\n\n<span># create dir for our app to live in</span>\n<span>WORKDIR</span> /app\n\n<span># copy the app from our local filesystem to the docker container app dir</span>\n<span>COPY</span> . /app\n\n<span># build our prod clojurescript artifact</span>\n<span>RUN</span> clojure <span>-</span>A<span>:</span>prod\n\n<span># The end. No need for a CMD to be specified because this is a build</span>\n<span># docker containers</span></code></pre></div>\n<aside>In the above the goal is really to keep everything as light as possible. We just want <code>Java</code> so we can build our project and if you have to build anything with <code>node</code> you will have to also add that to the docker container. Stuff you might do with node? Build your style sheets? Run tests in a headless environment? etc. It's going to download eveything and then run the container.</aside>\n<p>A few things to note:</p>\n<ul>\n<li>we use <code>clojure</code> rather than <code>clj</code> as <code>clj</code> include <code>rlwrap</code>, but they are the same for our purposes.</li>\n<li>when you run this container you want to run it from the root of the app</li>\n<li>will copy everything in the root project to a generically name folder called <code>app</code></li>\n</ul>\n<p>This docker file is responsible for building our artifacts that we performed in step 2 earlier. Now lets go ahead and move to the root of our project and run that dockerfile and see if everything works:</p>\n<div><pre><code>docker build -t <span>\\</span>\n             demo-clojurescript-nginx/build:0.0.0 <span>\\</span>\n             -f <span>&quot;tools/nginx/Dockerfile.build&quot;</span> <span>.</span></code></pre></div>\n<p>The above is going to build our image and the production clojurescript object. The next step is to run a container based off the above image so that we can get the production artifacts</p>\n<div><pre><code>docker run -d <span>\\</span>\n           --name demo-clojurescript-nginx-build <span>\\</span>\n           demo-clojurescript-nginx/build:0.0.0 <span>\\</span>\n           <span>sleep</span> <span>20000</span></code></pre></div>\n<aside>If you curious about the content of your docker build container you can exec into it like this <code>docker exec -it demo-clojurescript-nginx-build bash</code>.</aside>\n<h3><a href=\"https://betweentwoparens.com/rss.xml#move-production-artifacts-to-local-filesystem\"></a>Move Production Artifacts to Local FileSystem</h3>\n<p>At this point, we want to copy the built files from the docker container to our local machine. If this were running in a CI/CD process we would have a special spot in the CI/CD environment for these temporary files. Because this is our local system, we have to create a temporary place for these things to live. Lets call this place <code>temp/cljs-out</code> and we will create it in the root of our <code>demo-clojurescript-nginx</code> repo.</p>\n<div><pre><code><span>mkdir</span> -p temp/cljs-out</code></pre></div>\n<p>from here we can grab the files from our <code>Dockerfile.build</code> container and move them to our temp dir like this:</p>\n<div><pre><code>docker <span>cp</span> demo-clojurescript-nginx-build:app/resources/public/index.html ./temp/index.html\ndocker <span>cp</span> demo-clojurescript-nginx-build:app/resources/public/style.css ./temp/style.css\ndocker <span>cp</span> demo-clojurescript-nginx-build:app/out/dev-main.js ./temp/cljs-out/dev-main.js</code></pre></div>\n<aside>Note that if you are running in CI/CD tool like circleci or travis or anything really the whole manual copy things over step does not have to be done because there is a temporary file system there where you can store things. In our case, we are setting this up to run locally so we will create a holding place in our repo which will act as this temporary file system.</aside>\n<h3><a href=\"https://betweentwoparens.com/rss.xml#automate-nginx-configuration\"></a>Automate Nginx Configuration</h3>\n<p>The next step is automate step 3 from above: nginx configuration and moving the artifacts from the above to the nginx container. To do this, we need to build our own nginx container which is going to be the docker container you would actually run. SO go ahead and create another docker container inside of <code>tools/nginx</code> called <code>Dockerfile</code> which looks like this:</p>\n<div><pre><code><span># base image</span>\nFROM nginx:1.17.5\n\n<span># remove the default nginx configuration</span>\nRUN <span>rm</span> /etc/nginx/nginx.conf\n\n<span># add custom nginx configuration</span>\nCOPY ./tools/nginx/nginx.conf /etc/nginx\n\n<span># allow nginx conf to be executable</span>\nRUN <span>cd</span> /etc/nginx <span>\\</span>\n    <span>&amp;&amp;</span> <span>chmod</span> +x /etc/nginx/nginx.conf\n\n<span># create working directory</span>\nWORKDIR /var/www/app\n\n<span># copy our temp artifacts</span>\nCOPY ./temp /var/www/app\n\n<span># start nginx container</span>\nCMD /bin/bash -c <span>&quot;nginx -g 'daemon off;'&quot;</span></code></pre></div>\n<p>now build the image</p>\n<div><pre><code>docker build -t <span>\\</span>\n             demo-clojurescript-nginx/prod:0.0.0 <span>\\</span>\n             -f <span>&quot;tools/nginx/Dockerfile&quot;</span> <span>.</span></code></pre></div>\n<p>and before we run our final image stop any instances of <code>Nginx</code> docker containers you may still have running on port <code>4001</code>. e.g.</p>\n<div><pre><code>docker stop demo-clojurescript-nginx\ndocker stop demo-clojurescript-nginx-build</code></pre></div>\n<p>and now we should be able to run our <code>Nginx</code> container</p>\n<div><pre><code>docker run -d <span>\\</span>\n           -p <span>4001</span>:4001 <span>\\</span>\n           --name demo-clojurescript-nginx-prod <span>\\</span>\n           demo-clojurescript-nginx/prod:0.0.0</code></pre></div>\n<p>Now we should be able to visit <code>http://localhost:4001</code> and we should be able to see</p>\n<p><span>\n<span></span>\n<img alt=\"demo clojurescript nginx\" title=\"demo clojurescript nginx\" src=\"https://betweentwoparens.com/static/242200797c1bbc2aa8624eb65d62f1f7/b9e4f/005-demo-clojurescript-nginx-final.png\">\n</span></p>\n<h2><a href=\"https://betweentwoparens.com/rss.xml#conclusion\"></a>Conclusion</h2>\n<p>And with that we have successfully deployed our ClojureScript app to our own <code>Nginx</code> webserver. At this point, the next step is to deploy this on a server. Unfortunatley, that is out of the scope of this post, but if you are using a service like <a href=\"https://aws.amazon.com/\">AWS</a> or <a href=\"https://cloud.google.com/\">Google Cloud Platform</a> they should have some awesome guides for deploying Nginx on their infrastructure.</p>\n<p>Again, my hope is to outline a piece of the process. Let me know if this helped!</p>\n<h2><a href=\"https://betweentwoparens.com/rss.xml#footnotes\"></a>Footnotes</h2>\n<aside>\n<h3>Footnotes</h3>\n<ol>\n<li>\nThe reason I am using docker is because I want to reach as many OS's as I can and I feel that docker is pretty standard. If I did not use docker, I would just write this with shell scripts because this work is straightforward and does not require much more than that, but perhaps it would be fun to write a CLJS node script in the future to show what that would look like.\n<a href=\"https://betweentwoparens.com/rss.xml#why-docker-ref\">↩</a>\n</li>\n</ol>\n</aside>",
   :direction "ltr"},
  :updated 1572307200000,
  :entities
  [{:mentions [{:text "nginx"}],
    :id "nlp/f/entity/wd:306144",
    :salienceLevel "about",
    :label "nginx"}
   {:mentions [{:text "src"} {:text "source code"} {:text "source"}],
    :id "nlp/f/entity/wd:128751",
    :salienceLevel "mention",
    :label "source code"}
   {:mentions [{:text "JavaScript"}],
    :id "nlp/f/entity/wd:2005",
    :salienceLevel "mention",
    :label "JavaScript"}
   {:mentions [{:text "configuration file"}],
    :id "nlp/f/entity/wd:1571814",
    :salienceLevel "mention",
    :label "configuration file"}
   {:mentions [{:text "Netlify"}],
    :id "nlp/f/entity/wd:56102498",
    :salienceLevel "mention",
    :label "Netlify"}],
  :alternate
  [{:href "https://betweentwoparens.com/deploy-clojurescript-on-nginx",
    :type "text/html"}],
  :title "Deploy ClojureScript on Nginx",
  :author "Between Two Parens",
  :published-str "Mon Oct 28 17:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16e1aaf28cf:fb887e2:97b0c8f7",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url
   "https://betweentwoparens.com/static/242200797c1bbc2aa8624eb65d62f1f7/b9e4f/005-demo-clojurescript-nginx-final.png",
   :width 590,
   :height 338,
   :contentType "image/png"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://betweentwoparens.com/deploy-clojurescript-on-nginx",
  :commonTopics
  [{:score 85.37468289787887,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.782,
    :id "nlp/f/topic/651",
    :salienceLevel "mention",
    :label "devops"}],
  :published 1572307200000,
  :fingerprint "a36673bf",
  :canonicalUrl
  "https://betweentwoparens.com/deploy-clojurescript-on-nginx"}
 {:unread false,
  :crawled 1572371056010,
  :content
  {:content
   "<a rel=\"nofollow\" href=\"https://www.sitepoint.com/what-is-functional-programming/\" title=\"What Is Functional Programming?\"><img src=\"https://dab1nmslvvntp.cloudfront.net/wp-content/uploads/2019/10/1572313041web-coding.jpg\" alt=\"\" width=\"2000\" class=\"webfeedsFeaturedVisual wp-post-image\" height=\"1333\"></a><p>As a programmer, you probably want to write elegant, maintainable, scalable, predictable code. The principles of functional programming, or FP, can significantly aid in these goals.</p>\n<p>Functional programming is a paradigm, or style, that values immutability, first-class functions, referential transparency, and pure functions. If none of those words makes sense to you, don't worry! We're going to break down all this terminology in this article.</p>\n<p>Functional programming evolved from lambda calculus, a mathematical system built around function abstraction and generalization. As a result, a lot of functional programming languages look very mathematical. Good news, though: you don't need to use a functional programming language to bring functional programming principles to your code. In this post, we'll use JavaScript, which has a lot of features that make it amenable to functional programming while not being tied to that paradigm.</p>\n<h2>The Core Principles of Functional Programming</h2>\n<p>Now that we've discussed what functional programming is, let's talk about the core principles behind FP.</p>\n<p>The post <a rel=\"nofollow\" href=\"https://www.sitepoint.com/what-is-functional-programming/\">What Is Functional Programming?</a> appeared first on <a rel=\"nofollow\" href=\"https://www.sitepoint.com\">SitePoint</a>.</p>",
   :direction "ltr"},
  :updated 1572368438000,
  :entities
  [{:mentions [{:text "functional programming"}],
    :id "nlp/f/entity/wd:193076",
    :salienceLevel "about",
    :label "functional programming"}
   {:mentions [{:text "referential transparency"}],
    :id "nlp/f/entity/wd:1754278",
    :salienceLevel "mention",
    :label "referential transparency"}
   {:mentions [{:text "lambda calculus"}],
    :id "nlp/f/entity/wd:242028",
    :salienceLevel "mention",
    :label "lambda calculus"}
   {:mentions [{:text "JavaScript"}],
    :id "nlp/f/entity/wd:2005",
    :salienceLevel "mention",
    :label "JavaScript"}
   {:mentions [{:text "SitePoint"}],
    :id "nlp/f/entity/wd:7531746",
    :salienceLevel "mention",
    :label "SitePoint"}],
  :alternate
  [{:href
    "https://www.sitepoint.com/what-is-functional-programming/?utm_source=rss",
    :type "text/html"}],
  :title "What Is Functional Programming?",
  :author "Ali Spittel",
  :published-str "Tue Oct 29 10:00:38 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16e189e458a:fa5e6f1:69b9f616",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url
   "https://dab1nmslvvntp.cloudfront.net/wp-content/uploads/2019/10/1572313041web-coding.jpg",
   :width 2000,
   :height 1333,
   :contentType "image/jpeg"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://www.sitepoint.com/?p=174008",
  :commonTopics
  [{:score 95.88281132624856,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1572368438000,
  :fingerprint "61226fd2",
  :canonicalUrl
  "https://www.sitepoint.com/what-is-functional-programming/?utm_source=rss"}
 {:engagement 11,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1572364782780,
  :content
  {:content
   "<p>I still remember the time I spiked my first application in a functional language—it was Autumn 2018,\nI had come to 8th Light to start my journey as a crafter, and I didn't even know what really made a\nfunctional language functional. Today, nearly one year later, I'm pretty confident it's my favourite\nparadigm. In this blog post my intention is to share this little part of my journey, and the different\nthings I learnt during it. Hopefully it may be of use to people who choose to start a journey like mine.</p>\n<h2>It isn't always love at first sight</h2>\n<p>The first time I developed something in a functional language, I built a bot for Telegram in Clojure. That\nwas the birth of Londibot—a bot that would ping me every time the Victoria line had a disruption.\nMy mentor at that time gave me freedom to pick the project, and I thought it would be more fun to develop\nsomething that I could afterward put to good use, in this case for my commute. The\nlanguage, though, he picked.</p>\n<p>Dear reader, I'm not sure if you've ever tried any LISP dialect, but if you, like me, come from an\nObject-Oriented world, the learning curve can get very steep. I remember trying to figure out how to loop over\nlists to change the elements, trying to filter dictionaries... It's very different than what we're used to.\nThe first things I got acquainted with that really paid off were the classic <code>filter</code>, <code>map</code>, and <code>reduce</code>;\nthen came recursion to achieve loops, and many others. It was actually by learning these tools and giving\nthem enough time to sink in that I started to understand the real difference between imperative and declarative code,\nand how the functional paradigm usually tends to favour more that declarative style. I could just say that learning a\nfunctional language and its idioms truly changed my perspective of how to solve problems and, ultimately, of how to\nexpress those solutions.</p>\n<p>To summarize my first impressions, both the amount of parentheses that Clojure brought to the table (or any\nLISP dialect for that sake), and the amount of new concepts I had to learn, made it very overwhelming. It took me\nnearly a month until I started to enjoy the language a little bit more. The good thing is that at the end,\nit does pay off.</p>\n<h2>Keeping functions pure is crucial</h2>\n<p>One of the first mistakes I made early on in the project was not respecting the purity of the functions.\nIn most OO languages, it is standard practice to create classes that are then instantiated into objects,\nwhich we then modify on demand. Say for example that you were to create a car parking app.\nYou would probably think of the car park like the following:</p>\n<div><pre><code><span></span><span>var</span> <span>carPark</span> <span>=</span> <span>new</span> <span>CarPark</span><span>();</span>\n<span>var</span> <span>porsche</span> <span>=</span> <span>new</span> <span>Car</span><span>(</span><span>&quot;Porsche&quot;</span><span>);</span>\n\n<span>carPark</span><span>.</span><span>open</span><span>();</span>\n<span>carPark</span><span>.</span><span>park</span><span>(</span><span>porsche</span><span>);</span>\n<span>carPark</span><span>.</span><span>unpark</span><span>(</span><span>porsche</span><span>);</span>\n<span>carPark</span><span>.</span><span>close</span><span>();</span>\n</code></pre></div>\n<p>The <em>problem</em> with the above is that all state is saved within our <code>CarPark</code> instance, and as we park or\nunpark cars, that instance is modified. That's called a side effect. A side effect is any operation that\nhappens within a function that is collateral. Imagine a <code>sum</code> function that, apart from summing two\nnumbers and returning the result, also saved it to a database. The saving to the database is a side-effect.</p>\n<p>I'm aware that I still haven't explained the concept of purity, but I wanted to talk about side-effects\nfirst because it greatly helps illuminate purity. In a nutshell, <em>a function is pure when, for a same input,\nit always has the same output and never has any side effects</em>. Printing a value to the log or simply changing\nsome mutable state within the application makes our function impure.</p>\n<p>You might be wondering: <em>why is purity such a big deal though?</em>. Purity makes our functions little sandboxes.\nIt is by making pure functions that we can feel safe that when they change something it will only affect the\ncontext within the actual function. And this brings us to immutability. As we make our functions pure, that means\nthat they only work with the parameters we provided them with AND they don't mutate them, but return a result\nbased on a copy of those parameters.</p>\n<p>Now, that may sound confusing, but let's say that we rewrote the above code to look something like this:</p>\n<div><pre><code><span></span><span>import</span> <span>java.util.ArrayList</span><span>;</span>\n<span>import</span> <span>java.util.List</span><span>;</span>\n\n<span>public</span> <span>class</span> <span>CarPark</span> <span>{</span>\n    <span>private</span> <span>String</span> <span>status</span><span>;</span>\n    <span>private</span> <span>List</span><span>&lt;</span><span>String</span><span>></span> <span>cars</span><span>;</span>\n\n    <span>public</span> <span>CarPark</span><span>()</span> <span>{</span>\n        <span>status</span> <span>=</span> <span>&quot;Closed&quot;</span><span>;</span>\n        <span>cars</span> <span>=</span> <span>new</span> <span>ArrayList</span><span>&lt;>();</span>\n    <span>}</span>\n\n    <span>public</span> <span>CarPark</span><span>(</span><span>String</span> <span>status</span><span>,</span> <span>List</span><span>&lt;</span><span>String</span><span>></span> <span>cars</span><span>)</span> <span>{</span>\n        <span>this</span><span>.</span><span>status</span> <span>=</span> <span>status</span><span>;</span>\n        <span>this</span><span>.</span><span>cars</span> <span>=</span> <span>cars</span><span>;</span>\n    <span>}</span>\n\n    <span>public</span> <span>CarPark</span> <span>open</span><span>()</span> <span>{</span>\n        <span>return</span> <span>new</span> <span>CarPark</span><span>(</span><span>&quot;Open&quot;</span><span>,</span> <span>this</span><span>.</span><span>cars</span><span>);</span>\n    <span>}</span>\n\n    <span>public</span> <span>CarPark</span> <span>close</span><span>()</span> <span>{</span>\n        <span>return</span> <span>new</span> <span>CarPark</span><span>(</span><span>&quot;Closed&quot;</span><span>,</span> <span>this</span><span>.</span><span>cars</span><span>);</span>\n    <span>}</span>\n\n    <span>public</span> <span>CarPark</span> <span>park</span><span>(</span><span>String</span> <span>car</span><span>)</span> <span>{</span>\n        <span>List</span><span>&lt;</span><span>String</span><span>></span> <span>newList</span> <span>=</span> <span>new</span> <span>ArrayList</span><span>&lt;>(</span><span>List</span><span>.</span><span>copyOf</span><span>(</span><span>this</span><span>.</span><span>cars</span><span>));</span>\n        <span>newList</span><span>.</span><span>add</span><span>(</span><span>car</span><span>);</span>\n        <span>return</span> <span>new</span> <span>CarPark</span><span>(</span><span>this</span><span>.</span><span>status</span><span>,</span> <span>newList</span><span>);</span>\n    <span>}</span>\n\n    <span>public</span> <span>CarPark</span> <span>unpark</span><span>(</span><span>String</span> <span>car</span><span>)</span> <span>{</span>\n        <span>List</span><span>&lt;</span><span>String</span><span>></span> <span>newList</span> <span>=</span> <span>new</span> <span>ArrayList</span><span>&lt;>(</span><span>List</span><span>.</span><span>copyOf</span><span>(</span><span>this</span><span>.</span><span>cars</span><span>));</span>\n        <span>newList</span><span>.</span><span>remove</span><span>(</span><span>car</span><span>);</span>\n        <span>return</span> <span>new</span> <span>CarPark</span><span>(</span><span>this</span><span>.</span><span>status</span><span>,</span> <span>newList</span><span>);</span>\n    <span>}</span>\n<span>}</span>\n</code></pre></div>\n<p>Which when used would look like:</p>\n<div><pre><code><span></span><span>CarPark</span> <span>park</span> <span>=</span> <span>new</span> <span>CarPark</span><span>();</span>\n<span>CarPark</span> <span>openPark</span> <span>=</span> <span>park</span><span>.</span><span>open</span><span>();</span>\n<span>CarPark</span> <span>parkWithPorsche</span> <span>=</span> <span>openPark</span><span>.</span><span>park</span><span>(</span><span>&quot;Porsche&quot;</span><span>);</span>\n<span>CarPark</span> <span>parkWithoutPorsche</span> <span>=</span> <span>openPark</span><span>.</span><span>unpark</span><span>(</span><span>&quot;Porsche&quot;</span><span>);</span>\n<span>CarPark</span> <span>finalPark</span> <span>=</span> <span>parkWithoutPorsche</span><span>.</span><span>close</span><span>();</span>\n</code></pre></div>\n<p>Now, of course that is not idiomatic Java, but if we look at it closely–every time a function is executed, it\nprovides us with a brand new instance with the attributes we expect. The major advantage of this is that if,\nsay for example, another process were to run one of those methods concurrently, it would not screw up the operations\nrunning in other concurrent threads–each thread would be working with their own instances. Those functions are pure.</p>\n<p>To wrap up all that I've just mentioned above, <strong>pure functions are functions that don't create side effects and only\naffect the context within the function itself, not outside</strong>. As we keep our code pure, it is easier to test and overall\nmore predictable. Purity keeps the code simple, while impurity increases the complexity.</p>\n<p>Now, coming back to functional languages, Elixir specifically solves a lot of those problems out of the box!\nBy default, all data structures are immutable in Elixir, which means that whenever they are altered, the runtime\nwill give back a complete brand new copy of the structure. This means that if we were to implement a <code>CarPark</code> module,\nit would be:</p>\n<div><pre><code><span></span><span>CarPark</span><span>.</span><span>new</span><span>()</span> <span># Creates a new struct</span>\n<span>|></span> <span>CarPark</span><span>.</span><span>open</span><span>()</span> <span># Creates a new struct with status = open</span>\n<span>|></span> <span>CarPark</span><span>.</span><span>park</span><span>(</span><span>&quot;porsche&quot;</span><span>)</span> <span># Creates a new struct with a porsche parked</span>\n<span>|></span> <span>CarPark</span><span>.</span><span>unpark</span><span>(</span><span>&quot;porsche&quot;</span><span>)</span> <span># ...</span>\n<span>|></span> <span>CarPark</span><span>.</span><span>close</span><span>()</span> <span># ...</span>\n</code></pre></div>\n<p>The code for that would be:</p>\n<div><pre><code><span></span><span>defmodule</span> <span>CarPark</span> <span>do</span>\n  <span>defstruct</span><span>[</span><span>:status</span><span>,</span> <span>:cars</span><span>]</span>\n\n  <span>def</span> <span>new</span><span>(),</span> <span>do</span><span>:</span> <span>%</span><span>CarPark</span><span>{</span><span>status</span><span>:</span> <span>:closed</span><span>,</span> <span>cars</span><span>:</span> <span>[]}</span>\n\n  <span>def</span> <span>open</span><span>(%</span><span>CarPark</span><span>{}</span> <span>=</span> <span>park</span><span>),</span> <span>do</span><span>:</span> <span>%</span><span>CarPark</span><span>{</span><span>park</span> <span>|</span> <span>status</span><span>:</span> <span>:open</span><span>}</span>\n\n  <span>def</span> <span>closed</span><span>(%</span><span>CarPark</span><span>{}</span> <span>=</span> <span>park</span><span>),</span> <span>do</span><span>:</span> <span>%</span><span>CarPark</span><span>{</span><span>park</span> <span>|</span> <span>status</span><span>:</span> <span>:closed</span><span>}</span>\n\n  <span>def</span> <span>park</span><span>(%</span><span>CarPark</span><span>{</span><span>cars</span><span>:</span> <span>cars</span><span>}</span> <span>=</span> <span>park</span><span>,</span> <span>car_to_add</span><span>)</span> <span>do</span>\n    <span>%</span><span>CarPark</span><span>{</span><span>park</span> <span>|</span> <span>cars</span><span>:</span> <span>[</span><span>car_to_add</span> <span>|</span> <span>cars</span><span>]}</span>\n  <span>end</span>\n\n  <span>def</span> <span>unpark</span><span>(%</span><span>CarPark</span><span>{</span><span>cars</span><span>:</span> <span>cars</span><span>}</span> <span>=</span> <span>park</span><span>,</span> <span>car_to_remove</span><span>)</span> <span>do</span>\n    <span>less_cars</span> <span>=</span> <span>Enum</span><span>.</span><span>filter</span><span>(</span><span>cars</span><span>,</span> <span>fn</span> <span>car</span> <span>-></span> <span>car</span> <span>==</span> <span>car_to_remove</span> <span>end</span><span>)</span>\n    <span>%</span><span>CarPark</span><span>{</span><span>park</span> <span>|</span> <span>cars</span><span>:</span> <span>less_cars</span><span>}</span>\n  <span>end</span>\n<span>end</span>\n</code></pre></div>\n<p>Now, like I just mentioned, most functional languages, like Elixir, come with immutability out of the box, and\nthat is already a fantastic asset to help us keep purity throughout our codebase. Nonetheless, that module would\nstop being pure the moment I dump something along the lines of <code>Database.save(carpark)</code> in the functions.\nAnd if we did that, things like testing would go from being trivial to being complicated and requiring a lot\nof mental effort to keep track of the state of things.</p>\n<h2>Make functions read only horizontal or vertical</h2>\n<p>Changing to a lighter topic, I also wanted to talk about function readability. Most functional languages\ninclude some way of piping code—the pipe operator <code>|></code> in Elixir or the threading macros <code>-></code> and <code>->></code>\nin Clojure. This is a huge tool for making our code very readable, as it allows us to develop whole pipelines\nof transformations to our data in a very clean way. Say for example:</p>\n<div><pre><code><span></span><span>load</span><span>()</span>\n<span>|></span> <span>format_head</span><span>()</span>\n<span>|></span> <span>format_body</span><span>()</span>\n<span>|></span> <span>convert_to_pdf</span><span>()</span>\n<span>|></span> <span>upload</span><span>(</span><span>:google</span><span>-</span><span>drive</span><span>)</span>\n</code></pre></div>\n<p>The above piece of code is a beautiful example of how we can pipe multiple functions together, creating a highly readable function.</p>\n<p>On the other hand, if we start mixing our style...</p>\n<div><pre><code><span></span><span>{</span><span>:ok</span><span>,</span> <span>document</span><span>}</span> <span>=</span> <span>load</span><span>()</span>\n\n<span>pdf</span> <span>=</span>\n    <span>document</span>\n    <span>|></span> <span>format_head</span><span>()</span>\n    <span>|></span> <span>format_body</span><span>()</span>\n    <span>|></span> <span>convert_to_pdf</span><span>()</span>\n\n<span>upload</span><span>(</span><span>:google</span><span>-</span><span>drive</span><span>,</span> <span>pdf</span><span>)</span>\n</code></pre></div>\n<p>The above is a simple example, but try to read both functions a couple of times and think about the amount\nof effort required to follow either. They're doing the same thing, but the first requires much less cognitive effort.</p>\n<p>A good rule of the thumb is to go with either horizontal functions or vertical functions,\nand try to avoid mixing them as much as possible. There are many ways of achieving this, starting by\ntrying to keep the function heads consistent in the order of parameters. For example, always accepting\nthe struct to work with as the first parameter allows us to pipe functions much easier. Take\na look at the <code>upload/2</code> function above. By changing the order of the parameters we can either pipe it\nor not. A good example of this is the <a href=\"https://github.com/elixir-lang/elixir/blob/master/lib/elixir/lib/enum.ex\"><code>Enum</code></a>\nmodule in Elixir. Just notice that for the Enum module to be pipeable it always accepts the enum as the first parameter\nand always returns a list!</p>\n<div><pre><code><span></span><span>[</span><span>1</span><span>,</span> <span>2</span><span>,</span> <span>3</span><span>,</span> <span>4</span><span>]</span>\n<span>|></span> <span>Enum</span><span>.</span><span>reverse</span><span>()</span>\n<span>|></span> <span>Enum</span><span>.</span><span>map</span><span>(</span><span>fn</span> <span>x</span> <span>-></span> <span>x</span><span>*</span><span>x</span> <span>end</span><span>)</span>\n<span>|></span> <span>Enum</span><span>.</span><span>filter</span><span>(</span><span>fn</span> <span>-></span> <span>x</span> <span>></span> <span>5</span> <span>end</span><span>)</span>\n<span>|></span> <span>Enum</span><span>.</span><span>reduce</span><span>(</span><span>fn</span> <span>x</span><span>,</span> <span>acc</span> <span>-></span> <span>x</span> <span>+</span> <span>acc</span> <span>end</span><span>)</span> <span># returns 25</span>\n</code></pre></div>\n<p>For me, realizing this was huge. I remember when I developed my first modules with Elixir, I didn't care much\nabout the order of the parameters. After all, it's not something you worry about that much in C# or Java,\nso most of my functions tended to read horizontally with an occasional vertical bit. When I started thinking\nabout it, my thought process changed, and with it the readability of my code.</p>\n<h2>Reducers, gotta love 'em</h2>\n<p>Following up on the order of parameters, come reducers. At the end of the day <em>a reducer is simply a function\nthat accepts some data, applies some transformations to it, and returns the modified version of the data</em>. You'll\nprobably be thinking that it's what all functions do, but the highlight here is that reducers don't return the\nspecific piece of data transformed, but the whole data WITH the transformed bits.</p>\n<p>Say for example the <code>String.capitalize/1</code> function:</p>\n<div><pre><code><span></span><span>iex</span><span>></span> <span>String</span><span>.</span><span>capitalize</span><span>(</span><span>&quot;abcd&quot;</span><span>)</span>\n<span>&quot;Abcd&quot;</span>\n</code></pre></div>\n<p>It takes a string, capitalizes it, and returns the new string. When the function is applied, it gives us a new\nstring with the <code>A</code> capitalized, not just the capital <code>A</code>. A different reducer that uses structs but achieves a\nsimilar purpose could look like:</p>\n<div><pre><code><span></span><span>def</span> <span>capitalize</span><span>(%</span><span>SomeStruct</span><span>{</span><span>value</span><span>:</span> <span>value</span><span>}</span> <span>=</span> <span>s</span><span>)</span> <span>do</span>\n  <span>%</span><span>SomeStruct</span><span>{</span><span>s</span> <span>|</span> <span>value</span><span>:</span> <span>String</span><span>.</span><span>capitalize</span><span>(</span><span>s</span><span>)}</span>\n<span>end</span>\n</code></pre></div>\n<p>Instead of returning simply the new <code>value</code>, we return the complete structure, like for example <code>IO.inspect/1</code>.\nSome different reducers operating on the same structure could be:</p>\n<div><pre><code><span></span><span>def</span> <span>hash</span><span>(%</span><span>SomeStruct</span><span>{</span><span>value</span><span>:</span> <span>value</span><span>}</span> <span>=</span> <span>s</span><span>)</span> <span>do</span>\n  <span>hashed</span> <span>=</span> <span>:crypto</span><span>.</span><span>hash</span><span>(</span><span>:sha</span><span>,</span> <span>value</span><span>)</span> <span>|></span> <span>Base</span><span>.</span><span>encode16</span>\n  <span>%</span><span>SomeStruct</span><span>{</span><span>s</span> <span>|</span> <span>value</span><span>:</span> <span>hashed</span><span>}</span>\n<span>end</span>\n\n<span>def</span> <span>downcase</span><span>(%</span><span>SomeStruct</span><span>{</span><span>value</span><span>:</span> <span>value</span><span>}</span> <span>=</span> <span>s</span><span>)</span> <span>do</span>\n  <span>%</span><span>SomeStruct</span><span>{</span><span>s</span> <span>|</span> <span>value</span><span>:</span> <span>String</span><span>.</span><span>downcase</span><span>(</span><span>s</span><span>)}</span>\n<span>end</span>\n</code></pre></div>\n<p>Now, if we combine all these together, the value really sticks out. They allow us to do things like:</p>\n<div><pre><code><span></span><span>iex</span><span>></span> <span>%</span><span>SomeStruct</span><span>{</span><span>value</span><span>:</span> <span>&quot;javier&quot;</span><span>}</span>\n     <span>|></span> <span>capitalize</span><span>()</span>\n     <span>|></span> <span>hash</span><span>()</span>\n     <span>|></span> <span>downcase</span><span>()</span>\n\n<span>%</span><span>SomeStruct</span><span>{</span><span>value</span><span>:</span> <span>&quot;7f3d0970ec0e336aa08a9e14d4d88e79131e0065&quot;</span><span>}</span>\n</code></pre></div>\n<p>That, my friends, is the magic of reducers. By applying transformations to our data structures and always\nmaking sure we return that same data structure, we can endlessly pipe our reducers, thus achieving the vertical\nfunctions we spoke about earlier.</p>\n<p>Having the core business logic of our application modeled with reducers, as long as it makes sense, also\nmakes it very easy to test:</p>\n<div><pre><code><span></span><span>def</span> <span>assert_result</span><span>(%</span><span>SomeStruct</span><span>{</span><span>value</span><span>:</span> <span>v</span><span>}</span> <span>=</span> <span>s</span><span>,</span> <span>expected</span><span>)</span> <span>do</span>\n    <span>assert</span> <span>v</span> <span>==</span> <span>expected</span>\n    <span>s</span>\n<span>end</span>\n\n<span>test</span> <span>&quot;complex hashing works!&quot;</span> <span>do</span>\n    <span>%</span><span>SomeStruct</span><span>{</span><span>value</span><span>:</span> <span>&quot;javier&quot;</span><span>}</span>\n    <span>|></span> <span>capitalize</span><span>()</span>\n    <span>|></span> <span>assert_result</span><span>(</span><span>&quot;Javier&quot;</span><span>)</span>\n    <span>|></span> <span>hash</span><span>()</span>\n    <span>|></span> <span>assert_result</span><span>(</span><span>&quot;7F3D0970EC0E336AA08A9E14D4D88E79131E0065&quot;</span><span>)</span>\n    <span>|></span> <span>downcase</span><span>()</span>\n    <span>|></span> <span>assert_result</span><span>(</span><span>&quot;7f3d0970ec0e336aa08a9e14d4d88e79131e0065&quot;</span><span>)</span>\n<span>end</span>\n</code></pre></div>\n<p>In my opinion, that is simply a beautiful test. I wish all my tests read in that clean and simple way.\nReducers empower us to write better, cleaner code. It's key though that the order of the parameters are\nconsistent (so we can pipe our functions), and that they are also pure (so all the side effects are isolated\nin the boundaries of our application).</p>\n<h2>Encapsulate data with functions</h2>\n<p>Another lesson I learnt while coding with Clojure, early in my functional journey, was how to encapsulate\ndata. One of the core pillars of OOP is encapsulation—keep your data private and your behaviour public.\nThat way if some day you decide to modify the underlying implementation of your behaviour, it will never\naffect the consumers of your API.</p>\n<p>In FP sometimes it can be slightly more challenging, or maybe just different, especially when the language\ndoesn't expose the concept of complex typing. I found out that by encapsulating data with functions, I was\nable to make my applications much more robust—consumers would have a consistent API with which to interact.\nIn Elixir we have structs that solve that problem for us; but in Clojure, we don't. So instead of passing\nan anonymous map around and accessing its keys, we could do something like:</p>\n<div><pre><code><span></span><span>(</span><span>defn </span><span>new-job</span> <span>[</span><span>userid</span> <span>cronexpression</span> <span>service</span><span>]</span>\n  <span>{</span><span>:userid</span> <span>userid</span> <span>:cronexpression</span> <span>cronexpression</span> <span>:service</span> <span>service</span><span>})</span>\n\n<span>(</span><span>defn </span><span>get-id</span> <span>[</span><span>job</span><span>]</span>\n  <span>(</span><span>:id</span> <span>job</span><span>))</span>\n\n<span>(</span><span>defn </span><span>get-cron-expr</span> <span>[</span><span>job</span><span>]</span>\n  <span>(</span><span>:cronexpression</span> <span>job</span><span>))</span>\n\n<span>(</span><span>defn </span><span>get-user-id</span> <span>[</span><span>job</span><span>]</span>\n  <span>(</span><span>:userid</span> <span>job</span><span>))</span>\n</code></pre></div>\n<p>Thus allowing consumers to access the data like:</p>\n<div><pre><code><span></span><span>(</span><span>defn </span><span>some-function</span> <span>[</span><span>job</span><span>]</span>\n  <span>(</span><span>-> </span><span>job</span>\n      <span>(</span><span>job/get-user-id</span><span>)</span>\n      <span>(</span><span>do-something</span><span>)</span>\n      <span>(</span><span>do-something-else</span><span>)))</span>\n</code></pre></div>\n<p>By encapsulating our data sometimes with structs (but when not possible, with functions), we're telling\nour consumers how we want them to use our API—we're telling them, <strong>&quot;Don't use that property, because\ntomorrow it might not be there!&quot;</strong>.</p>\n<h2>Wrapping up</h2>\n<p>Coming to an end, all I can say is... stay curious, keep learning, question yourself. Functional purity,\nencapsulation, and readability are all solutions to problems that emerged only after the code just didn't click.\nAll of this is just a quick summary of the different things I have learnt after having screwed up on many\noccasions. <a href=\"https://github.com/Manzanit0/londibot\">Londibot</a> started as a Clojure bot when I was just\nstarting to learn functional programming, and it was thanks to poor design choices and bad decisions that\nI kept reading and searching for better solutions to the problems that arose in my codebase. That's how all\nthis came up.</p>",
   :direction "ltr"},
  :updated 1572325200000,
  :entities
  [{:mentions
    [{:text "functional programming"} {:text "functional language"}],
    :id "nlp/f/entity/wd:193076",
    :salienceLevel "mention",
    :label "functional programming"}
   {:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "Elixir"}],
    :id "nlp/f/entity/wd:5362035",
    :salienceLevel "mention",
    :label "Elixir"}
   {:mentions [{:text "LISP"}],
    :id "nlp/f/entity/wd:132874",
    :salienceLevel "mention",
    :label "Lisp"}
   {:mentions [{:text "Victoria line"}],
    :id "nlp/f/entity/wd:203030",
    :salienceLevel "mention",
    :label "Victoria line"}],
  :alternate
  [{:href
    "https://8thlight.com/blog/javier-garc%C3%ADa/2019/10/29/functional-lessons.html",
    :type "text/html"}],
  :title "Functional lessons learnt",
  :author "Javier García",
  :published-str "Mon Oct 28 22:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16e183e8cbc:f85bf0b:97b0c8f7",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url
   "https://8thlight.com/blog/assets/logos/logo-dark-5517382dc86727b20a188a859b388c914609d0e449ed061b39fafe2495fed8c1.png",
   :width 1000,
   :height 1000,
   :contentType "image/png"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://8thlight.com/blog/javier-garc%C3%ADa/2019/10/29/functional-lessons.html",
  :commonTopics
  [{:score 76.42806270883938,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 28.91705950101473,
    :id "nlp/f/topic/3049",
    :salienceLevel "about",
    :label "automotive"}],
  :published 1572325200000,
  :fingerprint "c2e89ce2",
  :canonicalUrl
  "https://8thlight.com/blog/javier-garc%C3%ADa/2019/10/29/functional-lessons.html"}
 {:engagement 5,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1572259535035,
  :content
  {:content
   "<div>\n<p><em>Issue 350 – October 28, 2019 · <a href=\"https://purelyfunctional.tv/newsletter-archives/\">Archives</a> · <a title=\"Thanks, Jeff!\" href=\"https://purelyfunctional.tv/newsletter/\">Subscribe</a></em></p>\n<h2>On Vacation 🏕</h2>\n<p>Hello!</p>\n<p>This is going to be a light issue this week. I’m on vacation at the moment. I’ll miss next week’s too!</p>\n<h2>Conference alert 🚨</h2>\n<p>I booked my tickets to the 2019 Clojure/conj in Durham, North Carolina this week. If you’re going, let me know! I haven’t been to a conj in a couple of years and I’m really excited.</p>\n<p>I’m also planning on attending a local Elixir conference (The Big Elixir) if you happen to be going to that. In that case, give me a holler!</p>\n<h2>Currently recording 🎥</h2>\n<p>Property-Based Testing with test.check is now split into three courses, <a title href=\"https://purelyfunctional.tv/courses/property-based-testing-with-test-check/\">Beginning</a>, <a title href=\"https://purelyfunctional.tv/courses/intermediate-property-based-testing-with-test-check/\">Intermediate</a>, and <a title href=\"https://purelyfunctional.tv/courses/advanced-property-based-testing-with-test-check/\">Advanced</a>. The launch begins when I come back from vacation. Stay tuned.</p>\n<h2>Clojure Challenge 🤔</h2>\n<h3>Last week’s challenge</h3>\n<p>The challenge in <a title href=\"https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-349-tip-monoid-pattern/\">Issue 349</a> was to write a function to build monoid-pattern compliant functions.</p>\n<p>You can check out the submissions <a title href=\"https://gist.github.com/ericnormand/b6bd8f1dfda10397f946e8d875605f8c\">here</a>.</p>\n<p>My favorites were the incredibly succinct from Ben Grabow:</p>\n<pre><code>(defn monoid [id fn-2]\n  (fn [&amp; args]\n    (reduce fn-2 id args)))\n</code></pre>\n<p>and the incredibly clear and optimized from Teodor Heggelund:</p>\n<pre><code>(defn monoid [id fn-2]\n  (fn\n    ([] id)\n    ([x] x)\n    ([x y] (fn-2 x y))\n    ([x y &amp; more]\n     (reduce fn-2 (fn-2 x y) more))))\n</code></pre>\n<p>No challenge this week.</p>\n<p>Rock on!<br>Eric Normand</p>\n</div>\n<p>The post <a rel=\"nofollow\" href=\"https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-350-monoid-pattern-submissions/\">PurelyFunctional.tv Newsletter 350: Monoid pattern submissions</a> appeared first on <a rel=\"nofollow\" href=\"https://purelyfunctional.tv\">PurelyFunctional.tv</a>.</p>",
   :direction "ltr"},
  :updated 1572256800000,
  :entities
  [{:mentions [{:text "Elixir"}],
    :id "nlp/f/entity/wd:5362035",
    :salienceLevel "mention",
    :label "Elixir"}
   {:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "args"}],
    :id "nlp/f/entity/wd:2005914",
    :salienceLevel "mention",
    :label "entry point"}
   {:mentions [{:text "Durham, North Carolina"}],
    :id "nlp/f/entity/wd:49229",
    :salienceLevel "mention",
    :label "Durham"}],
  :alternate
  [{:href
    "https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-350-monoid-pattern-submissions/",
    :type "text/html"}],
  :title
  "PurelyFunctional.tv Newsletter 350: Monoid pattern submissions",
  :author "Eric Normand",
  :published-str "Mon Oct 28 03:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16e11f898bb:efad8f6:97b0c8f7",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://purelyfunctional.tv/?p=32357",
  :published 1572256800000,
  :fingerprint "d593c673",
  :canonicalUrl
  "https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-350-monoid-pattern-submissions/"}
 {:engagement 14,
  :unread false,
  :crawled 1572244641116,
  :content
  {:content
   "<p>Definitions of functional programming disagree with each other and often don’t encompass the broad range of languages and practices we find in industry. The definitions also make it seem incompatible with other paradigms, such as object-oriented and procedural. However, if you look at FP as a set of skills, both problems are solved. We can find skills that functional programmers tend to use and not be incompatible. In this episode, I explore some important, high-level skills that functional programmers employ.</p>\n<p></p>\n<div>\n<div><span></span><img alt=\"Video Thumbnail\" src=\"https://i.ytimg.com/vi/LEcYw9_NxhQ/mqdefault.jpg\"><p></p>\n<h5>Functional programming is a set of skills</h5>\n<p><span>Definitions of functional programming disagree with each other and often don't encompass the broad range of languages and practices we find in industry. The definitions also make it seem incompatible with other paradigms, such as object-oriented and procedural. However, if you look at FP as a set of</span></p></div>\n</div>\n<h2>Transcript</h2>\n<p>Eric Normand: Functional programming is skills. By the end of this episode, you will know what are the most important skills in functional programming.</p>\n<p>My name is Eric Normand and I help people thrive with functional programming.</p>\n<p>A lot of people ask, “What is functional programming?” There’s a lot of answers out there. They’re somewhat contradictory. Sometimes they’re helpful, sometimes they’re not.</p>\n<p>In the book I’m working on — the book’s called “Grokking Simplicity” — which is out now, if you want to go check it out, I have found it most useful to bypass the definition, trying to define what functional programming is, and saying, “Well, that is functional programming, that isn’t functional programming.”</p>\n<p>Just bypass that whole thing and look at it as just a set of skills. It’s basically the skills that functional programmers do more often than other people do.</p>\n<p>They’re not incompatible with other paradigms, right? Object-oriented programming, you could also look at it like a set of skills. They’re not incompatible. Object-oriented programming has encapsulation and object-oriented modeling, and those are useful skills.</p>\n<p>Functional programming has different skills that you can mix and match and use them together with other paradigm skills. What are those skills? I’m going to go over five main skills right now.</p>\n<p>Skill number one. I feel like this is an incontrovertible skill that you have to have to call yourself a functional programmer. This is non-negotiable. You have to be able to discriminate between actions, calculations, and data. I don’t care what you call them. I’m calling them those for a lot of reasons. I have episodes talking about why I chose those terms.</p>\n<p>Actions, calculations, and data. You have to be able to look at your code and see, “Oh, that’s an action, that’s data, that’s calculations.” Calculations are computations from inputs to outputs. You might call them pure functions. This is pure calculations. Doesn’t matter when you run them. You’re going to get the same answer if you give it the same arguments.</p>\n<p>Actions, on the other hand, can change depending on when you run them. You might call these impure functions, but they’re not always functions. Just like calculations aren’t always functions in your language, actions aren’t always functions.</p>\n<p>Sometimes it’s an operator, like an arithmetic operator. That’s a calculation, like + is a calculation, but ++, it’s not a function, it’s an operator. That is an action. You have to be able to separate these out, because calculations and data are very easy. They’re much easier to work with. They’re easier to test. They’re easier to reuse because you don’t worry about when they’re getting run.</p>\n<p>The actions — those are much harder. In general, you want to have fewer lines of code in actions. You move those lines of code into calculations. Then you want to spend extra time on them to make sure that you get them right. It really matters how you call them, when you call them, how many times you call them. That’s skill number one. Discriminate actions, calculations and data.</p>\n<p>Skill number two is to be able to work effectively with immutable values. We spend a lot of time in real-world information systems trying to keep records forever, or for as long as we can. We’ll put papers…we’ll file them away in a filing cabinet. We put some papers in a fireproof box. We use archival-quality paper and ink so that things don’t decay over time.</p>\n<p>We have rules about who’s allowed to write on this paper. “Oh, no, this one is done. Don’t write on it anymore.” Maybe you stamp it and you say, “This has been checked and vetted. it cannot be changed anymore.”</p>\n<p>There’s all sorts of real-world mechanisms for making things immutable, making our records permanent. When we’re building computer software, often we are making an information system, but because of the way memory works — and memory is mutable, memory can change — we have thrown that out. We have to rebuild the skill of working with immutable data.</p>\n<p>We have to rebuild that as a discipline somewhere, either in our programming team, as our programming discipline that we implement, or maybe our language implements it, or maybe our database implements it, but we need to have it somewhere. It’s not the same as being able to write over stuff and change it willy-nilly, like you can with mutable data.</p>\n<p>A functional programmer has to learn how to deal with the immutable data. Basically, you’re making a lot of copies. That’s basically what it is. I have a whole episode just on working with immutable values.</p>\n<p>One of the bigger challenges is working with nested data, because you want to change something deep in some nested structure. You have a company, has employees, and the employees have salaries, and you want to give everyone a 10% raise.</p>\n<p>You’re actually going through the company. It’s an immutable value that represents the company. The employee is immutable, and the raise is immutable, or the salary is immutable. How do you make a copy of that whole tree so that you can give everyone a raise? Maybe you’re just giving one employee a raise. What do you make copies of? That is a skill that functional programmers develop.</p>\n<p>All right, let’s move on. Skill number three. This is another important skill. This is where the power of functional programming really starts to come out and shine. It’s using and creating higher-order calculations and actions.</p>\n<p>I’ve combined a whole bunch into one skill. I don’t know why I did that. It’s really four things. It’s using higher-order calculations, using higher-order actions, then creating higher order calculations, and creating higher-order actions. It fit well in one sentence, so let’s call it one skill, skill number three.</p>\n<p>Higher-order actions and calculations means they are actions and calculations that you can treat like any other value. You can pass them to functions as arguments. You can return them from functions. You can store them in a variable, those kinds of things.</p>\n<p>When they’re higher-order, it means that you can pass behavior to another function, or you can take, let’s say, an action, and automatically make it idempotent. Take an action and automatically make it retry three times if it fails.</p>\n<p>You can do stuff like that if you’re operating at a higher-order level. You can do it without it, except you’re writing a bespoke program to retry three times every time. By having it be higher-order, you’re able to manipulate it in a regular way so that you can have this behavior that is typically just boilerplate, you can have it just define one place, and it works properly everywhere.</p>\n<p>This is where the power comes from of functional programming, where we have stuff like map, filter, and reduce. Those are higher-order functions. They take functions, basically, letting you build data transformation pipelines.</p>\n<p>This is where you get stuff like having sequences of actions that can retry, and what happens when they fail. You can define all of that compositionally instead of just a straight-up, top-down code.</p>\n<p>This is very abstract stuff so it’s hard to explain. As I’m speaking, I can tell I’m not getting this stuff through very easily.</p>\n<p>In structure and interpretation of computer programs, one of the first exercises — I think it’s in chapter one — is writing a function that takes a function, and it returns a new function that calculates the derivative. You pass in F — that’s the argument — and it returns a function that is the derivative of F.</p>\n<p>You don’t know what F is. It could be any mathematical function. That’s the kind of cool stuff that you can do in functional programming that’s hard to do without those first-class functions.</p>\n<p>Let’s move on to skill number four, data modeling. We have these situations, these problems, these real-world processes that we are trying to automate. We’re trying to solve with software instead of physical process. How do we do that?</p>\n<p>How do we take measurements and other facts about the world, about things that are happening, combine those together into concrete structures in our code, so that we can effectively use them? Data modeling is all about, how do you effectively structure the data that you have so you can use it effectively?</p>\n<p>I have an episode all about the two kinds of data modeling that we do. There’s the data modeling where you’re having a public-facing data that needs to exit your library, exit your server. It’s part of the API. That data has different design constraints on it.</p>\n<p>It needs to be human-readable. The developer on the other side is going to be writing that or writing a program to write that. They have to understand it pretty well.</p>\n<p>Then there’s the data modeling that’s internal, where let’s say you’re doing some kind of search through a space. You need to represent the data in a certain way so that search is efficient and all the data you need is available, etc. That’s an internal data modeling.</p>\n<p>These two skills are very important in functional programming. I also think that they’re more advanced. I’ve been working up the chain here. I start at skill one, where you identify actions, calculations, and data. This is the beginning of functional programming. Data modeling is way near the end.</p>\n<p>Number five is architecture skills. You’re building a system. You’re building software. You can’t just throw all the code. If it’s a little bit of code, you can just put it in one file. Architecture doesn’t matter. As it scales up, you don’t want it to fall down. You don’t want it to become unmanageable.</p>\n<p>You need some kind of design principles, some kind of architectural principles. Functional programming has those, has some, right? They’re a little bit different from what you find in other paradigms.</p>\n<p>One architectural pattern that comes from the function programming world is the reactive data, reactive architecture. I don’t know if you’re familiar with Redux in the React world, or the Elm Architecture, or re-frame in ClojureScript. There’s many of these.</p>\n<p>The idea is, events are being generated. You are consuming those events. That generates a view of the world, and that view is projected out, say, onto a GUI. You have some state somewhere that is being modified, some centralized state. You modify that.</p>\n<p>Then, from that, it generates a projection onto a GUI. You have a cycle going on, and it’s all being done based on reactions, based on changes to the data. It’s an architectural pattern that you see in the React world quite a bit.</p>\n<p>Another architectural pattern is the Onion Architecture. I talked about this. There’s episodes about it. The Onion Architecture, there are three main layers to this onion. It’s like a sphere, like an onion, where the outer layer is the interaction layer. This layer is where you put all your actions. This is the stuff that talks to the outside world, that gets messages from the outside world.</p>\n<p>Then that layer calls into the second layer, which is a calculation. It’s a bunch of calculations, no actions in there. It is called the business rule layer. That second layer is where you have all the changing requirements of your business — how you calculate payroll, what’s your vacation policy — all this kind of stuff is in your business rule layer.</p>\n<p>Then inside that is the domain layer. This is the domain model. There’s just those three main layers. You can break up each layer into more layers if you want, but the architectural pattern is just these three layers. Inside that domain layer is the timeless domain model that the business rules call into.</p>\n<p>Like I said, the business rules could be vacation policy and how you calculate salaries, but inside the domain model is the timeless idea that employees do get a salary, and it is some fixed amount. Employees do get certain amounts of vacation. How much vacation? That’s a business rule, but they do get vacation, is part of the domain model.</p>\n<p>Separating the things out into this Onion Architecture helps separate things out into a fast-changing layer. That’s where all your actions go, your interaction layer, because you’re connecting to this API. There’s a version change for that API. Got to modify the code to talk to this API, that API. That’s changing very rapidly.</p>\n<p>The business rules change rapidly, but not as rapidly as that. “Oh, the vacation policy changed. We’ve got to modify our code.” Then inside that domain model is the stuff that changes the least frequently. The fact that employees get vacation is a pretty timeless thing.</p>\n<p>Even if something weird happens and employees start getting zero vacation, that is at least modelable inside the domain model, and you know it’s a weird case. “Right now, we’re not giving vacation. Right now, all of our salaries are at zero.” [laughs] It’s still a number. It still fits in the model.</p>\n<p>All right, these are five skills that I am working on in my book. The book is called, “Grokking Simplicity.” You can get an early access version now. If you’re listening to this in my future, this is obviously my present, but in my future, it could be out. It could be finished. Get it. Buy the book. It’s published at Manning. Just google, “Grokking Simplicity.” You’ll find it.</p>\n<p>Here are the five skills. I’ll go over them again. There’s more skills. I just have some big ones here. Discriminating actions, calculations, and data. Number two, working with immutable values. Number three, higher-order calculations and actions. Four is data modeling, and five, functional architecture.</p>\n<p>If you liked this episode, you should go to lispcast.com/podcast. There you will find all the old episodes, including audio, video, and text transcripts of everything. You’ll also find links to subscribe so you can get in whatever format you want. You’ll also find links to find me on social media so we can talk.</p>\n<p>Just a warning. If you do reach out, ask me a question or you have a comment, I might mention you in an upcoming episode. If you don’t want me to mention you — maybe you don’t want me to use your name or you don’t like the question going public — just let me know that you don’t want that.</p>\n<p>Otherwise, I use this as a public forum. If you ask me a question, it’s going to be broadcast out. Just let me know, and I just won’t use it.</p>\n<p>Cool, thank you so much. This has been my thought on functional programming. My name is Eric Normand. Thank you for listening, and rock on.</p>\n<p>The post <a rel=\"nofollow\" href=\"https://lispcast.com/functional-programming-is-a-set-of-skills/\">Functional programming is a set of skills</a> appeared first on <a rel=\"nofollow\" href=\"https://lispcast.com\">LispCast</a>.</p>",
   :direction "ltr"},
  :updated 1572242400000,
  :entities
  [{:mentions [{:text "functional programming"}],
    :id "nlp/f/entity/wd:193076",
    :salienceLevel "about",
    :label "functional programming"}
   {:mentions [{:text "function"} {:text "mathematical function"}],
    :id "nlp/f/entity/wd:11348",
    :salienceLevel "mention",
    :label "function"}
   {:mentions [{:text "data modeling"}],
    :id "nlp/f/entity/wd:367664",
    :salienceLevel "mention",
    :label "data modeling"}
   {:mentions [{:text "architectural pattern"}],
    :id "nlp/f/entity/wd:635346",
    :salienceLevel "mention",
    :label "architectural pattern"}
   {:mentions [{:text "Object-oriented programming"}],
    :id "nlp/f/entity/wd:79872",
    :salienceLevel "mention",
    :label "object-oriented programming"}],
  :alternate
  [{:href
    "https://lispcast.com/functional-programming-is-a-set-of-skills/",
    :type "text/html"}],
  :title "Functional programming is a set of skills",
  :author "Eric Normand",
  :published-str "Sun Oct 27 23:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16e1115555c:efdfafc:69b9f616",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url "https://i.ytimg.com/vi/LEcYw9_NxhQ/mqdefault.jpg",
   :width 320,
   :height 180,
   :contentType "image/jpeg"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://lispcast.com/?p=2071",
  :commonTopics
  [{:score 82.57332651060146,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1572242400000,
  :fingerprint "626c1465",
  :canonicalUrl
  "https://lispcast.com/functional-programming-is-a-set-of-skills/"}
 {:engagement 11,
  :unread false,
  :crawled 1572191999402,
  :content
  {:content
   "<h2>\n<a href=\"https://dev.to/feed#faster-than-a-hadron-collider\">\n</a>\nFaster than a hadron collider 🤓\n</h2>\n<p><a href=\"https://i.giphy.com/media/3oriNYQX2lC6dfW2Ji/giphy.gif\"><img alt=\"\" src=\"https://i.giphy.com/media/3oriNYQX2lC6dfW2Ji/giphy.gif\"></a><br>\nWe have a list of orders and want to get the first 2 elements</p>\n<p>How we can do that?<br>\n</p>\n<div><pre><code><span>(</span><span>def</span><span> </span><span>order</span><span> </span><span>[</span><span>\n</span><span>{</span><span>:id</span><span> </span><span>15</span><span> </span><span>:quantity</span><span> </span><span>3</span><span> </span><span>:price</span><span> </span><span>5</span><span>}</span><span>\n</span><span>{</span><span>:id</span><span> </span><span>3</span><span> </span><span>:quantity</span><span> </span><span>24</span><span> </span><span>:price</span><span> </span><span>1</span><span>}</span><span>\n</span><span>{</span><span>:id</span><span> </span><span>7</span><span> </span><span>:quantity</span><span> </span><span>6</span><span> </span><span>:price</span><span> </span><span>9</span><span>}])</span><span>\n</span><span>(</span><span>println</span><span> </span><span>(</span><span>take</span><span> </span><span>2</span><span> </span><span>order</span><span>))</span><span> </span><span>;take [0, 1] from list of elements</span><span>\n</span><span>(</span><span>println</span><span> </span><span>(</span><span>nth</span><span> </span><span>order</span><span> </span><span>2</span><span>))</span><span> </span><span>;better than (get _ _) to get elements from a list </span><span>\n</span></code></pre></div>\n<p><a href=\"https://i.giphy.com/media/dQkcf8GANR0ps57oBH/giphy.gif\"><img alt=\"\" src=\"https://i.giphy.com/media/dQkcf8GANR0ps57oBH/giphy.gif\"></a></p>\n<p>Thanks for your time 🤗</p>",
   :direction "ltr"},
  :updated 1572184397000,
  :entities
  [{:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "about",
    :label "Clojure"}],
  :alternate
  [{:href
    "https://dev.to/wakeupmh/taking-n-first-elements-from-a-list-in-clojure-13e8",
    :type "text/html"}],
  :title "Taking n first elements from a list in Clojure",
  :author "Marcos Henrique",
  :published-str "Sun Oct 27 06:53:17 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16e0df215aa:e464316:ad5391a1",
  :visual {:url "none"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://dev.to/wakeupmh/taking-n-first-elements-from-a-list-in-clojure-13e8",
  :published 1572184397000,
  :fingerprint "9c00a989",
  :canonicalUrl
  "https://dev.to/wakeupmh/taking-n-first-elements-from-a-list-in-clojure-13e8"}
 {:engagement 5,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1572033961572,
  :recrawled 1572289302853,
  :content
  {:content
   "<p>Life as a developer can take many spooky turns. <br>\n<br></p>\n<p align=\"center\">\n<img src=\"https://circleci.com/blog/media/wisdom_of_the_ancients.png\">\n</p>\n<div> Original art from <a href=\"https://xkcd.com/979/\"> xkcd </a> </div>\n<p><br></p>\n<p>From forum quandaries that haunt you through time, to sneaky bugs you find lurking in your legacy code, the things you encounter as a developer can be downright shocking. Read on for some spooky stories from our own CircleCI developers in honor of the Halloween season:</p>\n<blockquote>\n<p>“I was once working tech support for a VPS provider and told a customer that their disk image was hosed so they should delete it and restore from the backup. The backup was also hosed and we couldn’t try to repair their image because they deleted it…”</p>\n</blockquote>\n<blockquote>\n<p>“Let everything run as root. Enough said.”</p>\n</blockquote>\n<blockquote>\n<p>“I once deleted /home on every machine in our fleet while running an Ansible playbook because the rules for the Jinja templates and order of operations for filtering and loops wasn’t clear, so instead of deleting /home/$employee the $employee was the empty string.”</p>\n</blockquote>\n<blockquote>\n<p>“I worked at a startup once that was 4 people, including myself, and the owner/boss/self-granted-title-of-the-week made his money during the ‘90s before the bubble pop, he was great at marketing but had very little technical know-how. One day there was a bugged release of the app, and when I told him the root cause of the bug later that day his response was ‘Why isn’t there a backup function that works in case of bugs?’ I gave my notice that day.”</p>\n</blockquote>\n<blockquote>\n<p>“I once worked at a network assurance company that held a release meeting/party where all the executives spent over an hour going on how well the company was doing, then laid off a third of the staff the next day.”</p>\n</blockquote>\n<blockquote>\n<p>“One of my last companies had a revolving door of architects for about 3 years, and the product went from being pure Clojure/ClojureScript to being Python, Go, Clojure, ClojureScript, Java, JavaScript, and some C++ thrown in for good measure.”</p>\n</blockquote>\n<blockquote>\n<p>“Let’s not use Kubernetes, and try to roll our own stateless Kubernetes.”</p>\n</blockquote>\n<blockquote>\n<p>“An old company rendered every microservice configuration file from a master values file and jinja templates, then would deploy the configuration both to zookeeper and directly into the containers running the various services. That worked out at least 1/4 as well as you’d expect it to.”</p>\n</blockquote>\n<blockquote>\n<p>“I once inherited running a webservice that was lighttp running bash scripts using CGI that parsed env vars like query string and path using sed/awk/cut to extract params, then used touch and rm plus some craftily maintained state on the filesystem instead of using a real DB - they didn’t even use SQLite!”</p>\n</blockquote>\n<blockquote>\n<p>“Refactoring a monolith into microservices using the monolith as a dependency.”</p>\n</blockquote>\n<p>Have frightful tales of your own? Share them by tweeting your #devhorror stories to @CircleCI</p>",
   :direction "ltr"},
  :updated 1572020100000,
  :entities
  [{:mentions [{:text "Halloween"}],
    :id "nlp/f/entity/wd:251868",
    :salienceLevel "mention",
    :label "Halloween"}
   {:mentions [{:text "Kubernetes"}],
    :id "nlp/f/entity/wd:22661306",
    :salienceLevel "mention",
    :label "Kubernetes"}
   {:mentions [{:text "VPS"}],
    :id "nlp/f/entity/wd:878048",
    :salienceLevel "mention",
    :label "virtual private server"}
   {:mentions [{:text "empty string"}],
    :id "nlp/f/entity/wd:670834",
    :salienceLevel "mention",
    :label "empty string"}
   {:mentions [{:text "revolving door"}],
    :id "nlp/f/entity/wd:1256780",
    :salienceLevel "mention",
    :label "revolving door"}],
  :alternate
  [{:href
    "https://circleci.com/blog/dev-horror-stories-to-tell-around-the-campfire/",
    :type "text/html"}],
  :title "Dev horror stories to tell around the campfire",
  :author "Rosalind Lutsky",
  :published-str "Fri Oct 25 09:15:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16e04869e64:e351f87:69b9f616",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url "https://circleci.com/blog/media/wisdom_of_the_ancients.png",
   :width 485,
   :height 270,
   :contentType "image/png"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://circleci.com/blog/dev-horror-stories-to-tell-around-the-campfire/",
  :updateCount 1,
  :commonTopics
  [{:score 118.29213380606282,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1572020100000,
  :fingerprint "fa902bf3",
  :canonicalUrl
  "https://circleci.com/blog/dev-horror-stories-to-tell-around-the-campfire/"}
 {:engagement 6,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1572025068027,
  :content
  {:content
   "<p>Each week, we discuss a different topic about Clojure and functional programming.</p>\n<p>If you have a question you’d like us to discuss, tweet <a href=\"https://twitter.com/clojuredesign\">@clojuredesign</a>, send an email to <a href=\"mailto:feedback@clojuredesign.club\">feedback@clojuredesign.club</a>, or join the <code>#clojuredesign-podcast</code> channel on the <a href=\"http://clojurians.net/\">Clojurians Slack</a>.</p>\n<p>This week, our topic is: <strong>“Functions! Functions! Functions!”</strong> We wonder how we could function without these critical building blocks, so we catagorize their varied uses.</p>\n<p>Selected quotes:</p>\n<ul>\n<li>“Functions put the fun in functional.”</li>\n<li>“Each function category has a different mindset.”</li>\n<li>“Programming is more fun when you’re only thinking about the problem in front of you.”</li>\n<li>“Naming bits of computation helps you understand an abstraction without having to dip into it.”</li>\n<li>“So you don’t want the function to be called ‘write-or-fetch-or-sleep-or-return!’?”</li>\n<li>“Side effecting functions shouldn’t think. They are grunts.”</li>\n<li>“The I/O fairy hands you data, and you get it all transformed with pure functions, and then you hand it back to the I/O fairy.”</li>\n<li>“That Twitter use case, that has a lot more side effects.”</li>\n</ul>\n<p>Related episodes:</p>\n<ul>\n<li><a href=\"https://clojuredesign.club/episode/002-tic-tac-toe-state-in-a-row\">002: Tic-Tac-Toe, State in a Row</a></li>\n<li><a href=\"https://clojuredesign.club/episode/024-you-are-here-but-why\">024: You Are Here, But Why?</a></li>\n</ul>",
   :direction "ltr"},
  :updated 1572015600000,
  :entities
  [{:mentions [{:text "I/O"}],
    :id "nlp/f/entity/wd:219320",
    :salienceLevel "about",
    :label "input/output"}
   {:mentions [{:text "functional programming"}],
    :id "nlp/f/entity/wd:193076",
    :salienceLevel "mention",
    :label "functional programming"}
   {:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "Tic Tac Toe"}],
    :id "nlp/f/entity/wd:662416",
    :salienceLevel "mention",
    :label "Tic Tac Toe"}],
  :alternate
  [{:href
    "https://clojuredesign.club/episode/052-functions-functions-functions/",
    :type "text/html"}],
  :title "Ep 052: Functions! Functions! Functions!",
  :author "Christoph Neumann and Nate Jones",
  :published-str "Fri Oct 25 08:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16e03fee9fb:e29723d:69b9f616",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://clojuredesign.club/episode/052-functions-functions-functions/",
  :commonTopics
  [{:score 28.358802409527822,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.795,
    :id "nlp/f/topic/349",
    :salienceLevel "mention",
    :label "business"}],
  :published 1572015600000,
  :fingerprint "4fc0d104",
  :canonicalUrl
  "https://clojuredesign.club/episode/052-functions-functions-functions/"}
 {:engagement 6,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}
   {:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/todo",
    :label "todo"}],
  :unread false,
  :crawled 1571949964051,
  :content
  {:content
   "<div>\n<div>\n<div>\n<p>I’ve procrastinated my way to yet another blogging stack and I’m very happy with it! I’m going to walk you through how it works and show you a few tricks of prepl based development I found along the way. If you like the idea of this approach feel free to fork <a href=\"https://github.com/Olical/blog\">Olical/blog</a>.</p>\n</div>\n</div>\n</div>\n<div>\n<h2>Previous worlds</h2>\n<div>\n<div>\n<p>My poor blog has been through quite a few iterations, I <em>think</em> this list is exhaustive:</p>\n</div>\n<div>\n<ul>\n<li>\n<p>WordPress</p>\n</li>\n<li>\n<p>Octopress (static via Ruby)</p>\n</li>\n<li>\n<p>Possibly another I forgot here?</p>\n</li>\n<li>\n<p>WordPress</p>\n</li>\n<li>\n<p>Cryogen (static via Clojure)</p>\n</li>\n</ul>\n</div>\n<div>\n<p>I’ve somehow managed to carry my posts forward from each old blog into my new one each time, they’ve definitely lost some quality along the way (image formatting, syntax highlighting) but the content and URLs have remained functional in one way or another. This means you can still read my old cringe worthy posts that mostly center around outdated JavaScript almost a decade later, hooray!</p>\n</div>\n<div>\n<p>When I moved from my last WordPress instance to Cryogen I ended up taking a snapshot of my old site’s HTML and storing that as a bunch of static files alongside my new static output. This meant the old URLs would continue to work without the original server and I wouldn’t have to convert them to Markdown Cryogen could work with.</p>\n</div>\n<div>\n<p>I was hosting the Cryogen blog on GitHub pages so I wasn’t able to perform any redirects. Keeping all of the old URLs the same was an <em>interesting</em> exercise. You could essentially follow a link from the Cryogen site into the frozen WordPress site then browse around from there. They were two static sites hosted within the same GitHub pages though which is pretty odd.</p>\n</div>\n</div>\n</div>\n<div>\n<h2>The new world</h2>\n<div>\n<div>\n<p>What you’re seeing here is static HTML hosted on a <a href=\"https://m.do.co/c/e643aa564b21\">DigitalOcean</a> $5 Droplet behind <a href=\"https://www.cloudflare.com\">CloudFlare</a> for caching, compression and HTTPS (take a look at the network tab of your inspector, it’s so fast!). It’s compiled into a <a href=\"https://www.docker.com/\">Docker</a> container (with <a href=\"https://www.nginx.com/\">nginx</a> as a server) and executed by <a href=\"http://dokku.viewdocs.io/dokku/\">Dokku</a>, an extremely easy to set up Docker based PaaS. It’s like a tiny private <a href=\"https://www.heroku.com/\">Heroku</a> (that’s actually Heroku compatible!).</p>\n</div>\n<div>\n<p>The posts are written in <a href=\"http://asciidoc.org/\">AsciiDoc</a> and compiled to HTML by a fairly small amount of <a href=\"https://clojure.org/\">Clojure</a> (<a href=\"https://github.com/Olical/blog/blob/4340d5c84fc4777db1ef71db451a059444473acf/src/blog/render.clj\"><code>blog.render</code></a>). It uses <a href=\"https://github.com/yogthos/Selmer\">Selmer</a> templating to stitch the HTML snippets together and executes everything under <a href=\"https://github.com/TheClimateCorporation/claypoole\">Claypoole</a> for maximum performance.</p>\n</div>\n<div>\n<p>To publish a post, all I have to do is write a new <code>.adoc</code> file in the <code>posts</code> directory and execute <code>make deploy</code>, that’ll <code>git push</code> my changes to Dokku which will build and run the container, swapping out the previous one if the build succeeds.</p>\n</div>\n</div>\n</div>\n<div>\n<h2>Converting WordPress HTML to AsciiDoc</h2>\n<div>\n<div>\n<p>I wrote some Clojure to parse the content out of the static HTML files I saved from my old WordPress blog years ago. I had to update the code block DOM a little since it was wrapped in some plugin specific nodes that worked with a now defunct JavaScript based syntax highlighter.</p>\n</div>\n<div>\n<p>Here’s the source of that namespace with a bunch of comments to explain some of my thinking as it goes along. You might want to start with the comment at the bottom and then work your way through the callstack.</p>\n</div>\n<div>\n<div>\n<pre><code><span>(</span><span>ns</span><span> </span><span>blog.tmp-wp-port</span><span>\n</span><span>(</span><span>:require</span><span> </span><span>[</span><span>clojure.string</span><span> </span><span>:as</span><span> </span><span>str</span><span>]</span><span>\n</span><span>[</span><span>clojure.java.shell</span><span> </span><span>:as</span><span> </span><span>shell</span><span>]</span><span>\n</span><span>;; I'm using Hickory to parse, alter and render the HTML source.</span><span>\n</span><span>[</span><span>hickory.core</span><span> </span><span>:as</span><span> </span><span>html</span><span>]</span><span>\n</span><span>[</span><span>hickory.select</span><span> </span><span>:as</span><span> </span><span>css</span><span>]</span><span>\n</span><span>[</span><span>hickory.render</span><span> </span><span>:as</span><span> </span><span>render</span><span>]</span><span>\n</span><span>;; I rarely touch the filesystem without fs.</span><span>\n</span><span>;; It makes so many things so very much easier.</span><span>\n</span><span>[</span><span>me.raynes.fs</span><span> </span><span>:as</span><span> </span><span>fs</span><span>]))</span><span>\n</span><span>;; This function returns a sequence of full file paths to each of the post HTML files.</span><span>\n</span><span>;; It's essentially listing every file in the blog source directory then</span><span>\n</span><span>;; filtering down to those that look like years.</span><span>\n</span><span>;; It then lists three levels down each of those year directories to find all of the posts.</span><span>\n</span><span>(</span><span>defn</span><span> </span><span>legacy-post-paths</span><span> </span><span>[</span><span>root</span><span>]</span><span>\n</span><span>(</span><span>->></span><span> </span><span>(</span><span>fs/list-dir</span><span> </span><span>root</span><span>)</span><span>\n</span><span>(</span><span>filter</span><span> </span><span>#</span><span>(</span><span>re-matches</span><span> </span><span>#</span><span>&quot;\\d\\d\\d\\d&quot;</span><span> </span><span>(</span><span>fs/name</span><span> </span><span>%</span><span>)))</span><span>\n</span><span>(</span><span>mapcat</span><span> </span><span>fs/list-dir</span><span>)</span><span>\n</span><span>(</span><span>mapcat</span><span> </span><span>fs/list-dir</span><span>)</span><span>\n</span><span>(</span><span>mapcat</span><span> </span><span>fs/list-dir</span><span>)</span><span>\n</span><span>(</span><span>map</span><span> </span><span>#</span><span>(</span><span>fs/file</span><span> </span><span>%</span><span> </span><span>&quot;index.html&quot;</span><span>))))</span><span>\n</span><span>;; Given a post HTML path this does all of the work to read, parse and update it.</span><span>\n</span><span>(</span><span>defn</span><span> </span><span>->post-data</span><span> </span><span>[</span><span>path</span><span>]</span><span>\n</span><span>(</span><span>let</span><span> </span><span>[</span><span>dom</span><span> </span><span>(</span><span>-></span><span> </span><span>(</span><span>slurp</span><span> </span><span>path</span><span>)</span><span>\n</span><span>(</span><span>html/parse</span><span>)</span><span>\n</span><span>(</span><span>html/as-hickory</span><span>))]</span><span>\n</span><span>;; The title and date are simple CSS selectors on the parsed DOM.</span><span>\n</span><span>{</span><span>:title</span><span> </span><span>(</span><span>-></span><span> </span><span>(</span><span>css/select</span><span> </span><span>(</span><span>css/class</span><span> </span><span>&quot;entry-title&quot;</span><span>)</span><span> </span><span>dom</span><span>)</span><span>\n</span><span>(</span><span>get-in</span><span> </span><span>[</span><span>0</span><span> </span><span>:content</span><span> </span><span>0</span><span>]))</span><span>\n</span><span>:date</span><span> </span><span>(</span><span>-></span><span> </span><span>(</span><span>css/select</span><span> </span><span>(</span><span>css/class</span><span> </span><span>&quot;entry-date&quot;</span><span>)</span><span> </span><span>dom</span><span>)</span><span>\n</span><span>(</span><span>get-in</span><span> </span><span>[</span><span>0</span><span> </span><span>:attrs</span><span> </span><span>:datetime</span><span>])</span><span>\n</span><span>(</span><span>str/replace</span><span> </span><span>#</span><span>&quot;T.*&quot;</span><span> </span><span>&quot;&quot;</span><span>))</span><span>\n</span><span>;; The slug is just name name, I've dropped the date prefix in my new blog.</span><span>\n</span><span>:slug</span><span> </span><span>(</span><span>fs/name</span><span> </span><span>(</span><span>fs/parent</span><span> </span><span>path</span><span>))</span><span>\n</span><span>;; Grabbing the content isn't toooo tricky.</span><span>\n</span><span>:content</span><span> </span><span>(</span><span>-></span><span> </span><span>(</span><span>css/select</span><span> </span><span>(</span><span>css/class</span><span> </span><span>&quot;entry-content&quot;</span><span>)</span><span> </span><span>dom</span><span>)</span><span>\n</span><span>(</span><span>first</span><span>)</span><span>\n</span><span>;; The harder part is updating the nodes...</span><span>\n</span><span>(</span><span>update</span><span>\n</span><span>:content</span><span>\n</span><span>(</span><span>fn</span><span> </span><span>[</span><span>nodes</span><span>]</span><span>\n</span><span>(</span><span>map</span><span> </span><span>(</span><span>fn</span><span> </span><span>[{</span><span>:keys</span><span> </span><span>[</span><span>attrs</span><span>]</span><span> </span><span>:as</span><span> </span><span>node</span><span>}]</span><span>\n</span><span>;; When we see this highlighting plugin node we extract the plain source code.</span><span>\n</span><span>(</span><span>if</span><span> </span><span>(</span><span>some-></span><span> </span><span>(</span><span>:class</span><span> </span><span>attrs</span><span>)</span><span> </span><span>(</span><span>str/includes?</span><span> </span><span>&quot;crayon-syntax&quot;</span><span>))</span><span>\n</span><span>(</span><span>-></span><span> </span><span>(</span><span>css/select</span><span> </span><span>(</span><span>css/class</span><span> </span><span>&quot;crayon-plain&quot;</span><span>)</span><span> </span><span>node</span><span>)</span><span>\n</span><span>(</span><span>first</span><span>)</span><span>\n</span><span>(</span><span>assoc</span><span> </span><span>:tag</span><span> </span><span>:pre</span><span>))</span><span>\n</span><span>node</span><span>))</span><span>\n</span><span>nodes</span><span>)))</span><span>\n</span><span>;; Finally we spit that updated DOM into HTML.</span><span>\n</span><span>(</span><span>render/hickory-to-html</span><span>)</span><span>\n</span><span>(</span><span>as-></span><span> </span><span>$</span><span>\n</span><span>;; And run it through pandoc to convert HTML to AsciiDoc.</span><span>\n</span><span>;; My headings were all way too deep which threw warnings</span><span>\n</span><span>;; when I compiled AsciiDoc -> HTML in Clojure. So I had to go</span><span>\n</span><span>;; through my posts with sed and turn === into == for example.</span><span>\n</span><span>(</span><span>shell/sh</span><span> </span><span>&quot;pandoc&quot;</span><span> </span><span>&quot;--wrap=none&quot;</span><span> </span><span>&quot;-f&quot;</span><span> </span><span>&quot;html&quot;</span><span> </span><span>&quot;-t&quot;</span><span> </span><span>&quot;asciidoc&quot;</span><span>\n</span><span>:in</span><span> </span><span>(</span><span>.getBytes</span><span> </span><span>$</span><span>))</span><span>\n</span><span>(</span><span>get</span><span> </span><span>$</span><span> </span><span>:out</span><span>)))}))</span><span>\n</span><span>;; Writing the actual post in the right format is pretty simple.</span><span>\n</span><span>;; The first three lines are the title, author (required although not used) and</span><span>\n</span><span>the</span><span> </span><span>publish</span><span> </span><span>date.</span><span>\n</span><span>(</span><span>defn</span><span> </span><span>write-post!</span><span> </span><span>[{</span><span>:keys</span><span> </span><span>[</span><span>title</span><span> </span><span>date</span><span> </span><span>content</span><span> </span><span>slug</span><span>]}]</span><span>\n</span><span>(</span><span>spit</span><span> </span><span>(</span><span>fs/file</span><span> </span><span>&quot;posts&quot;</span><span> </span><span>(</span><span>str</span><span> </span><span>slug</span><span> </span><span>&quot;.adoc&quot;</span><span>))</span><span>\n</span><span>(</span><span>str</span><span> </span><span>&quot;= &quot;</span><span> </span><span>title</span><span> </span><span>&quot;\\n&quot;</span><span>\n</span><span>&quot;Oliver Caldwell\\n&quot;</span><span>\n</span><span>date</span><span> </span><span>&quot;\\n\\n&quot;</span><span>\n</span><span>content</span><span>)))</span><span>\n</span><span>;; Finally, we kick everything off by finding posts in a sibling project I have cloned locally.</span><span>\n</span><span>(</span><span>comment</span><span>\n</span><span>(</span><span>->></span><span> </span><span>(</span><span>legacy-post-paths</span><span> </span><span>&quot;../olical.github.io&quot;</span><span>)</span><span>\n</span><span>(</span><span>map</span><span> </span><span>->post-data</span><span>)</span><span>\n</span><span>(</span><span>run!</span><span> </span><span>write-post!</span><span>)))</span></code></pre>\n</div>\n</div>\n<div>\n<p>It’s fairly long but quite straightforward, feel free to take this code and adapt it for your own purposes!</p>\n</div>\n</div>\n</div>\n<div>\n<h2>Development workflow</h2>\n<div>\n<div>\n<p>While working on the templates, Clojure or posts I ended up with three terminals running three different <code>make</code> commands.</p>\n</div>\n<div>\n<ul>\n<li>\n<p><code>make serve</code> to serve the <code>output</code> directory using Python’s <code>http.server</code> module.</p>\n</li>\n<li>\n<p><code>make propel</code> to start a REPL with a <a href=\"https://oli.me.uk/clojure-socket-prepl-cookbook\">socket prepl</a> attached, this is nice and easy thanks to <a href=\"https://github.com/Olical/propel\">Propel</a> (<a href=\"https://oli.me.uk/repling-into-projects-with-prepl-and-propel/\">REPLing into projects with prepl and Propel</a>).</p>\n</li>\n<li>\n<p><code>make watch</code> to start watching source files for changes with <a href=\"http://eradman.com/entrproject/\">entr</a>. Any time a file changes it sends <code>(blog.render/render!)</code> to the REPL via the prepl.</p>\n</li>\n</ul>\n</div>\n<div>\n<p>This means every time you change the Clojure, HTML or posts they’ll all be rebuilt in an atomic way. Near enough as soon as you’ve written your file you can refresh the browser to see the result.</p>\n</div>\n<div>\n<p>This entr workflow can be used for a bunch of things including re-running a test or reloading a namespace every time you change a file. If you start your REPL with Propel and the <code>-w</code> argument, the port will be written to <code>.prepl-port</code> (which I’ve configure <a href=\"https://github.com/Olical/conjure\">Conjure</a> to connect to on startup), you can then set up entr with something like this.</p>\n</div>\n<div>\n<div>\n<pre><code>find src <span>test</span> <span>-type</span> f | entr bash <span>-c</span> <span>&quot;echo </span><span>\\&quot;</span><span>(require 'blog.render) (blog.render/render!) :repl/quit</span><span>\\&quot;</span><span> | netcat localhost </span><span>\\$</span><span>(cat .prepl-port)&quot;</span></code></pre>\n</div>\n</div>\n</div>\n</div>\n<div>\n<h2>Reuse</h2>\n<div>\n<div>\n<p>If you like the sound of this simple &quot;compile AsciiDoc with Clojure&quot; approach, go ahead and fork <a href=\"https://github.com/Olical/blog\">Olical/blog</a>. You can easily rewrite the templates and styles after deleting the <code>posts</code> directory contents and replacing it with your own &quot;Hello, World!&quot; post.</p>\n</div>\n<div>\n<p>If a few people started playing with this code and found it really useful I’d even consider ripping the core of it out into some sort of library, I just don’t have the time to do that and steward it right now. If this concept has interested you, come and chat with me on twitter or over email using the links in the footer.</p>\n</div>\n</div>\n</div>",
   :direction "ltr"},
  :updated 1571788800000,
  :entities
  [{:mentions [{:text "HTML"}],
    :id "nlp/f/entity/wd:8811",
    :salienceLevel "about",
    :label "HyperText Markup Language"}
   {:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "WordPress"}],
    :id "nlp/f/entity/wd:13166",
    :salienceLevel "mention",
    :label "WordPress"}
   {:mentions [{:text "src"} {:text "source code"} {:text "source"}],
    :id "nlp/f/entity/wd:128751",
    :salienceLevel "mention",
    :label "source code"}
   {:mentions [{:text "CSS"}],
    :id "nlp/f/entity/wd:46441",
    :salienceLevel "mention",
    :label "Cascading Style Sheets"}],
  :alternate
  [{:href
    "https://oli.me.uk/minimalistic-blogging-with-clojure-and-asciidoc",
    :type "text/html"}],
  :title "Minimalistic blogging with Clojure and AsciiDoc",
  :author "\"(ollie {:on :parens})\"",
  :published-str "Tue Oct 22 17:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16dff84eb13:d4cd951:ad5391a1",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://oli.me.uk/minimalistic-blogging-with-clojure-and-asciidoc",
  :commonTopics
  [{:score 157.41015501505493,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1571788800000,
  :fingerprint "5cfa715b",
  :canonicalUrl
  "https://oli.me.uk/minimalistic-blogging-with-clojure-and-asciidoc"}
 {:engagement 9,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1571913907041,
  :recrawled 1571915660677,
  :content
  {:content
   "<div>\n<div>\n<div>\n<p>Hot on the heels of our last Crux\n<a href=\"https://juxt.prod/blog/posts/crux-dev-diary.html\">dev diary</a> we have\npublished <a href=\"https://juxt.pro/blog/posts/crux-jdbc.html\"><code>crux-jdbc</code></a>,\nfacilitating users to quickly get going without committing to a Kafka\ndeployment model. As wrote about in the diary, the JDBC form of Crux\nis aimed at that sweet spot, where users will already likely have a\nrelational data-store setup in place, and the volumes of data may not be\nhigh enough to warrant the up-front Kafka investment.</p>\n</div>\n<div>\n<p>This said, we’re still loving Kafka - Confluent’s\n<a href=\"https://www.confluent.io/confluent-cloud\">managed cloud</a> solution is\nworth considering as a good stepping stone, or even an end solution.</p>\n</div>\n<div>\n<p>Kafka gives you a more authentic separation of concerns that you need\nwith the <em>database inside out</em> approach, to handle vast amounts of\ndata at scale. It is much more than just a message bus used for systems\nintegration - it can be a golden store record of truth that is highly\navailable and easily replayable.</p>\n</div>\n<div>\n<p>To that end, the Crux team has been cooking up a\n<a href=\"https://github.com/juxt/crux/tree/master/crux-kafka-connect\">Crux Kafka\nConnector</a> for ease of plugging Crux into an existing Kafka\ninstallation and for data to be streamed in to produce\nsubsequent bitemporal graph queries. More details to follow.</p>\n</div>\n</div>\n</div>\n<div>\n<h2><a href=\"https://juxt.pro/blog/rss.xml?category=clojure&since=2016-03-13#_community_unbundled\"></a>Community / Unbundled</h2>\n<div>\n<div>\n<p>It’s been great to see so many people playing around with Crux and the\nodd\n<a href=\"https://www.avisi.nl/blog/crux-our-final-database-migration\">case-study</a>\nemerging.</p>\n</div>\n<div>\n<p>Crux is unbundled and open source, and so we always hoped that people\nwould start building out their own modules and different ways of using\nit. So far, we’ve seen Crux built to use\n<a href=\"https://github.com/avisi-apps/crux-active-objects\">Active Objects</a> as\nthe event-log (mirroring the recent JDBC effort),\n<a href=\"https://github.com/avisi-apps/crux-xodus\">Xodus</a> as the node-local K/V\nstore, and there have been experiments such as running on top of\n<a href=\"https://github.com/csm/crux-aws\">AWS SQS</a> and using\n<a href=\"https://github.com/souenzzo/graph-demo\">Pathom/Fulcro</a>. There have been\nmany other conversations about what underlying tools and platforms\ncould support a running Crux setup and so hopefully more community\ncontributions will continue to blossom out.</p>\n</div>\n<div>\n<p>To help with this - as part of the most recent release - we have\nchanged the API and have introduced the concept of node <em>topologies</em>\nso that Crux is more easily configurable.</p>\n</div>\n<div>\n<p>Before, the api had functions such as <code>start-jdbc-node</code>, but now there’s a\nsingle <code>start-node</code> entry function that takes an options map, one of\nthose options being <code>crux.node/topology</code>. Officially supported\ntopologies are currently:</p>\n</div>\n<div>\n<ul>\n<li>\n<p><code>crux.kafka/topology</code></p>\n</li>\n<li>\n<p><code>crux.jdbc/topology</code></p>\n</li>\n<li>\n<p><code>crux.standalone/topology</code>.</p>\n</li>\n</ul>\n</div>\n<div>\n<p>A topology specifies a map of modules that are needed to construct a\ntopology. A module can now specify what options it takes, the default\nvalues, validation functions, and parse functions, if Crux is to be\nrun from the CLI. Configuration options can also be used to\noverride modules within a topology.</p>\n</div>\n<div>\n<p>Our hope is that this configuration approach makes it easier to extend\nCrux and to play about with new variants of Crux topologies, embracing\nthe unbundled approach.</p>\n</div>\n<div>\n<p>Below is an example of a properties file for a Kafka node:</p>\n</div>\n<div>\n<div>\n<pre><code>crux.node/topology = crux.kafka/topology\ncrux.node/kv-store = crux.kv.rocksdb/kv\ncrux.standalone/event-log-dir = data/eventlog\ncrux.kv/db-dir = data/db-dir\ncrux.kafka/bootstrap-servers = localhost:9092\ncrux.kafka/tx-topic = crux-transaction-log\ncrux.kafka/doc-topic = crux-docs\ncrux.kafka/create-topics = true\ncrux.kafka/doc-partitions = 6\ncrux.kafka/replication-factor = 3</code></pre>\n</div>\n</div>\n</div>\n</div>\n<div>\n<h2><a href=\"https://juxt.pro/blog/rss.xml?category=clojure&since=2016-03-13#_on_tour\"></a>On Tour</h2>\n<div>\n<div>\n<p>We’ve gone on tour to talk about Crux. Håkan gave a talk at ClojuTRE on the\n<a href=\"https://www.youtube.com/watch?v=YjAVsvYGbuU\">Design and Implementaton\nof a Bitemporal Database</a>. The last time he had visited Helsinki was\nfor Assembly94.</p>\n</div>\n<div>\n<div>\n<img alt=\"Håkan Råberg talking about the internals of Crux\" src=\"https://juxt.pro/img/clojutre-2019/hakan-raberg.jpg\">\n</div>\n<div>Håkan Råberg talking about the internals of Crux</div>\n</div>\n<div>\n<p>Joanna gave a Crux tutorial at ClojuTRE, gracefully added to the\nschedule by our friends at Metosin.</p>\n</div>\n<div>\n<p>Jeremy and I talked about\n<a href=\"https://www.youtube.com/watch?v=ykbYNBE-V3k\">Event Streaming\nArchitectures and Temporal Databases</a> at Strange Loop. Jeremy also ran\nan unsession that was well attended.</p>\n</div>\n<div>\n<div>\n<img alt=\"Jeremy at Strange Loop 2019 talking about Crux\" width=\"500px\" src=\"https://juxt.pro/img/crux-sl.jpg\">\n</div>\n<div>Jeremy at Strange Loop 2019 talking about Crux</div>\n</div>\n<div>\n<p>The JUXT team have run training workshops at Heart of Clojure and we\ngave a talk to our friends at 'Scala in the City' hosted by Revolut at Canary Wharf.</p>\n</div>\n<div>\n<div>\n<img alt=\"Heart of Clojure Crux Walkthrough\" width=\"500px\" src=\"https://juxt.pro/img/crux-hoj-tutorial.jpg\">\n</div>\n<div>Heart of Clojure Crux Walkthrough</div>\n</div>\n<div>\n<p>It’s been a fun journey since launch, but our thoughts now are turning\nto the medium and long term future.</p>\n</div>\n</div>\n</div>\n<div>\n<h2><a href=\"https://juxt.pro/blog/rss.xml?category=clojure&since=2016-03-13#_the_future\"></a>The Future</h2>\n<div>\n<div>\n<p>We are growing the Crux team with some exciting full-time additions\nand we are creating a new London based development center, that will\nbe where future versions of Crux core will be built from. When we\nformally start the BETA program in the next 2-3 months, we will do so\nwith a global support capability including North America, Europe and\nAustralia.</p>\n</div>\n<div>\n<p>We have been looking long and hard at the roadmap and we’ve got\nexciting plans for Crux and extending its range of functionality.</p>\n</div>\n<div>\n<p>First though we will be entering a formal BETA program and we will\ninviting partners to join. As part of the BETA we want to see and\nunderstand how Crux is performing in more production installations\nand of what improvements we will need to make.</p>\n</div>\n<div>\n<p>If you want to simply get started with Crux, checkout\nJoanna’s <a href=\"https://juxt.pro/blog/posts/crux-tutorial-setup.html\">adventure of Time and Space</a> or Ivan’s <a href=\"https://juxt.pro/blog/posts/a-bitemporal-tale.html\">bitemporal tale</a>.</p>\n</div>\n<div>\n<p>Thanks for reading this journal. Come along and say hi:</p>\n</div>\n<div>\n<ul>\n<li>\n<p><a href=\"https://juxt-oss.zulipchat.com/#narrow/stream/194466-crux\">Zulip</a></p>\n</li>\n<li>\n<p><a href=\"https://clojurians.slack.com/messages/crux\">#crux on the Clojurians slack</a></p>\n</li>\n<li>\n<p><a href=\"mailto:crux@juxt.pro\">crux@juxt.pro</a></p>\n</li>\n</ul>\n</div>\n</div>\n</div>",
   :direction "ltr"},
  :updated 1571911200000,
  :entities
  [{:mentions [{:text "Crux"}],
    :id "nlp/f/entity/wd:10542",
    :salienceLevel "about",
    :label "Crux"}
   {:mentions [{:text "JDBC"}],
    :id "nlp/f/entity/wd:722772",
    :salienceLevel "mention",
    :label "Java Database Connectivity"}
   {:mentions [{:text "API"}],
    :id "nlp/f/entity/wd:165194",
    :salienceLevel "mention",
    :label "application programming interface"}
   {:mentions [{:text "BETA"}],
    :id "nlp/f/entity/wd:830842",
    :salienceLevel "mention",
    :label "BETA"}
   {:mentions [{:text "separation of concerns"}],
    :id "nlp/f/entity/wd:2465506",
    :salienceLevel "mention",
    :label "separation of concerns"}],
  :alternate
  [{:href
    "https://juxt.pro/blog/posts/crux-dev-diary-october-2019.html",
    :type "text/html"}],
  :title "Crux Development Diary",
  :author "The JUXT Blog",
  :published-str "Thu Oct 24 03:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16dfd5ebb61:d1a8648:ad5391a1",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url "https://juxt.pro/img/crux-sl.jpg",
   :width 3648,
   :height 2736,
   :contentType "image/jpeg"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://juxt.pro/blog/posts/crux-dev-diary-october-2019.html",
  :updateCount 1,
  :commonTopics
  [{:score 56.04882622127348,
    :id "nlp/f/topic/3032",
    :salienceLevel "about",
    :label "astronomy"}
   {:score 33.90215136304398,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1571911200000,
  :fingerprint "dcd03e31",
  :canonicalUrl
  "https://juxt.pro/blog/posts/crux-dev-diary-october-2019.html"}
 {:engagement 5,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1571899019867,
  :content
  {:content
   "<p>Computer commercialization set research back decades and we still haven’t recovered. I explore why that is and end on some hopeful notes.</p>\n<p></p>\n<div>\n<div><span></span><img alt=\"Video Thumbnail\" src=\"https://i.ytimg.com/vi/QyApxtkMGg8/mqdefault.jpg\"><p></p>\n<h5>The commercialization of computers</h5>\n<p><span>Computer commercialization set research back decades and we still haven't recovered. I explore why that is and end on some hopeful notes. https://share.transistor.fm/e/11cc5d96 https://www.youtube.com/watch?v=QyApxtkMGg8 Transcript Eric Normand: Why are there no new ideas in computing? By the end of</span></p></div>\n</div>\n<h2>Transcript</h2>\n<p>Eric Normand: Why are there no new ideas in computing? By the end of this episode, I hope to explore this idea. Something I’ve been thinking about a lot that there is this golden age in the ’60s and ’70s when a whole bunch of stuff got invented. Now, we took some steps back and we’re still uncovering all that stuff. What happened?</p>\n<p>My name is Eric Normand and I help people thrive with functional programming.</p>\n<p>There’s a stack overflow question about something that Alan Kay said that there are no new inventions in computing since 1980.</p>\n<p>To a lot of us, that’s pretty surprising because we work in computing and we feel like new stuff is coming out all the time. The person who was asking was like, “What does he mean by this?” He answered. Alan Kay answered the question himself.</p>\n<p>He set it out as a challenge like what are the things that you think are new? [laughs] A lot of question or answers came in to his challenge. He said, “Well, but in 1967 there was a paper where they talked about that, you know. Maybe this is a new implementation, you know, it has a lot of practical improvements, but it’s the same idea but newer.”</p>\n<p>He just goes down the list. People coming up with ideas and he just says, “Well, you know, here’s the paper.” What’s going on? Why is it that things stopped and we’re still trying to catch up to where people were back then?</p>\n<p>Alan Kay has mentioned it before. I didn’t really understand it. I’ve been thinking about it, researching it. The best answer I can come up with…I mean, something I just think about all the time is the microcomputer revolution.</p>\n<p>The commercialization of microcomputers has really set us back. It set us forward because we have cheap computers now, because they became consumer grade. I don’t know how many computers I owned, I stopped counting.</p>\n<p>There’s computers in so many devices now. That wasn’t the case when microcomputers first came out. We have all this new computing power. I can go onto Amazon and start up computers in the cloud, as many as I can afford, and they’re not expensive.</p>\n<p>It’s amazing. We have all this great power, but the systems we use, the programming languages, the operating systems, the software, is all from this time. It all stems from this time when we had to rebuild everything.</p>\n<p>Imagine you were a researcher at a university and you had, maybe not a mainframe, but you had a mini computer. Not a microcomputer, but a step up, or a magnitude bigger than what was available, like in an Apple II.</p>\n<p>It’s a powerful computer for the time. It cost thousands of dollars, like $40,000-$50,000 dollars, in the dollars of the time, so pretty expensive. You could do research on it. You could work in an advanced language with a compiler, with a decent editor.</p>\n<p>You then look at this microcomputer that has no compiler, the language on it is basic. If you need to do anything sophisticated, you have to go down to assembly. You would look at it and say, “I can’t do the algorithm research that I’m working on at work or in my job on this small computer.”</p>\n<p>Here’s another way to look at it. Steve Jobs went to Xerox PARC and saw the Smalltalk system that Alan Kay’s team had developed, and was blown away by it. Smalltalk was running on a $30,000 machine that took up the whole desk and had these big tapes for storing your project on, you have to load in the tape.</p>\n<p>Once it was all loaded, it was very interactive. You had a mouse and you could change the code as it’s running and move documents around and stuff like that. It was a big inspiration for the Macintosh. From there, Windows and everything we use today…</p>\n<p>The Smalltalk system had this really advanced language and object-oriented language in the ’70s that you could click on anything, see the code for how it worked, modify it, hit save, and then the behavior of the system right there in front of your eyes. No recompilation step or anything, it would just be different.</p>\n<p>In fact, they did this in the demo, but Steve Jobs missed it. The other programmers that were with him from Apple saw it. Anyway, what’s important is that when they went back and said, “We got to put this on the Macintosh,” what did they develop it in? Assembly.</p>\n<p>They made a pretty nice GUI, for what could run on the hardware that they had, the commodity, consumer hardware that they were making. They wrote it in assembly. You couldn’t change any code on it. It was a very dumbed-down system.</p>\n<p>They had to, to make it fit on the hardware that they expected people to be able to afford. It’s that kind of down step that we took from this expressive, super forward looking system, the Smalltalk system down to a system that yes, made it easier to use, yes, it had a lot of nice things about it.</p>\n<p>In terms of a programming machine, and advanced concepts like being able to modify code and understand how every piece of the system worked, it was a big down step. Backward step, if you will.</p>\n<p>Over time, the computers, that microcomputers that were commodity hardware that were produced, eventually, they caught up to where the Alto was. That’s what the Smalltalk system was running on. They were much cheaper, but the programming systems did not.</p>\n<p>The programming systems, maybe they’re not an assembly anymore, they’re in C or objective C or what have you. They never took that leap and said, “Wait, we can run Smalltalk now. Let’s start over and reinvent what we have from that beginning.”</p>\n<p>They needed to sell every year. They were a business. They needed to commercialize this, and they didn’t want to start over. People were learning the GUI. They didn’t want to have to say, “Well, here’s a new GUI that we invented for you,” because people had invested in training their staff.</p>\n<p>They didn’t want to have to retrain them on the new GUI. Right? There’s all these investment and sunk costs that are going into it. They couldn’t change it.</p>\n<p>They can make income incremental improvements, but they couldn’t say, “Whoa, wait, let’s stop because we could do what they were doing in the ’70s now on our hardware, and will we would be like, basically where they were with this advanced expensive computer, we could do that on our cheap commodity computer,” but no one’s ever done that.</p>\n<p>It’s odd that no one’s ever done it, but you can see why. It’s because they’re always trying to get the next release out, just adding features, adding features. They’re never doing the big rewrite. Big rewrites are expensive. They’re risky, just keep coming out with the next thing.</p>\n<p>We find ourselves in 2019. That’s when I’m recording this. I have devices here that have operating systems that don’t have some of the features that Smalltalk had back in the day. I can’t click on anything and change how it works.</p>\n<p>The software rewrite for them in general is still from the batch-computing era, where we submit a program to a compiler which compiles it, generates an executable. We have to basically start the whole thing over.</p>\n<p>It does not provide objects that I can interact with in the same way that a Smalltalk system had. Any Smalltalk object would have methods that you would call, messages you could pass it.</p>\n<p>As an example, I’m recording this on my computer here. I’ve got a window open. You can’t see this, but I’m going to talk about it. I’ve got a window open. It’s the QuickTime player. It’s what it’s called. It’s a piece of software that records video.</p>\n<p>How do I get the frames out of this? Shouldn’t there be an interface to this object on the screen that lets me query it for a frame in a certain time? How do I get the raw stream of…? It can talk to the camera. This QuickTime player can talk to the camera. How do I get the raw stream of frames out? It somehow knows how to do it.</p>\n<p>I want to use the encoding that the QuickTime player knows how to use. I basically don’t own this software. There’s only a hundred things I can do through a mouse-driven interface. Yes, there’s keyboard shortcuts. That’s not what I’m talking about. I cannot write software that interacts with this software. I can’t change how this software works.</p>\n<p>They could do that in the ’70s on the Smalltalk systems. To this day, when you get Smalltalk software, they give you the source code, or they give you an image that contains the whole thing. It’s everything. “Here’s our software.” You can start to mess with it. You change it. You make it do what you want it to do.</p>\n<p>I think it’s a total shame because we get this software…I’m thinking about video editing software. Final Cut Pro, that’s what I use sometimes. I want to change it. I want to make it different, and I can’t. I have to learn how it wants me to work with video. I want to work with it in a different way, and that doesn’t count.</p>\n<p>It’s my computer. I paid for it. It’s my software. I paid for it, and I can’t modify it. We took this huge step back. A lot of ideas are now reaching the light of day. People are reading the old papers because they’re on the Internet now. That’s a good thing. People are talking about them. There’s conferences about old papers.</p>\n<p>People are implementing the ideas in their favorite programming languages. That’s awesome, but I still feel like that’s just piecemeal. We need a revolution. We need to start over. We need something to reset where we are.</p>\n<p>These computers, this thing on my desk is way more powerful than an Alto from 1970. It’s ridiculous. It costs way less, even in accounting for inflation, especially accounting for inflation. It’s not as powerful in the sense of giving me power as a user.</p>\n<p>Of course, it’s not going to happen because Final Cut Pro costs something like $300. If they let you develop your own editing software in an easy way, meaning what if Final Cut Pro was a bunch of objects?</p>\n<p>What if it was not full suite that has a fixed interface? What if it was a bunch of objects that you could program together? I’ve seen the Smalltalk demos. They were editing video then in the ’70s. It was a simple interface. They’re like, “Oh, let me throw something together to help me make this video I just recorded.”</p>\n<p>They threw it together. That’s what I want to be able to do. Well, this is turning into a really downer episode. I don’t want to end on a negative note. The industry is growing, but it started growing so fast when those microcomputers came out. It’s been doubling very quickly.</p>\n<p>The number of researchers…There were COBOL programmers back then working on mainframes and stuff. Those are run-of-the-mill Code Monkeys, I have to say it. They’re just people getting a job done, making some banking software, getting the business automated, whatever they’re doing. They’re not computer researchers. They’re engineers.</p>\n<p>The number of computer researchers was really small. They did amazing stuff like the Xerox PARC stuff. That’s worth trillions of dollars now. It’s added that much to the economy. Now, as this wave of programmers just expanding…It’s just growing, doubling every five years. That’s what I’ve heard. I don’t know if that’s true. It’s growing in a fast rate. Everyone knows that.</p>\n<p>So fast, universities can’t keep up. Boot camps are popping up because there’s so many people who want to learn and are willing to pay a lot of money. Anyway, there are people who grew up in industry as part of this wave who are becoming aware that there was a time before microcomputing.</p>\n<p>Those people are starting new projects. They’re doing the required background research. They’re looking back into how we got where we are and what was going on before. I hope one day to count myself among them, but I can’t really right now. I don’t have the time to read all the stuff I need to read. I am somewhat aware that this is a problem.</p>\n<p>I’m hopeful that the number of people who can work on this, who dedicate time to it, do computer research like it was done before the microcomputer revolution. I’m hopeful that something new is going to come out of it. Might take 20 years. Might take 50 years, but the commercialization has just been so rapid and huge, right?</p>\n<p>It’s just this huge wave. It’s overtaken any of that prior research. Maybe it’s even happening in the same scale. It just looks tiny and you can’t see it compared to all of the new versions of this software that comes out and, “Oh look. A new OS version came out,” and like, “Oh, look at this cool new hardware.”</p>\n<p>There’s things like the end of Moore’s law. The end of Moore’s law means that maybe Intel doesn’t have the advantage that it once had. It used to be that Intel would just keep working on making the same kind of processors but with more transistors. Same architecture. They advanced it but the same architecture.</p>\n<p>They knew it was flawed. They weren’t happy with the architecture but just because of the commercialization — this is was what was selling, this is what was making money — so we’re going to keep making them. They tried other things. They tried other chips, other architectures, but they weren’t as successful, so they dropped them.</p>\n<p>Now they would just wait six months and this processor would be twice as fast. Any kind of custom architecture that was custom designed for a certain problem or a certain kind of language, these custom architectures that could use more clever things to make it go faster in certain cases, the Intel stuff would just double just by making the transistor smaller.</p>\n<p>Any advantage you had with cool architectures, it didn’t matter. Now at the end of Moore’s law, maybe that’s mattering more and more. We see it with Apple. They’re coming out with these custom chips like for those AirPods. Maybe they have different architectures in there that allow them to be smaller, lower energy, et cetera. That could be a thing.</p>\n<p>There’s also so much computing resources available. I feel like something could happen there. Maybe we will realize that we can start, I guess I want to say doing stuff that looks wasteful from the old paradigm but in the new paradigm it makes sense because there’s like a vast cloud of computers waiting to run your code. I don’t know about that, but I feel like there could be something there.</p>\n<p>There’s the no-code movement that looks very hopeful to me, and I’m optimistic. The timeframe, I’m not optimistic about. [laughs] I want it now. I don’t want to wait 25 years, but things have to take the time that they take.</p>\n<p>Awesome. I hope I haven’t bummed you out. I hope I ended on a positive enough note because I am hopeful. I just think that we took a huge down-step to build up this industry and we’re only now realizing collectively how bad that back-step was and how we still haven’t caught up to where they were.</p>\n<p>We are realizing it, and more and more people are realizing it. There are conferences talking about it. There are conferences talking about the papers. A lot of the papers that people bring up are old papers from a long time ago when this stuff was invented.</p>\n<p>Yes, thank you. If you like this episode, you can go to lispcast.com/podcast, and there you’ll find all the old episode with audio, video and text transcripts. You’ll also find links to subscribe in whatever format you want and also links to find me on social media where I’d love to get into a discussion with you about this topic.</p>\n<p>This has been my thought on functional programming. My name is Eric Normand. Thank you for listening, and rock on.</p>\n<h2>Transcript</h2>\n<p>Eric Normand: Why are there no new ideas in computing? By the end of this episode, I hope to explore this idea. Something I’ve been thinking about a lot that there is this golden age in the ’60s and ’70s when a whole bunch of stuff got invented. Now, we took some steps back and we’re still uncovering all that stuff. What happened?</p>\n<p>My name is Eric Normand and I help people thrive with functional programming.</p>\n<p>There’s a stack overflow question about something that Alan Kay said that there are no new inventions in computing since 1980.</p>\n<p>To a lot of us, that’s pretty surprising because we work in computing and we feel like new stuff is coming out all the time. The person who was asking was like, “What does he mean by this?” He answered. Alan Kay answered the question himself.</p>\n<p>He set it out as a challenge like what are the things that you think are new? [laughs] A lot of question or answers came in to his challenge. He said, “Well, but in 1967 there was a paper where they talked about that, you know. Maybe this is a new implementation, you know, it has a lot of practical improvements, but it’s the same idea but newer.”</p>\n<p>He just goes down the list. People coming up with ideas and he just says, “Well, you know, here’s the paper.” What’s going on? Why is it that things stopped and we’re still trying to catch up to where people were back then?</p>\n<p>Alan Kay has mentioned it before. I didn’t really understand it. I’ve been thinking about it, researching it. The best answer I can come up with…I mean, something I just think about all the time is the microcomputer revolution.</p>\n<p>The commercialization of microcomputers has really set us back. It set us forward because we have cheap computers now, because they became consumer grade. I don’t know how many computers I owned, I stopped counting.</p>\n<p>There’s computers in so many devices now. That wasn’t the case when microcomputers first came out. We have all this new computing power. I can go onto Amazon and start up computers in the cloud, as many as I can afford, and they’re not expensive.</p>\n<p>It’s amazing. We have all this great power, but the systems we use, the programming languages, the operating systems, the software, is all from this time. It all stems from this time when we had to rebuild everything.</p>\n<p>Imagine you were a researcher at a university and you had, maybe not a mainframe, but you had a mini computer. Not a microcomputer, but a step up, or a magnitude bigger than what was available, like in an Apple II.</p>\n<p>It’s a powerful computer for the time. It cost thousands of dollars, like $40,000-$50,000 dollars, in the dollars of the time, so pretty expensive. You could do research on it. You could work in an advanced language with a compiler, with a decent editor.</p>\n<p>You then look at this microcomputer that has no compiler, the language on it is basic. If you need to do anything sophisticated, you have to go down to assembly. You would look at it and say, “I can’t do the algorithm research that I’m working on at work or in my job on this small computer.”</p>\n<p>Here’s another way to look at it. Steve Jobs went to Xerox PARC and saw the Smalltalk system that Alan Kay’s team had developed, and was blown away by it. Smalltalk was running on a $30,000 machine that took up the whole desk and had these big tapes for storing your project on, you have to load in the tape.</p>\n<p>Once it was all loaded, it was very interactive. You had a mouse and you could change the code as it’s running and move documents around and stuff like that. It was a big inspiration for the Macintosh. From there, Windows and everything we use today…</p>\n<p>The Smalltalk system had this really advanced language and object-oriented language in the ’70s that you could click on anything, see the code for how it worked, modify it, hit save, and then the behavior of the system right there in front of your eyes. No recompilation step or anything, it would just be different.</p>\n<p>In fact, they did this in the demo, but Steve Jobs missed it. The other programmers that were with him from Apple saw it. Anyway, what’s important is that when they went back and said, “We got to put this on the Macintosh,” what did they develop it in? Assembly.</p>\n<p>They made a pretty nice GUI, for what could run on the hardware that they had, the commodity, consumer hardware that they were making. They wrote it in assembly. You couldn’t change any code on it. It was a very dumbed-down system.</p>\n<p>They had to, to make it fit on the hardware that they expected people to be able to afford. It’s that kind of down step that we took from this expressive, super forward looking system, the Smalltalk system down to a system that yes, made it easier to use, yes, it had a lot of nice things about it.</p>\n<p>In terms of a programming machine, and advanced concepts like being able to modify code and understand how every piece of the system worked, it was a big down step. Backward step, if you will.</p>\n<p>Over time, the computers, that microcomputers that were commodity hardware that were produced, eventually, they caught up to where the Alto was. That’s what the Smalltalk system was running on. They were much cheaper, but the programming systems did not.</p>\n<p>The programming systems, maybe they’re not an assembly anymore, they’re in C or objective C or what have you. They never took that leap and said, “Wait, we can run Smalltalk now. Let’s start over and reinvent what we have from that beginning.”</p>\n<p>They needed to sell every year. They were a business. They needed to commercialize this, and they didn’t want to start over. People were learning the GUI. They didn’t want to have to say, “Well, here’s a new GUI that we invented for you,” because people had invested in training their staff.</p>\n<p>They didn’t want to have to retrain them on the new GUI. Right? There’s all these investment and sunk costs that are going into it. They couldn’t change it.</p>\n<p>They can make income incremental improvements, but they couldn’t say, “Whoa, wait, let’s stop because we could do what they were doing in the ’70s now on our hardware, and will we would be like, basically where they were with this advanced expensive computer, we could do that on our cheap commodity computer,” but no one’s ever done that.</p>\n<p>It’s odd that no one’s ever done it, but you can see why. It’s because they’re always trying to get the next release out, just adding features, adding features. They’re never doing the big rewrite. Big rewrites are expensive. They’re risky, just keep coming out with the next thing.</p>\n<p>We find ourselves in 2019. That’s when I’m recording this. I have devices here that have operating systems that don’t have some of the features that Smalltalk had back in the day. I can’t click on anything and change how it works.</p>\n<p>The software rewrite for them in general is still from the batch-computing era, where we submit a program to a compiler which compiles it, generates an executable. We have to basically start the whole thing over.</p>\n<p>It does not provide objects that I can interact with in the same way that a Smalltalk system had. Any Smalltalk object would have methods that you would call, messages you could pass it.</p>\n<p>As an example, I’m recording this on my computer here. I’ve got a window open. You can’t see this, but I’m going to talk about it. I’ve got a window open. It’s the QuickTime player. It’s what it’s called. It’s a piece of software that records video.</p>\n<p>How do I get the frames out of this? Shouldn’t there be an interface to this object on the screen that lets me query it for a frame in a certain time? How do I get the raw stream of…? It can talk to the camera. This QuickTime player can talk to the camera. How do I get the raw stream of frames out? It somehow knows how to do it.</p>\n<p>I want to use the encoding that the QuickTime player knows how to use. I basically don’t own this software. There’s only a hundred things I can do through a mouse-driven interface. Yes, there’s keyboard shortcuts. That’s not what I’m talking about. I cannot write software that interacts with this software. I can’t change how this software works.</p>\n<p>They could do that in the ’70s on the Smalltalk systems. To this day, when you get Smalltalk software, they give you the source code, or they give you an image that contains the whole thing. It’s everything. “Here’s our software.” You can start to mess with it. You change it. You make it do what you want it to do.</p>\n<p>I think it’s a total shame because we get this software…I’m thinking about video editing software. Final Cut Pro, that’s what I use sometimes. I want to change it. I want to make it different, and I can’t. I have to learn how it wants me to work with video. I want to work with it in a different way, and that doesn’t count.</p>\n<p>It’s my computer. I paid for it. It’s my software. I paid for it, and I can’t modify it. We took this huge step back. A lot of ideas are now reaching the light of day. People are reading the old papers because they’re on the Internet now. That’s a good thing. People are talking about them. There’s conferences about old papers.</p>\n<p>People are implementing the ideas in their favorite programming languages. That’s awesome, but I still feel like that’s just piecemeal. We need a revolution. We need to start over. We need something to reset where we are.</p>\n<p>These computers, this thing on my desk is way more powerful than an Alto from 1970. It’s ridiculous. It costs way less, even in accounting for inflation, especially accounting for inflation. It’s not as powerful in the sense of giving me power as a user.</p>\n<p>Of course, it’s not going to happen because Final Cut Pro costs something like $300. If they let you develop your own editing software in an easy way, meaning what if Final Cut Pro was a bunch of objects?</p>\n<p>What if it was not full suite that has a fixed interface? What if it was a bunch of objects that you could program together? I’ve seen the Smalltalk demos. They were editing video then in the ’70s. It was a simple interface. They’re like, “Oh, let me throw something together to help me make this video I just recorded.”</p>\n<p>They threw it together. That’s what I want to be able to do. Well, this is turning into a really downer episode. I don’t want to end on a negative note. The industry is growing, but it started growing so fast when those microcomputers came out. It’s been doubling very quickly.</p>\n<p>The number of researchers…There were COBOL programmers back then working on mainframes and stuff. Those are run-of-the-mill Code Monkeys, I have to say it. They’re just people getting a job done, making some banking software, getting the business automated, whatever they’re doing. They’re not computer researchers. They’re engineers.</p>\n<p>The number of computer researchers was really small. They did amazing stuff like the Xerox PARC stuff. That’s worth trillions of dollars now. It’s added that much to the economy. Now, as this wave of programmers just expanding…It’s just growing, doubling every five years. That’s what I’ve heard. I don’t know if that’s true. It’s growing in a fast rate. Everyone knows that.</p>\n<p>So fast, universities can’t keep up. Boot camps are popping up because there’s so many people who want to learn and are willing to pay a lot of money. Anyway, there are people who grew up in industry as part of this wave who are becoming aware that there was a time before microcomputing.</p>\n<p>Those people are starting new projects. They’re doing the required background research. They’re looking back into how we got where we are and what was going on before. I hope one day to count myself among them, but I can’t really right now. I don’t have the time to read all the stuff I need to read. I am somewhat aware that this is a problem.</p>\n<p>I’m hopeful that the number of people who can work on this, who dedicate time to it, do computer research like it was done before the microcomputer revolution. I’m hopeful that something new is going to come out of it. Might take 20 years. Might take 50 years, but the commercialization has just been so rapid and huge, right?</p>\n<p>It’s just this huge wave. It’s overtaken any of that prior research. Maybe it’s even happening in the same scale. It just looks tiny and you can’t see it compared to all of the new versions of this software that comes out and, “Oh look. A new OS version came out,” and like, “Oh, look at this cool new hardware.”</p>\n<p>There’s things like the end of Moore’s law. The end of Moore’s law means that maybe Intel doesn’t have the advantage that it once had. It used to be that Intel would just keep working on making the same kind of processors but with more transistors. Same architecture. They advanced it but the same architecture.</p>\n<p>They knew it was flawed. They weren’t happy with the architecture but just because of the commercialization — this is was what was selling, this is what was making money — so we’re going to keep making them. They tried other things. They tried other chips, other architectures, but they weren’t as successful, so they dropped them.</p>\n<p>Now they would just wait six months and this processor would be twice as fast. Any kind of custom architecture that was custom designed for a certain problem or a certain kind of language, these custom architectures that could use more clever things to make it go faster in certain cases, the Intel stuff would just double just by making the transistor smaller.</p>\n<p>Any advantage you had with cool architectures, it didn’t matter. Now at the end of Moore’s law, maybe that’s mattering more and more. We see it with Apple. They’re coming out with these custom chips like for those AirPods. Maybe they have different architectures in there that allow them to be smaller, lower energy, et cetera. That could be a thing.</p>\n<p>There’s also so much computing resources available. I feel like something could happen there. Maybe we will realize that we can start, I guess I want to say doing stuff that looks wasteful from the old paradigm but in the new paradigm it makes sense because there’s like a vast cloud of computers waiting to run your code. I don’t know about that, but I feel like there could be something there.</p>\n<p>There’s the no-code movement that looks very hopeful to me, and I’m optimistic. The timeframe, I’m not optimistic about. [laughs] I want it now. I don’t want to wait 25 years, but things have to take the time that they take.</p>\n<p>Awesome. I hope I haven’t bummed you out. I hope I ended on a positive enough note because I am hopeful. I just think that we took a huge down-step to build up this industry and we’re only now realizing collectively how bad that back-step was and how we still haven’t caught up to where they were.</p>\n<p>We are realizing it, and more and more people are realizing it. There are conferences talking about it. There are conferences talking about the papers. A lot of the papers that people bring up are old papers from a long time ago when this stuff was invented.</p>\n<p>Yes, thank you. If you like this episode, you can go to lispcast.com/podcast, and there you’ll find all the old episode with audio, video and text transcripts. You’ll also find links to subscribe in whatever format you want and also links to find me on social media where I’d love to get into a discussion with you about this topic.</p>\n<p>This has been my thought on functional programming. My name is Eric Normand. Thank you for listening, and rock on.</p>\n<p>The post <a rel=\"nofollow\" href=\"https://lispcast.com/the-commercialization-of-computers/\">The commercialization of computers</a> appeared first on <a rel=\"nofollow\" href=\"https://lispcast.com\">LispCast</a>.</p>",
   :direction "ltr"},
  :updated 1571896800000,
  :entities
  [{:mentions [{:text "Alan Kay"}],
    :id "nlp/f/entity/wd:92742",
    :salienceLevel "mention",
    :label "Alan Kay"}
   {:mentions [{:text "Smalltalk"}],
    :id "nlp/f/entity/wd:235086",
    :salienceLevel "mention",
    :label "Smalltalk"}
   {:mentions [{:text "Apple"} {:text "Apple II"}],
    :id "nlp/f/entity/wd:3017175",
    :salienceLevel "mention",
    :label "Apple II"}
   {:mentions [{:text "Steve Jobs"}],
    :id "nlp/f/entity/wd:19837",
    :salienceLevel "mention",
    :label "Steve Jobs"}
   {:mentions [{:text "Moore's law"}],
    :id "nlp/f/entity/wd:178655",
    :salienceLevel "mention",
    :label "Moore's law"}],
  :alternate
  [{:href "https://lispcast.com/the-commercialization-of-computers/",
    :type "text/html"}],
  :title "The commercialization of computers",
  :author "Eric Normand",
  :published-str "Wed Oct 23 23:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16dfc7b925b:d06f0f6:ad5391a1",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url "https://i.ytimg.com/vi/QyApxtkMGg8/mqdefault.jpg",
   :width 320,
   :height 180,
   :contentType "image/jpeg"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://lispcast.com/?p=2067",
  :commonTopics
  [{:score 87.39250970784204,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1571896800000,
  :fingerprint "4afdb6ff",
  :canonicalUrl
  "https://lispcast.com/the-commercialization-of-computers/"}
 {:engagement 5,
  :unread false,
  :crawled 1571817214491,
  :content
  {:content
   "If you’re a programmer, you’re probably fairly comfortable with understanding and interpreting diff patches of the kind that git and other version control systems use. In this post we’ll walk through a Clojure implementation of the Myers’ diff algorithm, which is the algorithm used by Git.\nI have been implementing Git following along James Coglan’s book “Building Git”– you can check out the project here. The project itself is in Rust but I thought it might be an interesting exercise to implement the algorithm in Clojure.",
   :direction "ltr"},
  :updated 1571680080000,
  :entities
  [{:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "about",
    :label "Clojure"}
   {:mentions [{:text "Git"}],
    :id "nlp/f/entity/wd:186055",
    :salienceLevel "about",
    :label "Git"}],
  :alternate
  [{:href "https://samrat.me/posts/2019-10-21-myers-diff-clojure/",
    :type "text/html"}],
  :title "Myers' diff algorithm in Clojure",
  :author "Samrat Man Singh",
  :published-str "Mon Oct 21 10:48:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16df79b521b:cfa2e5e:97b0c8f7",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://samrat.me/posts/2019-10-21-myers-diff-clojure/",
  :commonTopics
  [{:score 201.14857436966895,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1571680080000,
  :fingerprint "241abef8",
  :canonicalUrl
  "https://samrat.me/posts/2019-10-21-myers-diff-clojure/"}
 {:engagement 7,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1571761167092,
  :content
  {:content
   "In the last blog post, we processed the messages from IBM-MQ and relayed the information to the marketplace. In this blog post, we are going to focus on adding cron jobs to our existing infrastructure. The cron jobs pull the data from the marketplace, perform some transformation and send it to the Order Management System(OMS) via IBM-MQ.\nThis blog post is a part 8 of the blog series Building an E-Commerce Marketplace Middleware in Clojure.",
   :direction "ltr"},
  :updated 1571760282000,
  :entities
  [{:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "about",
    :label "Clojure"}
   {:mentions [{:text "IBM MQ"}],
    :id "nlp/f/entity/wd:528294",
    :salienceLevel "about",
    :label "IBM WebSphere MQ"}],
  :alternate
  [{:href
    "https://www.demystifyfp.com/clojure/marketplace-middleware/creating-cron-jobs-in-clojure/",
    :type "text/html"}],
  :title "Creating Cron Jobs in Clojure",
  :author "Demystify FP",
  :published-str "Tue Oct 22 09:04:42 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16df4441af4:cb14b2d:97b0c8f7",
  :visual {:url "none"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://www.demystifyfp.com/clojure/marketplace-middleware/creating-cron-jobs-in-clojure/",
  :commonTopics
  [{:score 48.537073256833295,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1571760282000,
  :fingerprint "a868091b",
  :canonicalUrl
  "https://www.demystifyfp.com/clojure/marketplace-middleware/creating-cron-jobs-in-clojure/"}
 {:engagement 7,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1571714138675,
  :recrawled 1571817214491,
  :content
  {:content
   "Bobby Calderwood talks about banking and financial technology in the US, mainframes, Kafka, and their new platform.. Evident Systems Finxact, Finastra, Mambu, Temenos ACH The Clearing House FedNow Bobby at Finovate Jack Henry Symitar Confluent Commander: Better Distributed Applications through CQRS Event Modelling - Adam Dymitruk Kafka Streams Confluent Schema Registry Kafka KStreams API Jackdaw Willa About Evident Systems",
   :direction "ltr"},
  :updated 1571708193000,
  :entities
  [{:mentions [{:text "the US"}],
    :id "nlp/f/entity/wd:30",
    :salienceLevel "mention",
    :label "United States of America"}],
  :alternate
  [{:href "https://www.therepl.net/episodes/30/", :type "text/html"}],
  :title "30: Bobby Calderwood on Kafka and Fintech",
  :author "Daniel Compton",
  :published-str "Mon Oct 21 18:36:33 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16df1768233:c73db0b:97b0c8f7",
  :visual {:url "none"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://www.therepl.net/episodes/30/",
  :updateCount 1,
  :commonTopics
  [{:score 1.0,
    :id "nlp/f/topic/867",
    :salienceLevel "about",
    :label "fintech"}],
  :published 1571708193000,
  :fingerprint "af3a4c39",
  :canonicalUrl "https://www.therepl.net/episodes/30/"}
 {:engagement 5,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/todo",
    :label "todo"}
   {:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1571653846815,
  :content
  {:content
   "<div>\n<p><em>Issue 349 – October 21, 2019 · <a href=\"https://purelyfunctional.tv/newsletter-archives/\">Archives</a> · <a title=\"Thanks, Jeff!\" href=\"https://purelyfunctional.tv/newsletter/\">Subscribe</a></em></p>\n<h2>Clojure Tip 💡</h2>\n<p><em>monoid pattern</em></p>\n<p>Clojure, and many Lisps before it, has a way of representing monoids. <em>Monoid</em> is a mathematical term for an operation with two properties:</p>\n<ol>\n<li>The operation has an identity, meaning a value that has no effect. For instance, the identity of addition is <code>0</code> because <code>x + 0 = x</code></li>\n<li>The operation’s order of operations don’t matter. For instance, the parentheses don’t matter in this expression: <code>10 + 4 + 5</code>. In other words, `(10</li>\n</ol>\n<ul>\n<li>4) + 5 = 10 + (4 + 5)`</li>\n</ul>\n<p>You can learn more about <a title href=\"https://lispcast.com/what-a-monoid-is-and-why-monoids-kick-monads-butt/\">monoids in a podcast episode</a> I recorded.</p>\n<p>Addition of numbers is a monoid. Clojure represents this with 4 things:</p>\n<pre><code>=> (doc +)\n-------------------------\nclojure.core/+\n([] [x] [x y] [x y &amp; more])\n</code></pre>\n<ol>\n<li>There is the normal 2-argument version that adds them.</li>\n<li>There is a 1-argument version that just returns its argument.</li>\n<li>There is an n-argument version that adds all the arguments.</li>\n<li>There is a 0-argument version that return the identity.</li>\n</ol>\n<p>All of those are possible because it is a monoid.</p>\n<p>Item #1 is just required. #2 is basically derived from the identity <code>(+ 1 0)</code> is the same as <code>(+ 1)</code>. #3 is because it is associative and to alleviate the need for nesting parens. In many languages you would write <code>3 + 4 + 5 +10</code> which would turn into <code>(+ 3 (+ 4 (+ 5 10)))</code> without #3. #4 is a way to get at the identity value.</p>\n<p>Note that they don’t need to be implemented in exactly this way, but the behavior has to be there for the pattern to work.</p>\n<p>We see this in other monoids. Multiplication of numbers is a monoid, and we see the same pattern:</p>\n<pre><code>=> (doc *)\n-------------------------\nclojure.core/*\n([] [x] [x y] [x y &amp; more])\n</code></pre>\n<p>And then there are other things that are monoids but that maybe it’s not as obvious. Try running <code>doc</code> on each of these.</p>\n<pre><code>concat\nstr\ncomp\nset/union\n</code></pre>\n<p>There are probably more.</p>\n<p>Then there are some things which are technically monoids which don’t have the pattern implemented correctly. For instance:</p>\n<pre><code>user=> (merge)\nnil\n</code></pre>\n<p>Hash map merge is a monoid, so it should probably return an empty hash map. The other arities of merge are implemented correctly.</p>\n<p><strong>Takeaway</strong></p>\n<p>Consider if an operation you are writing is a monoid and try to implement the four arities of the monoid pattern. You’re probably using and taking for granted lots of monoids in your software.</p>\n<p><strong>Why are monoids useful?</strong></p>\n<p>Because the order of operations (the parentheses) don’t matter, you can break a problem up in basically arbitrary ways and still be able to put it back together. That means it can be parallelized very easily. Break a list in half, run work on each half-list in separate threads, and concatenate the results back together. This is what lets <code>reducers</code> so effectively use your cores.</p>\n<p>But it goes further. This same property that lets it be put back together easily is useful even on a single thread. Monoids give you a lot of freedom in how you combine them, which lets you optimize design decisions. They also avoid an important corner case (like what to do with no values? just use the identity).</p>\n<h2>Conference alert 🚨</h2>\n<p>I booked my tickets to the 2019 Clojure/conj in Durham, North Carolina this week. If you’re going, let me know! I haven’t been to a conj in a couple of years and I’m really excited.</p>\n<p>I’m also planning on attending a local Elixir conference (The Big Elixir) if you happen to be going to that. In that case, give me a holler!</p>\n<h2>Currently recording 🎥</h2>\n<p>I published two new lessons this week in the Property-Based Testing course.</p>\n<ol>\n<li><a title href=\"https://purelyfunctional.tv/lesson/testing-with-spec-functions/\">Testing with Spec: functions</a>—part two of the Clojure Spec integration. This time we look at how to build tests into the spec itself and what kinds of tests can’t be in the spec.</li>\n<li><a title href=\"https://purelyfunctional.tv/lesson/when-to-test-during-system-design/\">When to test: during system design</a>—we design a small system to make sending an email idempotent. We use PBT to make sure the invariants hold before we implement it. And our result is a model that that we can use to test our real system.</li>\n</ol>\n<p>A note about the course</p>\n<p>The course is way longer than I ever thought it would be. I’m committed to finishing it. However, once I’m done recording, I’m going to split it into at least two courses. It’s just too long. The courses will probably be beginner/advanced, but I haven’t decided yet. I don’t know what lessons will go where. And don’t worry, if you bought the course, you’ll get both of the courses after the split.</p>\n<h2>Clojure Challenge 🤔</h2>\n<h3>Last week’s challenge</h3>\n<p>The challenge in <a title href=\"https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-348-tip-cleanup-in-finally/\">Issue 348</a> was to write a function to run <code>n</code> tasks in parallel.</p>\n<p>You can check out the submissions <a title href=\"https://gist.github.com/ericnormand/2367d395cf5032c785a09ea3c7043f2c\">here</a>.</p>\n<h3>This week’s challenge</h3>\n<p><em>monoid pattern</em></p>\n<p>It strikes me that you can generate functions that implement the monoid pattern knowing only two things: the identity value and the 2-arg case. The other two cases (n-arg and 1-arg) can be calculated for you.</p>\n<p>Your task is to write a function that takes the identity and the 2-arg case and returns a new function that implements the monoid pattern.</p>\n<pre><code>(defn monoid [id fn-2]\n</code></pre>\n<p>I should be able to call it like this:</p>\n<pre><code>(monoid 0 (fn [a b] (+ a b)))\n</code></pre>\n<p>and get an addition monoid out.</p>\n<p>As usual, please send me your implementations. I’ll share them all in next week’s issue. If you send me one, but you don’t want me to share it publicly, please let me know.</p>\n<p>Rock on!<br>Eric Normand</p>\n</div>\n<p>The post <a rel=\"nofollow\" href=\"https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-349-tip-monoid-pattern/\">PurelyFunctional.tv Newsletter 349: Tip: monoid pattern</a> appeared first on <a rel=\"nofollow\" href=\"https://purelyfunctional.tv\">PurelyFunctional.tv</a>.</p>",
   :direction "ltr"},
  :updated 1571652000000,
  :entities
  [{:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "about",
    :label "Clojure"}
   {:mentions [{:text "Elixir"}],
    :id "nlp/f/entity/wd:5362035",
    :salienceLevel "mention",
    :label "Elixir"}
   {:mentions [{:text "Durham, North Carolina"}],
    :id "nlp/f/entity/wd:49229",
    :salienceLevel "mention",
    :label "Durham"}],
  :alternate
  [{:href
    "https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-349-tip-monoid-pattern/",
    :type "text/html"}],
  :title "PurelyFunctional.tv Newsletter 349: Tip: monoid pattern",
  :author "Eric Normand",
  :published-str "Mon Oct 21 03:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16dedde871f:c2146d0:97b0c8f7",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://purelyfunctional.tv/?p=32228",
  :commonTopics
  [{:score 0.5226820681013472,
    :id "nlp/f/topic/10100",
    :salienceLevel "about",
    :label "digest"}],
  :published 1571652000000,
  :fingerprint "902a644",
  :canonicalUrl
  "https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-349-tip-monoid-pattern/"}
 {:engagement 15,
  :unread false,
  :crawled 1571652086399,
  :content
  {:content
   "<p><strong>Help us create a regulated, API-first bank</strong></p>\n<p>Most of the banking world is exclusive, opaque, and not particularly technology-friendly.</p>\n<p>We're trying to change that - we want to lower barriers to entry for fintechs by providing easy access, clear documentation, and transparent pricing.</p>\n<p>We recently closed a £3M seed round and are hiring our first engineers. By joining now you'll have the opportunity to have outsized impact and to also get a large chunk of available equity.</p>\n<p>As a backend engineer you'll be responsible for building out our core banking systems, which are responsible for handling compliance as well as managing accounts and transactions. As a wholesale bank, we're building for scale from day one - our infrastructure has to scale to tens of thousands of requests per second, with all systems fully correct and available. We'll also need fully-functional integrations with a half-dozen different payment rails such as Faster Payments, Direct Debit, CHAPS, and various card networks.</p>\n<p>Our technology stack is Clojure, Kafka, Postgres, and Kubernetes.</p>\n<p><strong>Qualifications</strong></p>\n<p>Some prior Clojure experience is required. Prior devops or security experience is a major plus. Experience with the other parts of our stack is preferred, but not required. Similarly, relevant domain experience in payments or core banking systems is a plus, but not mandatory.</p>\n<p><strong>Local and global</strong></p>\n<p>Our offices are just off Moorgate in central London, but our engineering workforce is distributed. We're currently prioritizing local hires, but are open to remote for exceptional UK/EU/US/Canadian candidates - especially those with a 5 hour or less TZ diffference.</p>\n<p>Get information on <a href=\"https://functionaljobs.com/jobs/9189-clojure-engineer-at-griffin\">how to apply</a> for this position.</p>",
   :direction "ltr"},
  :updated 1571649867000,
  :entities
  [{:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "about",
    :label "Clojure"}
   {:mentions [{:text "barriers to entry"}],
    :id "nlp/f/entity/wd:1163938",
    :salienceLevel "mention",
    :label "barrier to entry"}
   {:mentions [{:text "API"}],
    :id "nlp/f/entity/wd:165194",
    :salienceLevel "mention",
    :label "application programming interface"}
   {:mentions [{:text "Kubernetes"}],
    :id "nlp/f/entity/wd:22661306",
    :salienceLevel "mention",
    :label "Kubernetes"}
   {:mentions [{:text "London"}],
    :id "nlp/f/entity/wd:84",
    :salienceLevel "mention",
    :label "London"}],
  :alternate
  [{:href
    "https://functionaljobs.com/jobs/9189-clojure-engineer-at-griffin",
    :type "text/html"}],
  :title "Clojure Engineer at Griffin (Full-time)",
  :author "FunctionalJobs.com",
  :published-str "Mon Oct 21 02:24:27 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16dedc3aa7f:c1f00f0:97b0c8f7",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "urn:uuid:2ffffaed-dfe4-9cb2-a5e1-6e26dd4ff629",
  :commonTopics
  [{:score 37.462937614821946,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.97,
    :id "nlp/f/topic/867",
    :salienceLevel "about",
    :label "fintech"}
   {:score 0.913,
    :id "nlp/f/topic/774",
    :salienceLevel "about",
    :label "engineering"}],
  :published 1571649867000,
  :fingerprint "8b2ea74e",
  :canonicalUrl
  "https://functionaljobs.com/jobs/9189-clojure-engineer-at-griffin"}
 {:engagement 4,
  :unread false,
  :crawled 1571652086399,
  :content
  {:content
   "<div><h1>Backend Engineer</h1><div>Griffin | London, UK</div><div><em>The bank as a platform. Launch financial services products on top of our API.</em></div><div>£55000 - £70000</div><div><a href=\"https://griffin.sh\">https://griffin.sh</a></div><br><div><p><strong>Help us create a regulated, API-first bank</strong></p><p>Most of the banking world is exclusive, opaque, and not particularly technology-friendly.</p><p>We're trying to change that - we want to lower barriers to entry for fintechs by providing easy access, clear documentation, and transparent pricing. </p><p>We recently closed a £3M seed round and are hiring our first engineers. By joining now you'll have the opportunity to have outsized impact and to also get a large chunk of available equity. </p><p>As a backend engineer you'll be responsible for building out our core banking systems, which are responsible for handling compliance as well as managing accounts and transactions. As a wholesale bank, we're building for scale from day one - our infrastructure has to scale to tens of thousands of requests per second, with all systems fully correct and available. We'll also need fully-functional integrations with a half-dozen different payment rails such as Faster Payments, Direct Debit, CHAPS, and various card networks. </p><p>Our technology stack is Clojure, Kafka, Postgres, and Kubernetes.</p><h5>Qualifications</h5><p>Some prior Clojure experience is required. Prior devops or security experience is a major plus. Experience with the other parts of our stack is preferred, but not required. Similarly, relevant domain experience in payments or core banking systems is a plus, but not mandatory. </p><p><strong>Local and global</strong></p><p>Our offices are just off Moorgate in central London, but our engineering workforce is distributed. We're currently prioritizing local hires, but are open to remote for exceptional UK/EU/US candidates.</p></div></div>",
   :direction "ltr"},
  :updated 1571649298000,
  :entities
  [{:mentions [{:text "London, UK"} {:text "London"}],
    :id "nlp/f/entity/wd:84",
    :salienceLevel "mention",
    :label "London"}
   {:mentions [{:text "API"}],
    :id "nlp/f/entity/wd:165194",
    :salienceLevel "mention",
    :label "application programming interface"}
   {:mentions [{:text "barriers to entry"}],
    :id "nlp/f/entity/wd:1163938",
    :salienceLevel "mention",
    :label "barrier to entry"}
   {:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "Kubernetes"}],
    :id "nlp/f/entity/wd:22661306",
    :salienceLevel "mention",
    :label "Kubernetes"}],
  :alternate
  [{:href
    "https://jobs.braveclojure.com/jobs/17592186047118/backend-engineer-griffin",
    :type "text/html"}],
  :title "Backend Engineer",
  :author "Brave Clojure Jobs",
  :published-str "Mon Oct 21 02:14:58 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16dedc3aa7f:c1f00ef:97b0c8f7",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://jobs.braveclojure.com/jobs/17592186047118/backend-engineer-griffin",
  :commonTopics
  [{:score 24.636043713611812,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.988,
    :id "nlp/f/topic/867",
    :salienceLevel "about",
    :label "fintech"}
   {:score 0.897,
    :id "nlp/f/topic/774",
    :salienceLevel "about",
    :label "engineering"}],
  :published 1571649298000,
  :fingerprint "cacbdd07",
  :canonicalUrl
  "https://jobs.braveclojure.com/jobs/17592186047118/backend-engineer-griffin"}
 {:engagement 6,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1571649897811,
  :content
  {:content
   "<p>I’ve started “Meta Redux” on my birthday <a href=\"http://metaredux.com/posts/2018/10/13/going-meta.html\">one year ago</a>.\nI had plenty of ambitious goals when I kicked off the new blog and now it’s time to examine\nhow well I’ve done with respect to them.</p>\n<p>In total I wrote 52 articles, which conveniently means that on average I wrote one\narticle per week. That’s way more than I used to be writing on <a href=\"https://batsov.com\">the old\nblog</a> before retiring it, so I’m reasonably happy with\nmyself. As usual, however, there’s plenty of room for improvement. For\none, I planned to write more essay-like articles in the spirit of <a href=\"http://metaredux.com/posts/2018/10/29/nrepl-redux.html\">nREPL Redux</a> and <a href=\"http://metaredux.com/posts/2019/04/02/ruby-s-creed.html\">Ruby’s Creed</a>, but I ended up writing way more release announcements, tutorials and short\narticles instead. I also wrote pretty much nothing that wasn’t related to\nprogramming. I really want to change this down the road, as (believe it or not) I’m passionate\nabout more things in life than programming.<sup><a href=\"http://metaredux.com/posts/2019/10/21/meta-redux-year-one.html#fn:1\">1</a></sup></p>\n<p>One area where I miserably failed were my journal series “Meta Reduce”. I set\nout to do one article per week and I ended up doing less than one per month. On\nthe bright side - that’s the only area where I managed to share some\nnon-programming related thoughts. I also really struggled to find the right\nstructure for those, but I’m sure I’ll get there eventually.</p>\n<p>Another (small) failure - “Meta Redux” consumed most of my writing time and energy\nand this impacted negatively my other blog, <a href=\"https://emacsredux.com\">dedicated to Emacs</a>.\nI guess it’s no secret that I’m crazy about Emacs and I love writing about it,\nso I’m quite displeased with how things went down there. I’ll have to find\nsome kind of balance between the two of them going forward.</p>\n<p>So, what’s next? This year I’ve been spending a lot of time playing with\n<a href=\"https://felipecastro.com/en/okr/what-is-okr/\">Objectives and Key Results</a> and\nI’ve been trying to put more of the things I’m doing in the OKR\nframework. That’s how I see my “Meta Redux” OKRs for the upcoming year:</p>\n<p><strong>Objective:</strong> Share my interesting thoughts and ideas with a broader audience.</p>\n<p><strong>Key Results:</strong></p>\n<ul>\n<li>Publish 1 “Meta Reduce” article per month.</li>\n<li>Publish 10 essays.</li>\n<li>Publish 10 non-programming articles.</li>\n<li>Publish 64 articles in total.</li>\n<li>Double the number of unique visitors to the site.</li>\n</ul>\n<p>Nothing super ambitious here, but now that I’ve put the goals in writing it’s much easier to measure my\nsuccess with achieving them.</p>\n<p>Now for some random observations:</p>\n<ul>\n<li>I’ve rarely written anything while traveling. I’m really struggling with writing when I don’t have a comfortable desk\nand a real keyboard. Not to mention I have the laptop with the worst keyboard in the world…</li>\n<li>I’ve started way more articles than I actually finished.</li>\n<li>I spend more time editing something than I spend writing the initial draft.<sup><a href=\"http://metaredux.com/posts/2019/10/21/meta-redux-year-one.html#fn:2\">2</a></sup></li>\n<li>Switching back to Jekyll from Octopress really helped. Hooray for simple\ntools! I tried at some point using Hugo, but I found its tool-chain to be more\ncomplex than Jekyll’s. That’s partially related to my background as a Ruby\ndeveloper, but it has more to do with the fact that the initial process of setting up a Hugo\nblog and customizing a theme there is more involved.</li>\n<li>It’s really hard to find nice looking, free and well-maintained Jekyll themes. Most of the famous themes\nseem to be abandoned or with 20 competing forks. That’s a bummer, but at least the default Minima theme\nis quite compatible with my sense of aesthetics.</li>\n<li>Writing some simple Jekyll helpers for Emacs (e.g. to link to another article) was a real productivity booster.</li>\n<li>My readers are much better proofreaders than me.</li>\n</ul>\n<p>In the end of the day, however, for me the most important thing is that I’m happy with “Meta Redux”.\nIt feels great to share my thoughts in writing. For some crazy\nreason I genuinely believe I’ve learned some importantly things in life (and on\nthe job) that might be useful to others. I hope you enjoy my ramblings as much\nas I enjoy producing them! Until next time!</p>\n<div>\n<ol>\n<li>\n<p>That’s why I opted for programming-inspired, yet programming-neutral name for the blog. <a href=\"http://metaredux.com/posts/2019/10/21/meta-redux-year-one.html#fnref:1\">↩</a></p>\n</li>\n<li>\n<p>Unless it’s some straightforward tutorial. <a href=\"http://metaredux.com/posts/2019/10/21/meta-redux-year-one.html#fnref:2\">↩</a></p>\n</li>\n</ol>\n</div>",
   :direction "ltr"},
  :updated 1571644860000,
  :entities
  [{:mentions [{:text "Emacs"}],
    :id "nlp/f/entity/wd:189722",
    :salienceLevel "mention",
    :label "Emacs"}
   {:mentions [{:text "OKR"}],
    :id "nlp/f/entity/wd:8055625",
    :salienceLevel "mention",
    :label "Yorke Island Airport"}
   {:mentions [{:text "aesthetics"}],
    :id "nlp/f/entity/wd:35986",
    :salienceLevel "mention",
    :label "aesthetics"}],
  :alternate
  [{:href
    "http://metaredux.com/posts/2019/10/21/meta-redux-year-one.html",
    :type "text/html"}],
  :title "Meta Redux: Year One",
  :author "Bozhidar Batsov",
  :published-str "Mon Oct 21 01:01:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16deda24553:bc4f8b7:ad5391a1",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "http://metaredux.com/posts/2019/10/21/meta-redux-year-one",
  :commonTopics
  [{:score 42.18898818234397,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.761,
    :id "nlp/f/topic/779",
    :salienceLevel "mention",
    :label "entrepreneurship"}],
  :published 1571644860000,
  :fingerprint "82709921",
  :canonicalUrl
  "http://metaredux.com/posts/2019/10/21/meta-redux-year-one.html"}
 {:engagement 4,
  :unread false,
  :crawled 1571639366744,
  :content
  {:content
   "<p>Through conversations, I’ve realized that there’s two kinds of data modeling that are distinct. They have their own constraints and needs and, consequently, their own techniques. In this episode, I explore what makes them different.</p>\n<p></p>\n<div>\n<div><span></span><img alt=\"Video Thumbnail\" src=\"https://i.ytimg.com/vi/rxhArgh1WXk/mqdefault.jpg\"><p></p>\n<h5>Two kinds of data modeling</h5>\n<p><span>Through conversations, I've realized that there's two kinds of data modeling that are distinct. They have their own constraints and needs and, consequently, their own techniques. In this episode, I explore what makes them different. https://share.transistor.fm/e/5344dcce https://www.youtube.com/watc</span></p></div>\n</div>\n<h2>Transcript</h2>\n<p>Eric Normand: In this episode we are going to talk about two different kinds of data modeling. My name is Eric Normand and I help people thrive with Functional Programming.</p>\n<p>Data modeling is an important if somewhat advanced skill. In my book, we don’t get to data modeling really until part three so about Chapter 16 let’s say. I realize when I’ve been taking about data modeling in this podcast and online that there’s actually two different kinds of data modeling.</p>\n<p>Sometimes we’ll have a conversation where I’m talking about one kind of data modeling and the other people are talking about another kind. That’s why the conversation is not jelling like we’re not agreeing even though, they’re saying stuff that I agree with, and I think that they would agree with me if they understood where I was coming from.</p>\n<p>To help clarify this, to help understand this, working out these ideas because part three I have not really started on. It’s just ideas right now. It’s not very organized. That’s what this podcast is about, me organizing these ideas in functional programming.</p>\n<p>Let´s get into it. What are the two types, the two types of data modeling? The first one is the modeling design decisions, naming, thinking about the structure of data that is exposed through your API. This is public-facing data.</p>\n<p>Whenever you may get JSON API, you have to have some structure to that JSON that is going to be able to express everything that your API can do with that endpoint. Then people are going to make clients for that API, for that JSON endpoint.</p>\n<p>They’re going to need to be able to structure a JSON document in a way they get the API do what they need it to do. There’s an art, and a craft, to building this API JSON, such that it has clear names, that the structure makes sense.</p>\n<p>You choose the types correctly, for instance, if you want to have a DateTime, how do you make it clear what format the DateTime should be in? Is it a string? Are you using a Unix time stamp? What is all those choices that you have to make?</p>\n<p>You’re making this developer-centered ergonomic data structure that is all about communicating intent to the server. Likewise, there’s one as the response that’s going to come back. There’s some kind of JSON that comes back as the response that has to explain, “This is what happened and here’s the state of the system.”</p>\n<p>It’s going to have all this. You have to design it mostly for clarity. It has to be complete, it has to be able to express everything the API might need on the stuff coming in. Then it has to give back everything that the client might need in a way that’s somewhat convenient.</p>\n<p>Mostly, it’s just for clarity. There’s a lot of ergonomic concerns because you want your API to be somewhat easy to learn, somewhat easy to work with. You want it to be self-describing, so that errors or other weird conditions are clear, like what they mean.</p>\n<p>There’s a lot of constraints on it, and a lot of those constraints are human constraints. It’s a programmer who has to use it.</p>\n<p>The computer can generate JSON all day, but as the programmer, you have to figure out, “How do I generate this JSON that this API needs so that the intent is clearly expressed to the server?”</p>\n<p>That’s the first type. I said JSON, but any kind of data format. It could be XML, it could be Eden, whatever you have. It works the same.</p>\n<p>I’m going to call this the API model. It doesn’t have to be an API like on HTTP, it could be a library’s API and what is the data that it needs and gets back. That’s not important.</p>\n<p>What’s important is that it’s where data comes out of the system and becomes globally available. It’s interpretable by other people, by other systems, might be transferred over a wire.</p>\n<p>It’s all about public broadcasting of information, or public collecting of information where you don’t have control over it, and you want it to be clear. The other kind of data modeling is what I’m calling “Internal.”</p>\n<p>There’s External — that’s the first one — and Internal. This is the data modeling where it’s not something that’s going to be exposed to the outer world. It’s really just for use in an algorithm, maybe multiple algorithms.</p>\n<p>You create a data structure that is more convenient for the computer’s processing. No one’s going to see it. You’re never going to print it out. You’re never going to convert it to JSON and transfer it over the wire.</p>\n<p>It’s just there for some intermediate representation in the algorithm. Usually, it’s done for some kind of performance, like a performance guarantees, algorithm that complexity guarantees.</p>\n<p>For instance, if you need a small cache based on some key in the value, you throw it in a hash map. You might have a little bit of data modeling that you need to do like, what are the operations I’m going to use on this data? How do I get stuff out?</p>\n<p>There’s a little bit of data modeling going on there to make sure that the algorithm that uses that cache can do so efficiently. You make sure you put an interface on it so that the constraints all hold.</p>\n<p>In this case, the names of things aren’t quite as important as when you’re doing a public facing. I’m going to say they’re decidedly less important. You could use one-letter names. It’s not going to leak out, and so it doesn’t have to have human readability, the same level of human readability as you have in the External data modeling.</p>\n<p>Recently, I’ve been talking a lot more about this Internal data modeling and how in Clojure systems where we don’t have types. We just have basically hash maps, vectors, keywords, things like that. We build these data structures up.</p>\n<p>These data structures we build up are often not designed. They’re just kind of, “I have a hash map. Oh it’s so easy to just throw another thing in there.” Over time, little bits of code here and there as you add new features, add new things, nest them deeply.</p>\n<p>It’s easy to forget what’s in there, what you can expect in the certain parts in the code. Same trouble that you would have in a system that had mutable data. What’s changed it up to this point in the code? Well, you don’t know.</p>\n<p>What is in the hash map by the time I get it? I don’t know. There’s no design going on. It just happens organically over time. What I say is you need some data modeling there. You need to sit down and model that, like what can we expect? What can’t we expect? Is this the right structure that we want? That’s all Internal.</p>\n<p>This is stuff that’s flowing through pipelines, maps, filters reduces. It doesn’t have any kind of interface, any kind of system to it. It’s whatever happened to be thrown into that map and whatever keys. It’s not ever going to get sent over the wire.</p>\n<p>This is all Internal stuff. It’s not for some tight-loop algorithm, but it is like the flow through the system. At the end, it’s going to get turned into something that fits some kind of spec that the API…As you know, it’s a response to an API request.</p>\n<p>It’s going to match the JSON that needs to go back out, but internally, it diverges. It goes wherever it needs to go. What I’m suggesting is we don’t do enough of that internal data modeling. I have a lot of suggestions for how to do that.</p>\n<p>A lot of it is just sit down and apply some proper discipline to it. I don’t think you should confuse those techniques, not doing too deeply nested, like reaches down into data structure.</p>\n<p>Those tied together the place where the thing lives and its meaning. The path into the data structure is the place where it lives, and the meaning is what you can do to it. It ties those two things together and you want to separate those out.</p>\n<p>What you can do to it can go in its own function. You name it. You collect it so that all the things that you can do to that piece of data, regardless of where it lives, are collected together. Those you can collectively called the interface, and then where it lives, you should somehow shorten that.</p>\n<p>Usually, what you would want to do is have each layer of nesting, know what’s inside of it, and not look too deeply into it. This is called like the Law of Demeter in object-oriented programming where you don’t want to have these really long method chains, where you know what’s in that object and in that object and in that object.</p>\n<p>There should be some limit to how deep you can reach into objects because that really complex all the objects together.</p>\n<p>OK, I’m getting deep into this. I’ve talked about this in prior episodes, but all those suggestions are really about Internal data modeling. They don’t apply so much to the External data modeling.</p>\n<p>There, it’s all about clarity, readability, writeabilty, universality. You want some name that’s never going to change, that can be used in any system. There’s all sorts of other constraints on it.</p>\n<p>When you think about it, the interface is the least important part, because you’re not going to be composing this thing up as much as you want to have the thing that you can send. Maybe like a template, like this is what we’re doing in this API. It’s a totally different animal.</p>\n<p>I’m going to recap now. Two kinds of data modeling. They share a lot of principles but in the end, they have pretty divergent uses. One is External, for public-facing data. Either data you’re expecting or data that you’re providing is supposed to have a certain shape to it a certain structure.</p>\n<p>You need to meet that structure and specify it for another programmer so that they can understand what they’re going to get and what they need to provide. There’s a lot of ergonomic concerns in there. Want it to be self-describing, if that’s possible. All that stuff.</p>\n<p>The other kind is the Internal data modeling, where you’ve got some data that’s used in an algorithm. You need that algorithm to run efficiently or you need that algorithm to not be a mess. [laughs]</p>\n<p>Those kinds of design concerns where each feature takes longer to develop and so we need to…It’s harder and harder to know what kind of data we have. We’ve never actually sat down and designed it.</p>\n<p>You need something that helps you wrangle all of the unknowns of that data. That’s what the Internal data modeling is. When you use that, it’s not about the ergonomics so much as about making sure that you can decomplex and you can separate out the different pieces without feeling like everything is going to break.</p>\n<p>If you liked this episode, you can find all the past episodes at lispcast.com/podcast. There you’ll find audio, video and text versions, text transcripts, of all of the old episodes. You’ll also find links to subscribe on in any of those three formats, and links to social media so you can find me, get in touch with me and discuss this.</p>\n<p>I’ve been having some really nice discussions about this very topic. That’s what prompted me to have this episode. I’ve been thinking about, why is it that so many people disagree with me on this?</p>\n<p>I don’t disagree with what they’re saying, but that has nothing to do with that. What I’m saying is, OK, there’s two different things that we’re talking about. We’re both calling them data modeling. I just wanted to clarify those.</p>\n<p>Obviously, this is fruitful for me, for the other people involved. Send me your questions. Send me your comments. Disagree with me. This is a great stuff and I’m really happy with all my listeners who are out there. Thank you so much for listening.</p>\n<p>This has been my thought on functional programming. My name is Eric Normand. Thank you for listening and rock on.</p>\n<p>The post <a rel=\"nofollow\" href=\"https://lispcast.com/two-kinds-of-data-modeling/\">Two kinds of data modeling</a> appeared first on <a rel=\"nofollow\" href=\"https://lispcast.com\">LispCast</a>.</p>",
   :direction "ltr"},
  :updated 1571637600000,
  :entities
  [{:mentions [{:text "data modeling"}],
    :id "nlp/f/entity/wd:367664",
    :salienceLevel "about",
    :label "data modeling"}
   {:mentions [{:text "API"}],
    :id "nlp/f/entity/wd:165194",
    :salienceLevel "mention",
    :label "application programming interface"}
   {:mentions [{:text "JSON"}],
    :id "nlp/f/entity/wd:2063",
    :salienceLevel "mention",
    :label "JavaScript Object Notation"}
   {:mentions [{:text "data structure"}],
    :id "nlp/f/entity/wd:175263",
    :salienceLevel "mention",
    :label "data structure"}
   {:mentions [{:text "functional programming"}],
    :id "nlp/f/entity/wd:193076",
    :salienceLevel "mention",
    :label "functional programming"}],
  :alternate
  [{:href "https://lispcast.com/two-kinds-of-data-modeling/",
    :type "text/html"}],
  :title "Two kinds of data modeling",
  :author "Eric Normand",
  :published-str "Sun Oct 20 23:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16ded019458:c0d6e1d:97b0c8f7",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url "https://i.ytimg.com/vi/rxhArgh1WXk/mqdefault.jpg",
   :width 320,
   :height 180,
   :contentType "image/jpeg"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://lispcast.com/?p=2066",
  :commonTopics
  [{:score 67.75197195643852,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.935,
    :id "nlp/f/topic/253",
    :salienceLevel "about",
    :label "big data"}],
  :published 1571637600000,
  :fingerprint "585bc585",
  :canonicalUrl "https://lispcast.com/two-kinds-of-data-modeling/"}
 {:engagement 7,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1571477376477,
  :content
  {:content
   "<p>Each week, we discuss a different topic about Clojure and functional programming.</p>\n<p>If you have a question you’d like us to discuss, tweet <a href=\"https://twitter.com/clojuredesign\">@clojuredesign</a>, send an email to <a href=\"mailto:feedback@clojuredesign.club\">feedback@clojuredesign.club</a>, or join the <code>#clojuredesign-podcast</code> channel on the <a href=\"http://clojurians.net/\">Clojurians Slack</a>.</p>\n<p>This week, our topic is: <strong>“Maps! Maps! Maps!”</strong> We discuss maps and their useful features, including a key distinction that we couldn’t live without.</p>\n<p>Selected quotes:</p>\n<ul>\n<li>“Working with Clojure makes you feel like you’re living in the future!”</li>\n<li>“Maps are bags of dimensions.”</li>\n<li>“The namespace of the key is the entity, the name is the attribute, and the value is the value.”</li>\n<li>“Flatter maps make it so you end up writing less code.”</li>\n</ul>\n<p>Related episodes:</p>\n<ul>\n<li>Time Log series:\n<ul>\n<li><a href=\"https://clojuredesign.club/episode/015-finding-the-time\">015: Finding the Time</a></li>\n<li><a href=\"https://clojuredesign.club/episode/016-when-8-minus-1-equals-6\">016: When 8 - 1 = 6</a></li>\n<li><a href=\"https://clojuredesign.club/episode/017-data-at-your-service\">017: Data, at Your Service</a></li>\n<li><a href=\"https://clojuredesign.club/episode/018-did-i-work-late-on-tuesday\">018: Did I Work Late on Tuesday?</a></li>\n<li><a href=\"https://clojuredesign.club/episode/019-dazed-by-weak-weeks\">019: Dazed by Weak Weeks</a></li>\n<li><a href=\"https://clojuredesign.club/episode/020-data-dessert\">020: Data Dessert</a></li>\n</ul></li>\n<li><a href=\"https://clojuredesign.club/episode/049-keywords-keywords-keywords\">049: Keywords! Keywords! Keywords!</a></li>\n</ul>\n<p>Links:</p>\n<ul>\n<li><a href=\"https://itrevolution.com/love-letter-to-clojure-part-1/\">Love Letter To Clojure (Part 1)</a> - Gene Kim</li>\n</ul>\n<p>Code sample:</p>\n<div><pre><code><span>;; Player records: one nested, one with rich keys.</span>\n\n(<span>def </span><span>players-nested</span>\n  [{<span>:player</span> {<span>:id</span> <span>123</span>\n             <span>:name</span> <span>&quot;Russell&quot;</span>\n             <span>:position</span> <span>:point-guard</span>}\n    <span>:team</span> {<span>:id</span> <span>432</span>\n           <span>:name</span> <span>&quot;Durham Denizens&quot;</span>\n           <span>:division</span> <span>:eastern</span>}}\n   {<span>:player</span> {<span>:id</span> <span>124</span>\n             <span>:name</span> <span>&quot;Frank&quot;</span>\n             <span>:position</span> <span>:midfield</span>}\n    <span>:team</span> {<span>:id</span> <span>432</span>\n           <span>:name</span> <span>&quot;Durham Denizens&quot;</span>\n           <span>:division</span> <span>:eastern</span>}}])\n\n(<span>def </span><span>players-rich</span>\n  [{<span>:player/id</span> <span>123</span>\n    <span>:player/name</span> <span>&quot;Russell&quot;</span>\n    <span>:player/position</span> <span>:point-guard</span>\n    <span>:team/id</span> <span>432</span>\n    <span>:team/name</span> <span>&quot;Durham Denizens&quot;</span>\n    <span>:team/division</span> <span>:eastern</span>}\n   {<span>:player/id</span> <span>124</span>\n    <span>:player/name</span> <span>&quot;Frank&quot;</span>\n    <span>:player/position</span> <span>:midfield</span>\n    <span>:team/id</span> <span>432</span>\n    <span>:team/name</span> <span>&quot;Durham Denizens&quot;</span>\n    <span>:team/division</span> <span>:eastern</span>}])\n\n\n<span>;; Extract player and team id, along with team name</span>\n\n<span>; Nested</span>\n(<span>defn </span><span>extract</span>\n  [<span>player</span>]\n  (<span>let </span>[{<span>:keys</span> [<span>player</span> <span>team</span>]} <span>player</span>]\n    {<span>:player</span> (<span>select-keys </span><span>player</span> [<span>:id</span>])\n     <span>:team</span> (<span>select-keys </span><span>team</span> [<span>:id</span> <span>:name</span>])}))\n\n#<span>_</span>(<span>map </span><span>extract</span> <span>players-nested</span>)\n<span>; ({:player {:id 123}, :team {:id 432, :name &quot;Durham Denizens&quot;}}</span>\n<span>; {:player {:id 124}, :team {:id 432, :name &quot;Durham Denizens&quot;}})</span>\n\n<span>; Rich</span>\n#<span>_</span>(<span>map </span>#(<span>select-keys </span><span>%</span> [<span>:player/id</span> <span>:team/id</span> <span>:team/name</span>]) <span>players-rich</span>)\n<span>; ({:player/id 123, :team/id 432, :team/name &quot;Durham Denizens&quot;}</span>\n<span>; {:player/id 124, :team/id 432, :team/name &quot;Durham Denizens&quot;})</span>\n\n\n<span>;; Sort by team name and then player name</span>\n\n<span>; Nested</span>\n#<span>_</span>(<span>sort-by </span>(<span>juxt</span> #(<span>-> </span><span>%</span> <span>:team</span> <span>:name</span>) #(<span>-> </span><span>%</span> <span>:player</span> <span>:name</span>)) <span>players-nested</span>)\n<span>; ({:player {:id 124, :name &quot;Frank&quot;, :position :midfield},</span>\n<span>; :team {:id 432, :name &quot;Durham Denizens&quot;, :division :eastern}}</span>\n<span>; {:player {:id 123, :name &quot;Russell&quot;, :position :point-guard},</span>\n<span>; :team {:id 432, :name &quot;Durham Denizens&quot;, :division :eastern}})</span>\n\n<span>; Rich</span>\n#<span>_</span>(<span>sort-by </span>(<span>juxt</span> <span>:team/name</span> <span>:player/name</span>) <span>players-rich</span>)\n<span>; ({:player/id 124,</span>\n<span>; :player/name &quot;Frank&quot;,</span>\n<span>; :player/position :midfield,</span>\n<span>; :team/id 432,</span>\n<span>; :team/name &quot;Durham Denizens&quot;,</span>\n<span>; :team/division :eastern}</span>\n<span>; {:player/id 123,</span>\n<span>; :player/name &quot;Russell&quot;,</span>\n<span>; :player/position :point-guard,</span>\n<span>; :team/id 432,</span>\n<span>; :team/name &quot;Durham Denizens&quot;,</span>\n<span>; :team/division :eastern})</span></code></pre></div>",
   :direction "ltr"},
  :updated 1571410800000,
  :entities
  [{:mentions [{:text "Player"}],
    :id "nlp/f/entity/wd:1551573",
    :salienceLevel "about",
    :label "The Player"}
   {:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "Extract"}],
    :id "nlp/f/entity/wd:778706",
    :salienceLevel "mention",
    :label "Extract"}
   {:mentions [{:text "functional programming"}],
    :id "nlp/f/entity/wd:193076",
    :salienceLevel "mention",
    :label "functional programming"}
   {:mentions [{:text "Sort"}],
    :id "nlp/f/entity/wd:12690",
    :salienceLevel "mention",
    :label "Sort"}],
  :alternate
  [{:href "https://clojuredesign.club/episode/051-maps-maps-maps/",
    :type "text/html"}],
  :title "Ep 051: Maps! Maps! Maps!",
  :author "Christoph Neumann and Nate Jones",
  :published-str "Fri Oct 18 08:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16de359cddd:b841ce8:69b9f616",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://clojuredesign.club/episode/051-maps-maps-maps/",
  :commonTopics
  [{:score 0.76,
    :id "nlp/f/topic/349",
    :salienceLevel "mention",
    :label "business"}],
  :published 1571410800000,
  :fingerprint "95b23d43",
  :canonicalUrl
  "https://clojuredesign.club/episode/051-maps-maps-maps/"}
 {:engagement 6,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1571477376477,
  :content
  {:content
   "Programming Clojure, ClojureScript and Node.js.<div><div><div><div><a href=\"https://andrearichiardi.com/\"><img alt=\"Andrea Richiardi\" width=\"58\" src=\"https://andrearichiardi.com/images/logo512x512.png\" height=\"58\"></a><a href=\"https://github.com/arichiardi\"><i></i></a><a href=\"https://www.linkedin.com/in/richiardiandrea\"><i></i></a><a href=\"https://twitter.com/richiardiandrea\"><i class=\"twitter\"></i></a><a href=\"https://keybase.io/arichiardi\"><i></i></a></div></div></div><div><div><div><a href=\"https://andrearichiardi.com/\"><img alt=\"Andrea Richiardi\" width=\"58\" src=\"https://andrearichiardi.com/images/logo512x512.png\" height=\"58\"></a><a href=\"https://github.com/arichiardi\"><i></i>Github</a><a href=\"https://www.linkedin.com/in/richiardiandrea\"><i></i>Linkedin</a><a href=\"https://twitter.com/richiardiandrea\"><i class=\"twitter\"></i>Twitter</a><a href=\"https://keybase.io/arichiardi\"><i></i>Keybase</a><div><a href=\"https://andrearichiardi.com/blog/sitemap.xml\"><i></i>Site Map</a><div><i></i>Feeds<i></i><div><a href=\"https://andrearichiardi.com/blog/feed.rss\">RSS</a><a href=\"https://andrearichiardi.com/blog/atom.xml\">Atom</a></div></div></div></div></div></div><div><div><div><a href=\"https://andrearichiardi.com/\"><img alt=\"Andrea Richiardi\" width=\"58\" src=\"https://andrearichiardi.com/images/logo512x512.png\" height=\"58\"></a><a href=\"https://github.com/arichiardi\"><i></i>Github</a><a href=\"https://www.linkedin.com/in/richiardiandrea\"><i></i>Linkedin</a><a href=\"https://twitter.com/richiardiandrea\"><i class=\"twitter\"></i>Twitter</a><a href=\"https://keybase.io/arichiardi\"><i></i>Keybase</a><div><a href=\"https://andrearichiardi.com/blog/sitemap.xml\"><i></i>Site Map</a><div><i></i>Feeds<i></i><div><a href=\"https://andrearichiardi.com/blog/feed.rss\">RSS</a><a href=\"https://andrearichiardi.com/blog/atom.xml\">Atom</a></div></div></div></div></div></div></div><div><div><div><div><div><h1>Rebase edit and commit splitting - Part I</h1><a href=\"https://andrearichiardi.com/blog/posts/rebase-edit-part-1.html\"><img src=\"https://andrearichiardi.com/images/git-logo-wide.png\"></a></div><div><div><div><img src=\"http://www.gravatar.com/avatar/708f9c347fce0493d929be88dbf70ea9\"><div><div><div>January 18, 2018</div></div><div>Andrea Richiardi</div></div></div></div><div><div><a href=\"https://www.elasticpath.com\"><img src=\"https://andrearichiardi.com/images/elasticpath-logo.png\"></a></div></div></div></div><div><p>It is generally good practice to organize your patches in self-contained, well-motivated commits so that your colleagues or your future self (akin to a brand new colleague if you like me tend to be forgetful) don't have to reverse engineer and investigate things you have already, supposedly, dealt with.</p>\n<p>Nevertheless, hacking is mostly chaotic so you usually end up with commits that include many unrelated changes. Note that I am trying not to use the word feature here mostly because squashing topic branches can mitigate this problem.</p>\n<p>I believe though that even within topic branches you want to maintain some sort of order so that you can express the &quot;story of the feature&quot; better. If done right, you could actually just rebase your feature <a href=\"https://help.github.com/articles/about-pull-request-merges/#rebase-and-merge-your-pull-request-commits\">without squashing</a>.</p>\n<h3><a href=\"https://andrearichiardi.com/blog/posts/rebase-edit-part-1.html#case-study\"></a>Case Study</h3>\n<p>Let's say you are working on an open source project with one file in it: <code>file.txt</code>. The first and second commit are just simple additions (<code>git</code> output compacted for clarity):</p>\n<pre><code><span></span>commit 4b9899b6dd36082f1877bbe6b42a598a8708050f\n\n    Write second line\n\n<span>diff --git a/file.txt b/file.txt</span>\n<span>index 9748558..cb184b5 100644</span>\n<span>--- a/file.txt</span>\n<span>+++ b/file.txt</span>\n<span>@@ -1 +1,3 @@</span>\n This is a file and I am writing it.\n<span>+</span>\n<span>+This is the second line and I so like it.</span>\n\ncommit 2cfc94884d31c388f9204f44beef0deaefd25414\n\n    Start writing a file\n\n<span>diff --git a/file.txt b/file.txt</span>\nnew file mode 100644\n<span>index 0000000..9748558</span>\n<span>--- /dev/null</span>\n<span>+++ b/file.txt</span>\n<span>@@ -0,0 +1 @@</span>\n<span>+This is a file and I am writing it.</span>\n</code></pre>\n<p>Now you want to write a third line and modify your thoughts on the other ones:</p>\n<pre><code><span></span>commit ea8c0d3f9c4da5de35970a7a6c00507a0a54cae3\n\n    Write third line\n\n<span>diff --git a/file.txt b/file.txt</span>\n<span>index cb184b5..846d404 100644</span>\n<span>--- a/file.txt</span>\n<span>+++ b/file.txt</span>\n<span>@@ -1,3 +1,5 @@</span>\n<span>-This is a file and I am writing it.</span>\n<span>+This is the first line of the file and I am writing it.</span>\n\n<span>-This is the second line and I so like it.</span>\n<span>+This is the second line and I now I don't like it that much.</span>\n<span>+</span>\n<span>+This is the best and third line.</span>\n</code></pre>\n<p>Restlessly waiting for your branch to be merged, at one point your best friend - the project maintainer - asks you to split the third commit so that the change to the first line is more visible in the history.</p>\n<p>Don't panic, that's all good, we got this covered in not only one but two ways.</p>\n<h3><a href=\"https://andrearichiardi.com/blog/posts/rebase-edit-part-1.html#rebase-and-edit\"></a>Rebase and edit</h3>\n<p>Every time you rebase you rewrite history. You have probably read a lot about how bad this is, and there is even a fully-fledged programming paradigm that fosters immutability. Let's face it though, nothing is inherently bad if you know what you are doing. Git references are actually mutable things <a href=\"https://stackoverflow.com/questions/10099258/how-can-i-recover-a-lost-commit-in-git\">you can always refer to</a>. Just make sure that nobody is relying on the commits you are modifying, in which case you don't want to <code>git push --force</code>. Never ever force push to <code>master</code>.</p>\n<p>The first thing to understand is that for modifying history we need a &quot;stable&quot; point in time to start from. &quot;Doc&quot; Emmet Brown chooses a very specific moment in time when he decides to change the McFly family history in <a href=\"http://www.imdb.com/title/tt0096874/plotsummary\">Back to the Future Part II</a>. That's the point from where you start modifying. In <code>git rebase</code> terms that moment is called <em>base</em> and it is represented as a <a href=\"https://git-scm.com/docs/gitglossary#gitglossary-aiddefSHA1aSHA-1\">SHA-1</a>. You will modify things <em>AFTER</em> it:</p>\n<pre><code><span></span>$ git log --oneline\nea8c0d3 Write third line      <span># will rewrite this</span>\n4b9899b Write second line     <span># back in time to this</span>\n2cfc948 Start writing a file\n</code></pre>\n<pre><code><span></span>$ git rebase --interactive 4b9899b\nedit ea8c0d3 Write third line <span># from &quot;pick&quot; to &quot;edit&quot;</span>\n<span># Rebase ...</span>\n<span>#</span>\n<span># Commands:</span>\n<span># p, pick = use commit</span>\n<span># r, reword = use commit, but edit the commit message</span>\n<span># e, edit = use commit, but stop for amending</span>\n...\n</code></pre>\n<p>Your DeLorean accelerates to 88 miles per hour (141.6 km/h) and the flux capacitor is on - you're now back in time - at the <code>ea8c0d3</code> commit right after the <code>4b9899b</code>. The above is called the <code>rebase</code> <a href=\"https://git-scm.com/book/en/v2/Git-Tools-Rewriting-History\">todo list</a> and allows you to specify what to do at each and every &quot;stop&quot; in time, while reworking history.</p>\n<pre><code><span></span>Stopped at ea8c0d3f9c4da5de35970a7a6c00507a0a54cae3... Write third line\nYou can amend the commit now, with\n\n\tgit commit --amend\n\nOnce you are satisfied with your changes, run\n\n\tgit rebase --continue\n\n$ git log --oneline\nea8c0d3 Write third line\n4b9899b Write second line\n2cfc948 Start writing a file\n</code></pre>\n<p>Remember that at any given moment you can <code>git rebase --abort</code> and just discard everything and get back to safety.</p>\n<h3><a href=\"https://andrearichiardi.com/blog/posts/rebase-edit-part-1.html#split-using-git-reset-the-do-it-again-way\"></a>Split using git reset - the do-it-again way</h3>\n<p>This approach is in my opinion the most inelegant but indeed very practical and easy to understand. It basically undoes all the git changes without touching the files, only the index. Note that your <code>Write third line</code> commit will not appear in the history anymore:</p>\n<pre><code><span></span>$ git reset 4b9899b\nUnstaged changes after reset:\nM\tfile.txt\n\n$ git log --oneline\n4b9899b Write second line\n2cfc948 Start writing a file\n</code></pre>\n<p>After this you can use another great git trick, <code>git add --patch</code>:</p>\n<pre><code><span></span>$ git add --patch file.txt\n<span>diff --git a/file.txt b/file.txt</span>\n<span>index cb184b5..846d404 100644</span>\n<span>--- a/file.txt</span>\n<span>+++ b/file.txt</span>\n<span>@@ -1,3 +1,5 @@</span>\n<span>-This is a file and I am writing it.</span>\n<span>+This is the first line of the file and I am writing it.</span>\n\n<span>-This is the second line and I so like it.</span>\n<span>+This is the second line and I now I don't like it that much.</span>\n<span>+</span>\nq+This is the best and third line.\nStage this hunk [y,n,q,a,d,/,s,e,?]? s\n\nSplit into 2 hunks.\n<span>@@ -1,2 +1,2 @@</span>\n<span>-This is a file and I am writing it.</span>\n<span>+This is the first line of the file and I am writing it.</span>\n\nStage this hunk [y,n,q,a,d,/,j,J,g,e,?]? n\n<span>@@ -2,2 +2,4 @@</span>\n\n<span>-This is the second line and I so like it.</span>\n<span>+This is the second line and I now I don't like it that much.</span>\n<span>+</span>\n<span>+This is the best and third line.</span>\nStage this hunk [y,n,q,a,d,/,K,g,e,?]? y\n</code></pre>\n<p>See the <code>s</code> answer? That is the split we need.</p>\n<pre><code><span></span>$ git diff --staged\n<span>diff --git a/file.txt b/file.txt</span>\n<span>index cb184b5..643fe55 100644</span>\n<span>--- a/file.txt</span>\n<span>+++ b/file.txt</span>\n<span>@@ -1,3 +1,5 @@</span>\n This is a file and I am writing it.\n\n<span>-This is the second line and I so like it.</span>\n<span>+This is the second line and I now I don't like it that much.</span>\n<span>+</span>\n<span>+This is the best and third line.</span>\n</code></pre>\n<p>Now the bottom lines are staged. Exactly what we wanted, we can commit.</p>\n<pre><code><span></span>$ git commit --message ...\n</code></pre>\n<p>Hrm, what was the commit message again? I cannot recall it and now the original commit is gone. Git got this covered as well but you need to know the SHA-1 of the original commit:</p>\n<pre><code><span></span>$ git commit --reuse-message<span>=</span>ea8c0d3\n<span>[</span>detached HEAD c3e3c4d<span>]</span> Write third line\n Date: Mon Jan <span>15</span> 17:32:42 <span>2018</span> -0800\n <span>1</span> file changed, <span>3</span> insertions<span>(</span>+<span>)</span>, <span>1</span> deletion<span>(</span>-<span>)</span>\n\n$ git log --oneline\nc3e3c4d Write third line\n4b9899b Write second line\n2cfc948 Start writing a file\n</code></pre>\n<p>It looks good, everything is in there <em>but</em> the change to the first line:</p>\n<pre><code><span></span>$ git diff --patch c3e3c4d 4b9899b\n<span>diff --git a/file.txt b/file.txt</span>\n<span>index 643fe55..cb184b5 100644</span>\n<span>--- a/file.txt</span>\n<span>+++ b/file.txt</span>\n<span>@@ -1,5 +1,3 @@</span>\n This is a file and I am writing it.\n\n<span>-This is the second line and I now I don't like it that much.</span>\n<span>-</span>\n<span>-This is the best and third line.</span>\n<span>+This is the second line and I so like it.</span>\n</code></pre>\n<p>Let's finish this up:</p>\n<pre><code><span></span>$ git add --patch file.txt\n<span>diff --git a/file.txt b/file.txt</span>\n<span>index 643fe55..846d404 100644</span>\n<span>--- a/file.txt</span>\n<span>+++ b/file.txt</span>\n<span>@@ -1,4 +1,4 @@</span>\n<span>-This is a file and I am writing it.</span>\n<span>+This is the first line of the file and I am writing it.</span>\n\n This is the second line and I now I don't like it that much.\n\nStage this hunk [y,n,q,a,d,/,e,?]? y\n</code></pre>\n<p>Note that a <code>git add</code> would have achieved the same here but it is always good to give things a last read.</p>\n<pre><code><span></span>$ git commit --message <span>&quot;Modify the first line with new thoughts&quot;</span>\n<span>[</span>detached HEAD b7bdd01<span>]</span> Modify the first line with new thoughts\n <span>1</span> file changed, <span>1</span> insertion<span>(</span>+<span>)</span>, <span>1</span> deletion<span>(</span>-<span>)</span>\n\n$ git rebase --continue          <span># concludes the editing session</span>\nSuccessfully rebased and updated refs/heads/master.\n\n$ git log --oneline\nb7bdd01 Modify the first line with new thoughts\nc3e3c4d Write third line\n4b9899b Write second line\n2cfc948 Start writing a file\n</code></pre>\n<p>Done and done. The reason why I maintain this is not the most elegant way can be explained with the Back to the Future analogy again: &quot;Doc&quot; goes back in time knowing what the future holds and knowing which part of the past to change but cannot quite isolate those changes. He cannot pick and choose and ends up modifying things he did not mean to.</p>\n<p>This is exactly what happens when you <code>git reset</code> - you indiscriminately throw everything away and need to rebuild from scratch, with all the problems that come with it. The one we have already noticed is that you need to remember things from the past, like the SHA-1 of the original commit for the message. If the past you rewrite is very tangled this process is very error prone.</p>\n<p>In the next post I will explain the second and more elegant way.</p>\n<p>Thank you for reading!</p>\n<h4><a href=\"https://andrearichiardi.com/blog/posts/rebase-edit-part-1.html#links\"></a>Links</h4>\n<ul>\n<li><a href=\"https://git-scm.com/book/en/v2/Git-Tools-Rewriting-History\">https://git-scm.com/book/en/v2/Git-Tools-Rewriting-History</a></li>\n<li><a href=\"https://learngitbranching.js.org\">https://learngitbranching.js.org</a></li>\n<li><a href=\"https://www.atlassian.com/git/tutorials/rewriting-history\">https://www.atlassian.com/git/tutorials/rewriting-history</a></li>\n</ul>\n</div></div></div><aside><div><div>Tags</div><div><a href=\"https://andrearichiardi.com/blog/hacks.html\">hacks</a><a href=\"https://andrearichiardi.com/blog/tutorial.html\">tutorial</a><a href=\"https://andrearichiardi.com/blog/git.html\">git</a><a href=\"https://andrearichiardi.com/blog/clojurescript.html\">clojurescript</a></div></div><div><h5>Latest posts</h5><div><div><div><a href=\"https://andrearichiardi.com/blog/posts/aws-lambda-runtime-lumo.html\">Compile the Lumo ClojureScript interpreter for AWS Lambda.</a><p>The tale of building Node.js statically and the whoes of good'ol binary compilation. ClojureScript on AWS is the goal.</p></div></div><div><div><a href=\"https://andrearichiardi.com/blog/posts/clojurescript-cursive-shadow-setup.html\">ClojureScript IntelliJ IDEA and shadow-cljs</a><p>A little introductory post on how to setup IntelliJ IDEA for ClojureScript.</p></div></div><div><div><a href=\"https://andrearichiardi.com/blog/posts/lumo-npm-dependencies.html\">Use ClojureScript from npm packages with Lumo</a><p>The biggest advantage of using a self-host runtime like lumo is that it integrates seamlessly with the JavaScript ecosystem. Let's see how.</p></div></div></div></div></aside></div><div></div><div><div><div><div><div><img src=\"https://www.gravatar.com/avatar/708f9c347fce0493d929be88dbf70ea9\">Copyright © 2015-2019 Andrea Richiardi</div><div><a href=\"https://github.com/arichiardi\"><i></i>Github</a><a href=\"https://www.linkedin.com/in/richiardiandrea\"><i></i>Linkedin</a><a href=\"https://twitter.com/richiardiandrea\"><i class=\"twitter\"></i>Twitter</a><a href=\"https://keybase.io/arichiardi\"><i></i>Keybase</a></div></div><div><div><div>Except where otherwise noted, content on this site is licensed under a <a rel=\"license\" href=\"https://creativecommons.org/licenses/by/4.0/\">Creative Commons Attribution 4.0 International license.</a></div><div><i></i></div><div> Powered by <a href=\"https://perun.io\">Perun</a> and <a href=\"https://semantic-ui.com\">Semantic UI</a>.</div></div></div></div><div></div><div><a href=\"https://andrearichiardi.com/blog/sitemap.xml\">Site Map</a><a href=\"https://andrearichiardi.com/blog/feed.rss\">RSS</a><a href=\"https://andrearichiardi.com/blog/atom.xml\">Atom</a></div></div></div>",
   :direction "ltr"},
  :updated 1571356800000,
  :entities
  [{:mentions [{:text "Node"} {:text "Node.js"}],
    :id "nlp/f/entity/wd:756100",
    :salienceLevel "mention",
    :label "Node.js"}
   {:mentions [{:text "SHA-1"}],
    :id "nlp/f/entity/wd:13414952",
    :salienceLevel "mention",
    :label "SHA-1"}
   {:mentions [{:text "IntelliJ IDEA"}],
    :id "nlp/f/entity/wd:1206660",
    :salienceLevel "mention",
    :label "IntelliJ IDEA"}
   {:mentions [{:text "/dev/null"}],
    :id "nlp/f/entity/wd:14671",
    :salienceLevel "mention",
    :label "/dev/null"}
   {:mentions [{:text "miles per hour"}],
    :id "nlp/f/entity/wd:211256",
    :salienceLevel "mention",
    :label "miles per hour"}],
  :alternate
  [{:href
    "https://andrearichiardi.com/blog/posts/rebase-edit-part-1.html",
    :type "text/html"}],
  :title "Rebase edit and commit splitting - Part I",
  :author "Andrea Richiardi",
  :published-str "Thu Oct 17 17:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16de359cddd:b841ce7:69b9f616",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url "https://andrearichiardi.com/images/git-logo-wide.png",
   :width 910,
   :height 606,
   :contentType "image/png"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "urn:uuid:a924e5d6-fa55-11e7-b979-832ad0525d37",
  :commonTopics
  [{:score 53.8622775332757,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.701,
    :id "nlp/f/topic/234",
    :salienceLevel "mention",
    :label "beauty"}],
  :published 1571356800000,
  :fingerprint "eecb193b",
  :canonicalUrl
  "https://andrearichiardi.com/blog/posts/rebase-edit-part-1.html"}
 {:engagement 6,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1571413238083,
  :content
  {:content
   "In this seventh part of the blog series Building an E-Commerce Marketplace Middleware in Clojure, I am going to share how we captured a business operation from the client’s Order Management System(OMS) processed it in a marketplace.\nRanging is an activity in the OMS that turn on the visibility of an item in a marketplace and make it available for sale. The reverse operation is Deranging, which unlist the item from the marketplace.",
   :direction "ltr"},
  :updated 1571412507000,
  :entities
  [{:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "about",
    :label "Clojure"}],
  :alternate
  [{:href
    "https://www.demystifyfp.com/clojure/marketplace-middleware/ranging-items-in-marketplaces/",
    :type "text/html"}],
  :title "Ranging Items In E-Commerce Marketplaces",
  :author "Demystify FP",
  :published-str "Fri Oct 18 08:28:27 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16ddf872143:b3dfcb9:69b9f616",
  :visual {:url "none"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://www.demystifyfp.com/clojure/marketplace-middleware/ranging-items-in-marketplaces/",
  :commonTopics
  [{:score 0.949,
    :id "nlp/f/topic/726",
    :salienceLevel "about",
    :label "ecommerce"}],
  :published 1571412507000,
  :fingerprint "574b01ee",
  :canonicalUrl
  "https://www.demystifyfp.com/clojure/marketplace-middleware/ranging-items-in-marketplaces/"}
 {:engagement 9,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1571396965037,
  :recrawled 1571736450713,
  :content
  {:content
   "<div>\n<h2><a href=\"https://juxt.pro/blog/rss.xml?category=clojure&since=2016-03-13#_lazy_sequences\"></a>Lazy Sequences</h2>\n<div>\n<div>\n<p>Lazy Sequences are great for exploring a problem space. <em>However you hit a few snags as data volumes ramp up:</em></p>\n</div>\n<div>\n<h4><a href=\"https://juxt.pro/blog/rss.xml?category=clojure&since=2016-03-13#_it_is_all_too_easy_to_create_head_retention\"></a>It is all too easy to create head retention</h4>\n<div>\n<p>leading to an Out Of Memory Error</p>\n</div>\n</div>\n<div>\n<h4><a href=\"https://juxt.pro/blog/rss.xml?category=clojure&since=2016-03-13#_each_lazy_sequence_maintains_its_own_header_tank_of_chunked_data\"></a>Each lazy sequence maintains its own header tank of chunked data</h4>\n<div>\n<p>which can add up to <strong>alot</strong> of memory in a long pipeline</p>\n</div>\n</div>\n<div>\n<h4><a href=\"https://juxt.pro/blog/rss.xml?category=clojure&since=2016-03-13#_difficult_to_release_resources_predictably\"></a>Difficult to release resources predictably</h4>\n<div>\n<p>For system resources like Files, there is no reliable way to release resources that are lazily crawled</p>\n</div>\n</div>\n<div>\n<h4><a href=\"https://juxt.pro/blog/rss.xml?category=clojure&since=2016-03-13#_exception_are_deferred_to_em_the_future_em\"></a>Exception are deferred to <em>The Future</em></h4>\n<div>\n<p>Any latent exceptions will be exposed in a lazy manner;\nmeaning you could have to handle an exception when you are least expecting it,\nor have the Virtual Machine quietly end that thread.</p>\n</div>\n</div>\n<div>\n<h4><a href=\"https://juxt.pro/blog/rss.xml?category=clojure&since=2016-03-13#_awkward_to_interrupt_processing\"></a>Awkward to interrupt processing</h4>\n<div>\n<p>if you want to abort processing 2% of the way through a 1'000'000'000 element sequence\nyou may find that it takes a surprisingly long time to finish and return control.</p>\n</div>\n</div>\n</div>\n</div>\n<div>\n<h2><a href=\"https://juxt.pro/blog/rss.xml?category=clojure&since=2016-03-13#_enter_reducible\"></a>Enter reducible</h2>\n<div>\n<div>\n<p>A <strong>reducible</strong> is a neat way to avoid these problems.</p>\n</div>\n<div>\n<p>A <strong>reducible</strong> is a direct <code>reify</code> of <code>clojure.lang.IReduceInit</code> or <code>clojure.lang.IReduce</code>\nthat conceals a <code>loop/recur</code> behind a <code>reduce</code> friendly facade.</p>\n</div>\n<div>\n<p>It runs eagerly and can plug into <code>reduce/transduce/into</code> thereby avoiding problems described above.</p>\n</div>\n<div>\n<h3><a href=\"https://juxt.pro/blog/rss.xml?category=clojure&since=2016-03-13#_consider_code_ireduceinit_code\"></a>Consider <code>IReduceInit</code></h3>\n<div>\n<p>because this is the more general purpose of the two.</p>\n</div>\n<div>\n<p>It is defined in\n<a href=\"https://github.com/clojure/clojure/tree/master/src/jvm/clojure/lang/IReduceInit.java#L13-L15\">https://github.com/clojure/clojure/tree/master/src/jvm/clojure/lang/IReduceInit.java#L13-L15</a>\nas</p>\n</div>\n<div>\n<div>\n<pre><code>public interface IReduceInit{\n    Object reduce(IFn f, Object start) ;\n}</code></pre>\n</div>\n</div>\n<div>\n<p>this <code>reduce</code> method will get called by <code>clojure.core/reduce</code> function.\nA general implementation might look like</p>\n</div>\n<div>\n<div>\n<pre><code>(defn iterator-reducible\n  &quot;expresses an iterator through the medium of IReduceInit\n   if first-val is nil it will be ignored&quot;\n  [first-val ^java.util.Iterator it]\n  (reify IReduceInit\n    (reduce [this f init]\n      (loop [acc (if first-val\n                   (f init first-val)\n                   init)]\n        (if (or (reduced? acc)\n                (not (.hasNext it)))\n          (unreduced acc)\n          (recur (f acc (.next it))))))))</code></pre>\n</div>\n</div>\n<div>\n<ol>\n<li>\n<p>It’s a plain old <code>loop/recur</code></p>\n</li>\n<li>\n<p>We invoke the reducing function <code>f</code> to handle a value</p>\n</li>\n<li>\n<p>We always check the accumulator for the <code>reduced</code> short circuit.\nThis supports early-termination constructs like <code>(take 2</code>\nThe iterator may go on for ever, so we need a way to break out of the loop.</p>\n</li>\n<li>\n<p>the first parameter to the reduce function is the Java <code>this</code> reference,\nit typically does not carry any value her and is usually ignored.</p>\n</li>\n</ol>\n</div>\n<div>\n<p>You use <strong>reducibles</strong> directly with</p>\n</div>\n<div>\n<ul>\n<li>\n<p><code>into</code></p>\n</li>\n<li>\n<p><code>reduce</code></p>\n</li>\n<li>\n<p><code>transduce</code></p>\n</li>\n</ul>\n</div>\n<div>\n<p>eg</p>\n</div>\n<div>\n<div>\n<pre><code>(into [] (take 10) (iterator-reducible :starting-value (.iterator (range))))\n=> [:starting-value 0 1 2 3 4 5 6 7 8]</code></pre>\n</div>\n</div>\n<div>\n<p>You <strong>CANNOT</strong> plug them into <code>sequence</code></p>\n</div>\n<div>\n<div>\n<pre><code>(sequence (take 10) (iterator-reducible :starting-value (.iterator (range))))\n\nIllegalArgumentException Don't know how to create ISeq from: dev$iterator_reducible$reify__54612  clojure.lang.RT.seqFrom (RT.java:550)</code></pre>\n</div>\n</div>\n<div>\n<p>although you can of course <code>(into '()</code></p>\n</div>\n</div>\n<div>\n<h3><a href=\"https://juxt.pro/blog/rss.xml?category=clojure&since=2016-03-13#_it_gets_useful_when\"></a>It gets useful when</h3>\n<div>\n<p>using system resources; for example if we need to crawl zip files\nbut have to make sure that the file resources get released immediately after use,\nthen we can write</p>\n</div>\n<div>\n<div>\n<pre><code>(defn zipfile-reducible\n  &quot;expects to be passed a .zip or .jar file\n   crawls through the file, presenting entries to the reducing function\n   ensures the file is closed afterwards&quot;\n  [zf]\n  (reify IReduceInit\n    (reduce [this f init]\n      (with-open [is (clojure.java.io/input-stream zf)\n                  zis (ZipInputStream. is)]\n        (loop [acc init]\n          (let [next-entry (.getNextEntry zis)]\n            (if (and (some? next-entry)\n                  (not (reduced? acc)))\n              (recur (f acc (assoc (bean next-entry)\n                              :input-stream zis)))\n              (unreduced acc)))\n          )))))</code></pre>\n</div>\n</div>\n<div>\n<p>and we can experiment with</p>\n</div>\n<div>\n<div>\n<pre><code>(into []\n  (comp (drop 10) (take 1))\n  (zipfile-reducible\n    (jio/file (System/getProperty &quot;java.home&quot;) &quot;lib/charsets.jar&quot;)))</code></pre>\n</div>\n</div>\n<div>\n<p>to take this further, we can then crawl <em>every</em> zip entry in <em>every</em> .jar file in <code>/usr/lib/jvm</code> like this</p>\n</div>\n<div>\n<div>\n<pre><code>(defn preserving-reduced\n  &quot;copy-and-pasted from clojure.core, which declares it as private&quot;\n  [rf]\n  #(let [ret (rf %1 %2)]\n     (if (reduced? ret)\n       (reduced ret)\n       ret)))\n\n(defn chaining-reducible\n  &quot;like concat but for reducibles\n  takes a coll of colls.\n  Returns reducible that chains call to reduce over each coll&quot;\n  [coll-of-colls]\n  (reify IReduceInit\n    (reduce [_ f init]\n      (let [prf (preserving-reduced f)]\n        (reduce (partial reduce prf)\n          init\n          coll-of-colls)))))\n\n(defn iszipped-suffix?\n  [^File f]\n  (let [n (.getName f)]\n    (some #(string/ends-with? n %)\n      #{&quot;.jar&quot; &quot;.zip&quot;})))\n\n\n(time (reduce\n        (fn [acc _] (inc acc))\n        0\n        (chaining-reducible\n          (map zipfile-reducible\n            (filter iszipped-suffix?\n              (file-seq (.getParentFile (.getParentFile (jio/file (System/getProperty &quot;java.home&quot;))))))))))\n&quot;Elapsed time: 16922.336304 msecs&quot;\n=> 367051</code></pre>\n</div>\n</div>\n<div>\n<p>Note that we are using lazy sequences of zipfile reducibles;\nIf this created a problem, there is scope for turning this into a reducible too</p>\n</div>\n</div>\n<div>\n<h3><a href=\"https://juxt.pro/blog/rss.xml?category=clojure&since=2016-03-13#_careful_of_those_arities\"></a>Careful of those arities</h3>\n<div>\n<ul>\n<li>\n<p>The 2 argument <code>reduce</code> will only ever use <code>clojure.lang.IReduce</code></p>\n</li>\n<li>\n<p><strong>Everything else</strong> uses <code>clojure.lang.IReduceInit</code> including</p>\n<div>\n<ul>\n<li>\n<p>BOTH arities of <code>transduce</code></p>\n</li>\n<li>\n<p><code>into</code></p>\n</li>\n<li>\n<p><code>eduction</code></p>\n</li>\n</ul>\n</div>\n</li>\n</ul>\n</div>\n<div>\n<p>so</p>\n</div>\n<div>\n<div>\n<pre><code>(reduce + (iterator-reducible nil (.iterator (range 10))))\n\nClassCastException dev$iterator_reducible$reify__54612 cannot be cast to clojure.lang.IReduce  clojure.core.protocols/fn--7831 (protocols.clj:75)</code></pre>\n</div>\n</div>\n<div>\n<p>will throw you a ClassCastException</p>\n</div>\n<div>\n<p>but</p>\n</div>\n<div>\n<div>\n<pre><code>(transduce identity + (iterator-reducible nil (.iterator (range 10))))\n=> 45</code></pre>\n</div>\n</div>\n<div>\n<p>won’t!</p>\n</div>\n<div>\n<p>We could of course extend the <code>iterator-reducible</code> definition to support this\nbut in practice I find the 2 argument form of <code>reduce</code> to be little used.</p>\n</div>\n</div>\n<div>\n<h3><a href=\"https://juxt.pro/blog/rss.xml?category=clojure&since=2016-03-13#_conclusion\"></a>Conclusion</h3>\n<div>\n<p>If you have large volumes of data to process, it is worth considering whether\nreducibles can get you better performance with lower system resource usage.</p>\n</div>\n</div>\n</div>\n</div>",
   :direction "ltr"},
  :updated 1571733000000,
  :entities
  [{:mentions [{:text "system resource"}],
    :id "nlp/f/entity/wd:771906",
    :salienceLevel "about",
    :label "system resource"}
   {:mentions [{:text "L15"}],
    :id "nlp/f/entity/wd:740536",
    :salienceLevel "about",
    :label "L-15 Falcon"}],
  :alternate
  [{:href
    "https://juxt.pro/blog/posts/ontheflycollections-with-reducible.html",
    :type "text/html"}],
  :title "On-the-fly collections with Reducibles",
  :author "The JUXT Blog",
  :published-str "Tue Oct 22 01:30:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16dde8ed2ad:b24c113:69b9f616",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url "https://juxt.pro/img/dog-treadmill.jpg",
   :width 750,
   :height 500,
   :contentType "image/jpeg"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://juxt.pro/blog/posts/ontheflycollections-with-reducible.html",
  :updateCount 1,
  :commonTopics
  [{:score 43.593324234573814,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1571733000000,
  :fingerprint "d5565485",
  :canonicalUrl
  "https://juxt.pro/blog/posts/ontheflycollections-with-reducible.html"}
 {:engagement 9,
  :unread false,
  :crawled 1571309702786,
  :recrawled 1571314140578,
  :content
  {:content
   "<h3>Pisano’da Neden Clojure’u Seçtik?</h3><h3>Clojure Hakkında</h3><p>Clojure, Lisp’in bir türevi olan fonksiyonel programlama dilidir. JVM (Java Virtual Machine), CLR (Common Language Runtime) ve JavaScript platformlarında çalışabilmektedir.</p><figure><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/1024/1*CuN3X88k9k7Vtx4noVbA4Q.jpeg\"></figure><h3>Clojure Seçimi</h3><p>Teknik ekipte <strong>sadece 2 kişi </strong>daha önceden Clojure tecrübesine sahipti. Radikal ve cesur bir kararla Dashboard’umuzu ClojureScript (Clojure’un JavaScript üstünde çalışan versiyonu) ile yeniden yazmaya karar verdik. Bu da ekibin <strong>sıfırdan yeni bir dil</strong> ve <strong>platform</strong> öğrenmesi demekti fakat biz bu riski aldık ve yola koyulduk.</p><figure><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/1024/1*B9qA2L0Fe0d36FXe-hugxw.jpeg\"><strong>Clojure’a geçiş sonrası junior programcıların ilk durumu :)</strong></figure><h3>Takım Kurma Süreci</h3><p>Tabii ki ilk etapta endişeler vardı, çünkü ekibin farklı bir paradigmayı öğrenmesi ve ardından production kodu geliştirmesi süreci söz konusuydu. Beklediğimden kısa sürede <strong>cengaver junior programcılarımız</strong> platformu ve dili hızlıca kucakladılar. Yazdıkça dili daha çok seviyorlar ve daha da fazla yazıyorlardı :) Tabii her şey ilk etapta idiomatic (o dile özgü modelde) kodlanmıyor.</p><p>Bu orta/uzun vadeli bir yatırımdı ve biz bunun çok farkındaydık. Gördük ki ekipteki arkadaşlar eski kodda geliştirme yapma konusunda pek istekli değillerdi. Sanıyorum her Clojure programcısı gibi dilin yalınlığı karşısında büyüleniyorlardı.</p><a href=\"https://medium.com/media/ddb8cb938eba70f07d2fe579c3be3221/href\">https://medium.com/media/ddb8cb938eba70f07d2fe579c3be3221/href</a><p>Türkiye’de hali hazırda Clojure bilen bulabilmek çok zor, tahminim bizlerle birlikte production’a kod yazmış 10 kişi ya vardır ya yoktur. Eğer bu platforma geçmeyi düşünecek olursanız ekibinizi eğitmeniz gerekecek ya da yurtdışından Clojure programcısı tutabilirsiniz.</p><h3>Geri Dönüşler</h3><p>Clojure’u niş veya vizyoner bir dil diye seçmedik, daha önceki projelerde çok ciddi <strong>zamansal ve üretkenlik</strong> avantajları sağladığı için Pisano’da da kullanmaya karar verdik. Enterprise bir ürün geliştirdiğimiz için bu avantajları kesinlikle göz ardı edemezdik.</p><ul><li>Junior arkadaşlarımız <strong>yaklaşık 2 aylık</strong> bir süreçten sonra production’a kod yazmaya başladılar.</li><li>Ekip çok daha <strong>mutlu, üretken ve hızlı</strong>. Fonksiyonel paradigmayı benimsedikleri için <strong>problemleri farklı şekilde çözebilme</strong> yetileri gelişti.</li><li>Bug fix ve feature isteklerine çok daha hızlı cevap verip kısa sürede çıktı sağlıyoruz. (<strong>En büyük avantajımız</strong>)</li></ul><h3>Teknik Kazanımlar</h3><ul><li>Yeni dashbordumuzu çok kısa bir sürede yayına aldık ve eskisine göre çok daha performanslı.</li><li>Google Closure Compiler’ın sunduğu avantajlardan yararlanabiliyoruz.</li><li>Deployment süreçlerimiz kısaldı ve kolaylaştı.</li><li>Lisp’in macroları sayesinde kodumuz çok büyük oranda azaldı ve daha anlamlı hale geldi.</li><li>Artık frontend’i JVM üzerinden serve ettiğimiz için Node’a göre makinayı çok daha utilize edebiliyoruz.</li><li>Müşterilerimizden performans konusunda aldığımız olumlu geri bildirimlerin ardı arkası kesilmedi. Hatta bir müşterimiz yeni dashboard’a Hüseyin (Usain Bolt) adını verdi.</li></ul><a href=\"https://medium.com/media/da7d8faa1f6009630867bca31a903c96/href\">https://medium.com/media/da7d8faa1f6009630867bca31a903c96/href</a><h3>Bir Sonraki Adım</h3><p>Hali hazırda 2 servisimiz Clojure’da çalışıyor; Dashboard (ClojureScript), Event Analytics (Clojure). Bundan sonraki süreçte tüm servislerimizi Clojure’a geçirip tek bir dil kullanarak hem backend hem frontend’i daha optimize bir şekilde yönetmeyi hedefliyoruz.</p><p>Clojure’un bize sunduğu avantajlar işlerimizi son derece rahatlattı, özellikle Enterprise ürününüz olunca bu tarz etkilerin çıktıları çok net gözüküyor. Yazıyı sonlandırırken bizimle aynı kaderi paylaşıp Clojure’u kullanan birkaç ünlü firmanın bulunduğu ufak bir liste sunmak istiyorum.</p><ul><li>Walmart</li><li>Facebook</li><li>Apple</li><li>Boeing</li><li>Amazon</li><li>Netflix</li></ul><p>Teşekkürler <a href=\"https://medium.com/u/4e4b14b23a46\">Muhammet S. AYDIN</a>, <a href=\"https://medium.com/u/1855ce1e444f\">Sabire Avcı</a>, <a href=\"https://medium.com/u/38dd1f5cd4b0\">Burkay Durdu</a>, <a href=\"https://medium.com/u/c3505b239512\">Oguzhan Aydin</a>, <a href=\"https://medium.com/u/e64c0b7c87a4\">ergenekon yigit</a> ve <a href=\"https://medium.com/u/301058193e72\">Alican Çelik</a>.</p><p><strong>Not: </strong>Clojure hakkında derinlemesine daha fazla bilgi sahibi olmak için <a href=\"https://medium.com/@ertu.ctn/neden-clojure-1367365464ae\">bu yazımı okuyabilirsiniz</a>.</p><p>Ertuğrul Çetin, Software Development Team Lead @<a href=\"https://medium.com/u/ca7d43c2ed7f\">Pisano</a></p><img width=\"1\" src=\"https://medium.com/_/stat?event=post.clientViewed&referrerSource=full_rss&postId=de4474707eca\" height=\"1\"><hr><p><a href=\"https://medium.com/pisanoeng/pisanoda-neden-clojure-u-se%C3%A7tik-de4474707eca\">Pisano’da Neden Clojure’u seçtik?</a> was originally published in <a href=\"https://medium.com/pisanoeng\">pisanoeng</a> on Medium, where people are continuing the conversation by highlighting and responding to this story.</p>",
   :direction "ltr"},
  :updated 1571308549000,
  :entities
  [{:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "about",
    :label "Clojure"}
   {:mentions [{:text "Pisano"}],
    :id "nlp/f/entity/wd:22560",
    :salienceLevel "mention",
    :label "Pisano"}
   {:mentions [{:text "JVM"} {:text "Java Virtual Machine"}],
    :id "nlp/f/entity/wd:193321",
    :salienceLevel "mention",
    :label "Java Virtual Machine"}
   {:mentions [{:text "JavaScript"}],
    :id "nlp/f/entity/wd:2005",
    :salienceLevel "mention",
    :label "JavaScript"}
   {:mentions [{:text "Lisp"}],
    :id "nlp/f/entity/wd:132874",
    :salienceLevel "mention",
    :label "Lisp"}],
  :alternate
  [{:href
    "https://medium.com/pisanoeng/pisanoda-neden-clojure-u-se%C3%A7tik-de4474707eca?source=rss-4a9faeeccbe4------2",
    :type "text/html"}],
  :title "Pisano’da Neden Clojure’u seçtik?",
  :author "Ertuğrul Çetin",
  :published-str "Thu Oct 17 03:35:49 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16dd95b4e82:a543639:ad5391a1",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url
   "https://cdn-images-1.medium.com/max/1024/1*CuN3X88k9k7Vtx4noVbA4Q.jpeg",
   :width 1024,
   :height 620,
   :contentType "image/jpeg"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://medium.com/p/de4474707eca",
  :updateCount 1,
  :commonTopics
  [{:score 76.53287715218254,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1571308549000,
  :fingerprint "d2cdf779",
  :canonicalUrl
  "https://medium.com/pisanoeng/pisanoda-neden-clojure-u-se%C3%A7tik-de4474707eca?source=rss-4a9faeeccbe4------2"}
 {:engagement 5,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1571295224456,
  :content
  {:content
   "<p>Product and sum types are collectively known as ‘algebraic data types’. These are two ways of putting types together to make bigger types. Product types multiply their states, while sum types add them. With these two ‘operations’, we can precisely target a desired number of states. In this episode, we explore how we can eliminate corner cases with algebraic data types.</p>\n<p></p>\n<div>\n<div><span></span><img alt=\"Video Thumbnail\" src=\"https://i.ytimg.com/vi/r7Qlh9ioX1s/mqdefault.jpg\"><p></p>\n<h5>What are product and sum types?</h5>\n<p><span>Product and sum types are collectively known as 'algebraic data types'. These are two ways of putting types together to make bigger types. Product types multiply their states, while sum types add them. With these two 'operations', we can precisely target a desired number of states. In this episode,</span></p></div>\n</div>\n<h2>Transcript</h2>\n<p>Eric Normand: What are product and some types? By the end of this episode, you’ll know how to use these two concepts to create a very well-fitting model for your domain. My name is Eric Normand, and I help people thrive with functional programming.</p>\n<p>Data modeling is very important in functional programming. Product and some types are a way of thinking about how our data is structured. These things, product and some types, together, they make up what’s called algebraic data types. That’s just a term that people use all the time.</p>\n<p>I’m going to give a little scenario. Imagine we have some process-workflow engine where we give people a to-do list, a checklist of things to do. When they do it, then someone else has to come by and approve it, that they did it correctly. Then, just for safety, extra assurance, we have a second person check, too.</p>\n<p>When they check it, they either say it’s approved, or disapproved or rejected, something like that. There’s a positive and a negative. Also we have to remember that before they approve it or reject it, we have to record that they haven’t yet.</p>\n<p>We actually have three cases. We have they haven’t checked it yet, they have approved it, or they have rejected it. Then we have two of those because we want two checks.</p>\n<p>If you look at all the possible states, we have three for the first one and three for the second one. Then there’s all the combinations of the two. The first one approves, the second one rejects. The first one approves, the second one approves. There’s all these combinations. How do you figure that out? It’s three times three, so there’s nine.</p>\n<p>Then when you think about it, these people, they’re doing the checks one at a time. There’s the first person’s check and then the second person’s check. You might have all these rules in your system like if the first person rejects it, we don’t need the second check. We’re just going to tell them to do it again.</p>\n<p>You need two approvals. If you have a rejection from either one, then you don’t need the second rejection, if you have the first rejection. What does it mean to have a rejection and then an approval because it’s not even possible to get in your system?</p>\n<p>What does it also mean for the first one to be not checked yet, but the second one is already checked because if they’re going in order, that is not a valid state either.</p>\n<p>What’s happened is we’ve created this system where we’ve got nine possible states. It turns out that several of them are not valid. They don’t make sense in our system. What does it mean for the second approver to check before the first approver has checked? What does that even mean?</p>\n<p>Because if they come first, they should go in the first slot, not the second slot. Then, what does it mean for someone to approve after it’s been rejected? That also doesn’t make sense.</p>\n<p>If you do the math out, there’s quite a few states in here that don’t make sense. Now, the math we’ve done — let’s just go back to that — is we’ve had three possible states and we multiplied it by three possible states. We get nine possible total states.</p>\n<p>We multiply. That’s where the product comes from in product types. When you have two separate fields and each one has certain number of options, to figure out the total number of options for the two, you multiply them together. If you had a third one, you multiply that one together. You had a fourth field, you multiply those together. Now, that’s the product, because product is multiplication.</p>\n<p>Where does the sum come from? Remember, sum is plus. The plus is that you have one unchecked, plus one approved, plus one rejected. As an example, you could have just a state, a status of approved and rejected, and then that’s a type.</p>\n<p>That’s like an enum. That’s two states, and then to add a third one, you can make that a maybe. You’re adding the none case, the nothing case, by wrapping it up in a maybe or an option. That’s the sum type because you’re able to add one, you’re not multiplying them.</p>\n<p>The classic — what do I call it? — essential product type is the tuple. The tuple is just a bunch of values. We have a pair. That’s a two tuple. You can have a triple, that’s a three tuple. The tuple is a product type, meaning you multiply all the possible states together to figure out all the states that your tuple is in.</p>\n<p>The typical sum type is something like an either. Either they’re approved or they’re rejected. It’s an enum.</p>\n<p>The exercise that we have to do as data modelers is take the system that we’ve created, which we’ve created poorly because there are states that are invalid in there, that don’t make any sense.</p>\n<p>The thing is if you’re using a type system, the type system is going to say this is a valid state because that’s what you described. A tuple of two of these maybe statuses can be in any one of nine states, even though maybe three or four of them don’t make sense.</p>\n<p>You’re not getting help from the type system to avoid those. How do you avoid them? You’re going to have to have conditionals in there to make sure that they don’t happen. What kind of conditionals?</p>\n<p>You’re going to say, do we have some approval rating for the first one? Because if so, then we’ll use the second one for this check that we’re doing now. If not, we’ll use the first one. It’s a conditional.</p>\n<p>The conditional is there because you’ve got invalid states. You’re adding complexity by having these invalid states. What we want to do is use the sum and product types to rework this so that it doesn’t have any invalid states.</p>\n<p>Just to get a little bit deeper into the problem that we had, like why did we get here, where we have these invalid states, we broke the problem down. We said, each approver has a certain status or they haven’t done it yet. That’s three.</p>\n<p>There’s three possible choices for each one, and that’s true of both. It’s true of both, but when you combine them, the combination isn’t a pure product because there are states in that product that you don’t want to be possible.</p>\n<p>The problem was combining them with a tuple. Unfortunately, that happens a lot. I do it all the time where I say, “Oh, I have two Booleans and I’m trying to represent something with three states, but two Booleans is four states.” Then I have all this code to make sure I don’t get into that weird fourth state that shouldn’t make sense.</p>\n<p>Let’s start with that two Booleans case. If we have two Booleans and we only need to represent three states, how would we do that instead? What else could we do?</p>\n<p>Three is a prime number, so you think I can’t do a product really because a prime number is only a product of one and itself. The one doesn’t make sense as a type. What we do is then have to use a sum. We just make an enum or a sum type, a union, of the three possible choices. Instead of using two Booleans, we use three possible choices.</p>\n<p>Likewise, we could say that there’s the case where no one has checked yet, the case where the first one has checked, and then the case where the second one has checked. That’s three cases.</p>\n<p>In the case where no one has checked, there’s no other data we need to store. It’s just no one has checked. We could call that enum [indecipherable 10:26] . The case where the first person has checked, we have to capture what status they gave it. Did they give it approval or rejection?</p>\n<p>In the case where two people have checked, we have to capture both of them. We capture the first one and the second one. Both are approval or rejection.</p>\n<p>If you add that up, you have zero case. That’s one. The one person has checked. There’s two possibilities there. That’s 1+2. That’s three. Then in the two case, we have approve or reject twice. That’s 2*2. That gives us four. That’s 1+2+4 = 7. That’s seven cases.</p>\n<p>You could try to model more closely that once the rejection has happened, first, you can’t have a rejection and then an approval. We could say in the two-person case, we don’t need to capture the first one anymore. That first one has to be an approval. We don’t need to capture it.</p>\n<p>Instead of the two-person case, we could call it, “One approves,” or we could have, “Zero have checked, one have checked and approved, two have checked and approved and rejected.” We don’t record who rejected it, whether it’s the first one or the second one. Maybe we could. We could say, “Rejected by the first, rejected by the second.”</p>\n<p>We’re splaying out all the possibilities. In this case, if we have zero have checked, that’s one case. One has approved, also one case. Two have approved, one case. First one rejected, one case. Second one rejected. That would imply the first one approved. That’s also one case. How many is that?</p>\n<p>Zero, first approved, second approved, first rejected, second rejected, that’s five. That is probably closer to what…That probably exactly fits what we want. Since five is prime, it’s hard to do a product in there, but you could have a product to where it’s like, 2*2+1. It’s 4+1. Somehow, you have a 2*2 in there to get the four.</p>\n<p>There’s all sorts of possibilities there that we can explore. The idea is you are using the structure of the product and sum to closely match. As closely as possible, you want to target exact the actual number of cases that you want to capture.</p>\n<p>When you talk about all the zero, and then one, and then two, you might start to think we need something like a list. I would explore that for sure, not only because it makes sense — zero, one, two — but it also is like a more general data structure. What if we want to change our process so we have three approvals necessary? This is a way of making it the more general case.</p>\n<p>Of course, there’s always a trade-off between getting very close with a huge type that you’re developing that has all these constraints on it versus have a more general type that does have some invalid cases, but you work within the code with a few if-statements to avoid those. That might actually be cleaner. In a lot of cases, it is. Sometimes, the generality of it is actually better.</p>\n<p>Let’s look at the list as a type. Lists are a sum type. They’re an interesting sum type. List is either an empty list or an element and the rest of a list. The prototypical English words we use when we’re talking about a sum type is either/or. You have either an empty list, or the first element of the list and the rest.</p>\n<p>“Or” is usually used for sum types. “And” is usually used for product types, so the element and the rest of the list. Notice the type is recursive. A list could have another list inside of it. That’s what makes it really interesting.</p>\n<p>If you were just to do the math, let’s say it’s not recursive, it’s two cases, a list or the head of the list, and something else. Because it’s recursive, that list could be infinite in theory. There’s no bounds to it. The size of this list now becomes infinite, the number of possible states this list could be in. It’s unbounded in its growth.</p>\n<p>That’s another constraint on your system. Do you want to allow unconstrained growth? In a type system like this that we’re talking about, it’s harder to make a list of length three or two, like we want here. It’s harder to do that than it is to have an infinite list.</p>\n<p>If you want it to be length two, you’re going to have to do checks to make sure it doesn’t grow pass that, but sometimes you want that. You want the underlying generality of we don’t know how many approvals we’re going to want in the end.</p>\n<p>It could be possible that you use a list. You have the empty list. That means zero people have checked. Then you add a check and a status. That’s the first element on the list, the only element on the list. Then you add a second one. Then you add a third one. You add a fourth one, all these statuses.</p>\n<p>Then you can do, it’s another way of doing it, you’d say if any of them are rejections, we reject it. Or maybe you could count them up and figure out a vote between do we approve or reject.</p>\n<p>You can do all of these things. As opposed to modeling the transitions very precisely with the type, you’re using more of a calculation to figure out whether to approve or reject that task.</p>\n<p>These are all ideas in data modeling. I’m exploring this idea because the third part of my book is all about data modeling. I don’t have a very organized view of what this chapter or this part is going to be about, what are the skills that people need to learn.</p>\n<p>I think sum and product types are a pretty good way of being able to talk about what states are possible. A lot of languages don’t have them in a strict way. They allow you to make them in a lot of times, but it’s a hack. In Clojure, we don’t really have sum and product types in the sense that Haskell has them, but we do make tuples using vectors.</p>\n<p>Hash maps are product types because you have different values, then each of those values takes on different values, and so you multiply them together to get the total number of states possible. But we don’t have enums. What we use is keywords usually, if we need enums.</p>\n<p>It’s not very straightforward in Clojure, how to use them. They’re more like idioms and patterns that we use.</p>\n<p>Likewise, in something like JavaScript, you can basically do the same thing. You can use a raise to represent tuples, or you can use hash maps to represent tuples. How do you represent sum types? There’s no enum, but you could use strings, you could use something like that.</p>\n<p>It’s not the easiest thing to see, and that’s why I want to teach people how to see this stuff.</p>\n<p>I learned this in Haskell. Haskell does it really straightforward, really clearly. That’s how I learned it, and I’m trying to teach it to people who don’t have the opportunity to work in Haskell.</p>\n<p>Anyway, these are really important concepts. You have product types, which means you multiply the number of states to get the total number of states. The word in English that we use for product types is “and.”</p>\n<p>You have the first status “and” the second status. Then, there’s some types which add the states together. You might just add one. You might add 10 other states. The word we use in English is either/or, or just either or just or. It’s either/or because it’s one or the other. It’s not the or that has both inclusive or it’s either/or, exclusive or. Those do a sum.</p>\n<p>Lists are a sum type, but it’s recursive. it’s not just adding because you’re adding infinity to it. It really explodes the number of possible states, which might be fine because you still have the two basic cases, where I either have a list or I don’t. It’s either empty or I have an element that is the first thing. That’s how we use it. When we process lists, we often do it recursively.</p>\n<p>If you enjoyed this episode, you can find all the past episodes at lispcast.com/podcast. There you’ll find all of the old podcasts, the existing podcasts with audio, video, and text.</p>\n<p>You’ll also find links to subscribe, whether you subscribe with RSS, iTunes, YouTube, or just text RSS. You’ll also find links for finding me on social media, on Twitter, LinkedIn, email, etc.</p>\n<p>Looking forward to hearing from you. Thank you for listening. My name is Eric Normand. This has been my thought on functional programming, rock on.</p>\n<p>The post <a rel=\"nofollow\" href=\"https://lispcast.com/what-are-product-and-sum-types/\">What are product and sum types?</a> appeared first on <a rel=\"nofollow\" href=\"https://lispcast.com\">LispCast</a>.</p>",
   :direction "ltr"},
  :updated 1571292000000,
  :entities
  [{:mentions [{:text "data modeling"}],
    :id "nlp/f/entity/wd:367664",
    :salienceLevel "mention",
    :label "data modeling"}
   {:mentions [{:text "functional programming"}],
    :id "nlp/f/entity/wd:193076",
    :salienceLevel "mention",
    :label "functional programming"}
   {:mentions [{:text "Haskell"}],
    :id "nlp/f/entity/wd:34010",
    :salienceLevel "mention",
    :label "Haskell"}
   {:mentions [{:text "RSS"}],
    :id "nlp/f/entity/wd:45432",
    :salienceLevel "mention",
    :label "Rich Site Summary"}
   {:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}],
  :alternate
  [{:href "https://lispcast.com/what-are-product-and-sum-types/",
    :type "text/html"}],
  :title "What are product and sum types?",
  :author "Eric Normand",
  :published-str "Wed Oct 16 23:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16dd87e6288:a41072d:ad5391a1",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url "https://i.ytimg.com/vi/r7Qlh9ioX1s/mqdefault.jpg",
   :width 320,
   :height 180,
   :contentType "image/jpeg"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://lispcast.com/?p=2058",
  :commonTopics
  [{:score 112.84293735640347,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1571292000000,
  :fingerprint "3b999989",
  :canonicalUrl "https://lispcast.com/what-are-product-and-sum-types/"}
 {:engagement 14,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1571157751838,
  :content
  {:content
   "<p>Often, as well-meaning programming language enthusiasts, we might find ourselves encouraging newcomers with simplified descriptions of language features.\nThere’s sometimes a tricky balance between explaining things in an approachable way and explaining them correctly and precisely.\nLet me give some examples of what I’m talking about, and then we can zoom out to think about the implications.</p>\n<h3>Ruby</h3>\n<blockquote>\n<p>Ruby, like many OO languages, has visibility methods that let you ensure nobody will depend on the code you’re using! This helps you know what’s safe to modify!</p>\n</blockquote>\n<p>Sure enough, the basics work like we'd expect:</p>\n<div><pre><code><span></span><span>class</span> <span>ActivateUser</span>\n  <span>def</span> <span>call</span><span>(</span><span>activation_code</span><span>)</span>\n    <span>user</span> <span>=</span> <span>fetch_user</span><span>(</span><span>activation_code</span><span>)</span>\n    <span>raise</span> <span>ArgumentError</span><span>,</span> <span>&quot;Activation code '</span><span>#{</span><span>activation_code</span><span>}</span><span>' is invalid&quot;</span> <span>if</span> <span>!</span><span>user</span>\n    <span>user</span><span>.</span><span>update!</span><span>(</span><span>:activation_code</span> <span>=></span> <span>nil</span><span>,</span> <span>:active</span> <span>=></span> <span>true</span><span>)</span>\n    <span>user</span>\n  <span>end</span>\n\n  <span>private</span>\n  <span>def</span> <span>fetch_user</span><span>(</span><span>activation_code</span><span>)</span>\n    <span>User</span><span>.</span><span>where</span><span>(</span><span>:activation_code</span> <span>=></span> <span>activation_code</span><span>)</span><span>.</span><span>first</span>\n  <span>end</span>\n<span>end</span>\n\n<span>class</span> <span>TestActivateUser</span> <span>&lt;</span> <span>Minitest</span><span>::</span><span>Test</span>\n  <span>def</span> <span>setup</span>\n    <span>User</span><span>.</span><span>delete_all</span>\n    <span>User</span><span>.</span><span>create</span><span>(</span><span>:email</span> <span>=></span> <span>&quot;jen@example.com&quot;</span><span>,</span> <span>:activation_code</span> <span>=></span> <span>&quot;GOOD_CODE&quot;</span><span>)</span>\n    <span>@activator</span> <span>=</span> <span>ActivateUser</span><span>.</span><span>new</span>\n  <span>end</span>\n\n  <span>def</span> <span>test_a_bad_activation_code_cant_be_fetched</span>\n    <span>assert_raises</span><span>(</span><span>ArgumentError</span><span>)</span> <span>{</span> <span>@activator</span><span>.</span><span>call</span><span>(</span><span>&quot;BAD_CODE&quot;</span><span>)</span> <span>}</span>\n  <span>end</span>\n\n  <span>def</span> <span>test_a_good_activation_code_updates_and_returns_the_user</span>\n    <span>user</span> <span>=</span> <span>@activator</span><span>.</span><span>call</span><span>(</span><span>&quot;GOOD_CODE&quot;</span><span>)</span>\n    <span>assert_equal</span> <span>user</span><span>,</span> <span>User</span><span>.</span><span>where</span><span>(</span><span>:email</span> <span>=></span> <span>user</span><span>.</span><span>email</span><span>)</span><span>.</span><span>first</span>\n    <span>assert_equal</span> <span>&quot;jen@example.com&quot;</span><span>,</span> <span>user</span><span>.</span><span>email</span>\n    <span>assert_nil</span> <span>user</span><span>.</span><span>activation_code</span>\n    <span>assert_equal</span> <span>true</span><span>,</span> <span>user</span><span>.</span><span>active</span>\n  <span>end</span>\n\n  <span>def</span> <span>test_a_good_activation_code_updates_the_user</span>\n    <span>user</span> <span>=</span> <span>@activator</span><span>.</span><span>call</span><span>(</span><span>&quot;GOOD_CODE&quot;</span><span>)</span>\n    <span>assert_equal</span> <span>&quot;jen@example.com&quot;</span><span>,</span> <span>user</span><span>.</span><span>email</span>\n    <span>assert_nil</span> <span>user</span><span>.</span><span>activation_code</span>\n    <span>assert_equal</span> <span>true</span><span>,</span> <span>user</span><span>.</span><span>active</span>\n  <span>end</span>\n\n  <span>def</span> <span>test_private_method_access_prevented</span>\n    <span>assert_raises</span><span>(</span><span>NoMethodError</span><span>,</span> <span>/private method `fetch_user` called for/</span><span>)</span> <span>{</span>\n      <span>@activator</span><span>.</span><span>fetch_user</span><span>(</span><span>&quot;GOOD_CODE&quot;</span><span>)</span>\n    <span>}</span>\n  <span>end</span>\n<span>end</span>\n</code></pre></div>\n<p>But we can bypass private methods in at least a few ways:</p>\n<div><pre><code><span></span><span>def</span> <span>test_private_method_access_allowed_with_send</span>\n  <span>user</span> <span>=</span> <span>@activator</span><span>.</span><span>send</span><span>(</span><span>:fetch_user</span><span>,</span> <span>&quot;GOOD_CODE&quot;</span><span>)</span>\n  <span>assert_equal</span> <span>&quot;jen@example.com&quot;</span><span>,</span> <span>user</span><span>.</span><span>email</span>\n<span>end</span>\n\n<span>def</span> <span>test_private_methods_can_be_made_public</span>\n  <span># We could send this message to `ActivateUser` instead, but then we'd</span>\n  <span># need `Minitest::Test.i_suck_and_my_tests_are_order_dependent!` to keep</span>\n  <span># our tests deterministic, and nobody wants that.</span>\n  <span>@activator</span><span>.</span><span>singleton_class</span><span>.</span><span>send</span><span>(</span><span>:public</span><span>,</span> <span>:fetch_user</span><span>)</span>\n\n  <span>user</span> <span>=</span> <span>@activator</span><span>.</span><span>fetch_user</span><span>(</span><span>&quot;GOOD_CODE&quot;</span><span>)</span>\n  <span>assert_equal</span> <span>&quot;jen@example.com&quot;</span><span>,</span> <span>user</span><span>.</span><span>email</span>\n<span>end</span>\n</code></pre></div>\n<p>Ah, Ruby.\n<code>private</code> is a principle, not a guarantee.</p>\n<h3>Clojure</h3>\n<blockquote>\n<p>Use Clojure - you don’t have to worry about anyone mutating your collections out from under you! Immutability by default!</p>\n</blockquote>\n<p>Not so fast.\nThis test suite passes too:</p>\n<div><pre><code><span></span><span>(</span><span>test/deftest</span> <span>test-immutability</span>\n  <span>(</span><span>test/testing</span> <span>&quot;the awesomeness of immutability&quot;</span>\n    <span>(</span><span>let </span><span>[</span><span>xs</span> <span>[</span><span>0</span> <span>1</span> <span>2</span> <span>3</span> <span>4</span> <span>5</span> <span>6</span> <span>7</span> <span>8</span> <span>9</span><span>]</span>\n          <span>ys</span> <span>(</span><span>map </span><span>(</span><span>fn </span><span>[</span><span>x</span><span>]</span> <span>(</span><span>* </span><span>x</span> <span>x</span><span>))</span> <span>xs</span><span>)]</span>\n      <span>(</span><span>test/is</span> <span>(</span><span>= </span><span>(</span><span>range </span><span>10</span><span>)</span> <span>xs</span><span>))))</span>\n\n  <span>(</span><span>test/testing</span> <span>&quot;the pleasing nature of... wait what??&quot;</span>\n    <span>(</span><span>let </span><span>[</span><span>xs</span> <span>[</span><span>0</span> <span>1</span> <span>2</span> <span>3</span> <span>4</span> <span>5</span> <span>6</span> <span>7</span> <span>8</span> <span>9</span><span>]]</span>\n      <span>(</span><span>do-something</span> <span>xs</span><span>)</span>\n      <span>(</span><span>test/is</span> <span>(</span><span>= </span><span>(</span><span>repeat </span><span>10</span> <span>:boom</span><span>)</span> <span>xs</span><span>)))))</span>\n</code></pre></div>\n<p>In Clojure, you can use Java interop to mutate PersistentVector.\nSimilar things are possible for other persistent data structures.</p>\n<div><pre><code><span></span><span>(</span><span>defn- </span><span>replace-array</span> <span>[</span><span>f</span> <span>arr</span><span>]</span>\n  <span>(</span><span>dotimes </span><span>[</span><span>i</span> <span>(</span><span>alength </span><span>arr</span><span>)]</span>\n    <span>(</span><span>let </span><span>[</span><span>current</span> <span>(</span><span>aget </span><span>arr</span> <span>i</span><span>)]</span>\n      <span>(</span><span>aset </span><span>arr</span> <span>i</span> <span>(</span><span>f</span> <span>current</span><span>)))))</span>\n\n<span>(</span><span>defn- </span><span>replace-node</span> <span>[</span><span>f</span> <span>root</span><span>]</span>\n  <span>(</span><span>let </span><span>[</span><span>node-arr</span> <span>(</span><span>->></span> <span>root </span><span>.array</span><span>)</span>\n        <span>first-node</span> <span>(</span><span>first </span><span>node-arr</span><span>)]</span>\n    <span>(</span><span>if </span><span>(</span><span>and </span><span>first-node</span> <span>(</span><span>instance? </span><span>clojure.lang.PersistentVector$Node</span> <span>first-node</span><span>))</span>\n      <span>(</span><span>doseq </span><span>[</span><span>node </span><span>(</span><span>filter identity </span><span>node-arr</span><span>)]</span>\n        <span>(</span><span>replace-node</span> <span>f</span> <span>node</span><span>))</span>\n      <span>(</span><span>replace-array</span> <span>f</span> <span>node-arr</span><span>))))</span>\n\n<span>(</span><span>defn </span><span>mutate-vector</span> <span>[</span><span>f</span> <span>xs</span><span>]</span>\n  <span>(</span><span>replace-node</span> <span>f</span> <span>(</span><span>.root</span> <span>xs</span><span>))</span>\n  <span>(</span><span>replace-array</span> <span>f</span> <span>(</span><span>.tail</span> <span>xs</span><span>)))</span>\n\n<span>(</span><span>defn </span><span>do-something</span> <span>[</span><span>xs</span><span>]</span>\n  <span>(</span><span>mutate-vector</span> <span>(</span><span>constantly </span><span>:boom</span><span>)</span> <span>xs</span><span>))</span>\n</code></pre></div>\n<p>Ah, Clojure.\n&quot;Immutability&quot; is a principle, not a guarantee.</p>\n<h3>Haskell</h3>\n<blockquote>\n<p>You should use Haskell, where the type system enforces immutability and even side effects! You can tell just by looking at the type signature!</p>\n</blockquote>\n<p>You can probably sense where this is going: this isn’t really true either.\n<code>unsafePerformIO</code> can take you to some pretty gnarly places:</p>\n<div><pre><code><span></span><span>count</span> <span>::</span> <span>String</span> <span>-></span> <span>Int</span>\n<span>-- definition redacted for now</span>\n\n<span>data</span> <span>StringData</span> <span>=</span> <span>StringData</span> <span>{</span>\n  <span>text</span> <span>::</span> <span>String</span><span>,</span>\n  <span>reversed</span> <span>::</span> <span>String</span><span>,</span>\n  <span>size</span> <span>::</span> <span>Int</span>\n<span>}</span> <span>deriving</span> <span>(</span><span>Show</span><span>)</span>\n\n<span>stats</span> <span>::</span> <span>String</span> <span>-></span> <span>StringData</span>\n<span>stats</span> <span>text</span> <span>=</span> <span>StringData</span> <span>{</span>\n  <span>text</span> <span>=</span> <span>text</span><span>,</span>\n  <span>reversed</span> <span>=</span> <span>reverse</span> <span>text</span><span>,</span>\n  <span>size</span> <span>=</span> <span>count</span> <span>text</span>\n<span>}</span>\n\n<span>main</span> <span>::</span> <span>IO</span> <span>()</span>\n<span>main</span> <span>=</span> <span>print</span> <span>(</span><span>size</span> <span>(</span><span>stats</span> <span>&quot;Hello, World!&quot;</span><span>))</span>\n</code></pre></div>\n<p>Since <code>count</code> returns an <code>Int</code>, we should see <code>main</code> printing an <code>Int</code>.\nBut that's not what happens!</p>\n<p>It prints:</p>\n<div><pre><code><span></span><span>&quot;OHH NOOOOOO&quot;</span>\n<span>13</span>\n</code></pre></div>\n<p>Despite the type signature clearly indicating purity, we’re able to do whatever impure side-effecting operations we want:</p>\n<div><pre><code><span></span><span>import</span> <span>System.IO.Unsafe</span> <span>(</span><span>unsafePerformIO</span><span>)</span>\n\n<span>count</span> <span>::</span> <span>String</span> <span>-></span> <span>Int</span>\n<span>count</span> <span>text</span> <span>=</span>\n  <span>unsafePerformIO</span> <span>$</span> <span>do</span>\n    <span>print</span> <span>&quot;OHH NOOOOOO&quot;</span>\n    <span>return</span> <span>$</span> <span>length</span> <span>text</span>\n</code></pre></div>\n<p>Ah, Haskell.\nPurity is a principle, not a guarantee.</p>\n<h2>Zooming out</h2>\n<p>If you're a developer and/or advocate for one of these technologies, I’m sure you have your counter-arguments ready about why the example in <em>your</em> preferred language isn’t such a big deal.\nIt might surprise you, but I don’t disagree with the counterpoints—far from it!</p>\n<p>My point is <em>not</em> that everything is on fire and nothing is sacred.\nAffordances to help developers do the right things can still be very useful, even when they’re not guarantees.\nYou can break a law, but laws are still useful.\nAnd programming principles with escape hatches can be, too.</p>\n<p>I don't want to litigate the necessity of these escape hatches for the language designers, because I don't think it's actually that important.\nWhatever the reasons, these facilities give us the <em>power</em> to do things that seem to conflict with key principles in these languages.</p>\n<p>And when we overstate our opinions and frame principles as guarantees, to put it charitably we <em>confuse</em> people about what they can and should believe.\nWe don’t have to give everyone all the details of edge cases like these.\nBut some acknowledgement of where the lines exist, between principle and guarantee, can help us to avoid those misunderstandings and potential distrust.</p>\n<p>Being precise with language can be a huge pain sometimes.\nSuch a huge pain that I'm confident there are at least a handful of imprecise and even incorrect statements in this post.\nBut by striving for precision as a <em>principle</em>, I think we're a lot more likely to build trust with the folks we're communicating with.</p>\n<p>If you're interested in playing with these examples, check out <a href=\"https://github.com/trptcolin/escape-hatches\">the Github repo</a>.</p>",
   :direction "ltr"},
  :updated 1571115600000,
  :entities
  [{:mentions [{:text "programming language"}],
    :id "nlp/f/entity/wd:9143",
    :salienceLevel "about",
    :label "programming language"}
   {:mentions [{:text "OHH"}],
    :id "nlp/f/entity/wd:2903185",
    :salienceLevel "mention",
    :label "Okha Airport"}],
  :alternate
  [{:href
    "https://8thlight.com/blog/colin-jones/2019/10/15/escape-hatches-principles-vs-guarantees.html",
    :type "text/html"}],
  :title "Escape Hatches: Principles vs. Guarantees",
  :author "Colin Jones",
  :published-str "Mon Oct 14 22:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16dd04cb81e:9e346ae:69b9f616",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url
   "https://8thlight.com/blog/assets/posts/2019-10-15-escape-hatches/principles-guarantees-a17fdb22edd588e62f5cc3016912f93232c806dd3f6f63d9183ae14bab7d593e.png",
   :width 2400,
   :height 1256,
   :contentType "image/png"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://8thlight.com/blog/colin-jones/2019/10/15/escape-hatches-principles-vs-guarantees.html",
  :commonTopics
  [{:score 68.60519009291727,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1571115600000,
  :fingerprint "b588011",
  :canonicalUrl
  "https://8thlight.com/blog/colin-jones/2019/10/15/escape-hatches-principles-vs-guarantees.html"}
 {:engagement 210,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1571081518895,
  :content
  {:content
   "<p>Gene Kim shared part 1 of a “love letter to Clojure” inspired by Bryan Cantrell’s amazing <a href=\"https://twitter.com/bcantrill/status/1042180114199375872\">“I’m falling in love with Rust” blog post in September 2018</a></p>\n<blockquote>\n<p>In this blog post, I will explain how learning the Clojure programming language three years ago changed my life. It led to a series of revelations about all the invisible structures that are required to enable developers to be productive.<br>\n…<br>\nWithout doubt, Clojure was one of the most difficult things I’ve learned professionally, but it has also been one of the most rewarding. It brought the joy of programming back into my life. For the first time in my career, as I’m nearing fifty years old, I’m finally able to write programs that do what I want them to do, and am able to build upon them for years without them collapsing like a house of cards, as has been my normal experience.</p>\n</blockquote>\n<p><a href=\"https://changelog.com/news/agoO\">Discuss on Changelog News</a></p>",
   :direction "ltr"},
  :updated 1571078813000,
  :entities
  [{:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "about",
    :label "Clojure"}
   {:mentions [{:text "programming language"}],
    :id "nlp/f/entity/wd:9143",
    :salienceLevel "mention",
    :label "programming language"}],
  :alternate
  [{:href "https://itrevolution.com/love-letter-to-clojure-part-1/",
    :type "text/html"}],
  :title "Love letter to Clojure (part 1)",
  :author "Adam Stacoviak",
  :published-str "Mon Oct 14 11:46:53 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16dcbc17f2f:92d7933:ad5391a1",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url
   "https://itrevolution.com/wp-content/uploads/2019/10/love-letter-to-clojure-part-1-gene-kim-1.png",
   :width 1200,
   :height 630,
   :contentType "image/png"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://changelog.com/changelog.com/news/agoO",
  :commonTopics
  [{:score 58.3981345463832,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1571078813000,
  :fingerprint "9049c8f6",
  :canonicalUrl
  "https://itrevolution.com/love-letter-to-clojure-part-1/"}
 {:engagement 13,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1571054468638,
  :recrawled 1571133314246,
  :content
  {:content
   "<p>I prefer Clojure to Haskell. It’s probably mostly due to accidents of history: getting in Lisp at an earlier age, spending more time with Lisp, and only having one Haskell job. But I do have some philosophical differences with the Haskell philosophy as it relates to Haskell as an engineering tool. In this episode, I go over four of them, and try to relate them with anecdotes.</p>\n<p></p>\n<div>\n<div><span></span><img alt=\"Video Thumbnail\" src=\"https://i.ytimg.com/vi/xcZ5yq_gG-4/mqdefault.jpg\"><p></p>\n<h5>Why do I prefer Clojure to Haskell?</h5>\n<p><span>I prefer Clojure to Haskell. It's probably mostly due to accidents of history: getting in Lisp at an earlier age, spending more time with Lisp, and only having one Haskell job. But I do have some philosophical differences with the Haskell philosophy as it relates to Haskell as an engineering tool. I</span></p></div>\n</div>\n<p>The post <a rel=\"nofollow\" href=\"https://lispcast.com/why-do-i-prefer-clojure-to-haskell/\">Why do I prefer Clojure to Haskell?</a> appeared first on <a rel=\"nofollow\" href=\"https://lispcast.com\">LispCast</a>.</p>",
   :direction "ltr"},
  :updated 1571050800000,
  :entities
  [{:mentions [{:text "Haskell"}],
    :id "nlp/f/entity/wd:34010",
    :salienceLevel "about",
    :label "Haskell"}
   {:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "Lisp"}],
    :id "nlp/f/entity/wd:132874",
    :salienceLevel "mention",
    :label "Lisp"}],
  :alternate
  [{:href "https://lispcast.com/why-do-i-prefer-clojure-to-haskell/",
    :type "text/html"}],
  :title "Why do I prefer Clojure to Haskell?",
  :author "Eric Normand",
  :published-str "Mon Oct 14 04:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16dca24be1e:949695d:97b0c8f7",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url "https://i.ytimg.com/vi/xcZ5yq_gG-4/mqdefault.jpg",
   :width 320,
   :height 180,
   :contentType "image/jpeg"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://lispcast.com/why-do-i-prefer-clojure-to-haskell/",
  :updateCount 2,
  :commonTopics
  [{:score 68.54329801653758,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 29.573532942093205,
    :id "nlp/f/topic/3000",
    :salienceLevel "about",
    :label "artificial intelligence"}],
  :published 1571050800000,
  :fingerprint "c89d3c3a",
  :canonicalUrl
  "https://lispcast.com/why-do-i-prefer-clojure-to-haskell/"}
 {:engagement 5,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1571050055536,
  :content
  {:content
   "<div>\n<p><em>Issue 348 – October 14, 2019 · <a href=\"https://purelyfunctional.tv/newsletter-archives/\">Archives</a> · <a title=\"Thanks, Jeff!\" href=\"https://purelyfunctional.tv/newsletter/\">Subscribe</a></em></p>\n<h2>Clojure Tip 💡</h2>\n<p><em>cleanup in <code>finally</code></em></p>\n<p>There’s a common pattern in code, where you need to create a resource, use it, then clean up the resource.</p>\n<pre><code>(let [resource (create-resource)]\n  (use-resource resource)\n  (cleanup-resource resource))\n</code></pre>\n<p>You can imagine the resource is anything that might need some cleanup. It could be opening a file, reading from it, then closing the reader. Or a database connection. Or a thread pool.</p>\n<p>After a while, we may realize that the function <code>use-resource</code> could throw an exception. We want to catch that exception, so we do this:</p>\n<pre><code>(let [resource (create-resource)]\n  (try\n    (use-resource resource)\n    (cleanup-resource resource)\n    (catch Exception e\n      (handle-exception e))))\n</code></pre>\n<p>This looks good, but unfortunately there’s a problem. If <code>use-resource</code> throws an Exception, it will skip the cleanup. We could copy the <code>cleanup-resource</code> call also inside the catch:</p>\n<pre><code>(let [resource (create-resource)]\n  (try\n    (use-resource resource)\n    (cleanup-resource resource)\n    (catch Exception e\n      (handle-exception e)\n      (cleanup-resource resource))))\n</code></pre>\n<p>This will work, but there’s a better way built into Clojure and the JVM. The <code>try</code> expression allows you to add a <code>finally</code> clause that is always run when exiting the <code>try</code> expression. It’s run regardless of how the <code>try</code> expression is exited. If the body is successful, the <code>finally</code> clause is run. And if any of the <code>catch</code> statements, or none of them, are run, the <code>finally</code> is also run.</p>\n<p>This is what it looks like:</p>\n<pre><code>(let [resource (create-resource)]\n  (try\n    (use-resource resource)\n    (catch Exception e\n      (handle-exception e))\n    (finally\n      (cleanup-resource resource))))\n</code></pre>\n<p>Another nice thing is that you can use the <code>finally</code> clause even without a <code>catch</code>. That is, you can ignore exceptions (let them slip through) but still have safe cleanup of resources.</p>\n<p>You might be wondering about what happens with the value of a <code>try</code> expression if you use a <code>finally</code>. Well, there’s no need to worry. The value of a <code>try</code> is unaffected by having a <code>finally</code>. The value of the last expression in the <code>try</code>‘s body is the value of the <code>try</code>. Here’s an example:</p>\n<pre><code>(defn fetch-user [userid]\n  (let [db (db/connect)]\n    (try\n      (db/fetch db &quot;user&quot; userid)\n      (finally\n        (db/disconnect db)))))\n</code></pre>\n<p><code>db/fetch</code> returns the results of a query. It’s the last expression in the <code>try</code>, so the result of the query is returned from the function <code>fetch-user</code> (or it throws an exception, of course).</p>\n<p>One more thing: if you are opening a file or a stream, you could write this:</p>\n<pre><code>(let [writer (io/writer &quot;my-file.txt&quot;)]\n  (try\n    (doseq [x (range 100)]\n      (.write writer x)\n      (.write writer &quot;\\n&quot;))\n    (finally\n      (.close writer))))\n</code></pre>\n<p>That write the numbers 0 through 99 to a file using the <code>try/finally</code> pattern we just went over. However, Clojure comes with a macro that does that specific version of the pattern. If the cleanup you do in a <code>finally</code> is just to call the <code>.close</code> method, you should use <a title href=\"https://clojuredocs.org/clojure.core/with-open\"><code>with-open</code></a>. Here’s what it looks like:</p>\n<pre><code>(with-open [writer (io/writer &quot;my-file.txt&quot;)]\n  (doseq [x (range 100)]\n    (.write writer x)\n    (.write writer &quot;\\n&quot;)))\n</code></pre>\n<p>The <code>try</code>, <code>finally</code>, and <code>.close</code> are handled for you. If you’re interested in how the <code>with-open</code> macro can be written, I’ve got a lesson on it called <a title href=\"http://pftv.wpengine.com/clojure-macros/macro-example-with-open/\">Macro example: with-open</a>.</p>\n<h2>Book update 📖</h2>\n<p>Chapter 4 of <em>Grokking Simplicity</em> is out! Chapter 4 is about refactoring your actions to extract out calculations. By making code calculations, you make it easier to test and reuse.</p>\n<p>You can <a title href=\"https://lispcast.com/gs\">buy the book</a> and use the coupon code <strong>TSSIMPLICITY</strong> for 50% off.</p>\n<p>I’ve been getting such positive messages about the book. Thank you so much for reading it. It’s hard work and those nice messages help me keep going.</p>\n<h2>PurelyFunctional.tv Update 💥</h2>\n<p>A couple of weeks ago, I added a long-missing feature to PurelyFunctional.tv. Before, if you bought a Team License to a course, the only way to share it with your team was to download it and share the files. That wasn’t very convenient.</p>\n<p>Now, you can share your Team License purchases with other users on the site, so they can view them online. You can add people to your team by their email addresses. Just <a title href=\"https://purelyfunctional.tv/your-membership/#team\">visit your dashboard</a> and enter their emails. They’ll then have access to the courses you’ve bought with a Team License.</p>\n<h2>Currently recording 🎥</h2>\n<p>This week, there’s a new, much anticipated lesson. This one is all about Clojure Spec integration. In this lesson, we go over how to access the automatically created generators for Specs and how to replace them with custom generators when needed.</p>\n<p>Go check it out here: <a title href=\"https://purelyfunctional.tv/lesson/testing-with-spec-custom-generators/\">Testing with Spec: custom generators</a></p>\n<p>Up next? How to test functions with Spec. We’ll be exploring the limits of the testing we can do in Spec. Spoiler alert: it’s quite powerful.</p>\n<p>BTW, Magnus Kvalevåg has a cool <a title href=\"https://www.youtube.com/watch?v=xw8ZFU8CGdA\">presentation</a> on stateful property based testing at Clojutre.</p>\n<h2>Clojure Challenge 🤔</h2>\n<h3>Last week’s challenge</h3>\n<p>The challenge in <a title href=\"https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-347-tip-catch-and-catch-again/\">Issue 347</a> was to write a function to efficiently remove a value from a vector, given its index in the vector.</p>\n<p>You can check out the submissions <a title href=\"https://gist.github.com/ericnormand/2f6df330c7dd906a5f0ba19c3229afd1\">here</a>.</p>\n<p>I tried a variety of implementations and did some primitive benchmarking of them. I need a more thorough system to know which one is the fastest.</p>\n<p>Alan Thompson points out that <a title href=\"https://cloojure.github.io/doc/tupelo/tupelo.core.html#var-drop-at\">Tupelo</a> has this function already.</p>\n<h3>This week’s challenge</h3>\n<p><em>parallel execution</em></p>\n<p>If you need to run an action on all elements of a collection, you can use <a title href=\"http://clojuredocs.org/clojure.core/run!\"><code>run!</code></a>.</p>\n<pre><code>(run! println (range 100))\n</code></pre>\n<p>This will run all of the <code>println</code>s in sequence. But there’s no built-in function to run all of those functions in parallel. That’s your task this week.</p>\n<p>Write a function <code>runp!</code> that takes a function and a sequence of arguments. It will run the function on different threads and wait for them all to finish. It returns <code>nil</code>, just like <code>run!</code>.</p>\n<pre><code>(defn runp! [f coll]\n</code></pre>\n<p>Please be mindful of the number of threads it creates. For instance, if I create 4000 threads on my machine, it crashes the OS. The typical solution is to use a thread pool.</p>\n<p>As usual, please send me your implementations. I’ll share them all in next week’s issue. If you send me one, but you don’t want me to share it publicly, please let me know.</p>\n<p>Rock on!<br>Eric Normand</p>\n</div>\n<p>The post <a rel=\"nofollow\" href=\"https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-348-tip-cleanup-in-finally/\">PurelyFunctional.tv Newsletter 348: Tip: cleanup in finally</a> appeared first on <a rel=\"nofollow\" href=\"https://purelyfunctional.tv\">PurelyFunctional.tv</a>.</p>",
   :direction "ltr"},
  :updated 1571047200000,
  :entities
  [{:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "about",
    :label "Clojure"}
   {:mentions [{:text "macro"}],
    :id "nlp/f/entity/wd:629579",
    :salienceLevel "mention",
    :label "macro"}
   {:mentions [{:text "JVM"}],
    :id "nlp/f/entity/wd:193321",
    :salienceLevel "mention",
    :label "Java Virtual Machine"}],
  :alternate
  [{:href
    "https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-348-tip-cleanup-in-finally/",
    :type "text/html"}],
  :title "PurelyFunctional.tv Newsletter 348: Tip: cleanup in finally",
  :author "Eric Normand",
  :published-str "Mon Oct 14 03:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16dc9e16770:94310fd:97b0c8f7",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url "http://img.youtube.com/vi/xw8ZFU8CGdA/0.jpg",
   :width 480,
   :height 360,
   :contentType "image/jpeg"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://purelyfunctional.tv/?p=32176",
  :published 1571047200000,
  :fingerprint "6286f2df",
  :canonicalUrl
  "https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-348-tip-cleanup-in-finally/"}
 {:engagement 5,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1571037769032,
  :recrawled 1571039951930,
  :content
  {:content
   "<p>In this episode, I talked about my new book “Grokking Simplicity – Taming complex software with functional thinking”.</p>\n<audio controls=\"controls\" class=\"wp-audio-shortcode\"><source type=\"audio/mpeg\" src=\"https://mcdn.podbean.com/mf/download/dcjidh/EP_63_PRODUCTION.mp3?_=1\"><a href=\"https://mcdn.podbean.com/mf/download/dcjidh/EP_63_PRODUCTION.mp3\">https://mcdn.podbean.com/mf/download/dcjidh/EP_63_PRODUCTION.mp3</a></audio>\n<h4><a href=\"https://htmlallthethings.com/Podcast/5d9e35fe6a070d0011eb657f\">HTML All The Things</a></h4>\n<h2>Transcript</h2>\n<p>Matt: Hello everybody and welcome to the HTML All The Things podcast, Episode 63. Grokking Simplicity with Eric Normand, I’m here with [inaudible 0:14] Lawrence and I’m joined again by my co-host, Mike Koran.</p>\n<p>If you’ve been enjoying the podcast so far, and you want to support us, there are a couple of ways that you could do that. You can review us on the apple podcast or on the podcast platform that you are listening to this on.</p>\n<p>You can check us out on Patreon, we only have a couple of tiers right now but that three-dollar tier will give you a shout out in the podcast and we’ll even share a link to your website in our show notes. Probably the most important one is just to tell your friends that we’re here and we’re ready to be listened to. Get this out there. Just share.</p>\n<p>We really need a slogan for that, “Just Share,” or something like that. It almost sounds like “Shazam.” We also have a discord server, so if you’re ready to do more than just listen to us, if you want to come and hang out, you can come and join us in our discord server, which now has over 200 members.</p>\n<p>I’ll do my best impression of a party noise maker, [screams] , but anyway, [inaudible 1:08] come, join us in that discord server to come chat about off topic things, about development things. We got people in there talking about WordPress, HTML, CSS, JavaScript, jQuery, BHP, everything under the sun.</p>\n<p>There’s probably something that we’re not talking about in there, but anyway we have a whole bunch of stuff we’re talking about. If you want to come and hang out with a cool group of developers from all walks of the industry, from the experience through the non-experience, feel free to do so.</p>\n<p>Link to that discord server will be in the description almost said, what is this, YouTube? It might actually be, but anyway, we’ll be in the show notes. Now, in today’s episode, we will be discussing the book, “Grokking Simplicity: Taming complex software with functional thinking” with none other than the author himself, Eric Normand.</p>\n<p>He started with functional programming in the year 2000 and has since watched the industry slowly take notice. Eric has spoken at conferences around the world covering topics like functional programming, Clojure, ClojureScript, property-based testing and concurrent programming.</p>\n<p>On top of that, he also offers consulting and training services having worked with the likes of the federal government through non-profit companies. If you’d like to pick up Eric’s book, we have a promo code available which is podhtmlall19.</p>\n<p>We’ll be including a link to the place where you can actually purchase the book as well as that promo codes. You can easily read it, just copy and paste it. That’ll be in the full show notes on the HTML all the things website. We also have actually five copies of the book to give away for free.</p>\n<p>We’ll be putting two of those codes in the show notes on htmlallthethings.com. Now, full disclosure, these are single use codes, so first come, first served. If you’re lucky enough to grab one of these codes, now if you copy them, they aren’t gonna disappear. You better copy that code and immediately try to redeem it.</p>\n<p>Also, one thing to just note in case there’s a delay of some sort, these codes are only valid for two months from September 12th, 2019. Make sure you claim them in time before they time out. Now, I did mention that we have five codes that we can give away.</p>\n<p>The other three, we will be giving away in our discord server. I will be tagging the @everyone tag for anyone that’s in the server. I’ll be explaining how we’re going to give those away and they’ll be given away within a day or two as of this recording, which is, let me just read the date to make sure this is official, which is October 8th, 2019.</p>\n<p>Make sure that you go and check that out if you’re listening to this as a fresh episode. If you’re in the future, I’m sorry, but you can use that discount code if you’d like to get a nice discount.</p>\n<p>Now, without further ado, let’s cut to that, let me say juicy, but I don’t know what I meant by juicy like am I just thinking of the keg, the juicy steak. Anyway, let’s cut to that interview with Eric and Mike, stay tuned.</p>\n<p>All right everyone, we have Eric on the line, and as is the tradition around here, Eric, please take it away. Let us know what you’re doing, what you’re up to, and a little bit of your back story.</p>\n<p>Eric Normand: Hi. I’m Eric. I am currently writing a book about functional programming for beginners to functional programming, but people who have had some experience with at least one language. It’s called Grokking Simplicity, and it’s published through Manning.</p>\n<p>Basically, it’s supposed to be a fun trip through the paradigm shift of functional programming. That’s one thing I’m doing. I’m also a teacher online. I record videos, courses on Clojure and functional programming. You can find those @purelyfunctional.tv. That’s about all I do.</p>\n<p>Matt: Great, thank you for being on the show. I’m really looking forward to this episode because we haven’t really done…I don’t know if we’ve done any talks. Maybe Michael will have a comment on that, done any talks at all on functional programming on the show.</p>\n<p>This should be a really interesting one, especially for a lot of our listeners because they are usually either hobbyists or beginners or some veterans in their course, but this will be a really interesting sort of a topic to cover since it’s so new to us.</p>\n<p>I’ll jump right in here. These are going to be some preemptive questions regarding the book in the segment Writing a Book in our show notes there. “Grokking Simplicity” isn’t complete yet, but rather has been released as an early access title. Why did you choose to go the early access route?</p>\n<p>Eric: The idea behind early access to get more feedback faster. Writing a book is a long process. It’s good to know how the book is going to do [laughs] before you finish the book. If it doesn’t do well, you could try to figure out why. Get some feedback from some of the early readers and pivot. Maybe they’ll ask you good questions that directs the new chapters that you’re still writing.</p>\n<p>I’ve talked to the people at Manning. They say that the reason they started it was because technology changes so quickly that often a new version — let’s say you’re writing a book about a database — of the database could come out before you finish writing your book.</p>\n<p>It’s a shame because the first three chapters have been ready for a year. [laughs] If someone could have been using them and gaining some value out of it before the final chapters are done. I look at it like that.</p>\n<p>It’s a good way to get it out there. It’s very motivational when people buy it. I’m not done. Oh, some people are buying it. OK, I better keep working on it. I better finish it up. I do that with my courses as well. I knew what I was getting into, and I really think that it helps a lot.</p>\n<p>Mike: How do you choose when to stop and release the early access portion, or if that’s not enough, or it’s much? When do you cut yourself off and be like, OK, this is enough for an early access bit?</p>\n<p>Eric: Good question. Manning has their own process behind it that I’m not really in control of. I don’t really have that much introspection into how it works. But this is what they’ve told me that they want to release something when it has significant value and it’s not embarrassing.</p>\n<p>Something where you’ve put some good quality content in there and it’s not too rough that people would be like, “What is this?” Then the idea is publish one new chapter or a significant update to the book every month just to keep the momentum going, keep people who have bought engaged with the book. Don’t let it go too long without new content so that they’d forget what the book is about and why they were reading it.</p>\n<p>Mike: Another thing. Matt and I read the chapters that we got. You mentioned in those early chapters future chapters. Like in Chapter 17, we’ll cover this and that, and stuff like that. Before you even begin, you have a full outline of what you’re going to be covering chapter by chapter.</p>\n<p>I’m assuming you have to send that to the publisher, get that approved. There’s probably a big process where your book is planned, it’s just those other chapters aren’t refined yet, right? Is that how it works?</p>\n<p>Eric: Yeah, that’s right. After we signed the contract and everything, the first thing they ask me for…This is the publication contract. The first thing ask me for was a table of contents. I was like, “Are you sure? I could make one up, but I don’t really know [laughs] what I’m going to have.</p>\n<p>They were like, “Yeah. That’s what we want.” We want to know what are the topics you think you’re going to cover. It can change. It’s not a commitment, but that’s where we work. At first, I was just very hesitant to do it, very reluctant but the more I thought about it, the more I was like, “OK, I have these ideas in my head. They don’t know what I’m going to write about. They have no idea. They need something. [laughs] They can’t just wait for me to write them.”</p>\n<p>I sat down and I made up the table of contents. They send it out for review to other functional programming experts and asked them questions like, “Are there any topics missing? Are there any things that you think are important?”</p>\n<p>Sort of grade the thing on one to five. Is it good quality? Do you think that this would be worth reading? Questions like that. Everyone said, “Yeah. Those things sound good.” At the same time the people who weren’t functional programming experts like my editor and other people at the end manning, they were like, “I don’t know what this is about.”</p>\n<p>[laughter]</p>\n<p>Eric: What is that chapter about? One of my chapters is, “sets.”</p>\n<p>[laughter]</p>\n<p>Eric: They are like, “Sets? What does that have to do with functional programming?” I’m like, “Well, you wanted me to write the topic with the chapters. This is it. This is the topics of the chapters.” Since then, the table of contents has refined.</p>\n<p>I’ve gotten better about understanding how to craft the title of a chapter and what I actually want to say. Actually, I think you read…Yes. You read the first release the V1 of the MIP.</p>\n<p>In the V2 which is coming out really soon, I can’t say when it’s out of my hands but it’s close. There’s a totally different table of contents because I reorganized the material in a much better way. It’s evolving. It starts somewhere and it evolves.</p>\n<p>Matt: Sorry. What I was going to ask there was, how open are you and maybe the publisher are to actually changing the maybe not the addition number but the previous chapters? Do you guys get stuck on, “OK, I’ve written parts.” Let’s say parts one through four. You keep refining and refining that.</p>\n<p>Then struggle to get on to part five in this case? Or do you keep writing ahead and then just keep going back when you receive that feedback and do like little changes?</p>\n<p>Eric: Yeah. This is another interesting question. Just a little background. I’ve been blogging for over 10 years. I’m much more comfortable like, “Let me just write a first draft and hit publish.” [laughs] Then my publisher is there.</p>\n<p>They want me to go over and like, “Oh, this could be better.” I’m like, “Yeah, but it’s good enough for the MIP, right? I’ll come back later.” They’re like, “Well, while you’re here just finish it.” I’m like, “Just send it out.”</p>\n<p>There’s a little tension there because I really do have this tendency of just like, “Get the idea out, see what people think. Get some comments before regretting sending it out [laughs] and definitely change it.”</p>\n<p>I would much rather finish a sketch of all the chapters and then come back through because by the time you get to the end, you’ve learned so much that when you do the second pass you can incorporate that learning.</p>\n<p>My editor is much more like, “No, first impressions matter.” Like, “We know how to improve this. Let’s just keep improving this until we can’t.” Really in practice what happens is we do that until I feel stuck.</p>\n<p>I feel I could improve this, but I’m tired of it. I’m burned out on this chapter. Can we just put it down and move on? That’s what happens. It’s more like, “I just don’t want to work on it anymore.”</p>\n<p>[laughter]</p>\n<p>Matt: I guess that’s when you know you’ve put enough work into it, right?</p>\n<p>Eric: Yeah. I guess so. I don’t know. I’ve never seen him stop. [laughs] Maybe we can keep going and going and going. It’s really maybe that’s what he’s doing. He’s pushing me until I can’t go anymore. I don’t know.</p>\n<p>Matt: The next question here, so when would you say is a good time to start writing a book? Couple of things to compare to. Like, how much expertise do you need to have? Do you need to perceive things a certain way? Do you need to have a level of mastery in some way?</p>\n<p>Eric: That’s a good question. I think it depends a lot on your goals. What are you trying to get out of the book? One of the things is that you don’t want to…You don’t want to fake expertise, fake mastery, fake more experience than you have. You don’t want to do that. People can see through that really easily.</p>\n<p>That being said, I think that if you’re a good writer you can make a compelling story or a compelling read out of your beginner experience. If you could turn that into something, I think it’s there. However, depending on your goals, you might…</p>\n<p>What I’m afraid is someone who doesn’t have a lot of expertise will waste their time. It takes a long time to write a book, a lot of effort. If your goal is something like write this book and make a lot of money or sell a lot of copies or even gain some notoriety in the community, you’re much better off earlier on publishing smaller things.</p>\n<p>A blog for instance, articles in the magazine. Smaller things that you can finish and see how well you’re doing you’re developing the craft of writing, you’re developing your communication style and the message that you want to have.</p>\n<p>You might find that, “OK, I have written 10 magazine articles. I think that I’ve got a book idea now.” “This is too big for a magazine article.” I think that it should come naturally and organically.</p>\n<p>For instance, my book, my goal is to spread functional programming. I think that is one of my goals. I have several goals for the book. One of them is to make functional programming more accessible, more popular.</p>\n<p>I just had this idea, this little core and I had to BS the rest of the table of contents. I knew that there was a core there. As I developed it, it turned into a well fleshed out table of contents. It’s big enough for a book. I knew that.</p>\n<p>I only knew that because I’ve written a lot on my blog. I’ve given conference talks. I’ve published these videos. I knew that it was a major thing. I couldn’t do it justice in a blog post.</p>\n<p>Matt: That’s interesting. I like how you broke it down. For me, when I think about writing a book, it scares me right away. I think it’s because I don’t have that body of work that you’re talking about. I don’t have something that I couldn’t say in a blog post. I think that’s my issue.</p>\n<p>Whereas what you’re saying is, when you get so many blog posts, and you’re like, “OK, I’ve planned out seven or eight different blog posts on the same topic.” Maybe that’s the point when you’re like, “OK, maybe I can expand this, because I have so much to say about it, into a book.”</p>\n<p>I really like how you broke that down. I think that’ll help the audience understand when it is you should start thinking about writing a book, rather than, “Do I have the knowledge? Do I have the expertise?” Stuff like that.</p>\n<p>You’re right. That’s the wrong way to think about it, because it’s impossible to tell.</p>\n<p>Eric: Right. I didn’t know I was going to write a book until I found that idea. It wasn’t like, “OK, I need an idea for a book, let me brainstorm ideas.” No, it was the opposite. I had this thing…</p>\n<p>I wrote a blog post and it was about different paradigms like, “How do you define imperative programming? What’s object-oriented programming? Then, “What’s functional programming?”</p>\n<p>In doing that I realized I came up with a pretty unique formulation for what it is. This is from years and years of writing about functional programming and talking to people, going to conferences, practicing functional programming. Then I was invited to speak at a conference, and they said, “You pick the topic.”</p>\n<p>I said, “I think I want to talk about this idea about what functional programming is.” I gave the talk. Then I realized, “This is a big idea. The talk couldn’t contain it. I need to turn it into something bigger.”</p>\n<p>I started podcasting about it, and it’s just like streaming out of me, all these topics on functional programming. No preparation, I just start recording and start talking about a topic.</p>\n<p>Then, I would do that multiple times a day [laughs] like so far ahead, I was like I should publish two a week as I am never going to finish my recorded episodes. Then, I decided, “OK, it is going to be a book.”</p>\n<p>Matt: That’s cool. It’s a cool little insight into an author’s mind, I guess. [laughs] One question and this is more of an organizational project planning kind of question, how do you break up your day? How much time do you spend writing your book?</p>\n<p>Is it like a daily thing where like this day is just meant for the book or do you break up your day, be like four hours book time, four hours not book time? What is your process?</p>\n<p>Eric: My process is really disorganized.</p>\n<p>Matt: [laughs] Like all of us.</p>\n<p>Eric: Yeah. I’m trying to think if there is some like, “Oh, this is my ideal,” like I have done it for a week and it was awesome. I’ll tell you, what I try to do is have a day for the book where it’s like, “Tuesday, I’m going to sit down and work on chapter six.”</p>\n<p>That lets me get into the book, forget other things. I close my email, I close all that, just work on the book. I have two kids and they disrupt my schedule a lot. One of them is a baby, so it is very disruptive.</p>\n<p>The book also is not very text-heavy. When I write blog posts, I’m like, “OK, I want to write a lot of blog posts. I have a big post to write.” I have a schedule like, OK, I’ll wake up early in the morning, and I just get my keyboard and a coffee and I just start writing. I just type.</p>\n<p>This book isn’t like that. I really need to be able to work in different modes. It is also such a big topic. I have to take notes. I have note cards, I am like saying, “This is later. This goes in that section.”</p>\n<p>It’s also a lot of mouse work, like laying pictures out, doing codes, snippets, and things in the book. It’s not quite as like single-minded focus as I remember from writing a lot of blogs. That’s why I like to have the whole day because I don’t know how long it’s going to take.</p>\n<p>I want to be able to just spend all day with no cards like shuffling them around, maybe I don’t produce any pages that day.</p>\n<p>Matt: How vital would you say is — I guess this is more toward blog posts — hitting those targets that a lot of engagement specialists and a lot of marketing folks will say, “You should do a blog a day or a blog every other day.”</p>\n<p>How much pressure do you put on yourself to actually reach targets like that like, “Oh, I need to post something every Wednesday,” let’s say, or something like that.</p>\n<p>Eric: Right now, the only schedule I really try to keep…I guess I have two schedules. I have the podcast. I feel like that should be regular, I don’t know why but I feel like I want a podcast to go out every Monday and Thursday.</p>\n<p>I’ve got my newsletter that goes out every Monday morning. I want to do at least an hour of video per week — video courses. Other than that, I feel like I cannot really sustain anymore.</p>\n<p>I have also, in my blogging, gone more toward a longer form and more comprehensive guide approach because I think at the point where I am at, in terms of you SEO and authority building and stuff, I really want…</p>\n<p>I’m working in Clojure, that’s what I’m teaching. I want there to be a comprehensive Clojure learning site. These little one off 500 to 1,000 worded blog posts are not going to ever get there. I need to say, “OK, I’m going to look at every single data structure,” and just list them out.</p>\n<p>For each one, I am going to talk about when to use it, when not to use it, and that turns into an 80,000-word thing. That’s just the link that has to be. I think that works better for me where I am at.</p>\n<p>I do think that there is something to having a schedule because I am not typing so much right now like typing words for writing stuff, I find that I hesitate a lot more like “Oh, maybe I shouldn’t type that,” whereas when I have a schedule like, “OK, every day, I have to post a blog post.”</p>\n<p>I don’t think. I’m like, “I’ve got to get this thing out,” because [laughs] this is a lot of words. You know I had tricks. Here’s a trick that I used to use. I was for, I don’t know, a few months posting a blog a day.</p>\n<p>What I realized was, when someone would ask me a question in email, I wouldn’t hesitate, I would just open up the email, hit reply, and just start typing an answer. I thought why does blogging have to be harder than that.</p>\n<p>What I would do was the night before, I would email myself a question. I would phrase it like, “Hey, Eric. I’m a big fan. I have a question about Clojure,” and [laughs] then I would write out the question like I was really asking it.</p>\n<p>Then, I’d go to sleep and then in the morning I’d wake up with my coffee and I’d open up the mail client like, “Oh, an email from a fan,” and [laughs] I’d open it up. Just like, “Oh, nice question, Eric.”</p>\n<p>I would always start like I was actually responding like, “Hey, Eric, nice question, thanks for reaching out, enter.” Then, I’d just start typing the answer and then that will be my blog post. It worked, it was like a psychological trick to get me to write more without hesitating and second-guessing, “Is this worth it?” or whatever. No.</p>\n<p>It wasn’t like these comprehensive guides. It was a specific question, a specific answer and it worked. It’s really great.</p>\n<p>Matt: It’s like setting your clock ahead by 10 minutes. You’re just tricking yourself every day.</p>\n<p>Eric: [laughs] Yeah, exactly. By telling your friend, “Pick end between 10 and 20” and set my clock ahead so I won’t know how far ahead it is.</p>\n<p>Matt: [laughs] Yeah, exactly. It works, it’s been proven to work. That’s a cool little trick there, that’s awesome. In your blog post would you actually keep the header parts?</p>\n<p>Eric: That’s a good question. What I would do is say, “Hey, that’s a great question. Let me rephrase the question for you just to see if I understand it and then I’m going to answer it.” I would start the paragraph like, “Someone just asked me, duh, duh, duh, duh.” [laughs] and then I’d answer it. Yeah.</p>\n<p>Matt: Giving away all your secrets to your fans. Everyone thought you were just getting asked all these questions but…</p>\n<p>[laughter]</p>\n<p>Eric: Sometimes they were directed at me, but usually it took me a month to really come up with the answer. Now that I sent it to myself…</p>\n<p>Matt: Now it’s in writing and it’s there in front of you. That’s cool.</p>\n<p>Eric: Exactly.</p>\n<p>Matt: With that all being said, there was a segment about, “How to write a book” and stuff like that. I want to move on to functional programming because I think it is an important topic. I learned about it a little bit when I was studying in university. We learned about all the different programming paradigms.</p>\n<p>When I sat down to read your book, I didn’t know what to expect obviously because you and I had never talked and I had never read anything from the Grokking series. Grokking is a series from what I understand it right that you’re just adding on to as an author?</p>\n<p>Eric: Yeah. Series is a book term. They’re not related like you got to read this one, then the next one, and then the next one like a television series. You have to watch them in order. They do have a similar style and they’re supposed to have a similar scope and feel to them.</p>\n<p>Matt: Yeah, exactly. When I sat down to read it, I was actually in a hotel room and I popped out my iPad and went through it. It was actually a really interesting and engaging read. Even for someone that maybe wasn’t expecting it and wasn’t looking for, “OK, I need to change all my stuff to functional programming.”</p>\n<p>I thought it was good in the sense that it taught me what I was doing that was already functional and how to think a little bit differently as well. Which is valuable to anyone at any point in their programming life. If you’re just starting out even, I would say this is a valuable thing to know about. To know about a thing called functional programming.</p>\n<p>Because not only will you know about, “OK, this is how to think functionally,” but you’ll know that what you’ve been doing, there’s certain things you’ve been doing that are already functional. It’s cool to label what you’ve been doing because it’s tough.</p>\n<p>When I was first starting out, you just sit down and write code. Your code just looks however it is — spaghetti code, functional code it doesn’t matter. It just works. It’s tough to talk about it to other industry professionals. It’s tough to label it, it’s tough to organize it in your head as you go forward.</p>\n<p>It was definitely a helpful reminder of functional programming and a very much a “scope-broadener.” It definitely broadened my interests in it which was cool. I like the way book was laid out like you were saying, it wasn’t text-heavy. It’s very much diagram-heavy and picture-heavy which is a really cool way of doing a programming book.</p>\n<p>Because I read a few of them and a lot of the ones that I have read have been text-heavy and they’ve been a little bit harder to sit down and read in an afternoon. I sit down and read when I need to like, if I pick up a book usually about programming, it’s usually because I need something from it period.</p>\n<p>It’s not an entertainment thing for me. Whereas a Grokking-type style like this style of book was almost an entertainment thing. I sat down with a coffee like you were saying, you were writing it, I sat down the same way reading it and I was like, “Wow, this is actually really interesting.” Props to you on creating that atmosphere in your book and…</p>\n<p>Eric: Thank you.</p>\n<p>Matt: Yeah, no problem. I just want you to give a quick overview to our audience because our audience is usually very new to programming. Usually new to web development in general. They’re looking at it from a very beginner point-of-view, so if you can give a nice overview, doesn’t have to be too in-depth obviously of what functional programming is.</p>\n<p>Eric: Sure. I do want to say thank you for all the nice things you just said about my book. I feel like you hit the nail on the head or I hit the nail on the head. [laughs] That was my goal. What you said is my goal. It’s to make it feel like, “Oh, I know some functional programming.”</p>\n<p>I do want to also thank y’all two because there’s a lot of beginners out there and you’re making great content for beginners and really making it very accessible for them. Anything to help people along, any content out there, thank you so much.</p>\n<p>Matt: Thank you.</p>\n<p>Mike Koran: Thank you very much, yeah.</p>\n<p>Eric: OK, an overview of functional programming. This is not going to be the Wikipedia definition of functional programming, because I think the Wikipedia definition of functional programming does a disservice by being too academic and obtuse.</p>\n<p>There’s a lot of baked-in assumptions about what you need to know to understand that definition. This book is trying to take people who don’t have those assumptions already and give them a perspective for how to see their code. So that that definition might one day make sense to them.</p>\n<p>Functional programming is a paradigm. You might have heard of imperative programming or object-oriented programming. Functional programming is one of those. Those are three different paradigms. It’s a set of perspectives and skills that you approach problems with.</p>\n<p>You have some programming problems, how do you look at it? What are the first things you do? What are the things you look for? How do you look at the problem, and then what kinds of programming skills are you going to bring to the table to solve it?</p>\n<p>The way I define functional programming is the first perspective, the first distinction that a functional programmer makes is to divide everything into actions, calculations, and data. Actions are things that have an effect on the world or if your system is affected by the world.</p>\n<p>If you get an event like a mouse click, your program is being affected by the outside world. Or you could send an AJAX request that’s having an effect on the world. Because you’re posting some data to the server, now the server is different.</p>\n<p>Calculations are pure computations. That means that it’s something like addition. You know four plus four doesn’t have any effect on the world. It just calculates eight and it’s going to calculate eight every time. Doesn’t matter when you run it. It’s timeless. It’s just always going to do that. You can write your functions to do the same.</p>\n<p>If you wrote a function that would just return four plus four. That function now, every time you run, is going to give you eight. It’s going to give you the same answer. You know you can make a more complex function of course that has arguments.</p>\n<p>If, for the same arguments, it returns the same value and it doesn’t send Ajax requests or do any actions, then it’s a calculation. It’s something that you don’t have to worry about when it runs, whereas for instance, if your system sends an email, you do have to worry about when that runs.</p>\n<p>I want to send the email, or at least I have to worry about how many times it runs. Sending the email zero times is totally different from sending it one time. There might be things that you have to do in a certain order like I want to set the button to spinner, like get the Ajax request, and then that response is going to…Now, I’m going to put the value into the button.</p>\n<p>These things have to happen in a certain order and it’s hard to have order in a Async environment like JavaScript. It turns out other systems, other languages that don’t have Async stuff, they still have the same problem.</p>\n<p>Then data. This is the third thing. Data is just what you would call data. Numbers, strings, data structures. What’s interesting about them is they are totally inert. They don’t do anything. They just sit there. You can send them across the wire. You can save them to a disk. You can do whatever you want to them. They can be interpreted at all ends of that sending and receiving.</p>\n<p>Because they don’t do anything, they need to be interpreted by something. They need to be interpreted to give them meaning, because the number four doesn’t mean anything unless you know how to interpret it.</p>\n<p>The same with a huge Jason blob. What do I do with this? Oh, I’m looking for the user ID, which is down in this object deeper in here. OK, that’s where the user ID is stored. You’re interpreting that object in a certain way.</p>\n<p>Data is the safest, because it can never crash. It can never have any problems you can have bad formatted data, of course, but it’s data, it’s still data. It’s not going to cause any problems.</p>\n<p>Calculations are good because they’re pure. They can be easily tested. One thing about testing is you’re probably going to want to run the same function multiple times. You don’t have to set up any environment for a pure function, for a calculation because it doesn’t depend on anything on the outside except the arguments, and you pass those in and you can choose exactly what to pass in.</p>\n<p>You can run it on a different machine. You can run your test on your billed server. That test is going to be valid for someone’s browser, when the JavaScript is running in the browser.</p>\n<p>Actions are the most problematic but they’re necessary, because you need to send that email or you’re not doing what your software is meant to do. We need them, but we also know that they’re most dangerous. They’re the most difficult to work with.</p>\n<p>A lot of functional programming, starting with these divisions, splitting things up and identifying these are my actions, these are the calculations, these are the data. Once you split them up, you can start to focus more attention on the actions because that is where the problem is. You just pay more attention to them.</p>\n<p>You can move code from action into calculation. You refactor stuff. Pull it out, “Oh, look, here’s this little calculation I’m doing inside of this big action.” I can now make that into a function, which is a calculation. You’re moving code out, making it more testable, more reusable.</p>\n<p>This is a large part of what the first part of the book is about. It’s about how to identify them, how to refactor stuff out, how to work with data so that it’s immutable, meaning you never change it.</p>\n<p>Then, the chapter wraps up with a little bit of architecture, a little design called stratified design, where it’s about how you can design these layers of meaning so that the layers of code align themselves with how fast they change.</p>\n<p>You’d imagine the fastest changing code is on top and the more stable code is on the bottom. That’s really nice because the stuff on top is built on the stuff below it. You don’t have to change the stable stuff. If you had to change the stable stuff, [laughs] everything on top would topple over.</p>\n<p>Because it changes less frequently, you’ve sort of reduced your maintenance to the minimum.</p>\n<p>Matt: Yeah, that’s a really good, succinct functional programming overview. Thank you for that, that’s for sure.</p>\n<p>Hopefully, with that, people can kind of form something in their minds of what functional programming is because as we’re going to move forward, we’ll talk a little bit about functional programming as well as when to use it and stuff like that. Just keep what Eric had said in mind.</p>\n<p>Next question here would be, most developers, especially ones listening to the podcast, wouldn’t label themselves in one of these paradigms because they’re just starting out like they’re just doing JavaScript.</p>\n<p>JavaScript can be one of many things [laughs] when you’re writing it. That’s one of its things. How important is it, two-part question here, to know about all the different approaches that are out there like all the different paradigms out there right away as you’re starting out developing?</p>\n<p>How important is it to use one and then strictly follow it, like really dive into only functional programming and be an expert in that?</p>\n<p>Eric: I have two answers to that [laughs] . I don’t think it’s so important to be strict on any one paradigm when you’re programming. I look at them as sets of skills. In my book, I’m really breaking up functional programming as a set of skills that happen to be used by functional programmers.</p>\n<p>These are things that come from that perspective. They’re not exclusive to functional programmers, but I would say that they’re more common, functional programming team, but they’re useful. They need to pay the skills and the approaches, need to pay for themselves right away.</p>\n<p>Meaning you should not think if I’m not a 100 percent functional, it’s not worth doing at all. You should be able to see, “Oh, if I just made this one thing immutable, then I would solve the problem that I have.”</p>\n<p>You don’t have to make everything immutable, just this one thing or this function is getting really long, let me factor out all of the little calculations inside. Maybe that’s one little thing you do in one place in your code and it just makes it a little bit better.</p>\n<p>That would make me very happy if people learned to do this kind of piecemeal functional programming. That said, in terms of learning it, I think there’s something to be said for immersion.</p>\n<p>If you’re really into learning object-oriented programming, you might be better off choosing a language that makes it really easy and makes everything else hard. Then you’re going to have to figure out how to solve problems with those skills and those perspectives rather than some other one that you might already know.</p>\n<p>Likewise, with functional programming, I think it is easier to learn if you are in a functional language so one that makes functional programming the default.</p>\n<p>That’s not to say that you can’t learn it and you can’t learn the skills, but it’s just like learning a language. You can learn to speak a few words and even some grammar and make sentences, but everyone knows the best thing is to just live in the country where you’re forced to use it.</p>\n<p>Matt: Absolutely. Just to follow up with that, what would you say are the functional languages then like? Do you have a few in mind?</p>\n<p>Eric: Yeah. Clojure, Haskell, Erlang, Elixir, PureScript, TypeScript. Not TypeScript. I wouldn’t put TypeScript in that. Elm on the front end. Rust is pretty functional. Swift is functional.</p>\n<p>Matt: Swift is functional. Where would you label something like JavaScript?</p>\n<p>Eric: JavaScript is multiparadigm. I would say that you can do functional programming in it but it’s not…It’s like a city where you can speak both German and Spanish. If you speak Spanish, you’re not going to learn German because you’re just going to speak Spanish every time.</p>\n<p>If you know imperative programming in JavaScript, it’s going to take a lot of will power and discipline to stick with the functional stuff which might be good. If you’re working at work and you just need to get features done, sometimes you’re just going to do it the familiar way.</p>\n<p>Then sometimes you’re going to say, “OK I’ve more time, let me see how I would do this in a functional way.” That’s a perfectly fine way to learn. Do it again. Once the way you’re familiar with and then the second time try to approach it with different set of constraints. That’s a great way to learn it fact.</p>\n<p>Matt: That makes perfect sense. I think with the web developing crowd in general it’s kind of these concepts are always a little bit harder because of that multi-paradigm approach of JavaScript.</p>\n<p>When you’re talking to someone and you’re like, “Just use the object-oriented approach” They are like, “Why? I’m just writing this code.” Like, “Why are you trying to get me down in certain specific path?”</p>\n<p>Eric: I’m just getting it to work. [laughs]</p>\n<p>Matt: Yeah, I’m just getting it to work even though if they were using something like Java, they would be forced to use the object-oriented and it’s a lot easier.</p>\n<p>Eric: You see the opposite which is someone who overuse its OO. That’s great because they’re exploring the class keyword, the new class keyword in JavaScript. They want to do everything with that instead of the simple way which would just be use the function. Like, “Why are you making a class for that?”</p>\n<p>That’s great except if you’re doing it on production code like that’s not your time, you’re spending. [laughs] You’re spending company time on your learning. Maybe you should be doing that on your own time to explore that thing.</p>\n<p>See, I think doing these extreme things which is like, “I want to use the class everywhere, I want to find the limits, right?” That’s great. I’ve grew up on that kind of stuff like, “I’m never going to call. I’m never going to write a function. I’m going to only do methods.”</p>\n<p>Sure, do that. Then that might not be the actual most professional way to write it. You have to recognize that.</p>\n<p>Matt: That makes perfect sense. One thing I bring you back to the book a little bit, in the book you actually chose to use JavaScript as the language to explain functional programming. I think you do a good job explaining why.</p>\n<p>I just want you to point out to everyone. It’s also important for our audience to know that when you’re going to be reading the book, most of you are familiar with JavaScript so this book resonates with you more than someone that’s not familiar with JavaScript.</p>\n<p>Eric: Good question. I feel the need to emphasize that it isn’t a functional programming in JavaScript book. This a very common question that I get because they’re like, “Oh, I read this other book which is all about functional programming in JavaScript.”</p>\n<p>I’m like, “Yeah, but it’s not what this is about.” It is a functional programming in general book language neutral, but then I needed a language to write code samples in and because I did want it to be in the code seeing refactoring exercises in code.</p>\n<p>I had to choose a language and I chose JavaScript because it like a lingua franca. Even if you’re…Front-end programmers sure, very familiar with it. Even back-end programmers they sometimes have to go in into JavaScript. It’s got a similar enough syntax to Java and C# and C that you could read it if you needed to.</p>\n<p>We don’t go into any super detail about like some weird feature in JavaScript. I tried to write all of the code samples not in pure idiomatic JavaScript. People comment on that all the time. They are like, “That’s not how I would write it.” I’m like, “No, that’s not the point.”</p>\n<p>I’m using a very clear style for that’s like even a Java programmer can understand this JavaScript. As much as possible I’m trying to do that. It’s written for clarity of code. It’s not trying to teach you like, “This is the best way to do functional programming in JavaScript.”</p>\n<p>Matt: How useful do you think functional programming is in sort of a…if you take it right into web development into like a rapid-fire web development agency that is working with a whole bunch of libraries, a whole bunch of different new technologies? They have some older clients that are on older technologies.</p>\n<p>They’re all over the place because they have different servers. They are using Apache and Jinx, the whole bit. They’re all over the place. How useful or not useful do you think functional programming is for people that are using so many different technologies across maybe a team or two?</p>\n<p>Eric: I think that there’s a lot that functional programming can add to help manage the complexity of all of those libraries. That’s not to say that you’re not going to have to like cheat and use some just straight up imperative code somewhere.</p>\n<p>That first idea of identifying, “This is safe to call at any time. I don’t have to worry about side effects of this code. I can call it a hundred times and it won’t matter. I don’t have to set anything up. I don’t have to set up any global variables. This is a safe function to call.”</p>\n<p>Versus this other function, “I have to be very careful when I call it. I have to set up systems of making sure that it doesn’t get called twice, or making sure that it gets called only after this other thing gets called.”</p>\n<p>That first distinction that you make between code that’s safe to run at any time versus code that you have to be careful with. That I think it’s just universally applicable. It doesn’t matter if your agency is using some specific library that’s not functional legacy code. I think that is just something to be aware of all the time.</p>\n<p>Matt: Yeah, that’s a good way to approach starting using functional programming, I think. Another thing is like if you’re working in a small team of people and you can just differentiate those two things like code that is just a calculation isn’t immutable and stuff like that versus the code that will perform changes.</p>\n<p>If you could just differentiate those two things inside of your team, it’ll make communication a lot clearer when they take up your pay, when they take up your code and for all their Git workflow and stuff like that.</p>\n<p>I think even there is a good place to start, if you’re not going to fully delve into a functional programming approach.</p>\n<p>With that being said, I kind of want to point out, one of the things that I do a lot of and I’m one of those people that don’t define which approach I use at this point although that might change when I start working on larger projects with more of a team.</p>\n<p>Right now, what I do is I use a very data first approach to programming where I spend a significant amount of time structuring my JSON responses, structuring my APIs, structuring the data that’s going to be used in the application before I start structuring my functions and my calculations and how I’m going to be using that data essentially.</p>\n<p>How well would this approach work with something like functional programming?</p>\n<p>Eric: Yeah, I think really well. I think that that’s a really great thing to do is spend a lot of time on your data because that’s like the new interface. You have some web endpoints that say send me a Jason like this and I’ll do stuff for you.</p>\n<p>There’s two parts to it. There’s the URL, which is the name of the endpoint. It’s its public name, how you access it. Then there’s the JSON that gets sent to it. That’s public. You can’t change it once it goes out there. You don’t want to break backwards compatibility with any clients that are using it.</p>\n<p>I really think that spending a significant amount of time designing your data, imagining how it’s going to be used, that’ll pay off a lot.</p>\n<p>Matt: Cool. Regardless of the approach, right? It does work with functional programming.</p>\n<p>Eric: Yeah, regardless and with functional programming. The whole third part is about data modeling. We’re in JavaScript, so we’re using arrays and objects basically. How do you use those to model whatever domain you’re trying to model? It’s something that I think was lost in the OO years.</p>\n<p>When everyone was so gung-ho about OO, it was all about making an interface and putting some methods on a class and having a class hierarchy. That was what modeling was. A dog is an animal, and a cat is an animal. [laughs] Things like that.</p>\n<p>Silly exercises that don’t really help you solve the problems of your code, but you would sit there and you’d draw these diagrams, and then deal with all the problems and if statements. I feel like the straightforward data modeling approach of saying, “What data do we need to capture?”</p>\n<p>I didn’t define data. Data, if you look it up in the dictionary, it says it is facts about events. An even being something that happens. Just an informal event. A fact is some piece of information. You have all these events that happen.</p>\n<p>Web requests come in, and the fact is this was the body of the request. That probably represents some other event. The user clicked this button, and it was a buy button. We’re capturing that that was clicked and that they intended to buy.</p>\n<p>That’s all encoded in the data. How do you do that? How do you encode that in the data because this JSON blob is going to leave the browser, be sent across the world to another server, and now it’s going to have to communicate all of that to the server?</p>\n<p>I’m trying to show how profound this is, that somehow you can encode the user’s intention in a string [laughs] basically that then has an effect and sends them a fidget spinner or whatever they buy on their site. That’s amazing that this Jason can do that, but you have to design it well. It has to be well crafted to be able to do that.</p>\n<p>Matt: When you start thinking about it like that, it’s crazy. Bringing it back to functional programming, it’s all asynchronous as well. You don’t know how many times it’s going happen. You don’t know when it’s going to happen.</p>\n<p>Eric: Are there retries?</p>\n<p>Matt: You have to account for that, somehow. [laughs] It’s definitely an interesting paradigm. Technically, we don’t usually think of it in that sense. We usually think of it as, “OK, I need to wait for this to happen and then do something.”</p>\n<p>I don’t know. It’s tough to explain in this kind of context, but it’s cool that we bring it down to earth about how crazy these systems are. With that, I want to do a precursor to what I’m about to ask. I understand that this is bad practice, what I’m going to ask right now.</p>\n<p>I know from experience and from talking to a lot of other developers and programmers that this happens a lot where you want to invest time into doing project planning and design, gathering requirements, doing your UML diagrams. What’s the functional diagram that you were pointing out in the book?</p>\n<p>Eric: A timeline diagram?</p>\n<p>Matt: Timeline diagram, yup. Doing timeline diagrams for projects. A lot of the time, your management or your team will just be like, “Just write the code.” As much as you want to fight back, you don’t really have much of an arsenal to fight back when you’re just starting out as a junior developer.</p>\n<p>What are your one or two points that you would throw back at them for getting the paid time to actually do those diagrams and plan out your code?</p>\n<p>Eric: There’s a t-shirt that I saw recently that says, “Weeks of coding can save you hours of planning.”</p>\n<p>[laughter]</p>\n<p>Matt: I like that. Now I want that t-shirt.</p>\n<p>Eric: I know. I wanted it too. It’s so true. I don’t know how many times I spent so much time coding and then realize, “Oh, if I just sat down and thought about this, I would know that it was a dumb idea.” [sighs]</p>\n<p>I don’t know how to convince someone that thinking is actually work in our line of work, that that is the most valuable thing you can do. I do think that there’s something to be said for prototyping, like let me do some experiments with some code.</p>\n<p>Too often we don’t really have a good, clear statement of what problem we’re trying to solve, so we don’t even know where we’re going to wind up [laughs] if we start solving it. We don’t know what we’re doing. We simply don’t spend enough time thinking about why we’re doing it. Is there a better way to do it? Let me think of a few ways. I don’t know.</p>\n<p>I know the feeling of being rushed and how, “Oh, I could solve that,” and just type it up. I do. I get it out the door and it feels good. It’s the thing that I often later regret. Now, the thing is also, there are a lot of obvious problems where I’ve solved this before. I’ve solved this 100 times. I know the way to solve it. Those come with time.</p>\n<p>Also, in a startup, you often make those tradeoffs like I’d rather have the wrong feature out today, then the right feature out in two weeks. In that perspective, thinking is indistinguishable from procrastination.</p>\n<p>The trouble with recommending that someone thinks more is you’re not giving them a concrete process to go through. You do learn that over time. I do think we need more step-by-step processes to follow in our industry to arrive at solutions.</p>\n<p>Matt: I guess it’d be more presenting it to the management staff. If you’re trying to convince your management, “Hey, I want more time to plan. I want more time to think about this rather than just jump right in,” are there any tools that can easily… ?</p>\n<p>Maybe they be organizational tools like a Trello or something that where you can more easily line out, “This is why I want to think about this,” and hand that to maybe a non-technical staff member, or someone who’s maybe a little less tech-savvy to try to convince them, “Please give me the extra three hours so I can think about this”?</p>\n<p>Eric: I wouldn’t ask for permission.</p>\n<p>Matt: [laughs] Fair enough.</p>\n<p>Eric: It’s not because they’re not going to give it to you and you should just do it anyway. It’s more because as a professional, you have more of an understanding of the process and what needs to be done.</p>\n<p>When you ask for permission like that, often what I find is they say no, but they’re not saying don’t do your job correctly. What they’re saying is, “No, I’m not going to do your job of deciding to do that or not, to think or not.”</p>\n<p>What I would do is if it’s something big, like a bigger project, I would write it up as a proposal. I would shop it around in the team, ask for comments on it, turned it into an artifact that can be shared, write it up in English, and spread it around.</p>\n<p>I’ve often found that when a manager, the non-technical person who’s asking for a feature, let’s say, when they give me the feature, they often think this should be really easy, “I’ve thought a lot about it. It should be easy.” Then ask questions. Show them that it’s not easy. It’s not complete.</p>\n<p>What is the error message when this times out? What happens if they type a long email address that’s more than 20 characters like 10 percent of our users have? How does that get displayed in this tiny box that you’ve drawn on this picture?</p>\n<p>Really push at it because I think that they don’t see the complexity. You’re going to do it. You’re going to do your best to do what they asked for, and it’s going to be wrong according to what their idea was. I really think that asking questions is a good tool. Something that’s maybe more internal, I would shop it around in a written form.</p>\n<p>Matt: Sometimes you have to take charge of your own project and make sure that you do your own job rather than throwing that to management being like, “Can I please…?” [laughs] “May I please do this to do this correctly?”</p>\n<p>Eric: I feel the same about code clean-up, people talking about, “Oh, can we have like a sprint to clean up our code?” No, don’t ask. Just do the cleanup. If they say, “Oh, can we get this feature done?” It’s like, “We’ll put it on the backlog,” just like you would say about anything if you are busy with something else.</p>\n<p>In some sense, it’s not their decision to make of what operations in the code you’re doing are. They shouldn’t have to be managing that part of the situation.</p>\n<p>Matt: That’s a good way to put it. I think that that’s a good way. A lot of employees, these days especially, will be more timid, if you will, especially if they are junior employees or the brand new, they’ll be more timid.</p>\n<p>You just have to make sure you do your job properly. At the end of the day, if you hand whatever it is in and it’s not done correctly, whether it be assignment or an actual production thing that’s not going to be just for school or for learning, it has to be done correctly. You have to do your own due diligence.</p>\n<p>With that being said, I’m going to transition nicely into the next question here, which is, in the first pages of the book, you lay out a scenario where a developer ask a manager if they can use functional programming on an email app, the manager looks up the definition and sees that “avoids side effects,” and that sending an email would be a side effect.</p>\n<p>With that being said, the manager then says that functional programming is too risky to use on the project. If a programmer needed to use a variable, a function, or even recursion on performing part of their duties, they wouldn’t have to ask the manager for each step of the way. They would just implement the solution their way.</p>\n<p>This leads into a couple of questions here. With that being said, what is so different about functional programming that would warrant asking permission? Second one here, is this a situation where the entire team and not just one programmer must adopt functional programming for it to be effective?</p>\n<p>Eric: That’s a really good question. To give some context for that part of the book, my intention — and whether I did a good job with my intention, it’s another matter — is simply to have a little narrative for why there’s a miscommunication with management and that functional programming definition you find on Wikipedia.</p>\n<p>It wasn’t really like this is a common scenario where someone’s asking permission to these functional programming. That said, I do think that in certain companies, they might have a code style guideline. They would have some rule in their style guide that says we use classes not functions. Something like that. I’m just making it up.</p>\n<p>They would have some rule where it’s harder to do functional programming. You are going up against the team. Maybe you need someone higher up to allow that exception to the rule. That’s what I was thinking.</p>\n<p>Does that mean that you need the whole team to buy in? I think they do need to buy in, but I’m going to preface that by saying that, like I was saying before, these are principles that work in any paradigm.</p>\n<p>They’re skills that are used by functional programmers, but it doesn’t mean you have to be like all in on functional programming. They should see the benefit like you should be able to say, “Look, if we just make this a pure function, it would be much easier to test.”</p>\n<p>If you know your team needs to test stuff like, “Oh, yeah, you’re right. That is easier to test.” It should be as clear as that. Buy in, yes, because we work in teams. You can’t just be a renegade and just do whatever you want in the code without regard to the style of the code and how you practice coding on a team.</p>\n<p>You do need buy in, but like I said before, it doesn’t mean like everything has to be functional from now on and you have to go 100 percent on everything.</p>\n<p>Matt: Yeah. That makes some good sense because I would be worried as a junior guy even, if you come in and you’re all about functional programming. That’s what you’ve been learning and then some of the senior guys are just kind of ripping through their own code.</p>\n<p>You’re just like, “Ah, I don’t really want to go and bug all them,” and be like, “Hey guys, let’s change this whole project.” That’s like…</p>\n<p>[crosstalk]</p>\n<p>Eric: Yeah. A monad would be really great right about here.</p>\n<p>[laughter]</p>\n<p>Eric: Just to be clear, there are a lot of, let me call them, advanced functional techniques that we’re not even going to get into in the book. Functional programming is a huge field. We can’t do it all in one book.</p>\n<p>A lot of times they would be very unfamiliar. If you just saw it right in the middle of the code, you’d be like, “What is that thing doing?” I’m not suggesting doing that. I’m suggesting these more fundamental ideas, like the ones we go over in the book or just good ideas in general. They should be easy to convince people of.</p>\n<p>Matt: Next question here then, it’s mentioned that functional programming is more useful in more complicated applications, like in something like a distributed system. Is there any benefit for a beginner programmer in trying to use functional programming in the simple applications that they’re writing or learning on?</p>\n<p>Eric: Is there any benefit? Yes. These are principles and skills that they’re design and architecture ideas that really pay off more at scale. The benefit is there, but it’s very small. If you got a small program, any old style, any old discipline, no discipline is fine. Just get it working.</p>\n<p>As the program grows, you’re going to find that you’re slowing down, it’s turning into a mess, you’re getting lost, like, “What does this do anymore?” You’re starting to get bugs that you can’t identify.</p>\n<p>That’s where disciplines help. There’s object-oriented disciplines that could help, there’s functional programming disciplines that could help. That’s my answer. There’s a benefit, but it’s small.</p>\n<p>Matt: I think we’ve touched on this a bit already as well, but would you say that someone who’s maybe they’ve mastered the stage of program that they’re at, so when they go and approach, so they’re not just learning the syntax.</p>\n<p>They’re at the stage of when they go and approach another problem, and it’s still a simple problem, they’re able to just do it. They’re able to think it up in their head. They know what’s going on, generally.</p>\n<p>Would you say that at that stage, even though it’s simple, would you say that that’s when they should maybe start learning some of these paradigms like functional programming?</p>\n<p>Or, should that still be left to where they’re given a huge project and they’re like, “Wow, I don’t know how to do this now I got to look up these paradigms to sort of organize this big project”? Or, is that too much all at one time?</p>\n<p>Eric: I would say that bringing experience of getting into a mess [laughs] would help. It definitely helps because then you’re like, “I wish I had some skill to get me through this or to avoid it.” I think that it doesn’t take long before an undisciplined approach…</p>\n<p>I’m talking about a few hundred lines of code you start to get lost, and like, “Oh man, that function’s really big. Maybe I need to break it up a little bit, but I don’t know how.” It really starts there. To give advice for someone who’s still struggling to just get something working, don’t worry about a paradigm. Just code.</p>\n<p>When you start to feel like, “Wow, there must be a better way. Is there some discipline that I could have?” That’s when you should start looking into other code styles, paradigms, things like that. Little rules, disciplines that help you make sense of what’s going on.</p>\n<p>There’s a lot going on there. People have come up with quite a lot of good guidance and, I want to call it wisdom, over time of, like the three categories. Actions, calculations, and data. Just identifying those and saying, “Wow, I’ve got quite a lot of code and actions. Maybe I should start removing some of that code.”</p>\n<p>If you’re in an object-oriented approach, and like, “Oh, this would make a really nice…I’ve got a lot of conditionals in here. Maybe I should encapsulate the differences and use polymorphism.” You have the terms that come from the paradigms. They can start helping you solve these problems.</p>\n<p>Mike: I’m just thinking, I want to bring it all together for the audience. This is an impromptu suggestion. You could shoot me down, both of you. What I’m thinking is maybe we should go through an example functional programming, just a quick functional programming example, and maybe do that breakdown that you were just mentioning with the actions, data, and calculations.</p>\n<p>One of the examples that I was thinking of off the top of my head was one that you used in the book, which would be really simple to explain, which is the pizza ordering, the online pizza ordering application. What do you guys think of that right now?</p>\n<p>Matt: Sure.</p>\n<p>Eric: Yeah, sure. Let’s do it.</p>\n<p>Mike: Let’s do it. For that, I’m just going to break down what an online pizza ordering application would do, then we can classify the steps, just quickly. We don’t have to do every single step, obviously, but classify the steps that would be considered actions, would be considered calculations, would be considered data. Which parts of the steps would be considered each?</p>\n<p>A pizza ordering application would take an order from a user. That user could enter his information, and he would order the pizza that he wants, depending on which toppings he wants and stuff like that. He would then place that order, having already sent all the information in.</p>\n<p>Then the process of actually creating the pizza will start happening. You would have many different steps in that process for putting the cheese on, spreading the sauce, putting all the toppings that the user defined. Then putting it in the oven, waiting for it to cook in the oven, taking it out, putting it in a box, putting it in a delivery capsule or whatever, and sending it to that user’s house.</p>\n<p>That’s just a one user example. There’s billing in there and stuff like that, but I’m thinking at the start, the user entering his data. How would we break that down?</p>\n<p>Eric: Let’s say they have a web page that they can enter this stuff on. The web page is loaded and there’s form fields that they’re filling out. All of that entering, the typing, the moussing around, that’s generating events. That’s going on to the event queue, which goes into the event loop. This is all actions.</p>\n<p>However, the little piece of data that’s sitting on the queue, that’s just data. It’s already happened. It’s in the past already. By the time it gets processed, that mouse click is old. It just happens so fast. We don’t think about that, but it’s old. It’s already happened. That’s just some inert data that’s sitting there.</p>\n<p>You might do some validation. That validation on the data in the form before you submit to the server, that could be a pure function. That could be a calculation. It’s just like true, false, is this good? Do they complete the order correctly? It could maybe return a string, the error message or something if it’s not good. That’s certainly a good candidate for a pure function for a calculation.</p>\n<p>Sending it to the server, that’s an action, because it’s having an effect on the world. Presumably, if you didn’t send it, you wouldn’t get the pizza. The zero or one time that it gets sent is important.</p>\n<p>That’s a rule of thumb for an action if it depends on when it’s run or how many times it’s run. When it’s run, it’s often about the order. It’s relative to other things happening. We’ll probably hit more examples of that.</p>\n<p>Then the server receives this request. That’s an action as well, but the request, itself, is data. It’s just some JSON that’s traveling over the wire. Then probably some validation. Again, that could probably be a calculation. This gets sent to the pizza kitchen, I guess is the next step. Is that right? Next step is pizza kitchen?</p>\n<p>Mike: Yup.</p>\n<p>Eric: Pizza kitchen is getting this data, represents the order, one pepperoni pizza. There’s some steps involved. There is a recipe that they’re going to follow. The recipe is data. Maybe there’s two pepperoni pizzas, so they have to multiply all the ingredients by two. That’s a calculation.</p>\n<p>Another rule of thumb that I like to say about calculations is they’re often very hidden because you don’t see them happening. Because they’re not having an effect on the world, you couldn’t see them. It’s like what you’re thinking in your head like, “I’m planning. Oh, two pizzas. I’m going to need twice as much pepperoni.”</p>\n<p>You’re doing all the calculation in your head. It’s not having an effect on the world. Until you actually go get the pepperoni, you’re not having an effect. If you think of calculations as all the hidden planning and thinking that goes on between actions, that’s a good way to think about it.</p>\n<p>Then there’s all the steps of rolling out the dough and putting the toppings on, putting it in the oven. That’s all actions. What was the next step? The oven?</p>\n<p>Mike: The oven.</p>\n<p>Eric: You put it in the oven. You just wait 10 minutes or however long, an action. You don’t want to wait 10 minutes at the wrong time because you’ll burn your pizza. That means it’s an action. Take it out, put it in a box, ship it over to the person.</p>\n<p>Probably, there’s going to be a ticket on the box that has their address, data again. There’s got to be calculations in there. For instance, you’re taking that address and turning it into a GPS location with directions to get there.</p>\n<p>That could probably be a calculation, although it is more complicated because it’s usually a cloud thing. You’re communicating with another server that’s doing that calculation. For the sake of argument, let’s say they don’t have a cloud GPS thing. They’re just getting directions on their Garmin or whatever.</p>\n<p>Mike: Even in a JavaScript sense, it could be a calculation, because when you’re communicating with the cloud, that can be done in a separate calculation function that would always return the same thing every time no matter what with the same input. It still would be a calculation even though it’s communicating with a cloud.</p>\n<p>Eric: I would tend to agree. The only complication is sometimes it could time out.</p>\n<p>Mike: Oh, because it’s not your server.</p>\n<p>Eric: Right. Whenever you communicate across the network, there’s a possibility of having a 500 error or something that you would never get from multiplying two numbers together.</p>\n<p>Mike: Cool.</p>\n<p>Eric: Yes. Other than that, it is cacheable. Like you were saying, it’s going to give the same thing every time. This is getting deep into the functional programming stuff, but because it’s cacheable, what you’re saying is that it doesn’t so much have an effect on the world as it’s bringing in information. It’s going to bring in the same information every time.</p>\n<p>That means zero request is different from one request, but then that second request, I don’t need to do because I cached it. It’s item potent. Item potent means zero or one time makes a difference. Classic example of item potent is the elevator button. You press up to call the elevator. It lights up. If you press it again, it’s not going to have any effect.</p>\n<p>The difference between not pressing and pressing it is important, but that second press, the third press, those don’t matter. It’s the same with calling to the mapping service. The first one matters, but then after that, it doesn’t matter.</p>\n<p>This is the kind of reasoning you can start to do with these concepts of time and whether it matters or not. Then they arrive at the house. They give the guy the pizza. Eating it is definitely an action.</p>\n<p>Mike: [laughs] It’s the best action.</p>\n<p>Eric: Yeah. [laughs]</p>\n<p>Mike: I like this example. I wanted to bring it into play because I just wanted the people out there to understand a little bit about functional programming. Even though it might be a little bit over their head or whatever, but it’s important to know that there is something like this out there, a structure to what they’re doing.</p>\n<p>It’s OK if it’s over their head. They can, A, either get your book and read it or, B, just look at it yourself, go and watch some videos and study it, something you would probably do in a university class. We have some high school people listening to our podcast. It’s important for them to know that this is a future thing that they might be looking at.</p>\n<p>There’s definitely a lot of little side questions. As you were talking about that, I was going to interject and try to get some clarification on little, very intricate things in functional programming which is cool to me.</p>\n<p>Again, I didn’t want to bog down the users, but maybe in the future, if people are interested, let us know. We can have you back on, and we can have a more in-depth functional programming discussion…</p>\n<p>Eric: Yeah, I’d love that.</p>\n<p>Mike: …where we talk about the little intricacies of functional programming…</p>\n<p>Eric: If you have questions, bring them in.</p>\n<p>Mike: …which would be cool for me.</p>\n<p>Matt: Moving on to the question there, it flows nicely because we’re talking about a complex application now. If you’re already in some app development team, or something like that, and you have an existing complex application that was not at all developed with functional programming in mind, is there any way that it can transition to functional programming moving forward?</p>\n<p>Would it be better if you maybe rewrote the whole application under the guideline of functional programming?</p>\n<p>Eric: My big hope is that the book shows that you don’t have to do a big rewrite, that you can get benefits in an incremental way because I can’t recommend that someone rewrites their application.</p>\n<p>Matt: Right. Yeah.</p>\n<p>[laughter]</p>\n<p>Eric: It’s too much work to do all at once. It’s probably going to kill the business to do that. In fact, the chapter I’m working on now is all about immutability and one of the ways to implement immutability is called copy-on-read.</p>\n<p>It’s a discipline that if you call a function, and you get a value out — let’s say it’s on JSON, it’s some object — you instantly, right away, immediately make a deep copy of that. This is your copy because you don’t know what this code that you called is going to do with that object that it gave you.</p>\n<p>It’s one of the things in JavaScript and a lot of other languages where you have these immutable things. It’s not clear if you own the thing, if it’s a newly created thing that only you have, or they’re going to pass the same object to some other code. You just don’t know what’s happening to this object.</p>\n<p>It’s like if someone gives you a message on a piece of paper, or you write down a message to yourself, you put it in your pocket. Then later in the day, you pull it out of your pocket. You don’t expect that it has changed. You expect that it is the same message, that nothing touched it.</p>\n<p>In the computer world, we have this thing where you can share references to the same object, and you can’t expect that it’s the same when you look at it the second time. To mitigate that you do copy-on-read. “I’m going to make my own copy. You can keep that or just let it get garbage collected, or whoever else has a reference can keep it. I’m going to make my own copy.”</p>\n<p>When you do that, that lets you interact with all your legacy code, because they don’t have to be functional. All that code that I’m talking to, it can do whatever it wants. It can mutate as much as it wants. It can change the memory, change the values. I have my copy and I can now treat it as an immutable thing and be functional.</p>\n<p>Yes, it’s a thing. I think about it a lot. How do you slowly, gradually introduce these functional ideas without going whole hog on an existing codebase? It’s really important.</p>\n<p>Matt: I think that’s a really great wrap up to that question because it’s one of those things where a manager or management team would ask. “You want to introduce functional programming now? We’re two years in, we’ve been updating this whatever app for this many years. Now you want to change the paradigm we’re using? What’s that going to mean? How risky is that?”</p>\n<p>Eric: Right. What I hope is, like you were saying, you wouldn’t even have to bring it up to the manager. Let’s say you’re pairing on this code and someone’s like, “Oh, man, they’re passing me these objects, but I know they’re going to reuse this object and change it and pass it to someone else.”</p>\n<p>You just know right away. “Yeah, copy-on-read. That’s how we do it.” And then it’s not a problem anymore. It’s a little local solution to the problem that you’ve got in that code. You don’t have the budget to go rewrite that whole thing, to make sure it doesn’t make changes to that object. No, just a local solution.</p>\n<p>I feel like the functional programming skills I’m teaching in the book should be able to be used that way, like we have this one problem, we’re just going to use it right here.</p>\n<p>Matt: With that being said too, even as early in the book, again, if we take our example and your example combined with the pizza timeline diagram, within a couple of pages of each other from the beginning of the example through the end, there are already variations where the person that owns the pizzeria, whatever she does, she edits what’s going on there.</p>\n<p>That’s an attestment to she didn’t have to tear down her own pizzeria and rebuild the whole thing. She can just go in and be like, “No, no, no, let’s put a dotted line here. Let’s move these around. Let’s take this, take these procedures and make them a different order,” etc., etc., etc.</p>\n<p>That’s an attestment to how functional, [laughs] if you will, functional programming can be in an already thriving production environment.</p>\n<p>Eric: Yeah, I hope so. I hope that people look at them like refactorings. It’s just ways to reorganize little pieces of your code locally. You don’t have to change everything, just like, “Oh, this code is getting messy,” or, “We’re losing control over what it’s doing. Let’s apply a little functional programming to it and make it better.”</p>\n<p>Matt: Awesome. The final question in the segment here is, how much time is spent planning when using functional programming versus nonfunctional programming in your experience?</p>\n<p>Eric: I don’t think that there’s any real difference. I think that planning is important for everything. For all coding, it’s equally important, let’s say, between all paradigms. It’s very important.</p>\n<p>Matt: I think that would be one thing that our users or listeners, especially as beginners, would, if they start thinking in less terms of, “Oh, I have to do this application. I’m just going to start coding it.”</p>\n<p>If they start thinking in these paradigms, that’s one of the questions they’re going to think up, like, “Whoa, I gotta spend a day planning what’s going on here.” In reality when you have a complex application, whether you do object-oriented or whatever, or functional, you do need to do a fair bit of planning ahead of time. that’s important for beginners to acknowledge,</p>\n<p>Eric: Sure. How do I put this? As an experienced programmer, I’ve been programming…I’m 38 years old. I’ve been programming a while. I don’t want to count how many years [laughs] I’ve been programming.</p>\n<p>Matt: [laughs]</p>\n<p>Eric: I sit down and I see code. I can be like, “That’s a code smell.” If we’re looking for a bug, let’s say, I’m like, “We should look there. We should look there. We should look there.” It takes me a minute to see it.</p>\n<p>A junior programmer sitting next to me, it will take me hours to explain why. I’ve done this before where I’m like, “Well, you see, what’s happening here is where let’s trace through the code and you see how this thing is calling this and then it modifies them and something else is modifying it at the same…” You see this instantly.</p>\n<p>What I’m trying to get at is I don’t think any amount of planning can get you to see it faster. Do you know what I mean? You can’t just say I’m going to plan away all the problems.</p>\n<p>Matt: [laughs] Right.</p>\n<p>Eric: As a junior, you’re going to make code that does those things. There’s code I still make problems too. I have a bag of tricks that I can use to plan. What I’m saying is they don’t have the bag of tricks. Maybe planning is not as valuable when you’re starting out.</p>\n<p>Matt: That’s a really good way to put it. As you were explaining it there, the first thing that popped into my mind was I’m from an IT background. One of the first things popped to my mind was when you bring the trainee on board, the beginner, you teach them, “This is how this is how we format hard drives. This is how we install graphics cards. This is how we do whatever.”</p>\n<p>As you get more experience as you go on, when you read a ticket, just reading the ticket, sight and seeing computer is, you haven’t looked at that person’s laptop or their desktop. You’re just like, “It’s probably the hard drive. It’s probably the CD drive.” To them, they’re like, “How would you know that?” Then you have to explain, “Well, it’s doing a ticking.”</p>\n<p>Eric: You smell and hear it. [laughs]</p>\n<p>Matt: Yeah, exactly.</p>\n<p>[laughter]</p>\n<p>Matt: It’s one of those things where it’s almost like a muscle memory you develop with that bag of tricks like you were saying.</p>\n<p>Mike, I know you were mentioning something…We usually do the web news here, but you were mentioning something how we think we’ve cover more or less the questions in here.</p>\n<p>Mike: We’re approaching an hour, 40 at this point. I’m thinking the web news might be a little bit extra. We’ve had a lot of good discussions. I don’t know, Eric, how you’re feeling. If you’re up for the task or not, but I’m feeling like it’s probably already pretty late where you are. I don’t want to put any pressure on you to do any extra talking…</p>\n<p>[crosstalk]</p>\n<p>Eric: If I could step out that would be good.</p>\n<p>Matt: OK, cool.</p>\n<p>Eric: I feel like…</p>\n<p>Matt: Well…Sorry…</p>\n<p>[crosstalk]</p>\n<p>Eric: I feel like I’ve laid down some good stuff.</p>\n<p>Mike: Oh, yeah.</p>\n<p>Matt: We want to thank you again for being on the show. We’d like to invite you at this time to share what you’re up to. We know we were talking about your book, but anything you’re up to. Any links or anything you’d like us to include in the show notes. You have the floor. Please, take it away.</p>\n<p>Eric: I have a podcast if you’re interested in this kind of topic. It’s called “Thoughts on Functional Programming.” It started as me exploring the ideas for the book before I started writing it. It was really just me with my phone driving or walking around. Little moments between driving somewhere to pick up my kid from school. I would just turn on the camera and talk.</p>\n<p>It had very informal style. Now I do a little bit more planning and better audio than you can get in the car, let’s say. It’s at lispcast.com/podcast. I got, man, 140 something episodes now. If you’re interested in this, go check it out.</p>\n<p>If you’re interested in the book, you can go to lispcast.com/gs, for grokking simplicity. That will take you to the page on the Manning site. It’s in early access now. First three chapters are available. Soon to be the fourth. Maybe even by the time this is published, it’ll be out.</p>\n<p>When you do early access, you get the eBook right away, but then you can…If you get the print version, it’ll be delivered to you when it’s done. You can still get the print version with the [inaudible 101:47] . That’s it.</p>\n<p>Matt: Awesome. All right. Thank you very much once again for being on the show. It was a really informational episode. We hope you enjoyed it. Thank you for listening. Make sure you don’t miss an episode by subscribing on the platform of your choice.</p>\n<p>You could follow us on the socials via @htmlallthethings, that’s on Facebook and Instagram. You could follow us on Twitter @htmleverything. We are on Medium and we’re on GitHub. Remember we’re on Patreon. That’s patreon.com/htmlallthethings. Check out the tiers and give that a go.</p>\n<p>Many thanks to our three-dollar-tier patrons. Sean from RabbitWerks JavaScript. You could find him at YouTube.com/rabbitwerksjavascript. Also, Garrick from Local Path Computing &amp; Web Design. You could find him at localpathcomputing.com. Craig aka Cosworth.</p>\n<p>Ryan Gatchel from Blue Black Digital. Find him at blueblackdigital.com. Chris from Self Made Web Designer. You could find him at selfmadewebdesigner.com. And as well Tim from The Web Hacker. You could find him at thewebhacker.com.</p>\n<p>Remember we have that promo code or the discount code, and two full book promo codes. You can get a free book, single use. They do expire as I mentioned in the beginning.</p>\n<p>Make sure you check out the full show notes which are usually posted shortly after, a few hours after the actual episode goes live. They’re published on the HTML All The Things website. That’s htmlallthethings.com.</p>\n<p>[background music]</p>\n<p>Matt: Feel free to leave a comment or a review on the platform that you are listening to this on. We are signing off.</p>\n<p>The post <a rel=\"nofollow\" href=\"https://lispcast.com/grokking-simplicity-html-all-the-things/\">Grokking Simplicity – HTML All The Things [Podcast]</a> appeared first on <a rel=\"nofollow\" href=\"https://lispcast.com\">LispCast</a>.</p>",
   :direction "ltr"},
  :updated 1571036151000,
  :entities
  [{:mentions [{:text "HTML"}],
    :id "nlp/f/entity/wd:8811",
    :salienceLevel "about",
    :label "HyperText Markup Language"}
   {:mentions
    [{:text "functional programming"} {:text "functional language"}],
    :id "nlp/f/entity/wd:193076",
    :salienceLevel "mention",
    :label "functional programming"}
   {:mentions [{:text "JavaScript"}],
    :id "nlp/f/entity/wd:2005",
    :salienceLevel "mention",
    :label "JavaScript"}
   {:mentions [{:text "Maybe"}],
    :id "nlp/f/entity/wd:15936362",
    :salienceLevel "mention",
    :label "Maybe"}
   {:mentions [{:text "table of contents"}],
    :id "nlp/f/entity/wd:1456936",
    :salienceLevel "mention",
    :label "table of contents"}],
  :alternate
  [{:href
    "https://lispcast.com/grokking-simplicity-html-all-the-things/",
    :type "text/html"}],
  :title "Grokking Simplicity – HTML All The Things [Podcast]",
  :author "Eric Normand",
  :published-str "Sun Oct 13 23:55:51 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16dc925ed48:94241b0:69b9f616",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url
   "https://lispcast.com/wp-content/uploads/2018/07/ERIC-NORMAND-LISPCAST.COM_.jpg",
   :width 513,
   :height 557,
   :contentType "image/jpeg"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://lispcast.com/?p=2054",
  :updateCount 1,
  :commonTopics
  [{:score 85.5397779675357,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.971,
    :id "nlp/f/topic/1339",
    :salienceLevel "about",
    :label "lifestyle"}],
  :published 1571036151000,
  :fingerprint "e6555cc1",
  :canonicalUrl
  "https://lispcast.com/grokking-simplicity-html-all-the-things/"}
 {:engagement 5,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1570890889309,
  :recrawled 1570962136869,
  :content
  {:content
   "<p>ClojureScript Macros are a hurdle for most CLJS beginners and wrapping your head around how they work can be quite confusing. I’ll try to cover the basics you need to know to start writing your own macros.</p>\n<p>First of all - ClojureScript macros are written in Clojure and run during the ClojureScript compilation on the JVM. A macro is just a function that takes code (as simple data) and generates other code (again simple data) out of it. The CLJS compiler will then turn the result into JS. This is done in Clojure so that the generated JS does not need a full ClojureScript compiler at runtime.</p>\n<p>Self-hosted CLJS is capable of compiling CLJS at runtime and does support macros but requires at least 2MB of JS so it isn’t practical for most build targets. This post will not cover anything self-host related, as that is a topic for advanced users.</p>\n<h2>Step By Step</h2>\n<ol>\n<li>\n<p>Create a CLJ namespace, eg. <code>my.util</code> in <code>src/main/my/util.clj</code> (assuming <code>src/main</code> is one of the <code>:source-paths</code>). Note that this is a <code>.clj</code> file to create a Clojure namespace, not ClojureScript. Define the <code>foo</code> macro as you’d normally do in Clojure.</p>\n<pre><code> (ns my.util)\n\n (defmacro foo [&amp; body]\n   ...)\n</code></pre>\n</li>\n<li>\n<p>Create a CLJS namespace of the same name, so <code>src/main/my/util.cljs</code> and add a <code>:require-macros</code> for itself in the <code>ns</code> form.</p>\n<pre><code> (ns my.util\n   (:require-macros [my.util]))\n</code></pre>\n</li>\n<li>\n<p>Use it.</p>\n<pre><code> (ns my.app\n   (:require [my.util :as util]))\n\n (util/foo 1 2 3)\n ;; :refer (foo) and (foo 1 2 3) would also work\n</code></pre>\n</li>\n</ol>\n<p>Done.</p>\n<h2>Steps Explained</h2>\n<p>To explain why we do those steps we best go in reverse.</p>\n<ul>\n<li>\n<p>When the CLJS compiler processes the <code>(util/foo 1 2 3)</code> call it expands the <code>util</code> alias to its fully qualified <code>(my.util/foo 1 2 3)</code> form</p>\n</li>\n<li>\n<p>The compiler looks up <code>my.util/foo</code>. Typically the compiler would only look for that var in the ClojureScript environment (so what was defined in the <code>.cljs</code> files). The <code>my.util</code> namespace however had the <code>:require-macros</code> for itself which tells the compiler to also look for macros of the same name</p>\n</li>\n<li>\n<p>The <code>my.util/foo</code> CLJ macro is found and the compiler will expand the form using that macro</p>\n</li>\n<li>\n<p>The CLJS compiler continues with the expanded form</p>\n</li>\n</ul>\n<h2>The Old Way</h2>\n<p>Before <a href=\"https://clojure.atlassian.net/projects/CLJS/issues/CLJS-948\">CLJS-948</a> macros required a bit more ceremony. Thus you still see these patterns in older code. Nowadays all macros should be written as described above.</p>\n<p>In the above example we are using the macro self-require directive (ie. <code>:require-macros</code>) to inform the CLJS compiler about macros that supplement a given CLJS namespace. This requires that there actually is a matching CLJS namespace, but in the past the self-require trick didn’t exist so macros sort of existed on their own.</p>\n<p>It was common to create dedicated <code>.macros</code> namespaces (eg. as seen in <code>cljs.core.async.macros</code>). <code>core.async</code> provides a <code>go</code> macro should you can nowadays access in two ways.</p>\n<p>The old way</p>\n<pre><code>(ns my.app\n  (:require-macros [cljs.core.async.macros :refer (go)])\n  (:require [cljs.core.async :as async :refer (chan)]))\n\n(go :foo)\n</code></pre>\n<p>or the modern way</p>\n<pre><code>(ns my.app\n  (:require [cljs.core.async :as async :refer (chan go)]))\n\n(go :foo)\n</code></pre>\n<p>The problem with the old way was that the consumer of a library had to have special knowledge about macros and how to consume them. In the example above the user had to know that <code>chan</code> was a regular var and that <code>go</code> was a macro. In the modern way the compiler can figure this out on its own and all it took was a matching namespace with the <code>:require-macros</code> self-require trick. If a regular CLJS “var” has a <code>defmacro</code> of the same name in CLJ it will expand the macro first if applicable.</p>\n<h2>Macro Limitations</h2>\n<p>Macros can pretty much do everything that regular CLJ macros can do but since you are basically dealing with 2 separate versions of the same namespace there are some things to watch out for.</p>\n<h3>Gotcha #1: Namespace Aliases and Dependencies</h3>\n<p>Since the macros run in CLJ and not CLJS the namespace aliases you configured in CLJS will not work in the macro. It is recommended to use fully qualified names if you need to access code from other namespaces. Defining the <code>:require</code> in CLJS ensures that the <code>clojure.string</code> code will actually be available at runtime. If only the CLJ variant had that <code>:require</code> the CLJS compiler might not provide that namespace.</p>\n<pre><code>;; CLJS\n(ns my.app\n  (:require [my.util :refer (foo)]))\n\n(foo :hello &quot;world&quot;)\n\n;; CLJS \n(ns my.util\n  (:require-macros [my.util])\n  (:require [clojure.string :as str]))\n\n;; CLJ\n(ns my.util)\n\n;; this would fail since the CLJ namespace doesn't know about the str alias\n(defmacro foo [key value]\n  `{:key ~key\n    :value (str/upper-case ~value)})\n\n;; so instead use the fully qualified name\n(defmacro foo [key value]\n  `{:key ~key\n    :value (clojure.string/upper-case ~value)})\n</code></pre>\n<p>There may be cases where there are actually matching CLJ namespace that you could require in the CLJ variant but if you want to be safe just use the fully qualified name.</p>\n<h3>Gotcha #2: Caching and :parallel-build</h3>\n<p>The ClojureScript compiler might be caching the result of the compilation so you should try to avoid side-effects in macros at all cost. The compiler might also be using multiple threads for compilation so if you use side-effects that rely on specific ordering things might get messy.</p>\n<p>If you cannot avoid side-effects make sure to turn off caching and probably <code>:parallel-build</code>.</p>\n<h3>Gotcha #3: Macro-Support code</h3>\n<p>The CLJ “macro” namespace is just a regular Clojure namespace. You can use all the code you want in it during macro expansion but if your macro expands to code that needs to be called at runtime that code must be defined in the CLJS variant instead.</p>\n<pre><code>;; CLJS\n(ns my.util\n  (:require-macros [my.util])\n  (:require [clojure.string :as str]))\n\n(defn my-helper [m] ...)\n\n;; CLJ\n(ns my.util)\n\n(defmacro foo [key value]\n  `(my-helper {:key ~key\n               :value (clojure.string/upper-case value)}))\n</code></pre>\n<p>This will expand to <code>(my.util/my-helper ...)</code> which the CLJS compiler will find properly. CLJS code cannot access a <code>defn</code> defined in the CLJ namespace so make sure everything is where it needs to be. You can use a fully qualified symbol for <code>my-helper</code> but the syntax quote (ie. the <code>`</code> backtick) automatically applies the current namespace (ie. <code>my.util</code>) to all unqualified symbols so it can be omitted here.</p>\n<h3>Gotcha #4: CLJ Macros</h3>\n<p>So far this post assumed that the macro only had to generate CLJS code and didn’t need to work in regular CLJ code. Some libraries however will want to work on both platforms so they need a way to detect whether they are supposed to expand to CLJS code or CLJ code. This can be done by inspecting the special <code>&amp;env</code> variable during macro expansion. Note that you cannot do this with reader conditionals when using <code>.cljc</code> files.</p>\n<pre><code>(ns my.util)\n\n(defmacro foo [key value]\n  (if (:ns &amp;env) ;; :ns only exists in CLJS\n   `(cljs-variant ...)\n   `(clj-variant ...))\n</code></pre>\n<h3>Gotcha #5: CLJC</h3>\n<p>CLJC can be difficult to get right since you are defining two completely independent namespaces (CLJ+CLJS) at the same time in one file.</p>\n<p><em>I strongly recommend writing your macros in 2 separate files until you feel comfortable with that. I still do it for 100% of my macros.</em></p>\n<p>A lot of the macros in the wild out there written in CLJC do it wrong in some way. Most of the time this isn’t a big problem since the Closure Compiler gets rid of the code that “leaked” in the CLJS side of things. Nevertheless if you must use CLJC files you should make sure that all CLJ related code is properly behind <code>#?(:clj ...)</code> conditionals.</p>\n<pre><code>(ns my.util\n  #?(:cljs (:require-macros [my.util])))\n\n(defn my-helper [m] ...)\n\n(defn macro-helper [k v] ...)\n\n(defmacro foo [key value]\n  `(my-helper ~(macro-helper key value))\n</code></pre>\n<p>It is somewhat easy to overlook that in this example <code>macro-helper</code> is actually called during macro expansion and not at runtime. The <code>macro-helper</code> defn however was not behind a reader conditional so it will be compiled as part of the CLJS variant and actually exist as a regular function at runtime. That doesn’t necessarily hurt anyone but depending on how much code is “leaked” that way may make compilation slower or may lead to actual additional bytes in a release build if the Closure Compiler was not able to eliminate all of it (eg. if you used <code>defmethod</code> for CLJ multi-method).</p>\n<h2>Summary</h2>\n<ul>\n<li>ClojureScript macros are written in Clojure and run on the JVM</li>\n<li>Define macros by creating a CLJ and CLJS namespace of the same name, where the CLJS variant has a <code>:require-macros</code> directive in its <code>ns</code></li>\n<li>CLJC is harder to get right, avoid it if you can</li>\n<li>Writing and using macros isn’t all that difficult ;)</li>\n</ul>",
   :direction "ltr"},
  :updated 1570874400000,
  :entities
  [{:mentions [{:text "CLJ"}],
    :id "nlp/f/entity/wd:1068685",
    :salienceLevel "mention",
    :label "Cluj International Airport"}
   {:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "JVM"}],
    :id "nlp/f/entity/wd:193321",
    :salienceLevel "mention",
    :label "Java Virtual Machine"}
   {:mentions [{:text "Aliases"}],
    :id "nlp/f/entity/wd:16949888",
    :salienceLevel "mention",
    :label "Micro needling"}],
  :alternate
  [{:href
    "https://code.thheller.com/blog/shadow-cljs/2019/10/12/clojurescript-macros.html",
    :type "text/html"}],
  :title "ClojureScript Macros",
  :author "Thomas Heller",
  :published-str "Sat Oct 12 03:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16dc064b85d:8731227:ad5391a1",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://code.thheller.com/blog/shadow-cljs/2019/10/12/clojurescript-macros",
  :updateCount 2,
  :commonTopics
  [{:score 55.513684439598286,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1570874400000,
  :fingerprint "680fcb82",
  :canonicalUrl
  "https://code.thheller.com/blog/shadow-cljs/2019/10/12/clojurescript-macros.html"}
 {:engagement 121,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1570876420195,
  :recrawled 1571137301940,
  :content
  {:content
   "<figure class=\"wp-block-image\"><img alt=\"\" src=\"https://itrevolution.com/wp-content/uploads/2019/10/love-letter-to-clojure-part-1-gene-kim-1024x538.png\" class=\"wp-image-6931\"></figure>\n<p>In this blog post, I will explain how learning the Clojure programming language three years ago changed my life. It led to a series of revelations about all the invisible structures that are required to enable developers to be productive. These concepts show up all over <a href=\"https://itrevolution.com/the-unicorn-project/\"><em>The Unicorn Project</em></a>, but most prominently in the First Ideal of Locality and Simplicity, and how it can lead to the Second Ideal of Focus, Flow, and Joy. </p>\n<p>Without doubt, Clojure was one of the most difficult things I’ve learned professionally, but it has also been one of the most rewarding. It brought the joy of programming back into my life. For the first time in my career, as I’m nearing fifty years old, I’m finally able to write programs that do what I want them to do, and am able to build upon them for years without them collapsing like a house of cards, as has been my normal experience.</p>\n<p>The famous French philosopher Claude Lévi-Strauss would say of certain tools, “Is it good to think with?” For reasons that I will try to explain in this post, Clojure embraces a set of design principles and sensibilities that were new to me: functional programming, immutability, an astonishingly strong sense of conservative minimalism (e.g., hardly any breaking changes in ten years!), and much more… </p>\n<p>Clojure introduced to me a far better set of tools to think with and to also build with. It’s also led to a set of aha moments that explain why for decades my code would eventually fall apart, becoming more and more difficult to change, as if collapsing under its own weight. Learning Clojure taught me how to prevent myself from constantly self-sabotaging my code in this way.</p>\n<p>For nearly three years, I’ve been gushing to whoever will listen about how great Clojure is. I was dazzled by Bryan Cantrell’s amazing <a href=\"https://twitter.com/bcantrill/status/1042180114199375872\">“I’m falling in love with Rust” blog post in September 2018</a>—after reading it, I committed myself to eventually write my love letter to Clojure (but only after I first wrote a love letter to my wife, <a href=\"https://twitter.com/notoriousmvk?lang=en\">@notoriousMVK</a>, of course!).</p>\n<p>Organizing, writing, and finishing this post has been surprisingly difficult. I’ve wanted to write this article for years, having written portions of it over the last twelve months, trying to figure out how to share my experience and epiphanies without being insipid, pretentious, or boring. But after three days of constant writing and second-guessing myself, and now exceeding 8,500 words, in the interest of <em>finally</em> getting something posted, I’m committed to post this today. </p>\n<p>The stuff that doesn’t make it in will go into “My Love Letter to Clojure #2”. <img alt=\"🙂\" src=\"https://s.w.org/images/core/emoji/12.0.0-1/72x72/1f642.png\" class=\"wp-smiley\"></p>\n<p>I will discuss the following:</p>\n<ul><li><a href=\"https://itrevolution.com/devops-blog/feed/#what-the-second-ideal-of-focus-flow-and-joy-means-to-me\">What the Second Ideal of Focus, Flow and Joy Means to Me</a></li><li><a href=\"https://itrevolution.com/devops-blog/feed/#relearning-coding\">Relearning Coding: How Coding Mostly Left My Daily Life in 2008, But Came Back in 2016 (or If I Can Learn Clojure, Anyone Can)</a></li><li><a href=\"https://itrevolution.com/devops-blog/feed/#why-i-love-lisps-now\">Why I Love LISPs Now</a></li><li><a href=\"https://itrevolution.com/devops-blog/feed/#functional-programming-and-Immutability\">Functional Programming and Immutability (and John Carmack)</a></li><li><a href=\"https://itrevolution.com/devops-blog/feed/#a-mistake-ive-been-making-since-grad-school-and-how-i-fixed-it\">A Mistake I’ve Been Making Since Grad School, and How I Fixed It: Composability</a></li><li><a href=\"https://itrevolution.com/devops-blog/feed/#the-epiphany-i-had-reading\">The Epiphany I Had Reading “An Introduction to React in 2019 (For People Who Know Just Enough jQuery To Get By)”</a></li><li><a href=\"https://itrevolution.com/devops-blog/feed/#what-rich-hickey-says-about-simplicity\">What Rich Hickey Says About Simplicity: Where The First Ideal Of Locality and Simplicity Comes From</a></li><li><a href=\"https://itrevolution.com/devops-blog/feed/#solving-business-problems-not-solving-puzzles\">Solving Business Problems, Not Solving Puzzles—Why I Detest Doing Infrastructure Work These Days</a></li><li><a href=\"https://itrevolution.com/devops-blog/feed/#the-repl\">Lastly, the REPL…the Ultimate in Fast and Fun Feedback Loops!</a></li><li><a href=\"https://itrevolution.com/devops-blog/feed/#the-amazing-clojure-community\">The Amazing Clojure Community, Parting Thoughts, and What I’d Like To Write About in the Future</a><br></li></ul>\n<p>What hopefully comes across is my gratitude to Clojure, its inventor Rich Hickey, and the entire Clojure community.</p>\n<p></p>\n<h2>What the Second Ideal of Focus, Flow and Joy Means to Me</h2>\n<ul><li>The First Ideal—Locality and Simplicity </li><li>The Second Ideal—Focus, Flow, and Joy</li><li>The Third Ideal—Improvement of Daily Work</li><li>The Fourth Ideal—Psychological Safety</li><li>The Fifth Ideal—Customer Focus <br></li></ul>\n<p>In <em>The Unicorn Project</em> (<a rel=\"noreferrer noopener\" href=\"https://itrevolution.com/the-unicorn-project/\" target=\"_blank\">download the excerpts</a>), the Second Ideal of Focus, Flow, and Joy is intended to describe the optimal mental state of creative flow that we all seek, so beautifully described by the famous psychologist Dr. Mihaly Csikszentmihalyi (pronounced cheek-sent-MEE-hai). He gave one of the most <a href=\"https://www.ted.com/talks/mihaly_csikszentmihalyi_on_flow?language=en\">amazing TED talks ever (2004)</a>, and wrote the book <a href=\"https://www.amazon.com/Flow-Psychology-Experience-Perennial-Classics/dp/0061339202\">Flow: The Psychology of Optimal Experience (2008).</a><sup><a href=\"https://itrevolution.com/devops-blog/feed/#fn1\">1</a></sup></p>\n<p>For many of us in technology, we often associate those amazing moments of productivity and creative flow with coding. It’s the feeling that you get when you are getting so much productive work done: you lose track of time, and maybe even your sense of self, feeling the triumph of achieving amazing feats, brilliantly solving the problem you set out to solve. For me, it often felt like conquering the Level 30 quest when you’re only a Level 5 Paladin. (Insert your D&amp;D character of choice here.)</p>\n<p>For most of the twenty years of my professional career, I have self-identified primarily as an Ops person. This is despite getting my masters degree in computer science in 1995—the courses I loved the most were high-speed compilers (main lesson: don’t read files more than once) and high-speed networking (main lesson: avoid making memory copies entirely, if you can).</p>\n<p>But as much as I loved computer science, I always gravitated toward Ops, because I observed that that’s where the excitement was, and that’s where the saves were made—it if weren’t for the heroic work of Ops, all the mistakes and failures of Dev and Infosec would affect our customers.</p>\n<p>But something changed. For three years, I now self-identify as a developer! Without a doubt, it’s because I learned the Clojure programming language. I mentioned above that it was one of the most difficult things I’ve learned professionally—before I wrote my first line of working code, I must have spent forty hours reading books and blog posts, as well as watching videos, before I was able to write my first real non-trivial program.</p>\n<p>A big reason is that it’s a LISP programming language, which I had never used before. Another reason is that Clojure is a functional programming language that embraces and encourages immutability, which means that you’re not allowed to mutate variables, which is another thing I’ve never been exposed to before. </p>\n<p>I’m incredibly grateful for the help I got from <a href=\"https://twitter.com/mtnygard\">Mike Nygard</a> (author of the amazing book <a href=\"https://www.amazon.com/Release-Production-Ready-Software-Pragmatic-Programmers/dp/0978739213\">Release It!,</a> and incidentally, the person who first showed me Clojure and the Datomic database in 2012, which baffled me so much, I mostly forgot about it until five years later) and so many other people in the Clojure community. (More on the incredible community around Clojure later.)</p>\n<p>Now, solving problems with Clojure has become one of my favorite things to do.</p>\n<p>Coding in Clojure is fun, in a way that I’ve never experienced before. For years, in my ideal month, I spend 50% of my time writing and 50% of my time hanging out with the best in the game. These days, that’s still the case, but I want to be spending 20% of my time coding to solve problems I want to solve as well. </p>\n<p>Here’s how much fun I’m having: over the last three years, I’ve been able to quickly solve problems, such as quickly exporting and transforming data from one tool to another, building word clouds, analyzing git repo histories…. But I’ve built some tools that I use nearly every day, such as a program to manage cards on my Trello boards, grab screenshots from Google Photos, track information from various book e-commerce sites. It’s blown me away how I can solve problems with a level of ease and joy I’ve never experienced before.</p>\n<p>My first significant Clojure project revealed something stunning to me. I’m fortunate to have participated in helping write and rewrite an application called <a href=\"https://tweetscriber.com/\">TweetScriber</a> three times. It’s a program that a bunch of us wrote in 2012 to allow us to take notes and tweet at the same time on an iPad—it turns out that this is a very useful thing to do when you’re writing a book, as it forces you to take notes, write things succinctly enough so that you can tweet it out (which forces a certain pithy and terse style), and get feedback by observing what tweets get people’s attention. (The tweets that got the most retweets inevitably found their way into a presentation or a book.)</p>\n<ul><li>In 2012, Flynn and Raechel Little wrote the first version as an iPad app in Objctive-C—it was about 3,000 lines of code. (They did such an awesome job!! It worked splendidly until iOS 7 or so, when something broke terribly and it wouldn’t even start up anymore.)</li><li>In 2015, I rewrote it as a JavaScript/React application, and it was about 1,500 lines of code. </li><li>In 2017, I rewrote it again as a ClojureScript application, and it was only 500 lines of code! Holy cow!!!<br></li></ul>\n<p>First off, I was actually amazed that I could even rewrite this application in ClojureScript as a novice, and how surprisingly straightforward it was. (Clojure runs on the JVM or on the CLR for all you .NET people, while ClojureScript gets transpiled into JavaScript so it can run on the browser, inside node.js, etc. In all cases, they can leverage the massive library and tooling ecosystem that these universes provide.) But what was so remarkable to me was how superior my ClojureScript implementation was, in so many dimensions.</p>\n<p>It was shorter. It forced a separation of concerns between mutable state, control flow logic, UI elements, etc. that I’ve long read about, but finally was able to put into practice. (I used the <a href=\"https://github.com/Day8/re-frame\">re-frame</a> framework, which co-evolved at the same time as the JavaScript Redux framework.)</p>\n<p>What has been the most astonishing to me is that I’ve been able to keep adding functionality to TweetScriber, year after year. Right before the last DevOps Enterprise Summit, I added a way to add photos to tweets without leaving the app; I experimented with saving the tweet ids in a database instead of just text. It was easy to experiment with adding these features without blowing everything else up.</p>\n<p>It’s now nearly 5,000 lines of code, and I’m still able to understand it, and add things I want to it without it falling over like a house of cards.</p>\n<p>The ability to do this is new to me. There’s something very different about the way I code now, and I attribute it to Clojure and what it’s taught me. I will make the maybe astonishing claim that 90% of the errors I used to make have simply disappeared—as in, an entire category of errors I used to make have been eliminated. </p>\n<p>(I intend to open source the TweetScriber application, along with three other apps I’ve written. Just as soon as I figure out how to take all the secrets out of my GitHub repo. If anyone wants to help, let me know. I’ll take any help I can get. :). </p>\n<p>You can run TweetScriber, albeit with non-existent documentation <a href=\"https://tweetscriber-app.herokuapp.com\">here</a>. You can read all the notes I’ve posted <a href=\"http://scribes.tweetscriber.com/\">here</a>. (OMG, I’m thrilled that someone else is using the program!) You can read all saved scribed that people have posted over the years <a href=\"http://scribes.tweetscriber.com/\">here</a> (that portion was written by awesome <a href=\"https://github.com/jeffweiss\">Jeff Weiss</a> and <a href=\"https://itrevolution.com/devops-blog/feed/twitter.com/hertling\">William Hertling</a>).</p>\n<p>In short, Clojure brought the joy of programming back into my life! </p>\n<p></p>\n<h2>Relearning Coding: How Coding Mostly Left My Daily Life in 2008, But Came Back in 2016</h2>\n<p>If I can learn Clojure, anyone can.</p>\n<p>Before I got into my specific aha moments, I thought it would be worthwhile to describe to what extent coding stopped being part of my daily life. I’m going to make the case that me learning Clojure is sort of like Encino Man learning to drive—you know, the movie about the caveman who was frozen in ice and wakes up in the completely changed, modern world. </p>\n<p>I think this is relevant to many people in technology—I’ve observed that many people in the technology field started their careers coding, but then as their career progressed, they started coding less—sometimes it’s to go into people management, project management, information security, or product management, or into the business functions.</p>\n<p>But I believe now more than ever that coding is a proficiency that will be needed in every profession, regardless of what specific domain you specialize in or what role you have within an organization. As the brilliant Mark Schwartz (former CIO of US Citizenship and Immigration Services and author of many amazing books, including <a href=\"https://www.amazon.com/dp/B075TD7JJ3/\">Seat at the Table: IT Leadership in the Age of Agility</a>) stated in an address to the government system integrator community, “we need technical people, because last I heard, this is still a technical field.” </p>\n<p>(I mean, OMG, right? The response to any remark that “I’m not technical” seems more and more jarring to me. Maybe I’ll write more on that at at later date.)</p>\n<p>Here are some concrete statistics on what happened to me, mostly to motivate my claim that I had become “non-technical” for almost a decade. Here’s a chart that shows my programming background, showing year by year how many lines of code I wrote (it’s a wild guess).</p>\n<div class=\"wp-block-image\"><figure><img alt=\"\" src=\"https://itrevolution.com/wp-content/uploads/2019/10/DraggedImage-1-13.png\" class=\"wp-image-6920\"></figure></div>\n<p>I created this graph after Dr. Mik Kersten mentioned to me that he’s written over one million lines of Java in his career, and Rod Johnson (inventor of Spring) said that he’s written millions of lines of Java. Until then, I had never thought about how many lines of code I’ve written in my career…</p>\n<p>What I discovered was pretty surprising…</p>\n<ul><li>Perl: thousands of LoC</li><li>C/C++: hundreds of thousands of LoC</li><li>Ruby: tens of thousands of LoC</li><li>Java: hundreds of LoC<br></li></ul>\n<p>What really caught my attention: I had only written “hundreds of lines of Java” — in fact, I had written tons more Perl than Java! In contrast, most of my generation had likely written 10K, 100K, or even millions of lines of Java! I had somehow gotten stuck in the C and C++ cul-de-sac, and due to a fluke of timing, I missed the entire Java revolution, which was undeniably the center of gravity for both industry and academic research—multiple generations of PhDs were created around almost every aspect of Java and the JVM.</p>\n<p>Maybe amusingly, at the time, I was happy to sit on the Java sidelines, because…stupid reasons…. When I got my undergraduate degree in computer science (1990–1993), the predominant pedagogic language was C. By the time I went to graduate school (1993–1995), C++ was just coming out, and it seemed laughable at the time. One of my professors, the famous Dr. Todd Proebsting, joked, “How do you know if a program was written in C++? It takes 10 seconds for the program to exit()!” (The long delay before the program actually quit was from all the class destructors being called.)</p>\n<p>Around 1995, Java was just starting to be talked about—and we mostly laughed at that, too, because of the absurdly long startup times of the JVM. At that time, Perl and Tcl were dismissed as mere “scripting languages,” not suitable for real programmers.</p>\n<p>By the time the Java revolution was in full swing in the early 2000s, coding had virtually vanished from my daily life, and it wasn’t until the late 2000s that I got back into doing substantial hobby coding projects. (Around then, I had great fun trying to compete in the Netflix recommendation challenge with William Hertling, which we did in Ruby.)</p>\n<p>In contrast, Java revolutionized programming, and a whole ecosystem flourished around it, such as Maven (Maven is to Java as npm is to JavaScript, ruby gems is to Ruby, pip is to Python, etc.), the JVM, Eclipse, etc…</p>\n<div class=\"wp-block-image\"><figure><img alt=\"\" src=\"https://itrevolution.com/wp-content/uploads/2019/10/DraggedImage-2-10.png\" class=\"wp-image-6917\"></figure></div>\n<p>I somehow not only missed out on the Java revolution, but I never got exposed to LISP programming (or even Emacs), which made my entry into Clojure much more difficult.</p>\n<p>And yet, now I love the JVM, which Clojure runs on. And I love LISP, which Clojure is a dialect of.</p>\n<p>Again, if I can do it, anyone can!</p>\n<h2>Why I love LISPs Now</h2>\n<p>Let’s talk about Clojure being a LISP first. As noted in the chart above, LISP is a very ancient language, dating back to 1958. And it’s very distinctive. Even before I went to college, I knew that people made fun of LISP, joking that it stood for “lots of stupid parentheses.”</p>\n<p>But I’m never going back. Like almost everything about Clojure, as a LISP, its syntax is astonishingly simple. Everything is inside parentheses, the verb is always at the front and arguments are next.</p>\n<p>Yes, almost everyone who hasn’t used a LISP initially finds it alien—my first reaction was, “holy cow, this doesn’t even look like code.” But it’s actually a far more uniform and simpler syntax. </p>\n<p>Contrast LISP to the complicated order of precedence operations you find in almost every other programming language, as well as their huge grammars and syntax. That takes a lot of brain space.</p>\n<p>I was talking to a JavaScript programming lead at a bar (yes, this is what I love talking about in bars), and he asked what a Clojure program would look like that would parse an integer in a JSON file, and increment that integer by two. Here’s what it looks like—I think it’s quite beautiful:</p>\n<pre class=\"wp-block-code\"><code>; input is JSON string: &quot;{foo: 2}&quot;\n\n(defn xform [s]\n  (-> (js/JSON.parse s)\n      js->clj\n      (update &quot;foo&quot; + 2)\n      clj->js\n      js/JSON.stringify))\n</code></pre>\n<p>Here’s a slightly more annotated version that describes more fully what is going on:</p>\n<pre class=\"wp-block-code\"><code>(defn xform-annotated [s]\n  ; I love the -> function called threading\n  ; it basically chains the functions together -- composition\n  ; of functions, passing results of previous function as first argument\n  (-> \n    ; calls out to node.js\n\t; note that first is name of function, and &quot;s&quot; is argument\n    (js/JSON.parse s)\n    ; convert it from native JS object to Clojure map\n    (js->clj)\n    ; update key &quot;foo&quot; by applying function (fn (+ 2))\n    ;     note that no mutation happens -- it returns a new map\n    (update &quot;foo&quot; + 2)\n    ; convert back to native JSON object\n    (clj->js)\n    ; call out to node function to convert back into string\n    (js/JSON.stringify)))\n\n</code></pre>\n<p>A wonderful (and free primer) on LISP syntax is here: <a href=\"https://www.braveclojure.com/do-things/\">https://www.braveclojure.com/do-things/</a>—this is just one portion of Daniel Higgenbottom’s fantastic book <a href=\"https://www.amazon.com/Clojure-Brave-True-Ultimate-Programmer/dp/1593275919\">Clojure for the Brave and True: Learn the Ultimate Language and Become a Better Programmer</a>. (More book recommendations later.)</p>\n<p>To end this section, like I said, I’m never going back to a non-LISP. Life is too short to learn fussy language grammars with tons of special cases. But I’ve become fussy in other ways, too. (More on that later.)</p>\n<p></p>\n<h2>Functional Programming and Immutability (and John Carmack)</h2>\n<p>Another thing that initially flummoxed me about Clojure was the notion of immutability. After all, how are you supposed to write a program when you’re no longer allowed to change the value of variable?</p>\n<p>Over the years, I’ve read many articles about functional program extolling the value of pure functions and immutability—these are two of the characteristics often associated with functional programming languages, such as Haskell, OCaml, Erlang, Elm, Elixir, Scala, PureScript, F#, and of course, Clojure. </p>\n<p>Some of the promised benefits include programs that are easier to reason about, the ability to trivially parallelize them, and so forth. One of the first books I read to learn Clojure was <a href=\"https://www.amazon.com/Clojure-Programming-Practical-Lisp-World/dp/1449394701\">Clojure Programming: Practical LISP For The Java World</a>—a book I highly recommend, because it is targeted at programmers who are used to Python, Ruby, and Java.</p>\n<p>I was still struggling to get my head around core principles and its idioms. And then I read a code sample, with the following warning: “In Ruby, even strings, often faithfully immutable in other languages, are mutable. This can be the source of all sorts of trouble.”</p>\n<p>When I read the following code sample, I literally bolted upright in bed, panicked by what I just read:</p>\n<pre class=\"wp-block-code\"><code># Ruby code \ns1 = &quot;hello&quot;\ns2 = &quot;world&quot;\n\ns3 = s1 + s2\t# s1 is still &quot;hello&quot;\ns4 = s1 &lt;&lt; s2 \t# s1 is now &quot;hello world&quot; \n\t\t\t\t#    !!!! Mutation of s1 is side-effect!\n\n>> s = &quot;hello&quot; \n=> &quot;hello&quot; \n>> s &lt;&lt; &quot;*&quot; \n=> &quot;hello*&quot; \t# s value was mutated!!!!\n>> s == &quot;hello&quot; \n=> false\n😱😱😱\n</code></pre>\n<p>When I say that I “bolted upright in bed,” I mean it quite literally. I was actually panicked from the terror that I felt, wondering how many times I might have accidentally written code that changed a variable I didn’t mean to change. In fact, you can see this tweet I wrote the next morning in that state of existential horror. That was when I realized that mutation was more dangerous than I had thought. </p>\n<blockquote class=\"twitter-tweet\">\n<p dir=\"ltr\" lang=\"en\">I love Ruby. Last night, while reading, I learned I didn’t understand something very fundamental about Ruby strings: shame on me! <a href=\"https://t.co/Mk26jH1z35\">pic.twitter.com/Mk26jH1z35</a></p>\n<p>— Gene Kim (@RealGeneKim) <a href=\"https://twitter.com/RealGeneKim/status/788408398245040129?ref_src=twsrc%5Etfw\">October 18, 2016</a></p>\n</blockquote>\n<p> </p>\n<p>(Incidentally, people have reported similar feelings of sheer terror after reading Brian Goetz’s book <a href=\"https://www.amazon.com/Java-Concurrency-Practice-Brian-Goetz/dp/0321349601\">Java Concurrency In Practice,</a> realizing all the things that can go wrong in concurrent programming in code they had written, often leading one to embrace languages like Clojure. More on Brian Goetz later.)</p>\n<p>Over the next year, it genuinely dawned on me how disallowing variable mutation made programs simpler and easier to reason about, even for single-threaded programs. It made me realize that “passing variables by reference,” something that I thought was such a time-saver, was actually one of the things that caused me tremendous problems, because it caused variables to be changed by distant parts of the code.</p>\n<p>Here’s a brief video I did that described my aha moment of how potentially dangerous passing variables by reference is to the unsuspecting.</p>\n<p></p>\n<p>Horrors! After programming in Clojure, it seemed so dangerous (and vulgar!) that you could call a function, and it could change the object you passed it! How can you reason about a program that allowed uncontrolled mutation like this? </p>\n<p>(By the way, that talk from Scott Havens is amazing: Until very recently, he was Director of Software Engineering, Jet.com/Walmart Labs, where he was responsible for rebuilding the entire inventory management systems that support Walmart, the world’s largest company, written in F#—another amazing functional programming language. He talked about how he used functional programming principles to massively simplify the vast architecture that supported the inventory management systems, making it simpler, more reliable, easier to maintain, and cheaper to run. This is functional programming not in the small, but in one of the largest and most complex business processes in the world—and this is what the last 20% of <em>The Unicorn Project</em> (<a rel=\"noreferrer noopener\" href=\"https://itrevolution.com/the-unicorn-project/\" target=\"_blank\">download the excerpts</a>) is inspired by.)</p>\n<p>Just as Clojure showed me how a simpler LISP syntax frees your brain to think more about the problem you want to solve, the world without mutation made me realize just how difficult it is to keep track of how mutations are happening in your programs. </p>\n<p>But don’t take it from me—take it from <a href=\"https://itrevolution.com/devops-blog/feed/twitter.com/ID_AA_Carmack\">John Carmack</a>, who influenced so many of us, as one of the founders of id Software (DOOM, Quake, etc.), now CTO of Oculus VR. He wrote an <a href=\"http://www.gamasutra.com/view/news/169296/Indepth%5C_Functional%5C_programming%5C_in%5C_C.php\">amazing article in 2013 in Gamasutra magazine</a> about the power of using functional programming concepts in C++.</p>\n<blockquote class=\"wp-block-quote\"><p>My pragmatic summary: A large fraction of the flaws in software development are due to programmers not fully understanding all the possible states their code may execute in. In a multithreaded environment, the lack of understanding and the resulting problems are greatly amplified, almost to the point of panic if you are paying attention. Programming in a functional style makes the state presented to your code explicit, which makes it much easier to reason about, and, in a completely pure system, makes thread race conditions impossible.</p><p>No matter what language you work in, programming in a functional style provides benefits. You should do it whenever it is convenient, and you should think hard about the decision when it isn’t convenient. You can learn about lambdas, monads, currying, composing lazily evaluated functions on infinite sets, and all the other aspects of explicitly functionally oriented languages later if you choose.<br><br>C++ doesn’t encourage functional programming, but it doesn’t prevent you from doing it…<br><br>Pure functions are trivial to test; the tests look like something right out of a textbook, where you build some inputs and look at the output. Whenever I come across a finicky looking bit of code now, I split it out into a separate pure function and write tests for it. Frighteningly, I often find something wrong in these cases, which means I’m probably not casting a wide enough net.</p></blockquote>\n<p>I remember reading this article in 2013, but it wasn’t until I re-read it in 2016 that I realized how universal this problem is—it’s not just for games written in C++ that need to run at 60 frames per second, it’s for any programmer. </p>\n<p>In his 2013 QuakeCon keynote, he describes his experiments rewriting <em>Castle Wolfenstein 3D</em> using functional programming techniques in Haskell, to explore to what extent one could use a programming language that disallowed mutation, which was absolutely fascinating.</p>\n<p></p>\n<p>(In this talk, Carmack also talks about his explorations of LISP, doing the exercises from the famous MIT SICP book, why he’s growing ever more convinced on the value of strong, statically typed languages for large codebases that need to be maintained for a long time, and so many other fascinating observations from one of the programmer legends… I will be writing more on this in Part 2.)</p>\n<p></p>\n<h2>A Mistake I’ve Been Making Since Grad School: Composability</h2>\n<p>After gaining more proficiency in Clojure, many other things become apparent. One thing that I learned is the benefits of pushing side-effects (i.e., any impure functions, such as anything that involves input or output) to the edges of the program and making sure that everything else in between is a pure function.</p>\n<p>To recap, pure functions are those that the output is strictly a function of the inputs. One of the benefits of pure functions is that the function can be tested completely in isolation, as John Carmack noted above.</p>\n<p>When I started making a point of doing this, the benefits started becoming quite apparent. In fact, I started to get the suspicion that <em>not practicing this</em> was one of the main reasons the code I wrote would become increasingly untestable and difficult to change—which led to the feeling that my code was collapsing under its own weight.</p>\n<p>This is a problem that I’ve been having for a <em>very long time</em>…. In fact, I still have a very vivid memory of when this problem killed a project I was working on. It was during my high speed compilers class in graduate school in 1994, where we built a Modula-2 compiler in C++ that generated SPARC assembly code, which was then compiled into a Solaris executable.</p>\n<p>You first wrote a lexical analyzer to tokenize the input (using <em>lex</em> ), then the compiler that would turn the tokens into an abstract syntax tree (using <em>yacc</em>), turn it into some intermediate format, and then emit assembly code. And then use <em>as</em> to compile.</p>\n<p>It started off great, especially since I had written lexers and parsers before. But at each later stage, I remember the feeling of tucking the previous compilation phase into the next phase, thinking, “Okay, here goes nothing…. I’m putting my code somewhere where I can no longer directly access it, and it feels like throwing it into a deep, dark well… I sure hope it works.”</p>\n<p>In other words, I had written the compiler phases in a way where each phase was no longer independently runnable, let alone testable. I was good enough where it was not really a problem until the very last phase, where we were executing our SPARC executable program.</p>\n<p>I remember my compiler working for all the test cases, until we had to implement recursion. Then it started blowing up after a certain number of recursive calls—after several all-nighters, I finally figured out that I was incorrectly computing the memory locations of variables on the stack, probably incrementing the stack pointer the wrong way. After a certain number of recursive function calls, the generated program would just segfault and die.</p>\n<p>Even thought I figured out conceptually what was going wrong, I ran out of time, and couldn’t fix the mess I had created before submitting my fatally flawed compiler. I probably got one of the lowest grades in the class.</p>\n<p>What I had learned was that burying my code so that it could only be executed inside other functions violated the principle of composition—the ability to run and test it, independent and isolated from the other modules. (My thanks to <a href=\"https://twitter.com/stephnmagill\">Dr. Stephen Magill</a> for taking the time to explain this to me, who also helped me write my first Haskell program!)</p>\n<p>Here’s some pseudo-code of the good way vs. bad way…</p>\n<pre class=\"wp-block-code\"><code>\n; \n; good way: steps are composed together, which each compiler phase\n; indepdendently executable and testable\n; \n(-> (tokenize-source-files!)\n    (generate-abstract-syntax-tree)\n    (generate-intermediate-representation)\n    (generate-assembly-instructions)\n    (write-assembly-output-files!))\n\n; \n; bad way\n;    all the intermediate steps buried inside other functions, no longer reachable or inspectable\n; \ntokenize-source-files-and-generate-ir-and-generate-assembly();\n\n\n</code></pre>\n<p>In Clojure, I fell in love with the convention of marking impure functions with a <code>!</code>, to make it obvious when side-effects could happen. This includes any function that reads from disk or a database, let alone writes to one—after all, even external inputs make the output impure. These effectful functions should be pushed to the beginning or the end of your program, which makes everything in the middle independently runnable and testable.</p>\n<p>It’s embarrassing that it’s taken thirty years after I started coding professionally to finally discover this mistake, which has plagued almost every large program that I’ve worked on.</p>\n<p>And of course, many people learned this twenty years ago, either by intuition, experience, or by reading great books such as <a href=\"https://www.amazon.com/gp/product/0134757599\">Refactoring: Improving the Design of Existing Code</a> by Martin Fowler. But knuckle-headed me only learned after being forced to confront this in Clojure, which seems to bring these problems to the front and center.</p>\n<p>(What’s also interesting to me is that by pushing side-effects to the edges, almost everything can be rewritten as pure functions and be tested with unit tests. Previously, most of my tests often tested my code and the I/O, API calls, etc… In the ideal, you just want to test the code you wrote. You don’t need to test whether the file system works in every test, or whether Trello API works, etc…. By pushing I/O to the edges, the need for brittle mocks and stubs almost disappears entirely.)</p>\n<p></p>\n<h2>The Epiphany I Had Reading “React for jQuery Programmers To Get By”</h2>\n<p>Something else happened during my first rewrite of TweetScriber that primed me for another Clojure aha moment. Knowing almost nothing about writing a JavaScript app, I was initially doing some research and stumbled upon this amazing article, <a href=\"https://medium.freecodecamp.org/react-introduction-for-people-who-know-just-enough-jquery-to-get-by-2019-version-28a4b4316d1a\">An Introduction to React in 2019 (For People Who Know Just Enough jQuery To Get By)</a> which was originally written by Shu Uesugi (<a href=\"https://twitter.com/chibicode\">@chibicode</a>) in 2015 and revised by Julien Benchetrit (<a href=\"https://twitter.com/julienbenc\">@julienbenc</a>). </p>\n<p>I had virtually no experience with working in the browser DOM, had never used jQuery (but had heard about how revolutionary it was years back), and I’ve certainly never used one of these more modern frameworks like React.</p>\n<p>The article seemed especially timely, because at first glance, the exercises seemed to cover 50% of the TweetScriber functionality I needed! But reading through the exercises, it seemed to discuss something very, very important, with some profound lessons in how program state leads to incredible complexity—more things that have caused my programs to eventually collapse in on itself. </p>\n<ul><li>Step 1. Write a Tweetbox, which lets you type into an textarea window, with a Tweet button.<br><br>Cool. I barely knew enough HTML to write this, so copying this code would be awesome. Easy enough.<br></li><li> Step 2. Change the Tweetbox so that if the contents exceed 140 characters (the original article was written in 2015), then disable the Tweet button.<br><br>Great. We now have some state associated with the program, but it isn’t too bad, because it’s just keeping track of the number of characters in the textarea and adjusting whether the button is disabled or not.<br></li><li>Step 7. Change the Tweetbox so that it displays characters remaining, and a display message that indicates by how many characters you’ve exceeded the limit.<br><br>Okay, this is getting a little more complicated, because now these different components need to be updated differently based on the state… <br></li><li>Step 9. Add an Add Photo button, which displays “photo added” if a photo has already been added, and also subtract 23 characters from the number of characters remaining (because links to photos consume characters).<br><br>Okay, the point of these exercises was becoming very evident, because now state management is becoming a real issue, and using the jQuery style of callbacks was becoming a real mess—even keeping track of which components needed to know of each other, and what their responsibilities are to each other, seemed impossible to remember.<br><br>And this is for a small toy application!!! In a real application, the complexity is orders of magnitude worse!</li></ul>\n<p>In other words, in the jQuery implementation, the flow of information from one component to another becomes entangled. The diagram below shows it magnificently.</p>\n<div class=\"wp-block-image\"><figure><img alt=\"Source: Shu Uesugi and Julien Benchetrit\" src=\"https://itrevolution.com/wp-content/uploads/2019/10/DraggedImage-3-10.png\" class=\"wp-image-6919\">SIMPLE! Source: Shu Uesugi and Julien Benchetrit</figure></div>\n<p>In contrast, consider the the same functionality implemented with something like React, in a more functional style, where state is mutated in one place, and all the UI elements are rendered from the state. State is changed in a very uniform way, and the UI is rendered as pure functions, never mutating state.</p>\n<p>The diagram below show how much simpler the data flow is…</p>\n<div class=\"wp-block-image\"><figure><img alt=\"Source: Shu Uesugi and Julien Benchetrit\" src=\"https://itrevolution.com/wp-content/uploads/2019/10/DraggedImage-4-8.png\" class=\"wp-image-6922\">COMPLECTED! Source: Shu Uesugi and Julien Benchetrit</figure></div>\n<p>I found this to be a shockingly convincing argument about how code should be written. And I was pretty happy with my first version that I wrote in TypeScript and React.</p>\n<p>(In my ClojureScript rewrite using re-frame, it addressed one of the problems I found in using React, which was state is scattered across all the components. Re-frame and Redux take a different approach, which is to put all mutable state into one place, which I’ve found works magnificently. This has been so successful for me that I will never write a client web app in any other type of framework.)</p>\n<p>I think this aha moment prepared me for the discovery of Rich Hickey and Clojure…</p>\n<h2>What Rich Hickey Says About Simplicity: Where The First Ideal Of Locality and Simplicity Comes From</h2>\n<p>Rich Hickey is the inventor of Clojure, and his talks and Clojure have so much affected how I think about software—in fact, this entire blog post attempts to frame some of these aha moments.</p>\n<p>There was one particular Rich Hickey talk that hit me like a ton of bricks, which was his famous “Simple Made Easy” talk that he gave at Strange Loop 2011—if the jQuery/React epiphany was an aha moment, this talk was a chorus of aha moments. <sup><a href=\"https://itrevolution.com/devops-blog/feed/#fn2\">2</a></sup> </p>\n<p>The talk is on the <em>InfoQ</em> site <a href=\"https://www.infoq.com/presentations/Simple-Made-Easy/\">here</a> (which shows the slides associated with the soundtrack), and you can find a wonderful transcript of the talk <a href=\"https://github.com/matthiasn/talk-transcripts/blob/master/Hickey_Rich/SimpleMadeEasy.md\">here</a>. You can also find a version of the talk he did for the Ruby and Ruby on Rails community on YouTube <a href=\"https://www.youtube.com/watch?v=rI8tNMsozo0\">here.</a> </p>\n<div class=\"wp-block-image\"><figure><img alt=\"\" src=\"https://itrevolution.com/wp-content/uploads/2019/10/DraggedImage-5-7.png\" class=\"wp-image-6918\"></figure></div>\n<p>This talk is so impactful to me that I’m almost tempted to say, “Go ahead and take an hour to listen to the talk. I’ll wait here.”</p>\n<p>Among many other things, he talks about how limited the human brain is in its ability to reason about things, to keep track of things, to grapple with complexity (like the jQuery example above). He stated that the difference in cognitive capability between your average programmer and your average programmer is not the vaunted 10x difference. He said (emphasis mine):</p>\n<blockquote class=\"wp-block-quote\"><p>Then we have this other part though, which is the mental capability part. And that’s the part that’s always hard to talk about, the mental capability part because, the fact is, we can learn more things. We actually can’t get much smarter. We’re not going to move; we’re not going to move our brain closer to the complexity. We have to make things near by simplifying them.</p><p>But the truth here is not that they’re these super, bright people who can do these amazing things and everybody else is stuck because the juggling analogy is pretty close. <strong>Right? The average juggler can do three balls. The most amazing juggler in the world can do, like, 9 balls or 12 or something like that. They can’t do 20 or 100. We’re all very limited. Compared to the complexity we can create, we’re all statistically at the same point in our ability to understand it, which is not very good. So we’re going to have to bring things towards us.</strong></p></blockquote>\n<p>He talks about the need for simplicity in the software we write, and the stuff that we write our software in. The conditions for simplicity include having components that are completely decoupled from each other with no knowledge each other. Just like in the jQuery example, things quickly become a complete mess when all the different controls have to know about each other—it’s difficult to get it to work correctly, to reason about what happens when state changes, and it’s difficult to write additional functionality to it.</p>\n<p>Hickey goes through the some of the core concepts in programming languages, and describes the extremes of which represent the ideal of simplicity and which ones represent complexity that eventually leads to the inability to understand and safely change our code, as well as misery and catastrophe.</p>\n<div class=\"wp-block-image\"><figure><img alt=\"Source: Rich Hickey, Simple Made Easy (2011)\" src=\"https://itrevolution.com/wp-content/uploads/2019/10/DraggedImage-6-4.png\" class=\"wp-image-6921\">Source: Rich Hickey, Simple Made Easy (2011)</figure></div>\n<div class=\"wp-block-image\"><figure><img alt=\"Source: Rich Hickey, Simple Made Easy (2011)\" src=\"https://itrevolution.com/wp-content/uploads/2019/10/DraggedImage-7-4.png\" class=\"wp-image-6916\">Source: Rich Hickey, Simple Made Easy (2011)</figure></div>\n<p>As I mentioned in the beginning of this article, <em>The Unicorn Project</em> (<a rel=\"noreferrer noopener\" href=\"https://itrevolution.com/the-unicorn-project/\" target=\"_blank\">download the excerpts</a>) is about the invisible structures that enable developers to be productive. So much of this comes from the concepts that Rich Hickey has espoused over the years, and which have become infused into Clojure and the Clojure community:</p>\n<blockquote class=\"wp-block-quote\"><p>Erik answer, “‘Complect’ is an archaic word, resurrected by Sensei Rich Hickey. It is a verb that means to turn something simple into something complex.</p><p>“In tightly coupled and complected systems, it’s nearly impossible to change anything, because you can’t just change one area of the code, you must change one hundred, or even a thousand, areas of the code. And even the smallest changes can cause wildly unpredictable effects in distant parts of the system, maybe in something you’ve never even heard of.</p><p>“Sensei Hickey would say, ‘think of four strands of yarn that hang independently—that’s a simple system. Now take those same four strands of yarn and braid them together. Now you’ve complected them.’ Both configurations of yarn could fulfill the same engineering goal, but one is dramatically easier to change than the other. In the simple system, you can change one string independently without having to touch the others. Which is very good.”</p><p>Erik laughs, “However, in the complected system, when you want to make a change to one strand of yarn, you are forced to change the other three strands, too. In fact, for many things you may want to do, you simply cannot, because everything is so knotted together!</p><p>“And when that happens,” he continues, “you’ve trapped yourself in a system of work where you can no longer solve real business problems easily anymore—instead, you’re forced to merely solve puzzles all day, trying to figure out how to make your small change, obstructed by your complected system every step of the way. You must schedule meetings with other teams, try to convince them to change something for you, escalate it to their managers, maybe all the way up the chain.</p><p>“Everything you do becomes increasingly distant from the real business problem you’re trying to solve,” he says. “And that, Dwayne, is what everyone discovered when they switched out the routers in those manufacturing plants. Before, you had three independent strands, with team able to work independently but at the cost of having to maintain three networking switches.</p><p>“When you put them all on one switch, you complected their value streams, all now having dependencies on each other that didn’t exist before! They must constantly communicate, coordinate, schedule, marshal, sequence, and deconflict their work. They now have an extremely high cost of coordination, which lengthened lead times, decreased quality, and in your story, led to a week-long catastrophe that significantly impaired the business, going all the way up to Steve!” Erik says with glee.</p></blockquote>\n<p>You can find many collections of “Rich Hickey’s Greatest Hits” on the Internet. Here are some:</p>\n<ul><li><a href=\"https://github.com/tallesl/Rich-Hickey-fanclub\">https://github.com/tallesl/Rich-Hickey-fanclub</a></li><li><a href=\"https://www.youtube.com/playlist?list=PLXsqD83He-e5oUh_DFrHbO3MoNj3tG8Vh\">https://www.youtube.com/playlist?list=PLXsqD83He-e5oUh_DFrHbO3MoNj3tG8Vh</a><br></li></ul>\n<p>(In <em>The Unicorn Project</em> (<a rel=\"noreferrer noopener\" href=\"https://itrevolution.com/the-unicorn-project/\" target=\"_blank\">download the excerpts</a>), the joke about “how many people do you need to take out to lunch in order to get a feature done” was taken from his talk that he did at 2015 Java One conference: <a href=\"https://www.youtube.com/watch?v=VSdnJDO-xdg\">https://www.youtube.com/watch?v=VSdnJDO-xdg</a>. In fact, in some ways, coupling as one of the key themes of the book came from watching this talk, where he compared modern REST interfaces with the bad old days of CORBA and Sun RPC, where changing anything needed everybody to cooperate.)</p>\n<p>What I find so interesting is that functional programming also eliminates iteration and looping, which is so prone to off-by-one errors. In <em>The Unicorn Project</em>, when Maxine pairs with some middle schoolers in Python, she spots their “off by one” error when they’re iterating through an array. This was inspired by Cornelia Davis, describing when she worked with her college-aged son on a genomic sequencing program in Python, showing the contrast in imperative vs. functional programming style: <a href=\"https://youtu.be/R1RDhUf1Go4?t=492\">https://youtu.be/R1RDhUf1Go4?t=492</a></p>\n<p>By the way, here’s a whole brilliant talk about showing how to convert an imperative program into a more functional style in JavaScript: “Solving Problems The Clojure Way,” by Rafal Dittwald.</p>\n<p></p>\n<p></p>\n<h2>Solving Business Problems, Not Solving Puzzles—Why I Detest Infrastructure These Days…</h2>\n<p>So, I feel like I need to explain another consequence of now recognizing and wanting to avoid complexity. I mentioned that I now self-identify as a developer…. What I didn’t tell you was that I now self-identify as one of those <em>very fussy, parochial developers</em> that Ops people hate. </p>\n<p>In my ideal, I just want to work on solving the problem I set out to solve, working within my pure functional application bubble. And I don’t want to deal with anything outside of that bubble.</p>\n<p>Here’s all the things I used to love doing, but now I detest doing…</p>\n<ul><li>dealing with anything outside of my application</li><li>connecting to anything to anything (including databases)</li><li>SQL databases and figuring out why my queries are so slow</li><li>updating dependencies (because, so hard…)</li><li>secrets management (ditto)</li><li>Bash</li><li>YAML</li><li>patching (so inconvenient…)</li><li>building kubernetes deployment files (mostly by Googling)</li><li>trying to understand why my cloud costs are so high<br></li></ul>\n<p>This is not to say that these things aren’t important. On the contrary, they’re absolutely critical. Which is why I think the brightest days of Infrastructure and Operations and Infosec are still ahead of us, not behind us. I believe the job of infrastructure and security people is to create the platforms that developers can use to take care of all these non-functional requirements, without having to Google and Stack Overflow all day.</p>\n<p></p>\n<h2>Lastly, the REPL…the Ultimate In Fast Feedback Loops!</h2>\n<p>Okay, it’s about time to wrap up this first article, which is pushing 8K words, and there’s so many other things I want to write about because I’m so excited by them, but it’s time to post something…otherwise, I’ll never post anything.</p>\n<p>But there’s one thing that I need to write about, which is something that seems pretty unique to Clojure, or LISPs, which is the amazingly interactive nature of development. One reason I think I’ll be using Clojure for years (or decades) to come is because of the REPL.</p>\n<p>REPL stands for Read-Eval-Print-Loop, which many languages have. But I don’t know of any other modern language that can be integrated into an editor, where you can modify the running program, inspect variables, run functions…from inside the program! </p>\n<p>In the spirit of Focus, Flow, and Joy, I think the REPL experience is absolutely amazing and sublime. It feels like you’re building your program from the inside, writing and testing expressions, saving I/O to variables and transforming the output using pure functions. I’ve done this with Clojure programs running on the JVM, or ClojureScript programs running in a browser…I’ve done it to analyze and visualize large data sets, save to and query databases…</p>\n<p>Going back to programming where you have to save and reload your program, and then maybe even navigate to get back to a certain program state, just seems intolerable now.</p>\n<p>This is definitely one of those things that you have to see a master at work to fully appreciate. Here’s Bruce Hauman talking in 2015 about the now famous figwheel, a ClojureScript build tool that enables live code reloading (and so much more). Watch as he shows something he wrote on the plane ride out to the conference, as he changes the solar system simulator and the JavaScript app gets hot-reloaded in real time.</p>\n<p></p>\n<p>(Yes, you can do this in JavaScript, but trust me, due to how dicey state mutation is, it’s very flakey. On the other hand, the way Clojure enforces mutation to be done in a very specific way makes it almost perfect for this style of coding.)</p>\n<p>Here’s a 2019 video of Sean Corfield (famous for his work on the mostly widely used Clojure JDBC libraries) showing how he uses the REPL to debug a problem reported in the <code>core.memoize</code> function, using the Atom editor and the Chlorine Clojure plug-in. He walks through the steps required to reproduce the problem, form by form, and the output of each form as it’s evaluated is displayed in the editor. In the failing case, we watch as he inspects the internal state of the function, hypothesizes what is going wrong, confirms it, and fixes it. (We then watch as he creates an additional test to the Clojure test suite and runs in across 10 years of Clojure versions.)</p>\n<p>I think Sean makes debugging almost look fun, and it shows just how powerful working within a REPL can be.</p>\n<p></p>\n<p>(I use the <a href=\"https://cursive-ide.com/\">Cursive plug-in for IntelliJ</a> by Colin Fleming and team, which I find to be absolutely terrific. I use Visual Studio Code for almost all non-Clojure files, so I have high hopes for the Calva plug-in…. But I love the Cursive features so much I can’t imagine switching anytime in the near future.)</p>\n<p>Here’s a great video of Mark Seeman implementing the “fizzbuzz” program in three languages: C#, Haskell, and then Clojure. Note that he’s using a REPL to do the Clojure implementation, and it sure seems like he’s having more fun doing it than in the other languages! (He’s using a mostly abandoned editor called LightTable, which was groundbreaking when it was released.)</p>\n<p></p>\n<p>And here’s a video of the aforementioned and amazing Mike Nygard showing how to do TDD using Clojure and the Datomic database, from inside Emacs. (Many people equate Clojure with Emacs — but I think only 50% of people in the Clojure community use Emacs. I put this video last to demonstrate how many options viable Clojure editor options there are!)</p>\n<figure></figure>\n<h2>The Amazing Clojure Community, Parting Thoughts, and What I’d Like To Write About In The Future</h2>\n<p>I’ve found the Clojure community to be incredibly amazing and supportive. There’s a <a href=\"http://clojurians.net/\">Clojurian Slack Channel</a> that is incredible. The <a href=\"https://clojure.org/events/2019/clojureconj\">Clojure/conj</a> and other conferences tend to attract very experienced developers who share similar sensibilities. All these conferences tend to invite some of the most accomplished researchers and contributors in the programming domain.</p>\n<p>An example: one of most amazing talks I’ve seen was from the 2016 Clojure/conj where Brian Goetz, architect for the Java language, talked about his stewardship of the Java ecosystem. What’s unmistakable and so admirable is his sense of responsibility to not break code that nine million developers have written.</p>\n<p></p>\n<p>Here’s a talk from Tiago Luchini on writing declarative domain models—after you watch this, you’ll never want to deal with a SQL or noSQL database again…and which is why I switched to using the Datomic database, from the same organization that brings us Clojure.</p>\n<p></p>\n<p>Some great learning aids for Clojure: </p>\n<ul><li>Eric Normand has an amazing set of tutorials on Functional TV: <a href=\"https://purelyfunctional.tv/browse/?taxonomy=language\">https://purelyfunctional.tv/browse/?taxonomy=language</a>—if you don’t have a lot of experience with Java (like me), I’d especially recommend his <a href=\"https://purelyfunctional.tv/courses/jvm-clojure/)\">modules on Java, JVM, etc. </a></li><li>Arne Brasseur has another set of amazing tutorials on Lambda Island: <a href=\"https://lambdaisland.com/\">https://lambdaisland.com/</a></li><li><a href=\"https://feierabendprojekte.wordpress.com/2018/10/27/high-level-vs-low-level/amp/\">https://feierabendprojekte.wordpress.com/2018/10/27/high-level-vs-low-level/amp/</a></li><li>The famous Bob Martin of Clean Code fame on “Why Clojure?”: <a href=\"https://blog.cleancoder.com/uncle-bob/2019/08/22/WhyClojure.html\">https://blog.cleancoder.com/uncle-bob/2019/08/22/WhyClojure.html</a><br></li></ul>\n<p>I recommend the following books to get up the speed on Clojure:</p>\n<ul><li>My opinion that the best book to learn Clojure is Russ Olsen’s<a href=\"https://www.amazon.com/Getting-Clojure-Build-Functional-Skills/dp/1680503006/\"> Getting Clojure: Build Your Functional Skills One Idea at a Time (2018)</a>—this wasn’t published when I learned Clojure. Oddly enough, I learned Ruby by reading one of his books, too!</li><li>Next, I would read: <a href=\"https://www.amazon.com/Clojure-Programming-Practical-Lisp-World/dp/1449394701\">Clojure Programming: Practical LISP For The Java World</a> by Chas Emerick, Brian Carper, and Christophe Grand. It has great examples of how to solve common problems, like connecting to a database, building a web server, etc.</li><li>I also liked <a href=\"https://www.amazon.com/Living-Clojure-Introduction-Training-Developers-ebook/dp/B00W4DTCSW/\">Living Clojure: An Introduction and Training Plan for Developers </a>by Carin Meier, as it has a fantastic “coding kata” teaching style.<br></li></ul>\n<p>(I’ve bought almost every book on Clojure that I could find—I like every one one of them.)</p>\n<ul><li>In the spirit of learning from people more experienced than you, I’d recommend this amazing podcast: Functional Design in Clojure by Christoph Neumann and Nate Jones: <a href=\"https://overcast.fm/itunes1443852833/functional-design-in-clojure\">https://overcast.fm/itunes1443852833/functional-design-in-clojure</a><br></li><li>David Nolen videos: <ul><li>ClojuTRE 2016: “The Next Five Years of ClojureScript”: the amazing story of how David Nolen got involved with Clojure and ClojureScript while he was working at the NYTimes, how he became one of the top contributors to ClojureScript, his view on its importance, and what may likely come: <a href=\"https://www.youtube.com/watch?v=mty0RwkPmE8\">https://www.youtube.com/watch?v=mty0RwkPmE8</a></li><li>CraftConf 2019: “Rethinking Identity with Clojure”: a great talk about the core concepts that Clojure rethinks, and more brilliant stuff: <a href=\"https://www.youtube.com/watch?v=77b47P8EpfA&t=1s\">https://www.youtube.com/watch?v=77b47P8EpfA&amp;t=1s</a><br></li></ul></li></ul>\n<p>(I also want to thank <a href=\"https://twitter.com/mfikes\">Mike Fikes</a> for all his help. I’ll never forget how, in a moment of impulse a couple of years ago, I asked whether he’d be available to chat, to teach me about the difference between the different ClojureScript runtimes, and how to connect them to IntelliJ. You’re amazing, and keep up the great work! Sorry, and thank you!!!)</p>\n<p>The work within the Clojure community is so interesting, I subscribe to the Planet Clojure RSS feed, which aggregates articles about Clojure and functional programming from many sources: <a href=\"http://planet.clojure.in/\">http://planet.clojure.in/</a>.</p>\n<p>I have a lot of enthusiasm to write in the future about the following, because it illuminates the First Ideal of Simplicity and Locality, and the Second Ideal of Focus, Flow, and Joy.</p>\n<ul><li>The Clojure programs I wrote to analyze writing patterns throughout development of <em>The Unicorn Project</em> (<a rel=\"noreferrer noopener\" href=\"https://itrevolution.com/the-unicorn-project/\" target=\"_blank\">download the excerpts</a>).</li><li>My top twenty videos from the Clojure community that blew my mind.</li><li>My adventures in trying to learn static functional programming languages, like Haskell, and learning category theory—that’s been unexpectedly rewarding. This is the world of monoids, functors, applicative functors, and the monad.</li><li>Doing a screencast of analyzing the Stack Overflow 2019 Survey data to better understand the demographics of Clojure developers, and why they rank as the highest paid population.</li></ul>\n<h2>Footnotes</h2>\n<ol><li>Thank you to Parker Matthew from Pivotal for cementing this connection for me in one of our many amazing conversations. It’s interesting to note the amazing tension and mutually supportive nature between Dr. Csikszentmilhali’s work, and the work of Dr. Anders Ericsson about deliberate practice, described in <a>“Peak: Secrets from the New Science of Expertise”</a>.<br>The dueling dynamic of “practice as a transcendental experience” vs. “practice as hard work and perseverance” is magnificently described in Dr. Sally Ducksworth book <a href=\"https://www.amazon.com/Grit-Passion-Perseverance-Angela-Duckworth-ebook/dp/B010MH9V3W/\">“Grit: The Power of Passion and Perseverance”</a> <a href=\"https://itrevolution.com/devops-blog/feed/#ffn1\"><img alt=\"↩\" src=\"https://s.w.org/images/core/emoji/12.0.0-1/72x72/21a9.png\" class=\"wp-smiley\"></a>\n</li><li>The person who created the Strange Loop conference is Alex Miller, who is also a very prominent figure in the Clojure community. In another strange twist of history, Adrian Cockcroft (<a href=\"http://twitter.com/adrianco\">@adrianco</a>) told me that this was his favorite conference in 2014. I filed it away at the time. <br>Years later in 2017, I found myself devouring video after video from this conference — it is a magnificent program, a confluence of Papers We Love, static typers and category theorists, hackers working on amazing projects, and even DevOpsy things. I’ve been wanting to attend for the last three years, but had to cancel at the last minute each time.<br>2020 will be the year, I’m sure!!! <a href=\"https://itrevolution.com/devops-blog/feed/#ffn2\"><img alt=\"↩\" src=\"https://s.w.org/images/core/emoji/12.0.0-1/72x72/21a9.png\" class=\"wp-smiley\"></a>\n</li></ol>\n<p></p><p>The post <a rel=\"nofollow\" href=\"https://itrevolution.com/love-letter-to-clojure-part-1/\">Love Letter To Clojure (Part 1)</a> appeared first on <a rel=\"nofollow\" href=\"https://itrevolution.com\">IT Revolution</a>.</p>",
   :direction "ltr"},
  :updated 1570777073000,
  :entities
  [{:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "functional programming"}],
    :id "nlp/f/entity/wd:193076",
    :salienceLevel "mention",
    :label "functional programming"}
   {:mentions [{:text "programming language"}],
    :id "nlp/f/entity/wd:9143",
    :salienceLevel "mention",
    :label "programming language"}
   {:mentions [{:text "LISP"}],
    :id "nlp/f/entity/wd:132874",
    :salienceLevel "mention",
    :label "Lisp"}
   {:mentions [{:text "Java"}],
    :id "nlp/f/entity/wd:251",
    :salienceLevel "mention",
    :label "Java"}],
  :alternate
  [{:href "https://itrevolution.com/love-letter-to-clojure-part-1/",
    :type "text/html"}],
  :title "Love Letter To Clojure (Part 1)",
  :author "Gene Kim",
  :published-str "Thu Oct 10 23:57:53 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16dbf87f063:8ab34f8:69b9f616",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url
   "https://itrevolution.com/wp-content/uploads/2019/10/love-letter-to-clojure-part-1-gene-kim-1024x538.png",
   :width 1024,
   :height 538,
   :contentType "image/png"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://itrevolution.com/?p=6923",
  :updateCount 3,
  :commonTopics
  [{:score 186.29203160611218,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.765,
    :id "nlp/f/topic/1339",
    :salienceLevel "mention",
    :label "lifestyle"}
   {:score 0.733,
    :id "nlp/f/topic/774",
    :salienceLevel "mention",
    :label "engineering"}],
  :published 1570777073000,
  :fingerprint "8a69bab0",
  :canonicalUrl
  "https://itrevolution.com/love-letter-to-clojure-part-1/"}
 {:engagement 9,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1570827100913,
  :content
  {:content
   "<p>clojure.spec allows you to write specifications for data and use them for validation. It also provides a generative aspect that allows for robust testing as well as an additional way to understand your data through manual inspection. The dual nature of validation and generation is a natural fit for deep learning models that consist of paired discriminator/generator models.</p>\n<br>\n<p><strong><strong>TLDR: In this post we show that you can leverage the dual nature of clojure.spec’s validator/generator to incorporate a deep learning model’s classifier/generator.</strong></strong></p>\n<br>\n<p>A common use of clojure.spec is at the boundaries to validate that incoming data is indeed in the expected form. Again, this is boundary is a fitting place to integrate models for the deep learning paradigm and our traditional software code.</p>\n<p>Before we get into the deep learning side of things, let’s take a quick refresher on how to use clojure.spec.</p>\n<h2>quick view of clojure.spec</h2>\n<p>To create a simple spec for keywords that are cat sounds, we can use <code>s/def</code>.</p>\n<figure><span></span><div><table><tbody><tr><td><pre><span>1</span>\n</pre></td><td><pre><code><span><span>(</span><span>s/def</span> <span>::cat-sounds</span> <span>#</span><span>{</span><span>:meow</span> <span>:purr</span> <span>:hiss</span><span>})</span>\n</span></code></pre></td></tr></tbody></table></div></figure>\n<p>To do the validation, you can use the <code>s/valid?</code> function.</p>\n<figure><span></span><div><table><tbody><tr><td><pre><span>1</span>\n<span>2</span>\n</pre></td><td><pre><code><span><span>(</span><span>s/valid?</span> <span>::cat-sounds</span> <span>:meow</span><span>)</span> <span>;=> true</span>\n</span><span><span>(</span><span>s/valid?</span> <span>::cat-sounds</span> <span>:bark</span><span>)</span> <span>;=> false</span>\n</span></code></pre></td></tr></tbody></table></div></figure>\n<p>For the generation side of things, we can turn the spec into generator and sample it.</p>\n<figure><span></span><div><table><tbody><tr><td><pre><span>1</span>\n<span>2</span>\n</pre></td><td><pre><code><span><span>(</span><span>gen/sample</span> <span>(</span><span>s/gen</span> <span>::cat-sounds</span><span>))</span>\n</span><span><span>;=>(:hiss :hiss :hiss :meow :meow :purr :hiss :meow :meow :meow)</span>\n</span></code></pre></td></tr></tbody></table></div></figure>\n<p>There is the ability to compose specs by adding them together with <code>s/and</code>.</p>\n<figure><span></span><div><table><tbody><tr><td><pre><span>1</span>\n<span>2</span>\n<span>3</span>\n</pre></td><td><pre><code><span><span>(</span><span>s/def</span> <span>::even-number</span> <span>(</span><span>s/and</span> <span>int?</span> <span>even?</span><span>))</span>\n</span><span><span>(</span><span>gen/sample</span> <span>(</span><span>s/gen</span> <span>::even-number</span><span>))</span>\n</span><span><span>;=> (0 0 -2 2 0 10 -4 8 6 8)</span>\n</span></code></pre></td></tr></tbody></table></div></figure>\n<p>We can also control the generation by creating a custom generator using <code>s/with-gen</code>.\nIn the following the spec is only that the data be a general string, but using the custom generator, we can restrict the output to only be a certain set of example cat names.</p>\n<figure><span></span><div><table><tbody><tr><td><pre><span>1</span>\n<span>2</span>\n<span>3</span>\n<span>4</span>\n<span>5</span>\n<span>6</span>\n<span>7</span>\n<span>8</span>\n<span>9</span>\n</pre></td><td><pre><code><span><span>(</span><span>s/def</span> <span>::cat-name</span>\n</span><span> <span>(</span><span>s/with-gen</span>\n</span><span> <span>string?</span>\n</span><span> <span>#</span><span>(</span><span>s/gen</span> <span>#</span><span>{</span><span>&quot;Suki&quot;</span> <span>&quot;Bill&quot;</span> <span>&quot;Patches&quot;</span> <span>&quot;Sunshine&quot;</span><span>})))</span>\n</span><span>\n</span><span><span>(</span><span>s/valid?</span> <span>::cat-name</span> <span>&quot;Peaches&quot;</span><span>)</span> <span>;=> true</span>\n</span><span><span>(</span><span>gen/sample</span> <span>(</span><span>s/gen</span> <span>::cat-name</span><span>))</span>\n</span><span><span>;; (&quot;Patches&quot; &quot;Sunshine&quot; &quot;Sunshine&quot; &quot;Suki&quot; &quot;Suki&quot; &quot;Sunshine&quot;</span>\n</span><span><span>;; &quot;Suki&quot; &quot;Patches&quot; &quot;Sunshine&quot; &quot;Suki&quot;)</span>\n</span></code></pre></td></tr></tbody></table></div></figure>\n<p>For further information on clojure.spec, I whole-heartedly recommend the <a href=\"https://clojure.org/guides/spec\">spec Guide</a>. But, now with a basic overview of spec, we can move on to creating specs for our Deep Learning models.</p>\n<h2>Creating specs for Deep Learning Models</h2>\n<p>In previous posts, we covered making <a href=\"https://gigasquidsoftware.com/blog/2019/08/16/simple-autoencoder/\">simple autoencoders for handwritten digits</a>.</p>\n<p><img alt=\"handwritten digits\" src=\"http://live.staticflickr.com/65535/48647524478_ca35bef78f_n.jpg\"></p>\n<p>Then, we made models that would:</p>\n<ul>\n<li>Take an image of a digit and give you back the string value (ex: “2”) – <a href=\"https://gigasquidsoftware.com/blog/2019/08/30/focus-on-the-discriminator/\">post</a></li>\n<li>Take a string number value and give you back a digit image. – <a href=\"https://gigasquidsoftware.com/blog/2019/09/06/focus-on-the-generator/\">post</a></li>\n</ul>\n<p>We will use both of the models to make a spec with a custom generator.</p>\n<br>\n<p><em>Note: For the sake of simplicity, some of the supporting code is left out. But if you want to see the whole code, it is on <a href=\"http://gigasquidsoftware.com/(https://github.com/gigasquid/clojure-mxnet-autoencoder/blob/master/src/clojure_mxnet_autoencoder/model_specs.clj\">github</a>)</em></p>\n<br>\n<p>With the help of the trained discriminator model, we can make a function that takes in an image and returns the number string value.</p>\n<figure><span></span><div><table><tbody><tr><td><pre><span>1</span>\n<span>2</span>\n<span>3</span>\n<span>4</span>\n<span>5</span>\n<span>6</span>\n<span>7</span>\n<span>8</span>\n</pre></td><td><pre><code><span><span>(</span><span>defn </span><span>discriminate</span> <span>[</span><span>image</span><span>]</span>\n</span><span> <span>(</span><span>-> </span><span>(</span><span>m/forward</span> <span>discriminator-model</span> <span>{</span><span>:data</span> <span>[</span><span>image</span><span>]})</span>\n</span><span> <span>(</span><span>m/outputs</span><span>)</span>\n</span><span> <span>(</span><span>ffirst</span><span>)</span>\n</span><span> <span>(</span><span>ndarray/argmax-channel</span><span>)</span>\n</span><span> <span>(</span><span>ndarray/->vec</span><span>)</span>\n</span><span> <span>(</span><span>first</span><span>)</span>\n</span><span> <span>(</span><span>int</span><span>)))</span>\n</span></code></pre></td></tr></tbody></table></div></figure>\n<p>Let’s test it out with a test-image:</p>\n<p><img alt=\"test-discriminator-image\" src=\"http://live.staticflickr.com/65535/48881532151_251e30840e_s.jpg\"></p>\n<figure><span></span><div><table><tbody><tr><td><pre><span>1</span>\n</pre></td><td><pre><code><span><span>(</span><span>discriminate</span> <span>my-test-image</span><span>)</span> <span>;=> 6</span>\n</span></code></pre></td></tr></tbody></table></div></figure>\n<p>Likewise, with the trained generator model, we can make a function that takes a string number and returns the corresponding image.</p>\n<figure><span></span><div><table><tbody><tr><td><pre><span>1</span>\n<span>2</span>\n<span>3</span>\n<span>4</span>\n</pre></td><td><pre><code><span><span>(</span><span>defn </span><span>generate</span> <span>[</span><span>label</span><span>]</span>\n</span><span> <span>(</span><span>-> </span><span>(</span><span>m/forward</span> <span>generator-model</span> <span>{</span><span>:data</span> <span>[(</span><span>ndarray/array</span> <span>[</span><span>label</span><span>]</span> <span>[</span><span>batch-size</span><span>])]})</span>\n</span><span> <span>(</span><span>m/outputs</span><span>)</span>\n</span><span> <span>(</span><span>ffirst</span><span>)))</span>\n</span></code></pre></td></tr></tbody></table></div></figure>\n<p>Giving it a test drive as well:</p>\n<figure><span></span><div><table><tbody><tr><td><pre><span>1</span>\n<span>2</span>\n<span>3</span>\n<span>4</span>\n</pre></td><td><pre><code><span><span>(</span><span>def </span><span>generated-test-image</span> <span>(</span><span>generate</span> <span>3</span><span>))</span>\n</span><span><span>(</span><span>viz/im-sav</span> <span>{</span><span>:title</span> <span>&quot;generated-image&quot;</span>\n</span><span> <span>:output-path</span> <span>&quot;results/&quot;</span>\n</span><span> <span>:x</span> <span>(</span><span>ndarray/reshape</span> <span>generated-test-image</span> <span>[</span><span>batch-size</span> <span>1</span> <span>28</span> <span>28</span><span>])})</span>\n</span></code></pre></td></tr></tbody></table></div></figure>\n<p><img alt=\"generated-test-image\" src=\"http://live.staticflickr.com/65535/48881532451_023de68ddb_s.jpg\"></p>\n<p>Great! Let’s go ahead and start writing specs. First let’s make a quick spec to describe a MNIST number – which is a single digit between 0 and 9.</p>\n<figure><span></span><div><table><tbody><tr><td><pre><span>1</span>\n<span>2</span>\n<span>3</span>\n<span>4</span>\n<span>5</span>\n</pre></td><td><pre><code><span><span>(</span><span>s/def</span> <span>::mnist-number</span> <span>(</span><span>s/and</span> <span>int?</span> <span>#</span><span>(</span><span>&lt;= </span><span>0</span> <span>%</span> <span>9</span><span>)))</span>\n</span><span><span>(</span><span>s/valid?</span> <span>::mnist-number</span> <span>3</span><span>)</span> <span>;=> true</span>\n</span><span><span>(</span><span>s/valid?</span> <span>::mnist-number</span> <span>11</span><span>)</span> <span>;=> false</span>\n</span><span><span>(</span><span>gen/sample</span> <span>(</span><span>s/gen</span> <span>::mnist-number</span><span>))</span>\n</span><span><span>;=> (0 1 0 3 5 3 7 5 0 1)</span>\n</span></code></pre></td></tr></tbody></table></div></figure>\n<p>We now have both parts to validate and generate and can create a spec for it.</p>\n<figure><span></span><div><table><tbody><tr><td><pre><span>1</span>\n<span>2</span>\n<span>3</span>\n<span>4</span>\n<span>5</span>\n<span>6</span>\n</pre></td><td><pre><code><span><span>(</span><span>s/def</span> <span>::mnist-image</span>\n</span><span> <span>(</span><span>s/with-gen</span>\n</span><span> <span>#</span><span>(</span><span>s/valid?</span> <span>::mnist-number</span> <span>(</span><span>discriminate</span> <span>%</span><span>))</span>\n</span><span> <span>#</span><span>(</span><span>gen/fmap</span> <span>(</span><span>fn </span><span>[</span><span>n</span><span>]</span>\n</span><span> <span>(</span><span>do </span><span>(</span><span>ndarray/copy</span> <span>(</span><span>generate</span> <span>n</span><span>))))</span>\n</span><span> <span>(</span><span>s/gen</span> <span>::mnist-number</span><span>))))</span>\n</span></code></pre></td></tr></tbody></table></div></figure>\n<p>The <code>::mnist-number</code> spec is used for the validation after the <code>discriminate</code> model is used. On the generator side, we use the generator for the <code>::mnist-number</code> spec and feed that into the deep learning generator model to get sample images.</p>\n<p>We have a test function that will help us test out this new spec, called <code>test-model-spec</code>. It will return a map with the following form:</p>\n<figure><span></span><div><table><tbody><tr><td><pre><span>1</span>\n<span>2</span>\n<span>3</span>\n<span>4</span>\n</pre></td><td><pre><code><span><span>{</span><span>:spec</span> <span>name-of-the-spec</span>\n</span><span> <span>:valid?</span> <span>whether</span> <span>or not </span><span>the</span> <span>`</span><span>s/valid?</span><span>`</span> <span>called</span> <span>on</span> <span>the</span> <span>test </span><span>value</span> <span>is</span> <span>true</span> <span>or </span><span>not</span>\n</span><span> <span>:sample-values</span> <span>This</span> <span>calls</span> <span>the</span> <span>discriminator</span> <span>model</span> <span>on</span> <span>the</span> <span>generated</span> <span>values</span>\n</span><span> <span>}</span>\n</span></code></pre></td></tr></tbody></table></div></figure>\n<p>It will also write an image of all the sample images to a file named <code>sample-spec-name</code></p>\n<p>Let’s try it on our test image:</p>\n<p><img alt=\"test-discriminator-image\" src=\"http://live.staticflickr.com/65535/48881532151_251e30840e_s.jpg\"></p>\n<figure><span></span><div><table><tbody><tr><td><pre><span>1</span>\n<span>2</span>\n<span>3</span>\n<span>4</span>\n<span>5</span>\n<span>6</span>\n<span>7</span>\n</pre></td><td><pre><code><span><span>(</span><span>s/valid?</span> <span>::mnist-image</span> <span>my-test-image</span><span>)</span> <span>;=> true</span>\n</span><span>\n</span><span>\n</span><span><span>(</span><span>test-model-spec</span> <span>::mnist-image</span> <span>my-test-image</span><span>)</span>\n</span><span><span>;; {:spec &quot;mnist-image&quot;</span>\n</span><span><span>;; :valid? true</span>\n</span><span><span>;; :sample-values [0 0 0 1 3 1 0 2 7 3]}</span>\n</span></code></pre></td></tr></tbody></table></div></figure>\n<p><img alt=\"sample-mnist-image\" src=\"http://live.staticflickr.com/65535/48882235262_1e0dd7b758_q.jpg\"></p>\n<p>Pretty cool!</p>\n<p>Let’s do some more specs. But first, our spec is going to be a bit repetitive, so we’ll make a quick macro to make things easier.</p>\n<figure><span></span><div><table><tbody><tr><td><pre><span>1</span>\n<span>2</span>\n<span>3</span>\n<span>4</span>\n<span>5</span>\n<span>6</span>\n<span>7</span>\n</pre></td><td><pre><code><span><span>(</span><span>defmacro </span><span>def-model-spec</span> <span>[</span><span>spec-key</span> <span>spec</span> <span>discriminate-fn</span> <span>generate-fn</span><span>]</span>\n</span><span> <span>`</span><span>(</span><span>s/def</span> <span>~</span><span>spec-key</span>\n</span><span> <span>(</span><span>s/with-gen</span>\n</span><span> <span>#</span><span>(</span><span>s/valid?</span> <span>~</span><span>spec</span> <span>(</span><span>~</span><span>discriminate-fn</span> <span>%</span><span>))</span>\n</span><span> <span>#</span><span>(</span><span>gen/fmap</span> <span>(</span><span>fn </span><span>[</span><span>n#</span><span>]</span>\n</span><span> <span>(</span><span>do </span><span>(</span><span>ndarray/copy</span> <span>(</span><span>~</span><span>generate-fn</span> <span>n#</span><span>))))</span>\n</span><span> <span>(</span><span>s/gen</span> <span>~</span><span>spec</span><span>)))))</span>\n</span></code></pre></td></tr></tbody></table></div></figure>\n<h3>More Specs – More Fun</h3>\n<p>This time let’s define an even mnist image spec</p>\n<figure><span></span><div><table><tbody><tr><td><pre><span>1</span>\n<span>2</span>\n<span>3</span>\n<span>4</span>\n<span>5</span>\n<span>6</span>\n<span>7</span>\n<span>8</span>\n<span>9</span>\n<span>10</span>\n</pre></td><td><pre><code><span> <span>(</span><span>def-model-spec</span> <span>::even-mnist-image</span>\n</span><span> <span>(</span><span>s/and</span> <span>::mnist-number</span> <span>even?</span><span>)</span>\n</span><span> <span>discriminate</span>\n</span><span> <span>generate</span><span>)</span>\n</span><span>\n</span><span> <span>(</span><span>test-model-spec</span> <span>::even-mnist-image</span> <span>my-test-image</span><span>)</span>\n</span><span>\n</span><span> <span>;; {:spec &quot;even-mnist-image&quot;</span>\n</span><span> <span>;; :valid? true</span>\n</span><span> <span>;; :sample-values [0 0 2 0 8 2 2 2 0 0]}</span>\n</span></code></pre></td></tr></tbody></table></div></figure>\n<p><img alt=\"sample-even-mnist-image\" src=\"http://live.staticflickr.com/65535/48882253157_02e45d3132_q.jpg\"></p>\n<p>And Odds</p>\n<figure><span></span><div><table><tbody><tr><td><pre><span>1</span>\n<span>2</span>\n<span>3</span>\n<span>4</span>\n<span>5</span>\n<span>6</span>\n<span>7</span>\n<span>8</span>\n<span>9</span>\n<span>10</span>\n</pre></td><td><pre><code><span> <span>(</span><span>def-model-spec</span> <span>::odd-mnist-image</span>\n</span><span> <span>(</span><span>s/and</span> <span>::mnist-number</span> <span>odd?</span><span>)</span>\n</span><span> <span>discriminate</span>\n</span><span> <span>generate</span><span>)</span>\n</span><span>\n</span><span> <span>(</span><span>test-model-spec</span> <span>::odd-mnist-image</span> <span>my-test-image</span><span>)</span>\n</span><span>\n</span><span> <span>;; {:spec &quot;odd-mnist-image&quot;</span>\n</span><span> <span>;; :valid? false</span>\n</span><span> <span>;; :sample-values [5 1 5 1 3 3 3 1 1 1]}</span>\n</span></code></pre></td></tr></tbody></table></div></figure>\n<p><img alt=\"sample-odd-mnist-image\" src=\"http://live.staticflickr.com/65535/48881548138_c18850f806_q.jpg\"></p>\n<p>Finally, let’s do Odds that are over 2!</p>\n<figure><span></span><div><table><tbody><tr><td><pre><span>1</span>\n<span>2</span>\n<span>3</span>\n<span>4</span>\n<span>5</span>\n<span>6</span>\n<span>7</span>\n<span>8</span>\n<span>9</span>\n<span>10</span>\n</pre></td><td><pre><code><span> <span>(</span><span>def-model-spec</span> <span>::odd-over-2-mnist-image</span>\n</span><span> <span>(</span><span>s/and</span> <span>::mnist-number</span> <span>odd?</span> <span>#</span><span>(</span><span>> </span><span>%</span> <span>2</span><span>))</span>\n</span><span> <span>discriminate</span>\n</span><span> <span>generate</span><span>)</span>\n</span><span>\n</span><span> <span>(</span><span>test-model-spec</span> <span>::odd-over-2-mnist-image</span> <span>my-test-image</span><span>)</span>\n</span><span>\n</span><span> <span>;; {:spec &quot;odd-over-2-mnist-image&quot;</span>\n</span><span> <span>;; :valid? false</span>\n</span><span> <span>;; :sample-values [3 3 3 5 3 5 7 7 7 3]}</span>\n</span></code></pre></td></tr></tbody></table></div></figure>\n<p><img alt=\"sample-odd-over-2-mnist-image\" src=\"http://live.staticflickr.com/65535/48882089776_6f55416418_q.jpg\"></p>\n<h2>Conclusion</h2>\n<p>We have shown some of the potential of integrating deep learning models with Clojure. clojure.spec is a powerful tool and it can be leveraged in new and interesting ways for both deep learning and AI more generally.</p>\n<p>I hope that more people are intrigued to experiment and take a further look into what we can do in this area.</p>",
   :direction "ltr"},
  :updated 1570816260000,
  :entities
  [{:mentions [{:text "deep learning"}],
    :id "nlp/f/entity/wd:197536",
    :salienceLevel "about",
    :label "deep learning"}
   {:mentions [{:text "TLDR"}],
    :id "nlp/f/entity/wd:16886840",
    :salienceLevel "mention",
    :label "TL;DR"}
   {:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}],
  :alternate
  [{:href
    "http://gigasquid.github.io/blog/2019/10/11/integrating-deep-learning-with-clojure-dot-spec/",
    :type "text/html"}],
  :title "Integrating Deep Learning With clojure.spec",
  :author "Carin Meier",
  :published-str "Fri Oct 11 10:51:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16dbc9762f1:87a2e18:69b9f616",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url
   "http://live.staticflickr.com/65535/48647524478_ca35bef78f_n.jpg",
   :width 320,
   :height 320,
   :contentType "image/jpeg"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "http://gigasquid.github.io/blog/2019/10/11/integrating-deep-learning-with-clojure-dot-spec",
  :commonTopics
  [{:score 55.57900922072011,
    :id "nlp/f/topic/3000",
    :salienceLevel "about",
    :label "artificial intelligence"}
   {:score 46.94212400256073,
    :id "nlp/f/topic/3002",
    :salienceLevel "about",
    :label "data science"}],
  :published 1570816260000,
  :fingerprint "cf7cfd23",
  :canonicalUrl
  "http://gigasquid.github.io/blog/2019/10/11/integrating-deep-learning-with-clojure-dot-spec/"}
 {:engagement 8,
  :unread false,
  :crawled 1570812570061,
  :content
  {:content
   "<p>Each week, we discuss a different topic about Clojure and functional programming.</p>\n<p>If you have a question you’d like us to discuss, tweet <a href=\"https://twitter.com/clojuredesign\">@clojuredesign</a>, send an email to <a href=\"mailto:feedback@clojuredesign.club\">feedback@clojuredesign.club</a>, or join the <code>#clojuredesign-podcast</code> channel on the <a href=\"http://clojurians.net/\">Clojurians Slack</a>.</p>\n<p>This week, our topic is: <strong>“Parentheses! Parentheses! Parentheses!”</strong> We defend the lowly parentheses, and discuss the benefits of having this stalwart shepherd dutifully organizing our code.</p>\n<p>Selected quotes:</p>\n<ul>\n<li>“I’m converting my visual cues into audio information.”</li>\n<li>“Parentheses are like dust bunnies that have stacked up over time.”</li>\n<li>“Pounds of parentheses.”</li>\n<li>“The parenthesis is greatly misunderstood.”</li>\n<li>“Parentheses make the grammar of the language incredibly simple.”</li>\n<li>“I’ve never seen that in math, at least not in normal math.”</li>\n<li>“If you have 15 close parentheses, you might have to do some refactoring.”</li>\n<li>“Parentheses are the hugs your program needs.”</li>\n<li>“Peace, Love, Parentheses.”</li>\n</ul>",
   :direction "ltr"},
  :updated 1570806000000,
  :entities
  [{:mentions [{:text "parenthesis"}],
    :id "nlp/f/entity/wd:1930668",
    :salienceLevel "mention",
    :label "parenthesis"}
   {:mentions [{:text "functional programming"}],
    :id "nlp/f/entity/wd:193076",
    :salienceLevel "mention",
    :label "functional programming"}
   {:mentions [{:text "bunnies"}],
    :id "nlp/f/entity/wd:9394",
    :salienceLevel "mention",
    :label "rabbit"}
   {:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}],
  :alternate
  [{:href
    "https://clojuredesign.club/episode/050-parentheses-parentheses-parentheses/",
    :type "text/html"}],
  :title "Ep 050: Parentheses! Parentheses! Parentheses!",
  :author "Christoph Neumann and Nate Jones",
  :published-str "Fri Oct 11 08:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16dbbb9a9cd:8208dae:ad5391a1",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://clojuredesign.club/episode/050-parentheses-parentheses-parentheses/",
  :commonTopics
  [{:score 20.322941774331532,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.87,
    :id "nlp/f/topic/1695",
    :salienceLevel "about",
    :label "parenting"}],
  :published 1570806000000,
  :fingerprint "f914b3a1",
  :canonicalUrl
  "https://clojuredesign.club/episode/050-parentheses-parentheses-parentheses/"}
 {:engagement 6,
  :unread false,
  :crawled 1570730943659,
  :content
  {:content
   "Tracking the code coverage is great (except that Clojure has some problems)",
   :direction "ltr"},
  :updated 1570726398000,
  :entities
  [{:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "about",
    :label "Clojure"}
   {:mentions [{:text "code coverage"}],
    :id "nlp/f/entity/wd:1211721",
    :salienceLevel "about",
    :label "code coverage"}],
  :alternate
  [{:href
    "https://quanttype.net/posts/2019-10-10-the-joys-of-coverage.html",
    :type "text/html"}],
  :title "The joys of coverage",
  :author "quanttype",
  :published-str "Thu Oct 10 09:53:18 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16db6dc24ab:7f7b54d:69b9f616",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url "https://quanttype.net/images/moss2.jpg",
   :width 1200,
   :height 800,
   :contentType "image/jpeg"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://quanttype.net/posts/2019-10-10-the-joys-of-coverage.html",
  :commonTopics
  [{:score 25.653787802420258,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1570726398000,
  :fingerprint "e6bf4ebe",
  :canonicalUrl
  "https://quanttype.net/posts/2019-10-10-the-joys-of-coverage.html"}
 {:engagement 14,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1570712455211,
  :content
  {:content
   "The Order Management System(OMS) of our client exposes its operations in the form of messages via IBM-MQ. In this blog post, we are going to focus on setting up the infrastructure to receive and process these messages in our application.\nThis blog post is a part 6 of the blog series Building an E-Commerce Marketplace Middleware in Clojure.\nSetting up IBM-MQ for Local Development We are going to leverage the IBM-MQ’s developers edition docker image for the local development.",
   :direction "ltr"},
  :updated 1570711827000,
  :entities
  [{:mentions [{:text "IBM MQ"}],
    :id "nlp/f/entity/wd:528294",
    :salienceLevel "about",
    :label "IBM WebSphere MQ"}
   {:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "about",
    :label "Clojure"}],
  :alternate
  [{:href
    "https://www.demystifyfp.com/clojure/marketplace-middleware/processing-messages-from-ibmmq-in-clojure/",
    :type "text/html"}],
  :title "Processing Messages From IBM-MQ in Clojure",
  :author "Demystify FP",
  :published-str "Thu Oct 10 05:50:27 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16db5c2082b:7db708a:69b9f616",
  :visual {:url "none"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://www.demystifyfp.com/clojure/marketplace-middleware/processing-messages-from-ibmmq-in-clojure/",
  :commonTopics
  [{:score 37.4065684429953,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1570711827000,
  :fingerprint "221ce35",
  :canonicalUrl
  "https://www.demystifyfp.com/clojure/marketplace-middleware/processing-messages-from-ibmmq-in-clojure/"}
 {:engagement 10,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1570690041193,
  :content
  {:content
   "<p>Denotational Design is a abstraction design process created by Conal Elliott. I like it because it really asks you to step back and design the meaning of the abstractions before you implement them. In this episode, I talk about why I like it, what it is (step-by-step), and why it’s not about static types.</p>\n<p></p>\n<p></p>\n<p>The post <a rel=\"nofollow\" href=\"https://lispcast.com/why-do-i-like-denotational-design/\">Why do I like Denotational Design?</a> appeared first on <a rel=\"nofollow\" href=\"https://lispcast.com\">LispCast</a>.</p>",
   :direction "ltr"},
  :updated 1570687200000,
  :alternate
  [{:href "https://lispcast.com/why-do-i-like-denotational-design/",
    :type "text/html"}],
  :title "Why do I like Denotational Design?",
  :author "Eric Normand",
  :published-str "Wed Oct 09 23:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16db46c0569:77b2988:ad5391a1",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url
   "https://lispcast.com/wp-content/uploads/2019/10/Why-do-I-like-Denotational-Design_.jpg",
   :width 1280,
   :height 720,
   :contentType "image/jpeg"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://lispcast.com/?p=2049",
  :published 1570687200000,
  :fingerprint "f53b4bb6",
  :canonicalUrl
  "https://lispcast.com/why-do-i-like-denotational-design/"}
 {:engagement 10,
  :unread false,
  :crawled 1570553140472,
  :content
  {:content
   "<p>CIDER 0.22 was released just a month ago, but now I’m happy to announce the release of\nCIDER 0.23 (“Lima”). Unlike CIDER 0.22, Lima is a pretty small release. I was under a lot of\npressure to ship 0.22 in time for Clojure/south and I didn’t have time to complete a few\nsmall tickets that I had originally planned to go into it. The new release basically\naddresses them, plus a few bugs that were reported in CIDER 0.22. You know what’s really\ngood about small releases? It’s quite simple - you don’t need to write long blog posts about them.</p>\n<p>There’s not much in terms of new features to highlight - probably the most notable change is that\nCIDER now infers automatically figwheel builds and will present the available options to you\nwith auto-completion when you need to select a build. Another small change is that now you\ncan configure the position of evaluation results in source buffers - before they were always\ndisplayed at the end of the current line, but now you can display them right after the expression you’ve\nevaluated. Here’s the magic bit of Emacs configuration to make this happen:</p>\n<div><div><pre><code><span>(</span><span>setq</span> <span>cider-result-overlay-position</span> <span>'at-point</span><span>)</span>\n</code></pre></div></div>\n<p>We’ve also added the possibility to disable the new enhanced ClojureScript code completion,\nas some users reported it was causing issues for them that we’ve been having a hard time\nreproducing and identifying. If you want to go back to the basic ClojureScript completion\nfrom earlier versions of CIDER just use the following:</p>\n<div><div><pre><code><span>(</span><span>setq</span> <span>cider-enhanced-cljs-completion-p</span> <span>nil</span><span>)</span>\n</code></pre></div></div>\n<p>Now it’s time for slightly bigger update - translating file paths! That’s a\nsmall feature that might be useful to people developing using Docker. For\ninstance, suppose your app is running in a Docker container with your source\ndirectories mounted there. The navigation paths you’d get from nREPL will be\nrelative to the source in the Docker container rather than the correct path on\nyour host machine. If you wish to translate file paths from your running\ninstance you may use the <code>cider-path-translations</code> defcustom to do so. You can\nadd translation mappings easily by setting the following (typically in\n<code>.dir-locals.el</code> on a per-project basis):</p>\n<div><div><pre><code><span>((</span><span>nil</span>\n  <span>(</span><span>cider-path-translations</span> <span>.</span> <span>((</span><span>&quot;/root&quot;</span> <span>.</span> <span>&quot;/Users/foo&quot;</span><span>)</span>\n                              <span>(</span><span>&quot;/src/&quot;</span> <span>.</span> <span>&quot;/Users/foo/projects&quot;</span><span>)))))</span>\n</code></pre></div></div>\n<p>Each entry will be interpreted as a directory entry so trailing slash is\noptional. Navigation to some definition will attempt to translate these\nlocations, and if they exist, navigate there rather than report the file does\nnot exist. In the example above, the <code>.m2</code> directory is mounted at <code>/root/.m2</code>\nand the source at <code>/src</code>. These translations would map these locations back to\nthe user’s computer so that navigation to definition would work.</p>\n<p>There are some interesting updates on the documentations front as well. I’ve\nreplaced all of the pages on the old documentation site <a href=\"https://cider.readthedocs.io\">https://cider.readthedocs.io</a> with redirects to\n<a href=\"https://docs.cider.mx\">https://docs.cider.mx</a>. <sup><a href=\"http://metaredux.com/posts/2019/10/08/cider-0-23-lima.html#fn:1\">1</a></sup> This marks the end of the run for the legacy documentation\nportal and hopefully it’s going to affect positively the Google page rank of the new one.<sup><a href=\"http://metaredux.com/posts/2019/10/08/cider-0-23-lima.html#fn:2\">2</a></sup>\nI’ve also started work on a <a href=\"https://docs.cider.mx/cider-nrepl/index.html\">cider-nrepl section</a> of the documentation portal.\nIt’s still super basic, but it’s also the best documentation <code>cider-nrepl</code> has ever had.</p>\n<p>We’ve also fixed a bunch of bugs in Orchard and cider-nrepl, and shipped a new version of Piggieback, which\ndoesn’t blow up in the absence of ClojureScript! Cool stuff, but I’m too lazy to write in details about\nany of this. I think it’s safe to say CIDER 0.23 is nice step on the path towards better stability\nand everyone should update to it right away.\nYou can find a complete list of all the changes in CIDER 0.23 <a href=\"https://github.com/clojure-emacs/cider/releases\">here</a>.</p>\n<p>I’m quite pleased with this release and I’ll try to do a couple of more small releases\nuntil the end of the year. As usual I’d like to thank everyone who contributed to the developed of Lima\nand the awesome people at Clojurists Together for supporting the project. You’re awesome!</p>\n<p>That’s all from me for today. Until next release! Cheers!</p>\n<div>\n<ol>\n<li>\n<p>Don’t ask. There was simply no other way to do this. <a href=\"http://metaredux.com/posts/2019/10/08/cider-0-23-lima.html#fnref:1\">↩</a></p>\n</li>\n<li>\n<p>Which is currently horrible. Please, update any links you might have to the CIDER documentation, so we can boost that page rank. <a href=\"http://metaredux.com/posts/2019/10/08/cider-0-23-lima.html#fnref:2\">↩</a></p>\n</li>\n</ol>\n</div>",
   :direction "ltr"},
  :updated 1570546320000,
  :entities
  [{:mentions [{:text "cider"}],
    :id "nlp/f/entity/wd:167296",
    :salienceLevel "about",
    :label "cider"}
   {:mentions [{:text "Docker"}],
    :id "nlp/f/entity/wd:15206305",
    :salienceLevel "mention",
    :label "Docker"}
   {:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "Emacs"}],
    :id "nlp/f/entity/wd:189722",
    :salienceLevel "mention",
    :label "Emacs"}
   {:mentions [{:text "Google"}],
    :id "nlp/f/entity/wd:95",
    :salienceLevel "mention",
    :label "Google"}],
  :alternate
  [{:href "http://metaredux.com/posts/2019/10/08/cider-0-23-lima.html",
    :type "text/html"}],
  :title "CIDER 0.23 (“Lima”)",
  :author "Bozhidar Batsov",
  :published-str "Tue Oct 08 07:52:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16dac4314f8:6d09fe3:ad5391a1",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "http://metaredux.com/posts/2019/10/08/cider-0-23-lima",
  :commonTopics
  [{:score 23.335104523115092,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1570546320000,
  :fingerprint "f221412f",
  :canonicalUrl
  "http://metaredux.com/posts/2019/10/08/cider-0-23-lima.html"}
 {:engagement 4,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1570551268582,
  :content
  {:content
   "<h2></h2><p>While releasing a new version of <a href=\"http://book-squire.com\">Book Squire</a> the other day I realized that <a href=\"http://book-squire.com\">Book Squire</a> is ten years old. What first started as a quickly developed application to solve a personal need has grown into one of my longest running applications.</p><p>Back in 2009 I was frustrated with the online access to our Library. It was tedious to enter the card number and pin then navigate to the page to see the status of my account. In addition, I was checking on accounts for family members and with four Library cards in hand was finding my patience tested.</p><p>I figured why couldn't a program do this. Maybe, do it everyday and at some point send me a note if there was something important to know about.</p><p>That was the plan which resulted in <a href=\"http://book-squire.com\">Book Squire</a>.</p><h2>Platforms</h2><p>I choose <a href=\"https://www.python.org/\">Python</a> for the first version. I got the logging in, navigating of the Library site and the scraping of account data working as a script. Then decided to built it into an application running under the then new <a href=\"https://cloud.google.com/appengine/\">Google App Engine</a> platform. That worked for a while just fine. Over time I added a database to store user information and an email notifications feature with nightly reports delivered when accounts had notable events worth mentioning.</p><p>After working on a few <a href=\"https://www.djangoproject.com/\">Django</a> applications I decided to move <a href=\"http://book-squire.com\">Book Squire</a> to <a href=\"https://www.djangoproject.com/\">Django</a> and host it on a VPS. Here it stayed for many years working well except for the random updates made to the Library site which broke the parsing of the pages. </p><p>Eventually, the Library upgraded there system in a significant way. Actually made it somewhat user friendly. Still it didn't support multiple cards and you had to click around a bit so <a href=\"http://book-squire.com\">Book Squire</a> was reworked and it continued on.</p><p>For my latest update to <a href=\"http://book-squire.com\">Book Squire</a> I've rewritten it in <a href=\"https://clojure.org/\">Clojure</a>. The latest version is much cleaner internally and suspect the maintenance going forward will be easier. The old <a href=\"https://www.python.org/\">Python</a> code did suffer overtime as refactoring was never justified enough because it just worked.</p><p>If you live in Westcheter County New York and have a Library card you can use <a href=\"http://book-squire.com\">Book Squire</a>. All of the <a href=\"http://book-squire.com/questions\">30-plus Libraries</a> in the county share the same central system, the <a href=\"https://catalog.westchesterlibraries.org/eg/opac/home\">Westchester Library System</a> and so you can use <a href=\"http://book-squire.com\">Book Squire</a> to check on your accounts.</p><p>The address to try Book Squire is:</p><ul><li><a href=\"http://book-squire.com/\">http://book-squire.com/</a></li></ul>",
   :direction "ltr"},
  :updated 1570420800000,
  :entities
  [{:mentions [{:text "Library"}],
    :id "nlp/f/entity/wd:188860",
    :salienceLevel "mention",
    :label "software library"}
   {:mentions [{:text "Python"}],
    :id "nlp/f/entity/wd:28865",
    :salienceLevel "mention",
    :label "Python"}
   {:mentions [{:text "Django"}],
    :id "nlp/f/entity/wd:842014",
    :salienceLevel "mention",
    :label "Django"}
   {:mentions [{:text "Google App Engine"}],
    :id "nlp/f/entity/wd:454728",
    :salienceLevel "mention",
    :label "Google App Engine"}
   {:mentions [{:text "Westchester Library System"}],
    :id "nlp/f/entity/wd:7987256",
    :salienceLevel "mention",
    :label "Westchester Library System"}],
  :alternate
  [{:href
    "http://blog.bradlucas.com/posts/2019-10-07-book-squire-is-ten-years-old/",
    :type "text/html"}],
  :title "Book Squire Is Ten Years Old",
  :author "Brad Lucas",
  :published-str "Sun Oct 06 21:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16dac2684e6:6cde33d:ad5391a1",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "http://blog.bradlucas.com/posts/2019-10-07-book-squire-is-ten-years-old/",
  :commonTopics
  [{:score 23.994022702234055,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.815,
    :id "nlp/f/topic/1960",
    :salienceLevel "mention",
    :label "romance"}],
  :published 1570420800000,
  :fingerprint "1c4390e",
  :canonicalUrl
  "http://blog.bradlucas.com/posts/2019-10-07-book-squire-is-ten-years-old/"}
 {:engagement 5,
  :unread false,
  :crawled 1570488838211,
  :recrawled 1570749434172,
  :content
  {:content
   "<p>Business rules are different from your domain model. What goes where? I hope to tease apart this important yet subtle distinction in this episode.</p>\n<p></p>\n<p></p>\n<h2>Transcript</h2>\n<p>Eric Normand: What is the difference between the domain model and the business rules? By the end of this episode, we’re going to have a much better idea of this subtle, yet important, distinction.</p>\n<p>Hi, my name is Eric Normand. I help people thrive with functional programming. I’ve mentioned this before in the Onion Architecture — how there are three main layers.</p>\n<p>There’s the interaction layer, where all the actions take place. This is interactions with the outside world. Inside that, there’s a pure functional implementation of the business rules. That’s another layer. Inside that, there’s the domain layer, the domain model. Things call in, inward, into that inner domain model.</p>\n<p>I’ve had a couple of questions about the difference between the business rules and the domain model. Why does this thing exist in the domain model and not in the business rules? Where do you draw the line?</p>\n<p>I’d like to tell a story about why I make this distinction. Because the more I talk to people the more I realize that maybe this is not such a common distinction to make. I’ll tell a little story. Here we go. I was working for a company a few years back, maybe five, oh, wow, long time ago. Eight years ago. [laughs] Getting old.</p>\n<p>The company did electronic signatures similar to DocuSign where we would take a document, someone would upload a Word document or something, and it’d get sent out to all the people who have to sign it. The people sign it, and then it’s completely signed and done. Early on in the company, I was very early in the company’s life.</p>\n<p>We were trying to make these contracts very legal, legally binding. One of the things we started doing was learning the laws of contracts, especially in Sweden. They did have ideas about moving outside of Sweden, but at that time we were just in Sweden. One of the laws was that if you send someone a contract, you can’t take that back. Sending someone a contract is a legally recognized form of agreement.</p>\n<p>If it ever got to court, you could say, “Well, they sent this thing to me asking if I wanted to do it and I said yes so they must have wanted to do it, too.” It makes sense that there’s a law about this. You can’t have someone sign something and say, “No, I don’t want to sign it.” You were the one who sent the thing to sign. We enforced this law in our system.</p>\n<p>How it turned out in our system was, we didn’t let you cancel once you had sent it. You could cancel before you sent it saying, “Oh, I’ll throw this away. I’m going to make a new one.” Once you had sent it to the person, there was no way to cancel it. We got complaints. People saying I want to be able to cancel. I need to be able to cancel it. This is an important part of our workflow.</p>\n<p>We were like, “The law says you can’t cancel it so are you breaking the law? We don’t want to help you break the law. That’s not our goal as a software company.”</p>\n<p>What they told us was, “No, I sent the contract.” Then, they didn’t like some term in the contract so we got one the phone. We agreed over the phone to make some changes. Now I’m trying to send them a new version and I want to cancel the old one just to make sure that no one signs that. That it’s clear, that it’s done, that we’re throwing that one away.</p>\n<p>Because there’s a new version that we’ve all agreed to now. I also want to cancel it so it’s tracked. That yes, we send two out of three or canceled with a new revision on top. Things like that. We realized that we were interpreting the law in this very strict way as engineers do, as programmers do.</p>\n<p>We think when something says you are not allowed to do this or XYZ means sending a contract means you agree to it. You are not allowed to take it back once you send it. We thought that meant that you’re not allowed to basically not sign it, but you are. Even the law allows that because you have other forms of communication with people.</p>\n<p>There’s other things going on. No one is going to contest this. Even if they do, it’s very clear what happened. In a court of law, which has a much more narrative way of arguing over what happened and what it means then our computer systems which are like, “Oh, you checked this box or you didn’t check this box.” The law is separate from our system.</p>\n<p>The moral of our story was don’t try to enforce the law. That’s the moral, but there’s a deeper moral which is that, if you squinted you could see that there should have been a separation between the process of how this document works and all the operations that are allowed on it.</p>\n<p>Another layer which enforces certain other rules that are probably from some other entity like the government, like the law that can change independently of us. That hints at this separation of, there’s the domain of contracts, which is basically a neutral idea of I’m sending you this written document or I’m sending this document to multiple people.</p>\n<p>They will all sign it and then when it’s signed, it’s done. We can’t sign it or change it or anything like that once it’s all done. There’s that layer. Then, there’s this other layer, which says, “Oh, if you send it within this time to this time, it’s going to expire within six weeks.” There’s all these other rules that are happening.</p>\n<p>Whereas at this bottom layer, we just want to have a notion of a document can expire. That is a possible operation on a document. The rules about when it happens or how it’s triggered. If it’s through the UI or if it’s a time-based thing, all of that is a separate concern. You can tell it’s a separate concern because those are things that change much more frequently.</p>\n<p>This idea of a contract has a universal aspect to it, timeless aspect to it. Contracts have been used for a long time. The basics of them are well understood. The details are going to change. What I’m saying is we should separate out the domain model, which is how contracts work in an abstract way versus the business rules, which is how they work in our system.</p>\n<p>Which has all those details about how many people are allowed on your plan that you can send a contract to. Maybe on your $10 a month tier, you can only send to five people at a time. That’s a business rule. That is a clear business rule. Has nothing to do with contracts. It’s about how we make money as a business.</p>\n<p>I’m trying to separate these two out because what we wound up doing at the company was really defining a really nice set of domain models for these processes that we had that were separate from the business rules. Then, the business rules could change a lot more. We could experiment. We could add new features.</p>\n<p>We could do monetization stuff where we limit features to certain things. The model at the bottom was all the same. I’ll tell another story. Same company. I’m not sure if this is absolutely correct, but it’ll work in the story.</p>\n<p>I think we discovered at some point that the law defined, at least in Sweden, it defined the…a contract is between two or more people, which makes sense. Two or more people. They’re in agreement. They want to formalize it, put it down in writing. All right. Then, as we expanded and got more clients, more users, there was a use case that was not covered in this.</p>\n<p>That use case was that sometimes a business wanted to sign. Not a person, but a business, where they wanted to say like, “We’re offering you this credit card and here’s the terms. If you would like it, sign here.” It wasn’t from a particular person.</p>\n<p>Likewise, if you were signing up for a bank account or something, you might have to sign a bunch of agreements, but it’s just you signing as the person opening the bank account is just one person. There’s no one at the bank who is also signing something or if were renting a car, you just sign that I’m renting the car, and I’m waiving the insurance and whatever.</p>\n<p>You sign that, but no one else is signing. The owner of the car rental place doesn’t sign. It’s just one person so that violates the law in a sense because if we encode the law into our contract model, then we can’t satisfy this use case, which seems perfectly natural to do.</p>\n<p>We had to back out and take out some rules and validation and think about a more general thing, a more general case. Which is, what if a contract is between one or more people? What if a contract is between zero or more people?</p>\n<p>We generalize and abstract it because maybe we never have a contract with zero people, but we had to make so many changes when we had this two or more rule. There were a lot of assumptions in the code about there being two. What if we backed out just as a thought experiment all the way to zero and said zero or more people? What would that look like?</p>\n<p>You do that and the idea is you’re making a more general system, which goes hand and hand with the idea of the data model being actually more general, more abstract, less specific to those cases.</p>\n<p>Still does the contract thing just fine, but it’s more abstract, less tied into the details of your business, of the rules that you’re following today, of the law of today, or you even interpret the particular law. This is what I’m trying to get at with the difference between your business rules and your domain model. If you look at any business, you’d actually see this.</p>\n<p>In my book, I use the example of a pizza business. They make pizza. It’s a restaurant. The domain of pizza making is pretty stable. It’s some bread. You put toppings on it. You bake it. Someone pays money for it. You put it in a box. You deliver it. Whatever you do, it’s kind of stable. It’s timeless.</p>\n<p>The particular business that’s making it, that is making the pizza, has a lot of decisions to make. They have a lot of processes that are proprietary. Making a pizza is not proprietary. Here’s a really good example. The particular recipe, that is a business rule. It’s unique to your business. You make up the recipe and it is yours.</p>\n<p>The fact that there is a recipe, the idea of a recipe, everyone’s got that. That goes in your domain model. Likewise, a business is going to have to buy the ingredients from somewhere unless they grow it themselves, but that’s unlikely. You have to buy flour. You have to make rules about where do we buy the flour from? How often do we buy it? How do we ship it here?</p>\n<p>How do we ship to the restaurants? How do we…etc. How do we count every week how much flour we have left so we don’t run out? There’s all sorts of business processes that go on about that. The fact that you need ingredients, the fact that you need to measure them with something like a unit like kilograms, those kinds of things go in your domain model.</p>\n<p>That they have a price. That they come from somewhere and have to get to your store. That kind of stuff is part of the domain model. I think that a lot of value comes from that separation of the two. Because the domain model changes way less frequently. If you can get that right, then the business rules can change faster. You’re changing less code. You can iterate faster on your business.</p>\n<p>Likewise, if you’ve got a good domain model, a well-designed domain model, that’s a competitive advantage. Not only can you use it in this fast changing layer of your business rules, but it’s giving you advantage. Like, “Oh, yeah, we figured out zero or more documents.”</p>\n<p>Zero or more signatories on this document is actually a more general case and so we can approach this client who wants that for some reason. We are the ones that have figured out all the possible state transitions in this diagram, that goes in our domain model. Then, we can write a custom solution for you. That is a different UI and a different workflow just for your documents.</p>\n<p>That is the business advantage of a domain model. I think, maybe this will never happen, but maybe it could. In theory, it could. In the future, this is what programmers can lend to a business, is this idea of being able to make models that more closely reflect the underlying domain, so that when they code the UI, the business rules, the validation, they’re using a more powerful construct underneath, and they can iterate quickly with the top.</p>\n<p>What I learned and some of the other programmers who were there from the beginning learned was, sure, the team, the business team, business folks are telling us a contract has to have two people. You don’t just implement that directly. You think about it. When you say two people, you really mean multiple people.</p>\n<p>We probably should at least figure out what it might look like to have zero people. We’re just generalizing. That’s our job is to think past the short-term feature description that we would get and think more generally and say, “Well, we know as programmers that there’s two cases. There’s one and there’s many.” The zero case, I don’t know of that even makes sense. There’s one and there’s many.</p>\n<p>If you’re saying many, OK, now it’s not just two. Once you get past one, it’s many. Many means zero or more. You’d have to be more abstract and think a little bit deeper about the systemic quality of your model. In a way that the business people might not be thinking about. All right. I’m glad I got to share this story. I’ll just recap just real quick.</p>\n<p>In the Onion Architecture, there are three layers. There’s the iteration layer. There’s the business rules layer. Then, there’s the domain model layer. Everything calls inward because it’s an onion. The outside is the interaction layer. The inside is the domain model. They’re built on top of the thing underneath.</p>\n<p>The reason to separate out your business rules from your domain layer is because the business changes way faster than the domain. The domain in theory is something that you take this pizza domain and you can go to another business and start building on top of it even if it runs in a totally different way.</p>\n<p>It’ll have a totally different business rules layer but that domain model will still be very useful. That’s the idea. Because of that, it gives you a tremendous business advantage. You don’t have all your code tied up together.</p>\n<p>You want to change one thing. The law changes or you want to service this client who needs a different document workflow. You haven’t built the workflow in as this spaghetti code. You’ve separated it out into layers.</p>\n<p>Oh, look. All we have to do is remove our business rules layer and our interaction layer. We still have this really core domain that we’ve hardened. This works really well. We’ll build a new business rules layer and a new interaction layer.</p>\n<p>We have this code that will work for anybody. That’s awesome, right? That is what I mean when I talk about business rules versus domain model. It’s subtle. There’s choices in there. Sometimes it’s a gray line what goes in where but there’s a thick part of that layer that’s very clear where things should be.</p>\n<p>I hope this episode was useful. If you found it useful, you can find all the past episodes at lispcast.com/podcast. There you’ll find audio, video and text transcripts of all the past episodes. You’ll also find links to subscribe so look into the future. You can get all the episodes you want as they are published. They’ll come right to your phone or however you listen.</p>\n<p>You can also get them on video, etc. You can subscribe however you want. You’ll also find links to find me on social media. This came from some questions I got over email. I’d love to answer your questions too. I love getting into discussions about this stuff.</p>\n<p>Obviously these are just my opinions and I don’t know everything. I would love to hear your point of view and your knowledge on this because I’d love to develop this more and understand it better.</p>\n<p>Thank you so much for listening. This has been my thought on functional programming. My name is Eric Normand and rock on.</p>\n<p>The post <a rel=\"nofollow\" href=\"https://lispcast.com/what-is-the-difference-between-a-domain-model-and-business-rules/\">What is the difference between a domain model and business rules?</a> appeared first on <a rel=\"nofollow\" href=\"https://lispcast.com\">LispCast</a>.</p>",
   :direction "ltr"},
  :updated 1570446000000,
  :entities
  [{:mentions [{:text "Sweden"}],
    :id "nlp/f/entity/wd:34",
    :salienceLevel "mention",
    :label "Sweden"}
   {:mentions [{:text "functional programming"}],
    :id "nlp/f/entity/wd:193076",
    :salienceLevel "mention",
    :label "functional programming"}
   {:mentions [{:text "Word"}],
    :id "nlp/f/entity/wd:11261",
    :salienceLevel "mention",
    :label "Microsoft Word"}
   {:mentions [{:text "credit card"}],
    :id "nlp/f/entity/wd:161380",
    :salienceLevel "mention",
    :label "credit card"}
   {:mentions [{:text "DocuSign"}],
    :id "nlp/f/entity/wd:5287613",
    :salienceLevel "mention",
    :label "DocuSign"}],
  :alternate
  [{:href
    "https://lispcast.com/what-is-the-difference-between-a-domain-model-and-business-rules/",
    :type "text/html"}],
  :title
  "What is the difference between a domain model and business rules?",
  :author "Eric Normand",
  :published-str "Mon Oct 07 04:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16da86de843:6b27b6b:97b0c8f7",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url
   "https://lispcast.com/wp-content/uploads/2018/07/ERIC-NORMAND-LISPCAST.COM_.jpg",
   :width 513,
   :height 557,
   :contentType "image/jpeg"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://lispcast.com/what-is-the-difference-between-a-domain-model-and-business-rules/",
  :updateCount 3,
  :commonTopics
  [{:score 21.065610303317754,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.769,
    :id "nlp/f/topic/1318",
    :salienceLevel "mention",
    :label "legal tech"}],
  :published 1570446000000,
  :fingerprint "ff4ec7f7",
  :canonicalUrl
  "https://lispcast.com/what-is-the-difference-between-a-domain-model-and-business-rules/"}
 {:engagement 5,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1570472268861,
  :recrawled 1570526385140,
  :content
  {:content
   "<p>CIDER has way too many special buffers, doesn’t it? Immediately a few come to my\nmind - the REPL buffer, the stacktrace buffer, the profiler buffer, the scratch\nbuffer, the docs buffer and the nREPL messages buffer. There are easy ways to\nsummon some of them (e.g. the REPL buffer with <code>C-c C-z</code>), but not all. Usually\nyou’d be looking the CIDER buffers up using <code>C-x b</code> (<code>switch-buffer</code>) and\nwhatever completion front-end you’re using.<sup><a href=\"http://metaredux.com/posts/2019/10/07/hard-cider-navigating-cider-buffers-ninja-style.html#fn:1\">1</a></sup> Is there a better way to handle\nnavigation to and from those special buffers?</p>\n<p>Turns out there is! Enter the little known <code>cider-selector</code> command, bound by default to <code>C-c M-s</code>.\nThe usage of the command is extremely simple - after invoking it you need to type a\nsingle key identifying the target buffer (e.g. <code>r</code> for the REPL) and that’s it.</p>\n<p>Here’s a list of all of <code>cider-selectors</code>’s keybindings:</p>\n<table>\n<thead>\n<tr>\n<th>Keyboard Shortcut</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>c</code></td>\n<td>Most recently visited Clojure buffer.</td>\n</tr>\n<tr>\n<td><code>e</code></td>\n<td>Most recently visited Emacs Lisp buffer.</td>\n</tr>\n<tr>\n<td><code>r</code></td>\n<td>Current REPL buffer or most recently visited REPL buffer.</td>\n</tr>\n<tr>\n<td><code>m</code></td>\n<td><code>*nrepl-messages*</code> buffer.</td>\n</tr>\n<tr>\n<td><code>x</code></td>\n<td><code>*cider-error*</code> buffer.</td>\n</tr>\n<tr>\n<td><code>d</code></td>\n<td><code>*cider-doc*</code> buffer.</td>\n</tr>\n<tr>\n<td><code>p</code></td>\n<td><code>*cider-profiler*</code> buffer.</td>\n</tr>\n<tr>\n<td><code>s</code></td>\n<td><code>*cider-scratch*</code> buffer.</td>\n</tr>\n<tr>\n<td><code>q</code></td>\n<td>Abort.</td>\n</tr>\n<tr>\n<td><code>?</code></td>\n<td>Show help.</td>\n</tr>\n</tbody>\n</table>\n<p>Any of those keys can be prefixed with a <code>4</code> to make the target buffer open in a\ndifferent window (as opposed to the current one).</p>\n<p>One thing to keep in mind about the default keybinding <code>C-c M-s</code> is that it’s available only\nin buffers where <code>cider-mode</code> is enabled (e.g. Clojure source buffers) and in the CIDER REPL.\nIf you want to have it available everywhere it might be a good idea to add a global\nbinding in your Emacs config:</p>\n<div><div><pre><code><span>(</span><span>global-set-key</span> <span>(</span><span>kbd</span> <span>&quot;C-c s&quot;</span><span>)</span> <span>#'</span><span>cider-selector</span><span>)</span>\n</code></pre></div></div>\n<p>One cool thing that you probably noticed is that there are also shortcuts for going back to\nwhatever is the most recently used Clojure or Emacs Lisp buffer.<sup><a href=\"http://metaredux.com/posts/2019/10/07/hard-cider-navigating-cider-buffers-ninja-style.html#fn:2\">2</a></sup> Another cool thing is that\nyou can easily extend the selector with new commands using <code>def-cider-selector-method</code>:</p>\n<div><div><pre><code><span>(</span><span>def-cider-selector-method</span> <span>?z</span>\n  <span>&quot;CIDER foo buffer.&quot;</span>\n  <span>cider-foo-buffer</span><span>)</span>\n</code></pre></div></div>\n<p>I’d be really curious to hear your ideas about additional selector actions!</p>\n<p>The <code>cider-selector</code> command will be familiar to users of SLIME (CIDER’s main inspiration), as we borrowed\nit from there. Perhaps we could have named it better, but you know… naming is hard!\nRest assured, despite its weird name it’s pretty useful!</p>\n<p>That’s all I have for you today. This episode was brought to you by <a href=\"https://www.clojuriststogether.org/\">Clojurists Together</a>.\nThey are awesome and so are all of you! Keep hacking!</p>\n<div>\n<ol>\n<li>\n<p>I’m quite fond of <code>ivy</code>. <a href=\"http://metaredux.com/posts/2019/10/07/hard-cider-navigating-cider-buffers-ninja-style.html#fnref:1\">↩</a></p>\n</li>\n<li>\n<p>I hope this will motivate some of you to work on CIDER itself. <a href=\"http://metaredux.com/posts/2019/10/07/hard-cider-navigating-cider-buffers-ninja-style.html#fnref:2\">↩</a></p>\n</li>\n</ol>\n</div>",
   :direction "ltr"},
  :updated 1570468560000,
  :entities
  [{:mentions [{:text "buffer"} {:text "Buffers"}],
    :id "nlp/f/entity/wd:208465",
    :salienceLevel "about",
    :label "buffer solution"}
   {:mentions [{:text "hard cider"} {:text "cider"}],
    :id "nlp/f/entity/wd:167296",
    :salienceLevel "about",
    :label "cider"}
   {:mentions [{:text "REPL"}],
    :id "nlp/f/entity/wd:2032810",
    :salienceLevel "mention",
    :label "Read–eval–print loop"}
   {:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "Emacs Lisp"}],
    :id "nlp/f/entity/wd:1334586",
    :salienceLevel "mention",
    :label "Emacs Lisp"}],
  :alternate
  [{:href
    "http://metaredux.com/posts/2019/10/07/hard-cider-navigating-cider-buffers-ninja-style.html",
    :type "text/html"}],
  :title "Hard CIDER: Navigating CIDER Buffers Ninja-style",
  :author "Bozhidar Batsov",
  :published-str "Mon Oct 07 10:16:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16da771143d:66b8c40:ad5391a1",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "http://metaredux.com/posts/2019/10/07/hard-cider-navigating-cider-buffers-ninja-style",
  :updateCount 1,
  :published 1570468560000,
  :fingerprint "a37ab619",
  :canonicalUrl
  "http://metaredux.com/posts/2019/10/07/hard-cider-navigating-cider-buffers-ninja-style.html"}
 {:engagement 5,
  :unread false,
  :crawled 1570445207865,
  :content
  {:content
   "<div>\n<p><em>Issue 347 – October 07, 2019 · <a href=\"https://purelyfunctional.tv/newsletter-archives/\">Archives</a> · <a title=\"Thanks, Jeff!\" href=\"https://purelyfunctional.tv/newsletter/\">Subscribe</a></em></p>\n<h2>Clojure Tip 💡</h2>\n<p><em><code>catch</code> and <code>catch</code> again</em></p>\n<p><em>Special thanks to Richard Barker for this tip!</em></p>\n<p>Let’s continue on our theme of exception handling. You should use the <code>catch</code> statement’s built-in dispatch to have different behavior for different exception types.</p>\n<p>Richard mentioned seeing code that catches an <code>Exception</code> then checking its type to decide on its behavior. I’ve seen this myself. Here’s an example:</p>\n<pre><code>(try\n  (clojure.java.io/reader &quot;/tmp/file.txt&quot;)\n  (catch Exception e\n    (if (instance? java.io.FileNotFoundException e)\n      (println &quot;File not found&quot;)\n      (throw e)))) ;; unknown exception so re-throw\n</code></pre>\n<p>The <code>catch</code> expressions in a <code>try</code> have built-in type-based dispatch, so this extra instance check is redundant, and quite possibly many times less efficient, than the following code:</p>\n<pre><code>(try\n  (clojure.java.io/reader &quot;/tmp/file.txt&quot;)\n  (catch java.io.FileNotFoundException e\n    (println &quot;File not found&quot;)))\n</code></pre>\n<p>The reason the <code>catch</code> expression starts with a class is because it is looking to match only instances of that class. You can have multiple <code>catch</code> expressions to have different behavior for different kinds of exceptions.</p>\n<p>If you can have multiple <code>catch</code> expressions, then there must be some rules for choosing which one applies. The rules are simple. The JVM checks each catch expression, in order. If the expression in question is an instance (direct instance or instance of a subclass) of the given class, then it’s a match. The search stops, and the code is run. If the JVM gets to the end and no match was found, the exception is not caught and it continues to bubble up the stack (to the code that called this). That’s why we don’t need to re-throw the exception. We are selecting only <code>FileNotFoundException</code>s. All other exceptions pass through.</p>\n<p>These rules lead to a good rule of thumb: catch the most specific exception first. If you have multiple catch statements, they are checked in order. That means that if you have a superclass before its subclass, the subclass’s <code>catch</code> will never fire. Let’s make it concrete:</p>\n<pre><code>(try\n  (clojure.java.io/reader &quot;/tmp/file.txt&quot;)\n  (catch java.io.IOException e\n    (println &quot;Some kind of IO Exception&quot;))\n  (catch java.io.FileNotFoundException e ;; this will never catch!!!\n    (println &quot;File not found&quot;)))\n</code></pre>\n<p>Because <code>FileNotFoundException</code> is a subclass of <code>IOException</code>, <code>IOException</code> will always match for <code>FileNotFoundException</code>s. Reverse the order to put the most specific one first.</p>\n<h2>Book update 📖</h2>\n<p>The book is selling well, according to the publisher. They are hard at work getting Chapter 4 ready. I imagine it will be released any day now.</p>\n<p>Meanwhile, I’m working on Chapter 6, which is all about immutability. Believe it or not, but JavaScript is a great language for teaching immutability. Because it’s not the default, it’s something to call out all the time. You have to think about it more and bring it up in the text. If it happened by default with no effort, it would seem like a magical feature of the language.</p>\n<p>I have a very pragmatic take on immutability. I define immutability as “this cannot change because there is no code that changes it” instead of as “this cannot change because we’ve prevented any code, existing or not, from changing it”. This lets you do immutability in JavaScript without special features like freezing. I talk about this in a <a title href=\"https://lispcast.com/what-is-immutability/\">podcast episode on immutability</a>.</p>\n<p>This makes immutability a discipline instead of a language feature. I hope that the difficulty of applying the discipline will encourage people to check out languages that are immutable by default.</p>\n<p>You can <a title href=\"https://lispcast.com/gs\">buy the book</a> and use the coupon code <strong>TSSIMPLICITY</strong> for 50% off.</p>\n<h2>Currently recording 🎥</h2>\n<p>Woohoo! I did it! After several attempts and lots and lots of preparation, I recorded and published the lesson about <a title href=\"https://purelyfunctional.tv/lesson/testing-distributed-systems/\">Testing Distributed Systems</a>.</p>\n<p>In the lesson, we develop tests for a distributed key-value store that I wrote. Even though I had rehearsed the lesson before recording, running the code many times, I still found a bug in the key-value store client during the recording. Distributed systems are hard!</p>\n<p>We start off with an easy test to make sure the system is eventually consistent. Then we develop a <a title href=\"https://purelyfunctional.tv/lesson/strategies-for-properties-functionality/\">model-based test</a> of the system. The challenges are many: it’s asynchronous, we can’t introspect into the server, and the outcome depends on the order the clients sync to the server. There’s lots of indeterminacy in the system, and we have to model that with a set of possible states. When that set is empty, it means there’s no way to get what we have (according to the model), so we have a failing case.</p>\n<p>Along the way, we learn lots of lessons, like how to ensure we get reliable failing cases, how to test our tests at the REPL, and how to interpret our results.</p>\n<p><a title href=\"https://purelyfunctional.tv/courses/property-based-testing-with-test-check/\">Property-based Testing course</a> is winding down now. There are several more lessons planned, including how to test a system that doesn’t use Clojure, Spec integration, and how to use PBT during <em>design</em> to make sure you don’t violate any invariants.</p>\n<p>BTW: the only way to get <a title href=\"https://purelyfunctional.tv/courses/property-based-testing-with-test-check/\">the course</a> now is to <a title href=\"https://purelyfunctional.tv/register/\">get a membership</a>. Do it!</p>\n<h2>Brain skill 😎</h2>\n<p><em>autonomy</em></p>\n<p>If you’re reading this newsletter, you’re probably a fairly autonomous learner. Even still, it’s worth exploring how autonomy helps us learn.</p>\n<p><em>Autonomy</em> in learning means that we are able to take charge of our own learning. Unfortunately, many of us were not given much autonomy in the years of schooling we went through. The next lesson, assignment, or project was chosen for us. Even when we were given a choice, we weren’t taught how to make that choice.</p>\n<p>Once you’re out of school, you’re on your own. What should you learn? What do you want to learn? Why do you want to learn it? These are all questions that help us explore our autonomy. Yes, in the short term, learning on our own is less efficient. It’s so much more direct to be given exactly what you should learn next. But this assumes the teacher assigning it to you knows exactly what you need. Who can give such personalized attention? Maybe a personal tutor, but not a teacher with a class of 20-40 students.</p>\n<p>No, we have to take charge of our own learning, even though we will go down dead ends and make wrong turns. In the long run, it is more efficient. We learn things that relate to a sense of purpose. We learn things we are curious about. We learn when we are ready (not at the ring of a bell). And we learn the way we learn best.</p>\n<p>How can you develop this skill? You must learn to set goals, following you motivation and finding purpose. You must have the self-awareness to know your own learning process. And you must be able to plan your learning by applying appropriate learning strategies.</p>\n<p>But, like I said, if you’re reading this, you’re probably ahead of the autonomy curve. You did choose to receive this newsletter, which already shows a lot of initiative.</p>\n<h2>Clojure Challenge 🤔</h2>\n<h3>Last week’s challenge</h3>\n<p>The challenge in <a title href=\"https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-346-tip-just-throw-ex-info/\">Issue 346</a> was to make a higher-order function that implements exponential backoff.</p>\n<p>You can check out the submissions <a title href=\"https://gist.github.com/ericnormand/ab3eb89a7d065dad742d9616b11e96b6\">here</a>.</p>\n<h3>This week’s challenge</h3>\n<p><em>delete from a vector</em></p>\n<p>Clojure’s vectors let you efficiently get a value given an integer index. Often, I want to remove a value from a vector at a certain index. This doesn’t exist in the core library, so I wind up writing it each time. The question is how to do it in an efficient way?</p>\n<p>Here’s the task: write a function <code>delete-at</code> that takes a vector and an index and returns a new vector with the item at the index removed. The new vector should be one shorter than the argument.</p>\n<pre><code>(defn delete-at [v i]\n  ;; your code here\n  )\n</code></pre>\n<p>Please be mindful of the efficiency of your solution.</p>\n<p>As usual, please send me your implementations. I’ll share them all in next week’s issue. If you send me one, but you don’t want me to share it publicly, please let me know.</p>\n<p>Rock on!<br>Eric Normand</p>\n</div>\n<p>The post <a rel=\"nofollow\" href=\"https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-347-tip-catch-and-catch-again/\">PurelyFunctional.tv Newsletter 347: Tip: catch and catch again</a> appeared first on <a rel=\"nofollow\" href=\"https://purelyfunctional.tv\">PurelyFunctional.tv</a>.</p>",
   :direction "ltr"},
  :updated 1570442400000,
  :entities
  [{:mentions [{:text "newsletter"}],
    :id "nlp/f/entity/wd:264238",
    :salienceLevel "about",
    :label "newsletter"}
   {:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "superclass"} {:text "subclass"}],
    :id "nlp/f/entity/wd:212542",
    :salienceLevel "mention",
    :label "inheritance"}
   {:mentions [{:text "JVM"}],
    :id "nlp/f/entity/wd:193321",
    :salienceLevel "mention",
    :label "Java Virtual Machine"}
   {:mentions [{:text "JavaScript"}],
    :id "nlp/f/entity/wd:2005",
    :salienceLevel "mention",
    :label "JavaScript"}],
  :alternate
  [{:href
    "https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-347-tip-catch-and-catch-again/",
    :type "text/html"}],
  :title
  "PurelyFunctional.tv Newsletter 347: Tip: catch and catch again",
  :author "Eric Normand",
  :published-str "Mon Oct 07 03:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16da5d42939:64427b4:ad5391a1",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://purelyfunctional.tv/?p=32140",
  :commonTopics
  [{:score 56.6403789668911,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.853,
    :id "nlp/f/topic/774",
    :salienceLevel "about",
    :label "engineering"}
   {:score 0.5844346435038112,
    :id "nlp/f/topic/10100",
    :salienceLevel "about",
    :label "digest"}],
  :published 1570442400000,
  :fingerprint "9856e007",
  :canonicalUrl
  "https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-347-tip-catch-and-catch-again/"}
 {:engagement 16,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1570407378031,
  :content
  {:content
   "<h2>Clojure 1.11 planning</h2>\n<p>Lately we’ve been starting to work on planning for Clojure 1.11. I’ve collected a list of possible features and problem areas and we’re starting to flesh those out a bit more and prioritize which things we’ll take on for 1.11. How does that list get made? It really pulls from a bunch of sources - ideas we’ve had brewing for a while, jira issues, ask.clojure issues, things people repeatedly have trouble with on Slack or other places, etc. Sometimes we’re also looking at affordances to work with other projects like spec, tools.deps, etc.</p>\n<p>I’ve also been trolling through JIRA and building some new reports, re-prioritizing, and generally trying to make better queues that we can start working from when we get into that.</p>\n<p>I’ve dusted off some of the old <a href=\"http://insideclojure.org/2018/05/04/add-lib/\">add-lib</a> code and have been trying to sort through some of the known issues and think about how it could potentially be integrated into Clojure itself as a REPL-friendly API. Nothing really to talk about yet there.</p>\n<h2>Spec 2</h2>\n<p>Spec 2 has been kind of stalled out as Rich is thinking through some of the work we were doing on how to rework function specs and the use case of automating form/map versions of the specs.</p>\n<p>In the meantime, you might be interested in a summary of Spec 2 changes that I did in <a href=\"https://www.youtube.com/watch?v=KeZNRypKVa4\">my recent ClojuTRE talk</a>. Speaking of which, <a href=\"https://clojutre.org/2019/\">ClojuTRE</a> was great and I really enjoyed both Finland, and the conference. Definitely the best part was getting a chance to put names to all the European Clojure faces of people I know from Slack, etc.</p>\n<h2>Misc</h2>\n<p>I’ve done some maintenance work on the Contrib Jenkins infrastructure and helped with some releases of various libs and api docs over there.</p>\n<p>I also reworked the clojure.org site build to run in GitHub Actions, which works great and has made this a bit less manual than it was. Starting to look at a few other places it might be useful.</p>\n<h2>Other stuff I enjoyed this week…</h2>\n<p>I’ve been reading Adam Savage’s book <a href=\"https://www.amazon.com/Every-Tools-Hammer-Life-What/dp/1982113472\">Every Tool’s a Hammer</a> lately. Great book, but I am a long-time fan. Two years ago Adam spoke at Strange Loop and I got to interview him afterwards on stage. No video is available , but if you’re interested, check out the <a href=\"https://thestrangeloop.com/transcript-savage.html\">talk</a> and <a href=\"https://thestrangeloop.com/interview-savage.html\">interview</a> transcripts.</p>\n<p>Long-time readers have problably followed my Vulfpeck rantings in the past here. I sufficiently infected Rich Hickey that he went to the Vulfpeck show in Madison Square Garden recently and enjoyed it. #winning</p>",
   :direction "ltr"},
  :updated 1570320000000,
  :entities
  [{:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "Slack"}],
    :id "nlp/f/entity/wd:58436",
    :salienceLevel "mention",
    :label "Slackware"}
   {:mentions [{:text "Jira"}],
    :id "nlp/f/entity/wd:1359246",
    :salienceLevel "mention",
    :label "Jira"}
   {:mentions [{:text "API"}],
    :id "nlp/f/entity/wd:165194",
    :salienceLevel "mention",
    :label "application programming interface"}
   {:mentions [{:text "Madison Square Garden"}],
    :id "nlp/f/entity/wd:186125",
    :salienceLevel "mention",
    :label "Madison Square Garden"}],
  :alternate
  [{:href "http://insideclojure.org/2019/10/06/journal/",
    :type "text/html"}],
  :title "Journal 2019.23 - 1.11, spec",
  :author "Inside Clojure",
  :published-str "Sat Oct 05 17:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16da392ec6f:650ffde:69b9f616",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url "http://img.youtube.com/vi/KeZNRypKVa4/0.jpg",
   :width 480,
   :height 360,
   :contentType "image/jpeg"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "http://insideclojure.org/2019/10/06/journal/",
  :commonTopics
  [{:score 20.105942649635193,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1570320000000,
  :fingerprint "d1ea0fa2",
  :canonicalUrl "http://insideclojure.org/2019/10/06/journal/"}
 {:engagement 13,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/todo",
    :label "todo"}
   {:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1570376446441,
  :content
  {:content
   "The back-office team of our client has an active slack based workflow for most of their systems. As this middleware is going to be another system that they need to keep track of, they asked us to send messages on Slack if the middleware encounters an error during its operation. In this blog post, I am going to share how we did it in Clojure using Timbre.\nThis blog post is a part 5 of the blog series Building an E-Commerce Marketplace Middleware in Clojure.",
   :direction "ltr"},
  :updated 1570373741000,
  :entities
  [{:mentions [{:text "Slack"}],
    :id "nlp/f/entity/wd:58436",
    :salienceLevel "about",
    :label "Slackware"}
   {:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "about",
    :label "Clojure"}],
  :alternate
  [{:href
    "https://www.demystifyfp.com/clojure/marketplace-middleware/using-slack-as-log-appender/",
    :type "text/html"}],
  :title "Using Slack as Log Appender",
  :author "Demystify FP",
  :published-str "Sun Oct 06 07:55:41 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16da1baf1e9:62dc2d8:97b0c8f7",
  :visual {:url "none"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://www.demystifyfp.com/clojure/marketplace-middleware/using-slack-as-log-appender/",
  :published 1570373741000,
  :fingerprint "db473803",
  :canonicalUrl
  "https://www.demystifyfp.com/clojure/marketplace-middleware/using-slack-as-log-appender/"}
 {:engagement 5,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1570359856515,
  :content
  {:content
   "<p>A pretty common question about CIDER is how to handle project-specific configuration.\nThere are many reasons for wanting to do something like this, but probably the first\nthat comes to my mind is running Leiningen with some specific profile or adding “-A:fig”\nto the jack-in command when using the Clojure CLI (a.k.a. <code>tools.deps</code>).</p>\n<p>CIDER doesn’t have any special provisions for project-specific configuration, as this\nis something well supported in Emacs itself. Unfortunately the functionality in Emacs has the\nslight weird name “dir-local variables”, which is probably not the thing people would\nstart googling for. On the bright side - the Emacs functionality is much more generic\nthan dealing with project-specific configuration.</p>\n<p>Very simply put, all you need to do is to create in the root of your project a file named\n<code>.dir-locals.el</code> which should look something like:</p>\n<div><div><pre><code><span>((</span><span>clojurescript-mode</span>\n  <span>(</span><span>cider-clojure-cli-global-options</span> <span>.</span> <span>&quot;-A:fig&quot;</span><span>)</span>\n  <span>(</span><span>eval</span> <span>.</span> <span>(</span><span>cider-register-cljs-repl-type</span> <span>'super-cljs</span> <span>&quot;(do (foo) (bar))&quot;</span><span>))</span>\n  <span>(</span><span>cider-default-cljs-repl</span> <span>.</span> <span>super-cljs</span><span>)))</span>\n</code></pre></div></div>\n<p>The structure of the file is a mapping of major modes and some variables\nthat need to be set in them. As CIDER is not a major mode most of the time you’ll\nprobably be setting variables in <code>clojure-mode</code> or <code>clojurescript-mode</code>. Note that\n<code>clojurescript-mode</code> derives from <code>clojure-mode</code>, so whatever applies to <code>clojure-mode</code>\nwill apply to <code>clojurescript-mode</code> as well. You can also evaluate code by using\n<code>eval</code> as the variable name in the variable to value mapping, but that’s something\nyou’ll rarely need in practice.</p>\n<p>Normally, I’d simply create the <code>.dir-locals.el</code> manually. If you, however, feel\noverwhelmed by its syntax you can simply do <code>M-x add-dir-local-variable</code> and\nyou’ll be able to select the major-mode, the variable and its value\ninteractively. One small problem with this approach is that the resulting\n<code>.dir-local.el</code> will be created in the current directory, which may be a problem\ndepending on what you’re trying to do. Users of\n<a href=\"https://github.com/bbatsov/projectile\">Projectile</a> may leverage the\nproject-aware <code>projectile-edit-dir-locals</code> command instead.</p>\n<p>Here’s one slightly more complex <code>.dir-locals.el</code>:</p>\n<div><div><pre><code><span>((</span><span>emacs-lisp-mode</span>\n  <span>(</span><span>bug-reference-url-format</span> <span>.</span> <span>&quot;https://github.com/clojure-emacs/cider/issues/%s&quot;</span><span>)</span>\n  <span>(</span><span>bug-reference-bug-regexp</span> <span>.</span> <span>&quot;#\\\\(?2:[[:digit:]]+\\\\)&quot;</span><span>)</span>\n  <span>(</span><span>indent-tabs-mode</span> <span>.</span> <span>nil</span><span>)</span>\n  <span>(</span><span>fill-column</span> <span>.</span> <span>80</span><span>)</span>\n  <span>(</span><span>sentence-end-double-space</span> <span>.</span> <span>t</span><span>)</span>\n  <span>(</span><span>emacs-lisp-docstring-fill-column</span> <span>.</span> <span>75</span><span>)</span>\n  <span>(</span><span>checkdoc-symbol-words</span> <span>.</span> <span>(</span><span>&quot;top-level&quot;</span> <span>&quot;major-mode&quot;</span> <span>&quot;macroexpand-all&quot;</span> <span>&quot;print-level&quot;</span> <span>&quot;print-length&quot;</span><span>))</span>\n  <span>(</span><span>checkdoc-package-keywords-flag</span><span>)</span>\n  <span>(</span><span>checkdoc-arguments-in-order-flag</span><span>)</span>\n  <span>(</span><span>checkdoc-verb-check-experimental-flag</span><span>)</span>\n  <span>(</span><span>elisp-lint-indent-specs</span> <span>.</span> <span>((</span><span>if-let*</span> <span>.</span> <span>2</span><span>)</span>\n                              <span>(</span><span>when-let*</span> <span>.</span> <span>1</span><span>)</span>\n                              <span>(</span><span>let*</span> <span>.</span> <span>defun</span><span>)</span>\n                              <span>(</span><span>nrepl-dbind-response</span> <span>.</span> <span>2</span><span>)</span>\n                              <span>(</span><span>cider-save-marker</span> <span>.</span> <span>1</span><span>)</span>\n                              <span>(</span><span>cider-propertize-region</span> <span>.</span> <span>1</span><span>)</span>\n                              <span>(</span><span>cider-map-repls</span> <span>.</span> <span>1</span><span>)</span>\n                              <span>(</span><span>cider--jack-in</span> <span>.</span> <span>1</span><span>)</span>\n                              <span>(</span><span>cider--make-result-overlay</span> <span>.</span> <span>1</span><span>)</span>\n                              <span>;; need better solution for indenting cl-flet bindings</span>\n                              <span>(</span><span>insert-label</span> <span>.</span> <span>defun</span><span>)</span>              <span>;; cl-flet</span>\n                              <span>(</span><span>insert-align-label</span> <span>.</span> <span>defun</span><span>)</span>        <span>;; cl-flet</span>\n                              <span>(</span><span>insert-rect</span> <span>.</span> <span>defun</span><span>)</span>               <span>;; cl-flet</span>\n                              <span>(</span><span>cl-defun</span> <span>.</span> <span>2</span><span>)</span>\n                              <span>(</span><span>with-parsed-tramp-file-name</span> <span>.</span> <span>2</span><span>)</span>\n                              <span>(</span><span>thread-first</span> <span>.</span> <span>1</span><span>)</span>\n                              <span>(</span><span>thread-last</span> <span>.</span> <span>1</span><span>)))))</span>\n</code></pre></div></div>\n<p>Did you manage to guess what it is? That’s CIDER’s own <code>.dir-locals.el</code>, which\nensures that all people hacking on the Elisp codebase are going to be using some\ncommon code style settings. That’s why everything’s scoped to <code>emacs-lisp-mode</code>.</p>\n<p>For a Clojure-centric example let’s take a look at <code>cider-nrepl</code>’s <code>.dir-locals.el</code>:</p>\n<div><div><pre><code><span>((</span><span>clojure-mode</span>\n  <span>(</span><span>clojure-indent-style</span> <span>.</span> <span>:always-align</span><span>)</span>\n  <span>(</span><span>indent-tabs-mode</span> <span>.</span> <span>nil</span><span>)</span>\n  <span>(</span><span>fill-column</span> <span>.</span> <span>80</span><span>)))</span>\n</code></pre></div></div>\n<p>Here the point is to ensure everyone working on the Clojure codebase using Emacs would\nbe sharing the same code style settings.</p>\n<p>Often in the wild you’ll see dir-local entries with <code>nil</code> as the major mode there.\nThis odd looking notation simply means that the configuration specified there will\nbe applied to every buffer regardless of its major mode. Use this approach sparingly, as there’s\nrarely a good reason to do this.</p>\n<p>Another thing to keep in mind is that you can have multiple <code>.dir-locals.el</code> files in your project.\nTheir overall effect will be cumulative with the innermost file taking precedence for any files\nin the directories beneath it. I’ve never needed this in practice, but I can imagine it being\nuseful for people who have multiple projects in a mono repo, or people who apply different conventions\nto “real” code and its tests.</p>\n<p>You might be wondering when do changes to <code>.dir-locals.el</code> get reflected in the Emacs buffers\naffected by them. The answer is to this question is “when the buffers get created”. If you change\nsomething in <code>.dir-locals.el</code> you’ll normally have to re-create the related buffers.\nOr you can do in the hacker way and apply <a href=\"https://emacs.stackexchange.com/questions/13080/reloading-directory-local-variables\">a bit of Elisp magic</a>.</p>\n<p>CIDER has numerous configuration variables and all of them can easily be customized on a per project\nbasis using dir-locals. I’ll dedicate a couple of follow up articles to specific customizations\nlike tweaking <code>cider-jack-in</code> or the ClojureScript REPL init form.</p>\n<p>There are more aspects to dir-locals, but they are beyond the scope of today’s article.\nIf you’re curious for all the gory details you should check out <a href=\"https://www.gnu.org/software/emacs/manual/html_node/emacs/Directory-Variables.html\">the official Emacs documentation on dir-locals</a>.</p>\n<p>That’s all I have for you today. This episode was brought to you by <a href=\"https://www.clojuriststogether.org/\">Clojurists Together</a>.\nThey are awesome and so are all of you! Keep hacking!</p>",
   :direction "ltr"},
  :updated 1570233600000,
  :entities
  [{:mentions [{:text "hard cider"} {:text "cider"}],
    :id "nlp/f/entity/wd:167296",
    :salienceLevel "about",
    :label "cider"}
   {:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "Emacs"}],
    :id "nlp/f/entity/wd:189722",
    :salienceLevel "mention",
    :label "Emacs"}
   {:mentions [{:text "Elisp"} {:text "Emacs Lisp"}],
    :id "nlp/f/entity/wd:1334586",
    :salienceLevel "mention",
    :label "Emacs Lisp"}
   {:mentions [{:text "REPL"}],
    :id "nlp/f/entity/wd:2032810",
    :salienceLevel "mention",
    :label "Read–eval–print loop"}],
  :alternate
  [{:href
    "http://metaredux.com/posts/2019/10/05/hard-cider-project-specific-configuration.html",
    :type "text/html"}],
  :title "Hard CIDER: Project-specific Configuration",
  :author "Bozhidar Batsov",
  :published-str "Fri Oct 04 17:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16da0bdcd83:623c3fe:69b9f616",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "http://metaredux.com/posts/2019/10/05/hard-cider-project-specific-configuration",
  :commonTopics
  [{:score 65.93796847972563,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 20.749799126894285,
    :id "nlp/f/topic/3000",
    :salienceLevel "about",
    :label "artificial intelligence"}],
  :published 1570233600000,
  :fingerprint "c257199b",
  :canonicalUrl
  "http://metaredux.com/posts/2019/10/05/hard-cider-project-specific-configuration.html"}
 {:engagement 9,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1570353375412,
  :recrawled 1570355521974,
  :content
  {:content
   "<p>It has been quite a while since my last “Meta Reduce” post. I’m pretty disappointed with myself\nfor dropping the ball on “Meta Reduce” so quickly, but given how busy my schedule was the entire\nsummer I think I’ll give myself a pass.</p>\n<p>Long story short - the period since my last update was dominated by conferences,\ntravel, lots of work, and pursuing my newfound passion for personal finance\nmanagement. Now, let’s dive into some of the highlights.</p>\n<h2>Clojure</h2>\n<p>CIDER got funded by <a href=\"https://www.clojuriststogether.org/\">Clojurists Together</a>\nand I’ve spent most of my OSS hacking time working on it lately. This resulted\nin the recent release of <a href=\"http://metaredux.com/posts/2019/09/12/cider-0-22.html\">CIDER 0.22</a> and\nI’m currently pretty close to releasing CIDER 0.23 (a relatively minor update\ncompared to 0.22). My goals for the funding cycle are pretty humble - small\nimprovements here and there, better documentation, and better collaboration with\nother tool authors. I hope to find the time to expand on this subject in a\nseparate article.</p>\n<p>All of the projects in CIDER’s Orchard have been making steady progress the past few months and I feel\nwe’re really close to the release of new nREPL release. The only thing that remains to be done before we can\ncut nREPL 0.7 is the <a href=\"https://github.com/nrepl/nrepl/pull/162\">sideloading support</a>. Once that’s in\nI’ll focus on CIDER implementing it. This is going to be big!</p>\n<h2>Ruby</h2>\n<p>RuboCop got a pretty <a href=\"https://github.com/rubocop-hq/rubocop/releases/tag/v0.75.0\">big\nrelease</a> recently\nand brand new extensions for\n<a href=\"https://github.com/rubocop-hq/rubocop-minitest\">minitest</a> and\n<a href=\"https://github.com/rubocop-hq/rubocop-rake\">rake</a>. I haven’t had much time for\nRuboCop lately, but I plan to focus on the 1.0 release once I’m done with the\nClojurists Together funding cycle for CIDER.</p>\n<p>I wrote a bit more about <code>rubocop-minitest</code> <a href=\"http://metaredux.com/posts/2019/10/04/rubocop-meets-minitest.html\">here</a>.</p>\n<p>By the way, RuboCop 0.74 achieved one nice milestone - it got downloaded over 1,500,000 times which is\nan all time record for a single RuboCop release!</p>\n<h2>GitHub Sponsors</h2>\n<p>I was invited to participate in the beta of GitHub Sponsors. What’s appealing\nabout the service is:</p>\n<ul>\n<li>Lower fees than Patreon</li>\n<li>GitHub are matching all donations up to $5k/year for the first year</li>\n<li>It’s prominently featured within GitHub</li>\n</ul>\n<p>So far my early feedback for the service has been positive, as I already have sponsors\ndonating about $250/month. It’s not much in the grand scheme of things, but\nit’s more than I ever managed to raise via my Patreon account, so that’s encouraging.\nAnd thanks to GitHub matching the early donations those $250 got doubled to $500.\nLet’s see how things are going to play out in the long run, but for now I’m cautiously optimistic.</p>\n<p>You can support my OSS work via GitHub Sponsors <a href=\"https://github.com/users/bbatsov/sponsorship\">here</a>.</p>\n<h2>Conferences</h2>\n<p>I had a great time at Heart of Clojure (as a co-host) and Clojure/south (as a\nspeaker). Heart of Clojure was a really special event for me and I truly believe\nit was one of the best Clojure conferences I’ve ever attended. Everyone looking\nto create a good conference should <a href=\"https://lambdaisland.com/blog/2019-08-09-fork-this-conference\">learn from Heart of\nClojure</a>.\nClojure/south was pretty good as well and I dedicated CIDER 0.22 to it and all\nthe lovely people I met there.</p>\n<p>Next weekend I’ll speak at a local conference in Sofia for the first time in a couple of years. I’m quite excited to be\nback at <a href=\"https://www.hackconf.bg/en/\">HackConf</a> after a very long hiatus! Afterwards I’ve got just one final conference\nappearance until the end of the year - the <a href=\"https://pivorak.com/\">Pivorak Ruby Conference</a> in Lviv, Ukraine.</p>\n<p>This will wrap another busy conference season for me and I’ll finally be able to focus on OSS work (and getting some rest).\nI believe that’s going to be the first time in 5 years I don’t go to any events in November and December, which makes me a bit\nsad, but we all run out of juice from time to time.</p>\n<h2>Hardware</h2>\n<p>Even though I work remotely and spent a lot of my time in Zoom calls, for some\nreason I never invested in a proper webcam. I bought two good condenser mics\nearly on in my remote career, but I’ve been using my shitty built-in laptop\nwebcam for 5 years now. After numerous jokes from my colleagues that I look like\nan ominous shadow on most calls (because my desk is right by a window) I\nfinally decided to get a new webcam. After a week of research I chose the <a href=\"https://www.logitech.com/en-us/product/c925e-webcam\">Logitech\nC925e</a> and I’m really\npleased with its performance so far. Works flawlessly on macOS, requires no\nsetup at all and has a built-in privacy shade. I might write a bit more about\nit later.</p>\n<p>I also finally bought a DisplayPort cable capable of delivering 4K video at\n60Hz, as ever since I got my new 4K display earlier this year I’ve been stuck at\n30Hz due to limitations of my 5 year old laptop’s HDMI. I can only tell you that I\nshould have gotten that cable much earlier! 30Hz are kind of acceptable if you\nonly use a computer for work, but everything looks a bit surreal at that refresh\nrate.</p>\n<p>In general I’m more and more convinced that it’s time for me to buy some new computer, but I’ll wait a few more months\nto see what the holiday season is going to bring to the table. Currently <a href=\"https://www1.cirrus7.com/en/produkte/cirrus7-incus/\">this AMD-powered fanless desktop engineered in Germany</a>\nseems quite appealing to me. If only they were making those with Zen 2 processors…</p>\n<h2>Real World</h2>\n<p>Since my last update I’ve managed to visit 5 countries, made some new friends, reconnected with some dear old friends, attended two weddings and had a lot of fun.\nDefinitely the time I’ve spent in Brazil was the highlight of my travels and I’ll forever cherish some fond memories of Clojure/south and the week I spent afterwards with some colleagues\nnear Recife.</p>\n<p>When it comes to books I didn’t make much headway, but I did score a couple of personal wins.\nI finally managed to read “Crime and Punishment” and I’m pretty close to wrapping up “The Intelligent Investor”, so I’m quite pleased with myself. I’ve been planning to read those two books for a very very long time.</p>\n<p>I’ve also been practicing my Spanish by watching “La Case de Papel”. I have to admit that I enjoyed it way more than I expected to. I should find more (good) shows in Spanish!</p>\n<p>Last, but not least, I’ve spent a lot of time building and nurturing my investment portfolio. I’ve adopted a simple strategy based on foreign ETFs and some local “dividend” companies.\nLet’s see if the imminent Brexit is going to wreak havoc to it. I’m mostly worried that half the fintech and brokerages operating in the EU are based in the UK and it’s still not clear\nwhat kind of impact will Brexit have on them.</p>",
   :direction "ltr"},
  :updated 1570351200000,
  :entities
  [{:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "OSS"}],
    :id "nlp/f/entity/wd:1130645",
    :salienceLevel "mention",
    :label "open-source software"}
   {:mentions [{:text "GitHub"}],
    :id "nlp/f/entity/wd:364",
    :salienceLevel "mention",
    :label "GitHub"}
   {:mentions [{:text "Patreon"}],
    :id "nlp/f/entity/wd:15861362",
    :salienceLevel "mention",
    :label "Patreon"}
   {:mentions [{:text "Brexit"}],
    :id "nlp/f/entity/wd:7888194",
    :salienceLevel "mention",
    :label "Brexit"}],
  :alternate
  [{:href
    "http://metaredux.com/posts/2019/10/06/meta-reduce-2019-4-a-recap-of-a-busy-summer.html",
    :type "text/html"}],
  :title "Meta Reduce 2019.4: A Recap of a Busy Summer",
  :author "Bozhidar Batsov",
  :published-str "Sun Oct 06 01:40:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16da05ae8b4:6167fa7:97b0c8f7",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "http://metaredux.com/posts/2019/10/06/meta-reduce-2019-4-a-recap-of-a-busy-summer",
  :updateCount 1,
  :commonTopics
  [{:score 36.37039818820944,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.952,
    :id "nlp/f/topic/777",
    :salienceLevel "about",
    :label "entertainment"}],
  :published 1570351200000,
  :fingerprint "ba779762",
  :canonicalUrl
  "http://metaredux.com/posts/2019/10/06/meta-reduce-2019-4-a-recap-of-a-busy-summer.html"}
 {:engagement 9,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1570289505722,
  :content
  {:content
   "Anyone in Cambridge need a programmer? I'll give you £500 if you can find me a job that I take.<br><br>CV at <a href=\"http://www.aspden.com/\">http://www.aspden.com</a><br><br><b>I make my usual promise, which I have paid out on several times:</b><br><br>If, within the next six months, I take a job which lasts longer than one month, and that is not obtained through an agency, then on the day the first cheque from that job cashes, I'll give £500 to the person who provided the crucial introduction.<br><br>If there are a number of people involved somehow, then I'll apportion it fairly between them. And if the timing conditions above are not quite met, or someone points me at a shorter contract which the £500 penalty makes not worth taking, then I'll do something fair and proportional anyway.<br><br>And this offer applies even to personal friends, and to old contacts whom I have not got round to calling yet, and to people who are themselves offering work, because why wouldn't it?<br><br>And obviously if I find one through my own efforts then I'll keep the money. But my word is generally thought to be good, and I have made a public promise on my own blog to this effect, so if I cheat you you can blacken my name and ruin my reputation for honesty, which is worth much more to me than £500.<br><br><br><br><b>And I also make the following boast:</b><br><br>I know all styles of programming and many languages, and can use any computer language you're likely to use as it was intended to be used.<br><br>I have a particular facility with mathematical concepts and algorithms of all kinds. I can become very interested in almost any problem which is hard enough that I can't solve it easily.<br><br>I have a deserved reputation for being able to produce heavily optimised, but nevertheless bug-free and readable code, but I also know how to hack together sloppy, bug-ridden prototypes, and I know which style is appropriate when, and how to slide along the continuum between them.<br><br>I've worked in telecoms, commercial research, banking, university research, chip design, server virtualization, university teaching, sports physics, a couple of startups, and occasionally completely alone.<br><br>I've worked on many sizes of machine. I've written programs for tiny 8-bit microcontrollers and gigantic servers, and once upon a time every IBM machine in the Maths Department in Imperial College was running my partial differential equation solvers in parallel in the background.<br><br>I'm smart and I get things done. I'm confident enough in my own abilities that if I can't do something I admit it and find someone who can.<br><br>I know what it means to understand a thing, and I know when I know something. If I understand a thing then I can usually find a way to communicate it to other people. If other people understand a thing even vaguely I can usually extract the ideas from them and work out which bits make sense.",
   :direction "ltr"},
  :updated 1570287236000,
  :entities
  [{:mentions [{:text "Imperial College"}],
    :id "nlp/f/entity/wd:189022",
    :salienceLevel "about",
    :label "Imperial College London"}
   {:mentions [{:text "IBM"}],
    :id "nlp/f/entity/wd:37156",
    :salienceLevel "mention",
    :label "IBM"}
   {:mentions [{:text "partial differential equation"}],
    :id "nlp/f/entity/wd:271977",
    :salienceLevel "mention",
    :label "partial differential equation"}
   {:mentions [{:text "8-bit"}],
    :id "nlp/f/entity/wd:270159",
    :salienceLevel "mention",
    :label "8-bit"}],
  :alternate
  [{:href
    "http://www.learningclojure.com/2019/10/contract-programmer-seeks-job-in.html",
    :type "text/html"}],
  :title "Contract Programmer Seeks Job in Cambridge (£500 reward)",
  :author "John Lawrence Aspden",
  :published-str "Sat Oct 05 07:53:56 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16d9c8c55ba:5e8f5c2:69b9f616",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "tag:blogger.com,1999:blog-7056990295646173627.post-4874747012263599573",
  :commonTopics
  [{:score 55.09238476199991,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1570287236000,
  :fingerprint "8ed6cf4b",
  :canonicalUrl
  "http://www.learningclojure.com/2019/10/contract-programmer-seeks-job-in.html"}
 {:engagement 5,
  :unread false,
  :crawled 1570233561580,
  :content
  {:content
   "<p>Each week, we discuss a different topic about Clojure and functional programming.</p>\n<p>If you have a question you’d like us to discuss, tweet <a href=\"https://twitter.com/clojuredesign\">@clojuredesign</a>, send an email to <a href=\"mailto:feedback@clojuredesign.club\">feedback@clojuredesign.club</a>, or join the <code>#clojuredesign-podcast</code> channel on the <a href=\"http://clojurians.net/\">Clojurians Slack</a>.</p>\n<p>This week, our topic is: <strong>“Keywords! Keywords! Keywords!”</strong> We examine all the fascinating properties of keywords, how to use them, and why they’re so much better than strings and enums.</p>\n<p>Selected quotes:</p>\n<ul>\n<li>“The question of the day is: Why is there no question of the day?”</li>\n<li>“Everything behind the scenes should get turn into integers because that is the good and true way.”</li>\n<li>“A FAQ after the fact.”</li>\n<li>“We forget about <code>identical?</code> because Clojure gives us value semantics!”</li>\n<li>“Magic numbers you can spell with letters.”</li>\n<li>“The ability of communicating with letters–something we humans have been developing for a while.”</li>\n<li>“What is this sorcery?!”</li>\n<li>“JSON. That’s not not a guy who likes strings.”</li>\n<li>“Let’s blame JSON.”</li>\n<li>“If you don’t have to recursively walk a tree, why recursively walk a tree?”</li>\n<li>“A little bit of copying is better than a lot of depending.”</li>\n<li>“The randomly placed last one wins!”</li>\n<li>“Trust but verify.”</li>\n</ul>",
   :direction "ltr"},
  :updated 1570201200000,
  :entities
  [{:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "functional programming"}],
    :id "nlp/f/entity/wd:193076",
    :salienceLevel "mention",
    :label "functional programming"}
   {:mentions [{:text "JSON"}],
    :id "nlp/f/entity/wd:2063",
    :salienceLevel "mention",
    :label "JavaScript Object Notation"}
   {:mentions [{:text "behind-the-scenes"}],
    :id "nlp/f/entity/wd:1464369",
    :salienceLevel "mention",
    :label "making-of"}
   {:mentions [{:text "FAQ"}],
    :id "nlp/f/entity/wd:189293",
    :salienceLevel "mention",
    :label "FAQ"}],
  :alternate
  [{:href
    "https://clojuredesign.club/episode/049-keywords-keywords-keywords/",
    :type "text/html"}],
  :title "Ep 049: Keywords! Keywords! Keywords!",
  :author "Christoph Neumann and Nate Jones",
  :published-str "Fri Oct 04 08:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16d9936b1ec:5b17f20:69b9f616",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://clojuredesign.club/episode/049-keywords-keywords-keywords/",
  :commonTopics
  [{:score 34.055077111136754,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1570201200000,
  :fingerprint "d60e64bd",
  :canonicalUrl
  "https://clojuredesign.club/episode/049-keywords-keywords-keywords/"}
 {:engagement 4,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/todo",
    :label "todo"}
   {:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1570194023866,
  :content
  {:content
   "In the last blog post, we configured Timbre to log the events in the Console. In this blog post, we are going to add a database appender to persist the domain level events alone in Postgres using Toucan.\nThis blog post is a part 4 of the blog series Building an E-Commerce Marketplace Middleware in Clojure.\nAdding Migration Script Let’s get started by adding the migration script to create the event table in the database.",
   :direction "ltr"},
  :updated 1570191902000,
  :entities
  [{:mentions [{:text "Postgres"}],
    :id "nlp/f/entity/wd:192490",
    :salienceLevel "about",
    :label "PostgreSQL"}
   {:mentions [{:text "Console"}],
    :id "nlp/f/entity/wd:873759",
    :salienceLevel "about",
    :label "Console"}
   {:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}],
  :alternate
  [{:href
    "https://www.demystifyfp.com/clojure/marketplace-middleware/storing-log-events-in-postgres-using-toucan/",
    :type "text/html"}],
  :title "Storing Log Events in Postgres Using Toucan",
  :author "Demystify FP",
  :published-str "Fri Oct 04 05:25:02 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16d96db65ba:54f8070:ad5391a1",
  :visual {:url "none"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://www.demystifyfp.com/clojure/marketplace-middleware/storing-log-events-in-postgres-using-toucan/",
  :commonTopics
  [{:score 34.33764855008015,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1570191902000,
  :fingerprint "3e15749c",
  :canonicalUrl
  "https://www.demystifyfp.com/clojure/marketplace-middleware/storing-log-events-in-postgres-using-toucan/"}
 {:engagement 6,
  :unread false,
  :crawled 1570028857063,
  :recrawled 1570457683493,
  :content
  {:content
   "<div><h1>Junior to Intermediate Clojure/Clojurescript Developer</h1><div>LifeCheq | Cape Town, South Africa</div><div><em>Building a one-stop financial advice shop</em></div><div>$20000 - $40000</div><div><a href=\"http://www.lifecheq.co.za\">http://www.lifecheq.co.za</a></div><br><div><h1>Who we are</h1><p>LifeCheq is a service that helps you organise your finances to line up with your life goals. This starts with a clear plan that includes what investments you should make, what you can afford to spend on assets (such as property) and important expenses (such as education), and what insurance it makes sense for you to have at this stage of life.</p><p>Then, we help you put that plan into action. We'll fill in forms, chase up product providers, check that you aren't being given a bum deal on your insurance and keep track of what you should be doing. We'll also make sure that, as things change, we update our recommendations so you don't need to worry and can get on with living your life.</p><p>We're based in Cape Town, South Africa with operational branches opening in other major SA cities (Johannesburg so far).</p><h1>The systems we're building</h1><p>Our service is only made possible by applying the latest technology to the problem of how people plan and manage their financial lives.</p><p>We pick and integrate the best existing services for parts of the business which are done well by others and building up and deploy our own IP for the specific areas where it matters most.</p><p>Our systems play a central role right from when a potential client first signs up. Meetings with our consultants are scheduled, financial data is collected and a client's goals are captured. Our advice team use our tools to model and project a client's life into the future, adjusting the advised actions to best achieve the client's goals and presenting all this back to them in a way that is understandable and digestible.</p><p>The client then uses our app to make decisions and kick off tasks for our processing team that pulls the required information together in order to complete financial product applications. All along the way, relevant parties such as consultants, product providers and the clients themselves are kept up to date with progress.</p><p>Our system has frontends written in Clojurescript using reagent/re-frame with our backend spread across firebase and in-house web services written in Clojure and hosted on Heroku. We make use of third party services such as mailgun, sentry, logentries and auth0 to add their packaged functionality.</p><h1>The job you'll be doing</h1>\n<ul>\n<li>Write code with a core dev team including Shen and Dave (two of the founders)</li>\n<li>Help manage our various deployments and environments</li>\n<li>Learn and get involved in technology and design decisions</li>\n<li>Play a role in planning what it will take to implement the features on our backlog</li>\n</ul><h1>What we think you'll need</h1>\n<ul>\n<li>A strong software development background - a tertiary qualification such as a computer science degree or experience that has put you in a similar place</li>\n<li>Either experience in a functional language such as Clojure or experience in one of the major OO languages and an interest in functional programming</li>\n<li>A good general knowledge of web tech</li>\n<li>Ready for the challenge of a startup - we're developing the business and product as we go. There is lots of room to own decisions but don't expect everything to be well defined up front</li>\n</ul><h1>Additional Info</h1>\n<ul>\n<li>This is a permanent position in Cape Town</li>\n</ul></div></div>",
   :direction "ltr"},
  :updated 1570027612000,
  :entities
  [{:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "about",
    :label "Clojure"}
   {:mentions [{:text "South Africa"}],
    :id "nlp/f/entity/wd:258",
    :salienceLevel "mention",
    :label "South Africa"}
   {:mentions [{:text "Cape Town"}],
    :id "nlp/f/entity/wd:5465",
    :salienceLevel "mention",
    :label "Cape Town"}
   {:mentions
    [{:text "functional programming"} {:text "functional language"}],
    :id "nlp/f/entity/wd:193076",
    :salienceLevel "mention",
    :label "functional programming"}
   {:mentions [{:text "Johannesburg"}],
    :id "nlp/f/entity/wd:34647",
    :salienceLevel "mention",
    :label "Johannesburg"}],
  :alternate
  [{:href
    "https://jobs.braveclojure.com/jobs/17592186047106/junior-to-intermediate-clojure-clojurescript-developer-lifecheq",
    :type "text/html"}],
  :title "Junior to Intermediate Clojure/Clojurescript Developer",
  :author "Brave Clojure Jobs",
  :published-str "Wed Oct 02 07:46:52 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16d8d0326e7:4aa26ce:69b9f616",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://jobs.braveclojure.com/jobs/17592186047106/junior-to-intermediate-clojure-clojurescript-developer-lifecheq",
  :updateCount 1,
  :commonTopics
  [{:score 90.84637309035051,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1570027612000,
  :fingerprint "67be51d7",
  :canonicalUrl
  "https://jobs.braveclojure.com/jobs/17592186047106/junior-to-intermediate-clojure-clojurescript-developer-lifecheq"}
 {:engagement 5,
  :unread false,
  :crawled 1570028857063,
  :content
  {:content
   "<div><h1>Senior Clojure/Clojurescript Developer</h1><div>LifeCheq | South Africa</div><div>remote</div><div><em>Building a one-stop financial advice shop</em></div><div>$40000 - $85000</div><div><a href=\"http://www.lifecheq.co.za\">http://www.lifecheq.co.za</a></div><br><div><h1>Who we are</h1><p>LifeCheq is a service that helps you organise your finances to line up with your life goals. This starts with a clear plan that includes what investments you should make, what you can afford to spend on assets (such as property) and important expenses (such as education), and what insurance it makes sense for you to have at this stage of life.</p><p>Then, we help you put that plan into action. We'll fill in forms, chase up product providers, check that you aren't being given a bum deal on your insurance and keep track of what you should be doing. We'll also make sure that, as things change, we update our recommendations so you don't need to worry and can get on with living your life.</p><p>We're based in Cape Town, South Africa with operational branches opening in other major SA cities (Johannesburg so far).</p><h1>The systems we're building</h1><p>Our service is only made possible by applying the latest technology to the problem of how people plan and manage their financial lives.</p><p>We pick and integrate the best existing services for parts of the business which are done well by others and building up and deploy our own IP for the specific areas where it matters most.</p><p>Our systems play a central role right from when a potential client first signs up. Meetings with our consultants are scheduled, financial data is collected and a client's goals are captured. Our advice team use our tools to model and project a client's life into the future, adjusting the advised actions to best achieve the client's goals and presenting all this back to them in a way that is understandable and digestible.</p><p>The client then uses our app to make decisions and kick off tasks for our processing team that pulls the required information together in order to complete financial product applications. All along the way, relevant parties such as consultants, product providers and the clients themselves are kept up to date with progress.</p><p>Our system has frontends written in Clojurescript using reagent/re-frame with our backend spread across firebase and in-house web services written in Clojure and hosted on Heroku. We make use of third party services such as mailgun, sentry, logentries and auth0 to add their packaged functionality.</p><h1>The job you'll be doing</h1><p>We're looking for someone to play a senior role in the team developing this system. You'll </p>\n<ul>\n<li>Write code in the core dev team</li>\n<li>Manage our various deployments and environments</li>\n<li>Get involved in technology and design decisions</li>\n<li>Have responsibilities maintaining the features backlog</li>\n<li>Be part of training and mentoring more junior developers</li>\n</ul><h1>What we think you'll need</h1>\n<ul>\n<li><em>A solid software development background</em> - 5 years experience in software development</li>\n<li><em>Be able to get going with our technology choices</em> - good knowledge of clojure/clojurescript and web tech</li>\n<li><em>The experience to play a senior role in a team of developers as it grows</em> - know how to manage a team of developers and their work flow</li>\n<li><em>Ready for the challenge of a startup</em> - we're developing the business and product as we go. There is lots of room to own decisions but don't expect everything to be well defined up front</li>\n</ul><h1>Additional Info</h1><p>We would prefer someone in South Africa though will consider anyone who is able to work in our time-zone (UTC+2) </p></div></div>",
   :direction "ltr"},
  :updated 1570027499000,
  :entities
  [{:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "about",
    :label "Clojure"}
   {:mentions [{:text "South Africa"}],
    :id "nlp/f/entity/wd:258",
    :salienceLevel "mention",
    :label "South Africa"}
   {:mentions [{:text "Johannesburg"}],
    :id "nlp/f/entity/wd:34647",
    :salienceLevel "mention",
    :label "Johannesburg"}
   {:mentions [{:text "Cape Town"}],
    :id "nlp/f/entity/wd:5465",
    :salienceLevel "mention",
    :label "Cape Town"}
   {:mentions [{:text "well-defined"}],
    :id "nlp/f/entity/wd:371730",
    :salienceLevel "mention",
    :label "well-defined"}],
  :alternate
  [{:href
    "https://jobs.braveclojure.com/jobs/17592186047103/senior-clojure-clojurescript-developer-lifecheq",
    :type "text/html"}],
  :title "Senior Clojure/Clojurescript Developer",
  :author "Brave Clojure Jobs",
  :published-str "Wed Oct 02 07:44:59 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16d8d0326e7:4aa26cd:69b9f616",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://jobs.braveclojure.com/jobs/17592186047103/senior-clojure-clojurescript-developer-lifecheq",
  :commonTopics
  [{:score 73.7139530599986,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.915,
    :id "nlp/f/topic/1827",
    :salienceLevel "about",
    :label "product management"}
   {:score 0.8,
    :id "nlp/f/topic/52",
    :salienceLevel "mention",
    :label "agile"}
   {:score 0.753,
    :id "nlp/f/topic/2461",
    :salienceLevel "mention",
    :label "web design"}
   {:score 0.709,
    :id "nlp/f/topic/1833",
    :salienceLevel "mention",
    :label "project management"}],
  :published 1570027499000,
  :fingerprint "5a98d546",
  :canonicalUrl
  "https://jobs.braveclojure.com/jobs/17592186047103/senior-clojure-clojurescript-developer-lifecheq"}
 {:engagement 9,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/todo",
    :label "todo"}
   {:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1569976485577,
  :content
  {:content
   "In the first two blog posts of the blog series Building an E-Commerce Marketplace Middleware in Clojure, we learnt how to bootstrap a Clojure project using Mount &amp; Aero and how to configure database connection pooling &amp; database migration along with reloaded workflow. We are going to continue setting up the infrastructure, and in this blog post, we are going to take up logging using Timbre.\nTimbre is a Clojure/Script logging library that enables to configure logging using a simple Clojure map.",
   :direction "ltr"},
  :updated 1569975601000,
  :entities
  [{:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "about",
    :label "Clojure"}],
  :alternate
  [{:href
    "https://www.demystifyfp.com/clojure/marketplace-middleware/configuring-logging-using-timbre/",
    :type "text/html"}],
  :title "Configuring Logging Using Timbre",
  :author "Demystify FP",
  :published-str "Tue Oct 01 17:20:01 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16d89e406c9:4683f57:69b9f616",
  :visual {:url "none"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://www.demystifyfp.com/clojure/marketplace-middleware/configuring-logging-using-timbre/",
  :commonTopics
  [{:score 22.286123805249822,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1569975601000,
  :fingerprint "3063d5b2",
  :canonicalUrl
  "https://www.demystifyfp.com/clojure/marketplace-middleware/configuring-logging-using-timbre/"}
 {:engagement 28,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/todo",
    :label "todo"}
   {:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1569947482101,
  :content
  {:content
   "<div>Today's releases of <a href=\"https://docs.datomic.com/cloud/index.html\" title=\"https://docs.datomic.com/cloud/index.html\"><u>Datomic Cloud</u></a> and <a href=\"https://docs.datomic.com/on-prem/index.html\" title=\"https://docs.datomic.com/on-prem/index.html\"><u>Datomic On-Prem</u></a> preview a major new feature: analytics support.</div><div>With analytics support, your data scientists, analysts, and operations people can directly access Datomic using the languages and tools they already know (e.g. SQL, Python, R, Tableau, Metabase, Superset and more), without you having to do any ETL.</div><div>The analytics metaschema specifies a mapping from Datomic entities and attributes to dynamic SQL tables and columns, as shown in the example below:<a href=\"https://www.youtube.com/watch?v=jVKGYu0_OCA\"><img border=\"0\" src=\"https://1.bp.blogspot.com/-Ec0OoaOk1ss/XZNv6C9KuTI/AAAAAAAAAl0/kva0YdqvLQoT9DE1CP-59BiPG4HcS8x0ACLcBGAsYHQ/s1600/analyticsTables.png\"></a></div><div><span>In Cloud, the bastion server has been renamed to access gateway, as it now also supports analytics. Analytics support is automatic when you select an EC2 instance size that supports it, and costs nothing beyond the cost of the EC2 instance.</span></div><div><span>In On-Prem, analytics support is available via the </span><span>bin/presto</span><span> script in the distribution.</span></div><div>To learn more about the analytics preview:</div><div></div><ul><li><span>Watch <a href=\"https://www.youtube.com/watch?v=jVKGYu0_OCA\">the video</a>. </span></li><li><span>Read the </span><a href=\"https://docs.datomic.com/cloud/analytics/analytics-concepts.html\">Cloud docs</a><span>.</span></li><li>Read the <a href=\"https://docs.datomic.com/on-prem/analytics/analytics-concepts.html\">On-Prem docs</a><span>.</span></li></ul>",
   :direction "ltr"},
  :updated 1569944857000,
  :entities
  [{:mentions [{:text "analytics"}],
    :id "nlp/f/entity/wd:485396",
    :salienceLevel "about",
    :label "analytics"}
   {:mentions [{:text "SQL"}],
    :id "nlp/f/entity/wd:47607",
    :salienceLevel "mention",
    :label "Structured Query Language"}
   {:mentions [{:text "EC2"}],
    :id "nlp/f/entity/wd:407355",
    :salienceLevel "mention",
    :label "transferase"}
   {:mentions [{:text "ETL"}],
    :id "nlp/f/entity/wd:1276130",
    :salienceLevel "mention",
    :label "extract, transform, load"}],
  :alternate
  [{:href
    "https://blog.datomic.com/2019/10/datomic-analytics-preview.html",
    :type "text/html"}],
  :title "Datomic Analytics (Preview)",
  :author "Marshall Thompson",
  :published-str "Tue Oct 01 08:47:37 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16d882977f5:41b92db:ad5391a1",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url
   "https://1.bp.blogspot.com/-Ec0OoaOk1ss/XZNv6C9KuTI/AAAAAAAAAl0/kva0YdqvLQoT9DE1CP-59BiPG4HcS8x0ACLcBGAsYHQ/s1600/analyticsTables.png",
   :width 1600,
   :height 703,
   :contentType "image/png"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "tag:blogger.com,1999:blog-4845864749156394488.post-5442537344135922823",
  :commonTopics
  [{:score 15.031315974962727,
    :id "nlp/f/topic/3002",
    :salienceLevel "about",
    :label "data science"}
   {:score 0.915,
    :id "nlp/f/topic/253",
    :salienceLevel "about",
    :label "big data"}
   {:score 0.772,
    :id "nlp/f/topic/774",
    :salienceLevel "mention",
    :label "engineering"}],
  :published 1569944857000,
  :fingerprint "32faa0b2",
  :canonicalUrl
  "https://blog.datomic.com/2019/10/datomic-analytics-preview.html"}
 {:engagement 8,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1569873869690,
  :content
  {:content
   "<div><h1>Senior Software Engineer</h1><div>healthfinch | </div><div>remote</div><div><a href=\"https://www.healthfinch.com/careers#openings\">https://www.healthfinch.com/careers#openings</a></div><br><div><p>Job Purpose</p><p>A senior software engineer is responsible for maintaining and developing software and technical infrastructure to meet the company's requirements while maintaining a high standard of reliability and maintainability. This person should also be comfortable communicating with colleagues and customers to understand and refine those requirements.</p><p>Duties and Responsibilities</p>\n<ul>\n<li>Meet stakeholder requirements primarily using Clojure, AWS, and occasionally Ruby on Rails</li>\n<li>Teamwork, as part of an engineering pair (remotely), individually, and with product</li>\n<li>Communicate with stakeholders so that product planning can be informed by knowledge of technical possibilities, limitations, and tradeoffs</li>\n<li>Make and follow through on architectural and design decisions (during new development and when necessary to address technical debt in existing systems)</li>\n<li>Be able to explain, facilitate, and promote decisions among other engineers</li>\n<li>Write quality documentation for users and other engineers</li>\n<li>Participate in daily all-engineering standups</li>\n<li>Bias towards positive team dynamics</li>\n</ul><p>Working Conditions </p><p>This position requires on-call hours. </p><p>Travel: 5% - twice a year for team meetings.</p><p>We welcome people of different levels of experience and backgrounds. We know that people can come by the skills and talents we're looking for in many different ways, so if you're interested, let's talk! We'd like to hear your story. healthfinch is also committed to creating spectacular culture, along with phenomenal benefits. All full time employees are entitled to paid maternity/paternity leave, unlimited vacation and the ability to work anywhere in the United States.</p></div></div>",
   :direction "ltr"},
  :updated 1569872131000,
  :entities
  [{:mentions [{:text "software engineer"}],
    :id "nlp/f/entity/wd:5482740",
    :salienceLevel "about",
    :label "programmer"}
   {:mentions [{:text "the United States"}],
    :id "nlp/f/entity/wd:30",
    :salienceLevel "mention",
    :label "United States of America"}
   {:mentions [{:text "Ruby on Rails"}],
    :id "nlp/f/entity/wd:190478",
    :salienceLevel "mention",
    :label "Ruby on Rails"}
   {:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "technical debt"}],
    :id "nlp/f/entity/wd:1532172",
    :salienceLevel "mention",
    :label "technical debt"}],
  :alternate
  [{:href
    "https://jobs.braveclojure.com/jobs/17592186047095/senior-software-engineer-healthfinch",
    :type "text/html"}],
  :title "Senior Software Engineer",
  :author "Brave Clojure Jobs",
  :published-str "Mon Sep 30 12:35:31 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16d83c63b7a:3dea4d7:69b9f616",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://jobs.braveclojure.com/jobs/17592186047095/senior-software-engineer-healthfinch",
  :commonTopics
  [{:score 56.871730423026406,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.886,
    :id "nlp/f/topic/52",
    :salienceLevel "about",
    :label "agile"}
   {:score 0.837,
    :id "nlp/f/topic/1827",
    :salienceLevel "mention",
    :label "product management"}
   {:score 0.757,
    :id "nlp/f/topic/774",
    :salienceLevel "mention",
    :label "engineering"}],
  :published 1569872131000,
  :fingerprint "5374b74e",
  :canonicalUrl
  "https://jobs.braveclojure.com/jobs/17592186047095/senior-software-engineer-healthfinch"}
 {:engagement 8,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1569839763051,
  :content
  {:content
   "<div>\n<p><em>Issue 346 – September 30, 2019 · <a href=\"https://purelyfunctional.tv/newsletter-archives/\">Archives</a> · <a title=\"Thanks, Jeff!\" href=\"https://purelyfunctional.tv/newsletter/\">Subscribe</a></em></p>\n<h2>Clojure Tip 💡</h2>\n<p><em>just throw <code>ex-info</code></em></p>\n<p><em>Special thanks to Sean Corfield for this tip!</em></p>\n<p>Last week I recommended you explore the basic hierarchy in Java that starts with <code>Throwable</code> at the top. The JVM requires that anything you <code>throw</code> be an instance of <code>Throwable</code> (that means of type <code>Throwable</code> or any of its subclasses). It’s important to understand that hierarchy so you know what to <code>catch</code>. Java defines quite a lot of exceptions for different problems that could happen.</p>\n<p>However, in the Clojure world, this is generally seen as a mistake. The Java standard library enumerates all of these different problems, creating a class for each one. It then organizes them into a hierarchy, presumably for the convenience of being able to surgically <code>catch</code> large swaths of them with a single <code>catch</code> statement. But did they get the hierarchy right for your software? And anyway, what can you do with those nice errors Java throws for you?</p>\n<p>Let’s see.</p>\n<p>Would you expect a <a title href=\"https://docs.oracle.com/javase/7/docs/api/java/io/FileNotFoundException.html\"><code>FileNotFoundException</code></a> to have a method letting you know the path of the file that wasn’t found? I would. Does it have that method? No.</p>\n<p>Or what about <a title href=\"https://docs.oracle.com/javase/7/docs/api/java/awt/datatransfer/MimeTypeParseException.html\"><code>MimeTypeParseException</code></a>. Shouldn’t it tell you what MIME type it tried to parse? But it doesn’t.</p>\n<p>When you examine it, most exceptions don’t contain any information specific to the situation. Nothing to help you debug the problem (if it’s a bug) or fix the problem (if it’s an expected situation). In fact, the only difference between them is their classname. The exception hierarchy is a glorified, hierarchical enumeration.</p>\n<p>That’s one of the reasons we just use <a title href=\"http://clojuredocs.org/clojure.core/ex-info\"><code>ex-info</code></a> in Clojure. <code>ex-info</code> is a function that creates an <code>ExceptionInfo</code>. It’s a subclass of <code>RuntimeException</code> that has a message and data. The message is a human-readable string. And the data is whatever you want. I usually use a map. I throw information in there that I might want later. Sometimes, if I need to distinguish different exceptional situations, I’ll throw a piece of data in there I can dispatch on. Then you throw it. The examples on the <a title href=\"http://clojuredocs.org/clojure.core/ex-info\">clojuredocs page</a> are pretty good.</p>\n<p><code>ex-info</code> is a great example of how Clojure smoothes out some of the warts of its host.</p>\n<h2>Book discount 📖</h2>\n<p>I got a package in the mail last week. It was from Manning, my publisher. Guess what was in it?</p>\n<p>Eight of these puppies.</p>\n<p><img title=\"\" src=\"https://purelyfunctional.tv/wp-content/uploads/2019/09/t-shirt.jpg\"></p>\n<p><a title href=\"https://lispcast.com/gs\">Buy the book</a>. BTW: That 50% discount works on everything at Manning.com. Copy this: <strong>TSSIMPLICITY</strong>.</p>\n<p>If you take a selfie with me wearing it and post it to Twitter, Manning will send you a present!</p>\n<h2>Currently recording 🎥</h2>\n<p>Oy! My course <a title href=\"https://purelyfunctional.tv/courses/property-based-testing-with-test-check/\">Property-based Testing course</a> is tough. I have made much progress on the distributed systems testing lesson. But nothing published this week.</p>\n<p>Distributed systems testing is hard. You know it’s hard. That’s why we need special tools to do it. I have built a distributed system that you can use, complete with a server and a client. And now I’m testing it. I am successfully testing it. But I want to fully grok it before I record this episode to that you can learn the maximum from this lesson. There are lots of wrinkles and each needs to be addressed.</p>\n<p>I don’t want to oversimplify this subject. It’s hard and you deserve superpowers. Distributed systems are hard (impossible?) to test with example-based testing. But how do you ensure that a system is eventually consistent? How do you ensure that no data is lost when there are conflicts? Can you exercise a system to find the synchronization bugs?</p>\n<p>Yes. And we’re going to do it in this course.</p>\n<p>BTW: the only way to get <a title href=\"https://purelyfunctional.tv/courses/property-based-testing-with-test-check/\">the course</a> now is to <a title href=\"https://purelyfunctional.tv/register/\">get a membership</a>. Do it!</p>\n<h2>Brain skill 😎</h2>\n<p><em>feedback</em></p>\n<blockquote>\n<p>Work it harder, make it better Do it faster, makes us stronger More than ever, hour after hour Work is never over — <em>Daft Punk</em></p>\n</blockquote>\n<p>Programming is hard. There’s so much to learn. You’re learning the environment. You’re learning the language. You’re learning the development tools. You’re learning your codebase. And you’re learning your problem domain. There’s learning and unknown stuff all the time.</p>\n<p>One of the best things you can do to help you learn is to increase the frequency and information density of feedback. When I look back to the most stressful, more time-consuming debugging sessions, it’s always debugging with very little feedback. In those cases, I’ve got a long edit-compile-run cycle. I’ve got to run the code, click around, enter some text, before I can even get to the problematic part of the system. And then I’m getting tiny bits of information. Maybe the only piece of information I get is “the problem isn’t on line X”. Slow and sparse feedback is stressful.</p>\n<p>Spend time to optimize your workflow for speed of feedback. Work in smaller chunks—whatever size chunk is a slight challenge for your mind. Get lots of information—pretty-print data structures, do lots of println debugging. Get more information out of the system. Write code that exercises exactly the part you want. Do you want to run one line? Do it. One function? Do it. A whole flow? Do it. Remove human input from the process. You are only slowing the process down if you have to fill out fields and click around.</p>\n<p>Bottom line: harder, better, faster, stronger.</p>\n<h2>Clojure Challenge 🤔</h2>\n<h3>Last week’s challenge</h3>\n<p>The challenge in <a title href=\"https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-345-tip-know-your-exception-hierarchy/\">Issue 345</a> was to make a higher-order function that rate limits the given function using a token bucket.</p>\n<p>You can check out the submissions <a title href=\"https://gist.github.com/ericnormand/5b1c46aca15c8bb293540728d71f0da3\">here</a>.</p>\n<h3>This week’s challenge</h3>\n<p><em>exponential backoff</em></p>\n<p>Our computers have real limits. Limited memory. Limited threads. Limited computations per second. Etc. We often treat our systems like they have unlimited resources, which is fine, until they get overloaded with work.</p>\n<p>Two weeks ago, we wrote a higher order function to retry a function three times if it failed. However, if a function fails because the system is overloaded, trying again immediately is not going to help anything. In fact, it could make it worse.</p>\n<p>A better response would be to wait a time before trying again. If it still fails, double the time and try again. Then double again, etc, until a limit is reached. This is known as exponential backoff.</p>\n<p>Your job this week is to implement exponential backoff. Extra credit if you can tell it how long to wait before ultimately giving up.</p>\n<p>As usual, please send me your implementations. I’ll share them all in next week’s issue. If you send me one, but you don’t want me to share it publicly, please let me know.</p>\n<p>Rock on!<br>Eric Normand</p>\n</div>\n<p>The post <a rel=\"nofollow\" href=\"https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-346-tip-just-throw-ex-info/\">PurelyFunctional.tv Newsletter 346: Tip: just throw ex-info</a> appeared first on <a rel=\"nofollow\" href=\"https://purelyfunctional.tv\">PurelyFunctional.tv</a>.</p>",
   :direction "ltr"},
  :updated 1569837600000,
  :entities
  [{:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "Java"}],
    :id "nlp/f/entity/wd:251",
    :salienceLevel "mention",
    :label "Java"}
   {:mentions [{:text "standard library"}],
    :id "nlp/f/entity/wd:1199356",
    :salienceLevel "mention",
    :label "standard library"}
   {:mentions [{:text "BTW"}],
    :id "nlp/f/entity/wd:2265578",
    :salienceLevel "mention",
    :label "Batu Licin Airport"}
   {:mentions [{:text "MIME type"}],
    :id "nlp/f/entity/wd:1667978",
    :salienceLevel "mention",
    :label "media type"}],
  :alternate
  [{:href
    "https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-346-tip-just-throw-ex-info/",
    :type "text/html"}],
  :title "PurelyFunctional.tv Newsletter 346: Tip: just throw ex-info",
  :author "Eric Normand",
  :published-str "Mon Sep 30 03:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16d81bdce6b:3abc974:69b9f616",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url
   "https://purelyfunctional.tv/wp-content/uploads/2019/09/t-shirt.jpg",
   :width 1200,
   :height 810,
   :contentType "image/jpeg"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://purelyfunctional.tv/?p=32087",
  :commonTopics
  [{:score 85.7105849746079,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.99,
    :id "nlp/f/topic/2010",
    :salienceLevel "about",
    :label "scalability"}
   {:score 0.841,
    :id "nlp/f/topic/294",
    :salienceLevel "mention",
    :label "bodybuilding"}
   {:score 0.801,
    :id "nlp/f/topic/874",
    :salienceLevel "mention",
    :label "fitness"}
   {:score 0.739,
    :id "nlp/f/topic/575",
    :salienceLevel "mention",
    :label "crm"}
   {:score 0.6590874047397003,
    :id "nlp/f/topic/10100",
    :salienceLevel "about",
    :label "digest"}],
  :published 1569837600000,
  :fingerprint "883b4f2d",
  :canonicalUrl
  "https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-346-tip-just-throw-ex-info/"}
 {:engagement 8,
  :unread false,
  :crawled 1569835849885,
  :recrawled 1569848098853,
  :content
  {:content
   "<div>\n<div>\n<div>\n<p>As <a href=\"https://clojutre.org/2019\">ClojuTRE 2019</a> comes to a close, I am left with many different feelings - from joy and excitement to inspiration and massive appreciation. I think everyone that attended would agree with me when I say that this is one of the best conferences. I’d like to say a massive thank you to <a href=\"https://www.metosin.fi/en/\">Metosin</a>, the numerous other sponsors and to all the amazing speakers for putting the time and effort into making this conference such a success.</p>\n</div>\n<div>\n<p>There were too many great talks to mention them all so I would like to highlight a few that I personally enjoyed a lot. Be sure to check out all the videos though when they are released over the coming week or two. There were also a lot of tweets so check out <a href=\"https://twitter.com/clojuTRE\">@clojuTRE</a> and the <a href=\"https://twitter.com/search?q=%23clojutre2019\">#clojutre2019</a> hashtag.</p>\n</div>\n<div>\n<table>\n<tbody><tr>\n<td>\n<i title=\"Note\"></i>\n</td>\n<td>\nEdit: <a href=\"https://www.youtube.com/playlist?list=PLetHPRQvX4a-c3KDRTxxwGRmEMutL8Apf\">The videos from ClojuTRE 2019 are up on YouTube now</a>\n</td>\n</tr>\n</tbody></table>\n</div>\n</div>\n</div>\n<div>\n<h2><a href=\"https://juxt.pro/blog/rss.xml?category=clojure&since=2016-03-13#_day_1\"></a>Day 1</h2>\n<div>\n<div>\n<p>The first day started off with the FP track. Fabrizio Ferrai (<a href=\"https://twitter.com/fabferrai\">@fabferrai</a>) kicked things off with a talk on building and maintaining a package manager. His talk was a graceful blend of humour and insightful / painful lessons learned along the way. If you have some free time and you’re looking for a talk that will make you laugh and hopefully learn something about package management and why not to roll your own, then this is a great session to watch.</p>\n</div>\n<div>\n<div>\n<img alt=\"Fabrizio Ferrai talking about package managers\" src=\"https://juxt.pro/img/clojutre-2019/fabferrai.jpg\">\n</div>\n<div>Figure 1: Fabrizio Ferrai talking about package managers</div>\n</div>\n<div>\n<p><a href=\"https://twitter.com/nirrubinstein\">Nir Rubinstein</a> from AppsFlyer chatted about the philosophy of language. I’ve always enjoy philosophy and studied language and literature so this talk resonated a lot with me. A large focal point of Nir’s talk were the seven principles outlined in <strong>Tractatus Logico-Philosophicus</strong>, a book by <a href=\"https://en.wikipedia.org/wiki/Ludwig_Wittgenstein\">Ludwig Wittgenstein</a>. If you like philosophy or the study of language or mathematics then you will enjoy this talk.</p>\n</div>\n<div>\n<div>\n<img alt=\"Nir Rubinstein talking about the philosophy of language\" src=\"https://juxt.pro/img/clojutre-2019/nir-rubinstein.jpg\">\n</div>\n<div>Figure 2: Nir Rubinstein talking about the philosophy of language</div>\n</div>\n<div>\n<p><a href=\"https://twitter.com/daslu_\">Daniel Slutsky</a> has been working with the various maintainers of data science related Clojure libraries (go checkout <a href=\"https://github.com/scicloj\">scicloj</a>). I’ve been silently following along over the past year as they have worked to bring Clojure and R closer together to improve the data science story for Clojure. Daniel spoke about some of these efforts and showed a few examples of calling R from Clojure and vice versa. If you’re into data science, then definitely watch this talk when the videos are out.</p>\n</div>\n<div>\n<div>\n<img alt=\"Daniel Slutsky talking about Clojure and R love\" src=\"https://juxt.pro/img/clojutre-2019/daniel-slutsky.jpg\">\n</div>\n<div>Figure 3: Daniel Slutsky on Clojure and R ❤️</div>\n</div>\n<div>\n<p>Next up was an amazing talk on Computer Mathematics, AI and Functional Programming by <a href=\"https://twitter.com/BaraMoa\">Moa Johansson</a>. Moa knows an incredible amount about the history in this domain, from the 1950’s through to the present day. She did a great job of highlighting the excitement and anticipation of the great minds of the 1960’s and how many of their predictions about computer programmes have come to pass (even though slightly later than originally anticipated). The talk included a demo of a programme discovering/solving mathematical proofs. A delightful talk worth watching.</p>\n</div>\n<div>\n<div>\n<img alt=\"Moa Johansson talking about computer mathematics\" width=\"AI and functional programming\" src=\"https://juxt.pro/img/clojutre-2019/moa-johansson.jpg\">\n</div>\n<div>Figure 4: Moa Johansson talking about computer mathematics, AI and functional programming</div>\n</div>\n<div>\n<p><a href=\"https://twitter.com/rtfeldman\">Richard Feldman</a> gave an entertaining talk entitled &quot;Why Isn’t Functional Programming the Norm?&quot; which centred around the evolution of mainstream programming languages which happen to be OO, but the reasons that he deduces for this are not quite what you’d expect. A fun and educational talk that goes into great depth about the history of programming languages.</p>\n</div>\n<div>\n<div>\n<img alt=\"Richard Feldman delving into why FP is not the norm\" src=\"https://juxt.pro/img/clojutre-2019/richard-feldman.jpg\">\n</div>\n<div>Figure 5: Richard Feldman delving into why FP isn’t the norm</div>\n</div>\n<div>\n<p><a href=\"https://twitter.com/isfotis\">Fotis Papadogeorgopoulos</a> gave a talk on keeping websites accessible. This is definitely an area where many developers could put in that little bit of extra attention that would result in a better world for people that rely on assistive technologies such as screen readers. If you’d like to make their lives a little better, this talk is a great place to start and has many links to resources that can help.</p>\n</div>\n<div>\n<p><a href=\"https://twitter.com/whatyouhide\">Andrea Leopardi</a> is one of the core maintainers of <a href=\"https://elixir-lang.org/\">Elixir</a> and gave a light hearted tour of the language and it’s features and about how decisions are made around the maintenance of the language and its evolution over time.</p>\n</div>\n<div>\n<p>The after-parties were great fun and we were lucky enough to go to the speakers after-party at <a href=\"https://www.nitor.com/en\">Nitor</a>'s offices. They were great hosts. Thank you all very much for having us there.</p>\n</div>\n<div>\n<div>\n<img alt=\"baltic sea\" src=\"https://juxt.pro/img/clojutre-2019/baltic-sea.jpg\">\n</div>\n</div>\n</div>\n</div>\n<div>\n<h2><a href=\"https://juxt.pro/blog/rss.xml?category=clojure&since=2016-03-13#_day_2\"></a>Day 2</h2>\n<div>\n<div>\n<p>Day 2 started with a <a href=\"https://juxt.pro/crux\">Crux</a> tutorial session where <a href=\"https://twitter.com/JohannaAntone10\">Johanna Antonelli</a> helped attendees find and get started with the <a href=\"https://juxt.pro/crux/tutorial\">Crux tutorials</a>, in particular the space adventure tutorial, <a href=\"https://juxt.pro/blog/posts/crux-tutorial-setup.html\">A Tale of Time and Space</a>. It was good to see so many people attend the session and we hope that they enjoy working through the series and become more familiar with using Crux.</p>\n</div>\n<div>\n<div>\n<img alt=\"Johanna Antonelli running the Crux tutorial session\" src=\"https://juxt.pro/img/clojutre-2019/crux-session.jpg\">\n</div>\n<div>Figure 6: Johanna Antonelli running the Crux tutorial session</div>\n</div>\n<div>\n<p><a href=\"https://twitter.com/borkdude\">Michiel Borkent</a> showed the off some of the cool features of <a href=\"https://github.com/borkdude/clj-kondo\">clj-kondo</a>, &quot;a linter that sparks joy&quot;. If you’ve ever watched Marie Kondo, you’ll understand where the inspiration for the project name comes from. <a href=\"https://speakerdeck.com/borkdude/clj-kondo-a-linter-for-clojure-code-that-sparks-joy-at-clojutre-2019\">You can see Michiel’s talk slides of the presentation here</a> and I would highly recommend trying clj-kondo out and watching the video of his talk once it’s published online.</p>\n</div>\n<div>\n<div>\n<img alt=\"Michiel Borkent chatting about Clojure linters\" src=\"https://juxt.pro/img/clojutre-2019/michiel-borkent.jpg\">\n</div>\n<div>Figure 7: Michiel Borkent chatting about Clojure linters</div>\n</div>\n<div>\n<p><a href=\"https://twitter.com/ikitommi\">Tommi Reiman</a>, the co-founder of Metosin, gave an interesting talk on strategies for analysing the performance of Clojure code using tools like flame graphs and shared some handy tips on ways to significantly improve the speed of your code. I highly recommend watching the video when it comes out. Metosin were also handing out some cool stickers, including the snow people captured in the image below. <a href=\"https://www.slideshare.net/metosin/naked-performance-with-clojure\">You can see the slides from Tommi’s talk here</a>.</p>\n</div>\n<div>\n<div>\n<img alt=\"Tommi Reiman chatting about performant Clojure\" src=\"https://juxt.pro/img/clojutre-2019/tommi-reiman.jpg\">\n</div>\n<div>Figure 8: Tommi Reiman chatting about performant Clojure</div>\n</div>\n<div>\n<p><a href=\"https://twitter.com/jackrusher\">Jack Rusher</a> was inspiring the creative side of the audience with his various designs and ideas about the creative mind. The presentation was a good mix of light hearted humour and funky visuals. I was so captivated that I forgot to capture any video of his generated animations (which were pretty awesome).</p>\n</div>\n<div>\n<div>\n<img alt=\"Jack Rusher displaying the results of creative computation\" src=\"https://juxt.pro/img/clojutre-2019/jack-rusher.jpg\">\n</div>\n<div>Figure 9: Jack Rusher displaying the results of creative computation</div>\n</div>\n<div>\n<p><a href=\"https://twitter.com/snowded\">Dave Snowden</a>'s talk on dealing with unanticipated need was probably the highlight of the conference for me. The content of the talk was very thought provoking. I couldn’t do it justice trying to summarise it. If you watch only one video from ClojuTRE 2019, this should definitely be it.</p>\n</div>\n<div>\n<div>\n<img alt=\"Dave Snowden talking about unanticipated need\" src=\"https://juxt.pro/img/clojutre-2019/dave-snowden.jpg\">\n</div>\n<div>Figure 10: Dave Snowden talking about unanticipated need</div>\n</div>\n<div>\n<p><a href=\"https://github.com/hraberg\">Håkan Råberg</a> is a still mind that is lightning sharp and full of knowledge. He spoke about the internals and design decisions around <a href=\"https://juxt.pro/crux/index.html\">Crux</a> and clearly had a solid understanding about it as he spoke at great speed to cover the breadth of information he was trying to share with the audience. Being a JUXT employee, I am obviously a bit biased towards this talk, but I think it’s fair to say that this is a talk worth watching. You can read <a href=\"https://juxt.pro/hakan-raberg-the-design-and-implementation-of-a-bitemporal-dbms.pdf\">the slides from Håkan’s talk here</a>.</p>\n</div>\n<div>\n<div>\n<img alt=\"Håkan Råberg talking about the internals of Crux\" src=\"https://juxt.pro/img/clojutre-2019/hakan-raberg.jpg\">\n</div>\n<div>Figure 11: Håkan Råberg talking about the internals of Crux</div>\n</div>\n<div>\n<p>Finishing off the conference was <a href=\"https://twitter.com/puredanger\">Alex Miller</a> from <a href=\"https://www.cognitect.com/\">Cognitect</a>. It was a delight to finally watch one of the Cognitect team give a talk in person. Alex started off talking about his path as a programmer, from childhood through to his interview process with Cognitect. Another light hearted talk with some good insights that were funny (because they were true). He also chatted about some of the processes that he and Rich Hickey use to plan and communicate with each other and about spec and some of the nice features coming to version 2. Another talk that is well worth the watch.</p>\n</div>\n<div>\n<div>\n<img alt=\"Alex Miller sharing lessons learned from a lifetime of programming\" src=\"https://juxt.pro/img/clojutre-2019/alex-miller.jpg\">\n</div>\n<div>Figure 12: Alex Miller sharing lessons learned from a lifetime of programming</div>\n</div>\n<div>\n<p>Once again, the after-party at <a href=\"https://gofore.com/en/home/\">Gofore</a>'s office was great fun. I’m sure everyone that attended would like to say thank you.</p>\n</div>\n</div>\n</div>\n<div>\n<h2><a href=\"https://juxt.pro/blog/rss.xml?category=clojure&since=2016-03-13#_extras\"></a>Extras</h2>\n<div>\n<div>\n<p>The main hall was filled with sponsor stands that included interesting games (like air ping pong) and various competitions to enter. Some examples include Solita, who had a code challenge where attendees could find three digit codes on their website, as well as code cracking challenges to find codes and win various prizes, and JUXT, who had a mystery word challenge to win flights, accommodation and a ticket to next year’s <a href=\"https://xt20.tech/\">XT20 conference</a> in London.</p>\n</div>\n<div>\n<div>\n<img alt=\"JUXT setting up in the hall\" src=\"https://juxt.pro/img/clojutre-2019/clojutre-juxt.jpg\">\n</div>\n<div>Figure 13: JUXT setting up in the hall</div>\n</div>\n<div>\n<p>You may also be wondering who the nun is on the stage screen photo. She is <a href=\"https://en.wikipedia.org/wiki/Mary_Kenneth_Keller\">Mary Kenneth Keller</a>, one of the first two people to earn a doctorate in computer science in the United States.</p>\n</div>\n</div>\n</div>\n<div>\n<h2><a href=\"https://juxt.pro/blog/rss.xml?category=clojure&since=2016-03-13#_a_massive_thank_you\"></a>A massive thank you</h2>\n<div>\n<div>\n<p>This has been an amazing two days and I have met so many great people, reconnected with old friends and made new ones. I hope that I have the privilege of coming to ClojuTRE 2020 and beyond. Thank you again to Metosin and all the sponsors and speakers for making this such a memorable experience. I’d also like to say an extra special thank you to the people behind the scenes that do so much to arrange everything, from organising the venue to the flights and accommodation and everything else in between. Events like this wouldn’t be possible without your help.</p>\n</div>\n<div>\n<div>\n<img alt=\"signing off laptop\" src=\"https://juxt.pro/img/clojutre-2019/signing-off-laptop.jpg\">\n</div>\n<div>Signing off until next time</div>\n</div>\n</div>\n</div>",
   :direction "ltr"},
  :updated 1569830400000,
  :entities
  [{:mentions [{:text "Figure 8"}],
    :id "nlp/f/entity/wd:2141382",
    :salienceLevel "mention",
    :label "Figure eight"}
   {:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "data science"}],
    :id "nlp/f/entity/wd:2374463",
    :salienceLevel "mention",
    :label "data science"}
   {:mentions [{:text "functional programming"}],
    :id "nlp/f/entity/wd:193076",
    :salienceLevel "mention",
    :label "functional programming"}
   {:mentions [{:text "Crux"}],
    :id "nlp/f/entity/wd:10542",
    :salienceLevel "mention",
    :label "Crux"}],
  :alternate
  [{:href "https://juxt.pro/blog/posts/clojutre-2019.html",
    :type "text/html"}],
  :title "ClojuTRE 2019",
  :author "The JUXT Blog",
  :published-str "Mon Sep 30 01:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16d8182189d:397cd0d:97b0c8f7",
  :visual {:url "none"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://juxt.pro/blog/posts/clojutre-2019.html",
  :updateCount 1,
  :commonTopics
  [{:score 68.2557292751581,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 19.513694339796764,
    :id "nlp/f/topic/3032",
    :salienceLevel "about",
    :label "astronomy"}],
  :published 1569830400000,
  :fingerprint "7fae557d",
  :canonicalUrl "https://juxt.pro/blog/posts/clojutre-2019.html"}
 {:engagement 4,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1569824957969,
  :content
  {:content
   "<p>Nil punning does give power to Lispers. But where does the power come from? Is it that nil really is a great value? Or is it more about the design choices made? In this episode, we explore this question.</p>\n<p></p>\n<p></p>\n<h2>Transcript</h2>\n<p>Eric Normand: Where does the power of nil-punning come from? In this episode, we’re going to explore the power of nil-punning that we went through in the last episode. I’m going to give my recommendations for how to make the best use of nil-punning.</p>\n<p>My name is Eric Normand, and I help people thrive with functional programming. This episode is going to be like the last one, very focused on Clojure and Lisp, in general.</p>\n<p>I think it’s still a good talk about like programming language semantics and I hope you learn something even if you’re not into Clojure. We’re going to touch on JavaScript and Haskell as well.</p>\n<p>In the last episode, I talked about what nil-punning, why it’s in Clojure and Lisp, its origins, and why we like it. In this one, I want to talk about something that I’ve…It just slipped my mind at the end of the episode that I wanted to come back to, and now I’m coming back to it.</p>\n<p>That is, where does the power come from? Is nil-punning by itself a powerful idea? I don’t think it is. Before we get into that, what is nil-punning? Nil-punning is simply that nil has different meanings in different contexts. You can do a pun where you are using a value that could be nil in all these different contexts, and relying on the different meanings in those contexts.</p>\n<p>For example, nil means false in a Boolean context. It’s not equal to false, but it means false. If you have an if statement or an if expression, if you have a nil for your test, then it will use the else branch, just like a false would. What that means is if you get a return value from a function, you can say, “Did I get a value?” Nil represents no value. “Did I get a value?”</p>\n<p>Everything will be truth-y in that context, except nil and false. If you’re not expecting a Boolean, you can play with that, that difference of context. Whereas here it means no value, but here it means false. That’s nil-punning.</p>\n<p>That in itself, the fact that it has different meanings and different context, is not that interesting. It doesn’t give you a ton of power. What does give you the power is that every time — Let’s imagine you’re designing this language — Every time you make a new context, in the semantics of your language, you have a decision to make. What does nil act like in this context?</p>\n<p>You can make a good decision, meaning one that’s aligned with design goals of your language. You can make a bad decision, meaning it’s inconsistent design goals, and it makes the language wordy, it makes it harder to use. That’s where the power comes from. It comes from all these decisions. Did you make a good decision here?</p>\n<p>I would argue that in Clojure, a lot of the decisions were good, enough where it feels very nice to use nil-punning. Enough of a decision, not all of them, but enough. There are a lot of places where it causes problems. For instance, one of those is — I don’t know if you’d call this nil-punning, but it has the same effect, same consequences. If you call the keyword function…Here, I’m going to do this right now at a REPL — If you call the keyword function with nil, it returns nil. What’s happening?</p>\n<p>Keyword, basically, it takes a string, and it returns a keyword with that string. Keyword is just a wrapped up string. If you give it something that’s not a string, or isn’t easily turned into a string, like a symbol, what does it even mean to call keyword on it? If you pass in a number, a Boolean, or a list, what does it mean to call keyword on this? It doesn’t have a meaning.</p>\n<p>What happens in Clojure is nil is returned. If you pass in a nil, same thing, nil is returned. It is just about how keyword is implemented, and the Clojure’s design decision not to check arguments.</p>\n<p>A lot of dynamically type languages, one thing they do is they check the arguments as they come into a function. They say, “Is this a string?” No. Throw an exception. Clojure doesn’t do that. It lets the expression…It’s like, “Is it a string? Is it a symbol? Is it another keyword?” then nothing else.</p>\n<p>The defaults for the nothing else case is returned nil. It falls off the can’t and a nil comes out of the function. It’s not even like a designed thing, but it does have the same effect, which is that, in the keyword context, nil gives you no keyword which is represented as a nil.</p>\n<p>Nil that comes in, that comes in some random place gets passed through a keyword, doesn’t throw an exception, it comes right out, goes to some other function, gets called there. At some point, it’s going to cause a problem, but you don’t know where the nil came from because it flowed right through that keyword function.</p>\n<p>You would expect it to blow up or something. Some languages, it would. This is one of those problems, where I assert that it is a nil-punning or whatever you want to call this thing that a keyword does. It’s the wrong decision. In general, like I said, I think Clojure did a really good job.</p>\n<p>Rich Hickey did a really good job of designing what nil means in each context so that most of the time, you feel like nil-punning is a good thing. Now I want to talk about my recommendations for nil. It’s just one overarching big recommendation because when you’re coding, you’re building out a domain model.</p>\n<p>You’re building out systems. You’re making all these contexts. You’re making new contexts, and you have to decide what every kind of value means in that context. Sometimes nil makes perfect sense in the context. Usually it’s like a low level context. Nil is a low-level value.</p>\n<p>It has no meaning except, “I don’t have a value for you.” It’s a pointer that points to nothing. You have this nil. Sometimes that makes sense in your context like, “I don’t know what to do,” or “I do know what to do with a…like if it’s an empty collection.” Yes.</p>\n<p>If you’re talking about a collection context, nil being an empty collection, that makes a lot of sense, but it doesn’t always make sense.</p>\n<p>My recommendation is, one, if it doesn’t make sense to give it a meaning, don’t give it a meaning or give it an error exceptional meaning where it throws an exception so that that nil doesn’t get bubbled through. Don’t try to be too clever and say, “Nil means this, so I’m going to use it like that.” No. Do not do that.</p>\n<p>Make it clear that nil is too little…It doesn’t have enough meaning attached to it to be useful in this scenario. Check and throw an exception. Don’t let it through. You’re not writing the low-level Clojure code. You can make different design decisions for your application.</p>\n<p>The second part of that is, what do you do? When you have something that is like no answer or whatever, I say use an explicit value. Don’t use nil to represent, “I didn’t get an answer from the server.” Use a keyword or some other thing that’s not nil, that encodes meaning because as soon as you say, “I didn’t get an answer from the server,” meaning there was a time out when I made the request. “I didn’t get an answer. The server was down. I didn’t get an answer from the server.”</p>\n<p>It’s a meaningful answer because as soon as you do that, you’re going to then say, “What if we do get an answer from the server?” but the answer is, “I don’t know the answer to that question.” You got the response, and the server said, “Don’t know.” That could happen, too. You need to encode that in some other way.</p>\n<p>Too often, we overload nil because it’s usually convenient, and it seems to make sense. When you look at each one in isolation, if there’s a time out, of course, no answer, so nil. If the server says, “nil,” then, yeah of course, nil.</p>\n<p>When you put them together, you’ve lost information because very often in the domain, you’re working in a positive answer from the server that says, “I don’t have an answer,” is very different from, “I couldn’t even reach the server. I don’t know what the server will say.” That’s different. That’s a question mark.</p>\n<p>Where’s the other one is a positive not no. You might want to encode that in your domain. In fact, you probably do want to encode that in your domain. This is very much like the null object pattern in object-oriented programming.</p>\n<p>Null object would be to instead of using a null, you make a new class that implements the same interfaces that represents no person. The classic example is, you need to display employee information on a screen.</p>\n<p>Someone types in…They have a box, they can type in the ID, and then boom, it shows the employee information for that employee ID. What do you do if they type in the ID, and there is no employee to show? You return null.</p>\n<p>Now everywhere, you have to check is it no? Yes? Then print this string in the first name box like, “No person” or whatever even empty string, but you have to have in if else everywhere to check if it’s no, put this string. Otherwise, call the first name method on the object, and then put that there.</p>\n<p>You have this if statement that’s like everywhere, and it’s the same check. This is no. This is no. This is no. What they recommend is make an object that represents, “No person found.” All the responses to the methods are indicative of that. First name would be like NA. Last name, NA. Salary, zero or whatever it makes sense for your UI.</p>\n<p>You make that thing. You don’t have all the checks in your UI. You can just display whatever the answer is. You just call the method in. It never returns a null, so you’re good. It’s also similar to something that happens in Haskell. For very local things, sure, use some maybe number, it’s fine.</p>\n<p>At some point, you’re going to want to encode more meaning than nothing can encode because you have just the number or nothing, and nothing isn’t meaningful enough. It just means, “I don’t have a number.” You make a new type, and it has the number, in those cases when you have the number.</p>\n<p>It has other constructors that indicate some other meaningful information, like same example I had before. You couldn’t get in touch with the server versus the server answered that it doesn’t have any answer. Those are two different cases and you might want to incorporate them into your domain instead of collapsing everything to the meaningless, no.</p>\n<p>That’s my recommendation is, use nil only if it really truly makes sense. Otherwise, you’ll want a more meaningful value. If it doesn’t make sense, check it as soon as it doesn’t make sense and throw. Just don’t let it in. Don’t let the nil in, and then use these other values, could be a keyword.</p>\n<p>It’s Clojure, you’re pretty flexible with what you use, but something with more meaning like a keyword because it’s a string. You can read it.</p>\n<p>We talked about the power of nil-punning. It comes from the good design decisions. If you don’t have good design decisions, nil-punning can be way worse.</p>\n<p>In fact, we see that in JavaScript where null is equal to zero, and it’s equal to false. It’s just a mess. Instead of saying nil is its own value, that is not equal to false, but in a Boolean context, we’re going to treat it the same as we treat false. JavaScript equates them. It just causes trouble everywhere.</p>\n<p>They’re not the same. They’re different values that happen in this context to have the same meaning. It’s a very different thing. JavaScript got that wrong. We all recognize that. That’s why everyone recommends using the triple equals because that double equals does this like cross-type equality, which is just weird and causes a lot of trouble.</p>\n<p>If you like this episode, please listen to the last one which was about nil-punning. I go deeper into that. You can go to lispcast.com/podcast. Find links to all the old episodes including audio, video, and text transcripts of all of them. You’ll also find links to subscribe. You can subscribe to any of those three media types.</p>\n<p>Also, you can find me on social media so there’ll be links to my Twitter, my email, also LinkedIn. Please get in touch with me. I’d love to hear your horror stories with nil-punning in Clojure or your success stories, if you have some of those. This has been my thought on Functional Programming.</p>\n<p>My name is Eric Normand. Thank you for listening, and as always, rock on.</p>\n<p>The post <a rel=\"nofollow\" href=\"https://lispcast.com/power-of-nil-punning/\">Where does the power of nil punning come from?</a> appeared first on <a rel=\"nofollow\" href=\"https://lispcast.com\">LispCast</a>.</p>",
   :direction "ltr"},
  :updated 1569823200000,
  :entities
  [{:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "about",
    :label "Clojure"}
   {:mentions [{:text "JavaScript"}],
    :id "nlp/f/entity/wd:2005",
    :salienceLevel "mention",
    :label "JavaScript"}
   {:mentions [{:text "Boolean"}],
    :id "nlp/f/entity/wd:520777",
    :salienceLevel "mention",
    :label "Boolean data type"}
   {:mentions [{:text "functional programming"}],
    :id "nlp/f/entity/wd:193076",
    :salienceLevel "mention",
    :label "functional programming"}
   {:mentions [{:text "Haskell"}],
    :id "nlp/f/entity/wd:34010",
    :salienceLevel "mention",
    :label "Haskell"}],
  :alternate
  [{:href "https://lispcast.com/power-of-nil-punning/",
    :type "text/html"}],
  :title "Where does the power of nil punning come from?",
  :author "Eric Normand",
  :published-str "Sun Sep 29 23:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16d80dbe611:398f1df:69b9f616",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url
   "https://lispcast.com/wp-content/uploads/2019/09/Where-does-the-power-of-nil-punning-come-from_.jpg",
   :width 1280,
   :height 720,
   :contentType "image/jpeg"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://lispcast.com/?p=2038",
  :commonTopics
  [{:score 61.94765594700415,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.937,
    :id "nlp/f/topic/501",
    :salienceLevel "about",
    :label "college"}],
  :published 1569823200000,
  :fingerprint "5cb731df",
  :canonicalUrl "https://lispcast.com/power-of-nil-punning/"}
 {:engagement 4,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1569808421430,
  :content
  {:content
   "<p>About two years ago I built a small ClojureScript app that looks like this:</p>\n<p><span>\n<span></span>\n<img alt=\"calendar app\" title=\"calendar app\" src=\"https://betweentwoparens.com/static/1833410f254a47f59c4448d4a3e5a8a3/b9e4f/004-01-calendar-app-intro.png\">\n</span></p>\n<aside>The source code can be found <a rel=\"noopener noreferrer\" href=\"https://github.com/tkjone/demo-reloadable-code\">here</a>.</aside>\n<p>This app was meant to be a bite sized learning project to level up my ClojureScript interop skills.</p>\n<p>Aside from being gorgeoous, it had only two things to do:</p>\n<ul>\n<li>User presses the <code>Add</code> button and <code>1</code> new <code>Calendar Event</code> is created</li>\n<li>User can see a <code>List</code> of <code>Calendar Events</code></li>\n</ul>\n<p>I started the app <a href=\"http://betweentwoparens.com/start-a-clojurescript-app-from-scratch\">as I always do</a> which includes running <code>figwheel</code> and <code>Hot Module Reloading</code> (HMR). As I'm jamming away on the code I started to notice some interesting behaviour.</p>\n<p>When I pressed the <code>Add</code> button, instead of <code>1</code> new <code>Calendar Event</code> being added, <code>5</code> were added! I paused for a moment before hard refreshing the browser. Then I clicked the <code>Add</code> button again. Unlike the first time, everything worked as expected; only <code>1</code> new <code>Calendar Event</code> was added. I smiled to myself and marvelled at my incredible detective skills: obviously the problem was <code>HMR</code>.</p>\n<p>Since I <em>obviously</em> identified the source of the problem I decided to resolve the issue by ignoring it. So any time I made a change which triggered an <code>HMR</code> reload I would hard refresh the browser like a savage<a href=\"https://betweentwoparens.com/rss.xml#full-savage\">.</a></p>\n<p>Some time later I realized that, no, the problem was not <code>HMR</code>...it was <em>my</em> code. As it turns out, <code>HMR</code> isn't free. It requires the code author to design and build the code to be <a href=\"https://figwheel.org/docs/reloadable_code.html\">reloadable code</a>.</p>\n<p>So in the intrepid spirit of craftsmanship, I have resurected my Calendar App and refactored it into <code>reloadable code</code>. What follows is the process one could take to achieve <code>reloadable code</code>:</p>\n<ul>\n<li><a href=\"https://betweentwoparens.com/rss.xml#intro-to-hmr\">Intro to Hot Module Reloading</a></li>\n<li><a href=\"https://betweentwoparens.com/rss.xml#submit-event-listeners\">&quot;Submit&quot; event listeners</a></li>\n<li><a href=\"https://betweentwoparens.com/rss.xml#change-event-listeners\">&quot;Change&quot; event listeners</a></li>\n<li><a href=\"https://betweentwoparens.com/rss.xml#populating-dropdown-options\">Populating Dropdown Options</a></li>\n<li><a href=\"https://betweentwoparens.com/rss.xml#managing-app-state\">Managing App State</a></li>\n</ul>\n<h2><a href=\"https://betweentwoparens.com/rss.xml#intro-to-hot-module-reloading\"></a>Intro to Hot Module Reloading</h2>\n<p><code>HMR</code> is when we have a special program running outside of our app. The job of this program is to watch for changes to our <code>.cljs</code> files. When our special program detects changes it will tell the browser that there are changes in our code, send those changes to the browser, and trigger a &quot;reload&quot; which means our running app is automatically updated with the new code and the app state is exactly where we left it<a href=\"https://betweentwoparens.com/rss.xml#what-hmr\">.</a></p>\n<p>The reason we do this is because:</p>\n<ul>\n<li>We don't like manually refreshing our browsers.</li>\n<li>We don't like losing our applications state</li>\n<li>We despise suffering through slow development feedback loops</li>\n</ul>\n<p>But <code>HMR</code> is not a feature that comes with a language. This is why we use &quot;special programs&quot; as I mentioned above. Examples of these &quot;special programs&quot; are <a href=\"https://github.com/bhauman/figwheel-main\">figwheel</a>, <a href=\"https://github.com/thheller/shadow-cljs\">shadow-cljs</a> or <a href=\"https://webpack.js.org/\">webpack</a><a href=\"https://betweentwoparens.com/rss.xml#build-tools\">.</a></p>\n<aside>Each of the above tools does far more than just <code>HMR</code>, but <code>HMR</code> is one of their standout features.</aside>\n<p>As I mentioned earlier, just because you use <code>figwheel</code> or <code>shadow-cljs</code> and the HMR mechanism they provide, does not mean you can take advantage of all the powers of HMR. You first have to architect your code in a particular way. Specifically, you have to control your side effects. In other words, you have to write <code>reloadale code</code>.</p>\n<aside>The exception to the above paragraph is if you are using <code>React</code>. If you use <code>React</code>, then HMR will pretty much work for free. This article is for developers who want use HMR with their vanilla CLJS or JavaScript code. Yet, even if you are writing <code>React</code> this article is still a good overview and will hopefully provide a deeper appreciation for the architectural decisions of React.</aside>\n<p>Okay, now that we have reviewed what HMR is doing, lets dive into the code and transform it into <code>reloadable code</code>.</p>\n<aside>Again the <a rel=\"noopener noreferrer\" href=\"https://github.com/tkjone/demo-reloadable-code\" target=\" _blank\">source code</a> is available and if you are following along, all you have to do to trigger a <code>reload</code> is save a <code>.cljs</code> file in the <code>src</code> dir.</aside>\n<h2><a href=\"https://betweentwoparens.com/rss.xml#submit-event-listeners\"></a>&quot;Submit&quot; Event Listeners</h2>\n<p>If you save <code>calendar.cljs</code> 5 times and then press the <code>Add</code> button in the Calendar App you will see it creates 5 <code>Calendar Events</code>.</p>\n<p>If we inspect the console we can see that there are actually 5 event listeners attached to the <code>submit</code> event. So it seems that when we click <code>Add</code> 5 event handlers are fired one after the other<a href=\"https://betweentwoparens.com/rss.xml#debugging-event-listeners\">.</a></p>\n<p>Why is this happening? As it turns out, if you look to the <a href=\"https://github.com/tkjone/demo-reloadable-code/commit/b26c1aac8e9c9d6e2d5c7407cc1806dac9b92724#diff-9f16cf6f6db4d58c84ae2d61fd54ec7fR168\">code here</a>:</p>\n<div><pre><code><span>(</span>events/listen\n  <span>(</span><span>..</span> js/document <span>(</span>querySelector <span>&quot;.calendar-form&quot;</span><span>)</span><span>)</span>\n  <span>&quot;submit&quot;</span>\n  handle-<span>add</span>-event!<span>)</span></code></pre></div>\n<p>The code above is invoked in our <code>ns</code> meaning that it runs everytime a <code>reload</code> is triggered. In other words, if you trigger 5 <code>reloads</code> it would be as if you wrote this:</p>\n<div><pre><code><span>(</span>events/listen element <span>&quot;submit&quot;</span> handle-<span>add</span>-event!<span>)</span>\n<span>(</span>events/listen element <span>&quot;submit&quot;</span> handle-<span>add</span>-event!<span>)</span>\n<span>(</span>events/listen element <span>&quot;submit&quot;</span> handle-<span>add</span>-event!<span>)</span>\n<span>(</span>events/listen element <span>&quot;submit&quot;</span> handle-<span>add</span>-event!<span>)</span>\n<span>(</span>events/listen element <span>&quot;submit&quot;</span> handle-<span>add</span>-event!<span>)</span></code></pre></div>\n<p>Wait. Didn't we say that each <code>reload</code> triggers a browser refresh? Not exactly. What we mean is that the ClojureScript in your app is sent to the DOM and re-run. The effect makes it appear like the browser is refreshing. Thus, triggering a <code>reload</code> updates your ClojureScript and re-runs your ClojureScript, but unlike your ClojureScript, whatever you did the DOM previously prior to a <code>reload</code> stays done.</p>\n<p>This is why when we write reloadable code we have to control what we do to the DOM so we don't cause unexpected behaviours like 5 <code>Calendar Events</code> added at a time.</p>\n<p>So how do we control what we do to the DOM to avoid these unpredictable side effects? We write <code>reloadable code</code> and to do this we have to know two things:</p>\n<ol>\n<li>when is our code going to reload?</li>\n<li>when is our code going to finish reloading?</li>\n</ol>\n<p><code>figwheel</code>, as well as other programs, provides us with a mechanism so we can answer the above 2 questions and that mechanism looks like this:</p>\n<div><pre><code><span>(</span><span>defn</span> ^<span>:before-load</span> teardown <span>[</span><span>]</span>\n  <span>; ...do stuff</span>\n  <span>)</span>\n\n\n<span>(</span><span>defn</span> ^<span>:after-load</span> setup <span>[</span><span>]</span>\n  <span>; ...do stuff</span>\n  <span>)</span></code></pre></div>\n<p>Before we go further, lets breakdown what the above is doing. <code>teardown</code> and <code>setup</code> are nothing more than clojure functions. The only part we have to care about from the above are the <code>^:before-load</code> and <code>^:after-load</code> words that come before <code>teardown</code> and <code>setup</code>.</p>\n<p><code>^:before-load</code> and <code>^:after-load</code> are called <a href=\"https://clojure.org/reference/metadata\">metadata</a> in Clojure(Script). What makes them <code>metadata</code>is the <code>^</code> that comes before the <code>:</code> (colon).</p>\n<p>When figwheel sees these particular pieces of metdata infront of a function it knows that it has to run our functions before and after the CLJS reloads.</p>\n<aside>Please note that like any function you can rename <code>teardown</code> and <code>setup</code> to whatever you like.</aside>\n<p>Now that we know we can write code that runs before and after load we just have to figure out what we should put in these functions to make our code <code>reloadable code</code>.</p>\n<p>Going back to the &quot;submit&quot; <code>event listener</code> scenario, the problem is that everytime our code reloads, a new <code>event listener</code> is attached to the &quot;submit&quot; event. But what we want is to only have 1 <code>event listener</code>, the newest <code>event listener</code>, attached to our submit. So what we need to make our code do:</p>\n<ul>\n<li>before reload: remove old &quot;submit&quot; event listener</li>\n<li>after reload: add new &quot;submit&quot; event listener</li>\n</ul>\n<p>The following is what the above looks like in our code:</p>\n<div><pre><code><span>; before reload: remove old &quot;submit&quot; event listener</span>\n<span>(</span><span>defn</span> ^<span>:before-load</span> teardown <span>[</span><span>]</span>\n  <span>(</span>events/removeAll\n   <span>(</span>.querySelector js/document <span>&quot;.calendar-form&quot;</span><span>)</span><span>)</span><span>)</span>\n\n<span>; after reload: add new &quot;submit&quot; event listener</span>\n<span>(</span><span>defn</span> ^<span>:after-load</span> setup <span>[</span><span>]</span>\n  <span>(</span>events/listen\n    <span>(</span><span>..</span> js/document <span>(</span>querySelector <span>&quot;.calendar-form&quot;</span><span>)</span><span>)</span>\n    <span>&quot;submit&quot;</span>\n    handle-<span>add</span>-event!<span>)</span><span>)</span>\n\n\n<span>(</span><span>defonce</span> initial-load <span>(</span>setup<span>)</span><span>)</span></code></pre></div>\n<aside>See the <a rel=\"noopener noreferrer\" href=\"https://github.com/tkjone/demo-reloadable-code/commit/ceb1ae2b907eb8c04befcb30c21e9bab81706000\" target=\" _blank\">code</a>.</aside>\n<p>What we did:</p>\n<ul>\n<li><code>before-load</code> - figwheel is going to call our <code>teardown</code> function which deletes event listeners from <code>submit</code></li>\n<li><code>after-load</code> - figwheel is going to call our <code>setup</code> function which adds event listeners to <code>submit</code></li>\n</ul>\n<p>You might have also noticed that I snuck in a little something extra: <code>initial-load</code>. Remember how we said that <code>before-load</code> happens before a reload and <code>after-load</code> happens after a reload? This means those are <em>only</em> triggered when a reload is triggered. If we left it like that, our code would not work when we first visit the app. So we add a <code>defonce</code> so that the code which runs on the <em>first</em>, and only the first time, your app loads in the browser.</p>\n<aside>If you're following allong with the code, I encourage you to comment out <code>initial-load</code> and see what happens. Also note that you do not need to call <code>setup</code> in <code>initial-load</code>, you could write a totally separate function. I just did the above to keep the example cleaner</aside>\n<p>With the above in place go ahead and try to trigger some reloads. If everything worked, no matter how many time you trigger a reload only 1 <code>Calendar Event</code> should ever be created.</p>\n<p>If you are lost at this point for any reason take comfort in the fact that writing <code>reloadable code</code> is not always straighforward and does require you to think deeply about what your code is doing. This is a skill that can take some time to learn.</p>\n<h2><a href=\"https://betweentwoparens.com/rss.xml#change-event-listeners\"></a>&quot;Change&quot; Event Listeners</h2>\n<p>Here is the second opportunity for making our code <code>reloadable code</code>. Similar to the &quot;submit&quot; example above, we are invoking another <code>event listener</code> in our file for the <code>change</code> event:</p>\n<div><pre><code><span>(</span>events/listen\n  <span>(</span><span>..</span> js/document <span>(</span>querySelector <span>&quot;#event_start&quot;</span><span>)</span><span>)</span>\n  <span>&quot;change&quot;</span>\n  update-event-end-dropdown!<span>)</span></code></pre></div>\n<aside>If you have the code infront stop for a moment. Read the src code for <code>update-event-end-dropdown!</code> and try to see what the bug is.</aside>\n<p>If you read the code, or even ran the code, you will see that this code is not a problem. Yes, if we <code>reload</code> our app 5 times it would do this:</p>\n<div><pre><code><span>(</span>events/listen element <span>&quot;change&quot;</span> update-event-end-dropdown!<span>)</span>\n<span>(</span>events/listen element <span>&quot;change&quot;</span> update-event-end-dropdown!<span>)</span>\n<span>(</span>events/listen element <span>&quot;change&quot;</span> update-event-end-dropdown!<span>)</span>\n<span>(</span>events/listen element <span>&quot;change&quot;</span> update-event-end-dropdown!<span>)</span>\n<span>(</span>events/listen element <span>&quot;change&quot;</span> update-event-end-dropdown!<span>)</span></code></pre></div>\n<p>But it's still not causing any bugs. The reason is because the code inside of <code>update-event-end-dropdown!</code> is destructive and not performing an additive effect like &quot;submit&quot;. The worst that happens is that if we <code>reload</code> 5 times the <code>option</code> will get set 5 times because of <code>(.-innerHTML start-time-dropdown)</code>.</p>\n<p>So if this is not a bug, then why talk about it? Because even if the code is not causing problems now, it is stacking <code>event listeners</code> and if we change <code>update-event-end-dropdown!</code> to accidentally do something different, we are going to set ourselves up nicely for an interesting bug.</p>\n<p>If neither of these arguments persuade you, that is fine and highlights the interesting part about writing <code>reloadable code</code>: many elements of designing your code in this way are going to be subjective and based on how <em>you</em> want your code to run.</p>\n<p>Having said this, for this scenario I am going to play it safe and show you how we could fix the code:</p>\n<div><pre><code><span>(</span><span>defn</span> ^<span>:after-load</span> setup <span>[</span><span>]</span>\n  <span>(</span>events/listen\n    <span>(</span><span>..</span> js/document <span>(</span>querySelector <span>&quot;.calendar-form&quot;</span><span>)</span><span>)</span>\n    <span>&quot;submit&quot;</span>\n    handle-<span>add</span>-event!<span>)</span>\n\n  <span>(</span>events/listen\n    <span>(</span><span>..</span> js/document <span>(</span>querySelector <span>&quot;#event_start&quot;</span><span>)</span><span>)</span>\n    <span>&quot;change&quot;</span>\n    update-event-end-dropdown!<span>)</span><span>)</span></code></pre></div>\n<p>You can see the above change <a href=\"https://github.com/tkjone/demo-reloadable-code/commit/c87c9b13562856191c3374ffe521c5d97875f281\">here</a>. In the next section we are going to explore more subjective goodness.</p>\n<h2><a href=\"https://betweentwoparens.com/rss.xml#populating-dropdown-options\"></a>Populating Dropdown Options</h2>\n<p>Reading <a href=\"https://github.com/tkjone/demo-reloadable-code/blob/c87c9b13562856191c3374ffe521c5d97875f281/src/demo_reloadable_code/calendar.cljs#L188\">along with the code</a> in Calendar App, we have another invokation when the <code>ns</code> loads.</p>\n<div><pre><code><span>(</span><span>set!</span> <span>(</span><span>..</span> start-time-dropdown -innerHTML<span>)</span> <span>(</span>time-option-list <span>(</span>time-range<span>)</span><span>)</span><span>)</span>\n\n<span>(</span><span>set!</span> <span>(</span><span>..</span> end-time-dropdown -innerHTML<span>)</span> <span>(</span>time-option-list <span>(</span>time-range <span>9</span>.<span>25</span><span>)</span><span>)</span><span>)</span></code></pre></div>\n<p>All these do is populate the time options in our forms time dropdowns. So the question is, if we run this multiple times in a row what happens? Similar to the &quot;change&quot; event listeners, the above is performing a destructive action. each time they are run they will delete the content of the <code>select</code> boxes and replace them with the same options. Also, unlike <code>event listeners</code> these do not stack. Will there be a bug? What are the problems with this?</p>\n<p>Each time we run this code, it clears out our dropdowns and re-adds options. What if we put this in <code>initial-load</code>? It would only run once meaning that if we made changes to <code>time-option-list</code> we would not see the effect take place. But what if we know we are 100% done with <code>time-option-list</code>? Perhaps we don't believe their will be more changes? Maybe this justifies only putting it into the <code>initial-load</code>.</p>\n<p>However, if you are in the camp that believe we should re-run this action just to be safe, then we can put it into the <code>initial-load</code> and <code>after-load</code>. But if we do this there is something that could happen. Imagine this is what I did:</p>\n<ul>\n<li>select a <code>start</code> and <code>end</code> time</li>\n<li>realize I need to make a change to the code</li>\n<li>change the code + trigger a <code>reload</code></li>\n</ul>\n<p>If we move the <code>time-option-list</code> inside the <code>after-load</code> everytime a <code>reload</code> is triggered we are going to lose our <code>start</code> and <code>end</code> time we selected. We are losing app state. If this is concerning to <em>you</em>, then it is not enough to add our <code>time-option-list</code> to the <code>after-load</code> we also have to add additional code to our app to potentially save the state of the application so we don't lose it. I won't walk through what that looks like, as I wanted to bring it up as a lead to what makes <code>HMR</code> feel like magic: app state.</p>\n<h2><a href=\"https://betweentwoparens.com/rss.xml#managing-app-state\"></a>Managing App State</h2>\n<p>App State is a memory of what you did in the app. When we trigger a reload we can make it so our add does not reset its app state. For example, let's pretend I am working on my add, I add a few <code>Calendar Events</code> and trigger a reload. Those <code>Calendar Events</code> I just added will be lost. We go back to 0. This does not have to be the case though. We could tell our add to not reset the state.</p>\n<p>To make this happen all you have to do, based on how I wrote Calendar App, is this:</p>\n<div><pre><code><span>; update this line</span>\n<span>(</span><span>def</span> app-state <span>(</span>atom <span>[</span><span>]</span><span>)</span><span>)</span>\n\n<span>; to look like this</span>\n<span>(</span><span>defonce</span> app-state <span>(</span>atom <span>[</span><span>]</span><span>)</span><span>)</span></code></pre></div>\n<p>That's it. Now, whenever your app <code>reloads</code>, your state is never forgotten. The way this works is explained nicely in <a href=\"https://code.thheller.com/blog/shadow-cljs/2019/08/25/hot-reload-in-clojurescript.html\">Hot Reload in ClojureScript</a>. The short answer: <code>defonce</code> means that <code>app-state</code> will not reset to <code>(atom [])</code> when the app <code>reloads</code>.</p>\n<p>This is a simple example, but it should provide some ideas for what needs to be done to make our <code>reloadable code</code> capable of managing state.</p>\n<h2><a href=\"https://betweentwoparens.com/rss.xml#conclusion\"></a>Conclusion</h2>\n<p>Writing <code>reloadable code</code> can seem tricky at first, but hopefully we can see that with ClojureScript it is an achievable and worthwhile goal. For me the benefits of writing your code like this and even thinking about these things is the understanding you gain about how your code works.</p>\n<p>The other gain is the power that ClojureScript gives you out of the box. It take very little to setup HMR and start writing reloadable code with the tools provided by Clojure(Script) core library. You don't need additional dependencies.</p>\n<p>Hopefully this provides a decent example set with which to start your reloadable code journey.</p>\n<aside>\n<h3>Footnotes</h3>\n<ol>\n<li>\nIn my head I was a heroic. Crushing out code. Delivering... I was a Titan in that moment. The truth is this is savagery at its finest.\n<a href=\"https://betweentwoparens.com/rss.xml#full-savage-ref\">↩</a>\n</li>\n<li>\nTwo points here: <strong>First,</strong> <code>HMR</code> is not specific to ClojureScript. It can be done in JavaScript, C++ etc. I am only referencing ClojureScript because that is the focus of this article. These techiques can be shared 1:1 with JavaScript, but I have not tried yet. <strong>Second,</strong> When I said that app state is exactly where we left it, this is <i>only</i> true when you setup your reloadable code to work this way. I write about this in the <a href=\"https://betweentwoparens.com/rss.xml#managing-app-state\">Managing App State</a> section of this post.\n<a href=\"https://betweentwoparens.com/rss.xml#what-hmr-ref\">↩</a>\n</li>\n<li>\nYou do not use all of these tools, you only need to choose one.\n<a href=\"https://betweentwoparens.com/rss.xml#build-tools-ref\">↩</a>\n</li>\n<li>\nIf you like to debug using <code>console.log</code> statements you are going to run into a bug while debugging like this. If you run the app, add a <code>console.log</code> to <code>handle-add-event!</code> and save you will trigger a reload. Then, if you click the <code>add</code> button you will notice that even though you have 2 event listeners attached, only 1 <code>console.log</code> will fire. This is because the first event listener has the old <code>handle-add-event!</code> function without the <code>console.log</code>. So it will seem like your only 1 event listeners is firing. You can verify this again by saving the file, without making changes, and now you should see 2 logs fire.\n<a href=\"https://betweentwoparens.com/rss.xml#debugging-event-listeners-ref\">↩</a>\n</li>\n</ol>\n</aside>",
   :direction "ltr"},
  :updated 1569715200000,
  :entities
  [{:mentions [{:text "HMR"}],
    :id "nlp/f/entity/wd:3887748",
    :salienceLevel "mention",
    :label "Hamar Airport"}
   {:mentions [{:text "src"} {:text "source code"} {:text "source"}],
    :id "nlp/f/entity/wd:128751",
    :salienceLevel "mention",
    :label "source code"}
   {:mentions [{:text "JavaScript"}],
    :id "nlp/f/entity/wd:2005",
    :salienceLevel "mention",
    :label "JavaScript"}
   {:mentions [{:text "React"}],
    :id "nlp/f/entity/wd:19399674",
    :salienceLevel "mention",
    :label "ReactJS"}
   {:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}],
  :alternate
  [{:href
    "https://betweentwoparens.com/students-of-the-game-reloadable-code",
    :type "text/html"}],
  :title "Students of the Game: Reloadable Code",
  :author "Between Two Parens",
  :published-str "Sat Sep 28 17:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16d7fdf9236:387553f:69b9f616",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url
   "https://betweentwoparens.com/static/1833410f254a47f59c4448d4a3e5a8a3/b9e4f/004-01-calendar-app-intro.png",
   :width 590,
   :height 563,
   :contentType "image/png"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://betweentwoparens.com/students-of-the-game-reloadable-code",
  :commonTopics
  [{:score 24.38393710662531,
    :id "nlp/f/topic/3029",
    :salienceLevel "about",
    :label "games"}
   {:score 0.956,
    :id "nlp/f/topic/1555",
    :salienceLevel "about",
    :label "net"}
   {:score 0.809,
    :id "nlp/f/topic/774",
    :salienceLevel "mention",
    :label "engineering"}
   {:score 0.809,
    :id "nlp/f/topic/334",
    :salienceLevel "mention",
    :label "browsers"}
   {:score 0.788,
    :id "nlp/f/topic/2461",
    :salienceLevel "mention",
    :label "web design"}],
  :published 1569715200000,
  :fingerprint "3d12909a",
  :canonicalUrl
  "https://betweentwoparens.com/students-of-the-game-reloadable-code"}
 {:engagement 4,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1569606900745,
  :content
  {:content
   "<p>Each week, we answer a different question about Clojure and functional programming.</p>\n<p>If you have a question you’d like us to discuss, tweet <a href=\"https://twitter.com/clojuredesign\">@clojuredesign</a>, send an email to <a href=\"mailto:feedback@clojuredesign.club\">feedback@clojuredesign.club</a>, or join the <code>#clojuredesign-podcast</code> channel on the <a href=\"http://clojurians.net/\">Clojurians Slack</a>.</p>\n<p>This week, the question is: <strong>“Help! How do I fix my REPL?”</strong> We catalog the many ways we’ve broken our REPLs and talk through our strategies for getting back on track.</p>\n<p>Selected quotes:</p>\n<ul>\n<li>“The REPL is a wonderful, wonderful thing.”</li>\n<li>“A cleansing restart.”</li>\n<li>“What is my Clojure band name?”</li>\n<li>“tools.namespace will help you find rename errors early.”</li>\n<li>“Refresh will continue to work, as long as you continue to work.”</li>\n<li>“Even a defonce can be def’d again. It’s a defonce, for now.”</li>\n</ul>",
   :direction "ltr"},
  :updated 1569596400000,
  :entities
  [{:mentions [{:text "REPL"}],
    :id "nlp/f/entity/wd:2032810",
    :salienceLevel "about",
    :label "Read–eval–print loop"}
   {:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "functional programming"}],
    :id "nlp/f/entity/wd:193076",
    :salienceLevel "mention",
    :label "functional programming"}],
  :alternate
  [{:href
    "https://clojuredesign.club/episode/048-help-how-do-i-fix-my-repl/",
    :type "text/html"}],
  :title "Ep 048: Help! How Do I Fix My REPL?",
  :author "Christoph Neumann and Nate Jones",
  :published-str "Fri Sep 27 08:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16d73dc9c09:2b95dcf:97b0c8f7",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://clojuredesign.club/episode/048-help-how-do-i-fix-my-repl/",
  :commonTopics
  [{:score 25.879212496685934,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.981,
    :id "nlp/f/topic/501",
    :salienceLevel "about",
    :label "college"}
   {:score 0.79,
    :id "nlp/f/topic/1695",
    :salienceLevel "mention",
    :label "parenting"}],
  :published 1569596400000,
  :fingerprint "3fd9f47f",
  :canonicalUrl
  "https://clojuredesign.club/episode/048-help-how-do-i-fix-my-repl/"}
 {:engagement 5,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1569602825402,
  :recrawled 1569605109964,
  :content
  {:content
   "From Elegance to Speed\n<div>\n<h1>From Elegance to Speed</h1>\n<div>\n<h2>:code:lisp:clojure:physics:</h2>\n</div>\n<div>\n<h2>Making Things Fast</h2>\n<div>\n<div>\n<p><a href=\"http://zerolib.com/plane.jpg\"><img alt=\"plane.jpg\" src=\"http://zerolib.com/plane.jpg\"></a>\n</p>\n</div>\n<p>\nA while back, we used <a href=\"http://zerolib.com/lazy-physics.html\">a toy particle physics trigger</a> to explore\nconcepts in lazy evaluation and functional programming in Clojure. We\ncame up with the following function which selected groups of eight\nevents clustered close together in time:\n</p>\n<pre>(defn smt-8 [times]\n  (->> times\n       (partition 8 1)\n       (map (juxt identity\n                  (comp (partial apply -)\n                        (juxt last first))))\n       (filter (comp (partial > 1000) second))))\n</pre>\n<p>\nThough elegant, this function processed events at a rate of 250 kHz,\nwhich I found slightly disappointing, performance-wise.\n</p>\n<p>\nI have been interested in writing faster programs lately, which is one\nof the reasons I’ve been <a href=\"http://zerolib.com/lisp-projects.html\">learning Common Lisp</a>. Common Lisp lets you\ncreate extremely high-level programming constructs, but also lets you\nget closer to the metal when you need to. In this post we’ll look at\nsome ways for improving performance and compare our results to the\noriginal 250 kHz event rate.\n</p>\n</div>\n</div>\n<div>\n<h2>First Steps</h2>\n<div>\n<p>\nThe first step is to translate our code as is to Common Lisp. We’re\ngoing to punt entirely on the question of laziness for this post,\nthough we might take it up in the future.\n</p>\n<p>\nHere’s my first attempt. We have to start with our source of random\ntimes. In Clojure, we had:\n</p>\n<pre>(def times (iterate #(+ % (rand-int 1000)) 0))\n</pre>\n<p>\nSince I’m going to benchmark performance, we’ll need to set a limit to the number of events (times) we’ll process. So, in Common Lisp:\n</p>\n<pre>(defun time-sequence (n)\n  (loop repeat n\n     for y = 0 then (+ y (random 1000))\n     collect y))\n</pre>\n<p>\nwhere <code>n</code> is the number of event times to process. Here and\nthroughout what follows, I’m using the <code>loop</code> macro, which is a Swiss\narmy knife for iteration with a somewhat strange, non-Lispy, but\nreadable syntax.\n</p>\n<p>\nWe also want to set our random state so as to guarantee different\nresults each time we execute our simulation:\n</p>\n<pre>(setf *random-state* (make-random-state t))\n</pre>\n<p>\nMy first attempt in Common Lisp looked like this benchmarking snippet:\n</p>\n<pre>(timing\n  (length\n    (->> 1000000\n         time-sequence\n         (partition-n 8 1)\n         (mapcar (juxt #'car (compose #'car #'last) #'identity))\n         (mapcar #'(lambda (l) `(,(- (cadr l) (car l)) ,(caddr l))))\n         (remove-if-not #'(lambda (l) (&lt; (car l) 1000))))))\n</pre>\n<p>\nThis is less lovely than the Clojure, partly because of all the\nhash-quoting of functions (Common Lisp is a <a href=\"https://stackoverflow.com/questions/4578574/what-is-the-difference-between-lisp-1-and-lisp-2\">Lisp-2</a>, and Clojure is a\nLisp 1). <code>->></code> is from the <code>arrow-macros</code> library, and <code>compose</code> is\nfrom the <code>cl-utilities</code> library. The other Clojure-ish functions,\n<code>partition-n</code> (a replacement for Clojure’s <code>partition</code>, whose name\ncollides with an entirely different function in Common Lisp) and\n<code>juxt</code> are from <a href=\"https://github.com/eigenhombre/cl-oju\"><code>cl-oju</code></a>, <a href=\"https://github.com/eigenhombre/cl-oju\">a small library</a> I’ve been writing for those\nstill-frequent times when I want a Clojure function or idiom in Common\nLisp. (The library ignores laziness for now, since I haven’t needed it\nyet.)\n</p>\n<p>\n<code>timing</code> is a macro I adapted from <a href=\"http://cl-cookbook.sourceforge.net/dates_and_times.html\">the Common Lisp Cookbook</a>, which\ncaptures both the results of a computation and the elapsed CPU time\nused (not wall clock time) in msec:\n</p>\n<pre>(defmacro timing (&amp;body forms)\n  (let ((run1 (gensym))\n        (run2 (gensym))\n        (result (gensym)))\n    `(let ((,run1 (get-internal-run-time))\n           (,result (progn ,@forms))\n           (,run2 (get-internal-run-time)))\n       `(duration ,(- ,run2 ,run1) msec... result ,,result))))\n</pre>\n<p>\nFor now, <code>result</code> is simply the number of eight-fold time clusters\noccuring within 1000 units of time. The execution time was roughly a\nsecond for the first few times I ran this:\n</p>\n<pre>'(DURATION 1045 MSEC... RESULT 235)\n'(DURATION 1554 MSEC... RESULT 201)\n'(DURATION 827 MSEC... RESULT 164)\n</pre>\n<p>\nThis already processed events at 1 MHz, roughly 4x faster than the\nClojure speed of 250kHz.\n</p>\n<p>\nLater, however, when I revisited the code, I noticed it ran significantly\nfaster:\n</p>\n<pre>'(DURATION 435 MSEC... RESULT 193)\n'(DURATION 279 MSEC... RESULT 189)\n'(DURATION 205 MSEC... RESULT 177)\n'(DURATION 601 MSEC... RESULT 180)\n</pre>\n<p>\nThis is 2.6 Mhz, <b>10x the Clojure code speed</b>. It took me a while to\nfigure out that I had changed the SBCL heap size in order to handle\nlarger arrays for testing (this is one area where laziness would\nhelp!). The larger heap size was making the code run faster.\n</p>\n<p>\nIt should be said at this point that I made no attempt in my original\nblog post to optimize the Clojure code for performance. Nevertheless,\nI think it’s interesting that my first attempt to write the same\nalgorithm in Common Lisp, using roughly the same idioms, performed so\nmuch faster.\n</p>\n</div>\n</div>\n<div>\n<h2>Interlude</h2>\n<div>\n<p>\nLooking back over my career, it seems I have been moving gradually\nfrom fast, lower-level languages to slower, more expressive,\nhigh-level languages: <code>FORTRAN</code> and C, to Perl and Python, then to\nClojure (which is faster than Python for most long-running programs,\nwhile being arguably more expressive<sup><a href=\"http://zerolib.com/feed.clojure.xml#fn.1\">1</a></sup>). I’ve enjoyed this\ntrajectory, because higher level languages let you implement so much, so\nquickly.\n</p>\n<p>\nMy feelings on this are shifting, however. I wrote some code a decade\nago for <a href=\"https://arxiv.org/abs/0810.4930\">a system</a> that has been running constantly for a decade on\nthousands of devices. My code is not particularly CPU efficient and,\ntherefore, not as energy-efficient as it could be. As the planet\nwarms, I think it’s important to try and find small efficiencies where\nwe can… not necessarily under the assumption that it will make a\nmassive difference, but because it’s just the right thing to do as\nconscientious professionals. (The fact that the sins of my past are\nexecuting on processors running on top of and within Antarctic ice\nadds an extra bit of irony here).\n</p>\n<p>\nCommon Lisp is particularly interesting to me of late because, having\nbeen designed largely for <a href=\"https://en.wikipedia.org/wiki/Symbolic_artificial_intelligence\">Good Old-Fashioned AI</a>, it allows you to work\nat a very high level (you can, for example, add Prolog-like\nfunctionality to a Lisp in a few hundred lines of code <sup><a href=\"http://zerolib.com/feed.clojure.xml#fn.2\">2</a></sup>) – but, you can generate very fast (i.e.,\nmore energy efficient) code as well, as we shall see shortly.\n</p>\n</div>\n</div>\n<div>\n<h2>Improvements</h2>\n<div>\n<p>\nThe next thing I tried was to separate the event generation from the trigger calculation and to use a vector for the input times, instead of a list:\n</p>\n<pre>(defun time-sequence-vec (n)\n  (make-array `(,n)\n              :initial-contents\n              (loop repeat n\n                 for y = 0 then (+ y (random 1000))\n                 collect y)))\n\n(defparameter array-size (* 100 1000 1000))\n\n(defparameter *s* (time-sequence-vec array-size))\n</pre>\n<p>\nI also make the test sample much larger to improve the run durations and statistics.\n</p>\n<p>\nBoth Graham<sup><a href=\"http://zerolib.com/feed.clojure.xml#fn.3\">3</a></sup> and Norvig<sup><a href=\"http://zerolib.com/feed.clojure.xml#fn.4\">4</a></sup> emphasize tuning your algorithm first before turning\nto other optimizations. In our case the problem is O(<i>n</i>), which is\nthe best time complexity we can hope for, but our use of function\ncomposition, while elegant, could be turned into something more\nefficient. To improve the algorithm proper, I perform the entire\ncomputation in a single <code>loop</code> statement. I also change the output\nslightly to show the index for matching 8-fold events, start and end\ntime, and event duration:\n</p>\n<pre>(defun second-try ()\n  (loop for x below (- array-size 8)\n     if (&lt; (- (elt *s* (+ x 8))\n              (elt *s* x))\n           1000)\n     collect `(index ,x\n                     startval ,(elt *s* x)\n                     endval   ,(elt *s* (+ x 8))\n                     diff     ,(- (elt *s* (+ x 8))\n                                  (elt *s* x)))))\n(take 4 (second-try))\n;;=>\n'((INDEX 69087 STARTVAL 34504666 ENDVAL 34505615 DIFF 949)\n  (INDEX 153990 STARTVAL 76991815 ENDVAL 76992630 DIFF 815)\n  (INDEX 237070 STARTVAL 118617491 ENDVAL 118618358 DIFF 867)\n  (INDEX 294951 STARTVAL 147513479 ENDVAL 147514346 DIFF 867))\n\n;; Time it, a few times:\n(timing (length (second-try)))\n;;=>\n'(DURATION 2158 MSEC... RESULT 2427)\n;;=>\n'(DURATION 2167 MSEC... RESULT 2427)\n;;=>\n'(DURATION 2162 MSEC... RESULT 2427)\n;;=>\n</pre>\n<p>\nNote that the starting and ending time values increase monotonically,\nand the reported time differences (<code>DIFF</code>) are under 1000, as desired<sup><a href=\"http://zerolib.com/feed.clojure.xml#fn.5\">5</a></sup>.\n</p>\n<p>\nThe new trigger function improves the processing rate to 46.2 MHz. At\nthis point I’m starting to wonder what the assembly language looks\nlike:\n</p>\n<pre>(disassemble 'second-try)\n;;=>\n; disassembly for SECOND-TRY\n; Size: 1061 bytes. Origin: #x228FE0B0                        ; SECOND-TRY\n; 0B0:       498B7510         MOV RSI, [R13+16]               ; thread.binding-stack-pointer\n; 0B4:       488975F8         MOV [RBP-8], RSI\n; 0B8:       488B3591FFFFFF   MOV RSI, [RIP-111]              ; 'ARRAY-SIZE\n; 0BF:       8B56F5           MOV EDX, [RSI-11]\n; 0C2:       4A8B142A         MOV RDX, [RDX+R13]\n; 0C6:       83FA61           CMP EDX, 97\n; 0C9:       480F4456F9       CMOVEQ RDX, [RSI-7]\n; 0CE:       83FA51           CMP EDX, 81\n; 0D1:       0F84BF030000     JEQ L17\n; 0D7:       BF10000000       MOV EDI, 16\n; 0DC:       FF1425B000B021   CALL QWORD PTR [#x21B000B0]     ; GENERIC--\n\n;; .................. many lines omitted ................\n\n; 4B6: L24:  CC18             BREAK 24                        ; UNBOUND-SYMBOL-ERROR\n; 4B8:       27               BYTE #X27                       ; '*S*\n; 4B9: L25:  6880000000       PUSH 128\n; 4BE:       FF14252800B021   CALL QWORD PTR [#x21B00028]     ; ALLOC-TRAMP-R11\n; 4C5:       E9FFFEFFFF       JMP L12\n; 4CA: L26:  6A10             PUSH 16\n; 4CC:       FF14252800B021   CALL QWORD PTR [#x21B00028]     ; ALLOC-TRAMP-R11\n; 4D3:       EB94             JMP L14\n</pre>\n<p>\n(258 lines in total.)\n</p>\n<p>\nMy assembler-fu is not strong, but I notice the <code>GENERIC--</code> and we do\nnot need generic functions: there are many opportunities here to\nintroduce type declarations.\n</p>\n<p>\nAfter declaring to the compiler we want more speed and less\ntype-checking (<code>(declaim (optimize (speed 3) (debug 0) (safety 0)))</code>),\nlet’s declare our array to be type <code>fixnum</code> (which on SBCL is an\ninteger from -4611686018427387904 to 4611686018427387903).\n</p>\n<pre>(defparameter *s* (make-array array-size\n                              :element-type 'fixnum))\n;; Initialize array:\n(loop\n   for y = 0 then (+ y (random 1000))\n   for i below array-size\n   do (setf (elt *s* i) y))\n\n(timing\n  (length\n   (loop for x below (- array-size 8)\n      if (&lt; (- (elt *s* (+ x 8))\n               (elt *s* x))\n            1000)\n      collect `(index ,x\n                      startval ,(elt *s* x)\n                      endval   ,(elt *s* (+ x 8))\n                      diff     ,(- (elt *s* (+ x 8))\n                                   (elt *s* x))))))\n;;=>\n'(DURATION 1964 MSEC... RESULT 2435)\n;;=>\n'(DURATION 1939 MSEC... RESULT 2435)\n;;=>\n'(DURATION 2010 MSEC... RESULT 2435)\n</pre>\n<p>\n… maybe a slight improvement. Let’s now type-hint where we can throughout the tight loop:\n</p>\n<pre>(timing\n  (length\n   (loop for x below (- array-size 8)\n      if (&lt; (- (the fixnum (elt *s* (the fixnum (+ x 8))))\n               (the fixnum (elt *s* (the fixnum x))))\n            1000)\n      collect `(index ,x\n                      startval ,(elt *s* x)\n                      endval   ,(elt *s* (+ x 8))\n                      diff     ,(- (elt *s* (+ x 8))\n                                   (elt *s* x))))))\n;;=>\n'(DURATION 1740 MSEC... RESULT 2435)\n;;=>\n'(DURATION 1738 MSEC... RESULT 2435)\n;;=>\n'(DURATION 1753 MSEC... RESULT 2435)\n</pre>\n<p>\nA 10% or so improvement… not too bad.\n</p>\n<p>\nAt this point I’m tempted to look at the macroexpansion of my <code>loop</code>\nexpression and see what it’s doing. For simplicity, I <code>collect</code> just\nthe starting time index for times satisfying the trigger:\n</p>\n<pre>(macroexpand-1\n '(loop for x below (- array-size 8)\n     if (&lt; (- (the fixnum (elt *s* (the fixnum (+ x 8))))\n            (the fixnum (elt *s* (the fixnum x))))\n         1000)\n     collect x))\n;;=>\n'(block nil\n  (let ((#:loop-limit-711 (- array-size 8)) (x 0))\n    (declare (type (and number real) x)\n             (type (and number real) #:loop-limit-711))\n    (sb-loop::with-loop-list-collection-head (#:loop-list-head-712\n                                              #:loop-list-tail-713)\n      (tagbody\n       sb-loop::next-loop\n         (when (>= x #:loop-limit-711) (go sb-loop::end-loop))\n         (if (&lt;\n              (- (the fixnum (elt *s* (the fixnum (+ x 8))))\n                 (the fixnum (elt *s* (the fixnum x))))\n              1000)\n             (sb-loop::loop-collect-rplacd\n              (#:loop-list-head-712 #:loop-list-tail-713) (list x)))\n         (sb-loop::loop-desetq x (1+ x))\n         (go sb-loop::next-loop)\n       sb-loop::end-loop\n         (return-from nil\n           (sb-loop::loop-collect-answer #:loop-list-head-712))))))\n</pre>\n<p>\nI notice that <code>x</code> and <code>:loop-limit-711</code> have an overly-general type declaration. I’m not sure how to type-hint <code>x</code>, but I can type-hint the upper bound:\n</p>\n<pre>(timing\n  (length\n   (loop for x below (- (the fixnum array-size) 8)\n      if (&lt; (- (the fixnum (elt *s* (+ (the fixnum x) 8)))\n               (the fixnum (elt *s* (the fixnum x))))\n            1000)\n      collect `(index ,x\n                      startval ,(elt *s* x)\n                      endval   ,(elt *s* (+ x 8))\n                      diff     ,(- (elt *s* (+ x 8))\n                                   (elt *s* x))))))\n;;=>\n'(DURATION 1460 MSEC... RESULT 2513)\n;;=>\n'(DURATION 1455 MSEC... RESULT 2513)\n;;=>\n'(DURATION 1486 MSEC... RESULT 2513)\n</pre>\n<p>\nAnother modest but significant improvement.\n</p>\n<p>\nAt this point I reached for the SBCL profiler to see what I could\nlearn from it. Most of the processing time is spent in array\nlookups, which I don’t think we can avoid.\n</p>\n<p>\nLet’s look at the assembler again. Since our trigger matches are rare,\nmost of our time is going to be spent in finding the events, rather\nthan in collecting the detailed results for the matches. If we switch\nback to using <code>collect x</code> to avoid the extra assembly associated with\nbuilding <code>`(index ,x startval ...)</code>:\n</p>\n<pre>(defun trigger ()\n(loop for x below (- (the fixnum array-size) 8)\n     if (&lt; (- (the fixnum (elt *s* (+ (the fixnum x) 8)))\n              (the fixnum (elt *s* (the fixnum x))))\n           1000)\n     collect x))\n(disassemble 'trigger)\n;;=>\n;; disassembly for TRIGGER\n;; Size: 448 bytes. Origin: #x22610EA0                         ; TRIGGER\n;; 0EA0:       498B4510         MOV RAX, [R13+16]              ; thread.binding-stack-pointer\n;; 0EA4:       488945F8         MOV [RBP-8], RAX\n;; 0EA8:       488B05B1FFFFFF   MOV RAX, [RIP-79]              ; 'ARRAY-SIZE\n;; 0EAF:       8B70F5           MOV ESI, [RAX-11]\n;; 0EB2:       4A8B342E         MOV RSI, [RSI+R13]\n;; 0EB6:       83FE61           CMP ESI, 97\n;; 0EB9:       480F4470F9       CMOVEQ RSI, [RAX-7]\n;; 0EBE:       83FE51           CMP ESI, 81\n;; 0EC1:       0F8477010000     JEQ L11\n;; 0EC7:       40F6C601         TEST SIL, 1\n;; 0ECB:       0F8568010000     JNE L10\n;; 0ED1:       48D1FE           SAR RSI, 1\n;; 0ED4:       4883EE08         SUB RSI, 8\n;; 0ED8:       488975F0         MOV [RBP-16], RSI\n;; 0EDC:       31F6             XOR ESI, ESI\n;; 0EDE:       49896D28         MOV [R13+40], RBP              ; thread.pseudo-atomic-bits\n;; 0EE2:       4D8B5D68         MOV R11, [R13+104]             ; thread.alloc-region\n;; 0EE6:       498D4310         LEA RAX, [R11+16]\n;; 0EEA:       493B4570         CMP RAX, [R13+112]\n;; 0EEE:       0F874D010000     JNBE L12\n;; 0EF4:       49894568         MOV [R13+104], RAX             ; thread.alloc-region\n;; 0EF8: L0:   498D4307         LEA RAX, [R11+7]\n;; 0EFC:       49316D28         XOR [R13+40], RBP              ; thread.pseudo-atomic-bits\n;; 0F00:       7402             JEQ L1\n;; 0F02:       CC09             BREAK 9                        ; pending interrupt trap\n;; 0F04: L1:   C740F917001020   MOV DWORD PTR [RAX-7], #x20100017  ; NIL\n;; 0F0B:       C7400117001020   MOV DWORD PTR [RAX+1], #x20100017  ; NIL\n;; 0F12:       488945E8         MOV [RBP-24], RAX\n;; 0F16:       488945E0         MOV [RBP-32], RAX\n;; 0F1A:       E9BB000000       JMP L4\n;; 0F1F:       90               NOP\n;; 0F20: L2:   8B142524144A20   MOV EDX, [#x204A1424]          ; tls_index: *S*\n;; 0F27:       4A8B142A         MOV RDX, [RDX+R13]\n;; 0F2B:       83FA61           CMP EDX, 97\n;; 0F2E:       480F44142528144A20 CMOVEQ RDX, [#x204A1428]     ; *S*\n;; 0F37:       83FA51           CMP EDX, 81\n;; 0F3A:       0F840F010000     JEQ L13\n;; 0F40:       488D7E10         LEA RDI, [RSI+16]\n;; 0F44:       4883EC10         SUB RSP, 16\n;; 0F48:       488975D8         MOV [RBP-40], RSI\n;; 0F4C:       B904000000       MOV ECX, 4\n;; 0F51:       48892C24         MOV [RSP], RBP\n;; 0F55:       488BEC           MOV RBP, RSP\n;; 0F58:       B862934F22       MOV EAX, #x224F9362            ; #&lt;FDEFN ELT>\n;; 0F5D:       FFD0             CALL RAX\n;; 0F5F:       488B75D8         MOV RSI, [RBP-40]\n;; 0F63:       F6C201           TEST DL, 1\n;; 0F66:       0F85CA000000     JNE L9\n;; 0F6C:       4C8BC2           MOV R8, RDX\n;; 0F6F:       49D1F8           SAR R8, 1\n;; 0F72:       4C8945D0         MOV [RBP-48], R8\n;; 0F76:       8B142524144A20   MOV EDX, [#x204A1424]          ; tls_index: *S*\n;; 0F7D:       4A8B142A         MOV RDX, [RDX+R13]\n;; 0F81:       83FA61           CMP EDX, 97\n;; 0F84:       480F44142528144A20 CMOVEQ RDX, [#x204A1428]     ; *S*\n;; 0F8D:       83FA51           CMP EDX, 81\n;; 0F90:       0F84BC000000     JEQ L14\n;; 0F96:       488BFE           MOV RDI, RSI\n;; 0F99:       4883EC10         SUB RSP, 16\n;; 0F9D:       488975D8         MOV [RBP-40], RSI\n;; 0FA1:       B904000000       MOV ECX, 4\n;; 0FA6:       48892C24         MOV [RSP], RBP\n;; 0FAA:       488BEC           MOV RBP, RSP\n;; 0FAD:       B862934F22       MOV EAX, #x224F9362            ; #&lt;FDEFN ELT>\n;; 0FB2:       FFD0             CALL RAX\n;; 0FB4:       4C8B45D0         MOV R8, [RBP-48]\n;; 0FB8:       488B75D8         MOV RSI, [RBP-40]\n;; 0FBC:       F6C201           TEST DL, 1\n;; 0FBF:       7572             JNE L8\n;; 0FC1:       488BC2           MOV RAX, RDX\n;; 0FC4:       48D1F8           SAR RAX, 1\n;; 0FC7:       498BD0           MOV RDX, R8\n;; 0FCA:       4829C2           SUB RDX, RAX\n;; 0FCD:       4881FAE8030000   CMP RDX, 1000\n;; 0FD4:       7C22             JL L5\n;; 0FD6: L3:   4883C602         ADD RSI, 2\n;; 0FDA: L4:   488BC6           MOV RAX, RSI\n;; 0FDD:       48D1F8           SAR RAX, 1\n;; 0FE0:       483B45F0         CMP RAX, [RBP-16]\n;; 0FE4:       0F8C36FFFFFF     JL L2\n;; 0FEA:       488B45E8         MOV RAX, [RBP-24]\n;; 0FEE:       488B5001         MOV RDX, [RAX+1]\n;; 0FF2:       488BE5           MOV RSP, RBP\n;; 0FF5:       F8               CLC\n;; 0FF6:       5D               POP RBP\n;; 0FF7:       C3               RET\n;; 0FF8: L5:   4C8B45E0         MOV R8, [RBP-32]\n;; 0FFC:       49896D28         MOV [R13+40], RBP              ; thread.pseudo-atomic-bits\n;; 1000:       4D8B5D68         MOV R11, [R13+104]             ; thread.alloc-region\n;; 1004:       498D4310         LEA RAX, [R11+16]\n;; 1008:       493B4570         CMP RAX, [R13+112]\n;; 100C:       7747             JNBE L15\n;; 100E:       49894568         MOV [R13+104], RAX             ; thread.alloc-region\n;; 1012: L6:   498D4307         LEA RAX, [R11+7]\n;; 1016:       49316D28         XOR [R13+40], RBP              ; thread.pseudo-atomic-bits\n;; 101A:       7402             JEQ L7\n;; 101C:       CC09             BREAK 9                        ; pending interrupt trap\n;; 101E: L7:   488970F9         MOV [RAX-7], RSI\n;; 1022:       C7400117001020   MOV DWORD PTR [RAX+1], #x20100017  ; NIL\n;; 1029:       488945E0         MOV [RBP-32], RAX\n;; 102D:       49894001         MOV [R8+1], RAX\n;; 1031:       EBA3             JMP L3\n;; 1033: L8:   CC48             BREAK 72                       ; OBJECT-NOT-FIXNUM-ERROR\n;; 1035:       08               BYTE #X08                      ; RDX\n;; 1036: L9:   CC48             BREAK 72                       ; OBJECT-NOT-FIXNUM-ERROR\n;; 1038:       08               BYTE #X08                      ; RDX\n;; 1039: L10:  CC48             BREAK 72                       ; OBJECT-NOT-FIXNUM-ERROR\n;; 103B:       18               BYTE #X18                      ; RSI\n;; 103C:       CC10             BREAK 16                       ; Invalid argument count trap\n;; 103E: L11:  CC18             BREAK 24                       ; UNBOUND-SYMBOL-ERROR\n;; 1040:       00               BYTE #X00                      ; RAX\n;; 1041: L12:  6A10             PUSH 16\n;; 1043:       FF14252800B021   CALL QWORD PTR [#x21B00028]    ; ALLOC-TRAMP-R11\n;; 104A:       E9A9FEFFFF       JMP L0\n;; 104F: L13:  CC18             BREAK 24                       ; UNBOUND-SYMBOL-ERROR\n;; 1051:       27               BYTE #X27                      ; '*S*\n;; 1052: L14:  CC18             BREAK 24                       ; UNBOUND-SYMBOL-ERROR\n;; 1054:       27               BYTE #X27                      ; '*S*\n;; 1055: L15:  6A10             PUSH 16\n;; 1057:       FF14252800B021   CALL QWORD PTR [#x21B00028]    ; ALLOC-TRAMP-R11\n;; 105E:       EBB2             JMP L6\n</pre>\n<p>\n… this is almost a manageable amount of assembler, though I don’t\nclaim to understand all of it. If I needed more speed, though, I could\ndig into the assembler as a way to try and ferret out even more\nefficiency.\n</p>\n</div>\n</div>\n<div>\n<h2>Summary</h2>\n<div>\n<p>\nWe went from our initial POC in very functional-looking Clojure,\nrunning at 250 kHz, to optimized Common Lisp running at 100,000,000 /\n1467 msec = 68.2 MHz, which is nearly 300x faster.\n</p>\n<p>\nChecking our intuition about how fast this really is: my processor is\n2.7 GHz, and our processing rate is 68.2 MHz, meaning we’re spending\nabout 40 clock ticks per event, which doesn’t strike me as too bad.\n</p>\n<p>\nIn the end, we made the following changes to our initial attempt:\n</p>\n<ul>\n<li>Separated out the initial event time-sequence generation as a\nseparate step;</li>\n<li>Rewrote the algorithm as a single loop;</li>\n<li><code>declaim</code>’ed optimizations to the compiler;</li>\n<li>Type-hinted the input array, the variables used in the time\ndifference calculation, and the loop upper bound.</li>\n</ul>\n<p>\nWe also touched on profiling (which didn’t provide much benefit this\ntime, but can be very useful generally), and showed how to inspect the\ngenerated assembler code.\n</p>\n</div>\n</div>\n<div>\n<h2>Conclusion</h2>\n<div>\n<p>\nCommon Lisp can be made pretty fast! I should write a C-language\nversion of this toy problem to compare. The final code is not nearly\nas beautiful as the original, but without too much effort we got much\nfaster code. I’ll conclude with this line from ANSI Common Lisp:\n“Lisp is really two languages: a language for writing fast programs\nand a language for writing programs fast.” It seems quite powerful to\nme to have both of these on hand.\n</p>\n</div>\n</div>\n<div>\n<h2>Footnotes: </h2>\n<div>\n<div><sup><a href=\"http://zerolib.com/feed.clojure.xml#fnr.1\">1</a></sup> <div>Reasonable people can\ndisagree on the relative expressiveness of languages; for me, Lisps\nwin on expressiveness because I can bend the language to my will using\nmacros in a way that I cannot with non-Lisps.</div></div>\n<div><sup><a href=\"http://zerolib.com/feed.clojure.xml#fnr.2\">2</a></sup> <div>See Paul\nGraham, <a href=\"http://www.paulgraham.com/onlisp.html\">On Lisp</a>, p. vii</div></div>\n<div><sup><a href=\"http://zerolib.com/feed.clojure.xml#fnr.3\">3</a></sup> <div>Paul Graham, ANSI Common Lisp</div></div>\n<div><sup><a href=\"http://zerolib.com/feed.clojure.xml#fnr.4\">4</a></sup> <div>Peter\nNorvig, Paradigms of Artificial Intelligence Programming: Case Studies\nin Common Lisp</div></div>\n<div><sup><a href=\"http://zerolib.com/feed.clojure.xml#fnr.5\">5</a></sup> <div>The original Clojure code reported the entire sequence of eight times for each triggered event, but we omit that level of detail for clarity. Since the triggered clusters are rare, this doesn’t significantly impact the timing measurements.</div></div>\n</div>\n</div></div>\n<div>\n<p>Date: 2019-09-25</p>\n<p>Author: John Jacobsen</p>\n<p>Created: 2019-09-27 Fri 11:22</p>\n<p><a href=\"http://validator.w3.org/check?uri=referer\">Validate</a></p>\n</div>",
   :direction "ltr"},
  :updated 1569369600000,
  :entities
  [{:mentions [{:text "Speed"}],
    :id "nlp/f/entity/wd:108006",
    :salienceLevel "mention",
    :label "Speed"}
   {:mentions [{:text "Common Lisp"}],
    :id "nlp/f/entity/wd:849146",
    :salienceLevel "mention",
    :label "Common Lisp"}
   {:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "RSI"}],
    :id "nlp/f/entity/wd:877796",
    :salienceLevel "mention",
    :label "repetitive strain injury"}
   {:mentions [{:text "RDX"}],
    :id "nlp/f/entity/wd:190020",
    :salienceLevel "mention",
    :label "cyclonite"}],
  :alternate
  [{:href "http://zerolib.com/from-elegance-to-speed.html",
    :type "text/html"}],
  :title "From Elegance to Speed",
  :author "John Jacobsen",
  :published-str "Tue Sep 24 17:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16d739e6cba:2a89e26:ad5391a1",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url "http://zerolib.com/plane.jpg",
   :width 1058,
   :height 349,
   :contentType "image/jpeg"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "http://zerolib.com/from-elegance-to-speed.html",
  :updateCount 1,
  :commonTopics
  [{:score 97.48557200851296,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 28.428751141992016,
    :id "nlp/f/topic/3000",
    :salienceLevel "about",
    :label "artificial intelligence"}],
  :published 1569369600000,
  :fingerprint "c5efdadf",
  :canonicalUrl "http://zerolib.com/from-elegance-to-speed.html"}
 {:engagement 27,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1569499433911,
  :content
  {:content
   "<h3><strong>Performance — a gaze through the functional prism</strong></h3><figure><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/1024/1*BJfx4-ioB8CCnxcZvw_JFA.png\"></figure><p>I’m a functional programmer. There, I said it.</p><p>What do I mean by that?</p><p>Over the course of my career as an engineer I started to identify some phases that we, developers, go through in our career:</p><ol><li>Novice — <em>“I have no idea what I’m actually doing, but I’m giving it an enthusiastic effort”</em></li><li>Opinionated novice — <em>“I’ve been coding for a living for the last X years — trust me when I tell you that without ORM and Dependency Injection all code is crap”</em></li><li>Intermediate — <em>“I’ve just started to know what I don’t know”</em></li><li>Opinionated intermediate — <em>“Hmm… I think I connect more to X than Y because of A, B and C”</em></li></ol><p>After stage 4, all sorts of hells can occur — you could get promoted to being a tech-lead, manager or even start your own company.</p><p>What does usually happen after stage 4 is that you come to a stage in life when you’re old enough and experienced enough (those two usually go hand in hand), that you usually surround yourself with technologies you relate to the most.</p><p>That being the case, I chose a few years ago to become a functional programmer. I’ve spoken about the “why” in depth in my two previous entries about Clojure, but the fact remains that this was a conscious choice. After a few years of hacking away at functional code, what usually happens is that someone comes to you and tells you that functional code is less performant than its non-functional alternative. Why? The reasons can vary but they usually revolve around the “cost” of immutability and some specific design decisions of the language used (such as it being dynamically typed for example). So, the rest of the post will deal with that question — is performance the sole consideration that we need to take into account when writing new code.</p><h3>Show Me the Code</h3><p>Let’s look at the following code snippets:</p><p>In Java:</p><pre>public int sumSquares(int[] rangeOfNums) {<br>   int sum = 0;</pre><pre>   for (int i:rangeOfNums) {<br>       int temp = i * i;<br>       sum += temp;<br>   }</pre><pre>   return sum; <br>}</pre><p>And now in Clojure:</p><pre>(<strong>defn</strong> sum-squares [range-of-nums]<br>  (<strong>->></strong> range-of-nums<br>  (<strong>map</strong> #(<strong>*</strong> % %))<br>  (<strong>reduce</strong> +)))</pre><p>I like this example, a lot. The problem solved above is how to sum the square value of every number in a list of numbers. I brazenly stole this example from <a href=\"https://channel9.msdn.com/Blogs/pdc2008/TL11\">Luca Bolognese’s introductory talk to F#</a> and I’ve been using it ever since to illustrate functional thinking.</p><p>Is there a difference between the solutions?</p><p>Well, the first major difference is conceptual — when we, as software engineers, are faced with the simple problem of summing the square value of every element in an array, we simply say: “what’s the problem?”</p><ol><li>you use a helper variable</li><li>iterate over the array</li><li>calculate the square value of each item, and</li><li>add it to the helper variable.</li></ol><p>Once you’re done — return the helper variable’s value as the answer.</p><p>This is basically what we did with the Java example. This is a very imperative and straightforward “first-year computer science” exercise.</p><p>On the other hand, if you’d ask any non-developer the exact same question, they’d just say: “Well, just square all the values and then sum them up”. Which is exactly what is written in the Clojure solution.</p><p>What I’m trying to illustrate is that we, as developers, are so ingrained in years of schooling/work of imperative and OOP (Object Oriented Programming) paradigms that the functional thought, which is closer to a “day-to-day” way of thinking, seems hard to grasp at first.</p><p>The other, most significant difference between these two examples, is in the performance tradeoffs. I won’t go into why (there’s enough out there to read through), but what you should always keep in mind is this — the higher the abstraction, the costlier it is in terms of performance.</p><p>That being the case, why are we seeing a rise in functional programming languages? If most of them are less performant than their OOP/procedural/imperative counterparts, why use them at all?</p><p>Even here, at AppsFlyer, being mainly a Clojure shop, I get asked quite often about this hefty cost. I’d like to present my answer, through these following points</p><ul><li>Code velocity</li><li>Performance test skew</li><li>Readability and maintainability</li></ul><h3>Code Velocity</h3><p>The higher the abstraction, the less code you need to write (usually). And this, in short, allows for faster time-to-market. If I can write my next feature faster, it means that my client will be able to enjoy it faster, and I can grow my business more rapidly.</p><p>Hence, the notion about velocity. The JVM is a very robust and excellent VM. When writing Clojure code, I can accomplish the exact same things that I can in Java, most of the time with fewer lines of code. While this is not a huge accomplishment in itself, the fact that functional languages usually do away with all the “boilerplate” of OO code and allow us to focus on writing the business logic, is a huge benefit when it comes to velocity, in my opinion. In my previous posts I went into detail about how FP (Functional Programming) changes the way we reason about the problem space as opposed to OOP — I think this always contributes to the aspect of velocity, at least mentally.</p><h3>Performance Testing</h3><p>It’s true that the code samples above vary greatly in performance, even in an order of magnitude or more in favor of the Java code — but that’s testing one single function in a very limited scope.</p><p>At AppsFlyer scale, our service is usually comprised of dozens of threads, each doing various tasks, be they CPU-bound or IO-bound. Let’s say we’ve “solved” the performance problem of the specific function written above, we then need to explore how it impacted the entire service? What happens if your service is actually IO-bound most of the time, will improving a single CPU bound function even register? Moreover, a lot of the hard work and complex operations we do in programming revolve around concurrency and parallelism. And in this context, FP languages usually provide us with safe and sensible idioms of work — usually via immutability. This ultimately enables us to write complex async mechanisms in a really simple manner.</p><p>When trying to solve the same thing in an OOP language, the margins of error we have when writing that same concurrent/parallel code are much higher. This also validates the first point regarding velocity, but I’d also like to re-emphasize the fact that testing only specific parts of the service can distort our benchmarking. While we can improve issue X by an order of magnitude, it might have close-to-zero impact on the rest of the service.</p><h3>Reliability &amp; Maintenance</h3><p>Reshef, AppsFlyer’s co-founder and CTO, likes to say that the code we write “lives” most of its “life” in production — not in our IDE.</p><p>That being the case, the ease of changing the code and re-visiting it in the future is essential to our velocity. Fewer lines of code mean less to read and change. Also, working within safe idioms of parallelism and concurrency in our code base will allow us to better maintain it.</p><p>I’d like to look at this via the following quote from Michael Feathers: <a href=\"https://twitter.com/mfeathers/status/29581296216?lang=en\">“FP makes code understandable by minimizing moving parts”</a>. I agree with this statement wholeheartedly. Since we have less “moving parts” in our functional code, it’s usually more reliable because we have fewer “things” that can “break”. As a direct result, if things <em>do</em> break, it’s usually easier to find the problem since there are fewer “moving parts”. Finding the problem is usually 90% towards solving the problem. This “less moving parts” notion lends itself directly to a more reliable and maintainable code base.</p><h3>Final Thoughts</h3><p>So what point am I really trying to get across in this post? Well, as always, it’s more of a way of thought than an actual call to action.</p><p>I encourage you to embrace the notion that less performant is not always <em>Bad</em>. Nor is it always <em>Good</em>.</p><p>It’s really just one more aspect we have to take into account when writing our code.</p><p>The decision making matrix can be complex at times, and there is no universally true or correct answer.</p><p>If performance was the only consideration when building complex systems, we’d still be writing in Assembly (or, hopefully, at least in C). If the only consideration was readability and velocity, we’d be writing in some higher level abstraction.</p><p>The fact that there are, still, in 2019, a plethora of programming languages and paradigms, just serves to show us that there are a diversity of considerations to take into account when building systems — whether it’s the business impact, system thinking as a whole, or other considerations, specific to our engineering organization and architecture.</p><p>There is no “Silver Bullet”, not in databases, not in programming languages, not in readability vs. performance, and certainly not in real life. That’s why, when taking all of this into account, we need to make a case by case decision.</p><p>Don’t be afraid to write less performant code if it serves your organization better. If you’ve hit a brick wall in terms of performance and/or cost, be sure to profile the hell out of the problem before you commit to a solution.</p><p>And also be sure to keep in mind that you should not be afraid to mix paradigms — maybe you can write high level application code, and low level infrastructure code. Maybe you can integrate them together, a lot of the time Clojure libraries “fall back” to “lower level” Java code in order to benefit from performance. The answers are plentiful and out there, just take into consideration that writing code is more than just writing, it’s the entirety of it. This is the type of holistic approach and thinking that will benefit you the most as a developer.</p><img width=\"1\" src=\"https://medium.com/_/stat?event=post.clientViewed&referrerSource=full_rss&postId=a3c41c4795b0\" height=\"1\"><hr><p><a href=\"https://medium.com/appsflyer/performance-a-gaze-through-the-functional-prism-a3c41c4795b0\">Performance — a gaze through the functional prism</a> was originally published in <a href=\"https://medium.com/appsflyer\">AppsFlyer</a> on Medium, where people are continuing the conversation by highlighting and responding to this story.</p>",
   :direction "ltr"},
  :updated 1569496238000,
  :entities
  [{:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "Java"}],
    :id "nlp/f/entity/wd:251",
    :salienceLevel "mention",
    :label "Java"}
   {:mentions [{:text "OOP"} {:text "Object-Oriented Programming"}],
    :id "nlp/f/entity/wd:79872",
    :salienceLevel "mention",
    :label "object-oriented programming"}
   {:mentions [{:text "AppsFlyer"}],
    :id "nlp/f/entity/wd:20050673",
    :salienceLevel "mention",
    :label "AppsFlyer"}
   {:mentions [{:text "functional programming"}],
    :id "nlp/f/entity/wd:193076",
    :salienceLevel "mention",
    :label "functional programming"}],
  :alternate
  [{:href
    "https://medium.com/appsflyer/performance-a-gaze-through-the-functional-prism-a3c41c4795b0?source=rss----2736d8c2498d---4",
    :type "text/html"}],
  :title "Performance — a gaze through the functional prism",
  :author "Nir Rubinstein",
  :published-str "Thu Sep 26 04:10:38 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16d6d74cbb7:2337a04:69b9f616",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url
   "https://cdn-images-1.medium.com/max/1024/1*BJfx4-ioB8CCnxcZvw_JFA.png",
   :width 1024,
   :height 491,
   :contentType "image/png"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://medium.com/p/a3c41c4795b0",
  :commonTopics
  [{:score 66.97049106202856,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.981,
    :id "nlp/f/topic/1555",
    :salienceLevel "about",
    :label "net"}
   {:score 0.898,
    :id "nlp/f/topic/1871",
    :salienceLevel "about",
    :label "quant"}
   {:score 0.875,
    :id "nlp/f/topic/334",
    :salienceLevel "about",
    :label "browsers"}
   {:score 0.766,
    :id "nlp/f/topic/774",
    :salienceLevel "mention",
    :label "engineering"}
   {:score 0.737,
    :id "nlp/f/topic/52",
    :salienceLevel "mention",
    :label "agile"}],
  :published 1569496238000,
  :fingerprint "56d2bb89",
  :canonicalUrl
  "https://medium.com/appsflyer/performance-a-gaze-through-the-functional-prism-a3c41c4795b0?source=rss----2736d8c2498d---4"}
 {:engagement 7,
  :unread false,
  :crawled 1569480286311,
  :recrawled 1569676442412,
  :content
  {:content
   "<p>Nil punning is a feature of Lisp. It began when nil was both the empty list and the false value. Two meanings for the same thing led to the idea of punning. Lispers liked it. And now, Clojure carries the tradition forward. In Clojure, nil has different meanings in different contexts. Is it good? Is it bad? We explore it in this episode.</p>\n<p></p>\n<p></p>\n<h2>Transcript</h2>\n<p>Eric Normand: What is nil punning? In this episode we’re going to go over the benefits, some of the disadvantages of nil punning and dive into what this is all about — its origins and things like that.</p>\n<p>My name is Eric Normand and I help people thrive with functional programming. The folks at Functional Design in Clojure recently, a couple days ago, put out an episode called, “What is nil punning?” Same as my episode.</p>\n<p>It’s a great episode, you should go listen to it. I wanted to throw in my two cents into this discussion. Think podcasts could be a lot more back and forth between different podcasts, just like blogs used to be back in the day. This is my addition, my response to their episode.</p>\n<p>Why is it called nil punning? I think that’s important to talk about. When you have a word that has two meanings, that word can be used in some sentences, some wordplay where the sentence now has these two meanings. It’s a fun thing that the same sentence can be read twice in two different ways.</p>\n<p>That’s what nil punning is, that nil has different meanings in different contexts. You can treat it like different things in different contexts, and have the same wordplay going, same kind of pun. That’s why it’s called punning.</p>\n<p>The original nil punning was in Lisp, as far as I can tell. The idea in Lisp was that nil represented the empty list. Nil was the empty list. When you had these cont cells that would point to the next list, the last one would point to nil to represent, “OK, that’s it. We’re done. You can stop, you know, looping through these cont cells.”</p>\n<p>Then nil was also false. If you had an if statement and one of the things would turn nil, it would go to the next line. It would go to the else branch. You could pun it. It was this thing that represented both the empty list and falsehood.</p>\n<p>Then, another thing that happened was, well if nil is false, you have an if statement that the test is a nil expression, returns nil, that makes everything else must truthy. Everything else must be a true value. Then, it would do the then branch.</p>\n<p>You had this cool thing where you could say, “If tale, or if cutter of this list, and if the cutter was nil,” you didn’t have to say, “equals nil, cutter of the list.” You didn’t have to do the equals nil or not equals nil because it was a Boolean also. If you had it nil represented no answer. It’s a third meaning for it. Not only is it, there’s the empty list, it’s also no answer.</p>\n<p>Now you could say “Do I have an answer?” just by naming the thing. People liked this in Lisp. It felt really nice and natural. There’s, in fact, a whole poem about, what would happen if you systematically got rid of the nil punning in Lisp, and how much of your code would grow because you’re constantly having to check if this is nil?</p>\n<p>You compare it to nil, instead of just, this nice, elegant if x, meaning if I have an x, if x is not nil, if x, do this. Otherwise, do that. It explodes. Nil punning has been there for a long time. Fast forward 50 years to a Clojure and there’s a lot more than cont cells and atoms, symbols, the few things that the original Lisp had.</p>\n<p>There’s a lot more, and especially, there’s a lot more data structures. Things are based on interfaces, abstractions. You have the sequence abstraction. You have the associative abstraction. There’s more. Now, it’s like, what does nil mean in each of those contexts?</p>\n<p>In Clojure, if you use a nil value in an associative context, let’s say you associate a new key value pair onto a nil, it will promote it into a HashMap. If you conj onto a nil, you treat it like just a generic collection that can add new items to it, that nil will be promoted into a list. That’s the round braces list, etc. Every abstraction has a meaning for what you do with a nil.</p>\n<p>This is another of punning and now nil has all these different meanings in different context. It’s fun, you pawn, you pun. It did change stuff though. Clojure got rid of nil being the empty list and nil being the falsey value. Nil is not the empty list. They’re not the same.</p>\n<p>There’s an empty list which is when you print it out, it’s two parens. You can just type two parens and it’ll make the empty list. The empty list is a truthy value, while nil is a falsey value.</p>\n<p>Also, because Clojure’s on the JVM, Clojure has Booleans. It has a true and false value, a type that is true and false. Nil is not equal to false. They’re different. Nil is still falsey. Nil and false are the two values that will fail a test in an if statement, but they’re not equal.</p>\n<p>That’s one of the objections that people have to nil punning. Is that they say, “Isn’t this just another version of weak typing?” I would argue no, it is not a version of weak typing. Nil is just a value that is not equal to anything else.</p>\n<p>When people are talking about weak typing, they mean stuff like how in JavaScript, you will do stuff like zero and you use the double equals so 0 == 0. Obviously, that’s true. It should be true. 0 == the array with zero in it. The singleton array with zero in it. That’s true.</p>\n<p>Then you do 0 == false, then that’s true. How is zero equal to false? Does that mean that false is equal to the array with zero in it? It just doesn’t compute. In Clojure, that doesn’t happen. We don’t compare across types in that way with equals.</p>\n<p>What nil is, it’s a value that has a meaning in this different context, just like a HashMap has a different meaning from a vector in the same context. This nil value in that context has a meaning. It’s like a type. It has its own implementation of those different interfaces.</p>\n<p>They believe me on the weak typing. Let’s assume that they believe me, hypothetically. It’s not weak typing.</p>\n<p>There’s another issue which they bring up and I bring it up too. This is a real issue. You don’t know where the nil came from. You have some nil and just some background.</p>\n<p>In Clojure, since nil has a meaning in every context, almost every context, what happens is a nil value is perfectly valid. Nothing’s going to throw an exemption because it’s there and it keeps working like any other value that’s valid. In fact, nil is valid in way more context than any other value. At some point, will throw an exemption.</p>\n<p>You try to do something with it. You call a method on it and now you get a null pointer exemption. Where did that come from? This value started way up here and got changed here and then this other thing replaced it. Where in that chain did the nil come from?</p>\n<p>You could say that this is the same problem that you have in Haskell with maybe. In my experience with Haskell, when you have a maybe and you’re using it monastically so that a nothing, so the version that’s the analogy with nil in Clojure, you have nothing.</p>\n<p>Once you have a nothing, that whole maybe is going to be a nothing. The whole chain, so you’re chaining all these computations. Once you have a nothing somewhere in that chain, the rest of it is going to be a nothing. You just get a nothing at the end and you don’t know which link in the chain caused it to be nothing.</p>\n<p>You have this problem that you don’t know where it came from, but that’s not really what they’re saying. That is a minor inconvenience, but that’s not really what they’re saying. What they’re saying is in Clojure, you don’t even know that nil was possible in that chain. Whereas in Haskell, you knew that nothing was possible because you were using a maybe type. The type checker was telling you, you can have a nothing.</p>\n<p>Whereas in Clojure, you called some Java methods and you did some stuff, at some point somewhere, you got a nil and you didn’t even know. The semantics of Java is that you can return nil from anything that returns an object. It just appears out of nowhere, then it flows through your program, and you don’t know where that nowhere was.</p>\n<p>It appears out of somewhere. [laughs] It’s not out of nowhere. It’s out of somewhere, but you don’t know where it was, and it’s very hard to track down. It would be much nicer if there was some kind of error semantics for nil somewhere so that it would have caught it sooner, at development time.</p>\n<p>You would have been like, “Oh, boom. I called this method, it returned nil, it explodes, and tells you exactly where that nil came from.” It doesn’t do that. The nil will flow through and have different meanings in all the contexts it goes through. Then at some point, you get the answer. You’re like, “Where did this nil come from?” That is a problem in Clojure.</p>\n<p>Why do we like nil punning in Clojure? We have to take a look at the JVM. The JVM has nulls. It also has this problem of methods returning null that are not part of the typed signature. Nothing says, “This method’s not going to return null.” In fact, a lot of methods do return null when you wouldn’t expect it to.</p>\n<p>In fact — I know it’s not a best practice, but it happens — Something will say, “Well, I return a list of answers, but if there’s no answers, I return null.” It’s unfortunate. This happens in JavaScript, too. It returned null. In ClojureScript, we have the same semantics of nil punning.</p>\n<p>What’s annoying is that when you get the empty list, you can run a method on it. If you got a list, you can run a method on it. You can map over it, or whatever you can do in JavaScript, you can run a map on it. In Java, you can do other things. You can get an iterator from it or something. Because they’ll have the possibility of returning null, you have to check before you run a method on it. You say, “If this is not null, then iterate over it, and do this thing with every element.”</p>\n<p>Where in Clojure, we treat the nil like an empty collection. It’s the same code. We just say, “Iterate over this.” Whether you get an empty collection, a collection with elements in it, or you get a nil, the code is the same. In a lot of cases, this is better.</p>\n<p>Considering the constraints of the JVM, this does solve a lot of the problems. Not every problem has that problem I just talked about, but it solves so many problems. I run my site on WordPress, so it’s PHP. This problem is everywhere.</p>\n<p>Some functions return false. Some functions return null. Some functions return an empty array. You have to check before you iterate over a thing every single time. The thing is, you’re going to forget one time. If you forget that one time, then, your software crashes. The page doesn’t load.</p>\n<p>It becomes an idiom. Is this thing empty? No. OK. Now, I’m going to iterate over it. Why don’t you just iterate over the empty thing? In Clojure, it’s built into the language. You could put some wrapper around it that returns it like turns a null into an empty array. Something like that would be really helpful.</p>\n<p>In Clojure, it’s built in that nil because it has a context in this as an iterable thing. We call it the sequence abstraction because you can iterate over it like you can iterate over a collection. We don’t have that same trouble. Like I said, this solves a ton of problems. Not all of them.</p>\n<p>Sometimes it can get awkward because nils and false, they’re both falsey and you want the false values, you don’t want the nils. You have to be very choosy about how you pick out values from a collection. If you just OR them all together, you lose all the nils and falseys in the same.</p>\n<p>There’s problems and you got to be careful with them, but it does solve a lot of problems at the same time. I think I left something open that I can’t remember now. I’m just going to close this out and hope I’ll think of it before I finish the episode.</p>\n<p>Nil punning basically means nil has different meanings in different contexts. You can play with the different contexts, same value in different contexts, and treat, for instance, if you’re in a Boolean context, if you’re doing an if statement, you can treat it like a Boolean. If you’re doing an iteration, you can treat it like a collection, etc.</p>\n<p>It makes things nice. We like it. It makes the idioms that we use very concise. The original nil punning was just the two things is that nil was the empty list and it was a falsey. I guess the third thing is that it represented no value, if you had no answer.</p>\n<p>They kind of work together. Falsey is like no truth. [laughs] The empty list is no rest of a list, so there’s no answer to the question, what’s the rest of the list? They kind of work together and it was a very tight little thing in the original Lisp.</p>\n<p>Clojure has a lot more abstractions, a lot more context, basically, for nil to have a meaning. Nil takes on meanings in all those contexts. Nil becomes a thing that can be passed around and be meaningful.</p>\n<p>Unlike in Java, for instance, where the only thing you can really do with a value that might be no is check if it’s no. Is this thing no before you move on to calling methods on it?</p>\n<p>It’s not week typing because we’re not saying that nil is equal to false. We’re not saying that nil is equal to the empty list. It’s simply that like different types, it has different meanings in different contexts.</p>\n<p>Just like a HashMap has a different meaning from a vector. Even though you can iterate over both of them, it has different meanings. The nil also has a meaning in that context.</p>\n<p>There is a problem which is that you don’t know where the nil came from. Some function, some method that you called, somewhere in your code produced a nil and you weren’t expecting it.</p>\n<p>Often it will get threaded through till the end of the calculation, and you have it there. You don’t know what to do with it. You don’t know where it came from. You didn’t expect it. Haskell does not have nulls, but it does have maybes, and the nothing is the most analogous thing to nil or a null in Clojure.</p>\n<p>At least you know that nothing is possible in Haskell because it’s part of the type, and the types are consistent. I didn’t think of the thing. Maybe I’ll have to do another episode.</p>\n<p>If you like this episode, you should check out the Functional Design in Clojure episode that came out. It’s episode 47, came out September 20th. It’s called, “What is nil punning?” It’s a good podcast. You should subscribe to it if you’re into Clojure.</p>\n<p>They have a real knack for explaining a lot of stuff in Clojure but over voice, which is not the easiest thing to do. If you like this episode, you like this podcast, you can find the past episodes at lispcast.com/podcast. There you’ll find audio, video, and text versions of all of the past episodes. You can consume it however you like.</p>\n<p>You’ll find some links to subscribe. If you want to subscribe to the podcast, or to the videos, it’s on YouTube. You can also just get the text as RSS, whatever you like. You’ll also find links to social media where I love to get into these discussions. Nil punning is a touchy subject. I try to be careful. I don’t think it solves all problems.</p>\n<p>I think it solves a lot of problems. Some people are so fed up with it. They’re like, “I want types. Get me out of here.” Let me know what side of the fence you are on in that. Do you like types? Do you think types solve this problem once and for all? I think that this is a big topic, so I’d love to hear your opinions on it.</p>\n<p>Awesome. I’m going to close out now. I really thought I would think of it. This has been my thought on functional programming. My name is Eric Normand. Thank you for listening. As always, rock on.</p>\n<p>The post <a rel=\"nofollow\" href=\"https://lispcast.com/what-is-nil-punning/\">What is Nil Punning?</a> appeared first on <a rel=\"nofollow\" href=\"https://lispcast.com\">LispCast</a>.</p>",
   :direction "ltr"},
  :updated 1569477600000,
  :entities
  [{:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "Lisp"}],
    :id "nlp/f/entity/wd:132874",
    :salienceLevel "mention",
    :label "Lisp"}
   {:mentions [{:text "Haskell"}],
    :id "nlp/f/entity/wd:34010",
    :salienceLevel "mention",
    :label "Haskell"}
   {:mentions [{:text "Boolean"}],
    :id "nlp/f/entity/wd:520777",
    :salienceLevel "mention",
    :label "Boolean data type"}
   {:mentions [{:text "functional programming"}],
    :id "nlp/f/entity/wd:193076",
    :salienceLevel "mention",
    :label "functional programming"}],
  :alternate
  [{:href "https://lispcast.com/what-is-nil-punning/",
    :type "text/html"}],
  :title "What is Nil Punning?",
  :author "Eric Normand",
  :published-str "Wed Sep 25 23:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16d6c50a067:2129f76:97b0c8f7",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url
   "https://lispcast.com/wp-content/uploads/2019/09/What-is-Nil-Punning_.jpg",
   :width 1280,
   :height 720,
   :contentType "image/jpeg"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://lispcast.com/?p=2036",
  :updateCount 1,
  :commonTopics
  [{:score 78.63413948766706,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1569477600000,
  :fingerprint "4247dc38",
  :canonicalUrl "https://lispcast.com/what-is-nil-punning/"}
 {:engagement 6,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1569457627310,
  :content
  {:content
   "The inimitable Chouser has written an exhaustive analysis of the many ways to flatten a sequence of sequences in Clojure. We are in complete agreement on the subject of flatten: Don’t use it. It’s much more complicated than it looks, and could come back to bite you later. As for myself, I would usually write… <p><a href=\"https://stuartsierra.com/2019/09/25/sequences-in-flatland\">Read the full article</a></p><img alt=\"\" width=\"1\" src=\"http://feeds.feedburner.com/~r/StuartSierra/~4/gq0y7dSPR1I\" height=\"1\">",
   :direction "ltr"},
  :updated 1569455324000,
  :entities
  [{:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "about",
    :label "Clojure"}],
  :alternate
  [{:href
    "http://feedproxy.google.com/~r/StuartSierra/~3/gq0y7dSPR1I/sequences-in-flatland",
    :type "text/html"}],
  :title "Sequences in Flatland",
  :author "Stuart",
  :published-str "Wed Sep 25 16:48:44 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16d6af6e0ae:1fa2c7c:97b0c8f7",
  :visual {:url "none"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://stuartsierra.com/?p=1194",
  :commonTopics
  [{:score 0.794,
    :id "nlp/f/topic/262",
    :salienceLevel "mention",
    :label "bioinformatics"}],
  :published 1569455324000,
  :fingerprint "d31ec51c",
  :canonicalUrl
  "http://feedproxy.google.com/~r/StuartSierra/~3/gq0y7dSPR1I/sequences-in-flatland"}
 {:engagement 17,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1569285760454,
  :recrawled 1569442903145,
  :content
  {:content
   "<img alt=\"Moving to Spacemacs for Scala and Python\" src=\"https://samritchie.io/content/images/2019/09/68747470733a2f2f7777772e6e61737365722e73706163652f696d67732f73706163656d6163732d6c6f676f2e706e67.png\"><p>I've just finished retooling my development environment, and the process was annoying enough that I thought I'd write it up here, for myself in the future, and for you in the present.</p><p><strong>tl;dr; I ended up porting my old Emacs config, based on the literate emacs24-starter-kit, over to Spacemacs, and ended up with a great Scala and Python setup.</strong></p><p>Read on for the details.</p><h2>Goals</h2><p>I've been an Emacs user since my first days with Clojure, and I'm hooked, fully in love. Those Clojure days were a long time ago; as I've spent more time developing in Scala and Python, I've made do with basically just code formatting and syntax highlighting, delegating to an external build tool like SBT in a terminal window to give me compilation feedback every so often. My Emacs config is crusty and old, and way out of date.</p><p>I've been working on ScalaRL (<a href=\"https://github.com/sritchie/scala-rl\">github page</a>, <a href=\"https://www.scalarl.com/\">microsite</a>), a functional, monadic reinforcement learning framework in Scala, and I've been feeling the pain of my setup. It was time for an overhaul.</p><p>I had two goals this weekend:</p><ul><li>Upgrade my Emacs config to support <a href=\"https://scalameta.org/metals/docs/editors/emacs.html\">Metals</a>, the latest and greatest (and only!) Emacs... IDE? out there today.</li><li>Understand the absolutely insane world of Python packaging well enough that I could dig into some of the latest deep learning examples out there in a reproducible way, more similar to the self-contained Clojure and Scala projects I'm used to.</li></ul><h2>Spacemacs</h2><p>Reading about modern Emacs configs it became clear that my old strategy of just manually installing packages that seemed nice had led me into a hellish, non-reproducible setup. I decided to declare bankruptcy and start again with <a href=\"http://spacemacs.org/\">Spacemacs</a>.</p><p>Spacemacs is a batteries-and-steroids-included configuration for Emacs designed to lure you into a modal style of editing, like <a href=\"https://www.vim.org/\">Vim</a> provides. It also provides a large number of community-provided &quot;layers&quot;, which are declarative bundles of packages and config hooks designed to add support for different features and languages to Spacemacs.</p><p>The <a href=\"http://develop.spacemacs.org/layers/+lang/scala/README.html\">Scala layer for Spacemacs</a> looked great, and had support for <a href=\"https://scalameta.org/metals/docs/editors/emacs.html\">Metals</a>, a Scala language server designed to give IDE-like functionality to a bunch of different editors. (<a href=\"https://ensime.github.io/\">Ensime</a> is dead! Long live Ensime!)</p><p>The Python mode looked great too.</p><h3>Installation</h3><p>Here's what I did to install Spacemacs:</p><p>First, I went through my <code>.bashrc</code> file and culled out all of the old crap that had accumulated over multiple jobs and many years of building up an environment. The biggest thing I did was to delete any reference to Macports from my machine and my path. The multiple-installation ecosystem for Ruby and Python has always been a pain for me; I suspect that's due to a Linux environment that I built up over years without really knowing what was going on under the hood.</p><p>Next, I moved my old <code>$USER/.emacs.d</code> directory to <code>$USER/emacs.d.old</code> so I could reference its settings, and as backup in case I botched what came next.</p><p>I deleted my old emacs installation with <code>brew uninstall emacs</code> and killed my alias in <code>/Applications/Emacs.app</code>, then reinstalled the latest and greatest Emacs with the instructions in the <a href=\"https://github.com/syl20bnr/spacemacs/blob/develop/doc/BEGINNERS_TUTORIAL.org\">Spacemacs beginner's tutorial</a>.</p><ul><li>First, install <a href=\"https://brew.sh/\">Homebrew</a>.</li><li>Run these two commands:</li></ul><pre><code>brew tap d12frosted/emacs-plus\nbrew install emacs-plus\n# brew linkapps emacs-plus</code></pre><p>The final, commented-out command won't work anymore, since Homebrew no longer has a <code>linkapps</code> subcommand. Instead, run this to create a symlink in your Applications directory:</p><pre><code>ln -s /usr/local/opt/emacs-plus/Emacs.app /Applications</code></pre><p>To install Spacemacs itself, run the following commands:</p><pre><code>git clone https://github.com/syl20bnr/spacemacs ~/.emacs.d\ncd ~/.emacs.d\ngit checkout 3e93dec6635bf54fa8a36ac8da6d6b98a9775541\n</code></pre><p>This will get Spacemacs up to the revision I used in my configuration, which I know works great for Scala and Python development with <a href=\"https://github.com/sritchie/spacemacs.d\">my spacemacs.d config</a>.</p><p>If you want the fresh Spacemacs experience, you can go ahead and launch <code>Emacs.app</code> by double-clicking the new icon in your <code>/Applications</code> folder and following the rest of the <a href=\"https://github.com/syl20bnr/spacemacs/blob/develop/doc/BEGINNERS_TUTORIAL.org#installation-and-setup\">beginner's tutorial here</a>.</p><p>Read on for more details about my specific configuration. I'm still using Spacemacs in &quot;holy-mode&quot;, or Emacs mode, ie, without the Vim keybindings. I'll work on that next.</p><h2>Configuring Spacemacs</h2><p>Here's my old <a href=\"https://github.com/sritchie/emacs.d\">Emacs config directory</a>, based on the <a href=\"https://github.com/eschulte/emacs24-starter-kit\">emacs24-starter-kit</a> and now almost a decade old.</p><p>Spacemacs completely commandeers <code>.emacs.d</code>; instead of writing config there, you get to play in either a <code>.spacemacs</code> file or a <code>.spacemacs.d</code> directory. Either way, Spacemacs generates a big template config for you that you can modify as you get started.</p><p>I did the latter, and once I got everything converted I pushed the whole directory to Github. It lives at <a href=\"https://github.com/sritchie/spacemacs.d\">https://github.com/sritchie/spacemacs.d</a>.</p><p>Most of my configuration changes were keybindings that I wanted to keep from my old setup. Here are some examples.</p><p>This remaps the Apple command key to Meta, and the option key to super.</p><pre><code>(setq mac-option-modifier 'super)\n(setq mac-command-modifier 'meta)</code></pre><p>This snippet removes the titlebar, making the installation look super smooth:</p><pre><code>(add-to-list 'default-frame-alist '(ns-transparent-titlebar . t))</code></pre><p>I also installed the <a href=\"https://github.com/adobe-fonts/source-code-pro/releases/tag/2.030R-ro%2F1.050R-it\">Source Code Pro</a> font that Spacemacs prefers. It does look good!</p><p>You can check out the Spacemacs <a href=\"http://spacemacs.org/doc/DOCUMENTATION.html#dotfile-configuration\">dotfile configuration page</a> for more tips. I didn't change too much about the default setup; I was focused on customizing the Scala and Python experiences, as I'll go into next.</p><p>Here's my <code><a href=\"https://github.com/sritchie/spacemacs.d/blob/master/init.el\">init.el</a></code> file if you want to peruse the whole range of defaults that you can tweak.</p><p>I stuffed all of my language-specific configuration, and the layers I decided to install, into my own layers, which you can find <a href=\"https://github.com/sritchie/spacemacs.d/tree/master/layers\">here</a>.</p><p>I didn't quite finish; I still have a bunch of Clojure, Lisp and Haskell code to convert over. I'm going to wait to do that until I have the pleasure of programming in those languages again for a project. Until then I'm keeping the org files that used to generate my customizations in this <a href=\"https://github.com/sritchie/spacemacs.d/tree/master/random\">&quot;random&quot; folder in the spacemacs directory</a>.</p><h2>Python and Scala</h2><p>I'm going to save the details of customizing Spacemacs for these two development environments for two further posts. I'll link them here when they're complete. Stay tuned!</p>",
   :direction "ltr"},
  :updated 1569282819000,
  :entities
  [{:mentions [{:text "The Scala"}],
    :id "nlp/f/entity/wd:5120646",
    :salienceLevel "about",
    :label "Cine City, Withington"}
   {:mentions [{:text "Python"}],
    :id "nlp/f/entity/wd:28865",
    :salienceLevel "about",
    :label "Python"}
   {:mentions [{:text "Emacs"}],
    :id "nlp/f/entity/wd:189722",
    :salienceLevel "mention",
    :label "Emacs"}
   {:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "GitHub"} {:text "github.com"}],
    :id "nlp/f/entity/wd:364",
    :salienceLevel "mention",
    :label "GitHub"}],
  :alternate
  [{:href
    "https://samritchie.io/moving-to-spacemacs-for-scala-and-python/",
    :type "text/html"}],
  :title "Moving to Spacemacs for Scala and Python",
  :author "Sam Ritchie",
  :published-str "Mon Sep 23 16:53:39 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16d60b865c6:111cca0:69b9f616",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url
   "https://samritchie.io/content/images/2019/09/68747470733a2f2f7777772e6e61737365722e73706163652f696d67732f73706163656d6163732d6c6f676f2e706e67.png",
   :width 500,
   :height 500,
   :contentType "image/png"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://samritchie.io/rss/5d87757ada8f500037b447b0",
  :updateCount 1,
  :commonTopics
  [{:score 93.49377051252752,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.962,
    :id "nlp/f/topic/1722",
    :salienceLevel "about",
    :label "pentest"}
   {:score 0.876,
    :id "nlp/f/topic/1381",
    :salienceLevel "about",
    :label "machine learning"}
   {:score 0.712,
    :id "nlp/f/topic/1981",
    :salienceLevel "mention",
    :label "rv"}],
  :published 1569282819000,
  :fingerprint "1ac4edb1",
  :canonicalUrl
  "https://samritchie.io/moving-to-spacemacs-for-scala-and-python/"}
 {:engagement 6,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1569238858596,
  :recrawled 1569427400826,
  :content
  {:content
   "<p>What happens when your language is so powerful that small, independent teams can solve their problems without libraries? Does everyone flock to it? Or do you just get a lack of libraries?</p>\n<div width=\"100%\" src=\"https://share.transistor.fm/e/ba87afbf\" height=\"180\">\n<div><img src=\"https://lispcast.com/wp-content/uploads/2018/10/THOUGHTS-ON-FP-LOGO-NEW-2.jpg\"><p></p>\n<div><i></i></div>\n</div>\n</div>\n<p></p>\n<h2>Transcript</h2>\n<p>Eric Normand: What is the Curse of Lisp? In this episode, we are going to explore this counterintuitive property of powerful languages. My name is Eric Normand, and I help people thrive with functional programming.</p>\n<p>The Curse of Lisp is it has a very personal appeal to me because I used to be one of the people that thought about this all the time. The real question is if Lisp is so powerful, if it’s such a great language, and it lets you do so much, why isn’t it more popular? It’s not about the parentheses. People can get over the syntax. It’s been a lot of time to get over the syntax and it’s not really what it is. We’re going to explore that.</p>\n<p>You used to hear this more. In recent years, like the last 10 years, there’s been a real renaissance of languages. There’s so many possible languages to use now. Mostly because of the Web and the rise of startups who can use whatever language they want on the back end, and there’s been a blooming, a blossoming of different possible languages to choose from.</p>\n<p>But back in the day it was not like that. Big companies standardized on a mainframe and there were certain languages that ran on that, so they would standardize on a language and train their employees in that language and that’s what you had.</p>\n<p>There were a lot of — I’m talking about 50 years ago — there were a lot of Lisp programmers, mostly at universities and graduate departments, who learned Lisp, got into Lisp, felt very productive in Lisp, and looked around and said, “Look, you’ve got this hundred-person team working in COBOL and they are producing very little software, you know, just as very slow and here I am with Lisp and I’m like inventing, AI.” [laughs]</p>\n<p>I’m making stuff happen just all by myself. Maybe I have another person working with me, but like two people doing a lot more work than this team of a hundred people and so it seem to them. This is a perception thing.</p>\n<p>The question they would always have is why isn’t this more popular? If it’s such a powerful language, why aren’t businesses investing in it? Why aren’t we seeing people realize that they can hire fewer people, a lot fewer people not just 1 or 2 percent, but maybe you slash your team by 80 percent? Why don’t we see Lisp being more popular?</p>\n<p>Over time, you see this language like C or C++, Java starting to get a lot of attention. A lot of jobs around it. Meanwhile, Lisp is this not growing very much. All this stuff that you could do in Lisp in a few lines of code is now you realize taking men years, person years of work. Sorry. I said men years. I didn’t mean to use the sexist version. Person years of work to make a library to do the same thing.</p>\n<p>For instance, parsing in a Lisp or any kind of functional language are recursive to send parser, it’s very easy to write. Now you need some kind of parser generator system like a Lex and a YACC or an ANTLR in Java. You just need these huge systems, this huge piece of software just to do the same thing that a lisper was able to do.</p>\n<p>This is my version of the Curse of Lisp. What happens is because it is hard in Java to do a nice parser, people recognize that it’s hard. They work together because the challenge is so great, they need a hundred people to come together and work on it and make it very good and powerful.</p>\n<p>It creates even like a cottage industry. Now you need books written about it. You have maybe some conference talks about how to use this new parser generator in Java. It becomes a new thing that you can become an expert at because it’s not just like you know how to make parsers. No. You have to know that tool. It’s even less general knowledge, but still, it’s very powerful because all this work has been put into it.</p>\n<p>The question is why is it that the industry seems to prefer this giant effort to make a thing because of a less powerful language and so it takes more effort to do. Why does it prefer that over the more powerful general solution?</p>\n<p>I should pause here because it’s not about Lisp. I said it at the beginning, it’s about powerful languages in general. Any sufficiently powerful, expressive language, like you get with a functional language using higher-order functions and stuff. I think this is going to happen too.</p>\n<p>I believe that there’s something about the fact that it’s so expressive and so powerful that there’s…Here’s the curse. The curse is it breeds individualism. Because you can be so powerful alone, you work longer alone. You never learn to collaborate as much as you would if you had to work in a language that did require a team of 20 people to get anything done. There’s that issue. It breeds individualism.</p>\n<p>Here’s another thing. Because it’s so easy to write the solution…It’s easy to write your own parser in Lisp. I’m just going to say it like that. It’s very easy. You write the parser that’s just for your little language that you need to parse. That’s a 60 percent solution to parsing in general.</p>\n<p>Whereas, if you go to ANTLR, it is a 100 percent solution to parsing. It’s got a really tough API to use. You have to learn the grammar language that it’s got. You really have to understand it well, but then, boom. It’s a hundred percent. You can do whatever you need to do and that knowledge is transferable. I can go to another project wearing this library with me.</p>\n<p>Whereas in Lisp, you just have every individual could write this parser. Everyone thinks, “Oh, my…It’s not quite like what they did, so I’m going to do it myself a little bit differently. I’m going to solve my 60 percent.” There’s hundreds of parser libraries out there.</p>\n<p>This is part of the curse. Is that it’s so easy to write a new one, you don’t think, “Oh. I better jump on the bandwagon of the one big one.”</p>\n<p>Another aspect of the curse…Let me just tell you the curse and then I’ll give my opinions on another. This is another aspect of it. Is that we’re obsessed with bootstrapping. We love the power that a small amount of code that has a lot of leverage to get us to the next level of expressivity. We love that. But then, we don’t take it to its final point.</p>\n<p>What do I mean by that? Here’s an example from the Clojure world. Recently there was a lot of buzz about a system for having examples in comments, runnable examples. You put the examples in your dock strings in your code. When you run this tool on it, it will generate an HTML page where those examples are runnable. Totally awesome, right? You can actually run in the browser where you’re reading your documentation. Run that code.</p>\n<p>That’s awesome. Someone bootstrapped this cool system, and it’s something that used the power of Lisp, and the fact that we’ve got in-browser, compilers, and stuff like that. It used all of that stuff to make this cool system. I haven’t checked recently but I don’t hear anyone talking about it. I don’t see a lot of examples popping up.</p>\n<p>Like, “Look what I did in this tool, look what I did…” I think the reason is we’re so obsessed with that first initial, “Look at all the power I have.” We don’t go the extra mile and say, “OK, now, let’s all get together, let’s divvy up this task, and let’s write a thousand docstrings with examples.” We don’t do the boring manual labor work that’s required.</p>\n<p>Another language community who’s not so obsessed with the bootstrapping, they probably could do the same thing in way more code. OK, way more code. When they do it, it’s so much work. They’re not going to stop because that was a lot of work. They will only do it because they know they have so much work.</p>\n<p>They’re not going to do it unless they know they have the resolve and the labor to write up all of those examples. This is another aspect of the curse.</p>\n<p>Let’s go through them again. One is the individualism. We don’t have to work together. The language is so powerful that we, as an individual or a tiny team, two or three people, can build a solution for their problem. They never have to work with a big group to get things done.</p>\n<p>Two, it’s so easy to just solve your problem. You don’t get a complete solution. Everyone has their own little solutions that work for their problem, but then they’re incompatible with all the others. In Clojure world you see this with the proliferation of routing libraries.</p>\n<p>Everyone’s like, “Oh, I need a little bit different from this, so I’m gonna…” whereas in another language, they might have two or three because it’s a harder problem, and they want to standardize on it.</p>\n<p>The third one is this obsession with the first initial bootstrapping. You put this idea out as a high-leverage piece of code, and just expect it to blossom. That’s only the initial seed. You still need all the work of getting people to actually do the hard work of it.</p>\n<p>The computer can’t do all of it. The computer can do that cool first part, but then the rest of it has to be done by people. I see it so much. This is the Curse of Lisp. There’s another cynical side to it.</p>\n<p>I’d have to put this out that companies…This is the very cynical side but it’s got a grain of truth in it. Companies would rather have a lot of replaceable interchangeable programmers then one or two powerful programmers.</p>\n<p>They want someone to be able to, for instance, be fired or change jobs or go on maternity leave, or what have you, and just be like, “Oh, that’s one percent of our team gone.”</p>\n<p>If you only have two programmers and one of them goes on leave, that’s half your team, that’s half your productivity. They’d rather have this big mass of people working on a less expressive language then put all their eggs in two baskets and have this trouble.</p>\n<p>That’s like an economic argument for why Lisp isn’t more popular in business. The Curse of Lisp is something that I’ve thought a lot about. I was really into Lisp for a while, and I always wondered why it wasn’t more popular because I felt way more powerful.</p>\n<p>It’s not even about like Lisp is absolutely more powerful than other languages because there’s always new languages, and they have cool powers. I’m not saying that. Going from a language like…I learned Java going in university. Going from Java to common Lisp was like…</p>\n<p>There’s no comparison between solving problems in Common Lisp, and having to write all this public class, etc., just to get anything done. It’s very easy to compare the two languages and say, yes, Common Lisp has a lot of power in it. I want to make that clear.</p>\n<p>I’m not saying Lisp is like the best language. I’m not saying Lisp is more powerful for everything. I do think that when you go from a language to a more powerful language, you often wonder why is that language that I left so much more popular than this one when Lisp is one of the oldest language like, “Why isn’t it taking off?”</p>\n<p>I think that a lot of it has to do with the power. It’s too powerful. What is the antidote? In Clojure, people would often talk about Clojure escaping the Curse of Lisp because it’s able to use the JVM libraries. In a lot of ways, that’s true. It has escaped the Curse of Lisp.</p>\n<p>Empirically, it is really popular compared to Lisp of 20 years ago. So it has escaped a lot of that problem.</p>\n<p>We still see the same kinds of problems, a lack of coordination what I would call a very earnest efforts to get a project going and not a lot of uptake on it, a lot of, “Oh, I can do better. I could do that in a couple of macros,” and not a lot of follow through from the original person making it. I see the same problems there.</p>\n<p>Luckily we do have the java libraries and a lot of people willing to wrap those java libraries in things that make it easy for us to use in Clojure. We’re escaping part of it but we still have the legacy of the curse. I think we could figure out a way to solve this.</p>\n<p>Another example, just to say it’s not strictly about Lisp. I’ll just explain it like this. I used WordPress a long time ago before Rails came out. The interface was pretty clunky. When Rails came out everyone started expecting a lot more from Web interfaces, from the gooey that users click around on the Web.</p>\n<p>They wanted dynamic stuff to happen. They wanted little menus that were easier to use with your mouse. They wanted loading spinners. WordPress didn’t have a good way to do that. Rails did. It did a lot of that for you automatically.</p>\n<p>But by and by WordPress had a lot people using it and a lot of developer power and they built it like one little widget at a time making it very much like a default Rails app would be and it was through sheer willpower.</p>\n<p>You could ask, “Well, Rails and Ruby are so much better at making this kind of thing than WordPress, why do people still use WordPress?” The same question, WordPress is insanely popular. It’s insane. Why? Why do they still use it? It’s a very similar question.</p>\n<p>You got a more powerful language, Ruby. You’ve got even a more powerful framework, Rails, — a better framework, a more modern framework — one that does the stuff you needed to do very elegantly versus WordPress where you have to do it all manually.</p>\n<p>Yet, there’s some company selling a plugin to do what you could do in a few lines of code in Ruby. Of course, that plugin is like thousands of lines of code. What is it? Why is this? It’s there everywhere. Luckily, the Ruby and Rails community have a lot more follow through.</p>\n<p>They’re not so cursed as the Lispers are and a lot of it has to do with the popularity. That’s all I’ll say about this Curse of Lisp. I don’t think we’ve escaped it. There’s a lot more that needs to be done. I’m talking about the Clojure community right now.</p>\n<p>We need to put in the boring work. I think that that’s one of the key issues. We need to have more collective action. We need to form more projects that people say, “I’m not going to make my own solution. I’m going to use this one.” We just need that. I think that that would go a long way toward helping us.</p>\n<p>Another thing that saves the Clojure community is we are very practical. Our libraries don’t do more than they need to, which is a good thing. We don’t build in functionality, bite off more than we can chew and paint ourselves into corners. We want the power of the library that we’re wrapping or whatever we’re doing without a lot of assumptions about how it’s supposed to be done or what it wants to do.</p>\n<p>This episode is going kind of long so I’m going to wrap it out now. If you like this episode, you can find past episodes at lispcast.com/podcast. There you’re going to find audio, video and text transcripts of all the past episodes. This one is number 141, I think. A lot of episodes. You can go find everything back there.</p>\n<p>You’ll also find links to subscribe and to get in touch with me on social media. If you’re interested in the Curse of Lisp or why some languages ain’t as popular as some other language.</p>\n<p>I still want to think about this and figure it out. I don’t think there’s any kind of magic sauce. A lot of it is the market forces, if you will. Still, there’s a lot of room for Lisp to succeed. I think about it a lot.</p>\n<p>All right. Thank you so much for watching. My name is Eric Normand. This has been my thought of Functional Programming. Thank you for listening and rock on.</p>\n<p>The post <a rel=\"nofollow\" href=\"https://lispcast.com/what-is-the-curse-of-lisp/\">What is the Curse of Lisp?</a> appeared first on <a rel=\"nofollow\" href=\"https://lispcast.com\">LispCast</a>.</p>",
   :direction "ltr"},
  :updated 1569236400000,
  :entities
  [{:mentions [{:text "Lisp"}],
    :id "nlp/f/entity/wd:132874",
    :salienceLevel "mention",
    :label "Lisp"}
   {:mentions [{:text "Java"}],
    :id "nlp/f/entity/wd:251",
    :salienceLevel "mention",
    :label "Java"}
   {:mentions
    [{:text "functional programming"} {:text "functional language"}],
    :id "nlp/f/entity/wd:193076",
    :salienceLevel "mention",
    :label "functional programming"}
   {:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "WordPress"}],
    :id "nlp/f/entity/wd:13166",
    :salienceLevel "mention",
    :label "WordPress"}],
  :alternate
  [{:href "https://lispcast.com/what-is-the-curse-of-lisp/",
    :type "text/html"}],
  :title "What is the Curse of Lisp?",
  :author "Eric Normand",
  :published-str "Mon Sep 23 04:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16d5decbb64:cfed49:97b0c8f7",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url
   "https://lispcast.com/wp-content/uploads/2018/10/THOUGHTS-ON-FP-LOGO-NEW-2.jpg",
   :width 300,
   :height 300,
   :contentType "image/jpeg"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://lispcast.com/?p=2031",
  :updateCount 1,
  :commonTopics
  [{:score 100.34878304622559,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 33.096700130060825,
    :id "nlp/f/topic/3000",
    :salienceLevel "about",
    :label "artificial intelligence"}
   {:score 0.942,
    :id "nlp/f/topic/1291",
    :salienceLevel "about",
    :label "languages"}
   {:score 0.714,
    :id "nlp/f/topic/52",
    :salienceLevel "mention",
    :label "agile"}],
  :published 1569236400000,
  :fingerprint "309b4ea6",
  :canonicalUrl "https://lispcast.com/what-is-the-curse-of-lisp/"}
 {:engagement 5,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/todo",
    :label "todo"}
   {:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1569234513481,
  :content
  {:content
   "<div>\n<p><em>Issue 345 – September 23, 2019 · <a href=\"https://purelyfunctional.tv/newsletter-archives/\">Archives</a> · <a title=\"Thanks, Jeff!\" href=\"https://purelyfunctional.tv/newsletter/\">Subscribe</a></em></p>\n<h2>Clojure Tip 💡</h2>\n<p><em>know your exception hierarchy</em></p>\n<p>The Java Virtual Machine handles errors in a relatively consistent way. We inherit most of that system in Clojure, so it’s useful to know a bit about how it works.</p>\n<p>One thing that has bitten me is not remembering that <code>Exception</code> is not the top of the hierarchy of things that can be thrown. There’s a class called <code>Throwable</code> above it. Instances of <code>Throwable</code> are the only things that can be thrown with the <code>throw</code> expression in Clojure.</p>\n<p>Underneath <code>Throwable</code> are two branches: <code>Exception</code> and <code>Error</code>. If you want to catch everything, you have to <code>(catch Throwable t ...)</code>. If you only <code>(catch Exception e ...)</code>, you miss all of the <code>Error</code>s. It’s worth taking some time reading the information-dense Javadocs for this hierarchy. Start at <a title href=\"https://docs.oracle.com/en/java/javase/12/docs/api/java.base/java/lang/Throwable.html\">the Javadocs for <code>Throwable</code></a> and read down through <code>Exception</code>, <code>RuntimeException</code>, and <code>Error</code>.</p>\n<p>Some important excerpts:</p>\n<ul>\n<li>From <a title href=\"https://docs.oracle.com/en/java/javase/12/docs/api/java.base/java/lang/Exception.html\"><code>Exception</code></a>:</li>\n</ul>\n<p><em>The class Exception and its subclasses are a form of Throwable that indicates conditions that a reasonable application might want to catch.</em></p>\n<p>Common exceptions include <code>FileNotFoundException</code>. The idea is you code the happy path and handle the sad fact of a file not existing by catching this exception.</p>\n<ul>\n<li>From <a title href=\"https://docs.oracle.com/en/java/javase/12/docs/api/java.base/java/lang/Error.html\"><code>Error</code></a>:</li>\n</ul>\n<p><em>An Error is a subclass of Throwable that indicates serious problems that a reasonable application should not try to catch.</em></p>\n<p>Common errors include <code>StackOverflowError</code> and <code>OutOfMemoryError</code>. These are serious flaws in your program, the JVM configuration, or the environment.</p>\n<p>This distinction between situations you’re supposed to handle and situations you shouldn’t handle has led to a lot of debate. Luckily, the JVM does not prohibit catching and throwing any kind of <code>Throwable</code>. So when you need to break the rules for practical reasons, you can. For instance, if you want to catch a <code>StackOverflowError</code> and return a default value, you can. You don’t have to let your program crash. And if you want to ignore a <code>FileNotFoundException</code> even though “reasonable” programs should catch it, go right ahead.</p>\n<p>There’s one wrinkle in Clojure that has bitten me before about all of this. I’ve often used Clojure’s <a title href=\"https://clojure.org/reference/special_forms#_fn_name_param_condition_map_expr_2\"><code>:pre</code> and <code>:post</code> conditions</a> to check the arguments and return value. Likewise, I’ve used <code>(assert ...)</code> expressions. And guess what they throw! <code>java.lang.AssertionError</code>. Yes, they’re an <code>Error</code>. So if you thought you’d catch that with a <code>(catch Exception e ...)</code>, think again.</p>\n<p>Because <code>assert</code>s and <code>:pre</code> and <code>:post</code> conditions are so common, I always start with <code>(catch Throwable t ...)</code> in my mind and work my way down the hierarchy as needed.</p>\n<h2>Follow-up 🙃</h2>\n<p>Kind reader Jakub Holý reminded me of <a title href=\"https://stuartsierra.com/2016/clojure-how-to-ns.html\">How to ns</a>, which is Stuart Sierra’s guide to Clojure ns forms. Generally great suggestions in there. If you followed this style, you will look professional.</p>\n<p>Jakub has also written up <a title href=\"https://blog.jakubholy.net/clojure-common-beginner-mistakes/\">common beginner mistakes</a> in Clojure. These will get you really far.</p>\n<h2>Book discount 📖</h2>\n<p><a title href=\"https://lispcast.com/gs\">Buy the print book</a> for $25.</p>\n<p>Manning has informed me that today, Monday, September 23, is a special sale. They are offering <em>all</em> print books for $25.</p>\n<p>You can buy my print book now. You will get a PDF of the chapters that are ready now, plus updated PDFs as the book progresses. And then, one day, when the book is done, you will get a pleasant surprise in the mail. And if you see me at a conference, I will sign it for you (if you’re into that kind of thing).</p>\n<p>No code is needed. Just head to <a title href=\"https://lispcast.com/gs\"><em>Grokking Simplicity</em></a> and buy it. Just remember: it’s today only.</p>\n<p>Feel free to buy my book and anything else that suits your fancy. I’ll get a small affiliate fee 🙂</p>\n<p>If you don’t want the print book, you can use code <strong>PUREFUNC40</strong> for 40% off. But I don’t know why you’d do that. It’s practically the same price.</p>\n<p><a title href=\"https://lispcast.com/gs\">Buy the print book</a> for $25.</p>\n<h2>Currently recording 🎥</h2>\n<p><a title href=\"https://purelyfunctional.tv/courses/property-based-testing-with-test-check/\">Property-based Testing course</a> has two new lessons this week. It’s getting close to the end, so I’m going to close the Early Access Program before the next newsletter comes out. The price will never be as low as it is now.</p>\n<p>This week’s lessons are about exploring the different processes for testing at different times in the life of software.</p>\n<ul>\n<li><a title href=\"https://purelyfunctional.tv/lesson/when-to-test-before-implementation/\">When to test: before implementation</a> — How PBT helps TDD.</li>\n<li><a title href=\"https://purelyfunctional.tv/lesson/when-to-test-after-implementation/\">When to test: after implementation</a> — How PBT can increase your confidence in existing code.</li>\n</ul>\n<p>If you want access to the course and you’re not a member, you should buy it this week. It will go off the market until the course is done. And after that, the price will be higher. <a title href=\"https://purelyfunctional.tv/courses/property-based-testing-with-test-check/\">Buy it now.</a></p>\n<p>The lessons I’ve planned to wrap up this course include:</p>\n<ul>\n<li><strong>Testing distributed systems</strong> — test for things like eventual consistency and data loss</li>\n<li><strong>Testing non-Clojure web frontends</strong> — introduce Clojure where it’s not allowed in production</li>\n<li><strong>Spec integration</strong> — double the usefulness of all those specs you have</li>\n<li><strong>Using PBT to help design a system</strong> — catch bugs in the specification of a system</li>\n<li><strong>Using PBT to reproduce known bugs</strong> — bugs your users report but you can’t reproduce on your local machine</li>\n<li><strong>Fuzz testing</strong> — put your software through its paces and check that it’s okay</li>\n</ul>\n<h2>Brain skill 😎</h2>\n<p><em>build recall into your learning</em></p>\n<p>Reading about a system is great for learning. You get a ton of explanation and you can see how something is done well. You’ll remember a lot of that when you go to use the knowledge.</p>\n<p>But there are limits to how much you can learn this way. Sure, you do learn by reading explanations. But what you really want to do is get better at using the knowledge. In the case of programming, that means programming. You should find a way to use what you’ve learned, ideally without looking at the source material again.</p>\n<p>Our brains get better at the situations we put them in. If we put our brains in situations of absorbing a lot of information quickly, like we do when we read, they’re get better at that. The information is in there. But without practicing recalling it, our brains won’t get better at recalling it when it’s needed. The neurons for retrieving helpful information at the right time won’t have enough practice.</p>\n<p>Recall is not important, but it’s not enough. Take, for instance, learning keystrokes in Emacs. Sure, you read a blog on how to do something. Then you even quizzed yourself on it later (which is recall). But did you also practice connecting that recall to the neurons that control your fingers? Or what about the visual part of your brain that decides what the text should look like and plans changes to the current text? Ugh! There’s so much involved in any one skill, there’s a reason real-world experience is so highly valued.</p>\n<p>In your learning, you’ve got to balance time between keeping the task small enough to practice one skill (deliberate practice) and keeping it realistic enough to get all the systems involved.</p>\n<p>Bottom line: absorbing information is good, but get out and practice it in a realistic scenario, like a side project.</p>\n<h2>Clojure Challenge 🤔</h2>\n<h3>Last week’s challenge</h3>\n<p>The challenge in <a title href=\"https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-344-tip-thank-a-clojure-oss-dev-today/\">Issue 344</a> was to make a higher-order function that retries another function three times.</p>\n<p>You can check out the submissions <a title href=\"https://gist.github.com/ericnormand/0a95751f1cf39c1b0f12b1d181b9e49d\">here</a>.</p>\n<h3>This week’s challenge</h3>\n<p><em>rate limiting</em></p>\n<p>The reality of the distributed, service-oriented world we live in is that we have to contend with the consequences of not only our requests, but the requests of all of the other clients of that service. For instance, many services have maximum request rates to protect the availability of a service from overambitious clients. An API might say “make no more than 10 requests per second”.</p>\n<p>How do you enforce that? My server has 24 cores, and I run as many threads. How do those threads coordinate so they don’t go over the limit? It gets more complicated when you scale to multiple machines. Let’s keep it simple and just talk about the shared-memory case.</p>\n<p>There’s a nice algorithm for implementing rate limiting called <a title href=\"https://en.wikipedia.org/wiki/Token_bucket\"><em>token bucket</em></a>. If you can’t make more than 10 requests per second, you make a rule: no one can make a request unless they have a token. Now dole out the tokens at no more than 10 requests per second. It’s a great way to centralize the control of the rate.</p>\n<p>Your mission, should you choose to accept it, is to implement token bucket. Make sure it works well with multiple threads. It’s surprisingly easy in Clojure with a thread and an atom, but there are other ways to do it. Core.async makes it a cinch.</p>\n<p>Extra credit for then making a higher-order function that rate limits a function.</p>\n<p>As usual, please send me your implementations. I’ll share them all in next week’s issue. If you send me one, but you don’t want me to share it publicly, please let me know.</p>\n<p>Rock on!<br>Eric Normand</p>\n</div>\n<p>The post <a rel=\"nofollow\" href=\"https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-345-tip-know-your-exception-hierarchy/\">PurelyFunctional.tv Newsletter 345: Tip: know your exception hierarchy</a> appeared first on <a rel=\"nofollow\" href=\"https://purelyfunctional.tv\">PurelyFunctional.tv</a>.</p>",
   :direction "ltr"},
  :updated 1569232800000,
  :entities
  [{:mentions [{:text "newsletter"}],
    :id "nlp/f/entity/wd:264238",
    :salienceLevel "about",
    :label "newsletter"}
   {:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "about",
    :label "Clojure"}
   {:mentions [{:text "JVM"} {:text "Java Virtual Machine"}],
    :id "nlp/f/entity/wd:193321",
    :salienceLevel "mention",
    :label "Java Virtual Machine"}
   {:mentions [{:text "higher-order function"}],
    :id "nlp/f/entity/wd:1474542",
    :salienceLevel "mention",
    :label "higher-order function"}
   {:mentions [{:text "token bucket"}],
    :id "nlp/f/entity/wd:386456",
    :salienceLevel "mention",
    :label "token bucket"}],
  :alternate
  [{:href
    "https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-345-tip-know-your-exception-hierarchy/",
    :type "text/html"}],
  :title
  "PurelyFunctional.tv Newsletter 345: Tip: know your exception hierarchy",
  :author "Eric Normand",
  :published-str "Mon Sep 23 03:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16d5daa6e49:c8eb5a:69b9f616",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://purelyfunctional.tv/?p=32062",
  :commonTopics
  [{:score 53.35749141176853,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.955,
    :id "nlp/f/topic/575",
    :salienceLevel "about",
    :label "crm"}
   {:score 0.895,
    :id "nlp/f/topic/774",
    :salienceLevel "about",
    :label "engineering"}
   {:score 0.893,
    :id "nlp/f/topic/874",
    :salienceLevel "about",
    :label "fitness"}
   {:score 0.791,
    :id "nlp/f/topic/2010",
    :salienceLevel "mention",
    :label "scalability"}],
  :published 1569232800000,
  :fingerprint "fc24d6d",
  :canonicalUrl
  "https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-345-tip-know-your-exception-hierarchy/"}
 {:engagement 5,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1569084088051,
  :content
  {:content
   "<h3></h3><p>Recently I was building a small library to extract information from image files. While doing so I thought a simple site to extract GPS information from images would be useful to build as well as to describe how it was created using Clojure.</p><p>The source code for this project is available on GitHub at <a href=\"https://github.com/bradlucas/imagelocation\">https://github.com/bradlucas/imagelocation</a> while a running example is available at <a href=\"http://imagelocation.beaconhill.com/\">http://imagelocation.beaconhill.com/</a>. If you don't have a photo handy and would quickly like to see what the site returns see the About page <a href=\"http://imagelocation.beaconhill.com/about\">http://imagelocation.beaconhill.com/about</a>.</p><h3>Overview</h3><p>I'll assume that you the reader have some experience with Clojure and have build something in the language. With that in mind I'll just go through the steps I went through to build up the application.</p><p>They are as follows:</p><ol><li>Create Initial Project</li><li>Add Compojure</li><li>Command line support and Jetty Adapter</li><li>Process Image Files</li><li>Adding Template and Selmer</li><li>Final Version</li></ol><h3>Step 1. Create Initial Project</h3><p>Let's start with a basic project.</p><pre><code>$ lein new imagelocation\n</code></pre><p><a href=\"https://github.com/bradlucas/imagelocation/commit/0ccb62ab4996b85bcd31931e972b89b086fd3ade\">https://github.com/bradlucas/imagelocation/commit/0ccb62ab4996b85bcd31931e972b89b086fd3ade</a></p><h3>Step 2. Add Compojure</h3><p>Here we add the Compojure library and get a simple route working. </p><p>Add the following to the project.clj file's dependencies.</p><pre><code>[compojure &quot;1.6.1&quot;]\n[ring/ring-defaults &quot;0.3.2&quot;]   \n</code></pre><p>Also, add the following to the project.clj file.</p><pre><code> :repl-options {:init-ns imagelocation.core}\n\n  :plugins [[lein-ring &quot;0.12.5&quot;]]\n  :ring {:handler imagelocation.handler/app}\n  :profiles\n  {:dev {:dependencies [[javax.servlet/servlet-api &quot;2.5&quot;]\n                        [ring/ring-mock &quot;0.3.2&quot;]]}}\n</code></pre><p>Create a file called handler.clj add a require entries and an initial app-routes and app.</p><pre><code>(ns imagelocation.handler\n  (:require [compojure.core :refer :all]\n            [compojure.route :as route]\n            [ring.middleware.defaults :refer [wrap-defaults site-defaults]]))\n\n(defroutes app-routes\n  (GET &quot;/&quot; [] &quot;Hello World&quot;)\n  (route/not-found &quot;Not Found&quot;))\n\n(def app\n  (wrap-defaults app-routes site-defaults))\n</code></pre><p>Details: <a href=\"https://github.com/bradlucas/imagelocation/commit/9581ccdfc6d464b57fe165d6332160d51d1d3d02\">https://github.com/bradlucas/imagelocation/commit/9581ccdfc6d464b57fe165d6332160d51d1d3d02</a></p><p>Now test this step with:</p><pre><code>$ lein ring server\n</code></pre><h3>Command line support and Jetty Adapter</h3><p>Using <code>lein ring server</code> is fine to get started but we'll want to run a stand alone web app. Also, we'll need to run our system from the command line. To do this see the following commit:</p><p><a href=\"https://github.com/bradlucas/imagelocation/commit/026ac4c4ab4fd0bc092f351e5766aef9d5c411ea\">https://github.com/bradlucas/imagelocation/commit/026ac4c4ab4fd0bc092f351e5766aef9d5c411ea</a></p><p>Here we are adding the following libraries.</p><pre><code>  [ring/ring-jetty-adapter &quot;1.7.1&quot;]\n  [org.clojure/tools.cli &quot;0.4.2&quot;]\n</code></pre><p>The <code>ring-jetty-adapter</code> lets use run standalone with a statement like:</p><pre><code>(jetty/run-jetty handler/app {:port 4002}\n</code></pre><p>The <code>org.clojure/tools.cli</code> library lets us process command line arguments easily. See the above mentioned commit for details on how to check for a <code>-f filename</code> to process a single file.</p><h3>Step 4 - Process Image Files</h3><p>The following commit introduces the main functionality to extract location information from images.</p><p>See this commit:</p><p><a href=\"https://github.com/bradlucas/imagelocation/commit/e39a49516f97c8f899b0d58e0ec0dc77a483cf78\">https://github.com/bradlucas/imagelocation/commit/e39a49516f97c8f899b0d58e0ec0dc77a483cf78</a></p><p>The library the application is using is the <code>metadata-extractor</code> from Drew Noakes <a href=\"https://github.com/drewnoakes/metadata-extractor\">https://github.com/drewnoakes/metadata-extractor</a>.</p><p>To start a reference to the library is added to the project.clj file.</p><pre><code>[com.drewnoakes/metadata-extractor &quot;2.12.0&quot;]\n</code></pre><p>Then see the <code>image.clj</code> file <a href=\"https://github.com/bradlucas/imagelocation/blob/e39a49516f97c8f899b0d58e0ec0dc77a483cf78/src/imagelocation/image.clj\">https://github.com/bradlucas/imagelocation/blob/e39a49516f97c8f899b0d58e0ec0dc77a483cf78/src/imagelocation/image.clj</a>.</p><p>The main routine to extract the data is <code>image-data</code>.</p><pre><code>(defn image-data\n  &quot;Return map of all image data fields\n&quot;\n  [filename]\n  (->> (io/file filename)\n       ImageMetadataReader/readMetadata\n       .getDirectories\n       (map #(.getTags %))\n       (into {} (map extract-from-tag))))\n</code></pre><p>The output of which is passed to <code>get-location-data</code> to remove just the GPS fields.</p><pre><code>(defn get-location-data\n  &quot;Return `GPS Latitude` and `GPS Longitude` values in a map\n&quot;\n  [filename]\n  (let [info (image-data filename)]\n    {:lat (get info &quot;GPS Latitude&quot;)\n     :lng (get info &quot;GPS Longitude&quot;)}))\n</code></pre><p>There are some routines to convert the three field lat/lng value strings to single numbers in the file as well as a routine to create a Google Map link.</p><h3>Step 5 - Adding Template and Selmer</h3><p>The next to last step is to add a simple UI. I choose to use the <a href=\"https://github.com/yogthos/Selmer\">Selmer</a> libary for templating and a basic Bootstrap template from [Bootswatch])https://bootswatch.com/lux/).</p><p>The commit which introduces the files is <a href=\"https://github.com/bradlucas/imagelocation/commit/ce92691f84ee620cb5d353bd73441b3f3f398779\">https://github.com/bradlucas/imagelocation/commit/ce92691f84ee620cb5d353bd73441b3f3f398779</a>.</p><p>Adding Selmer consists of adding the following to your project.clj file.</p><pre><code>[selmer &quot;1.12.12&quot;]\n</code></pre><p>Getting things setup is a bit more involved than previous steps. It might be worth while looking carefully over the above mentioned commit. What you'll need is the following:</p><ul><li>A resources/templates directory with a base.html file along with files for each <code>view</code></li><li>The Bootstrap template files in resources/public</li><li>Modifications to your handlers to display the upload form and process the posted upload </li></ul><p>If you are following along and building as you go focus on getting a static page working first. This means the <code>base.html</code> and <code>index.html</code> files working with the associated public files.</p><p>Then focus on the handlers to process the upload. This may be tricky at first but review the repo for the solution.</p><h3>Step 6 - Final Version</h3><p>The last step is after many tweaks to make the system more robust and look better. Feel free to step through the commits to see the details.</p><p>The final version as of this writing is version 1.0 and available on this branch <a href=\"https://github.com/bradlucas/imagelocation/tree/release/1.0\">https://github.com/bradlucas/imagelocation/tree/release/1.0</a>.</p><p>Also, a running version to try is availabe at <a href=\"http://imagelocation.beaconhill.com/\">http://imagelocation.beaconhill.com/</a></p><h3>Links</h3><ul><li>Selmer - <a href=\"https://github.com/yogthos/Selmer\">https://github.com/yogthos/Selmer</a></li><li>Introduction to Selmer <a href=\"https://cljdoc.org/d/selmer/selmer/1.12.12/doc/introduction-to-selmer\">https://cljdoc.org/d/selmer/selmer/1.12.12/doc/introduction-to-selmer</a></li><li>Final Source <a href=\"https://github.com/bradlucas/imagelocation/tree/release/1.0\">https://github.com/bradlucas/imagelocation/tree/release/1.0</a></li><li>Trial Version <a href=\"http://imagelocation.beaconhill.com/\">http://imagelocation.beaconhill.com/</a></li></ul>",
   :direction "ltr"},
  :updated 1569038400000,
  :entities
  [{:mentions [{:text "GPS"}],
    :id "nlp/f/entity/wd:18822",
    :salienceLevel "mention",
    :label "Global Positioning System"}
   {:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "GitHub"} {:text "github.com"}],
    :id "nlp/f/entity/wd:364",
    :salienceLevel "mention",
    :label "GitHub"}
   {:mentions [{:text "Selmer"}],
    :id "nlp/f/entity/wd:2061621",
    :salienceLevel "mention",
    :label "Selmer"}
   {:mentions [{:text "src"} {:text "source code"} {:text "source"}],
    :id "nlp/f/entity/wd:128751",
    :salienceLevel "mention",
    :label "source code"}],
  :alternate
  [{:href
    "http://blog.bradlucas.com/posts/2019-09-21-building-an-image-location-service-with-clojure/",
    :type "text/html"}],
  :title "Building An Image Location Service With Clojure",
  :author "Brad Lucas",
  :published-str "Fri Sep 20 21:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16d54b31ef3:38bca0:69b9f616",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "http://blog.bradlucas.com/posts/2019-09-21-building-an-image-location-service-with-clojure/",
  :commonTopics
  [{:score 58.56321913470915,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.961,
    :id "nlp/f/topic/1722",
    :salienceLevel "about",
    :label "pentest"}
   {:score 0.81,
    :id "nlp/f/topic/1975",
    :salienceLevel "mention",
    :label "running"}
   {:score 0.803,
    :id "nlp/f/topic/774",
    :salienceLevel "mention",
    :label "engineering"}
   {:score 0.768,
    :id "nlp/f/topic/2035",
    :salienceLevel "mention",
    :label "sec tools"}],
  :published 1569038400000,
  :fingerprint "972c458",
  :canonicalUrl
  "http://blog.bradlucas.com/posts/2019-09-21-building-an-image-location-service-with-clojure/"}
 {:engagement 14,
  :unread false,
  :crawled 1569008265415,
  :content
  {:content
   "<p>Each week, we answer a different question about Clojure and functional programming.</p>\n<p>If you have a question you’d like us to discuss, tweet <a href=\"https://twitter.com/clojuredesign\">@clojuredesign</a>, send an email to <a href=\"mailto:feedback@clojuredesign.club\">feedback@clojuredesign.club</a>, or join the <code>#clojuredesign-podcast</code> channel on the <a href=\"http://clojurians.net/\">Clojurians Slack</a>.</p>\n<p>This week, the question is: <strong>“What is ‘nil punning’?”</strong> We gaze into the nil and find a surprising number of things to talk about.</p>\n<p>Selected quotes:</p>\n<ul>\n<li>“The lowly, magnificent nil. Some people love it, some people hate it.”</li>\n<li>“Null is the value you give your program if you want to see it die.”</li>\n<li>“Nil is not null.”</li>\n<li>“This function found nothing, and I passed that to the next function, and it found nothing in the nothing.”</li>\n<li>“It’s amazing how much nothing you can find in nothing.”</li>\n<li>“You can pull data out without fear.”</li>\n<li>“What does a nil Cat look like?”</li>\n<li>“A lot of arithmetic stuff is nil-intolerant.”</li>\n<li>“No answer isn’t going to start becoming an answer later.”</li>\n</ul>",
   :direction "ltr"},
  :updated 1568991600000,
  :entities
  [{:mentions [{:text "functional programming"}],
    :id "nlp/f/entity/wd:193076",
    :salienceLevel "about",
    :label "functional programming"}
   {:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "about",
    :label "Clojure"}],
  :alternate
  [{:href
    "https://clojuredesign.club/episode/047-what-is-nil-punning/",
    :type "text/html"}],
  :title "Ep 047: What Is \"Nil Punning\"?",
  :author "Christoph Neumann and Nate Jones",
  :published-str "Fri Sep 20 08:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16d502e28c7:a58202a:97b0c8f7",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://clojuredesign.club/episode/047-what-is-nil-punning/",
  :commonTopics
  [{:score 0.865,
    :id "nlp/f/topic/349",
    :salienceLevel "about",
    :label "business"}],
  :published 1568991600000,
  :fingerprint "2055279a",
  :canonicalUrl
  "https://clojuredesign.club/episode/047-what-is-nil-punning/"}
 {:tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1569002076178,
  :content
  {:content
   "<p>Last week we released version <code>0.2.0</code> of <strong>datahike</strong> which brings new features\nand marks a step away from its datascript origin. The major new features are\nschema flexibility and time travel. After integrating the\nlatest datascript code we extended it through protocols on storage and index level.</p>\n<h1>Datascript Integration and Cleanup</h1>\n<p>While <strong>datahike</strong> began as a fork of\n<a href=\"https://github.com/tonsky/datascript\">datascript</a> and integration of the\nhitchhiker tree, we are now adding novel features and moving away from the\noriginal project. For this release we integrated the latest datascript code and\nrefactored it in preparation for the next features.</p>\n<p>Additionally protocols were created for both index and storage layer. <a href=\"https://github.com/purrgrammer\">Alejandro\nGómez</a> provided protocols for the storage\nbackends that support different solutions like <code>in-memory</code>, <code>file-based</code>,\n<code>LevelDB</code>, or <code>PostgreSQL</code>. New stores can be added by implementing four\nfunctions on top of <a href=\"https://github.com/replikativ/konserve\">konserve</a> bindings.\nA good example are the <a href=\"https://github.com/replikativ/datahike/blob/master/src/datahike/store.cljc#L80\">PostgreSQL\ncalls</a>.</p>\n<p>The underlying index is now also configurable supporting both the persistent\nsorted set used in datascript and the <a href=\"https://blog.datopia.io/2018/11/03/hitchhiker-tree/\">hitchhiker\ntree</a>. Through protocols\nother interesting index data structures can be added easily.</p>\n<p>Since our partners from the <a href=\"https://datopia.io/\">datopia project</a> needed the\ndatalog parsing functionality we moved all functions and tests around datalog\nquery parsing into a <a href=\"https://github.com/lambdaforge/datalog-parser\">separate\nproject</a> that will also support\nfunctions not used in <strong>datahike</strong>, like creating datalog queries from its syntax\ntree, so you can parse a datalog query, add addtionaly data, and create an\noptimized query for a database to use.</p>\n<h1>Schema Flexibility</h1>\n<p>Up until now <strong>datahike</strong> did not enforce any schema on its data, so any badly shaped\ndata could be added. Starting with <strong>datahike</strong> <code>0.2.0</code> the schema-on-write\napproach is supported where the schema has to be defined explicitly and\nthe transactor ensures all transacted data conforms to it. Through configuration\nthe previous schema-on-read is still supported.</p>\n<p><strong>datahike</strong> supports large parts of <a href=\"https://docs.datomic.com/on-prem/schema.html\">Datomic’s schema\ndefinition</a> except tuples, full\ntext search and byte types. The data validation happens on transaction level using <code>clojure.spec</code>.</p>\n<p>In contrast to datascript’s schema in the database record, <strong>datahike</strong> stores the\nschema additionally as transactions in\nthe index, which allows queries and time travel\nthat can help auditing schema changes.</p>\n<h1>Time Travel</h1>\n<p>Modern database solutions require auditable data history without integrating time stamp\nattributes to all data models. Similar to <a href=\"https://docs.datomic.com/on-prem/getting-started/see-historic-data.html\">Datomic’s historic data</a>\n<strong>datahike</strong> supports time travel capabilities that allow datalog queries against\nthe whole history, against any point in the past, or against the\ndifference since a certain point in time.</p>\n<p>In accordance to the <a href=\"https://gdpr-info.eu/\">GDPR regulations</a> data\npurging capabilities were added that completely remove data either from\nall indices or only from the historical indices.</p>\n<p>In order to keep the current data view fast and clean, a separate set of\nindices were created that track all past data. This separation makes it very easy\nto clean up data after certain retention periods without interfering with the\ncurrent view of data.</p>\n<h1>Configuration</h1>\n<p>With the addition of the latest features, <strong>datahike</strong> required better configuration.\nTherefore a clean concept was implemented to allow picking only those\nfunctions from datahike that you need the most at database creation. For example,\nboth time travel and schema-on-write capabilities can be deactivated if you have\nno use for it.</p>\n<h1>Examples</h1>\n<p>Since it is always helpful to have examples, we provide <a href=\"https://github.com/replikativ/datahike/tree/master/examples\">projects</a> inside\nthe code base that show different features as well as documentation about\nnew features like <a href=\"https://github.com/replikativ/datahike/blob/master/doc/time_variance.md\">time\ntravel</a>,\n<a href=\"https://github.com/replikativ/datahike/blob/master/doc/schema.md\">schema</a>, and\n<a href=\"https://github.com/replikativ/datahike/blob/master/doc/config.md\">configuration</a>.</p>\n<p>These projects just need a REPL and can be worked through at your own pace.\nWhere it was possible we added explanations and different ways to use a certain\nfeature. Have a look at the <a href=\"https://github.com/replikativ/datahike/tree/master/examples/basic\">basic\nexample</a>\nwhich introduces topics like stores, schema or time travel.\nOver the next weeks we will add more examples about queries and transactions.</p>\n<h1>Future Plans</h1>\n<p>For the next release we are planning to make datalog available to a wider audience by\nreleasing API bindings for Java/Scala of <strong>datahike</strong>.</p>\n<p>In collaboration with our partners from the <a href=\"https://github.com/sixthnormal/clj-3df\">3DF\nproject</a> we aim to support remote\ncapabilities with a HTTP layer, having only a thin client on the application\nside instead of the full <strong>datahike</strong> stack.</p>\n<p>With support of a datalog query planner we will to be able to predict the\ncosts of each query and recommend possible solutions to improve your overall queries.</p>\n<p>For security reasons it would be useful to have an <a href=\"https://en.wikipedia.org/wiki/Identity_management\">identity and access\nmanagement</a> concept ready to\nbe used. Therefore user and role definitions will be added to the system entities.</p>\n<p>Since we have experience with probabilistic programming in\n<a href=\"http://anglican.ml\">anglican</a> we\nwill try to integrate probabilistic reasoning in datalog and <em>datahike</em> itself.</p>\n<p>From a development side we will try to release improvements on a\nsmaller scale with more minor and patch releases and a more transparent\ndevelopment process around GitHub issues.</p>\n<h1>Thanks</h1>\n<p>Many thanks to all the people from the <a href=\"https://jobtechdev.se/\">Job Tech\nproject</a> supporting us towards the implementation of the\nschema and time travel functionalities. Also thanks to <a href=\"https://github.com/grischoun\">Chrislain\nRazafimahefa</a> for his code reviews, <a href=\"https://github.com/purrgrammer\">Alejandro\nGómez</a> for his storage contributions, and all\nyou guys either on slack, GitHub or personally for fruitful discussions and\nfeedback.</p>\n<p>Have fun with the latest version of <strong>datahike</strong> and let us know what you think\nabout it.</p>",
   :direction "ltr"},
  :updated 1568955600000,
  :entities
  [{:mentions [{:text "time travel"}],
    :id "nlp/f/entity/wd:182154",
    :salienceLevel "about",
    :label "time travel"}
   {:mentions [{:text "PostgreSQL"}],
    :id "nlp/f/entity/wd:192490",
    :salienceLevel "mention",
    :label "PostgreSQL"}
   {:mentions [{:text "full text search"}],
    :id "nlp/f/entity/wd:83540",
    :salienceLevel "mention",
    :label "full text search"}
   {:mentions [{:text "syntax tree"}],
    :id "nlp/f/entity/wd:127380",
    :salienceLevel "mention",
    :label "abstract syntax tree"}
   {:mentions [{:text "GDPR"}],
    :id "nlp/f/entity/wd:1172506",
    :salienceLevel "mention",
    :label "General Data Protection Regulation"}],
  :alternate
  [{:href "https://lambdaforge/2019/09/20/datahike-release-0.2.0.html",
    :type "text/html"}],
  :title "Datahike Release 0.2.0",
  :author "Konrad Kühne",
  :published-str "Thu Sep 19 22:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16d4fcfb812:a1ebe7d:69b9f616",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://lambdaforge/2019/09/20/datahike-release-0.2.0",
  :commonTopics
  [{:score 39.458634836752985,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.976,
    :id "nlp/f/topic/619",
    :salienceLevel "about",
    :label "database"}
   {:score 0.793,
    :id "nlp/f/topic/659",
    :salienceLevel "mention",
    :label "digital nomad"}
   {:score 0.787,
    :id "nlp/f/topic/525",
    :salienceLevel "mention",
    :label "computer science"}
   {:score 0.762,
    :id "nlp/f/topic/1492",
    :salienceLevel "mention",
    :label "monitoring"}
   {:score 0.728,
    :id "nlp/f/topic/1524",
    :salienceLevel "mention",
    :label "music production"}],
  :published 1568955600000,
  :fingerprint "98d69497"}
 {:tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/todo",
    :label "todo"}
   {:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1568989225442,
  :content
  {:content
   "<h3>Comparing Graph Databases II</h3><p>Part 2: ArangoDB, OrientDB, and AnzoGraph DB</p><a href=\"https://medium.com/media/ec53ec9ef1ca580211b5682bbf3df1b7/href\">https://medium.com/media/ec53ec9ef1ca580211b5682bbf3df1b7/href</a><p>It’s great to see how passionate people are about their favorite graphing database provider or, at least, the graphing database company they work for. Since there are so many available options, please check out db-engine’s list of <strong>33</strong> different options for your graphing database needs. In this article, I will <strong>briefly</strong> highlight:</p><ul><li>OrientDB</li><li>ArangoDB</li><li>AnzoGraph DB</li></ul><p>These three rank 3rd, 4th, and 26th in popularity, according to the list provided by <a href=\"https://db-engines.com/en/\">db-engines.com</a>. In the interest of credible journalism, I will humbly attempt to be as unbiased as possible, and report on the information provided on the company’s website as well as recent articles.</p><p>Please see my previous article (<a href=\"https://towardsdatascience.com/comparing-graph-databases-5475bdb2e65f\">Part 1</a>) for a quick comparison of relational database management systems and graph databases.</p><h3><strong>OrientDB — “The database designed for the modern world”</strong></h3><figure><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/200/1*nbH6DCWYCROKakBp8nYYlA.jpeg\"></figure><p>Website: <a href=\"https://orientdb.com/\">https://orientdb.com/</a></p><p>Documentation: <a href=\"https://orientdb.org/docs/3.0.x/\">https://orientdb.org/docs/3.0.x/</a></p><p>Initially released in <a href=\"https://db-engines.com/en/system/OrientDB\">2010</a>, OrientDB supports many programming languages including: .Net, C, C#, C++, Clojure, Java, JavaScript, JavaScript(Node.js), PHP, Python, Ruby, and Scala. <a href=\"https://en.wikipedia.org/wiki/OrientDB\">OrientDB</a> is a schema-free multi-model database system supporting graph , document, key/value, and object models. It supports schema-less, schema-full, and schema-mixed modes. Gremlin and SQL queries are both supported for graph traversal. OrientDB is implemented with Java, so it can be run on all operating systems with a Java JDK ≥ JDK6. It is open-sourced, but commercial support is available from OrientDB as well.</p><p><strong>According to their website, </strong>OrientDB provides the service of a graph database system without the need to <a href=\"https://orientdb.com/why-orientdb/\">“deploy multiple systems to handle other data types.”</a> This method serves to increase “performance and security while supporting scalability.” OrientDB differentiates itself from the <a href=\"https://db-engines.com/en/ranking/graph+dbms\"><strong>many</strong></a><strong> </strong>graph database systems by managing a multi-model system by design. It does not simply <a href=\"https://orientdb.com/orientdb-vs-neo4j/\">“add layers for additional models, resulting in decreased performance.”</a></p><p>There are 33 user reviews on <a href=\"https://www.g2.com/products/orientdb/reviews?utf8=%E2%9C%93&filters%5Bcomment_answer_values%5D=&order=most_recent\">G2</a> with an average rating of 4/5 stars. The majority of the reviews are very positive, and it should be noted that the last average review was from June 2016, so it seems like OrientDB is doing a stand-up job of fixing bugs and deploying fully-developed features. The main criticism of reviews seems to be the desire for more robust documentation. Main praises include the reasonable price, quick-installation, and that it is user-friendly.</p><figure><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/947/1*r9UZvaoRtTAnVawXRJab4Q.png\"><a href=\"https://www.g2.com/products/orientdb/features\">https://www.g2.com/products/orientdb/features</a></figure><figure><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/1024/1*ERCQ55Um1GetqM98fUtnRQ.png\"><a href=\"https://www.predictiveanalyticstoday.com/orientdb/\">https://www.predictiveanalyticstoday.com/orientdb/</a></figure><h3>ArangoDB — “One engine. One query language. Multiple models.”</h3><figure><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/416/1*yBpX0GuHO9LXt6WHvtzpnw.png\"></figure><p>Website: <a href=\"https://www.arangodb.com/\">https://www.arangodb.com/</a></p><p>Documentation: <a href=\"https://www.arangodb.com/documentation/\">https://www.arangodb.com/documentation/</a></p><p>Originally called AvocadoDB in 2011, as evident in its logo, ArangoDB came into being in <a href=\"https://db-engines.com/en/system/ArangoDB\">2012</a>. ArangoDB is open-sourced, multi-model (key/value, documents, and graphs), and implemented with C, C++, and JavaScript. Server operating systems include: Linux, OS X, Raspbian, Solaris, and Windows. It is schema-free and supports the following languages: C#, Clojure, Java, JavaScript (Node.js), PHP, Python, and Ruby. <a href=\"https://en.wikipedia.org/wiki/ArangoDB\">ArangoDB</a> operates with one database core and its own unified query language AQL (ArangoDB Query Language), which is similar to SQL in many ways. AQL is declarative and allows the combination of different data access patterns in a single query. ArangoDB was designed specifically to allow key/value, document, and graph data to be stored together and queried with a common language.</p><p><strong>According to their </strong><a href=\"https://www.arangodb.com/why-arangodb/\"><strong>website</strong></a><strong>, </strong>ArangoDB can operate as a distributed &amp; highly scalable database cluster. It runs on Kubernetes, including persistent primitives &amp; easy cluster setup. ArangoDB has natively integrated cross-platform indexing, text-search and ranking engine for information retrieval and it is optimized for speed and memory. Full GeoJSON support is also provided.</p><p>There are 41 user reviews on <a href=\"https://www.g2.com/products/arangodb/reviews?utf8=%E2%9C%93&filters%5Bcomment_answer_values%5D=&order=most_recent\">G2</a> with an average of 5/5 stars. The single average rating from 2017 indicated a lack of SQL support and dissatisfaction of having to adapt to AQL. Others refer to AQL as “intuitive” and describe ArangoDB as “feature-rich.”</p><figure><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/928/1*xmTCr0y_BFHa9sSYHV8-OA.png\"><a href=\"https://www.g2.com/products/arangodb/features\">https://www.g2.com/products/arangodb/features</a></figure><figure><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/1024/1*1Xlc2CsZjgcFyJ4tYnBPQg.png\"><a href=\"https://www.predictiveanalyticstoday.com/arangodb/\">https://www.predictiveanalyticstoday.com/arangodb/</a></figure><p>For a sneak peek at the new features in the upcoming 3.6 release, check out ArangoDB’s Webinar on Oct 10th, 2019 at 1PM EST.</p><p><a href=\"https://www.arangodb.com/arangodb-events/arangodb-3-6-the-future-is-full-of-features/\">Webinar: ArangoDB 3.6 - The future is full of features - ArangoDB</a></p><h3><strong>AnzoGraph — “Build Your Solutions on a Fast, Scalable Database”</strong></h3><figure><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/646/1*0WudY191SFaxSsKXnWyf_Q.png\"></figure><p>Website: <a href=\"http://www.anzograph.com/\">www.anzograph.com</a></p><p>Documentation: <a href=\"https://docs.cambridgesemantics.com/anzograph/userdoc/home.htm\">https://docs.cambridgesemantics.com/anzograph/userdoc/home.htm</a></p><p>Initially released in 2018, this commercial graph database operates with the RDF (Resource Description Framework). The RDF model represents information as triples in the form of subject-predicate-object. RDF stores can be considered as a subclass of graph DBMs, but RDF stores are distinguished as they offer specific methods going beyond the general graph DBMS. Most RDF stores, AnzoGraph included, support SPARQL, which is a SQL-like query language used for <a href=\"https://en.wikipedia.org/wiki/Online_analytical_processing\">OLAP(Online analytical processing)</a>-style analytics. AnzoGraph DB’s operating server is Linux and it supports C++ and Java.</p><p><strong>According to their website,</strong> AnzoGraph DB is built for online data analytics with performance that linearly scales. It is a Massively Parallel Processing (MPP) native graph database built for analytics at scale (trillions of triples and more), speed and deep link insights. It is intended for embedded analytics that require graph algorithms, graph views, named queries, aggregates, built-in data science functions, data warehouse-style BI, and reporting functions. You can try out their real-world test, check out their <a href=\"https://info.cambridgesemantics.com/cambridge-semantics-shatters-previous-record-of-loading-and-querying-trillion-triples-by-100x\">benchmark study</a>, and download a <a href=\"https://info.cambridgesemantics.com/anzograph/download\">60-day free trial</a>.</p><p>Some reviews of AnzoGraph DB exist right here on Medium. Check out this article: <a href=\"https://towardsdatascience.com/graph-databases-whats-the-big-deal-ec310b1bc0ed\">Graph Databases. What’s the Big Deal?</a> by <a href=\"https://towardsdatascience.com/@faviovazquez\">Favio Vázquez</a>. He points out that “graph OLAP databases are becoming very important as Machine Learning and AI grows since a number of Machine Learning algorithms are inherently graph algorithms and are more efficient to run on a graph OLAP database vs. running them on a RDBMS.”</p><p>Another examination of <a href=\"https://www.zdnet.com/article/back-to-the-future-does-graph-database-success-hang-on-query-language/\">AnzoGraph</a> exists in the article written by <a href=\"https://www.zdnet.com/meet-the-team/us/george-anadiotis/\">George Anadiotis</a>, which compares AnzoGraph to TigerGraph.</p><h3><strong>Conclusion</strong></h3><p>There are many options for graphing databases, and it seems as though each is trying to find their own personal corner of the market. Which one is the best? It really depends on your needs. Every Graph DB will have its unique strengths, weaknesses, and benchmarks. And, as these systems develop and grow their weaknesses will change, and they will likely become more comprehensive and capable. Take the time to shop around and educate yourself on all the available options because there are a lot, and the numbers keep growing.</p><img width=\"1\" src=\"https://medium.com/_/stat?event=post.clientViewed&referrerSource=full_rss&postId=6b785e6e0818\" height=\"1\"><hr><p><a href=\"https://towardsdatascience.com/comparing-graph-databases-6b785e6e0818\">Comparing Graph Databases</a> was originally published in <a href=\"https://towardsdatascience.com\">Towards Data Science</a> on Medium, where people are continuing the conversation by highlighting and responding to this story.</p>",
   :direction "ltr"},
  :updated 1568987648000,
  :entities
  [{:mentions
    [{:text "database"} {:text "database system"} {:text "DBMS"}],
    :id "nlp/f/entity/wd:176165",
    :salienceLevel "mention",
    :label "database management system"}
   {:mentions [{:text "JavaScript"}],
    :id "nlp/f/entity/wd:2005",
    :salienceLevel "mention",
    :label "JavaScript"}
   {:mentions [{:text "graph database"}],
    :id "nlp/f/entity/wd:595971",
    :salienceLevel "mention",
    :label "graph database"}
   {:mentions [{:text "Java"}],
    :id "nlp/f/entity/wd:251",
    :salienceLevel "mention",
    :label "Java"}
   {:mentions [{:text "SQL"}],
    :id "nlp/f/entity/wd:47607",
    :salienceLevel "mention",
    :label "Structured Query Language"}],
  :alternate
  [{:href
    "https://towardsdatascience.com/comparing-graph-databases-6b785e6e0818?source=rss----7f60cf5620c9---4",
    :type "text/html"}],
  :title "Comparing Graph Databases",
  :author "Sam Bell",
  :published-str "Fri Sep 20 06:54:08 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16d4f0ba1e2:a1f8875:49b12733",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url
   "https://cdn-images-1.medium.com/max/200/1*nbH6DCWYCROKakBp8nYYlA.jpeg",
   :width 200,
   :height 200,
   :contentType "image/jpeg"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://medium.com/p/6b785e6e0818",
  :commonTopics
  [{:score 152.05214205195566,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.911,
    :id "nlp/f/topic/619",
    :salienceLevel "about",
    :label "database"}
   {:score 0.902,
    :id "nlp/f/topic/525",
    :salienceLevel "about",
    :label "computer science"}
   {:score 0.827,
    :id "nlp/f/topic/861",
    :salienceLevel "mention",
    :label "finance"}
   {:score 0.745,
    :id "nlp/f/topic/2010",
    :salienceLevel "mention",
    :label "scalability"}],
  :published 1568987648000,
  :fingerprint "247df08e",
  :canonicalUrl
  "https://towardsdatascience.com/comparing-graph-databases-6b785e6e0818?source=rss----7f60cf5620c9---4"}
 {:engagement 20,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1568893909558,
  :recrawled 1568918731955,
  :content
  {:content
   "<p>Structure and Interpretation of Computer Programs talked about abstraction barriers as a way to hide the intricacies of data structures made out of cons cells. Is this concept still useful in a world of literal hashmaps with string keys? I say, yes, but in a much more limited way than before. In this episode, we go into what abstraction barriers are, why (and why not) to use them, and the limits of their usefulness.</p>\n<p></p>\n<h2>Transcript</h2>\n<p>Eric Normand: What is an abstraction barrier? This is a concept from “Structure and Interpretation of Computer Programs.” In this episode, we’re going to talk about what it is, why to use it, and the limits of its usefulness.</p>\n<p>My name is Eric Normand, and I help people thrive with functional programming. Like I said, this is a concept that I was first introduced to in Structure and Interpretation of Computer Programs. I imagine it goes back further than that just because it’s a natural concept to develop.</p>\n<p>What it is basically is instead of doing some complex operations inline, you move them, you extract them out into a function, you name that function. Now you have a barrier, where you don’t really have to think about the internals of how this thing gets calculated, you have an operation that’s got a nice, clear, meaningful name that you’re working on.</p>\n<p>If you do this with a data structure, so in structure and interpretation of computer programs they’re using scheme. The data structure they use is just basically these cons cells, just pairs. They’re like two poles, but always pairs. They’re building these intricate little data structures out of them.</p>\n<p>For instance, in one example I can remember, they build an associative data structure where you can put keys and values and replace keys and values and look up keys by values. It’s all just cons cells. It’s all just pairs, and deeply nested stuff. They build the operations like add a new key value pair. Find the value for this key.</p>\n<p>These are operations. They’re giving them nice names. When you look at the code it’s just like…I have to explain this. In scheme, to get the first element from a console, you use a function called car C-A-R, and to get the second element from a console use a function called cdr, which is C-D-R.</p>\n<p>You would put these things like get the first element and car of the cdr of the cdr of the car, the car, and that will give you the element you’re looking for. As you’re looking at these operations, they’re not very meaningful except this like first, second, second, first, first, first.</p>\n<p>It’s just hard to wrap your head around what is that actually doing. It would be really nice if someone gave it a very meaningful name, like, “Find value given a key.” [laughs] Or just like “get” something like that. You do this to help your mind to encapsulate to put a barrier on the meaning.</p>\n<p>You can say, I don’t have to think about this anymore. There’s three operations I’m going to do on these things. I have them well named. I don’t have to go digging around myself and remember how to get a cdr, you know, what cdr, how many cdrs, I need to get the value of something.</p>\n<p>This is the what and the why. It’s because sometimes you’ve get these deeply nested things. Just for your mental capacity it’s hard when you inline those to be able to reason about the code. What’s happening is you’re just doing that basic naming operation. You’re naming this thing that you’re going to use a lot.</p>\n<p>You’re taking what are meaningless operations like car and cdr. They have a meaning but their level of meaning is very low. You’re elevating that function into a new level based on the name. The name is something much more meaningful at a higher level of meaning.</p>\n<p>It’s not data hiding. It is different from data hiding in one very important respect. It’s still all there. It’s still transparent. If you want to pierce your abstraction barrier, go right ahead. You can still map over it. It’s still a list. It’s still cons cells. You can still call car on it.</p>\n<p>You are not forced to use those abstraction barriers, those defined operations. Some people say it’s a fine line, because you’re saying you should. There’s some arguments like if this data structure escapes, no one’s going to know to use those things or they’re going to have to use them anyway. You have to give them to them.</p>\n<p>All that is true. I don’t want to argue about that. What I just want to argue is that there is this very important difference, which is that you don’t have to use those operations.</p>\n<p>It’s not like data hiding in an object-oriented system, where you’ve got all this private stuff. Then the three operations that you want to do on it are the public methods, and you don’t know how it’s implemented and you’re supposed to not care. You’re supposed to not even be able to mess with the data.</p>\n<p>You can mess with the data if you want to. This is important, because you want to be able to move through those levels. The trouble is, cons cells are not a very rich data structure. They basically suck. I’m just going to say like that. They’re really neat. They’re complete. You can build trees and lists and a whole variety of data structures with them.</p>\n<p>They’re not self-describing. You don’t know what you have, you just have this, if you printed them out they’re just be parentheses with stuff inside. They don’t have…They’re not human-readable. They are, but not very. You need to know what the different levels of the of the parentheses mean.</p>\n<p>You need some out-of-band communication, it’s not self-describing. A lot of problems that we have with these data structures are solved by having self-describing names, like a hash map, where the keys are strings. You can have a nice name.</p>\n<p>Before you had to build this associated data structure, now you can have a data structure that says, “Hey, I am an associated data structure. I have the curly braces in JSON. My keys are strings. My values are also some value that you can understand.”</p>\n<p>This is amazing. Now we don’t need to have these abstraction barriers to do the same thing. A lot of problems are solved just by having better data structures. You don’t need the abstraction. It removes a whole slew of reasons for needing abstraction barriers especially around these intricate data structures.</p>\n<p>There’s a thing where if you have public-facing data, you shouldn’t really use abstraction barriers. You should design that data to be easy to consume, easy to produce, not necessarily using specific operations. You want someone to build a type in this literal JSON and it be correct.</p>\n<p>You don’t want something where you need some complex operations that they have to define and basically copy from your code base in order to build the thing up. You don’t want that. A public-facing thing, you want very clear names. When you design them, and you put it out into the world, those names are a commitment.</p>\n<p>They’re a commitment on your part as an implementer that you’re going to honor those names. If you send me this JSON to my NPI endpoint, I’m going to read it. I’m telling you what is this key means and what the value, how I’m going to interpret the value. That is a commitment that you’re making. The self-describing nature of it is really important.</p>\n<p>You shouldn’t rely on an abstraction barrier. However, we also use besides using it for public-facing data, like a public-facing schema or spec. We also use data structures internally in our software. If you need some intermediate index of something, you’ll use a hash map to index it.</p>\n<p>Sometimes when you add it, when you make the index where you want to keep track of when you added the thing and when was the last time you accessed it. You’ve got all these other bits of information that you have to maintain. Sometimes, you want to maintain the order, and it’s in a hash map that doesn’t have order. You want to keep them in sync.</p>\n<p>Now, you’re starting to talk about this intricate data structure nested and other data structures. At some point, you’re back to the same problem that you had with cons cells which is deeply nested. You’re forgetting how many levels you have deep.</p>\n<p>You’re in-lining all these cdrs and cars, except they’re not cdrs and cars. They’re like, “I’ll get this internal map. Inside of that, get this thing.” Then that’s going to give you a map. Then you need the value out of that map. It’s all deeply nested again. It’s easy to get wrong.</p>\n<p>When you add a thing to the index, there’s like five things that you need to do, and yet they have to be right. You want to make it easy to get those things right. It’s like doing five things. It’s probably five lines of code. You’re repeating that everywhere. You want to try this up. You want to take that duplication, put it in a function, give it a good name.</p>\n<p>All the sudden, you’re doing abstraction barriers again. It’s just the way it is. Is just happens when you have these complex things. Like I said, this isn’t for something that’s going to go external. External, you want to be nice, and clean, and neat, and human-writable, human-readable.</p>\n<p>When you’re working internally, sometimes you need an index that’s really tricky and complicated, or you need some data structure that’s super weirdly nested. You want to start extracting out all those operations again.</p>\n<p>I want to say another thing. A lot of times…I think in SICP, it says there’s two, and I disagree with it. I disagree with SICP, that Structure and Interpretation of Computer Programs. One of the reasons they give for using abstraction barriers is so that you can change the data structure if you need to.</p>\n<p>This is just so overused. We write code today, more complicated than it needs to be because maybe one day in the future, we might want to change it. I just think that that’s wrong. Why complicate your life today for something that might or might not happen in a way that you can’t even predict?</p>\n<p>If you know how it’s going to change, if you’re saying, “Look, I know I’m going to swap out my database in one year. I’m using this one database now because I can’t afford the one I really want. When my company does better, I’ll have an income. I’ll be able to pay for that database I do want. I want to be able to swap it out easily.”</p>\n<p>Sure. If you’ve got some plan for changing it and you don’t want to have to change all the code again, sure, fine. If that’s part of your plan, you need to be able to change it, yes. Put some kind of indirection in there. If you’re just doing it like a just in case, like maybe we’ll need it, no, do not do that.</p>\n<p>People say it, but I think you should not put abstraction barriers just because you might want to change it. You should put abstraction barriers to make it clear what’s going on, especially when you got these intricate, tricky things. It’s hard to get right.</p>\n<p>You shouldn’t use it for public-facing data. That should be well-designed, clean, simple, something that another person could write code to generate and not rely on your perfect implementation of all these operations.</p>\n<p>You should use it for these intricate data structures that never leave. These indexes aren’t meant to be printed out and send over a wire. They’re meant to be stored in memory for some algorithm or something you’re doing on it where you need constant time access.</p>\n<p>All right, so abstraction barriers, I’m going to recap real fast. Abstraction barriers are simply taking operations that you’re doing on some data structure or some piece of data. You’re repeating it. It doesn’t have enough meaning, so you extract it out and give it a name.</p>\n<p>If you can count all the operations you’re doing on this data structure…Let’s say there’s three, there’s four of them. You extract all of them out, give them good names. Now, you no longer have to go down into the data structure and manipulate things at the low level. You can operate it at a higher level. That sounds like a good thing to me.</p>\n<p>It differs from data hiding in that you can always pierce the barrier. You can look at it, and it’s just raw data. It’s not some encapsulated class or object that has some bespoke methods on it that you can’t see how it’s implemented inside. You can pierce it.</p>\n<p>Hash maps and other very much more descriptive data structures that we have in the modern languages, these are because they’re literals. They have descriptive names. They have more well-understood properties, like an array has certain order to it. You don’t need to use a cons cell, which has almost no meaning behind it.</p>\n<p>You’ve got higher-level stuff, self-describing. You have literal versions of it. You don’t have to even think about constructors so much anymore. It’s much nicer, but we still build up these intricate, highly nested things for internal use.</p>\n<p>I believe that abstraction barriers, as I’ve defined them here, are useful for that, that you want to be able to be operating at a higher level even though it’s this really intricate turning of machines and stuff. It’s just normal.</p>\n<p>Let me say it a different way. Hash maps, descriptive names and stuff remove a huge need for the abstraction barriers. We reinvent the problem, because we have all these highly-nested intricate data structures.</p>\n<p>Again, they are now made of hash maps, and vectors, and sets, and whatever else we have. They’re still there. They’re just not cons cells anymore. They’re just some other thing.</p>\n<p>I’ve seen so many messes in languages like Clojure, that use these data structures a lot when they start getting nested, people forget what they have. They start coupling code together because they’re coupling the “where a value lives” deeply nested in this map.</p>\n<p>Because they’re using some path into the nested data structure with the operation — what they want to do. The “where” and the “what they want to do” get coupled together. Having a little bit of barriers when you have a mess, it’s like having little bins to put all your stuff in instead of having in one big bin. It’s just a way to organize it in a way to keep a little bit of sanity when things start to get into a mess.</p>\n<p>All right. This has been all about abstraction barriers. This might be a tad controversial. Abstraction barrier shouldn’t be used all the time. I’m not saying that. I still think that they’re really useful, especially when you’ve got nested data structures and you’re starting to get into a mess.</p>\n<p>If you liked this episode, please subscribe. Go to lispcast.com/podcast. There you’re going to find all the past episodes. Listen to the one where I talk about building your interface first. Listen to the one where I say just use data. I really think these are subtle issues and it’s not as simple as like use this, don’t use that. You got to allow for some subtlety in there.</p>\n<p>You’ll find all the past episodes with audio, video and text transcripts. You listen to it however you want, watch it, or you can even read it if that’s how you like to do it. You can also subscribe. There you’ll find links to subscribe in the various platforms, and also links to find me on social media.</p>\n<p>That’s email, Twitter, LinkedIn. Get in touch with me. If you disagree with me, I would love to have a discussion about this because I think it is a bit controversial.</p>\n<p>I’d love to hear more arguments for and against. If you’ve got one of those, or you’ve got a question because I didn’t go over something clearly enough, come on, just hit me up, and we’ll talk. Awesome.</p>\n<p>My name is Eric Normand. This has been my thought on functional programming. Thank you for listening and rock on.</p>\n<p>The post <a rel=\"nofollow\" href=\"https://lispcast.com/what-is-an-abstraction-barrier/\">What is an abstraction barrier?</a> appeared first on <a rel=\"nofollow\" href=\"https://lispcast.com\">LispCast</a>.</p>",
   :direction "ltr"},
  :updated 1568890800000,
  :entities
  [{:mentions [{:text "data structure"}],
    :id "nlp/f/entity/wd:175263",
    :salienceLevel "about",
    :label "data structure"}
   {:mentions
    [{:text "Structure and Interpretation of Computer Programs"}
     {:text "SICP"}],
    :id "nlp/f/entity/wd:1249747",
    :salienceLevel "about",
    :label "Structure and Interpretation of Computer Programs"}
   {:mentions [{:text "functional programming"}],
    :id "nlp/f/entity/wd:193076",
    :salienceLevel "mention",
    :label "functional programming"}
   {:mentions [{:text "JSON"}],
    :id "nlp/f/entity/wd:2063",
    :salienceLevel "mention",
    :label "JavaScript Object Notation"}
   {:mentions [{:text "Twitter"}],
    :id "nlp/f/entity/wd:918",
    :salienceLevel "mention",
    :label "Twitter"}],
  :alternate
  [{:href "https://lispcast.com/what-is-an-abstraction-barrier/",
    :type "text/html"}],
  :title "What is an abstraction barrier?",
  :author "Eric Normand",
  :published-str "Thu Sep 19 04:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16d495d3a36:9bb6d65:97b0c8f7",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url
   "https://lispcast.com/wp-content/uploads/2019/09/What-is-an-abstraction-barrier_.jpg",
   :width 1280,
   :height 720,
   :contentType "image/jpeg"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://lispcast.com/?p=2025",
  :updateCount 1,
  :commonTopics
  [{:score 38.37057509463374,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.746,
    :id "nlp/f/topic/663",
    :salienceLevel "mention",
    :label "digital transformation"}
   {:score 0.739,
    :id "nlp/f/topic/2461",
    :salienceLevel "mention",
    :label "web design"}],
  :published 1568890800000,
  :fingerprint "e3dc8df",
  :canonicalUrl "https://lispcast.com/what-is-an-abstraction-barrier/"}
 {:engagement 7,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1568764318791,
  :content
  {:content
   "<p>\nFor the most part, computing libraries such as <a href=\"https://neanderthal.uncomplicate.org\">Neanderthal</a> ()\nabstract the complexity of GPU computing. When you have high-level linear algebra operations,\nsuch as <code>mm!</code> (matrix multiply), <code>nrm2</code> (vector/matrix norm), or <code>sum</code>, you do not have to\nworry about compiling kernels, loading modules, sending operations to the right stream in\nthe right context, handling stream execution errors, and a bunch of other details.\nThe code we write and test on the CPU can be executed on the GPU!\n</p>\n<p>\nHowever, there is one <i>important</i> thing we have to keep in mind: GPU computing\nroutines are asynchronous by default! Most of the time we see the benefits of\nsuch behavior, but in some common situations, it can surprise even\nan experienced developer (yes, humans are fallible).\n</p>\n<p>\nSuppose we have some code that uses a costly matrix multiplication operation.\n</p>\n<div>\n<pre><span>(</span>with-release <span>[</span>cpu-a <span>(</span>entry! <span>(</span>fge 100 100<span>)</span> 0.01<span>)</span>\n               cpu-b <span>(</span>entry! <span>(</span>fge 100 100<span>)</span> 0.02<span>)</span>\n               cpu-c <span>(</span>entry! <span>(</span>fge 100 100<span>)</span> 0.02<span>)</span><span>]</span>\n  <span>(</span>time <span>(</span><span>dotimes</span> <span>[</span>i 100<span>]</span>\n          <span>(</span>mm! 1.0 cpu-a cpu-b 0.0 cpu-c<span>)</span><span>)</span><span>)</span><span>)</span>\n</pre>\n</div>\n<pre>&quot;Elapsed time: 1.153745 msecs&quot;\n</pre>\n<p>\nWe called the <code>mm!</code> operation 100 times in a loop and measured the execution time.\nA bit over 1 millisecond in total, or 10 microseconds per operation.\n</p>\n<p>\nWe decided that, although it is quite fast, it's not fast enough for our\ncustomer's requirements. There's an opportunity to use powerful GPU accelerators,\nand we read in their specs that they can achieve quite a performance boost over Intel CPUs.\nSince we do not have to adjust the code to run on the GPU (that is, not that much),\nwe quickly write a few tests to see whether the platform switch is worth the effort.\n</p>\n<p>\nThe following code is a port of the previous example to the Nvidia GPU.\nIt is a bit different since GPU context has to be created and managed.\nIt is possible to further abstract these differences away, but I wanted to keep this\nexample straightforward and obvious.\n</p>\n<div>\n<pre><span>(</span>with-default\n  <span>(</span>with-default-engine\n    <span>(</span>with-release <span>[</span>gpu-a <span>(</span>entry! <span>(</span>cuge 100 100<span>)</span> 0.01<span>)</span>\n                   gpu-b <span>(</span>entry! <span>(</span>cuge 100 100<span>)</span> 0.02<span>)</span>\n                   gpu-c <span>(</span>entry! <span>(</span>cuge 100 100<span>)</span> 0.02<span>)</span><span>]</span>\n<span>;; </span><span>sunchronize! makes sure that measurement is not initiated</span>\n<span>;; </span><span>until the GPU stream is ready</span>\n      <span>(</span>synchronize!<span>)</span>\n      <span>(</span>time\n       <span>(</span><span>dotimes</span> <span>[</span>i 100<span>]</span>\n         <span>(</span>mm! 1.0 gpu-a gpu-b 0.0 gpu-c<span>)</span><span>)</span><span>)</span><span>)</span><span>)</span><span>)</span>\n</pre>\n</div>\n<pre>&quot;Elapsed time: 0.796928 msecs&quot;\n</pre>\n<p>\nWith the same size and computation complexity, we got a modest speedup.\nWhat is the problem? We expected a boost! We ask around, and see that communication\nwith the GPU driver carries a fixed overhead. GPU pays off with more expensive operations.\n</p>\n<p>\nOK, then; let's give it some monster matrices.\n</p>\n<div>\n<pre><span>(</span>with-default\n  <span>(</span>with-default-engine\n    <span>(</span>with-release <span>[</span>gpu-a <span>(</span>entry! <span>(</span>cuge 10000 10000<span>)</span> 0.01<span>)</span>\n                   gpu-b <span>(</span>entry! <span>(</span>cuge 10000 10000<span>)</span> 0.02<span>)</span>\n                   gpu-c <span>(</span>entry! <span>(</span>cuge 10000 10000<span>)</span> 0.02<span>)</span><span>]</span>\n      <span>(</span>synchronize!<span>)</span>\n      <span>(</span>time\n       <span>(</span><span>dotimes</span> <span>[</span>i 100<span>]</span>\n         <span>(</span>mm! 1.0 gpu-a gpu-b 0.0 gpu-c<span>)</span><span>)</span><span>)</span><span>)</span><span>)</span><span>)</span>\n</pre>\n</div>\n<pre>&quot;Elapsed time: 2.232541 msecs&quot;\n</pre>\n<p>\nWhow, we increased matrix sizes by a lot, and the GPU didn't even sweat.\nIt finished in almost the same time as before!\n</p>\n<p>\nWhat happens on the CPU, do large matrices slow it down?\n</p>\n<div>\n<pre><span>(</span>with-release <span>[</span>cpu-a <span>(</span>entry! <span>(</span>fge 10000 10000<span>)</span> 0.01<span>)</span>\n               cpu-b <span>(</span>entry! <span>(</span>fge 10000 10000<span>)</span> 0.02<span>)</span>\n               cpu-c <span>(</span>entry! <span>(</span>fge 10000 10000<span>)</span> 0.02<span>)</span><span>]</span>\n  <span>(</span>time <span>(</span>mm! 1.0 cpu-a cpu-b 0.0 cpu-c<span>)</span><span>)</span><span>)</span>\n</pre>\n</div>\n<pre>&quot;Elapsed time: 6557.759385 msecs&quot;\n</pre>\n<p>\nWe excitedly tell everyone decide to transfer all computations to the GPU,\nsince what took days to complete on the CPU, will complete in seconds according\nto our calculations.\n</p>\n<p>\nA skeptical colleague is not so sure!\n</p>\n<p>\nWe are reminded that (many) GPU operations are <i>asynchronous</i>.\n</p>\n<p>\nOur <code>mm!</code> operation does have the same signature on GPU and CPU, but while on the\nCPU it's synchronous, on the GPU is <i>asynchronous</i>. Simply put, on the GPU, calling\n<code>mm!</code> means &quot;I acknowledge that I received your request for matrix multiplication and I have\nput it in the computation queue&quot;, and not &quot;I have completed the matrix multiplication that you've\nrequested&quot;, as it means on the CPU.\n</p>\n<p>\nWhen we measured it in the last example, we just measured how fast the GPU\ncan receive the requests for the <code>mm!</code> operation. Not surprisingly, the size of the\narguments does not make much difference there.\n</p>\n<p>\nTo measure how fast the GPU can <i>complete</i> the operation, we must synchronize\nthe queue.\n</p>\n<div>\n<pre><span>(</span>with-default\n  <span>(</span>with-default-engine\n    <span>(</span>with-release <span>[</span>gpu-a <span>(</span>entry! <span>(</span>cuge 10000 10000<span>)</span> 0.01<span>)</span>\n                   gpu-b <span>(</span>entry! <span>(</span>cuge 10000 10000<span>)</span> 0.02<span>)</span>\n                   gpu-c <span>(</span>entry! <span>(</span>cuge 10000 10000<span>)</span> 0.02<span>)</span><span>]</span>\n      <span>(</span>synchronize!<span>)</span>\n      <span>(</span>time\n       <span>(</span><span>dotimes</span> <span>[</span>i 100<span>]</span>\n         <span>(</span>mm! 1.0 gpu-a gpu-b 0.0 gpu-c<span>)</span>\n         <span>(</span>synchronize!<span>)</span><span>)</span><span>)</span><span>)</span><span>)</span><span>)</span>\n</pre>\n</div>\n<pre>&quot;Elapsed time: 17117.724387 msecs&quot;\n</pre>\n<p>\nOuch! Instead of 2 microseconds for 100 invocations, we get 17 <i>seconds</i>.\nThat's 171 <i>milli</i> seconds per operation, not 20 <i>micro</i> seconds. Disappointed? We should not be!\nIt's almost 40 times faster than the 6.5 seconds we measured on the CPU.\nFor large matrices, it usually does make sense to use GPU; for medium sized it depends.\n</p>\n<p>\nIf we only work with small-ish data, it never pays off to use GPU. Never? Well,\nthat depends, too. We can <i>group</i> small chunks into larger units that can be\ncomputed in batches, but that is out of scope of this article.\n</p>\n<p>\nAnyway, suppose that we have decided that it pays off to add GPU engine to our project.\nThe code is similar, but there are enough differences. This call to <code>synchronize!</code> bothers\nus, since it is CUDA-specific.\n</p>\n<p>\nFortunately, most of the time we do not need to synchronize streams,\nand even when we do have to, we do not have to do it explicitly.\nThere are operations available on both CPU and GPU, that <i>implicitly</i> synchronize the stream.\n</p>\n<p>\nFor example, summary matrix and vector operations such as <code>sum</code>, <code>nrm2</code>, <code>dot</code>,\netc, which compute a scalar result, implicitly synchronize the stream.\nThe operations that transfer data between CPU and GPU are synchronous by default, too.\n</p>\n<div>\n<pre><span>(</span>with-default\n  <span>(</span>with-default-engine\n    <span>(</span>with-release <span>[</span>gpu-a <span>(</span>entry! <span>(</span>cuge 10000 10000<span>)</span> 0.01<span>)</span>\n                   gpu-b <span>(</span>entry! <span>(</span>cuge 10000 10000<span>)</span> 0.02<span>)</span>\n                   gpu-c <span>(</span>entry! <span>(</span>cuge 10000 10000<span>)</span> 0.02<span>)</span><span>]</span>\n      <span>;; </span><span>(synchronize!)</span>\n      <span>(</span>time\n       <span>(</span><span>dotimes</span> <span>[</span>i 100<span>]</span>\n         <span>(</span>mm! 1.0 gpu-a gpu-b 0.0 gpu-c<span>)</span>\n         <span>(</span>asum gpu-c<span>)</span><span>)</span><span>)</span><span>)</span><span>)</span><span>)</span>\n</pre>\n</div>\n<pre>;; &quot;Elapsed time: 17211.007038 msecs&quot;\n</pre>\n<div>\n<h2>Source code for this article</h2>\n<div>\n<p>\nThe leiningen project with full source code is available at <a href=\"https://www.patreon.com/posts/30045483\">draganrocks Patreon page.</a>\nYou can choose one of pre-selected tiers, or pledge any amount that you can afford\nto support <a href=\"https://github.com/uncomplicate\">https://github.com/uncomplicate</a> open-source Clojure libraries.\n</p>\n</div>\n</div>",
   :direction "ltr"},
  :updated 1568757600000,
  :entities
  [{:mentions [{:text "GPU"}],
    :id "nlp/f/entity/wd:183484",
    :salienceLevel "about",
    :label "graphics processing unit"}
   {:mentions [{:text "CPU"}],
    :id "nlp/f/entity/wd:5300",
    :salienceLevel "mention",
    :label "central processing unit"}
   {:mentions [{:text "Neanderthal"}],
    :id "nlp/f/entity/wd:40171",
    :salienceLevel "mention",
    :label "Neanderthal"}
   {:mentions [{:text "source code"} {:text "source"}],
    :id "nlp/f/entity/wd:128751",
    :salienceLevel "mention",
    :label "source code"}
   {:mentions [{:text "linear algebra"}],
    :id "nlp/f/entity/wd:82571",
    :salienceLevel "mention",
    :label "linear algebra"}],
  :alternate
  [{:href
    "http://dragan.rocks/articles/19/Common-Gotcha-Asynchronous-GPU-CUDA-Computing-Clojure",
    :type "text/html"}],
  :title "A Common Gotcha with Asynchronous GPU Computing",
  :author "Dragan Djuric",
  :published-str "Tue Sep 17 15:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16d41a3d447:8de23e9:69b9f616",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "http://dragan.rocks/articles/19/Common-Gotcha-Asynchronous-GPU-CUDA-Computing-Clojure",
  :commonTopics
  [{:score 59.20684927873222,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1568757600000,
  :fingerprint "3d863ad2",
  :canonicalUrl
  "https://dragan.rocks/articles/19/Common-Gotcha-Asynchronous-GPU-CUDA-Computing-Clojure"}
 {:engagement 7,
  :unread false,
  :crawled 1568718491151,
  :content
  {:content
   "<div><h1>Senior Developer</h1><div>T-Scape Limited | Lisbon,Portugal or Cork,Ireland or Remote</div><div><em></em></div><div>€0 - €500</div><div><a href=\"http://t-scape.com\">http://t-scape.com</a></div><br><div><p>We are a small company creating a niche financial services product. People we have a strong domain knowledge in the areas we are focusing on and want to bring fresh ideas to old problems. We are creating a development base in Lisbon</p><p>We are open to new initiatives and ideas.</p><p>You will be working with a small team with close contact to the Business Analysts, you will need to understand and question their requirements for ongoing tasks and expansion of our flag ship product.</p><p>We are looking for someone who can find innovative solutions to problems. You will be</p>\n<ul>\n<li>Self-motivated, energetic and upbeat;</li>\n<li>Take a logical and systematic approach to problem solving;</li>\n<li>Strive for timely completion of projects;</li>\n<li>Take ownership and responsibility;</li>\n<li>Able to make decisions but are not foolhardy;</li>\n<li>Ask questions and take advice;</li>\n<li>You are pragmatic and prefer simple solutions</li>\n<li>Have the ability to prioritize the urgency of multiple requests and then take charge of these to meet deadlines.</li>\n<li>Fluent in English</li>\n</ul><p>You will need to liaise with our clients if problems arise or to discuss their requirements. As the company expands you must be able to help and nurture junior members of the team.</p><p>Skills required.</p><p>The product itself is split into three components, the backend server, an application server, and a web based client front end. The key development for this role will report to the backend server and the application server, both of which are written using Clojure.</p><p>You will need</p>\n<ul>\n<li>An excellent knowledge and commercial experience using Clojure, and Java 8+. You should have a good understanding of the STM.</li>\n<li>Database access via JDBC to one or more of Oracle, SQL Server or Postgres</li>\n<li>Source control is via GIT, with frequent branches and merges.</li>\n<li>Documentation is produced in Confluence and Issue Reporting uses JIRA.</li>\n</ul><p>Any knowledge of the following will be a plus but not essential:</p>\n<ul>\n<li>Front End development using Angular 7+, angular cli, CSS, HTML5 and ag-grid</li>\n<li>Spring MVC and Spring Security for the application server</li>\n<li>Middleware in the form of Spring Integration for interfaces.</li>\n</ul></div></div>",
   :direction "ltr"},
  :updated 1568716719000,
  :entities
  [{:mentions [{:text "application server"} {:text "server"}],
    :id "nlp/f/entity/wd:44127",
    :salienceLevel "mention",
    :label "server"}
   {:mentions [{:text "problem solving"}],
    :id "nlp/f/entity/wd:730920",
    :salienceLevel "mention",
    :label "problem solving"}
   {:mentions [{:text "Lisbon"}],
    :id "nlp/f/entity/wd:597",
    :salienceLevel "mention",
    :label "Lisbon"}
   {:mentions [{:text "front end"}],
    :id "nlp/f/entity/wd:620167",
    :salienceLevel "mention",
    :label "front end"}
   {:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}],
  :alternate
  [{:href
    "https://jobs.braveclojure.com/jobs/17592186047090/senior-developer-t-scape-limited",
    :type "text/html"}],
  :title "Senior Developer",
  :author "Brave Clojure Jobs",
  :published-str "Tue Sep 17 03:38:39 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16d3ee88e0f:8cc8bfd:97b0c8f7",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://jobs.braveclojure.com/jobs/17592186047090/senior-developer-t-scape-limited",
  :commonTopics
  [{:score 67.06095099663867,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.764,
    :id "nlp/f/topic/2461",
    :salienceLevel "mention",
    :label "web design"}],
  :published 1568716719000,
  :fingerprint "6d7396b3",
  :canonicalUrl
  "https://jobs.braveclojure.com/jobs/17592186047090/senior-developer-t-scape-limited"}
 {:engagement 5,
  :unread false,
  :crawled 1568710129949,
  :content
  {:content
   "During the last few weeks, I've been working on implementing once again the solutions to problems from <a href=\"https://projecteuler.net/\">Project Euler</a> starting with the first 50 problems, which are now published on this Github repo: <a href=\"https://github.com/dfuenzalida/euler-cljc\">euler-cljc</a>.<br><br>Back in 2012 I was interested in learning Clojure but couldn't think of problems that were small enough to be worked on in small bites but ran into Project Euler, loved the idea and opened an account to track my progress. I would use the problems as a mean to get familiar with the language and its core library. Eventually, I managed to solve 75 of the puzzles with varying degrees of success: many of the solutions are decent but others demonstrate not only that I wasn't familiar with the language yet, but also that settled for a naive solution, left it running for a while and eventually the code brute-forced the problem.<br><br>Seven years later, I decided to create a variation of <a href=\"https://twitter.com/borkdude\">Borkdude</a>'s <a href=\"https://github.com/borkdude/advent-of-cljc\">Advent of CLJC</a> but for problems from Project Euler for fun, but also to review that <a href=\"https://github.com/dfuenzalida/euler\">old code</a> and share some of the things I found when comparing the old programming style, approach and development workflow. Some of the following learnings could be also interesting to people that are new to Clojure/ClojureScript and still figuring out the individual pieces.<br><br><b>Development workflow</b><br><br>Back in 2012 I was coming from a Java/Groovy background and possibly the most advanced usage of a REPL equivalent that I had seen was the one in Rails projects where you could start a <a href=\"https://guides.rubyonrails.org/command_line.html#rails-console\">Ruby console</a> and create blog posts from the interactive shell, but in general the discipline I was used to back then was: creating a test, seeing the test fail, create the simplest implementation that would make the test pass, see the test pass, then refactor.<br><br>Your feedback loop was constrained to seeing the results of the execution of your unit tests. Some frameworks would let you have an agent running that would re-run your tests automatically when a file was saved, because it was clear that you should have feedback as soon as possible. Having to click on &quot;Re-run tests&quot; in your IDE and seeing the progress bar fill <i>was not fast enough</i>.<br><br>It took me a while to understand how the REPL-driven development workflow was like. If you haven't seen it before, think of it as editing your code while having the means to get instant feedback as fast as entering numbers in a spreadsheet: you change a formula in a given cell and some other cells update instantly, and you can refine whether that helps you solve the problem at hand.<br><br>When I was learning Clojure I would have my editor and a terminal and run <b><span>lein -m my.project.namespace</span></b> every now and then and run a few functions from the console, or I may have a REPL and I would be pasting code into it and then evaluate some small expressions this way. My old code is plagued with small <b><span>-main</span></b> functions or other bits that tell me that I ran the code directly from the command line. Also, some of it it's because my solutions were poor and I let the code running for more than a few seconds (but I'll touch on that later).<br><br>It was not until much later that I saw some talk where someone demonstrated how to evaluate code directly from the code editor with a keyboard shortcut that it landed on me. Eventually it became like second nature, but it's the kind of thing that doesn't seem possible until you see it from somebody else. Nowadays, coding in any language that doesn't offer a similar experience seems very rudimentary.<br><br>If you are learning Clojure, you should know that learning how to use the REPL from your editor of choice soon will be a time investment that will pay itself and will boost your productivity. Fortunately, most popular code editors that people are familiar have some plugin or feature that allows starting or connecting to a running REPL server.<br><br><b>Nested definitions</b><br><br>If you are coming to Clojure from another language, it will be natural to try to re-map the concepts you already know into a different syntax, but this can also be a source of errors.<br><br>My old code is full of <a href=\"https://github.com/dfuenzalida/euler/blob/master/src/euler/problem03.clj#L6-L20\">nested <b><span>def</span></b>s</a> because in Java you use the same syntax to define variables in any scope (or maybe I got the impression it would work like the <a href=\"https://sarabander.github.io/sicp/html/3_002e2.xhtml#g_t3_002e2_002e4\"><i>internal definitions</i> example from SICP</a>?). Most of those <span>def</span>s should be <span><b>let</b></span> bindings in the scope of an outer function and a few of the names should just be moved within the namespace so that readers don't get confused about an &quot;inner def&quot;. Defs always create a binding <i>at the namespace level</i>, regardless of how nested they are in the code.<br><br>If you are learning Clojure, it would be a good idea for you to bookmark the <a href=\"https://guide.clojure.style/\">Clojure Style Guide</a> at this point, it's full of great advice that will make your code more readable to other people, because a lot of the time it's about communicating the intent and your assumptions in code too.<br><br><b>Eval time vs. runtime</b><br><br>Another issue my old code has is defining values that are the result of an expensive computation. If you see something like:<br><br><span>;; </span><span><span>takes 10 seconds to compute</span></span><br><span>(def pi-digits (compute-pi-slow (* 1000 1000))) </span><br><br>... what will happen when Clojure loads this line is that before loading the rest of your application, the name <span>pi-digits</span> will be bound to a result <i>after</i> computing these prime numbers. This approach can slow your application startup or give you a false sense of how fast is your code, because effectively you have evaluated something expensive at one time (when the namespace is being loaded) and you might be calling functions that use these definitions at an entirely different time.<br><br>The solution in this case is: turn this computation into a function that you call at will or, wrap the value you need into a <a href=\"https://clojuredocs.org/clojure.core/delay\">delay</a> so that the program can compile without actually computing the value. The latter require you to use <b><span>deref</span></b> (or <b><span>@</span></b>) in your code, which could be seen as a marker of &quot;<i>here's a value potentially slow to compute</i>&quot;. Note that the value is computed once and cached for later. <br><br><b>Know your standard library</b><br><br>Another issue that I faced when learning Clojure was getting familiar with the many different functions of the standard library and the different ways they can be combined.<br><br>When you start learning Clojure, you may come from a mindset where it's natural to encapsulate your data in different ways and <i>create ah-doc code</i> to transform one model representing your data into another. Sadly, this is common in large Java codebases and APIs to the point where even <a href=\"https://github.com/jmapper-framework/jmapper-core\">libraries exist</a> to help with this problem. Rich Hickey has mentioned this a number of times: each new Class is a new ad-hoc glorified API, incompatible with existing general purpose functions.<br><br>In Clojure, it's natural to represent data in terms of simple values that aggregate into lists of things or maps from keys of any type and shape to values of any type or shape. And, at the very bottom, there's the <a href=\"https://clojure.org/reference/sequences\">sequence</a> abstraction that applies to every collection: a List is naturally a sequence of the head of the list followed by the rest of the list. A HashMap is a sequence (in some order) of key-value pairs. Then you have a large number of functions that can operate at this level and help you extract and recombine your data in different ways. That is tremendously powerful and it's where the <a href=\"https://en.wikipedia.org/wiki/Alan_Perlis\">Alan Perlis</a> quote shines: &quot;<i>It's better to have 100 functions operate on one data structure than to have 10 functions operate on 10 data structures</i>&quot;.<br><br>Examples from <a href=\"https://clojuredocs.org/\">ClojureDocs</a> are very helpful but sometimes you don't even know the name of what you are looking for: this is what REPL functions like <a href=\"https://clojuredocs.org/clojure.repl/apropos\">apropos</a> are for. If you find yourself implementing a function that is fairly general (eg. <a href=\"https://clojuredocs.org/clojure.core/min-key\">smallest value in a map</a>, <a href=\"https://clojuredocs.org/clojure.core/map-indexed\">pairing elements with their position in a collection</a>), trust your gut feeling when it tells you <i>I'm sure this function already exists</i> in the clojure.core namespace.<br><br><b>When solving math problems, compute the absolutely minimum required</b><br><br>This may sound obvious and not only applicable to problems from Project Euler, in my experience it's applicable to code you implement in your daily job too: it's very tempting to do some kind of micro-benchmark with a very small subset of data or small collections, but as you start adding zeroes to the size of the input set, the space/time complexity will kill you.<br><br>If the problem asks you about &quot;<a href=\"https://projecteuler.net/problem=15\">how many routes exist through a grid of size NxN where you can move only to the right or down</a>&quot; my first instinct is to be able to find a way to encode each route, then generate each possible <i>valid</i> route, then count them all. This will work only for small grids, but as you attempt to compute the solution for larger and larger grids you need to realize how it explodes in complexity and wonder if it may be possible to <i>compute the total number</i> without counting each valid option.<br><br>The same idea applies on other problems that ask for digit permutations and other problems that look deceitfully simple for smaller bounds. If you find your program needs to run for more than say, 30 seconds to find a solution, it's a strong signal that you are solving the wrong problem. Go outside or have some hammock time and let your back-burner, subconscious brain to explore the problem.<br><br><b>Pipeline of data transforms and bottom-up vs. top-down</b><br><br>Now that I know more about the language that seven years ago, I noticed how a pattern emerged on many of my new solutions:<br><br>&lt;<i>generate a basic (often lazy) collection: prime numbers, fibonacci numbers, input from a file, etc.</i>><br><br>then<br><br>&lt;<i>possibly combine with some index or some other data from the domain</i>><br><br>then<br><br>&lt;<i>filter elements by some criteria</i>><br><br>then<br><br>&lt;<i>transform again using some function</i>><br><br>then<br><br>&lt;<i>aggregate the results and produce a single result, the solution to the problem</i>><br><br>This pattern made me realize something that other people have described about their own development workflows: rather than starting from the top with a whole problem and breaking down the problem until you implement it in terms of small functions, I found myself doing the opposite: understanding how to build from the smaller blocks and how to combine them in purpose, embracing the problem, until you solve it.<br><br>I'm starting to think the former approach (top-down) is part of the perspective of the OOP culture, where you describe the world in terms of a discrete set of entity classes with their attributes and the interactions between them. In this world you want to map the world in terms of roles and it seems even reasonable because it sounds like divide-and-conquer: to understand the whole, break it into individual parts and their relations.<br><br>It should be clear by now that this approach is not universal and that it offers help to come up with a mental model but from there to a prescription for implementation there's a larger stretch.<br><br><b>Exploring the problem iteratively</b><br><br>Sometimes you have a hint or a gut feeling of how large is the problem space, but sometimes it's perfectly acceptable to iterate. In <a href=\"https://projecteuler.net/problem=44\">problem 44</a> you are expected to find a value but I didn't want to hard-code an arbitrary limit of how far to search, so I first implemented the solution exploring the problem space in powers of ten: look for the solution in the first 1,000 pentagonal numbers, then in the first 10,000 and so on.<br><br>This worked fine on the JVM, but later when running the solution in Node I ran into an issue where this code put too much stress on the GC and crashed after not being able to free memory after a short while.<br><br><b>Be aware of differences between Clojure and ClojureScript</b><br><br>Sharing code between Clojure and ClojureScript is a great thing but don't forget both are hosted languages. Besides the <a href=\"https://clojurescript.org/about/differences\">differences</a> in multi-threading story of their respective platforms, there are <a href=\"https://www.clojurescript.org/about/differences#_the_reader\">subtle differences</a> between both for the purposes of solving these puzzles:<br><br><ul><li>ClojureScript doesn't have a character literal as in Clojure, and they are single-character strings instead. In practice this is not very important unless you want to extract digits from a number or the index of characters in the English alphabet (e.g. &quot;E&quot; is the 5th letter). For digits you can either use <a href=\"https://clojuredocs.org/clojure.core/quot\">quot</a> and <a href=\"https://clojuredocs.org/clojure.core/rem\">rem</a> to extract the individual digits in base 10, or a function like the following:</li></ul><span>    (defn char-score [c]</span><span><span><br>    </span>  #?(:clj (inc (- (int c) (int \\A)))</span><span><span><br>    </span>     :cljs (inc (- (.charCodeAt c 0) (.charCodeAt &quot;A&quot; 0))))) </span><br><span><span><br>    </span>(reduce + (map char-score &quot;COLIN&quot;)) ;; => 3 + 15 + 12 + 9 + 14 = 53</span><br><ul><li>ClojureScript doesn't support <i>BigDecimal</i> or <i>BigInteger</i>. A new type, <i>BigInt,</i> was <a href=\"https://v8.dev/features/bigint\">added about a year ago to V8</a> and they are supported on most current JS engines (they also worked on my tests using Node 10 in my laptop). This may be a problem if you are trying to rely on arbitrary-size integers to solve <a href=\"https://projecteuler.net/problem=13\">problem 13</a>, so you need to think a little more, or use code that uses BigIntegers in the JVM and BigInts in Node. </li></ul><ul><li>Differences in <i><b>regular expressions</b></i>: there are <a href=\"https://cljs.github.io/api/syntax/regex\">minor differences in how Regexes work in ClojureScript</a> compared to Clojure because they use the features provided by their host platform, but these rarely are a concern. I solved one problem using regexes (<a href=\"https://projecteuler.net/problem=26\">Problem 26</a>, about the length of periodic decimals) and it wasn't an issue.</li></ul><br><b>Laziness as a virtue</b><br><br>This is related to the &quot;computing the absolute minimum required&quot; idea. By having lazy sequences at hand, it's possible to express elegantly a number of constructs in this sort of problem: sequences of primes, Fibonacci numbers, triangular / pentagonal / hexagonal numbers, etc.<br><br>In some of the new implementations of the puzzles I relied a lot on the language to compute only what was required using <span>map</span>, <span><a href=\"https://clojuredocs.org/clojure.core/lazy-seq\">lazy-seq</a></span> or <span>take-while</span>, which are also lazy. If you understand how laziness works you can <i>let the code decide</i> how many elements of these sequences are needed for any given step, and more importantly, <b><i>when</i></b> they need to be computed.<br><br>On the other hand, there are scenarios where you don't want to be lazy because having predictable performance characteristics in your code is a must, and the language gives you the option.<br><br>So, that was 9 ideas after using Clojure (again) to solve puzzles. If you have planning or starting to learn Clojure I think this advice applies the most to you.<br><br> If you are interested, here's my <a href=\"https://github.com/dfuenzalida/euler-cljc\">Github repo with the new solutions</a>. Feel free to take a look and if you are interested in submitting your own solutions, PRs are welcome. I'll try to keep uploading solutions to the remaining problems too.",
   :direction "ltr"},
  :updated 1568707202000,
  :entities
  [{:mentions [{:text "Project Euler"}],
    :id "nlp/f/entity/wd:168430",
    :salienceLevel "about",
    :label "Project Euler"}
   {:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "Problem"}],
    :id "nlp/f/entity/wd:16736785",
    :salienceLevel "mention",
    :label "Problem"}
   {:mentions [{:text "REPL"}],
    :id "nlp/f/entity/wd:2032810",
    :salienceLevel "mention",
    :label "Read–eval–print loop"}
   {:mentions [{:text "Java"}],
    :id "nlp/f/entity/wd:251",
    :salienceLevel "mention",
    :label "Java"}],
  :alternate
  [{:href
    "http://www.plusastra.com/2019/09/solving-project-euler-puzzles-using.html",
    :type "text/html"}],
  :title "Solving Project Euler puzzles using Clojure, 7 years later",
  :author "Denis Fuenzalida",
  :published-str "Tue Sep 17 01:00:02 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16d3e68f91d:8aedb14:49b12733",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "tag:blogger.com,1999:blog-994064438874341582.post-4098273047059646548",
  :commonTopics
  [{:score 94.92239041162101,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.943,
    :id "nlp/f/topic/1555",
    :salienceLevel "about",
    :label "net"}
   {:score 0.931,
    :id "nlp/f/topic/2010",
    :salienceLevel "about",
    :label "scalability"}
   {:score 0.915,
    :id "nlp/f/topic/76",
    :salienceLevel "about",
    :label "algorithms"}
   {:score 0.872,
    :id "nlp/f/topic/1871",
    :salienceLevel "about",
    :label "quant"}
   {:score 0.823,
    :id "nlp/f/topic/52",
    :salienceLevel "mention",
    :label "agile"}
   {:score 0.791,
    :id "nlp/f/topic/525",
    :salienceLevel "mention",
    :label "computer science"}
   {:score 0.79,
    :id "nlp/f/topic/2461",
    :salienceLevel "mention",
    :label "web design"}
   {:score 0.773,
    :id "nlp/f/topic/262",
    :salienceLevel "mention",
    :label "bioinformatics"}
   {:score 0.712,
    :id "nlp/f/topic/334",
    :salienceLevel "mention",
    :label "browsers"}
   {:score 0.709,
    :id "nlp/f/topic/774",
    :salienceLevel "mention",
    :label "engineering"}],
  :published 1568707202000,
  :fingerprint "a723a67e",
  :canonicalUrl
  "http://www.plusastra.com/2019/09/solving-project-euler-puzzles-using.html"}
 {:engagement 5,
  :unread false,
  :crawled 1568635175725,
  :recrawled 1568649541301,
  :content
  {:content
   "<p>I’ve gotten several questions about how to do X or Y in the Onion Architecture. It seems like giving the architecture a name has miscommunicated how simple it is. It’s just function calls that at some point are all calculations. In this episode, I try to deconstruct what makes the onion architecture work. Spoiler: it’s just function calls.</p>\n<p></p>\n<h2>Transcript</h2>\n<p>Eric Normand: In the Onion Architecture, how do you make business decisions that rely on information from actions? I get this question a lot, especially when I bring up Onion Architecture in more of these episodes. In this episode, I am going to answer it for everyone. My name is Eric Normand. I help people thrive with functional programming.</p>\n<p>The Onion Architecture is a way of structuring your application with actions on the outside. These are called the interaction layer because if you’re interacting with the world you really have your enactions. You’re receiving requests from the outside. You’re making API requests yourself.</p>\n<p>You’re reading from the database. You’re doing a lot of IO, having effects on the world or sending emails. You’re making lights blink. Whatever your software does. That’s all in the interaction layer.</p>\n<p>Inside you have a nice, pure set of layers that are all about calculations. I like to divide them up in a certain way. I like to put the business rules as my first layer inside. Inside of that, a domain layer.</p>\n<p>Both of those, it doesn’t matter how you divide it up, especially for this discussion. They’re calculations. They’re pure. They are not based on stuff from the outside. They have no effect on the outside. They’re like little brain that you can give it questions and it will answer their questions. It’s making decisions, basically.</p>\n<p>You got this calculations making decisions, business decision, even simple domain decisions. The actions are doing stuff like fetching stuff from the database. Sending data to an API.</p>\n<p>Here’s the question that I get a lot, “If you’ve got the Onion Architecture, how do you make decisions that should be calculations like how many times to retry an API? If it fails the first time, do you retry?” That’s a decision your software has to make. How do you have a calculation that decides that it needs to have more information from the database?</p>\n<p>It says OK. I’ve done a bunch of stuff. Now I know, I need this more information. It can’t get it itself. How does that information get up to the higher layer so that the higher layer can get it and then give it back to it? It’s weird. It starts to sound like a really difficult problem.</p>\n<p>I said, “I’ve gotten this question several times in different forms.” It’s a thing that I’ve caused a confusion I’ve caused in how I’ve explained it. I’m using language to try to talk about them as separate layers. People aren’t really used to thinking in layers.</p>\n<p>I’m going to try to pick it apart and put it back together with a new explanation. When I talk about layers, I’m talking about functions in your language, they’re either calculations or actions. Functions calling other functions. Function A calls function B.</p>\n<p>There is a relationship there. If you draw all of the relationships between functions, and what functions those functions call, then what functions of those function calls. You make sure all of the arrows are pointing down. You have the stuff that nothing calls up at the top that would be like your main.</p>\n<p>Then you have the stuff that calls, but nothing else called and you can just arrange them all. At some point, you could draw a line and say, “Everything below this line is calculations.” Because a calculation cannot call an action. If a calculation called an action, it’s not a calculation.</p>\n<p>By definition, calculations cannot call anything above that line. You could draw a line and say, “This stuff down here is all calculations.” The stuff above is all actions.</p>\n<p>That’s what I mean by the layers. It’s all just function calls, it’s not like some kind of protocol for communicating and getting information like, “Here’s a decision I need you to make,” so you give me the answer, and then I ask you what I do with that answer.</p>\n<p>It’s not that, it’s just function calls. Let’s look at the two examples I gave, these two questions that were asked. If you have to do a retry, you make an API call, and it fails, it times out, you don’t know what happened. I’m going to retry it. How do you decide whether to retry it?</p>\n<p>Let’s say your rule in your system is retry it three times or retry it two times. You try it once, and you have two more times to retry. That’s really just a less than. You keep track of how many times you called it, and then you see if it’s less than three. If it’s less than three, then you’d keep trying. Then you decrement or whatever, and increment.</p>\n<p>That less than is a calculation. It is not named, and is probably in line right in your action. That is a calculation. It is a decision being made. You could, if you wanted to, say, actually this less than sign, this less than operation, less than three, is a business rule.</p>\n<p>I probably wouldn’t call it a business rule. It’s more like an architectural rule or system integrity rule, something like that. You could say, I want to name this function that will decide, based on how many times I’ve already tried the API, whether I should try again.</p>\n<p>Just a simple Boolean. It’s basically just the body of the function. It’s just less than. Less than three or whatever number you choose. You could say that’s a business rule. Put it in there. The action is just calling this, like function called Retry Question Mark or Should Retry. This is the name of the function.</p>\n<p>You notice, this is the name of the action calling a calculation. That’s it, that’s all it is. The action is in the interaction layer, and the calculation is in the business layer.</p>\n<p>What if you’re doing something, and you’re doing this big calculation. You’ve managed to turn it into a nice data pipeline. At some point in the pipeline, something says, “Whoa, I need more data from the database. I need this record,” or, “I need this whole set of records from the database to continue working.” What do you do?</p>\n<p>Again, when I read the question, it sounds like the same thing, where people are thinking like, “This interaction layer is telling the business layer to do all this work.” Then, somehow, the business layer needs to communicate back up to the interaction layer, and it’s going to go fetch something. There’s this back and forth, back and forth communication.</p>\n<p>I don’t know what people are thinking, but it sounds a lot like an object-oriented mindset, where you got this two peers that are communicating.</p>\n<p>It’s server, just peer-to-peer communication, with this protocol of like, “You tell me what data you got, and I’ll start calculating. When I need more, I’ll tell you that I need more, and then you’ll fetch it for me, and then I’ll keep going, and then I’ll tell you I need more.”</p>\n<p>That is not what I’m trying to get at. When I have taken the code that people have given me, example, this is really hard to do on the Onion Architecture. Basically, all I do is I move stuff from this big action. It’s like 20, 30 lines, and I just move things. I said, “Oh, that could be a calculation. That’s like a business rule, and this is a business rule.” I just move it into calculations.</p>\n<p>Then the action just gets shorter, because now it’s just calling these name functions instead of all this inline code. A lot of it is moving into other actions, by the way. It’s like threading it through.</p>\n<p>OK, we’re going to fetch this thing from the database, and then past that to this calculation, it’s going to give us an answer. Then we take another thing from the database, and we pass it to the next function with what we already had. That’s going to do some other calculation.</p>\n<p>It looks like regular code. It just looks like normal code. I feel like by naming the thing, like Onion Architecture, I’ve somehow confused people that they think it has to be much more sophisticated, complicated than it has to be.</p>\n<p>This is the way I see it. A calculation can only make decisions based on what it knows, what it has been passed through the arguments. It can’t say, “Oh, I need more data.” Whatever has to decide, “This thing needs more data,” it’s not a calculation. It’s an action in an upper layer.</p>\n<p>What comes out is that we’re doing this because of efficiency, because we might not need to fetch that huge data set from the database. We won’t know until we’re halfway through the calculation whether we’re going to need it or not.</p>\n<p>That’s cool. That’s a different problem. Now, we’re talking about, “Are we doing a lazy thing?” Or, “Does this calculation really have a natural point, a break point, where it’s really two calculations that can be called separately, and results from the first thing can be threaded into the second part?”</p>\n<p>Is that what’s going on? The idea that this calculation gets to a point says, “OK, I need more data.” The laziness might solve it. We’ve talked about that before, in previous episodes. We constructed a delay. The delay, it’s a suitable thing. Because the calculation is still pure, even though now by triggering this delay to be realized, it is fetching data.</p>\n<p>That logic was injected in. It was passed in from the outside. In fact, I’ve seen Onion Architecture implementations that get passed a function, and then that function just returns the data. You could pass it in a function with dummy data that just gets returned, or you can pass it a function that will fetch the data from the database.</p>\n<p>Does that turn that calculation into an action because it is now fetching from the database, even though it doesn’t know? That is a very philosophical question that you’re going to have to draw the line somewhere, where you feel comfortable with, I would be very comfortable with that kind of thing. That’s up to you.</p>\n<p>I don’t know if I’ve really done my goal, [laughs] achieved my goal of deconstructing this, and really framing it back in terms of function calls.</p>\n<p>The Onion Architecture, it’s maybe more of just a way to look at it, that you don’t have to have everything in a big set of actions. That you can push business rules down into calculations, down the layers.</p>\n<p>Remember, if all of our dependencies, all of our function call lines are pointing down, that means calculations…They can’t call up because they’re below the actions. That’s what I mean by pushing it down.</p>\n<p>We’re taking these business rules, making sure that they’re implemented as pure functions as calculations. They go into a separate layer that then gets called by the interaction layer. That interaction layer is stuff like, I got a Web request — that’s an action. That depends on when, it’s a timely thing. You also can’t decide when you’d get it, it just comes.</p>\n<p>I got a Web request. Now, I have to decide what this Web request is. I’m going to route it. The route, that’s probably a calculation. It’s going to take that path, and it’s going to tell me something, like how this request should be handled.</p>\n<p>I take that information, I know how it should be handled, still in the interaction layer. That means I had to call this handler. This handler needs XYZ to be called. It needs a little bit more data. It needs the user information, the session, that kind of stuff.</p>\n<p>It adds that in, and then the handler gets called. Handler is probably still part of the interaction layer, it still might fetch stuff from the database. This thing is going to fetch that from the database, make a big decision or several small decisions from the business rules, package it up as a response, and then send it back out.</p>\n<p>It’s all function calls. The handler is calling calculations, and then coming back. I look at it like, you don’t need to do anything special, except just make sure that at some point, you do have all calculations going down.</p>\n<p>That you don’t have a thing where this business rule that is deep down in the…The call graph is going to fetch out to the database somewhere. That’s all it is. That should actually be up at the top, and make sure that stuff is pure. That’s all it is.</p>\n<p>I hope this hasn’t been too mystifying. I fear it has been. If it has, get in touch with me. I want to talk about this in a way that’s more understandable. If you have a better way to explain it, if I’m confusing you more, send me examples of things that you don’t understand how you could turn into an Onion Architecture.</p>\n<p>You can get in touch with me by going to lispcast.com/podcast. There you’re going to find links to social media like email, Twitter, stuff like that — whatever you think is best for communicating with me, based on the length. Probably if you got some code, it’s best to go by email, not Twitter, but you decide.</p>\n<p>You’ll also find links to subscribe to this podcast. You’ll see all the old episodes with audio, video and text transcripts, so if you need to go back and binge-listen, binge-watch or binge-read, it’s there. I was looking at it the other day. I have 139 episodes, so this is 140. That’s quite a number.</p>\n<p>This has been my thought on functional programming. My name is Eric Normand. Thank you for listening and rock on.</p>\n<p>The post <a rel=\"nofollow\" href=\"https://lispcast.com/in-the-onion-architecture-how-do-you-make-business-decisions-that-rely-on-information-from-actions/\">In the onion architecture, how do you make business decisions that rely on information from actions?</a> appeared first on <a rel=\"nofollow\" href=\"https://lispcast.com\">LispCast</a>.</p>",
   :direction "ltr"},
  :updated 1568631600000,
  :entities
  [{:mentions [{:text "API"}],
    :id "nlp/f/entity/wd:165194",
    :salienceLevel "mention",
    :label "application programming interface"}
   {:mentions [{:text "functional programming"}],
    :id "nlp/f/entity/wd:193076",
    :salienceLevel "mention",
    :label "functional programming"}
   {:mentions [{:text "Web"}],
    :id "nlp/f/entity/wd:466",
    :salienceLevel "mention",
    :label "World Wide Web"}
   {:mentions [{:text "Twitter"}],
    :id "nlp/f/entity/wd:918",
    :salienceLevel "mention",
    :label "Twitter"}
   {:mentions [{:text "Boolean"}],
    :id "nlp/f/entity/wd:520777",
    :salienceLevel "mention",
    :label "Boolean data type"}],
  :alternate
  [{:href
    "https://lispcast.com/in-the-onion-architecture-how-do-you-make-business-decisions-that-rely-on-information-from-actions/",
    :type "text/html"}],
  :title
  "In the onion architecture, how do you make business decisions that rely on information from actions?",
  :author "Eric Normand",
  :published-str "Mon Sep 16 04:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16d39f1432d:84fe054:49b12733",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url
   "https://lispcast.com/wp-content/uploads/2019/09/In-the-onion-architecture-how-do-you-make-business-decisions-that-rely-on-information-from-actions_.jpg",
   :width 1280,
   :height 720,
   :contentType "image/jpeg"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://lispcast.com/?p=2019",
  :updateCount 1,
  :commonTopics
  [{:score 34.6968617154802,
    :id "nlp/f/topic/3050",
    :salienceLevel "about",
    :label "architecture"}
   {:score 0.866,
    :id "nlp/f/topic/776",
    :salienceLevel "about",
    :label "enterprise architecture"}],
  :published 1568631600000,
  :fingerprint "ad465921",
  :canonicalUrl
  "https://lispcast.com/in-the-onion-architecture-how-do-you-make-business-decisions-that-rely-on-information-from-actions/"}
 {:engagement 6,
  :unread false,
  :crawled 1568630775536,
  :content
  {:content
   "<div>\n<p><em>Issue 344 – September 16, 2019 · <a href=\"https://purelyfunctional.tv/newsletter-archives/\">Archives</a> · <a title=\"Thanks, Jeff!\" href=\"https://purelyfunctional.tv/newsletter/\">Subscribe</a></em></p>\n<h2>Clojure Tip 💡</h2>\n<p><em>say thanks to Clojure open source developers</em></p>\n<p>Open source work is hard. People demand a lot of you, and you work for very little money, if any. This goes for open source library, tool, and Clojure core developers. They could all use more messages of thanks for their mostly thankless job.</p>\n<p>How to say thanks: keep it simple. “Thanks for all your work on X. I use it all the time and it helps me Y.” A quick message over email or other social media is all it takes to brighten someone’s day.</p>\n<h2>Book status 📖</h2>\n<p>I have new codes for my book. They give you 40% off of <em>everything</em> at Manning.</p>\n<p>Code: <strong>PUREFUNC40</strong></p>\n<p>Feel free to buy my book and anything else that suits your fancy. I’ll get a small affiliate fee 🙂</p>\n<p>You can find my book, <em>Grokking Simplicity</em>, <a title href=\"https://lispcast.com/gs\">here</a>.</p>\n<p>About the book itself, I’ve found a pretty good layout for showing code progress. That is, code before and after small changes. A sequence of those pages can show a significant change to the code without losing the readers.</p>\n<p>It’s mostly a graphic design challenge. What font sizes, weights, and other typographical features make a) everything fit side-by-side and b) make it clear what’s being changed.</p>\n<p>You’d think this was already solved, but it’s not. Most authors use the whole width of the page for code listings, then show progress by describing changes in prose. It works, but it’s a lot of burden to put on the reader. I’m hoping this is one of the features that will set my book apart.</p>\n<p><img title=\"\" src=\"https://purelyfunctional.tv/wp-content/uploads/2019/09/side-by-side-code-in-grokking-simplicity.png\"></p>\n<h2>Currently recording 🎥</h2>\n<p>Another week without any new lessons in the <a title href=\"https://purelyfunctional.tv/courses/property-based-testing-with-test-check/\">Property-based Testing course</a>. My apologies. I try to keep professional but life does get in the way.</p>\n<p>Thanks for all of your messages of interest in Property-Based Testing. I am going to finish the course. It’s an important topic and there isn’t enough material on it.</p>\n<h2>Brain skill 😎</h2>\n<p><em>align your learning with purpose</em></p>\n<p>Learning for learning’s sake is great. Following your curiosity is both pleasurable and fruitful.</p>\n<p>But curiosity is not always aligned with our desires. For instance, I want to learn Elixir and Rust. I’m curious about them, but that curiosity is easily quenched by reading high-level descriptions of them with a few code examples. I’ve accepted that curiosity is not going to drive my learning.</p>\n<p>So I must find a purpose. I must find some purpose for which learning Elixir or Rust would really help. It’s either that or force myself to learn them. But that sounds doubly tedious. Be both laborer and manager.</p>\n<p>Purpose has a couple of benefits. For one, it has motivation built in. If I succeed, I have something to be proud of. The second benefit is that it forces me to stay practical. If I’m learning Rust to build an embedded device, I know what I have to learn and getting the software to compile and run is a practical goal. Otherwise, I could read endless documentation about the borrow checker. Purpose is clarifying.</p>\n<p>So what purpose are you going to put Clojure to?</p>\n<h2>Clojure Challenge 🤔</h2>\n<h3>Last week’s challenge</h3>\n<p>The challenge in <a title href=\"https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-343-tip-read-the-exception-message/\">Issue 343</a> was to make a higher-order function that makes another function idempotent.</p>\n<p>You can check out the submissions <a title href=\"https://gist.github.com/ericnormand/0cf9051444599c746d2f92e0227e578d\">here</a>.</p>\n<h3>This week’s challenge</h3>\n<p><em>retry three times</em></p>\n<p>One of the beautiful things about functional programming is higher-order functions. We write functions that operate on functions. This lets us pass around code to run later, bundled up as a function.</p>\n<p>In last week’s challenge, we saw how we could wrap a function in another to make it idempotent. This week, we will make a function that retries another function three times, or until it succeeds.</p>\n<p>But first, what does it mean to fail? On the JVM, failure is commonly represented with a thrown exception. So, your task is to write a function that will call its argument. If it throws an exception, it tries again, up to three times total.</p>\n<p>As usual, please send me your implementations. I’ll share them all in next week’s issue. If you send me one, but you don’t want me to share it publicly, please let me know.</p>\n<p>Rock on!<br>Eric Normand</p>\n</div>\n<p>The post <a rel=\"nofollow\" href=\"https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-344-tip-thank-a-clojure-oss-dev-today/\">PurelyFunctional.tv Newsletter 344: Tip: thank a Clojure OSS dev today</a> appeared first on <a rel=\"nofollow\" href=\"https://purelyfunctional.tv\">PurelyFunctional.tv</a>.</p>",
   :direction "ltr"},
  :updated 1568628000000,
  :entities
  [{:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "about",
    :label "Clojure"}
   {:mentions [{:text "Elixir"}],
    :id "nlp/f/entity/wd:5362035",
    :salienceLevel "mention",
    :label "Elixir"}
   {:mentions [{:text "graphic design"}],
    :id "nlp/f/entity/wd:185925",
    :salienceLevel "mention",
    :label "graphic design"}
   {:mentions [{:text "higher-order function"}],
    :id "nlp/f/entity/wd:1474542",
    :salienceLevel "mention",
    :label "higher-order function"}
   {:mentions [{:text "functional programming"}],
    :id "nlp/f/entity/wd:193076",
    :salienceLevel "mention",
    :label "functional programming"}],
  :alternate
  [{:href
    "https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-344-tip-thank-a-clojure-oss-dev-today/",
    :type "text/html"}],
  :title
  "PurelyFunctional.tv Newsletter 344: Tip: thank a Clojure OSS dev today",
  :author "Eric Normand",
  :published-str "Mon Sep 16 03:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16d39ae1ef0:85a88ee:97b0c8f7",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url
   "https://purelyfunctional.tv/wp-content/uploads/2019/09/side-by-side-code-in-grokking-simplicity.png",
   :width 985,
   :height 1210,
   :contentType "image/png"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://purelyfunctional.tv/?p=32015",
  :commonTopics
  [{:score 84.92819521322534,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.973,
    :id "nlp/f/topic/575",
    :salienceLevel "about",
    :label "crm"}
   {:score 0.823,
    :id "nlp/f/topic/774",
    :salienceLevel "mention",
    :label "engineering"}
   {:score 0.8,
    :id "nlp/f/topic/1871",
    :salienceLevel "mention",
    :label "quant"}
   {:score 0.779,
    :id "nlp/f/topic/874",
    :salienceLevel "mention",
    :label "fitness"}
   {:score 0.715,
    :id "nlp/f/topic/1555",
    :salienceLevel "mention",
    :label "net"}],
  :published 1568628000000,
  :fingerprint "582ce8e4",
  :canonicalUrl
  "https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-344-tip-thank-a-clojure-oss-dev-today/"}
 {:engagement 73,
  :unread false,
  :crawled 1568609874518,
  :content
  {:content
   "<p><em>Header photo by <a href=\"https://unsplash.com/@rhondak?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText\">RhondaK Native Florida Folk Artist</a> on Unsplash</em></p>\n<p>I’m a full-stack developer, which means I’m a generalist. I believe that generalism in software development is a good thing. But many developers, engineering managers and even CTOs think that generalists are a risk and that what software teams <em>really</em> need are specialists.</p>\n<p>Because apparently, generalists can’t be very good at what they do. After all, software systems are far too complex these days for any one person to ‘know’ their system inside-out. Right? And how could a generalist keep up the same pace as specialists when everything changes so fast? Surely they can’t hope to remain relevant? Surely a generalist can’t be any better than a mid-level developer in any of the things they know. Right?</p>\n<p>This fallacious logic is exactly why some people prefer specialists over generalists. It results in teams hiring front-end and back-end developers rather than just plain ol’ developers. Because—apparently—only specialists really know what they’re doing.</p>\n<p>But here’s the thing:</p>\n<p>A generalist <em>was</em> a specialist at some point. <strong>A generalist is born when a specialist becomes bored.</strong></p>\n<h1>\n<a href=\"https://dev.to/feed#the-generalists-first-language\">\n</a>\nThe generalist’s first language\n</h1>\n<p>In their first job, the generalist is not a generalist. How can they be? They are a novice. However, they do have <em>something</em> that sets them apart from their peers: an appetite to be an expert.</p>\n<p>They get to work learning language idioms and patterns. They learn about the language’s performance characteristics, how to communicate with external systems, and explore its library ecosystem. They read all of the books they can find, because they realise that learning didn’t stop when they left college.</p>\n<p>In my case it was C#. I was eager to become an expert so I had a whole desk full of books. I was extremely proud of my bookshelf! I read as many open source projects as I could, and even contributed to one or two along the way. I spent a good seven years as a C# developer, and yes—I would like to think I became something of an expert.</p>\n<p>But the same learning mindset that drove me to be an expert C# developer also drove me to be something else.</p>\n<p>At some point, every expert gets bored. They’ve learned as much as they can about the language and its frameworks. So to feed their appetite, they need to find something new.</p>\n<p>With the .NET ecosystem, as a developer with multiple years of experience, if you want to learn new things then you’re basically waiting for Microsoft to release the new version of Visual Studio to see what they’ve tinkered with this time around. Occasionally there are bittersweet moments when Microsoft obsolete some perfectly fine but slightly outdated framework and replace it with something slightly more modern and slightly less robust.</p>\n<p>This ‘keeping your knowledge up-to-date’ cycle gets a bit dull when all you know is one language.</p>\n<p>So the would-be generalist moves on to something different.</p>\n<h1>\n<a href=\"https://dev.to/feed#the-generalists-second-language\">\n</a>\nThe generalist’s second language\n</h1>\n<p>For me it was Ruby. And just wow… how refreshing was Ruby?! No longer at the mercy of Visual Studio! No longer forced to write full function signatures with return types and parameters types! My poor fingers would finally get a break! Dynamic typing… how wonderful! Everything is an expression… amazing! Metaprogramming… incredible! The shackles were off!</p>\n<p>I remember this moment as being liberating. While I was appreciative that C# had given me a <a href=\"https://en.wikipedia.org/wiki/SOLID\">solid</a> grounding in object-oriented design, I could now also appreciate that it was an unnecessarily complex language. And so I learned to love simplicity.</p>\n<h1>\n<a href=\"https://dev.to/feed#tdd-and-the-learning-cycle\">\n</a>\nTDD and the learning cycle\n</h1>\n<p>I’ll tell you my secret weapon for learning new languages: TDD. If you know TDD and a few katas, you can learn just about any language using the same pattern of learning. Just program a few katas and you’ll be off to a flying start. It’s really this simple.</p>\n<p>For me, my third language was Clojure, which as languages go is essentially perfect. The Clojure community has the same kind of business-thinking that the .NET community has, balanced with the same desire for simplicity that the Ruby community has.</p>\n<h1>\n<a href=\"https://dev.to/feed#the-fives-stages-of-grief\">\n</a>\nThe fives stages of grief\n</h1>\n<p>For my fourth language, to my horror I ended up working with JavaScript. I wasn’t particularly fond of JavaScript. A messy language, which I had to climb down to after scaling the wondrous heights of Clojure and ClojureScript.</p>\n<p>With JavaScript, I went through the five stages of grief.</p>\n<p>First comes denial. <em>“This will only be for a short while, then I can go back to <strong>real</strong> languages.”</em></p>\n<p>The second stage is anger. <em>“React…?! Facebook?! What gave these pesky developers the right to walk all over four decades of GUI development best practice?!”</em></p>\n<p>Then, bargaining. <em>“Hmmm, I can write my JavaScript with plain functions, just as if it was Clojure…”</em></p>\n<p>Then came depression. <em>“My career is over. I’m leaving to set up a beach hut restaurant.”</em></p>\n<p>Finally, acceptance. <em>“Okay, so I was wrong. JavaScript is totally fine. Time to update my LinkedIn profile - I’m a JavaScript dev!”</em></p>\n<h1>\n<a href=\"https://dev.to/feed#the-insight-of-past-experience\">\n</a>\nThe insight of past experience\n</h1>\n<p>One of the joys of being a generalist is you stop caring too much about ‘one true way’.</p>\n<p>Now that I’ve been working with JavaScript for several years, I can truly say that the past experience I’ve had with C#, Ruby and Clojure has made me a better JavaScript developer. I can see why the language is the way it is. I do not miss ‘real’ objects. I do not need classes. Prototypal inheritance is cute, and it certainly doesn’t give me “the rage”.</p>\n<p>I’m not eager to replace all my JavaScript code with TypeScript, because the benefit isn’t clear. I’m doing just fine without type definitions.</p>\n<p>I’m at ease with all of JavaScript’s kinks. They don’t bother me.</p>\n<p>I honestly don’t care too much about the difference between double equals and triple equals, because I know my tests will catch me if I get it wrong.</p>\n<p>I do not need a linter to tell me to use semi-colons or not, because I’m happy with either choice. I don’t need a linter to tell me to always return a value from my functions, because I’d rather not have to write extra code if I can avoid it. Ruby and Clojure got me very comfortable with unseen return values.</p>\n<p>JavaScript devs can get hyped up about the latest fads whereas I just shrug my shoulders. Most often I see new libraries as unnecessary complexity.</p>\n<p>When something new comes along, I ask myself <em>“Will this new tool|technique|library|framework help me write higher quality code, faster?”</em> If the answer is no, and very often it is no, then I won’t get excited.</p>\n<h1>\n<a href=\"https://dev.to/feed#can-generalists-remain-experts\">\n</a>\nCan generalists remain experts?\n</h1>\n<p>Let’s say for the sake of argument that it takes 5 years to become an expert with a language. Then someone with 15 years’ experience will have had time to master 3 languages.</p>\n<p>You might say their knowledge of the first two languages will be severely outdated. If they’ve stopped using them professionally they can’t possibly know what they are doing.</p>\n<p>That <em>might</em> be true if they completely stopped using that language or keeping abreast of news. But that’s not my experience of generalists. They have their ear to the ground and remain in the loop, and they also tend to be the kinds of people to take a few hours here and there to experiment with the latest and greatest features.</p>\n<p>What’s more, if you’ve got 5 years experience in a language, then catching up on the latest framework can mean spending as little as a day to build a toy application. It won’t take a year. Languages and frameworks change only incrementally.</p>\n<h1>\n<a href=\"https://dev.to/feed#generalists-pick-a-better-tool-for-the-job\">\n</a>\nGeneralists pick a better tool for the job\n</h1>\n<p>The privilege of being a generalist is that you get to pick the <em>better</em> tool for the job. (I won’t say <em>best</em> tool for the job because who really knows what’s best?)</p>\n<p>If the only tool you know is React, then you’re going to get a React solution, even if ‘at scale web applications’ is not your problem.</p>\n<h1>\n<a href=\"https://dev.to/feed#being-a-generalist-does-not-require-superhuman-abilities\">\n</a>\nBeing a generalist does not require superhuman abilities\n</h1>\n<p>On my latest project, I’ve had the opportunity to really get to grips with Docker and Nginx. I wouldn’t say I’m an expert, but what I can say is that out of everyone on my team, I’m the one who has been the most eager to jump in and learn it.</p>\n<p>My experience as a generalist tells me that as scary, difficult and complicated these tools may seem, I know that it’s possible to master them.</p>\n<p>I can see that for some of my teammates learning these tools seems <em>seriously</em> difficult. It will take a huge amount of energy, and they might fail.</p>\n<p>There’s no difference in ability between me and my teammates. They are all bright and hard-working. The difference is that I tend to have very little fear of picking up new technologies.</p>\n<h1>\n<a href=\"https://dev.to/feed#what-have-you-got-to-lose\">\n</a>\nWhat have you got to lose?\n</h1>\n<p>Picking between specialism and generalism is a false dichotomy. If you feel like specializing, then do it. Just don’t forget that beyond specialism lies generalism.</p>\n<p>Happy coding!<br>\n🙏🏻</p>",
   :direction "ltr"},
  :updated 1568582978000,
  :entities
  [{:mentions [{:text "JavaScript"}],
    :id "nlp/f/entity/wd:2005",
    :salienceLevel "mention",
    :label "JavaScript"}
   {:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "Ruby"}],
    :id "nlp/f/entity/wd:161053",
    :salienceLevel "mention",
    :label "Ruby"}
   {:mentions [{:text "Visual Studio"}],
    :id "nlp/f/entity/wd:134067",
    :salienceLevel "mention",
    :label "Microsoft Visual Studin"}
   {:mentions [{:text "Microsoft"}],
    :id "nlp/f/entity/wd:2283",
    :salienceLevel "mention",
    :label "Microsoft"}],
  :alternate
  [{:href
    "https://dev.to/d_ir/a-generalist-is-born-when-a-specialist-becomes-bored-3a6a",
    :type "text/html"}],
  :title "A generalist is born when a specialist becomes bored",
  :author "Daniel Irvine",
  :published-str "Sun Sep 15 14:29:38 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16d386f3256:80f9dbb:69b9f616",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url
   "https://res.cloudinary.com/practicaldev/image/fetch/s--7Cvcc34h--/c_imagga_scale,f_auto,fl_progressive,h_500,q_auto,w_1000/https://thepracticaldev.s3.amazonaws.com/i/wcxx7cfchwfssbeeh20a.jpg",
   :width 1000,
   :height 500,
   :contentType "image/jpeg"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://dev.to/d_ir/a-generalist-is-born-when-a-specialist-becomes-bored-3a6a",
  :commonTopics
  [{:score 62.56888352111345,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.953,
    :id "nlp/f/topic/1291",
    :salienceLevel "about",
    :label "languages"}
   {:score 0.869,
    :id "nlp/f/topic/1555",
    :salienceLevel "about",
    :label "net"}
   {:score 0.782,
    :id "nlp/f/topic/2010",
    :salienceLevel "mention",
    :label "scalability"}],
  :published 1568582978000,
  :fingerprint "4d27b319",
  :canonicalUrl
  "https://dev.to/d_ir/a-generalist-is-born-when-a-specialist-becomes-bored-3a6a"}
 {:engagement 6,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1568583034452,
  :content
  {:content
   "Continuing my series of Clojure do’s and don’ts — which, as always, is a mix of technical recommendations and my personal stylistic preferences — and continuing on the topic of the previous post in this series, here are some more arbitrary rules about anonymous functions. I’m doubling down the assertion in my last post: The… <p><a href=\"https://stuartsierra.com/2019/09/15/clojure-donts-numbered-parameters\">Read the full article</a></p><img alt=\"\" width=\"1\" src=\"http://feeds.feedburner.com/~r/StuartSierra/~4/-nq0Huk4REY\" height=\"1\">",
   :direction "ltr"},
  :updated 1568580105000,
  :entities
  [{:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "about",
    :label "Clojure"}],
  :alternate
  [{:href
    "http://feedproxy.google.com/~r/StuartSierra/~3/-nq0Huk4REY/clojure-donts-numbered-parameters",
    :type "text/html"}],
  :title "Clojure Don’ts: Numbered Parameters",
  :author "Stuart",
  :published-str "Sun Sep 15 13:41:45 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16d36d5a654:822f41c:97b0c8f7",
  :visual {:url "none"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://stuartsierra.com/?p=1191",
  :commonTopics
  [{:score 41.070875273843555,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1568580105000,
  :fingerprint "d2ef54e0",
  :canonicalUrl
  "http://feedproxy.google.com/~r/StuartSierra/~3/-nq0Huk4REY/clojure-donts-numbered-parameters"}
 {:engagement 4,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1568472942816,
  :content
  {:content
   "<p>This post is intended for <a href=\"https://clojure.org/\">Clojure</a> or <a href=\"https://clojurescript.org/\">ClojureScript</a> developers who're interested in trying prepl based tooling over traditional <a href=\"https://nrepl.org/\">nREPL</a> approaches. I hope to show you how to get started quickly with my own tool, <a href=\"https://github.com/Olical/propel\">Propel</a>, then show you where to go once you outgrow it.</p><p>You may be interested in my other post, <a href=\"https://oli.me.uk/2019-03-22-clojure-socket-prepl-cookbook/\">Clojure socket prepl cookbook</a>, which walks you through starting various socket prepls without any extra dependencies or tools.</p><h2>Interlude: prepl?</h2><p>If you aren't already aware, the prepl (pronounced &quot;prep-ul&quot; and written in lower case) is a new addition to Clojure and ClojureScript versions 1.10 and up. It's essentially a slight extension to the existing socket REPL which allows you to use a REPL over a socket as opposed to stdio.</p><p>Socket REPLs are fine for human interaction, over <code>netcat</code> perhaps, but aren't great for connecting automated tooling to a running application. There's no way to tell what kind of output you've received: stdout, stderr, tap and evaluation results are all indistinguishable from each other.</p><p>The prepl is a <strong>p</strong>rogrammable REPL, we send it code and it responds with EDN data structures that we can parse and handle with ease. Say we had a socket prepl on port <code>5555</code>, we could perform the following interaction with it.</p><pre><code>$ nc localhost 5555\n(do (println &quot;Hi!&quot;) (+ 10 10))\n{:tag :out, :val &quot;Hi!\\n&quot;}\n{:tag :ret, :val &quot;20&quot;, :ns &quot;user&quot;, :ms 3, :form &quot;(do (println \\&quot;Hi!\\&quot;) (+ 10 10)\\n)&quot;}\n</code></pre><p>The first line is the evaluation we performed, the other two are what the prepl responded with. We can clearly see stdout marked by <code>:tag :out</code> and the return value of the evaluation by <code>:tag :ret</code>. This is more than enough information to build tools on top of.</p><h2>Propel</h2><p><a href=\"https://github.com/Olical/propel\">Propel</a> is a tool I've written to make starting prepls more succinct, it also helps with connecting a stdio REPL to an existing prepl which can come in very handy.</p><blockquote><p> I do think that starting prepls will get easier in the future with built in support for simple command line flags that may look like Propel's. You'll also see them pop up natively in things like figwheel and shadow-cljs, the latter is being actively worked on (last I heard, anyway). My theory is that Propel won't be needed in the future but might be a nice stopgap and inspiration for future ideas. </p></blockquote><p>You can try it out for yourself by executing the following, providing you have the <a href=\"https://clojure.org/guides/deps_and_cli\">Clojure CLI</a> installed.</p><pre><code>$ clj -Sdeps '{:deps {olical/propel {:mvn/version &quot;1.3.0&quot;}}}' -m propel.main\n[Propel] Started a :jvm prepl at 127.0.0.1:46677\nuser=> (+ 10 20)\n30\n</code></pre><p>This command started a socket prepl on a free port and then started a stdio REPL that understands prepl and connected it to the socket. We can now connect whatever we want to that socket, such as <a href=\"https://github.com/Olical/conjure\">Conjure</a> (my Neovim tooling for Clojure and ClojureScript) or even another REPL. This could be useful if you started your socket prepl inside a Docker container or on a remote server.</p><blockquote><p> From here on in I'm going to assume you have a <code>deps.edn</code> containing <code>{:deps {olical/propel {:mvn/version &quot;...&quot;}}}</code> where the <code>...</code> is replaced by the current latest version. </p></blockquote><pre><code>$ clj -m propel.main -rp 46677\nuser=> (def message &quot;Hi!&quot;)\n#'user/message\n</code></pre><p>I've asked Propel to <i>not</i> start a new prepl (<code>-r</code> / <code>–repl-only</code>) and to set the port (<code>-p</code> / <code>–port</code>) to the previously selected one.</p><p>Then we can access that value in our original REPL.</p><pre><code>user=> message\n&quot;Hi!&quot;\n</code></pre><p>We could connect <a href=\"https://github.com/Olical/conjure\">Conjure</a> to our prepl by defining the following <code>.conjure.edn</code>.</p><pre><code>{:conns {:my-prepl {:port 46677}}}\n</code></pre><p>The port will change on every execution which will probably get annoying, we <i>could</i> get around this by specifying a chosen port when we start the socket prepl (<code>-p 5555</code>, for example). Alternatively, we could have Propel write it's selected port to a file that our tooling can read from.</p><pre><code>$ clj -m propel.main --write-port-file # (or -w)\n[Propel] Started a :jvm prepl at 127.0.0.1:38957 (written to &quot;.prepl-port&quot;)\nuser=>\n</code></pre><p>And then read that file in your <code>.conjure.edn</code> or equivalent.</p><pre><code>{:conns {:my-prepl {:port #slurp-edn &quot;.prepl-port&quot;}}}\n</code></pre><p>You could even have this sort of configuration inside your home directory (or <code>~/.config/conjure/conjure.edn</code>) to have this automatic connection across all of your projects.</p><h2>ClojureScript</h2><p>A lot of the ClojureScript use cases are extremely simple, we just need to change the environment from the default <code>:jvm</code>.</p><pre><code>$ clj -m propel.main --env node # (or -e)\ncljs.user=> (+ 10 20)\n30\n</code></pre><pre><code>$ clj -m propel.main -e browser\ncljs.user=> (js/alert &quot;Hello!&quot;)\n# You should see an alert dialog in a new tab in your browser.\n</code></pre><p>Figwheel is supported through the <code>:lein-figwheel</code> and <code>:figwheel</code> (the newer <a href=\"https://github.com/bhauman/figwheel-main\">figwheel-main</a>) environments. With <code>:lein-figwheel</code> it'll attempt to read your configuration from your <code>project.clj</code>, it's like executing <code>lein figwheel</code> but with a socket prepl automatically attached.</p><pre><code># https://github.com/bhauman/flappy-bird-demo\n\n# Lein\n$ lein run -m propel.main -- -e lein-figwheel -w\n\n# Clojure CLI\n$ clj -m propel.main -e lein-figwheel -w\n\nFigwheel: Starting server at http://0.0.0.0:3449\nFigwheel: Watching build - flappy-bird-demo\nCompiling build :flappy-bird-demo to &quot;resources/public/js/flappy_bird_demo.js&quot; from [&quot;src&quot;]...\nSuccessfully compiled build :flappy-bird-demo to &quot;resources/public/js/flappy_bird_demo.js&quot; in 0.578 seconds.\nFigwheel: Starting CSS Watcher for paths  [&quot;resources/public/css&quot;]\n[Propel] Started a :lein-figwheel prepl at 127.0.0.1:42315 (written to &quot;.prepl-port&quot;)\ncljs.user=>\n</code></pre><p>With <code>:figwheel</code> (<a href=\"https://github.com/bhauman/figwheel-main\">figwheel-main</a>), you need to specify a <code>–figwheel-build</code> which tells figwheel which <code>*.cljs.edn</code> file should be loaded. It defaults to <code>propel</code> so you could put your configuration in <code>propel.cljs.edn</code> and then execute the following.</p><pre><code># https://github.com/bhauman/flappy-bird-demo-new\n$ clj -m propel.main -e figwheel --figwheel-build flappy -w \n2019-09-14 15:07:03.203:INFO::main: Logging initialized @9786ms to org.eclipse.jetty.util.log.StdErrLog\n[Figwheel] Validating figwheel-main.edn\n[Figwheel] figwheel-main.edn is valid \\(ツ)/\n[Figwheel] Compiling build flappy to &quot;target/public/cljs-out/flappy-main.js&quot;\n[Figwheel] Successfully compiled build flappy to &quot;target/public/cljs-out/flappy-main.js&quot; in 1.022 seconds.\n[Figwheel] Watching paths: (&quot;src&quot;) to compile build - flappy\n[Figwheel] Starting Server at http://localhost:9500\nOpening URL http://localhost:9500\n[Propel] Started a :figwheel prepl at 127.0.0.1:46075 (written to &quot;.prepl-port&quot;)\nOpen URL http://localhost:9500\ncljs.user=>\n</code></pre><h2>Outgrowing Propel</h2><p>Propel isn't designed to be a comprehensive solution, it's a way to get going quickly but larger projects will most certainly find it limiting eventually. What happens when you want an nREPL + prepl + two figwheel instances all running inside the same JVM? You're going to need to have your own namespaces to start these things up yourself.</p><p>You can do most of this by calling the functions in the <code>propel.core</code> namespace, but you may need to do some more manual work to hook up a particularly hairy figwheel configuration to a prepl. I'd highly recommend you have a read of <a href=\"https://oli.me.uk/2019-03-22-clojure-socket-prepl-cookbook/\">Clojure socket prepl cookbook</a> to work that sort of thing out.</p><p>You can also learn a lot by reading Propel's source code, dive in and have a look at how I did things!</p><p>My point being: Propel will help you get going but you're going to need to have a read of some code to grow into multiple figwheel builds and prepls running alongside each other in the same JVM. <i>Hopefully</i> this won't be a problem in the future and you'll just be able to provide a single argument to any ClojureScript environment of your choosing.</p>",
   :direction "ltr"},
  :updated 1568415600000,
  :entities
  [{:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "REPL"}],
    :id "nlp/f/entity/wd:2032810",
    :salienceLevel "mention",
    :label "Read–eval–print loop"}
   {:mentions [{:text "JVM"}],
    :id "nlp/f/entity/wd:193321",
    :salienceLevel "mention",
    :label "Java Virtual Machine"}
   {:mentions [{:text "src"} {:text "source code"}],
    :id "nlp/f/entity/wd:128751",
    :salienceLevel "mention",
    :label "source code"}
   {:mentions [{:text "URL"}],
    :id "nlp/f/entity/wd:42253",
    :salienceLevel "mention",
    :label "Uniform Resource Locator"}],
  :alternate
  [{:href
    "https://oli.me.uk/2019-09-14-repling-into-projects-with-prepl-and-propel/",
    :type "text/html"}],
  :title "REPLing into projects with prepl and Propel",
  :author "\"(ollie {:on :parens})\"",
  :published-str "Fri Sep 13 16:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16d3045c8e0:7be5f21:97b0c8f7",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://oli.me.uk/2019-09-14-repling-into-projects-with-prepl-and-propel/",
  :commonTopics
  [{:score 90.70954556834774,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.841,
    :id "nlp/f/topic/2461",
    :salienceLevel "mention",
    :label "web design"}
   {:score 0.745,
    :id "nlp/f/topic/774",
    :salienceLevel "mention",
    :label "engineering"}],
  :published 1568415600000,
  :fingerprint "c76ebaf4",
  :canonicalUrl
  "https://oli.me.uk/2019-09-14-repling-into-projects-with-prepl-and-propel/"}
 {:tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1568402883729,
  :content
  {:content
   "<p>An interesting Clojure question came up on Quora recently and I decided that <a href=\"https://www.quora.com/If-you-use-Clojure-Spec-how-do-you-use-it-Do-you-tend-to-put-all-your-specs-in-one-place-or-distribute-them-through-the-modules-of-your-program/answer/Sean-Corfield?srid=upNN\">my answer to “how do you use clojure.spec”</a> there should probably be a blog post so that folks without a Quora account can still read it. <em>[If you do have a Quora account, feel free to read it there instead and upvote it!]</em></p>\n<p>The original question on Quora was:</p>\n<blockquote><p>If you use Clojure Spec, how do you use it? Do you tend to put all your specs in one place or distribute them through the “modules” of your program?</p></blockquote>\n<p>Here’s what I wrote, back in August 2019:</p>\n<p>We’ve been using Spec very heavily at work since the first alpha builds appeared. We use Spec in a number of ways: we use it for data validation (production), we use it for test data generation for example tests and for generative testing of functions (as well as generative scenario testing – more below), we use it at dev time as a checker for function calls (instrumentation) as well as for deriving code from the specs of data structures.</p>\n<p><strong>Data validation</strong></p>\n<p>We write specs for our API inputs and these specs live in their own namespace, along with the predicates needed for the specs. We <code>s/conform</code> the inputs against the specs and test the result with <code>s/invalid?</code> If the inputs conformed, we process the conformed data, else we use <code>s/explain-data</code> and then a heuristic algorithm to turn the explained failure back into an error code and message for API consumers. Note that we actually do some coercion of string inputs into basic data types via some of these specs – this is not considered good practice by some people but we’ve found it very convenient for this use case.</p>\n<p>We make sure nearly all of these API input specs will generate so that we can use them to generate test data for example-based tests (next section) or generative testing of some APIs (this isn’t practical for a lot of API endpoints but it can help in a few cases).</p>\n<p><strong>Test data generation</strong></p>\n<p>As noted above, we use the API input specs – and other specs – to generate some test data for example-based tests. We use this approach where we want a certain amount of random “good” data to throw at functions in general, when we only need to control a couple of the arguments or a couple of fields in those arguments – the randomly-generated data tends to be fairly “edge case” so it’s a good test of robustness (e.g., strings that include Unicode characters, generated from a regex using Gary Fredericks' test.chuck library).</p>\n<p><strong>Generative testing of functions</strong></p>\n<p>For some “key” functions, we’ll write specs that include <code>:ret</code> and/or <code>:fn</code> and we’ll test these generatively. The specs live in the same namespace as the functions, usually immediately above the function they are for. Some of these generative checks are run as part of our main test suite (so they are run every time). Some are too slow for that and the <code>check</code> calls live in <code>(comment ,,,)</code> to be run manually when we’ve been working on the function in question (we use Rich Comment Forms a lot for code that is convenient for our development workflow but does not really constitute test code).</p>\n<p><strong>Generative scenario testing</strong></p>\n<p>This might be an unusual use of specs but I think it’s potentially an important one. If you have an interactive application, you will have a number of paths through it that your users can take to get to certain known states. If you think of the paths as collections of user-generated events then you can write a spec for those (valid) paths through the application and you can then rely on spec to generate events that you can use to drive your application and then verify the end state. These specs live in the tests where they are needed.</p>\n<p><strong>Development time checking</strong></p>\n<p>This is a pretty basic, standard use of spec. Write specs for data structures and some functions. The latter live with the functions (<code>s/fdef</code> immediately above <code>defn</code>). The former may live with the functions if they are tightly coupled to them or in their own namespace if they are more concerned with data structures used by various namespaces. Then you instrument those functions while you are working in the REPL, doing day-to-day development.</p>\n<p>Another use of specs in development/testing is within the tests where we want to verify that results from functions are the expected “shape” in example-based tests. In this case we write specs for “good” results and “bad” results and we use <a href=\"https://github.com/clojure-expectations/clojure-test\">clojure-expectations/clojure-test</a> as an add-on for <code>clojure.test</code> so that we can <code>(expect ::some-spec (a-function call here))</code> – a more expressive form of <code>clojure.test/is</code>.</p>\n<p><strong>Deriving code from specs</strong></p>\n<p>In this case we write specs for data structures, such as rows in database tables, and then we generate named CRUD operations and supporting functionality from the specs themselves – using macros that take specs as input with some control parameters and expand into a number of <code>defn</code> and other forms. The important aspect of this is that the spec is the “system of record” for the data structure: it can be used for validation, test data generation, and as the source for the keys and “types” that shape the functions needed to operate on them.</p>",
   :direction "ltr"},
  :updated 1568372400000,
  :entities
  [{:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "Quora"}],
    :id "nlp/f/entity/wd:51711",
    :salienceLevel "mention",
    :label "Quora"}
   {:mentions [{:text "API"}],
    :id "nlp/f/entity/wd:165194",
    :salienceLevel "mention",
    :label "application programming interface"}
   {:mentions [{:text "Unicode"}],
    :id "nlp/f/entity/wd:8819",
    :salienceLevel "mention",
    :label "Unicode"}
   {:mentions [{:text "data structure"}],
    :id "nlp/f/entity/wd:175263",
    :salienceLevel "mention",
    :label "data structure"}],
  :alternate
  [{:href "http://corfield.org/blog/2019/09/13/using-spec/",
    :type "text/html"}],
  :title "How Do You Use clojure.spec",
  :author "Sean Corfield",
  :published-str "Fri Sep 13 04:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16d2c18c491:74521f8:69b9f616",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "http://corfield.org/blog/2019/09/13/using-spec",
  :commonTopics
  [{:score 50.08820685476211,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.952,
    :id "nlp/f/topic/334",
    :salienceLevel "about",
    :label "browsers"}
   {:score 0.916,
    :id "nlp/f/topic/1871",
    :salienceLevel "about",
    :label "quant"}],
  :published 1568372400000,
  :fingerprint "cabbef85",
  :canonicalUrl "http://corfield.org/blog/2019/09/13/using-spec"}
 {:engagement 5,
  :unread false,
  :crawled 1568400715455,
  :content
  {:content
   "<p>Each week, we answer a different question about Clojure and functional programming.</p>\n<p>If you have a question you’d like us to discuss, tweet <a href=\"https://twitter.com/clojuredesign\">@clojuredesign</a>, send an email to <a href=\"mailto:feedback@clojuredesign.club\">feedback@clojuredesign.club</a>, or join the <code>#clojuredesign-podcast</code> channel on the <a href=\"http://clojurians.net/\">Clojurians Slack</a>.</p>\n<p>This week, the question is: <strong>“When is Clojure not the right tool for the job?”</strong> We look at the varied forms that Clojure can assume and consider where it might not fit.</p>\n<p>Selected quotes:</p>\n<ul>\n<li>“Just reject all the jobs where Clojure is inappropriate and you’ll always be able to use Clojure.”</li>\n<li>“The JVM is like a super tanker. It will get a whole lot of work done. But it takes a little while to get going.”</li>\n<li>“On the language level, there are social aspects. Bringing in Clojure covertly will make the rest of the team angry.”</li>\n<li>“A lot of times, when talking about technical things, we tend to overlook the human effects.”</li>\n<li>“Two questions: Is the technology suitable? Are we going to get screwed if we go down this path?”</li>\n<li>“There is a conceptual leap into functional programming that is non-trivial.”</li>\n<li>“People will have a hard time letting go of their existing language until they can feel how Clojure is different.”</li>\n</ul>\n<p>Related episodes</p>\n<ul>\n<li><a href=\"https://clojuredesign.club/episode/038-how-do-i-convince-my-coworkers-to-use-clojure\">038: How do I convince my coworkers to use Clojure?</a></li>\n</ul>",
   :direction "ltr"},
  :updated 1568386800000,
  :entities
  [{:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "about",
    :label "Clojure"}
   {:mentions [{:text "functional programming"}],
    :id "nlp/f/entity/wd:193076",
    :salienceLevel "mention",
    :label "functional programming"}
   {:mentions [{:text "JVM"}],
    :id "nlp/f/entity/wd:193321",
    :salienceLevel "mention",
    :label "Java Virtual Machine"}],
  :alternate
  [{:href
    "https://clojuredesign.club/episode/046-when-is-clojure-not-the-right-tool-for-the-job/",
    :type "text/html"}],
  :title "Ep 046: When Is Clojure Not the Right Tool for the Job?",
  :author "Christoph Neumann and Nate Jones",
  :published-str "Fri Sep 13 08:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16d2bf7aebf:7424ef2:69b9f616",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://clojuredesign.club/episode/046-when-is-clojure-not-the-right-tool-for-the-job/",
  :commonTopics
  [{:score 48.89750528607062,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.983,
    :id "nlp/f/topic/501",
    :salienceLevel "about",
    :label "college"}
   {:score 0.974,
    :id "nlp/f/topic/349",
    :salienceLevel "about",
    :label "business"}
   {:score 0.893,
    :id "nlp/f/topic/861",
    :salienceLevel "about",
    :label "finance"}
   {:score 0.825,
    :id "nlp/f/topic/1695",
    :salienceLevel "mention",
    :label "parenting"}],
  :published 1568386800000,
  :fingerprint "b093b6e6",
  :canonicalUrl
  "https://clojuredesign.club/episode/046-when-is-clojure-not-the-right-tool-for-the-job/"}
 {:engagement 10,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1568312551720,
  :recrawled 1568314322574,
  :content
  {:content
   "<p>I announced the release of CIDER 0.22 (“São Paulo”) on the 1st of September at\n<a href=\"https://clojure-south.com/\">Clojure/south</a>, but it took me a while to get to writing a proper announcement.\nTime to change that now I guess.</p>\n<p>While CIDER 0.22 does ship some cool new features, the primary focus of the release are bug-fixes and small improvements.\nThe majority of those improvements happened “under the hood” - in the underlying libraries like <code>cider-nrepl</code> and <code>orchard</code>.\nLet’s take a closer look at some of them.</p>\n<h2>The Highlights</h2>\n<p>When it comes to new features, probably the highlights of the release are the improved ClojureScript code completion and the new “find references” functionality.\nBoth of them are considered experimental at this point and are certainly a bit rough around the edges.\nYou can read more about the enhanced ClojureScript code completion <a href=\"https://github.com/rksm/clj-suitable\">here</a>\nand about the “find references” feature <a href=\"http://metaredux.com/posts/2019/09/12/%%20post_url%202019-05-04-discovering-runtime-function-references-in-clojure%20%}\">here</a>.\nThe new code completion just works out of the box.\nYou can invoke “find references” using <code>C-c C-? (C)-r</code>. As a bonus you can check also the functions used in some definition\nwith <code>C-c C-? (C)-d</code>.</p>\n<p>Another important addition to CIDER 0.22 is <a href=\"https://clojuredocs.org\">ClojureDocs</a> support.\nThis replaces completely the Grimoire support that existed in previous versions of CIDER.\nI’m still wondering whether to completely fuse the regular docs with the extra documentation coming from ClojureDocs, but for now I opted to keep them mostly separate.\nDown the road this may change and the ClojureDocs info might end up in the standard documentation buffer.\nThe main entry point for the ClojureDocs functionality is <code>C-c C-d C-c</code>, which is meant to the used with the symbol under point.</p>\n<h2>Small Improvements</h2>\n<p>Probably my favourite small improvement is that now you can easily edit the jack-in command using a prefix argument - e.g. by typing <code>C-u C-C C-x j j</code>.\nThis is quite useful if you’d like to add on the fly some Leiningen profile, or something of that nature, before spinning up the nREPL server.</p>\n<p>People who are using CIDER without <code>cider-nrepl</code> will be happy to hear that now more features are working without it - namely things like definition and docs lookup.\nThere’s a lot more that can be done in this area, but I’m not certain whether I’m push hard in this direction, as this type of\nfunctionality can be simplified a lot if we made it possible to inject code into an nREPL server straight from the client. See <a href=\"https://github.com/nrepl/nrepl/pull/109\">this PR</a>\nfor details.</p>\n<p>Under the hood we did a lot of improvements to Orchard and its latest version 0.5 has improved support for Java 9+ and initial support for ClojureScript.\nCheck out its <a href=\"https://github.com/clojure-emacs/orchard/releases/tag/v0.5.0\">release notes</a> for all the details.</p>\n<h2>New Documentation Site</h2>\n<p>I feel I’ve spent way more time working on the new <a href=\"https://docs.cider.mx\">https://docs.cider.mx</a> than on CIDER itself.\nI already wrote an <a href=\"http://metaredux.com/posts/2019/05/29/cider-mx-reloaded.html\">article about it</a> a while back and I encourage everyone to check it out.\nSadly, my decision to go with the <code>.mx</code> domain backfired when it turned out the geo-targeting of the domain can’t be changed, so I might be have to revisit the domain name down the road.\nIt’s really disappointing for me that the new site is so much better than the old one and yet you’ll never see in the search results.<sup><a href=\"http://metaredux.com/posts/2019/09/12/cider-0-22.html#fn:1\">1</a></sup>\nSee <a href=\"https://github.com/clojure-emacs/cider/issues/2695\">this ticket</a> for details.<sup><a href=\"http://metaredux.com/posts/2019/09/12/cider-0-22.html#fn:2\">2</a></sup> On the bright side I might finally end up learning\nmore about SEO.</p>\n<p>As usual I’m encouraging all of you to check out docs and provide feedback about the structure and the content. If you feel extra adventurous\nyou can even help out with some improvements yourself!</p>\n<p>The next steps for the site would be to add there some documentation for <code>cider-nrepl</code> and <code>orchard</code>. I hope I’ll get to doing this\nby the end of the month.</p>\n<h2>CIDER Next</h2>\n<p>My plan for the next CIDER release is to continue with the small improvements and do a bit of cleanup/simplification here and there.\nI think that CIDER’s in a pretty good shape overall, so I’m even considering releasing CIDER 1.0 by the end of the year.\nI’ve already shared some of my short term plans for the future, as part of me taking part in the <a href=\"https://www.clojuriststogether.org/news/q3-2019-funding-announcement/\">current round of Clojurists Together</a>.</p>\n<p>The thing I’m excited about the most these days is collaborating with other tool authors on improving the foundations for Clojure development tools (a.k.a. CIDER’s Orchard).\nIt’s great to see how many tools are already relying on it and that other tool authors are interested in adopting our toolchain and contribute to it.\nSome really cool ideas have come out of this collaboration already, but I won’t go into any details right now.\nI do think, however, that it’s safe to say CIDER’s Orchard is moving in the right direction and the best is yet to come.</p>\n<h2>Epilogue</h2>\n<p>This release has been in the works for a very long time and I’m extremely happy that I finally managed to ship it.\nI had clearly underestimated how complex some of the internal changes in <code>cider-nrepl</code> and <code>orchard</code> would turn out to be\nand this was a very valuable lesson to me.</p>\n<p>I’ve also underestimated how many things can go wrong with one release - e.g. uploading artifact to Clojars got broken right around the time of the release, one of the Elisp deps was not\npublished on MELPA Stable and so on. And I had a conference talk to prepare for as well. And was jetlagged as hell. And the internet in my room was quite flaky. Fun times!</p>\n<p>Now it’s time to thank everyone who made this release possible by either working on it or supporting its development financially.\nI love you all and I truly appreciate your help and support! We wouldn’t have made it together all the way to São Paulo without you!\nSpecial thanks to Clojurist Together! This organization truly embodies the awesome spirit of the Clojure community!</p>\n<p>I’ll use this opportunity to mention that recently I got accepted in the GitHub Sponsors beta, so you’re welcome to <a href=\"https://github.com/users/bbatsov/sponsorship\">support my work there</a>.\nThe really cool thing about GitHub Sponsors is that they are vouching to match all donations up to $5000/year for the first year, so now you have the opportunity to double the impact of your money.</p>\n<p>Thanks for now, everyone! Enjoy CIDER 0.22 (ir)responsibly! I’m looking forward to hearing your feedback about it!</p>\n<div>\n<ol>\n<li>\n<p>Unless you live in Mexico, that is. <a href=\"http://metaredux.com/posts/2019/09/12/cider-0-22.html#fnref:1\">↩</a></p>\n</li>\n<li>\n<p>On the other hand - the legacy is doing pretty well in the search results. <a href=\"http://metaredux.com/posts/2019/09/12/cider-0-22.html#fnref:2\">↩</a></p>\n</li>\n</ol>\n</div>",
   :direction "ltr"},
  :updated 1568271900000,
  :entities
  [{:mentions [{:text "cider"}],
    :id "nlp/f/entity/wd:167296",
    :salienceLevel "about",
    :label "cider"}
   {:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "(C)"}],
    :id "nlp/f/entity/wd:11195",
    :salienceLevel "mention",
    :label "copyright symbol"}
   {:mentions [{:text "domain name"}],
    :id "nlp/f/entity/wd:32635",
    :salienceLevel "mention",
    :label "domain name"}
   {:mentions [{:text "Leiningen"}],
    :id "nlp/f/entity/wd:205362",
    :salienceLevel "mention",
    :label "Leiningen"}],
  :alternate
  [{:href "http://metaredux.com/posts/2019/09/12/cider-0-22.html",
    :type "text/html"}],
  :title "CIDER 0.22 (“São Paulo”)",
  :author "Bozhidar Batsov",
  :published-str "Thu Sep 12 00:05:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16d26b66928:6ce3a8b:69b9f616",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "http://metaredux.com/posts/2019/09/12/cider-0-22",
  :updateCount 1,
  :commonTopics
  [{:score 31.56121553966949,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1568271900000,
  :fingerprint "273859d",
  :canonicalUrl
  "http://metaredux.com/posts/2019/09/12/cider-0-22.html"}
 {:engagement 4,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1568301961741,
  :content
  {:content
   "edn is a powerful way to represent data, and you can make it even more powerful by extending it with your own custom reader tags.",
   :direction "ltr"},
  :updated 1568239200000,
  :alternate
  [{:href "https://sneakycode.net/custom-edn-readers-for-dummies/",
    :type "text/html"}],
  :title "Custom edn readers for dummies",
  :author "SneakyCode",
  :published-str "Wed Sep 11 15:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16d2614d20d:6f1832c:49b12733",
  :visual {:url "none"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://sneakycode.net/custom-edn-readers-for-dummies/",
  :published 1568239200000,
  :fingerprint "4b7f1311",
  :canonicalUrl
  "https://sneakycode.net/custom-edn-readers-for-dummies/"}
 {:engagement 5,
  :unread false,
  :crawled 1568270319789,
  :content
  {:content
   "<p>Are types compatible with data orientation? The short answer is ‘yes’. Types trade freedom of movement for clarity.</p>\n<p></p>\n<h2>Transcript</h2>\n<p>Eric Normand: Can you use types with data orientation? By the end of this episode, I hope to clarify this, because data orientation is often associated with un-typed languages like Clojure or JavaScript. My name is Eric Normand, and I help people thrive with functional programming.</p>\n<p>The example I gave in the last episode, which you should listen to if you haven’t, they’re all JSON, un-typed. I did mention that there was a change of types. We started with byte stream, we moved up to character string, and then we parsed that into JSON.</p>\n<p>After that, there was no change of types. This is very common in something like JavaScript, where you get some JSON. Once it gets parsed, you leave it as JSON. You’re just working in the JSON until you finally serialize it back out or something.</p>\n<p>The question comes up, can you use types with data orientation. I think the answer is yes. Short answer, yes, indeed you can.</p>\n<p>There is a tradeoff, and tradeoffs are rather nice. They are a decision you get to make. Let’s talk about that tradeoff.</p>\n<p>I like Clojure. I use that most of the time. In Clojure, which is un-typed, we use maps for a lot of things. Maps, we use all the basic data types, your numbers, your strings. We have things called vectors, sets. We use these to model our data.</p>\n<p>We typically don’t make new types. Sometimes, you do. Sometimes, you have to. Typically, we don’t.</p>\n<p>We got maps with some keys and values in them to represent, say, an entity like a person. We’re just using a map.</p>\n<p>Sometimes, you’re getting that map over the wire. It’s coming in as JSON or some other format. Then you parse it into a map or data. Once you got it as a map, that’s it.</p>\n<p>You’re leaving it as a map. You’re transforming it. You’re adding keys. You’re removing keys. You’re passing it around. You’re doing all sorts of stuff, but it stays as a map.</p>\n<p>Why do we do this? Before we get into the tradeoff, I think why we do it in Clojure — I’ve thought a lot about this — is that as a character string, as a string, before you parse it, it’s really hard to work with. Let’s say you had some JSON in a string. Instead of parsing it, you tried to figure out the person’s first name while it’s still a string.</p>\n<p>You basically would have to parse it somehow, but you need to walk the characters and figure out a little custom parser to find the string inside of it that represents the first name. It’s ridiculous. You do parse it into a map. In theory, it’s wasteful because you’re parsing everything, not just the first name.</p>\n<p>Once it’s a map, it’s so nice to work with. It’s so easy to do a bunch of things with it that weren’t possible with that string. Now, it almost feels like there’s no need to go any further. That’s my explanation for why we don’t make new types in Clojure. We’re satisfied with maps, vectors, strings, and stuff.</p>\n<p>It does let us do that thing that I talked about in the last episode, where you get to move up and down without even changing types. Once it’s a map — it’s a HTTP request, and now it’s a user setting, now it’s a set the password, all those things — we don’t even have to change the type.</p>\n<p>We’re looking at different pieces of data and making decisions about it. That’s our interpretation. That’s how we’re adding meaning to it, but that’s dangerous. I want to call that out. That is dangerous. That is one of the main messes that I see in Clojure code bases.</p>\n<p>Maybe it’s the number-one problem that you don’t know what level of meaning you’re operating at anymore. You can treat a set user password request as a map, meaning you can add keys to it. You can remove keys from it, random keys.</p>\n<p>You can iterate through the keys. You interpret this map as a collection of keys and values, and you give me all the keys from it. That’s another way of interpreting it.</p>\n<p>If it was a user request, that’s not really a valid operation on the user request — give me all the keys. No, that’s a valid operation way down like four levels down as a hash map.</p>\n<p>I see this happening a lot where people get into messes, because they’re playing so loose. They’re abusing their freedom, I guess I should say, of moving freely between the levels. Too much freedom. They probably don’t even realize they’re doing it, because the levels are not so clearly articulated.</p>\n<p>Types can provide a discipline for this at the extreme. If you wanted to be very type-safe, you would always change types when you’re changing levels. You go from bytes, to characters, to JSON, to maps, hash maps.</p>\n<p>If you want to pass through that, you probably have to if you’re paring JSON. You go through some kind of JSON representation. Then when you notice it’s an HTTP request, you convert that into a type called HTTP request.</p>\n<p>When you look at the path to route it, you convert that into a user update request. Then when you look at what parameters, what attributes it’s trying to change — it’s trying to change the password, boom — you turn that into a password update request. You would have a new type for every level there.</p>\n<p>Do Haskell programmers do this? Some do, some don’t. Maybe they’ll stop at HTTP request or maybe they stop one level more. They don’t actually do that final interpretation step to where they really look at what specifically is being changed.</p>\n<p>Maybe they don’t do that, or maybe they’re not aware that they’re doing it, but it’s not so dangerous to be able to move two levels. There is a tradeoff there. There’s a spectrum that you get to choose where you’re going to land on.</p>\n<p>Types provide that discipline, and they make it a little bit harder to move between the levels. They make it much easier to know what level you’re actually at right now. I have interpreted this HTTP request. I’m now at this other level.</p>\n<p>It’s not an HTTP request anymore. It is something else. It is this new type that has its own operations on it, that has its own interpretation.</p>\n<p>That’s what I have to work with. It might be hard to go back down. That might be OK. You might not need to go back down. That’s fine.</p>\n<p>You might not need us to step back and say, “I need to be able to turn this user settings change back into an HTTP request.” You might not need to do that.</p>\n<p>It could be lossy like, “I don’t care what port this request came in on anymore. I don’t care at this level of meaning.” I won’t be able to go back down, but that’s fine. I don’t want to go back down.</p>\n<p>Both of them have advantages. Both of them have disadvantages. Without types, you’ve got way more freedom, but sometimes that freedom is rope to hang yourself with. I’ve seen a lot of Clojure systems that get real messy because of this.</p>\n<p>They’re treating something that’s already been interpreted. It’s already at a new level of meaning. They jump back a couple levels and treat it like a hash map again. Now, they’re wondering, “Why am I confused about what this map is, what it has?”</p>\n<p>That is the issue that Clojure programmers have. I’m sure JavaScript programmers, again, do the same thing when they’re using JSON, when they’re doing this data orientation. Types can help you with that.</p>\n<p>At the expense of a little bit of freedom, a little bit of ease, you have to define these new types and all those things. A lot of times, that’s exactly what you need. It gives you some safety there.</p>\n<p>Like I said, the short answer is yes. Types are compatible with their data orientation, depending on the type system. In Haskell, the data is not hidden. It’s not buried somewhere. Usually, you define a new data type, and it has certain fields in it. Those fields can be read by anything.</p>\n<p>You’re not hiding the data. There’s no encapsulation with the protocol that you have to call to have a predetermined interpreter. You can still take this HTTP request and interpret it in multiple ways. You can route it. What kind of request is this? What is the intent of this request?</p>\n<p>You can also log it and say, “What IP address is contacting me? What time is it?” All those things that you might want to do in an HTTP server, you can still do with that one piece of data interpreted in multiple ways.</p>\n<p>In Clojure, we use maps a lot. They really are flexible, let you move up and down, but you might shoot yourself in the foot with them. Types don’t let you move up and down so easily, but they give you a lot of safety. They make sure you know what level of meaning you are operating at.</p>\n<p>The more you use those types, the more freedom you give up but the more safety you get. If you know exactly what levels you need, why not have some help from the compiler? That’s what I’d say.</p>\n<p>This might be the last data orientation episode I do for a while. I’ve done two more. If you want to find those and all the other past episodes, you can go to lispcast.com/podcast. There, you’ll find audio, video, and text transcripts of all the prior episodes.</p>\n<p>You’ll also find links to subscribe — however you want to subscribe — and on social media. If you want to get in touch with me, if you have questions about this, disagreements — I love discussions. I love understanding how well I’m communicating these ideas.</p>\n<p>That’s all I have for this episode. This has been my thought on functional programming. I’m Eric Normand. Thanks for listening and rock on.</p>\n<p>The post <a rel=\"nofollow\" href=\"https://lispcast.com/can-you-use-types-with-data-orientation/\">Can you use types with Data Orientation?</a> appeared first on <a rel=\"nofollow\" href=\"https://lispcast.com\">LispCast</a>.</p>",
   :direction "ltr"},
  :updated 1568268000000,
  :entities
  [{:mentions [{:text "HTTP server"}],
    :id "nlp/f/entity/wd:11288",
    :salienceLevel "mention",
    :label "web server"}
   {:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "JSON"}],
    :id "nlp/f/entity/wd:2063",
    :salienceLevel "mention",
    :label "JavaScript Object Notation"}
   {:mentions [{:text "JavaScript"}],
    :id "nlp/f/entity/wd:2005",
    :salienceLevel "mention",
    :label "JavaScript"}
   {:mentions [{:text "type"} {:text "data type"}],
    :id "nlp/f/entity/wd:190087",
    :salienceLevel "mention",
    :label "data type"}],
  :alternate
  [{:href
    "https://lispcast.com/can-you-use-types-with-data-orientation/",
    :type "text/html"}],
  :title "Can you use types with Data Orientation?",
  :author "Eric Normand",
  :published-str "Wed Sep 11 23:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16d243200ad:691ad09:69b9f616",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url
   "https://lispcast.com/wp-content/uploads/2019/09/Can-you-use-types-with-Data-Orientation_.jpg",
   :width 1280,
   :height 720,
   :contentType "image/jpeg"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://lispcast.com/?p=2012",
  :commonTopics
  [{:score 61.51041078399338,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.997,
    :id "nlp/f/topic/971",
    :salienceLevel "about",
    :label "gis"}
   {:score 0.728,
    :id "nlp/f/topic/253",
    :salienceLevel "mention",
    :label "big data"}],
  :published 1568268000000,
  :fingerprint "2f9ffa0b",
  :canonicalUrl
  "https://lispcast.com/can-you-use-types-with-data-orientation/"}
 {:engagement 6,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1568244693947,
  :content
  {:content
   "A mistake that shows up at least once in almost every class I teach. The Clojure reader macro #() creates an anonymous function whose body is a single expression, and that expression must be a list. For example, someone wants to wrap some values in vectors. They’ve just learned about anonymous functions, and they write:… <p><a href=\"https://stuartsierra.com/2019/09/11/clojure-donts-short-fn-syntax\">Read the full article</a></p><img alt=\"\" width=\"1\" src=\"http://feeds.feedburner.com/~r/StuartSierra/~4/n4eg90Jz1I0\" height=\"1\">",
   :direction "ltr"},
  :updated 1568241904000,
  :entities
  [{:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "about",
    :label "Clojure"}
   {:mentions [{:text "anonymous function"}],
    :id "nlp/f/entity/wd:567612",
    :salienceLevel "about",
    :label "anonymous function"}],
  :alternate
  [{:href
    "http://feedproxy.google.com/~r/StuartSierra/~3/n4eg90Jz1I0/clojure-donts-short-fn-syntax",
    :type "text/html"}],
  :title "Clojure Don’ts: Short Fn Syntax",
  :author "Stuart",
  :published-str "Wed Sep 11 15:45:04 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16d22aafbbb:6aa6cf1:97b0c8f7",
  :visual {:url "none"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://stuartsierra.com/?p=1183",
  :commonTopics
  [{:score 50.485535731388026,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1568241904000,
  :fingerprint "333a77bb",
  :canonicalUrl
  "http://feedproxy.google.com/~r/StuartSierra/~3/n4eg90Jz1I0/clojure-donts-short-fn-syntax"}
 {:engagement 5,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/todo",
    :label "todo"}
   {:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1568031898781,
  :recrawled 1568042495319,
  :content
  {:content
   "Working with Firebase Documents in ClojureScript — Martin Klepsch<div><div><article><div><a href=\"https://www.martinklepsch.org/posts/using-cljs-bean-to-wrap-firebase-documents.html\" title=\"Permalink: Working with Firebase Documents in ClojureScript\">September 2019</a><span>/</span><a href=\"https://www.martinklepsch.org/\" title=\"Home\">Home</a><span>/</span><a href=\"https://twitter.com/martinklepsch\" title=\"@martinklepsch on Twitter\">@martinklepsch</a></div><h1>Working with Firebase Documents in ClojureScript</h1><section><p>In a project <a href=\"https://icebreaker.video\">I’m currently working on</a> we’re making use of Google's <a href=\"https://firebase.google.com\">Firebase</a> to store domain data and run cloud functions.</p>\n<p>In Firestore, which is Firebase’s database offering, every document is essentially a Javascript object. While interop in ClojureScript is pretty good we ended up converting the raw data of these documents to ClojureScript data structures using <code>js->clj</code>. This also meant we’d need to convert them back to JS objects before writing them to Firestore.</p>\n<p>Because IDs are technically not part of the document the project adopted a pattern of representing documents as tuples:</p>\n<pre><code>[id (js->clj firestore-data)]\n</code></pre>\n<p>This works but isn’t particularly extensible. What if we also wanted to retain the “Firestore Reference” specifying a documents location inside the database? (Firestore stores data in a tree-like structure.)</p>\n<p>It also leads to some funky gymnastics when working with collections of documents:</p>\n<pre><code>(sort-by (comp :join_dt second) list-of-document-tuples)\n</code></pre>\n<p>Could be worse... but also could be better.</p>\n<p>This blogpost will compare various approaches approach to address the problems above using <a href=\"https://github.com/mfikes/cljs-bean\">cljs-bean</a>, basic ClojureScript data structures, custom protocols and <code>:extend-via-metadata</code>.</p>\n<h2><a href=\"https://www.martinklepsch.org/posts/using-cljs-bean-to-wrap-firebase-documents.html#cljs-bean\"></a>cljs-bean</h2>\n<p>With the recent release of <a href=\"https://github.com/mfikes/cljs-bean\">cljs-bean</a> we have an interesting alternative to <code>js->clj</code>. Instead of eagerly walking the structure and converting all values to their ClojureScript counterparts (i.e. persistent data structures) the original object is wrapped in a thin layer that allows us to use it as if it were a ClojureScript-native data structure:</p>\n<pre><code>(require '[cljs-bean.core :as cljs-bean])\n\n(-> (cljs-bean/bean #js {&quot;some_data&quot; 1, :b 2})\n    (get :some_data)) ; => 1\n</code></pre>\n<p>Given a Firestore <a href=\"https://firebase.google.com/docs/reference/js/firebase.firestore.QueryDocumentSnapshot\">QueryDocumentSnapshot</a> we can make the JS object representing the data easily accessible from ClojureScript:</p>\n<pre><code>(-> (cljs-bean/->clj (.data query-document-snapshot))\n    (get :some_field))\n\n;; (cljs-bean/->clj data) is roughly the same as\n;; (cljs-bean/bean data :recursive true)\n</code></pre>\n<p>The bean is immutable and can be used in client side app-state as if it is one of ClojureScript’s persistent data structures.</p>\n<p><strong>Caveat:</strong> Updating a bean using <code>assoc</code> or similar will create a copy of the object (Copy-on-Write). This is less performant and more GC intensive than with persistent data structures. Given that the data is usually quite small and that the document representations in our app state mostly aren’t written to directly this is probably ok (<a href=\"https://github.com/mfikes/cljs-bean/issues/72\">cljs-bean #72</a>).</p>\n<p>Whenever we want to use the raw object to update data in Firestore we can simply call <code>->js</code> on the bean. Conveniently this will fall back to <code>clj->js</code> when called on ClojureScript data structures.</p>\n<pre><code>(.set some-ref (cljs-bean/->js our-bean))\n</code></pre>\n<p>Arguably the differences to using plain <code>clj->js</code> aren’t monumental but working with a database representing data as JS objects it is nice to retain those original objects.</p>\n<h2><a href=\"https://www.martinklepsch.org/posts/using-cljs-bean-to-wrap-firebase-documents.html#integrating-firestore-metadata\"></a>Integrating Firestore Metadata</h2>\n<p>Now we got beans. But they still don’t contain the document ID or reference. In most places we don’t care about a documents ID or reference. So how could we enable the code below while retaining ID and reference?</p>\n<pre><code>(sort-by :join_dt participants)\n</code></pre>\n<p>Let’s compare the various options we have.</p>\n<h3><a href=\"https://www.martinklepsch.org/posts/using-cljs-bean-to-wrap-firebase-documents.html#tuples-and-nesting\"></a>Tuples and Nesting</h3>\n<p>I already described the tuple-based approach above. Another, similar, approach achieves the same by nesting the data in another map. Both fall short on the requirement to make document fields directly accessible.</p>\n<pre><code>;; structure\n{:id &quot;some-id&quot;, :ref &quot;/events/some-id&quot;, :data document-data}\n;; usage (including gymnastics)\n(sort-by (comp :join_dt :data) participants)\n</code></pre>\n<p>I’m not too fond of either approach since they both expose a specific implementation detail, that the actual document data is nested, at the call site. In a way my critique of this approach is similar to why <a href=\"https://youtu.be/Sjb6y19YIWg\">Eric Normand advocated for getters in his IN/Clojure ’19 talk</a> — as far as I understand anyways.</p>\n<h3><a href=\"https://www.martinklepsch.org/posts/using-cljs-bean-to-wrap-firebase-documents.html#addition-of-a-special-key\"></a>Addition of a Special Key</h3>\n<p>Another approach could be to add metadata directly to the document data.</p>\n<pre><code>(defn doc [query-doc-snapshot]\n  (-> (cljs-bean/->clj (.data query-doc-snapshot))\n      (assoc ::meta {:id (.-id query-doc-snapshot\n                     :ref (.-ref query-doc-snapshot})))\n</code></pre>\n<p>This is reasonable and makes document fields directly accessible. However it also requires us to separate document fields and metadata before passing the data to any function writing to Firestore.</p>\n<pre><code>;; before writing we need to remove ::meta\n(.set some-ref (cljs-bean/->js (dissoc document-data ::meta))\n</code></pre>\n<p>I think this is a reasonable solution that improves upon some of the issues with the tuple and nesting approach. I realize that this isn’t a huge change but this inversion of how things are nested does give us that direct field access that the nesting approach did not.</p>\n<h3><a href=\"https://www.martinklepsch.org/posts/using-cljs-bean-to-wrap-firebase-documents.html#protocols-and-\"></a>Protocols and <code>:extend-via-metadata</code></h3>\n<p>An approach I’ve found particularly interesting to play with makes use of a protocol that can be implemented via metadata, as enabled by the new <code>:extend-via-metadata</code> option. This capability was added in <a href=\"https://clojure.org/reference/protocols#_extend_via_metadata\">Clojure 1.10</a> and subsequently added to ClojureScript with the <a href=\"https://clojurescript.org/news/2019-01-31-release\">1.10.516 release</a>:</p>\n<pre><code>(defprotocol IFirestoreDocument\n  :extend-via-metadata true\n  (id [_] &quot;Return the ID (string) of this document&quot;)\n  (ref [_] &quot;Return the Firestore Reference object&quot;))\n\n(defn doc [query-doc-snapshot]\n  (with-meta\n    (cljs-bean/->clj (.data query-doc-snapshot))\n    {`id (fn [_] (.-id query-doc-snapshot))\n     `ref (fn [_] (.-ref query-doc-snapshot))}))\n</code></pre>\n<p>Using <code>with-meta</code> we extend a specific instance of a bean to implement the <code>IFirestoreDocument</code> protocol. This allows direct access to document properties while retaining important metadata:</p>\n<pre><code>(:name participant) ; => &quot;Martin&quot;\n(firebase/id participant) ; => &quot;some-firebase-id&quot;\n</code></pre>\n<p>At call sites we use a well-defined API (defined by the protocol) instead of reaching into nested maps whose structure may need to change as our program evolves. This arguably could also be achieved with plain functions.</p>\n<p><strong>Sidenote:</strong> A previous iteration of this used <code>specify!</code>. Specify modifies the bean instance however, meaning that whenever we’d update a bean the protocol implementation got lost. In contrast metadata is carried over across updates.</p>\n<h2><a href=\"https://www.martinklepsch.org/posts/using-cljs-bean-to-wrap-firebase-documents.html#summary\"></a>Summary</h2>\n<p>Using <a href=\"https://github.com/mfikes/cljs-bean\">cljs-bean</a> we’ve enabled idiomatic property access for JS data structures without walking the entire document and converting it to a persistent data structure. We also retain the original Javascript object making it easy to use for Firestore API calls.</p>\n<p>We’ve compared different ways of attaching additional metadata to those documents using compound structures as well as the new and shiny <code>:extend-via-metadata</code>. Using it we’ve extended instances of beans to support a custom protocol allowing open ended extension without hindering the ergonomics of direct property access.</p>\n<p>While I really enjoyed figuring out how to extend beans using <code>:extend-via-metadata</code> it turned out that any approach storing data in “unusual places” (i.e. metadata) causes notable complexity when also wanting to serialize the data.</p>\n<p>Serializing metadata is something that <a href=\"https://gist.github.com/mfikes/3a160a1504debd31e5771736256ca022\">has been added to Transit quite some time ago</a> but compared to the plug and play serialization we get when working with plain maps it did not seem worth it. Even if set up properly the protocol implementations, which are functions, are impossible to serialize.</p>\n<p>Ultimately we ended up with plain beans and storing metadata under a well known key that is removed before writing the data to Firestore again:</p>\n<pre><code>(defn doc [query-doc-snapshot]\n  (-> (cljs-bean/->clj (.data query-doc-snapshot))\n      (assoc ::meta {:id (.-id query-doc-snapshot)\n                     :ref (.-ref query-doc-snapshot)})))\n\n(defn id [doc]\n  (-> doc ::meta :id))\n\n(defn ref [doc]\n  (-> doc ::meta :ref))\n\n(defn data [doc]\n  (cljs-bean/->js (dissoc doc ::meta)))\n</code></pre>\n<p>If you're using Firebase or comparable systems, I'd be curious to <a href=\"https://clojureverse.org/t/working-with-firebase-documents-in-clojurescript/4813\">hear if you do something similar on ClojureVerse</a>.</p>\n<p><em>Thanks to Matt Huebert and Mike Fikes for their feedback &amp; ideas.</em></p>\n</section><div><a href=\"https://twitter.com/martinklepsch\">@martinklepsch</a>, September 2019</div></article></div></div>",
   :direction "ltr"},
  :updated 1567987200000,
  :entities
  [{:mentions [{:text "Firebase"}],
    :id "nlp/f/entity/wd:18150728",
    :salienceLevel "about",
    :label "Firebase"}
   {:mentions [{:text "persistent data structure"}],
    :id "nlp/f/entity/wd:2427787",
    :salienceLevel "mention",
    :label "persistent data structure"}
   {:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "client-side"}],
    :id "nlp/f/entity/wd:528166",
    :salienceLevel "mention",
    :label "client"}
   {:mentions [{:text "Google"}],
    :id "nlp/f/entity/wd:95",
    :salienceLevel "mention",
    :label "Google"}],
  :alternate
  [{:href
    "https://www.martinklepsch.org/posts/using-cljs-bean-to-wrap-firebase-documents.html",
    :type "text/html"}],
  :title "Working with Firebase Documents in ClojureScript",
  :author "Martin Klepsch",
  :published-str "Sun Sep 08 17:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16d15fbfc9d:587c9ea:49b12733",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "urn:uuid:3e616db0-a417-4bc4-93d0-b2a24256ab86",
  :updateCount 2,
  :commonTopics
  [{:score 35.68823687437572,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1567987200000,
  :fingerprint "59c6336f",
  :canonicalUrl
  "https://www.martinklepsch.org/posts/using-cljs-bean-to-wrap-firebase-documents.html"}
 {:engagement 10,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1568025718405,
  :content
  {:content
   "<div>\n<p><em>Issue 343 – September 09, 2019 · <a href=\"https://purelyfunctional.tv/newsletter-archives/\">Archives</a> · <a title=\"Thanks, Jeff!\" href=\"https://purelyfunctional.tv/newsletter/\">Subscribe</a></em></p>\n<h2>Clojure Tip 💡</h2>\n<p><em>read the exception message</em></p>\n<p>Amid all of the complaints about the length of Clojure stacktraces, there is a dirty secret: many people don’t read the error message and try to understand it.</p>\n<p>Yes, I know that <em>you</em> do. But people ask me a lot of questions, and too often the answer is right there in the exception message, including the line number. Just to be clear, I’m happy to receive the question and take the time to answer it. However, I hope I can make people a little more self-sufficient by developing a habit of reading the exception message.</p>\n<p>Clojure’s default configuration for a while has been to not print the stacktrace at the repl when there’s an error. It only prints the exception message, file name, and line number. It used to print the whole stacktrace, but that was a while ago. And recent versions have only gotten better about being useful. Here’s an error message from Clojure 1.10.1:</p>\n<p><img title=\"\" src=\"https://purelyfunctional.tv/wp-content/uploads/2019/09/Clojure-1.10.1-error-message.png\"></p>\n<p>If you do get a stacktrace in your console, due to configuration or tooling, all is not lost. Scroll back in the output, looking for the exception message. The message is in there. It’s not very ergonomic to have to scroll and visually scan through 60-100 lines of stacktrace, but it’s worth it. The exception message is the most information-packed part of the output, and the top of the stack (the next lines of output in the stacktrace) are more likely to show the source of the error than the last lines. There are important exceptions, but starting at the top is the rule of thumb.</p>\n<p>Stacktrace frames are printed indented. So look for unindented lines that are flush-left. These are probably your exception messages.</p>\n<p><img title=\"\" src=\"https://purelyfunctional.tv/wp-content/uploads/2019/09/flush-left-exception-message.png\"></p>\n<p>The filename and line number are very informative. They pinpoint the problem. But the message is not, and neither are the stack frames. When this is the case, it makes sense to look for a causing exception. JVM exceptions can have a chain of causes. Code can catch an exception, wrap it in a new one, then throw the new one. The old one is still there, and it will be printed out, too.</p>\n<p>I scrolled down and found this:</p>\n<p><img title=\"\" src=\"https://purelyfunctional.tv/wp-content/uploads/2019/09/caused-by-exception.png\"></p>\n<p>That one does give a better message. I believe the repl’s error printer uses both of these exceptions to form a nice message. It’s just not always available.</p>\n<h2>Book sale 📖</h2>\n<p>I was just informed that Manning is having a sale today (Monday). <em>All</em> MEAP ebooks are $20 and all MEAP print books are $25. That’s essentially 50% off of my book. It’s a great time to pick it up, and any other MEAPs that catch your fancy.</p>\n<p>You can find my book, <em>Grokking Simplicity</em>, <a title href=\"https://lispcast.com/gs\">here</a>.</p>\n<h2>Currently recording 🎥</h2>\n<p>I did not publish any new lessons in the <a title href=\"https://purelyfunctional.tv/courses/property-based-testing-with-test-check/\">Property-based Testing course</a>. I blame the difficulty of testing distributed systems.</p>\n<p>I’ve been working on a lesson that teaches how to test distributed systems. It’s tough, but PBT at least has an answer. Trying to make that answer accessible is what takes a long time.</p>\n<p>So allow me a question: does this topic interest you? I haven’t had nearly as many sales as I thought for this course, so I’m wondering if I should cut bait now and move onto a topic that you are more interested in. Please reply if you’re into it, or even if you’re not. My main goal is to help you and the rest of the community. If I’m not doing that, I need to move on.</p>\n<h2>Brain skill 😎</h2>\n<p><em>find something challenging</em></p>\n<p>When you’re learning something new, one of the main obstacles is a lack of motivation. You might intellectually know you should learn a topic, but that doesn’t mean your brain will start to absorb it.</p>\n<p>One trick to encourage your brain to learn is to challenge it. Challenge is a positive emotion, and positive emotions are sought after by your neurons. Challenge doesn’t just mean “hard”. It means you feel compelled to do it because it is hard. You’re looking for something difficult that gets your juices flowing.</p>\n<p>The challenge you choose could be anything, so pick something closely related to your goals. It could be a big project, or an artificial deadline, or some arbitrarily motivating target. For instance, you could try to program an entire web app without any mutation. What’s important is that you rally your resources when you think about it.</p>\n<h2>Clojure Challenge 🤔</h2>\n<h3>Last week’s challenge</h3>\n<p>The challenge in <a title href=\"https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-342-tip-learn-to-read-javadocs/\">Issue 342</a> was to model ajax state.</p>\n<p>You can check out the submissions <a title href=\"https://gist.github.com/ericnormand/9a1fa763a44c4f1b957abd058ecf20ac\">here</a>.</p>\n<p>Well, as I write this there are no submissions. I did put one together.</p>\n<h3>This week’s challenge</h3>\n<p><em>make an action idempotent</em></p>\n<p>Clojure.core has a function called <code>memoize</code>. You probably already know what it does, but just to be on the same page, <code>memoize</code> takes a function and returns a new function. The new function is just like the argument you pass it, but it has a superpower. It’s now cached. It will remember any arguments you pass it, and the return value it found, and give it to you without doing all the work. Of course, it has to do the work the first time, but after that, it’s all cached.</p>\n<p>You can do this same thing, but instead of giving a function a superpower of being cached, you can make it idempotent. Let’s say I had a function that connected to an SMTP server to send an email. I don’t want to send the email twice, but I want to be able to retry in case it didn’t succeed. So I make the action idempotent so the duplicates don’t matter. And what does it mean to be the “same email”? There needs to be a notion of identity.</p>\n<p>Write a function called <code>idempotent-by</code> that takes a function and returns a new function that is like the original except calling it twice on the same thing does the action only once. The first argument to <code>idempotent-by</code>, before the function in question, should be another function that defines the key. Just like <code>group-by</code> takes a keyfn, <code>idempotent-by</code> takes a keyfn.</p>\n<pre><code>(defn idempotent-by [keyfn f]\n\n  )\n</code></pre>\n<p>As usual, please send me your implementations. I’ll share them all in next week’s issue. If you send me one, but you don’t want me to share it publicly, please let me know.</p>\n<p>Rock on!<br>Eric Normand</p>\n</div>\n<p>The post <a rel=\"nofollow\" href=\"https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-343-tip-read-the-exception-message/\">PurelyFunctional.tv Newsletter 343: Tip: read the exception message</a> appeared first on <a rel=\"nofollow\" href=\"https://purelyfunctional.tv\">PurelyFunctional.tv</a>.</p>",
   :direction "ltr"},
  :updated 1568023200000,
  :entities
  [{:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "about",
    :label "Clojure"}
   {:mentions [{:text "error message"}],
    :id "nlp/f/entity/wd:1332193",
    :salienceLevel "mention",
    :label "error message"}
   {:mentions [{:text "rule of thumb"}],
    :id "nlp/f/entity/wd:1398821",
    :salienceLevel "mention",
    :label "rule of thumb"}
   {:mentions [{:text "JVM"}],
    :id "nlp/f/entity/wd:193321",
    :salienceLevel "mention",
    :label "Java Virtual Machine"}
   {:mentions [{:text "web app"}],
    :id "nlp/f/entity/wd:189210",
    :salienceLevel "mention",
    :label "web application"}],
  :alternate
  [{:href
    "https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-343-tip-read-the-exception-message/",
    :type "text/html"}],
  :title
  "PurelyFunctional.tv Newsletter 343: Tip: read the exception message",
  :author "Eric Normand",
  :published-str "Mon Sep 09 03:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16d159dae85:57e9a0e:49b12733",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url
   "https://purelyfunctional.tv/wp-content/uploads/2019/09/Clojure-1.10.1-error-message.png",
   :width 593,
   :height 193,
   :contentType "image/png"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://purelyfunctional.tv/?p=31998",
  :commonTopics
  [{:score 0.894,
    :id "nlp/f/topic/294",
    :salienceLevel "about",
    :label "bodybuilding"}
   {:score 0.892,
    :id "nlp/f/topic/575",
    :salienceLevel "about",
    :label "crm"}
   {:score 0.865,
    :id "nlp/f/topic/874",
    :salienceLevel "about",
    :label "fitness"}
   {:score 0.783,
    :id "nlp/f/topic/2148",
    :salienceLevel "mention",
    :label "spiritual"}],
  :published 1568023200000,
  :fingerprint "b454c498",
  :canonicalUrl
  "https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-343-tip-read-the-exception-message/"}
 {:engagement 14,
  :unread false,
  :crawled 1568010531250,
  :content
  {:content
   "<p>Data orientation allows freedom of movement between layers of meaning. Each interpretation adds a layer of meaning. If the data were hidden, we would not be able to freely interpret it how we want. In this episode, we explore an example of what it means to move up and down the layers of meaning.</p>\n<p></p>\n<h2>Transcript</h2>\n<p>Eric Normand: What is the benefit of data orientation? In the last episode, I went over what data orientation is. Now, we’re going to be talking about its benefits.</p>\n<p>By the end of this episode, I think you should have a really good idea of why data orientation is useful as a programming paradigm, programming style process. I don’t know what it is. My name is Eric Normand, and I help people thrive with functional programming.</p>\n<p>Data orientation — just a quick recap — means programming with data. I’m going to amend it a little bit, and I am going to say at all levels.</p>\n<p>I’m going to cut to the chase. The benefit is freedom. It’s freedom to work at the level you want to work at, the level of meaning.</p>\n<p>What do I mean by level of meaning? Let’s imagine we have some JSON. It’s a map. It’s got some string keys and some string values. Some of the values are maps as well. There’s arrays in there with some numbers. It’s a JSON.</p>\n<p>Now, let’s go down a layer of meaning. Down like, let’s un-interpret this. We’re going down a layer of meaning.</p>\n<p>At a lower level, this is just characters. We took some characters, and we parsed them into JSON.</p>\n<p>JSON is really like a syntax for how you represent maps, arrays, and strings, etc. It’s a syntax. It’s really characters one level down. Characters, if you go down another level, are a sequence of bytes.</p>\n<p>That those bytes require interpretation to turn them into characters. Then the characters require interpretation to turn them into JSON. These are the levels I’m talking about, the levels of meaning.</p>\n<p>We’re back at JSON. If we interpret again, we go up another level. We look into the JSON. We see it has information that makes it pretty clear that this is an HTTP request.</p>\n<p>It has a URI. It has a server, host. It’s got a request method, stuff like that. It’s an HTTP request.</p>\n<p>Let’s take this HTTP request. It’s still JSON. Let’s take this HTTP request, and let’s interpret it. Go up a level.</p>\n<p>The way you usually do when you interpret an HTTP request, one thing you can do is you can route. You can look at the path and figure out like, “What is this HTTP request supposed to do?”</p>\n<p>We see that it is an update to the user settings. The users have settings in our system, and this is a post to /user/settings. We can interpret this and say, “Wow, this is a request to update the user settings.”</p>\n<p>Now, if we look, if we interpret it again, we’re going up another level of meaning. We’re going to see that you look in the body, and it’s a set password. This is trying to change the password of this user. Let’s stop there.</p>\n<p>We got all these levels. I’m going to count them. One, two, three, four, five, six. We’ve got over six layers of meaning here.</p>\n<p>This is the benefit of data orientation that you can move freely. You have the freedom to move up and down the layers.</p>\n<p>I’m interpreting. I’m going, again, adding meaning. I’m adding meaning. I’m adding meaning. Then I can go back down.</p>\n<p>Even if I’m at the highest level we got to, which is, “This is a request to set the user’s password,” I could still take that and go back down to bytes. I could take it and serialize it over the network. This is a freedom that we have.</p>\n<p>If you were hiding the data, you wouldn’t have that freedom. You don’t know how to go. You’d have to invent in the whole API to move along these levels, these layers of meaning. This is the benefit — the freedom of moving up and down. This is going to be a quick episode.</p>\n<p>Let me recap. Data orientation means programming with data at all levels of meaning. The benefit is freedom, because you’re working with data at all levels — moving up and down, interpreting, even going down as a kind of interpretation.</p>\n<p>If you say, “I’ve got this update user settings request,” now let me treat it again like an HTTP request and get this header out of it. Or let me treat it, again, like JSON and I’m going to just get the keys from it, which is something you can do with JSON, with a map. You can get the keys.</p>\n<p>I want to note also that some of these interpretation levels had a change of type. When we went from byte stream or byte array to string or character array, that was a change of type. Then when we went from characters, we parsed those, and we turned it into JSON. That was a change of type.</p>\n<p>Then some didn’t have a change of type. When we went from JSON to HTTP request, it was still JSON. We didn’t put in a new type. It’s the same type.</p>\n<p>We didn’t change it. Now, we’re going to get to the details of this in the next episode, but just note that.</p>\n<p>Let’s recap. We had six levels of meaning there, and we were able to move up and down between them. At any point, we can treat it like JSON and serialize it to a string.</p>\n<p>Then take that string, send it over the network. It’s going to get turned into bytes, into packets. There’s another kind of interpretation you’ve got there.</p>\n<p>In the next episode, we’re still talking about data orientation, but I really want to answer this question of types and whether you can use types with data orientation.</p>\n<p>If you like this episode, you should subscribe. You should go to lispcast.com/podcast. You will find links to subscribe, also to get in touch with me on social media. You’ll also find all of the past episodes, including audio, video, and text transcripts of all of them.</p>\n<p>You can subscribe however you want. If you want the videos, you can subscribe on YouTube. If you want the audio, you can subscribe in iTunes or whatever podcast player you use. Or you can get the RSS for the text if you like it that way.</p>\n<p>This has been my thought on functional programming. I’m Eric Normand. Thanks for listening and rock on.</p>\n<p>The post <a rel=\"nofollow\" href=\"https://lispcast.com/what-is-the-benefit-of-data-orientation/\">What is the benefit of data orientation?</a> appeared first on <a rel=\"nofollow\" href=\"https://lispcast.com\">LispCast</a>.</p>",
   :direction "ltr"},
  :updated 1568008800000,
  :entities
  [{:mentions [{:text "JSON"}],
    :id "nlp/f/entity/wd:2063",
    :salienceLevel "about",
    :label "JavaScript Object Notation"}
   {:mentions [{:text "functional programming"}],
    :id "nlp/f/entity/wd:193076",
    :salienceLevel "mention",
    :label "functional programming"}
   {:mentions [{:text "freedom of movement"}],
    :id "nlp/f/entity/wd:1344824",
    :salienceLevel "mention",
    :label "freedom of movement"}
   {:mentions [{:text "programming style"}],
    :id "nlp/f/entity/wd:962139",
    :salienceLevel "mention",
    :label "programming style"}
   {:mentions [{:text "programming paradigm"}],
    :id "nlp/f/entity/wd:188267",
    :salienceLevel "mention",
    :label "programming paradigm"}],
  :alternate
  [{:href
    "https://lispcast.com/what-is-the-benefit-of-data-orientation/",
    :type "text/html"}],
  :title "What is the benefit of data orientation?",
  :author "Eric Normand",
  :published-str "Sun Sep 08 23:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16d14b5f1b2:56a03ae:49b12733",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url
   "https://lispcast.com/wp-content/uploads/2019/09/What-is-the-benefit-of-data-orientation_.jpg",
   :width 1280,
   :height 720,
   :contentType "image/jpeg"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://lispcast.com/?p=2010",
  :commonTopics
  [{:score 35.95053334550736,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1568008800000,
  :fingerprint "c4abe21d",
  :canonicalUrl
  "https://lispcast.com/what-is-the-benefit-of-data-orientation/"}
 {:engagement 5,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1567804278773,
  :content
  {:content
   "<p>Each week, we answer a different question about Clojure and functional programming.</p>\n<p>If you have a question you’d like us to discuss, tweet <a href=\"https://twitter.com/clojuredesign\">@clojuredesign</a>, send an email to <a href=\"mailto:feedback@clojuredesign.club\">feedback@clojuredesign.club</a>, or join the <code>#clojuredesign-podcast</code> channel on the <a href=\"http://clojurians.net/\">Clojurians Slack</a>.</p>\n<p>This week, the question is: <strong>“Why have derived fields in data when I can just calculate derived data as needed with a function?”</strong> We take a focused look at the balance of using functions or derived fields and where each is preferable.</p>\n<p>Selected quotes:</p>\n<ul>\n<li>“Clojure has a gravity toward using the built-in data structures.”</li>\n<li>“Immutability helps you handle concurrent updates to dependent fields without using locks.”</li>\n<li>“If you add derived fields, you can query the data using information at different levels of abstraction.”</li>\n</ul>",
   :direction "ltr"},
  :updated 1567782000000,
  :entities
  [{:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "about",
    :label "Clojure"}
   {:mentions [{:text "functional programming"}],
    :id "nlp/f/entity/wd:193076",
    :salienceLevel "about",
    :label "functional programming"}],
  :alternate
  [{:href
    "https://clojuredesign.club/episode/045-why-have-derived-fields-in-data-when-i-can-just-calculate-derived-data-as-needed-with-a-function/",
    :type "text/html"}],
  :title
  "Ep 045: Why Have Derived Fields in Data When I Can Just Calculate Derived Data as Needed With a Function?",
  :author "Christoph Neumann and Nate Jones",
  :published-str "Fri Sep 06 08:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16d086ac7f5:4a49fdd:97b0c8f7",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://clojuredesign.club/episode/045-why-have-derived-fields-in-data-when-i-can-just-calculate-derived-data-as-needed-with-a-function/",
  :commonTopics
  [{:score 37.462051064844246,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1567782000000,
  :fingerprint "3c7b70d9",
  :canonicalUrl
  "https://clojuredesign.club/episode/045-why-have-derived-fields-in-data-when-i-can-just-calculate-derived-data-as-needed-with-a-function/"}
 {:engagement 11,
  :unread false,
  :crawled 1567721613397,
  :recrawled 1568180584529,
  :content
  {:content
   "<div><h1>Senior Full Stack Engineer </h1><div>NuID | New York City</div><div><em>We're building the first trustless authentication system. </em></div><div>$90000 - $140000</div><div><a href=\"https://nuid.io\">https://nuid.io</a></div><br><div><h3>About NuID</h3><p>NuID is building a next-generation authentication platform intended to simplify writing secure, privacy-preserving applications. Our solution, NuLogin, leverages zero knowledge proofs to eliminate the sharing of authentication secrets, and a distributed ledger to provide persistent, globally unique, and user-owned login credentials. NuLogin is the modern login box. </p><p>We are a seed-stage startup with backing from 8VC, Jemison Investment, and angel investors. You can see more about our team and advisors <a href=\"https://nuid.io/#/team\">here</a>. </p><p>We're looking for a Senior Full Stack Engineer to help us drive product development across a broad range of domains. You will be a core part of a small team and help drive all aspects of bringing a product to life.</p><h3>The role</h3><p>You will be working closely with our CTO to design, build, and launch core functionality of the NuLogin product. </p><p>Some projects on our roadmap include: multi-factor authentication (mobile, push), expanding our developer portal, and expanding NuLogin integration support to more languages/frameworks, identity-based threat intelligence tools and privacy preserving features. </p><p>The technologies we use include:</p>\n<ul>\n<li>Clojure/ClojureScript</li>\n<li>Datomic</li>\n<li>AWS, Terraform</li>\n<li>Serverless (Lambda, SNS, SQS, ...)</li>\n</ul><p>Experience is best when it's shared. Familiarity with these technologies will help in finding your groove quickly, but isn't a prerequisite for success at NuID. Comfort in both learning and teaching is essential.</p><h3>What we're looking for</h3><p>We are looking for a generalist Senior Full Stack Engineer that will be able to take on a diverse set of challenges. </p><p>We are not looking to check boxes. The skills and experiences below should give you an idea of what would prepare you for this role, but aren't hard requirements. </p>\n<ul>\n<li>5+ years of engineering</li>\n<li>2+ years working with Clojure or other functional language</li>\n<li>Experience building authentication products or systems</li>\n<li>Experience with and a passion for the startup environment</li>\n<li>Familiarity with cryptography and security engineering</li>\n<li>Previous work with privacy-first design</li>\n</ul><h3>Fit</h3><p>We love what we do. We believe in craft. We've seen most of Rich's talks. We're still unsure whether worse is better. Culturally, we draw a lot of inspiration from Basecamp. Simple is better than easy and we build for change. </p><p>You will be joining a small, distributed team and working on zero-to-one projects. Communication is paramount. We believe it should always be mindful, direct, and kind. </p><p>We emphasize strong ownership and collaboration in our day to day operation. You will drive architectural decision-making, inform product roadmap, and exercise initiative to support and improve the NuLogin ecosystem.</p><h3>More details</h3><p>We are looking to invest in an individual who is seeking opportunities to grow with NuID as a full-time team member. A contract-to-hire option would also be considered. We are flexible and would jump at the opportunity to bring on a mutually great fit. </p><p>Base salary range is $115-160k. Equity compensation will also be available. Full health, dental, vision, and life insurance are provided. </p><p>This role is based in NYC, but we are open to remote from the surrounding areas. Our founders are both in New York, but our team is spread across both coasts. </p><p>We always want the best ideas to win. To do that, we need a diverse set of ideas from a diverse team with different personal and professional backgrounds. We value new perspectives and identities that will help us build a stronger community. </p><p>Keywords: authentication, zero knowledge, FIDO, authorization, serverless, decentralization, privacy, Clojure, ClojureScript, cryptography</p></div></div>",
   :direction "ltr"},
  :updated 1567720189000,
  :entities
  [{:mentions
    [{:text "New York City"} {:text "New York"} {:text "NYC"}],
    :id "nlp/f/entity/wd:60",
    :salienceLevel "mention",
    :label "New York City"}
   {:mentions [{:text "distributed ledger"}],
    :id "nlp/f/entity/wd:25110971",
    :salienceLevel "mention",
    :label "distributed ledger"}
   {:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "serverless"}],
    :id "nlp/f/entity/wd:3958022",
    :salienceLevel "mention",
    :label "serverless computing"}
   {:mentions [{:text "multi-factor authentication"}],
    :id "nlp/f/entity/wd:7878662",
    :salienceLevel "mention",
    :label "multi-factor authentication"}],
  :alternate
  [{:href
    "https://jobs.braveclojure.com/jobs/17592186047071/senior-full-stack-engineer-nuid",
    :type "text/html"}],
  :title "Senior Full Stack Engineer",
  :author "Brave Clojure Jobs",
  :published-str "Thu Sep 05 14:49:49 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16d037d6855:43993c4:97b0c8f7",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://jobs.braveclojure.com/jobs/17592186047071/senior-full-stack-engineer-nuid",
  :updateCount 1,
  :commonTopics
  [{:score 41.16842136897543,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.789,
    :id "nlp/f/topic/1827",
    :salienceLevel "mention",
    :label "product management"}
   {:score 0.76,
    :id "nlp/f/topic/2397",
    :salienceLevel "mention",
    :label "vc"}],
  :published 1567720189000,
  :fingerprint "5beb7301",
  :canonicalUrl
  "https://jobs.braveclojure.com/jobs/17592186047071/senior-full-stack-engineer-nuid"}
 {:engagement 10,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1567687998470,
  :content
  {:content
   "<p>Functional programming is a broad discipline, and this series has only scratched the surface. Like most skills, it is learned through practice. To help you practice, I’ve found a few ideas that are rooted in functional programming and may find a place in your next project. I’ve also collected a few functional languages that offer a chance to further explore functional programming.<span></span></p>\n<h2>Functional Concepts</h2>\n<p>I wanted to review two interesting higher-level functional programming concepts that you can explore. These ideas can be a good way to integrate FP thinking into your daily routine, without changing what you’re working on.</p>\n<h3>Monads</h3>\n<p>Monads are one of the most infamous concepts in functional programming. They can be confusing to understand because they’re so broad that you’ve already used them without realizing it. Instead of trying to explain them myself, I’ll share two resources that helped me get a grasp on monads:</p>\n<ul>\n<li><a href=\"http://feeds.feedblitz.com/~/t/0/0/atomicspin/~https://dev.to/theodesp/explain-monads-like-im-five\">Quora: Explain Monads Like I’m Five</a> – This is a really brief example, but I think it’s a good primer to learn more.</li>\n<li><a href=\"http://feeds.feedblitz.com/~/t/0/0/atomicspin/~learnyouahaskell.com/a-fistful-of-monads\">Learn You a Haskell for Great Good, Chapter 12: A Fistful of Monads</a> – This is a great explanation, but it requires knowledge of Haskell and context from earlier in the book.</li>\n</ul>\n<h3>Functional core, imperative shell</h3>\n<p><em>Functional core, imperative shell</em> is an architecture pattern that mixes functional programming with imperative programming in an attempt to cancel out the downsides of each. Functional languages are known to be weak when interacting with the “real world,” A.K.A. user input or other IO.</p>\n<p>With this pattern, you write the core of your application logic with functional patterns, benefiting from easier testability and developer experience. Then, you write the exterior layers of your application with an imperative style, which is better at handling IO.</p>\n<p>I learned of this pattern from Gary Bernhardt and his <a href=\"http://feeds.feedblitz.com/~/t/0/0/atomicspin/~https://www.destroyallsoftware.com/screencasts/catalog/functional-core-imperative-shell\">Destroy All Software</a> screencast. He does a great job of explaining the pattern and offers a helpful collection of other technical screencasts.</p>\n<h2>Functional Languages</h2>\n<p>JavaScript is the language that I used for all of my examples, but JavaScript supports non-functional programming. As an alternative, I’ve collected a list of my favorite functional languages to help you dive into functional programming and remove some productivity obstacles.</p>\n<h3>Haskell</h3>\n<p><a href=\"http://feeds.feedblitz.com/~/t/0/0/atomicspin/~https://www.haskell.org\">Haskell</a> is a popular, purely functional language that’s a member of the<a href=\"http://feeds.feedblitz.com/~/t/0/0/atomicspin/~https://en.wikipedia.org/wiki/ML_(programming_language)\"> ML family</a> of programming languages, with a number of interesting features. One of those is lazy evaluation, a unique feature that allows Haskell to work with infinite data structures, but only evaluates the part of the data structure that’s used. Haskell also supports a strong static type system that’s rooted in mathematics.</p>\n<p>Here’s a small snippet of Haskell demonstrating a recursive maximum function.</p>\n<pre><code>\nmaximum' :: (Ord a) => [a] -> a  \nmaximum' [] = error &quot;maximum of empty list&quot;  \nmaximum' [x] = x  \nmaximum' (x:xs) = max x (maximum' xs) \n</code></pre>\n<p>If you’re interested in learning Haskell, <a href=\"http://feeds.feedblitz.com/~/t/0/0/atomicspin/~learnyouahaskell.com/\">Learn You a Haskell For Great Good</a> is a wonderful resource.</p>\n<h3>Elixir</h3>\n<p><a href=\"http://feeds.feedblitz.com/~/t/0/0/atomicspin/~https://elixir-lang.org\">Elixir</a> is another functional language that’s gained a lot of popularity recently. This language is built on top of the Erlang VM, and it looks a lot like Ruby. The VM’s most noteworthy feature is that it supports a super-lightweight concurrency method, allowing you to (more) easily translate your assortment of functions into concurrent applications.</p>\n<p>Here’s a small snippet of Elixir from the official docs that demonstrates some basic recursion.</p>\n<pre><code>\ndefmodule Recursion do\n  def print_multiple_times(msg, n) when n &lt;= 1 do\n    IO.puts msg\n  end\n  def print_multiple_times(msg, n) do\n    IO.puts msg\n    print_multiple_times(msg, n - 1)\n  end\nend\nRecursion.print_multiple_times(&quot;Hello!&quot;, 3)\n</code></pre>\n<p>I don’t have any experience with these resources, but the Elixir website has a list of <a href=\"http://feeds.feedblitz.com/~/t/0/0/atomicspin/~https://elixir-lang.org/learning.html\">recommended books and websites</a> to learn Elixir.</p>\n<h3>Lisp</h3>\n<p>Lisp is arguably one of the most famous functional programming languages out there, inspiring a family of languages, including <a href=\"http://feeds.feedblitz.com/~/t/0/0/atomicspin/~https://www.scheme.com/tspl4/\">Scheme</a>, <a href=\"http://feeds.feedblitz.com/~/t/0/0/atomicspin/~https://racket-lang.org\">Racket</a>, and <a href=\"http://feeds.feedblitz.com/~/t/0/0/atomicspin/~https://clojure.org\">Clojure</a>. Lisp’s distinct syntax of surrounding every expression with parentheses has frustrated many programmers with a lost closing paren. I think the language’s usefulness outweighs any parenthetical frustration.</p>\n<p>Here’s an example of Lisp showing off a recursive function that checks for a number in a list.</p>\n<pre><code>(defun n-in-list (n the-list)\n                      (cond ((null the-list) nil)\n                        ((equalp n (first the-list)) t)\n                         (t (n-in-list n (rest the-list)))))\n</code></pre>\n<p><a href=\"http://feeds.feedblitz.com/~/t/0/0/atomicspin/~https://web.mit.edu/alexmv/6.037/sicp.pdf\"><em>Structure and Interpretation of Computer Programs</em></a> from MIT, AKA “The Wizard Book,” provides a walkthrough of Lisp at the level of a college textbook. The book’s choice of Lisp dialect is Scheme.</p>\n<p><a href=\"http://feeds.feedblitz.com/~/t/0/0/atomicspin/~https://mitpress.mit.edu/books/little-schemer-fourth-edition\"><em>The Little Schemer</em></a> is another great introduction to Lisp using, you guessed it, Scheme.</p>\n<p>I hope this series introduced you to the joys of functional programming. There’s a lot more that I didn’t discuss here, but the best way to familiarize yourself with functional programming is to use it a little bit each day! Put down your for-loop and reach for map!</p>\n<hr>\n<p>This is the fourth post in a series on functional programming:</p>\n<ol>\n<li><a href=\"http://feeds.feedblitz.com/~/t/0/0/atomicspin/~https://spin.atomicobject.com/2019/08/15/what-is-functional-programming/\">What Is Functional Programming?</a></li>\n<li><a href=\"http://feeds.feedblitz.com/~/t/0/0/atomicspin/~https://spin.atomicobject.com/2019/08/22/functional-programming-patterns/\">Ideas &amp; Patterns</a></li>\n<li>When &amp; When Not to Use It</li>\n<li>Ideas for Practicing &amp; Exploring</li>\n</ol>\n<p>The post <a rel=\"nofollow\" href=\"http://feeds.feedblitz.com/~/t/0/0/atomicspin/~https://spin.atomicobject.com/2019/09/05/functional-programming-practice/\">Functional Primer, Part 4 – Practice &amp; Explore</a> appeared first on <a rel=\"nofollow\" href=\"http://feeds.feedblitz.com/~/t/0/0/atomicspin/~https://spin.atomicobject.com\">Atomic Spin</a>.</p>\n<img border=\"0\" src=\"https://feeds.feedblitz.com/~/i/606469280/0/atomicspin\" alt=\"\" width=\"1\" align=\"left\" hspace=\"0\" height=\"1\">",
   :direction "ltr"},
  :updated 1567684852000,
  :entities
  [{:mentions
    [{:text "functional programming"} {:text "functional language"}],
    :id "nlp/f/entity/wd:193076",
    :salienceLevel "about",
    :label "functional programming"}
   {:mentions [{:text "Haskell"}],
    :id "nlp/f/entity/wd:34010",
    :salienceLevel "mention",
    :label "Haskell"}
   {:mentions [{:text "Elixir"}],
    :id "nlp/f/entity/wd:5362035",
    :salienceLevel "mention",
    :label "Elixir"}
   {:mentions [{:text "recursive"} {:text "recursion"}],
    :id "nlp/f/entity/wd:179976",
    :salienceLevel "mention",
    :label "recursion"}
   {:mentions [{:text "Lisp"}],
    :id "nlp/f/entity/wd:132874",
    :salienceLevel "mention",
    :label "Lisp"}],
  :alternate
  [{:href
    "https://feeds.feedblitz.com/~/606469280/0/atomicspin~Functional-Primer-Part-Practice-Explore/",
    :type "text/html"}],
  :title "Functional Primer, Part 4 – Practice & Explore",
  :author "Jarek Wojciechowski",
  :published-str "Thu Sep 05 05:00:52 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16d017c7c06:4068d4f:97b0c8f7",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url
   "https://spin.atomicobject.com/wp-content/uploads/functional-programming.jpg",
   :width 1180,
   :height 787,
   :contentType "image/jpeg"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://spin.aa8q45el-liquidwebsites.com/?p=151670",
  :commonTopics
  [{:score 105.65244142859694,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 24.722222793575988,
    :id "nlp/f/topic/3000",
    :salienceLevel "about",
    :label "artificial intelligence"}
   {:score 0.897,
    :id "nlp/f/topic/525",
    :salienceLevel "about",
    :label "computer science"}],
  :published 1567684852000,
  :fingerprint "a57e2c2b",
  :canonicalUrl
  "https://spin.atomicobject.com/2019/09/05/functional-programming-practice/"}
 {:engagement 5,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1567685278122,
  :recrawled 1567691083471,
  :content
  {:content
   "<p>We often talk about data orientation in functional programming circles. It basically means programming with data, without hiding your data. Our software is information systems, so why not treat the data in the raw? In this episode, we dive into what is data, what data orientation is all about, and how you program with it.</p>\n<p></p>\n<h2>Transcript</h2>\n<p>Eric Normand: What is data orientation? By the end of this episode, you will have a better idea of what we mean in functional programming when we talk about data orientation. It’s a very common idea in functional languages.</p>\n<p>Hi, my name is Eric Normand and I help people thrive with functional programming.</p>\n<p>Data orientation really quickly, it’s programming with data. Let’s go a little deeper than that.</p>\n<p>What is data? I’m going to start with the basics. Now you look it up in the dictionary and it says it’s facts about events. Something happens, an event, and now you have some facts about it. Maybe you measured the temperature, that’s a fact about the event of measuring. This is what the thermometer told me, it’s 80 degrees.</p>\n<p>They’re facts about events, that’s a very clear definition. When we’re doing data orientation, we’re programming with data. A lot of our code becomes data transformation. We’re getting data from one source and we’re processing it. We’re storing it, we’re transmitting it, we’re doing something with this data.</p>\n<p>That’s one of the reasons why I like data orientation is we’re making information systems, usually. Especially on the back end, we’re taking in information, we’re taking in HTTP requests. We’re taking in transactions or some other API calls, or we’re reading sensors. We’re doing something, we’re taking in information and we’re doing something with it.</p>\n<p>Data orientation is basically saying, “Let’s leave it as data. It came in as data, it’s going to go out as data. Let’s treat it like data the whole way through.”</p>\n<p>Data has some interesting properties that make it good for this. One is that it has structure. We have — computer scientists that is — found different structures of data that are both efficient to store in memory and use.</p>\n<p>Also, ergonomic. We’ve come up with algorithms that use them. They are convenient for the programmer. Talking things like arrays and hash maps, numbers, strings, all these things that we’re used to. These are just data.</p>\n<p>You can build structure, you can rely on the structure of those things. Data comes in, it’s got certain attributes. Those attributes might have a name and a value. It becomes natural to think maybe this would be a good candidate to use a hash map for because I’m going to be looking up these values by the attribute name.</p>\n<p>That’s the structure part. Sort of a plus and a minus, it’s a double edged sword is that data requires interpretation. It’s not meaningful by itself. If I said the number five, you have no idea what that means even if I put a unit on it. Five pounds, you still don’t know what it means.</p>\n<p>It requires context before it can be used. That context might be embedded in the data, it might be from the software or the interpreter’s perspective. It really requires interpretation. You have to have a purpose. Why am I reading this? What can I learn from it? What decisions can I make from it?</p>\n<p>All of that stuff means that without those things, the data doesn’t have any meaning by itself. As an example, I know this is silly but I look at data as a really old tradition. It goes back to the earliest record keepings that we have.</p>\n<p>Before the invention of writing, you could mark the number of cattle that you were trading with someone on a stone tablet or something, or a clay tablet. You’re counting, and you’re keeping records. Each little mark is a fact about an event. A cow pass through this gate, you’re marking that and then you have this aggregate data.</p>\n<p>They’re just marks on a clay tablet, but if you know how to interpret it you can glean a lot from it. Then the clay tablet gets buried somewhere. 4,000 years later, an archaeologist finds it and now they have to interpret it. They might figure out from context, “Oh, this was counting cattle.”</p>\n<p>What the person who originally made this thing was concerned with was getting a fair deal. They wanted to make sure that everyone’s getting paid the right amount of money. That’s their concern. Now this archaeologist can interpret the same marks in a totally different way.</p>\n<p>The archaeologists can now say, “Oh well, let’s learn about the economy of this civilization. Oh look, this year was a really good year. Look how many cattle came through here. Now this year is really bad because it had a fewer number. They must have been hungry at that time. Then that might explain why they went to war.”</p>\n<p>Whatever they can glean from it, that is now a different purpose from the same data. That’s what I mean when data requires interpretation. That’s like it’s meaningless by itself, but on the plus side, it can be interpreted in multiple ways. It’s neutral. You’re writing down the temperature, and what do you do with that? Well, that is up to you.</p>\n<p>At this point, I said data orientation is something I like because we’re writing information system for taking in data, we’re writing it out again. We’re storing it, we’re transforming it, processing it, generating new data from that original data. It seems like, “Well isn’t that what programming is?”</p>\n<p>I would say, “Yes. Except there are some styles of programming, some paradigms you might say, where things like data hiding are more prominent, are important parts of that paradigm.” Like in object oriented programming, you might say we want to hide this data behind an interface.</p>\n<p>We want to hide the pieces of information, the facts that we have. You’re going to have to call methods or send me messages. I will do the interpreting for you. That’s basically what object orientation is saying — I will do the interpretation for you. Data requires interpretation and so I will be your interpreter.</p>\n<p>Sometimes that’s nice because that interface lets you do polymorphism and stuff like that. Different things have different data, but they can still have the same interface. That’s really nice, but that’s not data orientation.</p>\n<p>I’m trying to juxtapose the two. If you have hiding, you’re adding a layer of interpretation on your data. That is required. You have to go through this interpreter layer to read the data. It makes it much harder to interpret the data in multiple ways.</p>\n<p>When you have the data raw, you can interpret it however you want. That is data orientation — leaving it raw so that you can interpret it. Different parts of the system have different purposes. They can read it and do different things with it.</p>\n<p>If you need to hide it, then what you’re doing is you’re going to bake in different interpreters into that interface. This will just make the class get bigger and bigger because you’re going to need methods that this thing needs over there. You’re going to need methods that that thing needs.</p>\n<p>Or you could have some system for having different interfaces on the same data but then how do you get the data between them? It’s really hard.</p>\n<p>In data orientation, we just prefer to not hide, just expose it. We’ll let whatever interpreters who want to run on it, who want to interpret it, do whatever they need to do. That is data orientation.</p>\n<p>All right. I’m going to recap. Data orientation is just programming with data. No hiding. Data is facts about events. Data-oriented programming, you tend to do a lot of data transformations. Your system is inputting, storing, transmitting, processing data. That’s what it does. Everything you’re doing is something…not everything but most of what you’re doing is one of those things.</p>\n<p>Data has structure to it. It needs that structure because you need some common way of understanding, of using the data. What I mean by that is you know the structure of a string. You can access each character by index and the characters are going to be some kind of unicode thing. You can append two of them. It has a structure that we understand.</p>\n<p>Then it requires interpretation. It’s a double-edged sword. It requires it, but it allows different ways of interpreting the same data.</p>\n<p>Awesome. If you like this episode, you should subscribe because I’ve got two more episodes lined up. They’re right here. Here’s my notes. Two more of these ready to record, and they’ll be coming right down after this one. You should subscribe, and you’ll get them.</p>\n<p>If you want to, you should go to lispcast.com/podcast. You’ll see links to subscribe and also to get in touch with me on social media. I love getting into discussions. A lot of these topics came out of questions that people had because I said something, and they didn’t understand it. I was being confusing. I needed to explain more, so this is what this is.</p>\n<p>I’ll also love just getting into discussions. Maybe you disagree with me. Maybe you have a different idea of what data orientation means.</p>\n<p>On lispcast.com/podcast, you’ll also find all the old podcasts, the previous podcasts, the episodes with audio, video, and text transcripts, so you can consume it however you want.</p>\n<p>All right. This has been my thought on functional programming. I’m Eric Normand. Thanks for listening and rock on.</p>\n<p>The post <a rel=\"nofollow\" href=\"https://lispcast.com/what-is-data-orientation/\">What is Data Orientation?</a> appeared first on <a rel=\"nofollow\" href=\"https://lispcast.com\">LispCast</a>.</p>",
   :direction "ltr"},
  :updated 1567681200000,
  :entities
  [{:mentions [{:text "functional programming"}],
    :id "nlp/f/entity/wd:193076",
    :salienceLevel "about",
    :label "functional programming"}
   {:mentions [{:text "clay tablet"}],
    :id "nlp/f/entity/wd:1570005",
    :salienceLevel "about",
    :label "clay tablet"}
   {:mentions [{:text "API"}],
    :id "nlp/f/entity/wd:165194",
    :salienceLevel "mention",
    :label "application programming interface"}
   {:mentions [{:text "object-oriented programming"}],
    :id "nlp/f/entity/wd:79872",
    :salienceLevel "mention",
    :label "object-oriented programming"}],
  :alternate
  [{:href "https://lispcast.com/what-is-data-orientation/",
    :type "text/html"}],
  :title "What is Data Orientation?",
  :author "Eric Normand",
  :published-str "Thu Sep 05 04:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16d0152f9aa:3db4d18:69b9f616",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url
   "https://lispcast.com/wp-content/uploads/2019/09/What-is-Data-Orientation_.jpg",
   :width 1280,
   :height 720,
   :contentType "image/jpeg"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://lispcast.com/?p=2008",
  :updateCount 1,
  :commonTopics
  [{:score 52.612616483800565,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.981,
    :id "nlp/f/topic/253",
    :salienceLevel "about",
    :label "big data"}
   {:score 0.843,
    :id "nlp/f/topic/90",
    :salienceLevel "mention",
    :label "analytics"}
   {:score 0.827,
    :id "nlp/f/topic/617",
    :salienceLevel "mention",
    :label "data protection"}
   {:score 0.778,
    :id "nlp/f/topic/2010",
    :salienceLevel "mention",
    :label "scalability"}
   {:score 0.772,
    :id "nlp/f/topic/1871",
    :salienceLevel "mention",
    :label "quant"}
   {:score 0.737,
    :id "nlp/f/topic/525",
    :salienceLevel "mention",
    :label "computer science"}],
  :published 1567681200000,
  :fingerprint "647ce3e5",
  :canonicalUrl "https://lispcast.com/what-is-data-orientation/"}
 {:engagement 16,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1567610284462,
  :content
  {:content
   "<div>\n<p><a href=\"https://github.com/juxt/crux\">Crux</a> is built for providing queryability at scale\nand for that reason we specifically designed Crux around Apache Kafka as the\nimmutable event log, to serve as the foundational piece in our unbundled\narchitecture.</p>\n</div>\n<div>\n<p>Until now Kafka has acted as the golden store for transactions and documents,\nand provided coordination between nodes in the form of serialized transaction\nordering. Crux nodes rely on these properties to deterministically ingest the\nstream of events and maintain local bitemporal indexes in a local Key/Value\nstores, such as RocksDB or LMDB.</p>\n</div>\n<div>\n<p><span><img alt=\"crux jdbc\" width=\"1000\" src=\"https://juxt.pro/img/crux-jdbc.png\"></span></p>\n</div>\n<div>\n<p>One potential drawback of Kafka is that if you don’t already have an existing\nKafka cluster established then it requires additional investment to get one\nrunning and it carries implications for future operational overhead that may\nnot be immediately justifiable. We discussed the ease and benefits of using a\nmanaged Kafka service in our\n<a href=\"https://juxt.pro/blog/posts/crux-confluent-cloud.html\">previous blog post</a>, but\nprocuring services from an external provider is not always an option.</p>\n</div>\n<div>\n<p>On the other hand, use of Relational Data Stores is prevalent throughout most\ncompanies and these more traditional &quot;databases&quot; are often readily available as\na service, either on-prem or in the cloud, such as Amazon RDS. If your data\nthroughput requirements are not massive then using a typical RDS database setup\nwith Crux, in place of Kafka, is a reasonable choice.</p>\n</div>\n<div>\n<p>We have just released\n<a href=\"https://github.com/juxt/crux/tree/master/crux-jdbc\">Crux-JDBC</a>, which allows you\nto use Crux nodes in a cluster without needing Kafka. Transaction and document\nwrites are made directly into an RDS of your choosing via JDBC. This happens\ntransparently from the regular Crux API. Crux nodes will then ingest directly\nfrom the JDBC tables into their local K/V stores.</p>\n</div>\n<div>\n<p><span><img alt=\"crux jdbc 2\" src=\"https://juxt.pro/img/crux-jdbc-2.png\"></span></p>\n</div>\n<div>\n<p>We have provided initial support for:</p>\n</div>\n<div>\n<ul>\n<li>\n<p>PostgreSQL</p>\n</li>\n<li>\n<p>MySQL</p>\n</li>\n<li>\n<p>Oracle</p>\n</li>\n<li>\n<p>H2</p>\n</li>\n<li>\n<p>SQLite</p>\n</li>\n</ul>\n</div>\n<div>\n<p>The Kafka-like semantics of eviction and compaction of documents is preserved.</p>\n</div>\n<div>\n<p>To get started, simply add the <code>juxt/crux-jdbc</code> dependency to your project and\nfire up a Crux node that is configured to point to an existing database.\nAlternatively you can run an embedded SQLite or H2 database in a standalone\nnode.</p>\n</div>\n<div>\n<p><span><img alt=\"crux jdbc 1\" src=\"https://juxt.pro/img/crux-jdbc-1.png\"></span></p>\n</div>\n<div>\n<p>Follow the docs to\n<a href=\"https://juxt.pro/crux/docs/configuration.html#_jdbc_nodes\">configure your Crux\nnode to use JDBC</a>.</p>\n</div>\n<div>\n<p>Enjoy! We’re available on the\n<a href=\"http://clojurians.slack.com/messages/crux\">#crux</a> channel on the\nClojurians slack to respond to any queries / issues.</p>\n</div>",
   :direction "ltr"},
  :updated 1567590900000,
  :entities
  [{:mentions [{:text "Crux"}],
    :id "nlp/f/entity/wd:10542",
    :salienceLevel "about",
    :label "Crux"}
   {:mentions [{:text "JDBC"}],
    :id "nlp/f/entity/wd:722772",
    :salienceLevel "mention",
    :label "Java Database Connectivity"}
   {:mentions [{:text "Apache Kafka"}],
    :id "nlp/f/entity/wd:16235208",
    :salienceLevel "mention",
    :label "Apache Kafka"}
   {:mentions [{:text "SQLite"}],
    :id "nlp/f/entity/wd:319417",
    :salienceLevel "mention",
    :label "SQLite"}
   {:mentions [{:text "PostgreSQL"}],
    :id "nlp/f/entity/wd:192490",
    :salienceLevel "mention",
    :label "PostgreSQL"}],
  :alternate
  [{:href "https://juxt.pro/blog/posts/crux-jdbc.html",
    :type "text/html"}],
  :title "Introducing Crux JDBC",
  :author "The JUXT Blog",
  :published-str "Wed Sep 04 02:55:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16cfcdaa9ae:37c9433:69b9f616",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url "https://juxt.pro/img/crux-jdbc.png",
   :width 2038,
   :height 1168,
   :contentType "image/png"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://juxt.pro/blog/posts/crux-jdbc.html",
  :commonTopics
  [{:score 47.2361995931051,
    :id "nlp/f/topic/3036",
    :salienceLevel "about",
    :label "physical science"}
   {:score 44.12257507676421,
    :id "nlp/f/topic/3032",
    :salienceLevel "about",
    :label "astronomy"}
   {:score 0.992,
    :id "nlp/f/topic/619",
    :salienceLevel "about",
    :label "database"}
   {:score 0.97,
    :id "nlp/f/topic/651",
    :salienceLevel "about",
    :label "devops"}
   {:score 0.712,
    :id "nlp/f/topic/1983",
    :salienceLevel "mention",
    :label "saas"}],
  :published 1567590900000,
  :fingerprint "4ebef076",
  :canonicalUrl "https://juxt.pro/blog/posts/crux-jdbc.html"}
 {:engagement 5,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/todo",
    :label "todo"}
   {:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1567610284462,
  :content
  {:content
   "<p>I can mostly avoid async tests for my re-frame cljs apps. Even integration-style test that use <a href=\"https://github.com/airbnb/enzyme\">enzyme</a> or <a href=\"https://github.com/testing-library/react-testing-library\">react-testing-library</a> can be made synchronous by using <code>day8.re-frame.test/run-test-sync</code>. This is nice because they’re easier to understand and debug. Sometimes though, async is necessary. The Clojurescript site describes <a href=\"https://clojurescript.org/tools/testing\">how to do async tests</a> using the\n<code>cljs.test/async</code> macro.</p>\n<p>That works fine, but you have to make sure your test code calls the <code>done</code> function in every case, including on errors, timeout etc. So to remove some boilerplate, here’s a new <a href=\"https://github.com/henryw374/Cljs-Async-Timeout-Tests\">utility</a> which provides a macro like <code>cljs.test/async</code>, but which on timeout or uncaught failure (exception or failed promise), will fail the test, calling the <code>done</code> function for you.</p>\n<p>Here’s how you’d use it:</p>\n<div><div><pre><code>(ns myns.ns\n  (:require [clojure.test :refer [is deftest]]\n            [widdindustries.timeout-test :refer [async-timeout async-timeout-at]]))\n\n(deftest my-test\n  (async-timeout done \n     ;; do some stuff that will call `done` when it succeeds.\n     ;; lib expects any async body will result in a promise\n   ))\n</code></pre></div></div>\n<p>If you have any feedback please comment or raise an issue.</p>\n<p>Henry</p>",
   :direction "ltr"},
  :updated 1567555200000,
  :alternate
  [{:href "http://widdindustries.com/cljs-async-tests/",
    :type "text/html"}],
  :title "Less Boilerplate in Cljs Async Tests",
  :author "Henry Widd",
  :published-str "Tue Sep 03 17:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16cfcdaa9ae:37c9432:69b9f616",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "http://widdindustries.com/cljs-async-tests",
  :commonTopics
  [{:score 0.915,
    :id "nlp/f/topic/1871",
    :salienceLevel "about",
    :label "quant"}],
  :published 1567555200000,
  :fingerprint "39b10d56",
  :canonicalUrl "http://widdindustries.com/cljs-async-tests/"}
 {:engagement 5,
  :unread false,
  :crawled 1567591150219,
  :content
  {:content "Deploying a serverless ClojureScript app on Firebase",
   :direction "ltr"},
  :updated 1567461600000,
  :entities
  [{:mentions [{:text "serverless"}],
    :id "nlp/f/entity/wd:3958022",
    :salienceLevel "about",
    :label "serverless computing"}],
  :alternate
  [{:href
    "http://appliedscience.studio/articles/cljs-firebase-functions.html",
    :type "text/html"}],
  :title "ClojureScript on Firebase Cloud Functions",
  :author "Applied Science blog",
  :published-str "Mon Sep 02 15:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16cfbb6b28b:35d7462:69b9f616",
  :visual {:url "none"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "http://appliedscience.studio/articles/cljs-firebase-functions.html",
  :published 1567461600000,
  :fingerprint "837e0887",
  :canonicalUrl
  "http://appliedscience.studio/articles/cljs-firebase-functions.html"}
 {:engagement 6,
  :unread false,
  :crawled 1567523843773,
  :content
  {:content
   "<div><p>We are definitely back from holidays, and to demonstrate that we’re not just doing one but two live stream events!</p><h2>Felipe and Arne pairing</h2><p><strong>Thursday 5 September, 13:00 to 15:00 UTC</strong></p><p>I will be pairing with Felipe Barros, working on a reimplementation of the <a shape=\"rect\" href=\"http://activities.heartofclojure.eu/\">activities app</a> that we used for Heart of Clojure. We only had a single session so far, and we’re starting from the ground up, with nothing but an empty directory, so this is a great way to see a Clojure app slowly unfold.</p><p>Unfortunately we didn’t record the first session, but we can briefly recap what we have so far. Last time we added Integrant and http-kit, next up is adding in reitit, and making some more decisions about our stack. There will also be plenty of Spacemacs involved!</p><h2>Lambda Island Office Hours</h2><p><strong>Friday 6 September, 14:00 to 15:00 UTC</strong></p><p>This is a new things we’re trying out, people can send their questions to <a shape=\"rect\" href=\"mailto:officehours@lambdaisland.com\">officehours@lambdaisland.com</a>, and I’ll do my best to answer them.</p><p>We announced this in our mailing list several weeks ago, but so far no questions have come in. There’s still time though. I’ll start preparing on Friday, so you have until Thursday evening to send in questions. Preferably about Lambda Island episode content, or about Lambda Island open source projects, but I’ll also consider regular Clojure questions.</p><p>If nothing comes in I’ll demonstrate some advanced uses of Kaocha.</p><p>Both events will be streamed on our <a shape=\"rect\" href=\"https://www.youtube.com/channel/UCGg8tJU0JxHS0xmKVA7t66g\">YouTube channel</a>, I’ll update this post with links to the stream before we start.</p></div>",
   :direction "ltr"},
  :updated 1567521318000,
  :entities
  [{:mentions [{:text "Lambda Island"}],
    :id "nlp/f/entity/wd:3427832",
    :salienceLevel "about",
    :label "Lambda Island"}
   {:mentions [{:text "UTC"}],
    :id "nlp/f/entity/wd:1536",
    :salienceLevel "mention",
    :label "Coordinated Universal Time"}
   {:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "live stream"}],
    :id "nlp/f/entity/wd:3027665",
    :salienceLevel "mention",
    :label "live streaming"}
   {:mentions [{:text "mailing list"}],
    :id "nlp/f/entity/wd:304863",
    :salienceLevel "mention",
    :label "electronic mailing list"}],
  :alternate
  [{:href
    "https://lambdaisland.com/blog/2019-09-03-streaming-sessions-thursday-friday",
    :type "text/html"}],
  :title "Lambda Island Streaming Live this Thursday and Friday",
  :author "Arne Brasseur",
  :published-str "Tue Sep 03 07:35:18 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16cf7b3aebd:323615c:49b12733",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://lambdaisland.com/blog/2019-09-03-streaming-sessions-thursday-friday",
  :published 1567521318000,
  :fingerprint "78caf683",
  :canonicalUrl
  "https://lambdaisland.com/blog/2019-09-03-streaming-sessions-thursday-friday"}
 {:engagement 38,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/todo",
    :label "todo"}],
  :unread false,
  :crawled 1567510148376,
  :recrawled 1567591150219,
  :content
  {:content
   "<h3>Learn Clojure By Building a Drug Dealer API — Part 2</h3><h4>git commit -am “Add database using HugSQL and Postgres”</h4><figure><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/1024/1*4vZebt3dYv_HSlHwNGC-1A.png\">Base Photo by <a href=\"https://unsplash.com/@joseantoniogall?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText\">Jose Antonio Gallego Vázquez</a> on <a href=\"https://unsplash.com/?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText\">Unsplash</a></figure><p><a href=\"https://medium.com/@shivekkhurana/learn-clojure-by-building-a-drug-dealer-api-part-1-83bd4adb9946\">You have built a simple app</a>. Now you want it to be a little more useful. You want to ultimately push it to prod right?</p><p>In this part, we’d connect to a database and handle CRUD.</p><h4>What’s up with the Drug Dealer title?</h4><p>Drug Dealer is a better click bait than a medical store. In the language of the civilized, we are building a medical store system.</p><p>In the <a href=\"https://medium.com/@shivekkhurana/learn-clojure-by-building-a-drug-dealer-api-part-1-83bd4adb9946\"><strong>last part</strong></a> we created a simple app structure to handle a drug store. A drug store had an inventory, each drug had a price, procurement was via offline sources and there was a retail window.</p><p>I carefully crafted a situation that had only one domain entity: The drug. Each drug has a price and availability. Procurement is offline, so we don’t care. Sale would just reduce the inventory size.</p><figure><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/1024/1*p8w7hkn6ls81fKCr7H8WFA.jpeg\">The database we are trying to model.</figure><p>We will have 5 routes on the drug model.</p><ul><li>GET /drugs — Return a list of all drugs</li><li>GET /drugs/:id — Get details of a drug by id</li><li>POST /drugs — Create a new drug</li><li>PUT /drugs/:id — Update a drug by id</li><li>DELETE /drugs/:id — Delete a drug by id</li></ul><figure><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/128/1*kT1mZwyxUce_RQ4vfu3sCw.png\">Source code available at <a href=\"https://github.com/krimlabs/workshops\">https://github.com/krimlabs/workshops</a> (branch <a href=\"https://github.com/krimlabs/workshops/tree/snapshot/dealer-api-part-2\">snapshot/dealer-api-part-2</a>)</figure><p>We first need to create a new namespace to handle interactions with the database. We are going to use <a href=\"https://www.hugsql.org/\">HugSQL</a> to handle db interactions. There is no db migration setup in this tutorial, but you can easily use a library like <a href=\"https://flywaydb.org/\">Flyway</a> or <a href=\"https://github.com/weavejester/ragtime\">Ragtime</a>.</p><h4>Add HugSQL to dependencies</h4><p>In your deps.edn file add the following:</p><pre>com.layerware/hugsql {:mvn/version &quot;0.4.9&quot;}<br>org.postgresql/postgresql {:mvn/version &quot;42.1.4&quot;}</pre><h4>Create files to hold SQL queries and functions</h4><p>HugSQL works by converting SQL definitions to Clojure functions. It requires us to define a source file and a Clojure namespace where the functions will be added.</p><pre>$ <strong>mkdir -p src/dealer_api/sql<br></strong>$ <strong>touch src/dealer_api/sql/drugs.sql</strong><br>$ <strong>touch src/dealer_api/sql/drugs.clj</strong></pre><h4>Create a file to hold the Drug routes</h4><p>We’ll also create a new namespace to hold this model. Let’s call it dealer-api.drugs. For this, we need to create a new file src/dealer_api/drugs.clj.</p><pre>$<strong> touch src/dealer_api/drugs.clj</strong></pre><figure><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/229/1*s1-JdZSaisRvh7q6nnYOOw.png\">Your directory structure after all files have been created</figure><h4>Create initial table structure</h4><p>Since we are not using a migration system, you can run the following commands directly in PSQL. This tutorial assumes that the name of your database is <strong>dealer_dev</strong>.</p><pre>CREATE TABLE drugs (<br>  id SERIAL PRIMARY KEY,<br>  name VARCHAR(255),<br>  availability INT NOT NULL DEFAULT 0,<br>  price FLOAT<br>);</pre><h4>Add seed data</h4><p>Here’s a list of <a href=\"https://www.beckershospitalreview.com/supply-chain/10-most-popular-prescription-drugs-for-2017.html\">10 most prescribed drugs from 2017</a>:</p><pre>INSERT INTO drugs (name, availability, price)<br>VALUES<br>  ('Vicodin, Norco, Xodol (hydrocodone, acetaminophen)', 100, 14),<br>  ('Synthroid, Levoxyl, Unithroid (levothyroxine)', 200, 11),<br>  ('Delasone, Sterapred (prednisone)', 150, 5),<br>  ('Amoxil (amoxicillin)', 200, 9),<br>  ('Neurontin (gabapentin)', 50, 13),<br>  ('Prinivil, Zestril (lisinopril)', 60, 7),<br>  ('Lipitor (atorvastatin)', 78, 12),<br>  ('Glucophage (metformin)', 180, 8),<br>  ('Zofran (ondansetron)', 40, 17),<br>  ('Motrin (ibuprofen)', 70, 12);</pre><h4>Create config to handle database connection</h4><p>Setup src/dealer_api/config.clj with a db definition. This will be used when we query the database using HugSQL.</p><pre>$<strong> touch src/dealer_api/config.clj</strong></pre><p>In this config, define the database you want to connect to:</p><pre>(<strong>ns</strong> dealer-api.config)</pre><pre>(<strong>def</strong> db<br>  {:classname &quot;org.postgresql.Driver&quot;<br>   :subprotocol &quot;postgresql&quot;<br>   :subname &quot;//localhost:5432/dealer_dev&quot;<br>   :user &quot;shivekkhurana&quot;<br>   :password &quot;&quot;})</pre><p>There are multiple ways of handling config in the Clojure universe. It’s a general practice to use .edn files and not a .clj file to handle config, but for the sake of simplicity, I’ve skipped it. If you are a building a real application, you should look at solutions like <a href=\"https://github.com/juxt/aero\">Aero,</a> <a href=\"https://github.com/jarohen/nomad\">Nomad</a> or <a href=\"https://github.com/yogthos/config\">Config</a>.</p><h4>Fix logging noise</h4><p>By default, the logging package makes a lot of noise. We can shut it down by using a logback config. I don’t understand much about how logback works and I usually end up copying the default. It’s configured with sensible defaults.</p><figure><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/1024/1*Mftko2jY23wvC_-njYsMLg.png\"></figure><p>Create a logback.xml file in /resources/logback.xml with the following content <a href=\"https://github.com/pedestal/pedestal/blob/master/service/dev/logback.xml\">[file source</a>]:</p><pre>&lt;configuration scan=&quot;true&quot; scanPeriod=&quot;10 seconds&quot;><br>  &lt;statusListener class=&quot;ch.qos.logback.core.status.NopStatusListener&quot; /><br>  &lt;appender name=&quot;FILE&quot; class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;><br>    &lt;encoder><br>      &lt;pattern>%d{HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n&lt;/pattern><br>    &lt;/encoder><br>&lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy&quot;><br>      &lt;fileNamePattern>logs/pedestal-service-%d{yyyy-MM-dd}.%i.log&lt;/fileNamePattern> <br>      &lt;maxFileSize>64 MB&lt;/maxFileSize><br>    &lt;/rollingPolicy></pre><pre>&lt;filter class=&quot;ch.qos.logback.classic.filter.ThresholdFilter&quot;><br>      &lt;level>DEBUG&lt;/level><br>    &lt;/filter><br>    &lt;prudent>true&lt;/prudent><br>  &lt;/appender><br>  &lt;appender name=&quot;STDOUT&quot; class=&quot;ch.qos.logback.core.ConsoleAppender&quot;><br>    &lt;encoder><br>      &lt;pattern>%-5level %logger{36} - %msg%n&lt;/pattern><br>    &lt;/encoder><br>    &lt;!-- Only log level WARN and above --><br>    &lt;filter class=&quot;ch.qos.logback.classic.filter.ThresholdFilter&quot;><br>      &lt;level>WARN&lt;/level><br>    &lt;/filter><br>  &lt;/appender><br>  &lt;root level=&quot;INFO&quot;><br>    &lt;appender-ref ref=&quot;FILE&quot; /><br>    &lt;appender-ref ref=&quot;STDOUT&quot; /><br>  &lt;/root><br>  &lt;logger name=&quot;pedestal&quot; level=&quot;ALL&quot; /><br>  &lt;logger name=&quot;hammock-cafe&quot; level=&quot;ALL&quot; /><br>  &lt;logger name=&quot;user&quot; level=&quot;ALL&quot; /></pre><pre>&lt;/configuration></pre><p>This tells the logger to not care about debug log and logs from outside our namespace. Next, we need to tell our project to use this file.</p><p>By default, SLF4J will look for a logback.xml file on the classpath. We can make it available by adding resources to classpath. Update the :src key in your deps.edn to include resources on the classpath:</p><pre>{:paths [&quot;src&quot; &quot;resources&quot;]<br>...<br>}</pre><p>Our logging issues should be gone now!</p><h3>Building the GET /drugs route</h3><p>The request cycle of Pedestal is similar to that of Node’s Express. A handler is bound to every route, it receives a request and returns a response.</p><p>It’s the job of the handler to do anything it wants (like authenticate, connect to a database, etc).</p><p>In our case, the handler will connect to the database via HugSQL.</p><h4>Write the sql query to fetch all drugs</h4><p>In src/dealer_api/sql/drugs.sql add the following query:</p><pre>-- <strong>:name</strong> drugs :? <strong>:*</strong><br>-- <strong>:doc</strong> Get all drugs<br><strong>SELECT * FROM drugs;</strong></pre><ul><li>:name keyword specifies the name of the function</li><li>:doc is optional documentation</li><li>:? :* signify that this query will return a list of results</li><li>Everything is followed by the actual query</li></ul><h4>Convert raw sql to Clojure functions using HugSQL macros</h4><p>Setup src/dealer_api/sql/drugs.clj as follows:</p><pre>(<strong>ns</strong> dealer-api.sql.drugs<br>  (:require [hugsql.core :as hugsql]))</pre><pre>(<strong>hugsql/def-db-fns</strong> &quot;dealer_api/sql/drugs.sql&quot;)</pre><p>hugsql/def-db-fns is a macro that converts the SQL definitions to Clojure functions. You can read more about Clojure Macros <a href=\"https://clojure.org/reference/macros\">here</a> and <a href=\"https://www.braveclojure.com/writing-macros/\">here</a>.</p><h4>Create a handler to get all drugs</h4><p>Setup src/dealer_api/drugs.clj as to handle get-all route:</p><pre>(<strong>ns</strong> dealer-api.drugs<br>  (:require [dealer-api.sql.drugs :as sql]<br>            [dealer-api.config :refer [db]]<br>            [io.pedestal.http :as http]))</pre><pre>(<strong>defn</strong> all-drugs [_]<br>  (http/json-response (<strong>sql/drugs</strong> db)))</pre><ul><li>Here we created a handler all-drugs and used SQL definitions defined using a macro. Observe how we are able to use the sql/all-drugs function, although it was defined in a text file. The macro parsed that file and made the actual definitions in the sql.drugs namespace.</li><li>http/json-response converts an map to a valid response with all the required keys.</li><li>The _ underscore argument to all-drugs function means that one argument will be passed to this function, but we don’t care about it.</li></ul><h4>Assign handler to GET /drugs route</h4><p>You handler and db interactions are all ready. We just need to bind it to a route. In dealer-api.core namespace, add the following require, and binding:</p><pre>(<strong>ns</strong> dealer-api.core<br>  (:require [io.pedestal.http :as http]<br>            [clojure.tools.namespace.repl :refer [refresh]]<br>            <strong>[dealer-api.drugs]</strong>))</pre><pre>(<strong>def</strong> routes<br>  #{[&quot;/hello&quot; :get `respond-hello]<br>    <strong>[&quot;/drugs&quot; :get dealer-api.drugs/all-drugs :route-name :get-drugs]</strong>})</pre><p>The :route-name parameter lets you do fancy things like creating named routes. Ignoring this topic for a future post, more details here : <a href=\"http://pedestal.io/reference/routing-quick-reference\">http://pedestal.io/reference/routing-quick-reference</a></p><h3>Test your setup — Power to the REPL</h3><figure><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/1024/1*QprlhMTV_Jw8eWfo2001_w.jpeg\">An infinite REPL | Ouroboros — A mythical creature that represents infinity in Middle Eastern culture [<a href=\"https://mythologian.net/ouroboros-symbol-of-infinity/\">source</a>]</figure><p>You can go ahead, open a REPL, and start a server as we did in the last post. And then go to the browser and check if the routes are working.</p><p>But the REPL is more powerful. Most aspects of your codebase can be tested without opening the browser. <strong>This is the one thing you should definitely take from this article.</strong></p><h4>Require namespaces you need</h4><p>In the REPL, require the db config, sql function and route handler (you don’t even need to start the server):</p><pre>$ <strong>clj<br></strong>Clojure 1.10.1<br><strong>user=></strong> (require '[dealer-api.config :refer [db]])<br>nil<br><strong>user=></strong> (require '[dealer-api.sql.drugs :as sd] :reload)<br>nil<br><strong>user=></strong> (require '[dealer-api.drugs :as d] :reload)<br>nil</pre><ul><li>The :reload keyword in the require function reloads the required ns</li><li>You can also use :reload-all in to reload all namespaces required by this namespace</li><li>Notice, in the REPL, require is a function, unlike ns declarations, where it is a keyword.</li><li>Since you’ll be setting up your REPL each time you come back to this namespace, it’s considered a good idea to save this setup declaration in the bottom of your namespace as a comment. This comment is generally referred to as a <strong>Rich Comment </strong>(<a href=\"https://www.youtube.com/watch?v=Qx0-pViyIDU\">Because it’s rich in context, and it’s heavily used by a person named Rich</a>).</li></ul><p>At the bottom of dealer-api.drugs ns, add the following Rich Comment:</p><pre>(comment <br>  (do <br>    (require '[dealer-api.config :refer [db]])<br>    (require '[dealer-api.sql.drugs :as sd] :reload)<br>    (require '[dealer-api.drugs :as d] :reload)))</pre><p>When you have the REPL integrated with your editor, you can directly send this code from your editor to the REPL.</p><h4>Verify if db is present and correct ✅</h4><p>You might have to change the database name, user and password.</p><pre><strong>user=></strong> db<br>{:classname &quot;org.postgresql.Driver&quot;, :subprotocol &quot;postgresql&quot;, :subname &quot;//localhost:5432/dealer_dev&quot;, :user &quot;shivekkhurana&quot;, :password &quot;&quot;}</pre><h4>Verify the sql function ✅</h4><pre><strong>user=></strong> sd/drugs<br>#object[hugsql.core$db_fn_STAR_$y__1922 0x2af6b556 &quot;hugsql.core$db_fn_STAR_$y__1922@2af6b556&quot;]</pre><pre><strong>user=></strong> (sd/drugs db)<br>({:id 1, :name &quot;Vicodin, Norco, Xodol (hydrocodone, acetaminophen)&quot;, :availability 100, :price 14.0} {:id 3, :name &quot;Synthroid, Levoxyl, Unithroid (levothyroxine)&quot;, :availability 200, :price 11.0} {:id 4, :name &quot;Delasone, Sterapred (prednisone)&quot;, :availability 150, :price 5.0} {:id 5, :name &quot;Amoxil (amoxicillin)&quot;, :availability 200, :price 9.0} {:id 6, :name &quot;Neurontin (gabapentin)&quot;, :availability 50, :price 13.0} {:id 7, :name &quot;Prinivil, Zestril (lisinopril)&quot;, :availability 60, :price 7.0} {:id 8, :name &quot;Lipitor (atorvastatin)&quot;, :availability 78, :price 12.0} {:id 9, :name &quot;Glucophage (metformin)&quot;, :availability 180, :price 8.0} {:id 10, :name &quot;Zofran (ondansetron)&quot;, :availability 40, :price 17.0} {:id 11, :name &quot;Motrin (ibuprofen)&quot;, :availability 70, :price 12.0})</pre><p>If you find there is an issue in sql query, you can change the file, re-require it and test this function again.</p><h4><strong>Verify the handler </strong>✅</h4><pre><strong>user=></strong> d/all-drugs<br>#object[dealer_api.drugs$all_drugs 0x728c3a0e &quot;dealer_api.drugs$all_drugs@728c3a0e&quot;]</pre><pre><strong>user=></strong> (d/all-drugs {})<br>{:status 200, :headers {&quot;Content-Type&quot; &quot;application/json;charset=UTF-8&quot;}, :body #object[io.pedestal.http$print_fn$fn__16848 0x485c8d5e &quot;io.pedestal.http$print_fn$fn__16848@485c8d5e&quot;]}</pre><p>The handler seems to work correctly, and a json body with the correct status is returned.</p><blockquote>Again, if you found a problem, don’t close the REPL and restart it. Make the changes, reload the namespace and try again.</blockquote><h4>Finally test the route in the browser ✅</h4><p>When you are happy that all your functions are working, we can start the server and make a sanity check in the browser:</p><pre><strong>user=></strong> (require '[dealer-api.core :refer [go reset]])<br>nil<br><strong>user=> </strong>(go)<br>&quot;Server started on localhost:8890&quot;<br>&quot;Enter (reset) to reload.&quot;<br>:started)</pre><p>Now visit localhost:8890 and you should see the list of drugs being returned.</p><figure><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/1024/1*X1TZaQzReFaJVO9LuaoyrA.png\">Our GET /drugs route is working !</figure><h3>Part 2 — Conclusion</h3><p>In this part we:</p><ul><li>Created db and added seed data</li><li>Fixed the logging setup</li><li>Introduced configuration</li><li>Introduced a new route</li><li>Learnt how to test everything in the REPL</li></ul><p>In the next part of this series, we’ll create the remaining routes (POST, PUT, DELETE).</p><figure><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/802/1*C3tSLJCiKrndCy6083PTdA.jpeg\"></figure><blockquote>If you liked Part 1 &amp; 2 and want to stay updated, please follow me on: <a href=\"https://medium.com/@shivekkhurana\">Medium</a>, <a href=\"https://github.com/shivekkhurana\">Github</a> &amp; <a href=\"https://twitter.com/shivek_khurana\">Twitter</a></blockquote><figure><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/805/0*2HG6A0jc8rnV-ByL.png\"></figure><p>You might also like 💁🏻‍♂️</p><ul><li><a href=\"https://medium.com/@shivekkhurana/what-i-learned-after-writing-clojure-for-424-days-straight-8884ec471f8e\">What I learned after writing Clojure for 424 days, straight</a></li><li><a href=\"https://medium.com/@shivekkhurana/ethical-open-sourced-and-profitable-at-the-same-time-16c53efdfe5a\">Ethical, open sourced and profitable at the same time</a></li><li><a href=\"https://medium.com/@shivekkhurana/a-simple-ui-hack-to-improve-onboarding-ux-ocd-93ed5d77247\">A simple UI hack to improve Onboarding UX [OCD]</a></li></ul><img width=\"1\" src=\"https://medium.com/_/stat?event=post.clientViewed&referrerSource=full_rss&postId=de8c47512a71\" height=\"1\">",
   :direction "ltr"},
  :updated 1567508063000,
  :entities
  [{:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "SQL"}],
    :id "nlp/f/entity/wd:47607",
    :salienceLevel "mention",
    :label "Structured Query Language"}
   {:mentions [{:text "PostgreSQL"} {:text "Postgres"}],
    :id "nlp/f/entity/wd:192490",
    :salienceLevel "mention",
    :label "PostgreSQL"}
   {:mentions [{:text "DELETE"}],
    :id "nlp/f/entity/wd:1153781",
    :salienceLevel "mention",
    :label "DELETE"}
   {:mentions [{:text "REPL"}],
    :id "nlp/f/entity/wd:2032810",
    :salienceLevel "mention",
    :label "Read–eval–print loop"}],
  :alternate
  [{:href
    "https://medium.com/@shivekkhurana/learn-clojure-by-building-a-drug-dealer-api-part-2-de8c47512a71?source=rss-8bbc23a01e06------2",
    :type "text/html"}],
  :title "Learn Clojure By Building a Drug Dealer API — Part 2",
  :author "Shivek Khurana",
  :published-str "Tue Sep 03 03:54:23 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16cf6e2b518:2f4fa30:69b9f616",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url
   "https://cdn-images-1.medium.com/max/1024/1*4vZebt3dYv_HSlHwNGC-1A.png",
   :width 1024,
   :height 678,
   :contentType "image/png"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://medium.com/p/de8c47512a71",
  :updateCount 1,
  :commonTopics
  [{:score 75.93425126643363,
    :id "nlp/f/topic/1734",
    :salienceLevel "about",
    :label "pharma"}
   {:score 73.06188202147804,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 51.159363017836576,
    :id "nlp/f/topic/698",
    :salienceLevel "about",
    :label "drug"}
   {:score 32.843881661796864,
    :id "nlp/f/topic/3035",
    :salienceLevel "about",
    :label "chemistry"}
   {:score 0.99,
    :id "nlp/f/topic/1734",
    :salienceLevel "about",
    :label "pharma"}
   {:score 0.958,
    :id "nlp/f/topic/1735",
    :salienceLevel "about",
    :label "pharmacology"}
   {:score 0.901,
    :id "nlp/f/topic/698",
    :salienceLevel "about",
    :label "drugs"}
   {:score 0.892,
    :id "nlp/f/topic/619",
    :salienceLevel "about",
    :label "database"}
   {:score 0.761,
    :id "nlp/f/topic/2460",
    :salienceLevel "mention",
    :label "web 2.0"}],
  :published 1567508063000,
  :fingerprint "64d93c90",
  :canonicalUrl
  "https://medium.com/@shivekkhurana/learn-clojure-by-building-a-drug-dealer-api-part-2-de8c47512a71?source=rss-8bbc23a01e06------2"}
 {:engagement 4,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1567423101534,
  :content
  {:content
   "<div>\n<p><em>Issue 342 – September 02, 2019 · <a href=\"https://purelyfunctional.tv/newsletter-archives/\">Archives</a> · <a title=\"Thanks, Jeff!\" href=\"https://purelyfunctional.tv/newsletter/\">Subscribe</a></em></p>\n<h2>Clojure Tip 💡</h2>\n<p><em>learn to read Javadocs</em></p>\n<p>This tip is inspired by a list of great beginner mistakes by Jakub Holý. Last week’s was, too, but I forgot to mention him. Thanks Jakub!</p>\n<p>Clojure relies on the host language more than other languages do. There aren’t wrappers for even a lot of the common operations on basic data types. For instance, I still use a lot of the methods on String, a lot of the mathematical functions (on the <code>Math</code> class). And of course, when I’m using a Java library through interop, I’m dealing directly with classes and methods.</p>\n<p>Java’s auto-generated documentation is great. It was revolutionary at the time it came out (HTML documentation? in 1995?). It was way ahead of its time. It manages to fit a lot of dense information into a small space without feeling like you’ll get lost. The standard library is pretty well documented, as are most popular libraries. When I’m doing interop, I spend a good amount of time in the Javadocs.</p>\n<p>Read: <a title href=\"https://purelyfunctional.tv/guide/clojure-jvm/#javadocs\">Javadocs section of The Definitive guide to Clojure on the JVM</a>\nWatch: <a title href=\"https://purelyfunctional.tv/lesson/javadocs/\">Javadocs lesson of JVM Fundamentals for Clojure</a></p>\n<h2>Follow-up 🙃</h2>\n<p>Sean Corfield had even more recommendations for <code>ns</code> declarations:</p>\n<ol>\n<li>Alphabetize your requires.</li>\n<li>Use more meaningful (less cryptic) namespace aliases. Use the last segment of the namespace as alias unless</li>\n</ol>\n<ul>\n<li>It is ambiguous or uninformative (as in <code>lib4clj.core</code>). In that case, pick another segment.</li>\n<li>It is unwieldy and an obvious abbreviation is better (<code>str</code> for <code>clojure.string</code>)</li>\n</ul>\n<p>These sound like great recommendations to me!</p>\n<h2>Book status 📖</h2>\n<p>My book is selling better than I could have expected. I’m getting lots of kind words about it and some good critique. I just want to say ‘thanks’. You rock!</p>\n<p>You can find my book, <em>Grokking Simplicity</em>, <a title href=\"https://lispcast.com/gs\">here</a>. Manning is selling all ebooks for $20 on Monday, so get my book and as many others as you can.</p>\n<h2>Currently recording 🎥</h2>\n<p>Property-Based Testing (PBT) is challenging. It forces you to think. It forces you to understand your system deeply. It requires a lot of work.</p>\n<p>But that work pays off. Property-Based Testing finds bugs. In the lesson I recorded this week, we test two systems. Each system had race conditions. And we wrote tests that failed because of those race conditions.</p>\n<p>Race conditions are hard to reproduce. They only happen sometimes, so at best they create unreliable example-based tests. But with some threads and some loops, and some randomly generated input data, we manage to reliably trigger the race conditions. That’s significant.</p>\n<p>What’s more, we got very small failing cases. The failures were reliable enough to shrink the input most of the time. That’s another big win for understanding the failure.</p>\n<p>This is where Property-Based Testing clearly has benefits over example-based testing. PBT seems like overkill at first, but once mutable state is involved, it can test a system more thoroughly than examples. It can find sequences of operations that break invariants. And it can find race conditions.</p>\n<p>Check out the new lesson here: <a title href=\"https://purelyfunctional.tv/lesson/testing-parallel-systems/\">Testing parallel systems</a>. It’s almost 1.5 hours long, but it builds the tests up in understandable steps.</p>\n<h2>Brain skill 😎</h2>\n<p><em>master the basics</em></p>\n<p>Should programmers be fast typists?</p>\n<p>One answer is: Programmers don’t need to type fast because programming is not about typing. Most of the work is done in your head.</p>\n<p>Then why do programmers insist on using IDEs instead of text editors? Why do they invest in configuration and plugins? Why do they choose to memorize hundreds of keyboard shortcuts and arcane commands?</p>\n<p>I think there are two reasons. One is that since typing is <em>not</em> important, you want to get it done as quickly as possible so that the time you spend on it is proportional to the importance. In other words, if you type slowly enough, programming <em>is</em> about typing. A slow typer spends too much time and energy pressing keys. That time could be spent thinking.</p>\n<p>The other reason is that as you gain proficiency with text manipulation, you can operate closer to your thoughts. For instance, if you know paredit, you operate on s-expressions. You are performing operations much closer to the code you are trying to write than you are if you’re backspacing and typing characters. Likewise for keyboard commands that jump forward a word or a sentence. If you’re write a document, words and sentences are your bread and butter.</p>\n<p>Speed is not directly important. If you could write the code correct the first time, it wouldn’t matter if you were slower. But that’s not how it works. You type it, you test it, and then you debug it. Slow typing gums up that whole process.</p>\n<p>My opinion is that mastering the basics really matters. You want to be fast and accurate with the basic skills, such as typing, recalling the clojure.core functions and argument orders, the semantics of the common expressions, etc. These things are important because you need to get them right. But they are not the end goal, which is to be manipulating thought-stuff. So practice getting good at them to the point where they are automatic. That’s where programming begins to get interesting.</p>\n<h2>Clojure Challenge 🤔</h2>\n<h3>Last week’s challenge</h3>\n<p>The puzzle in <a title href=\"https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-341-tip-tidy-up-your-ns-form/\">Issue 341</a> was to write a function to return a lazy sequence of the permutations of a collection.</p>\n<p>You can check out the submissions <a title href=\"https://gist.github.com/ericnormand/b727329c2d066021c4b9dc81a1162815\">here</a>.</p>\n<p>This was a tough one. I’m glad we have <a title href=\"https://github.com/clojure/math.combinatorics\"><code>clojure.math.combinatorics</code></a>. I like the implementation there because it is a great example of the lift-solve-lower pattern.</p>\n<p>It turns out it’s easier to find the permutations of a sorted sequence, so lift the original problem into a sequence of indexes, permute the indexes, then lower them by mapping them back to the elements of the original sequence.</p>\n<pre><code>(let [v (vec items)]\n  (map #(map v %) (lex-permutations (range (count v)))))\n</code></pre>\n<h3>This week’s challenge</h3>\n<p><em>ajax state problem</em></p>\n<p>AJAX calls in ClojureScript go through a lifecycle. They are placed, they’re in flight, then they either succeed or fail. We often want to show this state to the user. For instance, when the ajax request is in flight, we want to show a loading spinner.</p>\n<p>Create a representation of the state of a value that can be fetched via ajax. I suggest using the <a title href=\"https://purelyfunctional.tv/guide/clojure-collections/#variant-entity\">variant entity</a> or the <a title href=\"https://purelyfunctional.tv/guide/clojure-collections/#variant-tuple\">variant tuple</a>. It may help to draw out the sequence diagram of an ajax request to capture all the states it may be in. Be sure to define the operations on this representation which transition it from one state to the next.</p>\n<p>If you want some inspiration, Kris Jenkins has a neat post about <a title href=\"http://blog.jenkster.com/2016/06/how-elm-slays-a-ui-antipattern.html\">modeling remote data</a>. I’ve also written up two ways of approaching ajax state <a title href=\"https://purelyfunctional.tv/guide/optimistic-update-in-re-frame/\">here</a>.</p>\n<p>As usual, please send me your implementations. I’ll share them all in next week’s issue. If you send me one, but you don’t want me to share it publicly, please let me know.</p>\n<p>Rock on!\nEric Normand</p>\n</div>\n<p>The post <a rel=\"nofollow\" href=\"https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-342-tip-learn-to-read-javadocs/\">PurelyFunctional.tv Newsletter 342: Tip: learn to read Javadocs</a> appeared first on <a rel=\"nofollow\" href=\"https://purelyfunctional.tv\">PurelyFunctional.tv</a>.</p>",
   :direction "ltr"},
  :updated 1567418400000,
  :entities
  [{:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "AJAX"}],
    :id "nlp/f/entity/wd:134471",
    :salienceLevel "mention",
    :label "Asynchronous JavaScript and XML"}
   {:mentions [{:text "HTML"}],
    :id "nlp/f/entity/wd:8811",
    :salienceLevel "mention",
    :label "HyperText Markup Language"}
   {:mentions [{:text "Java"}],
    :id "nlp/f/entity/wd:251",
    :salienceLevel "mention",
    :label "Java"}
   {:mentions [{:text "JVM"}],
    :id "nlp/f/entity/wd:193321",
    :salienceLevel "mention",
    :label "Java Virtual Machine"}],
  :alternate
  [{:href
    "https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-342-tip-learn-to-read-javadocs/",
    :type "text/html"}],
  :title
  "PurelyFunctional.tv Newsletter 342: Tip: learn to read Javadocs",
  :author "Eric Normand",
  :published-str "Mon Sep 02 03:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16cf1b27a5e:2a7704d:97b0c8f7",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://purelyfunctional.tv/?p=31970",
  :commonTopics
  [{:score 62.0044550915433,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.944,
    :id "nlp/f/topic/575",
    :salienceLevel "about",
    :label "crm"}
   {:score 0.897,
    :id "nlp/f/topic/294",
    :salienceLevel "about",
    :label "bodybuilding"}
   {:score 0.886,
    :id "nlp/f/topic/874",
    :salienceLevel "about",
    :label "fitness"}
   {:score 0.853,
    :id "nlp/f/topic/774",
    :salienceLevel "about",
    :label "engineering"}],
  :published 1567418400000,
  :fingerprint "dd37e917",
  :canonicalUrl
  "https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-342-tip-learn-to-read-javadocs/"}
 {:engagement 4,
  :unread false,
  :crawled 1567406563870,
  :recrawled 1567417906335,
  :content
  {:content
   "<p>Total functions are functions that give you a valid return value for every combination of valid arguments. They never throw errors and they don’t require checks of the return value. Total functions help you write more robust code and simpler code, free from defensive checks and errors.</p>\n<p></p>\n<h2>Transcript</h2>\n<p>Eric Normand: What is a total function? By the end of this episode, you will know how this idea helps you write more robust systems.</p>\n<p>Hi, my name is Eric Normand and I help people thrive with functional programming.</p>\n<p>This is another important idea for math that we can borrow in our programs. It’s used often in functional programming. We’re not talking about totals functions. We’re talking about mathematical, pure functions. These are calculations, they don’t have side effects.</p>\n<p>However, it does apply to actions, to side effects, if you want. You can take this concept, it’s a flexible idea, and apply it to those things. We’ll just be talking about it for pure functions, mathematical functions, in this episode.</p>\n<p>All right, so let’s get started. What is a total function? Quite simply, a total function has an answer for every combination of valid arguments.</p>\n<p>That kind of asks a new question — what is a valid argument? We’re going to say that in type languages it is very clear. If you’ve got static-type…</p>\n<p>Eric: …arguments to a function are all values that belong to the argument types.</p>\n<p>If it says int — whatever that means, in whatever language you use — then every possible int, if it’s an int, then it’s a valid argument to that function. If it say string, that means every possible string. Any way you can make a string, then that’s a valid argument.</p>\n<p>For untyped languages, it’s a little bit more complicated. Usually when we’re programming in untyped languages, the types are in our heads, and we have some unwritten, implicit, informal idea of what we mean as valid arguments.</p>\n<p>That’s what I mean, these informal rules about what are the valid arguments. That’s what you’ve got in an untyped language.</p>\n<p>If you can make them more explicit, if you can have some kind of checking on your arguments, some kind of preconditions, contracts, some kind of assertions, whatever you want to put in there to claim this is what’s valid, all those things will be helpful for making this more useful.</p>\n<p>That said, I myself, for my own code, when it’s just me, I kind of know what the valid arguments are. I tend not to use too many assertions and things. Sometimes, I do. They’re helpful sometimes. I just want to put that out there. We’ll discuss this a little bit more, later in the episode. It’s a hairy discussion.</p>\n<p>Total function has an opposite. Just to clarify again, just to repeat, for every valid argument. If it says it takes ints, I can pass any int and get an answer. That’s a total function. The opposite is a partial function. Maybe one of those ints doesn’t work.</p>\n<p>A classic example is division. They type of division, let’s say, it takes two numbers and returns a number. Divides the two numbers and then returns a number, but you can’t divide by zero, so it throws an error or it does something. Returns some infinity, or not a number, or something like that. Returns nil, null, whatever.</p>\n<p>All those things are kind of like the function line. The function said I take two integers and I return an integer, but it didn’t. It returned something else or threw an exception. It didn’t even return. It broke when you passed a zero for the second argument, for the…</p>\n<p>Eric: We can see how this creates problems. First of all, robustness. If you have a divide by zero error in your program, it’s going to fail in production and it’s not going to be as robust. It’s is not correct.</p>\n<p>If you do want to make it correct, what do you do? You put an if statement before you divide, just to check. That makes more conditionals.</p>\n<p>This is what the type system is supposed to be handling for us. We don’t want them check that the arguments are valid. We want to just run division, and we want the compiler to find these problems. This is in a typed language.</p>\n<p>Another example of people doing this — I see this occasionally and it really bugs me, because I really try to do total functions as much as possible — let’s say you have a person class, and there are two subclasses. There’s employee, and there’s volunteer. Employees get a salary. Volunteers don’t.</p>\n<p>On person, there is a method called salary. That means you can call salary on employees and volunteers. When you call salary on employee, it gives you a number. It’s like $10,000 a year or whatever. Then on volunteer, it throws an exception. The message says something like, “Volunteers don’t get paid.” That’s the friendly error message.</p>\n<p>To make this total, you would need the salary method to return a number in every single possible case, instead of throwing an exception. That means that the volunteers’ salary should return zero. That’s the mathematical definition. I know there might be some reason why you didn’t return zero there.</p>\n<p>You threw an exception, because you’re probably doing something wrong somewhere else in your code, and you want to signal, “Hey, we’re trying to get the salary of some volunteer. That’s probably an error.” That means like, “We don’t know if they’re a volunteer or an employee. We’ve lost track.”</p>\n<p>You know what? I think that you’re modeling it wrong. If only employees have a salary, the salary method shouldn’t be on person, it should be on employee and have your compiler check that.</p>\n<p>What a subclass is supposed to mean is that you can forget what the subclass is. You just care about the main class that it’s all subclassing from, the superclass.</p>\n<p>If you don’t know that it’s a volunteer, that’s supposed to be OK. Just saying that this is an issue that can come up, even in something like an object-oriented model, where you have different methods that you think should be called. Maybe it’s an indication that your method is in the wrong place.</p>\n<p>That’s one way to handle it, is to change the definition of what valid means for the arguments like we did with this person. It’s not valid to call salary on just any person. It has to be an employee.</p>\n<p>Another way that you can handle this is just make sure that you handle all the cases. Make volunteers’ salary method return zero. That’s it, just make it happen. Don’t use nils and exceptions. Find a value that makes sense.</p>\n<p>Zero happens to work in this case because their salary actually is zero. Sometimes, people will return a null instead of an empty array when there’s no answers.</p>\n<p>It normally returns an array of something, an array of answers. If there’s no answer, it returns null. Why don’t you return the empty array? In that case, that’s still correct. Now, that function is total, and it works in a wider range of cases.</p>\n<p>You don’t have to check the return value. You can call length on it and know that there’s zero things in there. Likewise, you can replace all those exceptions, trying to find some value that works within the already assigned return type.</p>\n<p>That’s not always possible. Sometimes, you’re going to have to augment the return type. I guess that’s number three — augment the return type. What does this mean? You could make the empty case explicit. Change your type so that it has an empty case.</p>\n<p>This is in an untyped language where you’re dynamically typed. You’re a lot more flexible. Make nil explicitly accepted. I do that in Clojure. I say it’s either a number or a nil. This is what numbers mean, and this is what nil means.</p>\n<p>I don’t want to overload nil with too much meaning. In this specific case, this specific type that I’m returning, number means this. Nil means this. I don’t do that all the time, but sometimes I do.</p>\n<p>Now, if I’m returning something like a variant, a tagged union, I might add a case to that variant. That’s like no answer. You could use a maybe or option type, instead of using null. If you’re going to throw an exception, change the return value to a Maybe Int.</p>\n<p>If you had division, you could make division total by saying, “Division doesn’t return a number. Division returns a maybe number.” If you could pass zero in for the denominator, I’m going to return nothing. You’re going to have to check that.</p>\n<p>Optionally, if there’s errors and things, you can make those part of the type. In Haskell, you would use an either, but somehow fold the errors into it. The way I imagine this is if you have a HTTP client, usually you can have it configured where it never throws an exception if the HTTP request doesn’t go through. You can have it actually return the error as a response.</p>\n<p>If the client got in touch with the server and the server had an error like a 404 or a 500, that is a valid response. It’s an error, but it’s a valid response. The error modes have been baked into the response type. There’s codes, status messages, and things like that.</p>\n<p>Even some clients — the good ones — will turn a time-out, which means they don’t even talk to the server sometimes. It’ll turn those into the same kind of error type.</p>\n<p>The status 700, which isn’t a real HTTP type of status type, but we’ll call it status 700 time-out. Something like that. Then you can handle that in the same way with the same kinds of logic as you would handle even a valid response, a correct response.</p>\n<p>The last way to handle these partial functions and make them total is to augment the argument type. In our case of division, instead of saying it takes two integers or two numbers and returns a number, we say it takes a number and a number that’s not zero. That’s a type — number that’s not zero — and it returns a number.</p>\n<p>Now, we have to make this new type called number that’s not zero. Somehow, somewhere else, we will make one of those. When we make it, we check to make sure it’s not zero.</p>\n<p>Now, this function knows that it trusts this type. It’s not going to be zero. It can unbox it and divide. It would call whatever internal division that’s unsafe partial function inside.</p>\n<p>Here’s a warning. These last two things where you’re augmenting the return type and augmenting argument type, they still need to check somewhere. They’re just deferring the if statements. Before, you were doing unsafe division. You weren’t checking if it’s zero. You’re going to have to catch that error.</p>\n<p>That’s like a conditional. Somewhere it’s like, “Oh, if it throws an error, do this. Otherwise, you get an answer, do this.” It’s a branch. You have a branch. Now, if you turn it into a maybe — the return value becomes a maybe number — you still have to branch. You still have to say, “Is it a nothing or is it a just number?” You still have to do that branch.</p>\n<p>It’s not reducing the complexity, really. It’s deferring it somewhere else. You still have all these other ways of dealing with maybe. For example, it’s a functor. It’s a monad. You can use it in other ways. It fits in with what you’re doing elsewhere in a nice way maybe. It’s a little bit better.</p>\n<p>Likewise, if you augment the argument type, you still have to make one of these things somewhere else. You probably don’t have one when you need it. You have a number, and you need to make a number that’s not zero, however how you make one of those things.</p>\n<p>When you make one of those, something’s got to check if it’s zero. What if it’s zero? It’s going to return a nothing. There’s a maybe on the other side, too. You still have the branch. It’s still in there. It’s just now you have the type system on your side.</p>\n<p>You can push all these if statements out to the edges. That’s the metaphor that people like to use — that there’s edges. When input comes in, the user types something in, check it for all these things — the zeros, etc.</p>\n<p>Now, in the happy path where it’s not zero and you pass it through, there’s no checks. It’s all good. When it comes out, you got an answer. You’re pushing it to the edges. All the way, as close as possible to where the user input comes in or to where the user output goes out. Those are called the edges.</p>\n<p>You’re deferring it, pushing it out, so you’re able to create a space in the middle where your functions are all total, where everybody’s happy. Where you don’t have to check things before you call methods on them. You don’t have to worry about error cases, etc.</p>\n<p>Of course, this is a design decision. It is up to you to decide how far you want to push stuff to the edges. Whether it’s worth it in particular cases, etc. A lot of people push it really far to the extreme.</p>\n<p>Some people don’t mind checking if a number is zero right before they divide. Some people don’t even check and they just let it throw there, and say, “Well, we’re just going to have errors.” That’s fine. It depends on your software and what you need to do with it.</p>\n<p>I do want to come back to this idea that types do help with totality. I’m going to use Haskell as an example. Haskell has several built-in functions that are partial. I talked about division. It is partial in the base Haskell language. Also, head, which gives you the first element of a list. If the list is empty, that throws an error. That’s partial, this is the built-in function called head.</p>\n<p>In general, Haskellers, they either look at that as a mistake or a wart on the language because they want total functions. They might rewrite head to turn it into like it returns a maybe. Something like that. They might call it maybe head or something like that.</p>\n<p>Type systems do help in a number of ways.</p>\n<p>One is they give you this way of defining what is valid so that the compiler checks it. We talked about how difficult it was in a dynamically typed language to even talk about what valid arguments means. Type system gives a definition of what a valid argument is.</p>\n<p>It also will, in many cases, be able to check whether you’ve handled every case. If you have what’s called a tagged union, or a variant, or you have multiple cases, different constructors for the same type, there’s a flag you can set on the compiler that says, “Make it an error if I don’t handle one of those cases.”</p>\n<p>That’s the compiler being on your side, helping you make total functions.</p>\n<p>Types can help with these total functions. The language can help as well, for instance in Haskell. Another design decision of the Haskell has nothing to do with the type system, but there’s no null pointers in Haskell. That’s really nice.</p>\n<p>Null pointers were a mistake. [laughs] The inventor of null pointers admitted this. They didn’t make the same mistake in Haskell. They learned from that, so there’s no null pointers.</p>\n<p>Nulls, especially in languages like JavaScript or Java where you have a type system…Like in Java you have a type system, but you can always put a null basically anywhere. The type system won’t help you with that at all. That sucks.</p>\n<p>As far as dynamically-typed languages go, I do want to say that this is one of those sore spots in dynamic languages where there’s one way to look at it, which is that every function accepts any kind of argument.</p>\n<p>It’s true. [laughs] In a certain way of looking at it, I can go into my Clojure REPL and type plus, string and null. It will try to add them and it’ll say, “Ah, these aren’t numbers. Bleh.”</p>\n<p>It’s true. I could run it. I did run it. I got an exception, so in some way every function is partial because you can always find some value of some type that wasn’t expected that will throw an exception. It’s true.</p>\n<p>Except, that most…This is the same of object-oriented languages that are dynamic, you can send any message. There’s no checks on what messages you’re allowed to send. Very often, you’ll get something…in JavaScript, you get undefined is not a function because it couldn’t find that method in the object. Or you’ll get method not found or whatever it’s called in your language.</p>\n<p>That’s another ding where it says, “You can pass any message to anything.” Everything’s partial. Every method is partial because you can find some object that doesn’t answer that message. Yes.</p>\n<p>But there’s another way to look at it which is that there is an intended type for every argument. Sometimes that type is really complicated, and sometimes it’s not specified. Sometimes, it is not explicit, but there is an intended type for every argument.</p>\n<p>Does that mean that they’re all total? No, not saying that either. It’s a lot more total [laughs] than with the other perspective. These are things we’re used to dealing with in dynamic programming, dynamic-type languages. We’re used to thinking the compiler’s not going to help me. I got to remember the types.</p>\n<p>Well, that’s all I want to say. That is the extent that we have a good definition of valid in dynamically typed languages. There is an intended type. It doesn’t mean it works everything.</p>\n<p>For instance, I think in JavaScript, in Clojure, divide still takes two arguments, two numbers that still the intended type, and it sometimes is an error. It’s still undefined for divide by zero. It’s just the way it is. It’s the same in Haskell.</p>\n<p>Yeah, all right. Let me recap. It’s been total functions. It’s very useful for robustness if your functions are total. You have to do fewer checks. You’re not going to get the errors.</p>\n<p>If you’re using only total functions, no errors, none. It’s not possible. Maybe you get something else. Something like out of memory or stack overflow, something like that, but you’re not going to get error because you chose the wrong arguments.</p>\n<p>Total means you have an answer for every combination of valid arguments. The opposite is a partial function. Usually it means it throws an exception, or it returns null or nil, or some other error thing it does.</p>\n<p>Why? It gives you robustness. It also improves your simplicity. You just have fewer conditionals within your center, inside the edges. A lot of times you’re just pushing conditionals to the edge, but inside you’ve got this nice total, no errors, no conditionals. Everything works right inside.</p>\n<p>I went over four ways that you can increase the totality of your function. The first one was that you could just move stuff around because things are on the wrong types, or classes, or you just designed it poorly, not using the constraints of the language properly.</p>\n<p>The second one was sometimes you just mistakenly forget to handle a case. You thought it should be an exception, but really, within the stated type or the intended type, there is a valid response for that. Salary on a volunteer should be zero or it shouldn’t even be on there.</p>\n<p>The third one is you can augment the return type. If it turns out that there isn’t a good response, you’ve got to change the type. You’ve got to make it a maybe. Maybe you can add cases to your type so that you’re explicitly calling out the empty cases.</p>\n<p>You could fold the error conditions, the failure modes, into the type, just like HTTP does. It uses the same response format for 200 responses as it does for 400 responses. Still got headers, still got a status code, still got a body. It’s all the same.</p>\n<p>The fourth one is to augment the argument type. You could say this is a number that’s not zero. It’s somehow somewhere else you’re making sure that those are getting created correctly, but this function doesn’t have to worry about that and that’s nice.</p>\n<p>When you do this, you can push these conditionals, checks, and things out to the edges. If you’re checking stuff from the arguments it’s going closer to user input and you’re pushing the return type checks further out into where it’s getting output.</p>\n<p>If you enjoyed this episode, if you learned something, there are a lot of other episodes. You can find all the past ones at lispcast.com/podcast. All the past episodes have audio, video, and text transcripts. Whatever medium you’re into, we’ve got it.</p>\n<p>You’ll find links to subscribe, including the video, the RSS for the text, also the RSS or iTunes link for the podcast audio. You can also find social media links at that same address lispcast.com/podcast.</p>\n<p>Please get in touch. I love discussing this stuff with people that’s why I’m doing it, broadcasting, trying to find people who I can relate to out there. It’s a lonely world. Got to find people that like the same stuff you like, have a lot in common.</p>\n<p>My name is Eric Normand. This has been my thought on functional programming. Thank you for listening and rock on.</p>\n<p>The post <a rel=\"nofollow\" href=\"https://lispcast.com/what-is-a-total-function/\">What is a total function?</a> appeared first on <a rel=\"nofollow\" href=\"https://lispcast.com\">LispCast</a>.</p>",
   :direction "ltr"},
  :updated 1567404000000,
  :entities
  [{:mentions [{:text "Haskell"}],
    :id "nlp/f/entity/wd:34010",
    :salienceLevel "mention",
    :label "Haskell"}
   {:mentions [{:text "partial function"}],
    :id "nlp/f/entity/wd:1756942",
    :salienceLevel "mention",
    :label "partial function"}
   {:mentions [{:text "functional programming"}],
    :id "nlp/f/entity/wd:193076",
    :salienceLevel "mention",
    :label "functional programming"}
   {:mentions [{:text "superclass"} {:text "subclass"}],
    :id "nlp/f/entity/wd:212542",
    :salienceLevel "mention",
    :label "inheritance"}
   {:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}],
  :alternate
  [{:href "https://lispcast.com/what-is-a-total-function/",
    :type "text/html"}],
  :title "What is a total function?",
  :author "Eric Normand",
  :published-str "Sun Sep 01 23:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16cf0b6221e:27a9e94:69b9f616",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url
   "https://lispcast.com/wp-content/uploads/2019/08/What-is-a-continuation_.jpg",
   :width 1280,
   :height 720,
   :contentType "image/jpeg"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://lispcast.com/?p=2003",
  :updateCount 1,
  :commonTopics
  [{:score 67.79907196076334,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.721,
    :id "nlp/f/topic/2357",
    :salienceLevel "mention",
    :label "typography"}],
  :published 1567404000000,
  :fingerprint "7e2cc063",
  :canonicalUrl "https://lispcast.com/what-is-a-total-function/"}
 {:engagement 4,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1567190664019,
  :content
  {:content
   "<p>Each week, we answer a different question about Clojure and functional programming.</p>\n<p>If you have a question you’d like us to discuss, tweet <a href=\"https://twitter.com/clojuredesign\">@clojuredesign</a>, send an email to <a href=\"mailto:feedback@clojuredesign.club\">feedback@clojuredesign.club</a>, or join the <code>#clojuredesign-podcast</code> channel on the <a href=\"http://clojurians.net/\">Clojurians Slack</a>.</p>\n<p>This week, the question is: <strong>“What’s so different about Clojure’s REPL?”</strong> We evaluate what a REPL really is and show that it’s much more about the developer experience than simply calculating values.</p>\n<p>Selected quotes:</p>\n<ul>\n<li>“The Clojure REPL is your window into the state of a running application.”</li>\n<li>“It’s a much larger, broader kind of experience.”</li>\n<li>“It’s funny to have mutable programs and immutable data, but that’s what Clojure gives you.”</li>\n<li>“The fact that the REPL can read expressions and run them becomes one of it’s least interesting attributes.”</li>\n</ul>\n<p>Related episodes</p>\n<ul>\n<li><a href=\"https://clojuredesign.club/episode/012-embrace-the-repl\">012: Embrace the REPL</a></li>\n<li><a href=\"https://clojuredesign.club/episode/013-connect-the-repl\">013: Connect the REPL</a></li>\n<li><a href=\"https://clojuredesign.club/episode/014-fiddle-with-the-repl\">014: Fiddle with the REPL</a></li>\n</ul>",
   :direction "ltr"},
  :updated 1567177200000,
  :entities
  [{:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "about",
    :label "Clojure"}
   {:mentions [{:text "REPL"}],
    :id "nlp/f/entity/wd:2032810",
    :salienceLevel "about",
    :label "Read–eval–print loop"}
   {:mentions [{:text "functional programming"}],
    :id "nlp/f/entity/wd:193076",
    :salienceLevel "mention",
    :label "functional programming"}],
  :alternate
  [{:href
    "https://clojuredesign.club/episode/044-whats-so-different-about-clojures-repl/",
    :type "text/html"}],
  :title "Ep 044: What's So Different About Clojure's REPL?",
  :author "Christoph Neumann and Nate Jones",
  :published-str "Fri Aug 30 08:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16ce3d7c353:1b733bd:69b9f616",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://clojuredesign.club/episode/044-whats-so-different-about-clojures-repl/",
  :commonTopics
  [{:score 52.574009014312516,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.994,
    :id "nlp/f/topic/349",
    :salienceLevel "about",
    :label "business"}],
  :published 1567177200000,
  :fingerprint "32aad3da",
  :canonicalUrl
  "https://clojuredesign.club/episode/044-whats-so-different-about-clojures-repl/"}
 {:engagement 7,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/todo",
    :label "todo"}
   {:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1567155664643,
  :recrawled 1567177481224,
  :content
  {:content
   "<p>This is somewhat of a response to Uncle Bob’s <a href=\"http://blog.cleancoder.com/uncle-bob/2019/08/22/WhyClojure.html\">post of similar nature</a>, which I would say has gotten a mixed to positive reception. I had planned a similar post a week or two before the release of his, but archived the idea upon reading his post. But after having read it over a couple of times I have now decided that I still have something meaningful to write. What follows are the purely subjective reasons for which <em>I</em> enjoy using Clojure. Some have criticised Bob for being very absolute and not giving up any screen estate for more nuanced viewpoints, something I will try to avoid.</p>\n<h2>Lisp</h2>\n<p>There is not much to say about this that has not already been said. The homoiconicity, meaning code can be represented as a data structure inside the same language, extensibility through macros which can modify both the evaluation order as well as the very syntax to the point where <a href=\"https://docs.racket-lang.org/scribble/getting-started.html\">it looks more like LaTeX than Lisp</a>.<span><label for=\"sn-1\"></label><span>Racket is actually a great example of the flexibility of Lisp. A language designed to build other languages in it, call it a meta-language. Even package import can be wrapped up in a “language” trivially, meaning that you can essentially write a tiny DSL for every project. Not saying that is necessarily a good idea, but you can.<br>\n<br>\n</span></span></p>\n<p>This also means that you are not stuck with a paradigm. While OO seems to be out, and FP the new hotness, Lisp can do them all, and historically often did before anyone else. Bob mentions dynamic typing in his signature retorts to (I am guessing) fictional counter-arguments, and he is right to mention <a href=\"https://clojure.org/guides/spec\"><code>clojure.spec</code></a>, a library for gradual typing (omitting <a href=\"https://github.com/plumatic/schema\"><code>schema</code></a>, an alternative). Racket has a <a href=\"https://docs.racket-lang.org/ts-guide/quick.html\">fully typed variant</a>, there is something that is basically <a href=\"https://shen-language.github.io\">Haskell in a Lisp-bun</a>, and let us not forget that there is actually <a href=\"https://github.com/clojure/core.typed\">Typed Clojure</a>, with static type checking and all.<span><label for=\"sn-2\"></label><span>There are some issues with it, namely that the coverage is not all that great, but it exists and works, meaning if you really <em>need</em> static types, you can get them.<br>\n<br>\n</span></span></p>\n<p>Being able to generate code without being stuck on a “dumb” level by generating strings and passing them into <code>eval</code> like for example in Python allows for sane hyper-dynamic programming, where the program adapts itself to the conditions. Being able to read and write code in a safe manner enables extremely powerful tooling in the Lisp world. Linters are very smart, because <a href=\"https://github.com/xsc/rewrite-clj\">reading code into a data structure is trivial</a>, usually a one-liner, and there are many more tools to automatically rewrite and refactor code than for other languages.</p>\n<p>Now I do not want to discount the <a href=\"http://winestockwebdesign.com/Essays/Lisp_Curse.html\">Lisp Curse</a>, it is a real thing, and one of the reasons that while Lisp has stuck around for over half a century, it has not made it into the mainstream. The other main factor probably being the performance problems due to the gap between software and hardware architecture.<span><label for=\"sn-3\"></label><span>There were Lisp machines, which had hardware tailored towards running Lisp, but they never took off either.<br>\n<br>\n</span></span> But with the advent of the internet, ecosystems like GitHub, and hardware that is fast enough that we consider running basically full web browsers for half of our applications<span><label for=\"sn-4\"></label><span>Looking at you, Slack.<br>\n<br>\n</span></span>, I think that these issues have become surmountable.</p>\n<p>I do not think I need to mention how incredibly useful the REPL and hot-loading code into a running system are?</p>\n<h2>Hosted</h2>\n<p>Clojure is explicitly designed as a hosted language, which I think was a very good move. If you are writing a new language today, it might be better than the established ones, but the cost of leaving an existing ecosystem of libraries and Stack Overflow answers just because the new language is 5% nicer is not a trade off many people will want to make. Clojure being hosted and having excellent interoperability with its host platform means it can benefit from existing ecosystem, let alone platform implementations.<span><label for=\"sn-5\"></label><span>Do you really want to implement your runtime for FreeBSD on a smart toaster oven? Raspberry Pis are non x86, BSD is not Linux, and who knows what is up with Windows. This matrix is growing quickly.<br>\n<br>\n</span></span></p>\n<p>While the primary platform is the JVM, superbly uncool but stable and relatively performant, there is a CLR (.NET) version which is “almost even on features” thanks to Davit Miller, as well as a very mature JavaScript version in the shape of ClojureScript. The JVM (and to some extent the CLR) have excellent support by big software vendors, if you buy some kind of software with an API, chances are there is a Java SDK which you can use easily from your Clojure code. The JavaScript ecosystem is the largest in numbers<span><label for=\"sn-6\"></label><span>In part due to left-pad-like five-line-packages, but still.<br>\n<br>\n</span></span>, and includes Electron and React-Native, both of which can be used with some, but not unreasonable, effort from ClojureScript code. One of the newest additions has been GraalVM, which while not 100% feature-complete yet, already allows compilation to native static binaries of many Clojure programs<span><label for=\"sn-7\"></label><span><a href=\"https://github.com/kkinnear/zprint\">Zprint</a> is one of those CLI tools that takes advantage of the reduced startup time.<br>\n<br>\n</span></span>, running without the JVM at all, and doing away with the dreaded multi-second startup time.<span><label for=\"sn-8\"></label><span>I am planning to write a piece about GraalVM some time later this year.<br>\n<br>\n</span></span></p>\n<p>The platform split could have been one of the big, curse-like problems for Clojure, but there is Clojure Common, used by many popular libraries, which allows you to write platform-independent code by using conditional branching for all platform-specific code.</p>\n<h2>Community</h2>\n<p>Despite all the positive points I mentioned, Clojure is still a niche language, and in some way that is good as well. Sure, finding jobs is harder<span><label for=\"sn-9\"></label><span>Large companies like Walmart and CircleCI (my employer) are Clojure shops, so it is far less obscure than one might think.<br>\n<br>\n</span></span>, but not impossible. Clojure developers, like for example Haskell or Rust ones, tend to be more experienced, as it is not a typical first language, and requires a certain interest in the craft. Many Clojure developers have written widely used tools and libraries, not just in Clojure, but also for example for Emacs, which is understandably quite popular with Clojurists.</p>\n<p>Rich Hickey himself, the BDFL of Clojure, is someone with decades of industry experience and a desire to get it right. I think he is doing a pretty good job. While there are some small inconsistencies in places, the bulk of the language, and all the important parts are very well thought out.<span><label for=\"sn-10\"></label><span>We can also see right now how <code>clojure.spec</code> is being adapted after community feedback to the first alpha version, which has been available for about 1½ years.<br>\n<br>\n</span></span> Clojure is a very stable language, which means that smaller problems will stick around for a while, but also means you can trust that your code will not break every time you update your dependencies.</p>\n<p>In the end, it comes down to enjoyment. I enjoy working with Clojure. I feel like there is a lot to learn, and the language is inviting me to explore beyond the current possibilities of software development. I feel good about the elegant and concise solutions<span><label for=\"sn-11\"></label><span>concise ≠ obtuse<br>\n<br>\n</span></span> I can come up with. It has changed the way I think, in a good way.</p>",
   :direction "ltr"},
  :updated 1567123200000,
  :entities
  [{:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "about",
    :label "Clojure"}
   {:mentions [{:text "Lisp"}],
    :id "nlp/f/entity/wd:132874",
    :salienceLevel "mention",
    :label "Lisp"}
   {:mentions [{:text "Bob's"} {:text "Bob"}],
    :id "nlp/f/entity/wd:1392113",
    :salienceLevel "mention",
    :label "Bob's"}
   {:mentions [{:text "data structure"}],
    :id "nlp/f/entity/wd:175263",
    :salienceLevel "mention",
    :label "data structure"}
   {:mentions [{:text "Haskell"}],
    :id "nlp/f/entity/wd:34010",
    :salienceLevel "mention",
    :label "Haskell"}],
  :alternate
  [{:href
    "https://sulami.github.io/posts/why-i-like-clojure/index.html",
    :type "text/html"}],
  :title "Why I like Clojure",
  :author "Robin Schroer",
  :published-str "Thu Aug 29 17:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16ce1c1b703:18def84:97b0c8f7",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://sulami.github.io/posts/why-i-like-clojure/index.html",
  :updateCount 2,
  :commonTopics
  [{:score 104.32301858108868,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.957,
    :id "nlp/f/topic/1555",
    :salienceLevel "about",
    :label "net"}
   {:score 0.907,
    :id "nlp/f/topic/1291",
    :salienceLevel "about",
    :label "languages"}
   {:score 0.869,
    :id "nlp/f/topic/334",
    :salienceLevel "about",
    :label "browsers"}
   {:score 0.854,
    :id "nlp/f/topic/2010",
    :salienceLevel "about",
    :label "scalability"}],
  :published 1567123200000,
  :fingerprint "c59cf74c",
  :canonicalUrl
  "https://sulami.github.io/posts/why-i-like-clojure/index.html"}
 {:engagement 5,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1567073311666,
  :content
  {:content
   "<p>All the posts so far..</p>\n<ul>\n<li><a href=\"http://codeofrob.com/entries/introducing-pinto-and-stetson---opinionated-purescript-bindings-to-otp-and-cowboy.html\">Introduction to Pinto/Stetson - Opinionated Bindings to OTP/Cowboy</a></li>\n<li><a href=\"http://codeofrob.com/entries/the-structure-of-an-end-to-end-purescript-otp-project.html\">The structure of an end-to-end purescript OTP project</a></li>\n<li><a href=\"http://codeofrob.com/entries/building-on-top-of-otp-with-purescript-with-pinto.html\">Building on top of OTP with Purescript with Pinto</a></li>\n<li><a href=\"http://codeofrob.com/entries/building-a-purescript-web-server-with-stetson-and-pinto.html\">Building a Purescript web server with Stetson and Pinto</a></li>\n<li><a href=\"http://codeofrob.com/entries/shared-code-twixt-purescript-server-and-client.html\">Shared code twixt Purescript server and client</a></li>\n</ul>\n<p>Useful links</p>\n<ul>\n<li><a href=\"https://github.com/id3as/demo-ps\">demo-ps</a> The demo codebase we're talking about here</li>\n<li><a href=\"https://github.com/id3as/purescript-erl-pinto\">erl-pinto</a> (the opinionated bindings to OTP we're using)</li>\n<li><a href=\"https://github.com/id3as/purescript-erl-stetson\">erl-stetson</a> (the opinionated bindings to Cowboy we're using)</li>\n</ul>\n<p>We've handwaved over the contents of the <a href=\"https://github.com/id3as/demo-ps/blob/master/server/src/Native/Redis.purs\">Redis</a> module so far in the demo app, showing only that we can use it from our <a href=\"https://github.com/id3as/demo-ps/blob/master/server/src/BookLibrary.purs\">BookLibrary.purs</a> like any other module as follows.</p>\n<pre><code>\n<span>update</span> :: <span>Book</span> -> <span>Effect</span> (<span>Either</span> <span>String</span> <span>Book</span>)\n<span>update</span> book =\n  <span>Gen</span>.doCall serverName \\state@{ connection } -> <span>do</span>\n    <span>Redis</span>.put (dbId book.isbn) book connection\n    pure $ <span>CallReply</span> (<span>Right</span> book) state\n</code></pre>\n<p>That's pretty tidy, so let's look at the type of that function so we understand the Purescript side of things first and foremost</p>\n<pre><code>\n<span>put</span> :: <span>forall</span> a. <span>WriteForeign</span> a => <span>DbId</span> -> a -> <span>RedisConnection</span> -> <span>Effect</span> <span>Unit</span>\n</code></pre>\n<p>For any type 'a' that implements WriteForeign, we're a function that takes a DbId, an A and a RedisConnection to produce an Effect of type Unit - this pretty much makes sense on the surface, DbId is just a newtype around String, and given a Key and a Value (which we can get from calling writeJSON on our type 'a'), we can dump stuff in Redis - but how?</p>\n<p>Let's take a step back a moment and approach this from the <em>other</em> end.</p>\n<p>There is an application for accessing Redis in Erlang, called <a href=\"https://github.com/wooga/eredis\">eredis</a> imaginatively enough, the usage of which looks a little like this.</p>\n<pre><code>\n   { ok, C } = eredis:start_link(ConnectionString),\n\n   eredis:q(C, [ &lt;&lt;<span>&quot;SET&quot;</span>>>, &lt;&lt;<span>&quot;key&quot;</span>>>, &lt;&lt;<span>&quot;value&quot;</span>>> ]).\n</code></pre>\n<p>So what we want to do is surface this meaningfully to Purescript is define some foreign imports in our <em>Redis.purs</em>, which map onto their native counterparts in our <em>Redis.erl.</em></p>\n<pre><code>\n<span>foreign</span> <span>import</span> data <span>ConnectionString</span> :: <span>Type</span>\n<span>foreign</span> <span>import</span> data <span>RedisConnection</span> :: <span>Type</span>\n<span>foreign</span> <span>import</span> open :: <span>ConnectionString</span> -> <span>Effect</span> <span>RedisConnection</span>\n</code></pre>\n<p>By importing a foreign type, we're saying to Purescript &quot;Hey, this thing exists in Erlang but we don't know what is inside it, but we want to model it as something we can pass around thanks&quot;, the ConnectionString comes from sys.config and the RedisConnection is actually a Pid but we don't need to know that.</p>\n<p>By importing a foreign function, we're saying that there is a function in Erlang with this name and signature and we'd like to call it from Purescript. The &quot;open&quot; function we're importing from Erlang takes one of those ConnectionStrings and produces an Effect of type RedisConnection.</p>\n<pre><code>\n<span><span>open</span><span>(ConnectionString)</span> -></span>\n  <span>fun</span>() ->\n      { ok, C } = eredis:start_link(ConnectionString),\n      C\n  <span>end</span>.\n</code></pre>\n<p>We wrap our actual functionality in a function, because that's how an Effect is modelled in Purerl, and we can return our 'Connection' as an opaque type to Purescript when this Effect is processed. I've made the decision here to match directly on <em>{ ok, C }</em> which means we'll crash at runtime if we can't open a connection - an alternative API could look like this.</p>\n<pre><code>\n<span><span>open_</span><span>(ConnectionString, Just, Nothing)</span> -></span>\n  <span>fun</span>() ->\n      { ok, C } = <span>case</span> eredis:start_link(ConnectionString) <span>of</span>\n                    { ok, C } -> Just(C);\n                    _ -> Nothing\n                    <span>end</span>\n  <span>end</span>.\n</code></pre>\n<p>where</p>\n<pre><code>\n<span>foreign</span> <span>import</span> open_ :: <span>ConnectionString</span> -> (<span>RedisConnection</span> -> <span>Maybe</span> <span>RedisConnection</span>) -> <span>Maybe</span> <span>RedisConnection</span>  -> <span>Effect</span> (<span>Maybe</span> <span>RedisConnection</span>)\n\n<span>open</span> :: <span>ConnectionString</span> -> <span>Effect</span> <span>RedisConnection</span>\n<span>open</span> connectionString = open_ connectionString <span>Just</span> <span>Nothing</span>\n</code></pre>\n<p>I've chosen to &quot;let it crash&quot;, as that fits with how I'd build the supervsion tree in Erlang around this (Restart periodically every 30s until the connection works please), but either approach is valid and not one I have strong opinions on at this time. (an Either with the failure reason would also be an option).</p>\n<p>Anyway, going back to that <em>put</em> function with all of this in mind, we want to keep the Erlang pretty minimal, so some transformation on the Purescript side will be required. </p>\n<pre><code>\n<span>foreign</span> <span>import</span> put_ :: <span>DbId</span> -> <span>String</span> -> <span>RedisConnection</span> -> <span>Effect</span> <span>Unit</span>\n\n<span>put</span> :: <span>forall</span> a. <span>WriteForeign</span> a => <span>DbId</span> -> a -> <span>RedisConnection</span> -> <span>Effect</span> <span>Unit</span>\n<span>put</span> id obj conn =\n  put_ id (writeJSON obj) conn\n</code></pre>\n<p>Purescript knows how to turn our obj into JSON so we'll do that there, and then use a foreign function that takes just the primitive objects for use within Erlang with eredis.</p>\n<pre><code>\n<span>-define</span><span>(SET(Key, Value)</span>, [ &lt;&lt;&quot;SET&quot;>>, Key, Value ]).\n\n<span><span>put_</span><span>(Id, Data, Pid)</span> -></span>\n  <span>fun</span>() ->\n      { ok, &lt;&lt;<span>&quot;OK&quot;</span>>>} = eredis:q(Pid, ?SET(Id, Data)),\n      ok\n  <span>end</span>.\n</code></pre>\n<p>Now, this is not necessarily how we should approach building an FFI for a native library, as we're making some decisions in Erlang that could be made in Purescript, a more traditional FFI would look like this.</p>\n<pre><code>\n<span><span>q</span><span>(Pid, Operation)</span> -></span>\n  eredis:q(Pid, Operation).\n</code></pre>\n<pre><code>\n<span>foreign</span> <span>import</span> q :: <span>RedisConnection</span> -> <span>List</span> <span>String</span> -> <span>Effect</span> (<span>Tuple2</span> <span>Atom</span> <span>Binary</span>)\n</code></pre>\n<p>And then we could build the API we <em>actually</em> want on top of <em>that</em> instead - I've rather skipped that step in my demo for clarity, but if I was producing a library wrapper for publication that's probably the approach I'd take, as unwieldy as it is to actually use it means we end up writing more Purescript and less Erlang.</p>\n<p>This is the approach that erl-cowboy and Stetson took, whereas erl-pinto takes the direct approach to &quot;desired API&quot;, making the concession that it'll be easier to build without 1-1 FFI in existence. Either way, it's pretty easy to call into existing code in Erlang.</p>\n<h1>Next up</h1>\n<p>We've pretty much covered the surface area of the demo project, so I'll be going off on a little journey talking about some of the common things that we like to do in Erlang and how to get that behaviour into Purerl, if I get any questions about these posts I'll follow up with answers in blog format also.</p>",
   :direction "ltr"},
  :updated 1567071000000,
  :entities
  [{:mentions [{:text "Erlang"}],
    :id "nlp/f/entity/wd:334879",
    :salienceLevel "about",
    :label "Erlang"}
   {:mentions [{:text "Redis"}],
    :id "nlp/f/entity/wd:2136322",
    :salienceLevel "mention",
    :label "Redis"}
   {:mentions [{:text "Data"}],
    :id "nlp/f/entity/wd:22983",
    :salienceLevel "mention",
    :label "Data"}
   {:mentions [{:text "web server"}],
    :id "nlp/f/entity/wd:11288",
    :salienceLevel "mention",
    :label "web server"}
   {:mentions [{:text "API"}],
    :id "nlp/f/entity/wd:165194",
    :salienceLevel "mention",
    :label "application programming interface"}],
  :alternate
  [{:href
    "http://codeofrob.com/entries/purescript-interop-with-native-erlang---interacting-with-redis.html",
    :type "text/html"}],
  :title
  "Purescript interop with native Erlang - Interacting with Redis",
  :author "Rob Ashton",
  :published-str "Thu Aug 29 02:30:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16cdcd91bb2:11a8d6d:69b9f616",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "http://codeofrob.com/entries/purescript-interop-with-native-erlang---interacting-with-redis.html",
  :commonTopics
  [{:score 32.928009470909885,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1567071000000,
  :fingerprint "a9125cc3",
  :canonicalUrl
  "http://codeofrob.com/entries/purescript-interop-with-native-erlang---interacting-with-redis.html"}
 {:engagement 5,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1567062718932,
  :recrawled 1567084181951,
  :content
  {:content
   "<p>Continuations are a cool feature you often find in functional languages. In this episode, we look at what they are, why you’re probably already using them, and the cool things you can do with them.</p>\n<p></p>\n<h2>Transcript</h2>\n<p>Eric Normand: What is a continuation? By the end of this episode, we will have gone over this concept. You will understand it. You will see why you’re likely already using continuations, even if you don’t know it yet, and what you can do with continuations.</p>\n<p>Hello, my name is Eric Normand, and I help people thrive with Functional Programming.</p>\n<p>Continuations became important in scheme. They were used as part of the compiler as a…continuations were used as a compiler implementation technique. We will go over a little bit how that’s done.</p>\n<p>What is a continuation? That is the main part of this episode. Continuations have to do with how functions are called and then returned.</p>\n<p>Imagine a typical scenario — you have Function A which does some work, calls Function B, and then does some more work with the return value from B. When Function A calls B, what actually has to happen?</p>\n<p>You’re passing control to another function, you’re going to push onto the stack a new stack frame and record in that stack frame where to return to. After you do a jump, a go-to, to run that function, where does the return statement take you back?</p>\n<p>You have to write that down as a pointer, just write it down. You also have to write down all the arguments into the stack. Then, when you jump to the Function B, it knows where to look up the arguments and then it also knows where to return when it’s done.</p>\n<p>That’s how the function calls work and the stack works. Notice we pushed this pointer onto the stack along with the arguments, but what if we made it an argument? What if we made that pointer an argument, instead of something to check when you are about to return?</p>\n<p>Instead of a pointer, what if we made it into a function that you could call? Basically, you do x equals b, and then you have some more code. You’re saving the return value of b. I said b, and I did parentheses with my fingers. It’s x equals call b, so b().</p>\n<p>You have the return value of b stored in x. After b returns, it’s going to get saved to x, and then you’re going to do some more stuff. What if you made a function that was just that, some more stuff? Also, assigns that stuff to x, the return value to x.</p>\n<p>This is a function you’ve packaged up. Instead of a pointer to jump there, you just make it into a function. You pass that to b. Now, b, instead of calling return, could just call the function that’s an argument.</p>\n<p>In Scheme, it’s called k. It’s the continuation. Just imagine you add an argument to your function b. It’s called k. Then at the end of the function, when it’s done, it calls k. That does the continuation of what a was doing.</p>\n<p>Now, typically, when you return, you’re returning a value. That value is useful. To get that value that’s returned from b, you make it an argument to k. k is a function of one argument, and b will just call that with whatever value it would have returned.</p>\n<p>Now, imagine you did this with every function. Every function, you added an argument called k — that was the continuation — and it was one argument. Instead of having a return statement, you just called k. Of course, because it’s a return statement, it’s the last thing your function will ever do before it’s over.</p>\n<p>That means that it’s always in tail position. We talked about that in a previous episode. There’s a tail call removal, where, if you’re in tail position, meaning it’s the last call, the last call of a function call of the function — a function that’s made out of other function calls — The last function call before you return, that’s called the tail position.</p>\n<p>Because you’ve threaded this k through every function call — this is a different k each time — you’ve turned your program inside-out and nested it to the right, instead of going straight down, every function call is in tail position.</p>\n<p>Which means that every function call can be optimized into a go-to, and you never have to return. You don’t have to return, because there’s no return statements used anymore. They’re just always calling k, the next thing, the next thing, and the next thing.</p>\n<p>You don’t need a stack anymore, because the stack’s main job is to keep track of where to go back, how to return. You’re not returning, so you don’t need a stack. You need one frame to store the current arguments.</p>\n<p>You just thread that k through there, and you have this style of programming is called continuation passing style. Now, this is not a pleasant style to write code in, but your compiler can turn your straight-line, imperative, “Do this, do this, do this, call that,” nested function calls, you can do all that.</p>\n<p>Turn that into continuation passing style, and then it has this really nice property, that you don’t need a stack. It has other properties. For instance, because it’s a function, and functions are first-class, you can save it somewhere. Just know about that. We’ll talk about it in a second.</p>\n<p>I don’t know if this rings a bell to you, but if you’re a JavaScript programmer, you’re often calling a function that has a callback. That callback is going to get called with the result of that asynchronous function.</p>\n<p>If you do Ajax, the response to your Ajax request is going to get passed to a function sometime in the future. What typically happens is you have, “This Ajax needs this callback, and then that callback makes another Ajax request, and so it has another callback. That one makes another one, and it has another callback…”</p>\n<p>You have this deeply-nested callback chain. That is just continuation passing style. It’s one of the reasons why I say that JavaScript is one of the best things to happen to functional programming in a long time.</p>\n<p>People are doing continuation passing style without even knowing it. They just picked it up, because they had to. This thing that was this arcane, functional programming style idea from compiler theory is now a thing [laughs] that people are writing their code in.</p>\n<p>They know it’s not very ergonomic. It forces you to break up your program to the right, so you’re deeply nested. It’s hard to coordinate things. It’d be much better to write it straight up and down, but they’re learning it.</p>\n<p>They understand its limitations. They understand how to sequence things by calling the next continuation, the next continuation. Just as an aside, the new stuff in JavaScript called async/await. I say new, relatively new.</p>\n<p>It lets you write straight-line code, but you put await in there in front of something that would be asynchronous, and it just waits. It looks like it waits. Really, internally, the compiler is turning that into a continuation passing style, or in the JavaScript world, called a callback chain style. I don’t know what they call it. It’s callbacks in JavaScript.</p>\n<p>It looks straight up and down, straight line, like, “I can do this. Then I do this step, then I do this step, and I wait for this step. Then I do this step. I wait for this step.” Putting those awaits in there, it’ll get turned into continuation passing style. It’s an ergonomics issue. It doesn’t really add any functionality, but it’s a really nice bit of ergonomics.</p>\n<p>All right, back to the main thing. What are these useful for? Oh, that’s what I said in the beginning, like why you might be using them already. If you’re doing JavaScript, you’re already doing continuations. What are these useful for?</p>\n<p>Notice, we’ve gotten rid of the stack. That’s nice. We don’t have this problem of stack overflow anymore. The Scheme folks, the people who invented Scheme, published a lot of papers about how the function call, before Scheme, was actually a very heavyweight thing.</p>\n<p>You wouldn’t want little, bitty functions, because it would eat into your performance. You’d make big functions, with 20, 30 lines of code in them. You do a whole bunch of stuff in them. Then, just for convenience, for programmer convenience, you’d have another function you would call that would do this common routine.</p>\n<p>You wouldn’t treat them like, they were too heavyweight to say, “I’m just naming this one operation with a new name, and I’ll wrap it in a new function.” It was too heavyweight for that. What they showed was that function calls are very lightweight.</p>\n<p>That, especially if you do this continuation passing style, you can make it just like go-to. You don’t even need to return anymore. You’re just passing a few arguments on the stack, the same stack frame you had before, and you’re doing a jump.</p>\n<p>You don’t even have to remember where you were, although you do. It’s part of the Clojure of the continuation, if you’re curious. Because it’s a function, that was function was built in a certain environment. It has certain state.</p>\n<p>Anyway, it just showed that function calls could be super, super efficient, just about as efficient as a go-to. You could use them wherever you wanted, and they were a good compiler technique. What can you do with them, besides make nice compilers?</p>\n<p>One thing is, just like in the JavaScript world when you have callbacks, is you can add asynchrony in there. I could, instead of calling k, my function could put k on a queue to be called later. That’s what JavaScript does.</p>\n<p>It’s not done directly. There’s some other, like the networking engine, if you’re doing Ajax. The Ajax happens, and it gets put on a queue when it’s done as an event. There’s an event loop. There’s a lot of machinery there.</p>\n<p>In essence, what you’re doing is you’re putting the continuation onto the queue. Because things are round robin, and they’re taking turns, you’re able to share a processor between multiple timelines, even though there’s only really one thread.</p>\n<p>These are often called co-routines. Another thing that you can do with continuations is the same kind of stuff you might do with stack manipulation in function calls. For instance, you could implement exceptions.</p>\n<p>You could have exception handling, where the continuation is wrapped in something that will do a finally or do a catch on an exception being thrown. Then it’s going to continue after the try-catch block was finished.</p>\n<p>Anything that you would do, typically think would require a language-level implementation, if you’ve got access to those continuations, you can do a lot of stuff. That’s how Scheme manages to do so much language-level stuff, but in the language itself.</p>\n<p>All right, so, let’s recap. Continuations are a way of representing the rest of the calculation. After I return from this function, what else do I need to do? They are wrapped up in a function, and the argument is the return value of the thing that you’re calling.</p>\n<p>There’s a style called continuation passing style, where you replace all return values with calls to the continuation, to the next continuation. If you do this, you don’t need a stack. The stack is implicit in those function calls.</p>\n<p>You can also use continuations as a means of inserting some indirection. Instead of actually calling the continuation, you could put the continuation onto a queue. You could hand it to something that monitors it or something, makes sure it succeeds, it completes correctly. Maybe it’ll retry it, something like that.</p>\n<p>Anything you can do with a function, boom, now, you’ve got that continuation as a function. You can implement exception handling, things like that.</p>\n<p>All right, so, if you found this episode useful, you can find all the past episodes at lispcast.com/podcast. There, you’ll find audio, video, and text versions of all of the past episodes. You’ll also find links to subscribe to the podcast, and also find me on social media.</p>\n<p>Social being the keyword. I’ve got email, Twitter, LinkedIn. I love to get into discussions with people, so please reach out. This has been my thought on functional programming. My name is Eric Normand. Thank you for listening, and rock on.</p>\n<p>The post <a rel=\"nofollow\" href=\"https://lispcast.com/what-is-a-continuation/\">What is a continuation?</a> appeared first on <a rel=\"nofollow\" href=\"https://lispcast.com\">LispCast</a>.</p>",
   :direction "ltr"},
  :updated 1567058400000,
  :entities
  [{:mentions [{:text "Scheme"}],
    :id "nlp/f/entity/wd:187560",
    :salienceLevel "mention",
    :label "Scheme"}
   {:mentions [{:text "JavaScript"}],
    :id "nlp/f/entity/wd:2005",
    :salienceLevel "mention",
    :label "JavaScript"}
   {:mentions [{:text "functional programming"}],
    :id "nlp/f/entity/wd:193076",
    :salienceLevel "mention",
    :label "functional programming"}
   {:mentions [{:text "Ajax"}],
    :id "nlp/f/entity/wd:134471",
    :salienceLevel "mention",
    :label "Asynchronous JavaScript and XML"}
   {:mentions [{:text "ergonomics"}],
    :id "nlp/f/entity/wd:1750812",
    :salienceLevel "mention",
    :label "ergonomics"}],
  :alternate
  [{:href "https://lispcast.com/what-is-a-continuation/",
    :type "text/html"}],
  :title "What is a continuation?",
  :author "Eric Normand",
  :published-str "Wed Aug 28 23:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16cdc3779d4:110eecc:97b0c8f7",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url
   "https://lispcast.com/wp-content/uploads/2018/07/ERIC-NORMAND-LISPCAST.COM_.jpg",
   :width 513,
   :height 557,
   :contentType "image/jpeg"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://lispcast.com/?p=2000",
  :updateCount 1,
  :commonTopics
  [{:score 57.50964439165084,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.951,
    :id "nlp/f/topic/1871",
    :salienceLevel "about",
    :label "quant"}
   {:score 0.814,
    :id "nlp/f/topic/2461",
    :salienceLevel "mention",
    :label "web design"}],
  :published 1567058400000,
  :fingerprint "eb46349d",
  :canonicalUrl "https://lispcast.com/what-is-a-continuation/"}
 {:engagement 9,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1566900185453,
  :content
  {:content
   "<p>All the posts so far..</p>\n<ul>\n<li><a href=\"http://codeofrob.com/entries/introducing-pinto-and-stetson---opinionated-purescript-bindings-to-otp-and-cowboy.html\">Introduction to Pinto/Stetson - Opinionated Bindings to OTP/Cowboy</a></li>\n<li><a href=\"http://codeofrob.com/entries/the-structure-of-an-end-to-end-purescript-otp-project.html\">The structure of an end-to-end purescript OTP project</a></li>\n<li><a href=\"http://codeofrob.com/entries/building-on-top-of-otp-with-purescript-with-pinto.html\">Building on top of OTP with Purescript with Pinto</a></li>\n<li><a href=\"http://codeofrob.com/entries/building-a-purescript-web-server-with-stetson-and-pinto.html\">Building a Purescript web server with Stetson and Pinto</a></li>\n</ul>\n<p>Useful links</p>\n<ul>\n<li><a href=\"https://github.com/id3as/demo-ps\">demo-ps</a> The demo codebase we're talking about here</li>\n<li><a href=\"https://github.com/id3as/purescript-erl-pinto\">erl-pinto</a> (the opinionated bindings to OTP we're using)</li>\n<li><a href=\"https://github.com/id3as/purescript-erl-stetson\">erl-stetson</a> (the opinionated bindings to Cowboy we're using)</li>\n</ul>\n<p>We've got a basic model representing our 'book'</p>\n<pre><code>\n<span>module</span> Books <span>where</span>\n\n<span><span>type</span> <span>Book</span> = { <span>isbn</span> :: <span>String</span>\n, <span>title</span> :: <span>String</span>\n, <span>author</span> :: <span>String</span>\n}</span>\n</code></pre>\n<p>Which is pretty terribly exciting - the key thing to note here is that this is a plain ol' record containing primitive types - this makes it pretty shareable as far as view models go (Let's ignore that we're using it for persistence here, demo code gonna demo code).</p>\n<p>We've shoved Books.purs into a folder called 'shared' which has been softlinked from both the client and server directories, which means it will be separately compiled into JS And Purescript respectively.</p>\n<p>There is a great library over in Purescript world called <a href=\"https://github.com/justinwoo/purescript-simple-json\">simple-json</a> which defines a <em>ReadForeign</em> and <em>WriteForeign</em> for these basic types, which means that the functions readJSON and writeJSON will do the back and forth between JSON and the Purescript types.</p>\n<p>There is also (thanks to the efforts of <a href=\"https://github.com/purerl/purescript-simple-json\">@nwolverson</a>, a port of this library exists on the Purerl side of things which works in exactly the same way, using <a href=\"https://github.com/talentdeficit/jsx\">JSX</a> under the hood. This is a fairly common pattern across the Purerl world, and you'll see when browsing the org repos that a lot of the code from the JS Purescript world has been ported across with minimal changes so that the two worlds look as alike as possible.</p>\n<p>So, in the previous post we loaded a list of Books out of our genserver in Cowboy and simply called writeJSON on it.</p>\n<pre><code>\n<span># Rest.contentTypesProvided (\\req state -> Rest.result (jsonWriter : nil) req state)</span>\n\n<span>jsonWriter</span> :: <span>forall</span> a. <span>WriteForeign</span> a => <span>Tuple2</span> <span>String</span> (<span>Req</span> -> a -> (<span>Effect</span> (<span>RestResult</span> <span>String</span> a)))\n<span>jsonWriter</span> = tuple2 <span>&quot;application/json&quot;</span> (\\req state -> <span>Rest</span>.result (writeJSON state) req state)\n</code></pre>\n<p>If we open up the client code, we can see</p>\n<pre><code>\n<span>maybeBook</span> &lt;- <span>H</span>.liftAff $ loadItem $ <span>&quot;/api/books/&quot;</span> &lt;> isbn\n\n<span>-- where</span>\n\n<span>loadItem</span> :: <span>forall</span> a. <span>ReadForeign</span> a => <span>String</span> -> <span>Aff</span> (<span>Either</span> <span>String</span> a)\n<span>loadItem</span> uri = <span>do</span>\n  response &lt;- <span>AX</span>.get <span>AXResponse</span>.string uri\n  <span>case</span> response.body <span>of</span>\n     <span>Left</span> err -> pure $ <span>Left</span> <span>&quot;No&quot;</span>\n     <span>Right</span> json -> pure $ bimap show identity $ readJSON json\n</code></pre>\n<p>That is all that is required to shift data between the server Purescript and the client Purescript which is pretty tidy indeed! Because we're using the same library, any custom implementations of <em>ReadForeign</em> and <em>WriteForeign</em> we might choose to write can then also be shared between the two.</p>\n<p>Obviously sharing code between both client and server is something that should be entered into with caution, typically sharing a lot of business logic is the sign of a problem - but I can easily see us ending up in a world where we can start using Halogen on the server-side to pre-render HTML for serving to the client much in the same way that the ReactJS community have started doing similar with NodeJS.</p>\n<h1>Next up</h1>\n<p>We'll look at our bindings to Redis, to get a feel for what interop with &quot;native&quot; Erlang with FFI looks like.</p>",
   :direction "ltr"},
  :updated 1566898200000,
  :entities
  [{:mentions [{:text "server"} {:text "server-side"}],
    :id "nlp/f/entity/wd:44127",
    :salienceLevel "about",
    :label "server"}
   {:mentions [{:text "books"} {:text "book"}],
    :id "nlp/f/entity/wd:571",
    :salienceLevel "mention",
    :label "book"}
   {:mentions [{:text "JSON"}],
    :id "nlp/f/entity/wd:2063",
    :salienceLevel "mention",
    :label "JavaScript Object Notation"}
   {:mentions [{:text "web server"}],
    :id "nlp/f/entity/wd:11288",
    :salienceLevel "mention",
    :label "web server"}
   {:mentions [{:text "HTML"}],
    :id "nlp/f/entity/wd:8811",
    :salienceLevel "mention",
    :label "HyperText Markup Language"}],
  :alternate
  [{:href
    "http://codeofrob.com/entries/shared-code-twixt-purescript-server-and-client.html",
    :type "text/html"}],
  :title "Shared code twixt Purescript server and client",
  :author "Rob Ashton",
  :published-str "Tue Aug 27 02:30:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16cd287696d:3bf121:97b0c8f7",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "http://codeofrob.com/entries/shared-code-twixt-purescript-server-and-client.html",
  :commonTopics
  [{:score 44.68554873300606,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.709,
    :id "nlp/f/topic/630",
    :salienceLevel "mention",
    :label "deep learning"}],
  :published 1566898200000,
  :fingerprint "824b4524",
  :canonicalUrl
  "http://codeofrob.com/entries/shared-code-twixt-purescript-server-and-client.html"}
 {:engagement 21,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/todo",
    :label "todo"}
   {:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1566895019506,
  :content
  {:content
   "<figure><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/1024/1*ZigE5BeEaXIfx2_FnP4UWg.png\">Base Photo by <a href=\"https://unsplash.com/@joseantoniogall?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText\">Jose Antonio Gallego Vázquez</a> on <a href=\"https://unsplash.com/?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText\">Unsplash</a></figure><p>Over the last 2 years, Clojure has become my primary language. It compiles to Java &amp; JavaScript and has a <a href=\"https://medium.com/@shivekkhurana/what-i-learned-after-writing-clojure-for-424-days-straight-8884ec471f8e\">few other advantages that I learnt over time</a>.</p><p>One of the disadvantage was the steep upfront learning curve. If you are just getting started with Clojure, this (and a series of future posts) might help you.</p><p>For today, we’ll be building a Drug Dealer API. Imagine a drug store near you ( don’t let the word dealer delude you):</p><ul><li>it has an inventory</li><li>each drug has a price and a stock</li><li>drugs are sold on a retail window and</li><li>are procured via offline sources</li></ul><p>This article assumes that you are comfortable developing APIs in some other language.</p><p>Jargon terms are used without explanation. If you have ever developed and API with Node, Spring, Java, Python, RoR or literally any other framework/language, you are good to go.</p><figure><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/128/1*kT1mZwyxUce_RQ4vfu3sCw.png\"><em>The source for this project is available at </em><a href=\"https://github.com/krimlabs/workshops\"><em>https://github.com/krimlabs/clojure-workshop</em></a><em>.</em></figure><p>For this exercise, our back-end consists of a database, configuration, a router and controllers. Clojure community doesn’t promote the idea of ORMs (for good).</p><figure><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/1024/1*MvUpZZztcp4kYWtr70IHew.jpeg\"></figure><p>There are a few batteries included frameworks like <a href=\"http://www.luminusweb.net/\">Luminous</a>, <a href=\"https://fulcro.fulcrologic.com/docs.html\">Fulcro</a>, <a href=\"http://docs.arachne-framework.org/\">Archane</a>, <a href=\"https://github.com/duct-framework/duct\">Duct</a> and <a href=\"https://github.com/juxt/edge\">Edge</a>. You should definitely check all of them out and pick the one you like, but for the purpose of this tutorial, we’ll use Pedestal for handling HTTP and HugSQL to interact with an SQLite Database.</p><p>This stack is simple to get started with and enough to grow into a production ready system.</p><h4>Install java and Clojure</h4><p>Clojure’s official website has a nice guide, <a href=\"https://clojure.org/guides/getting_started\">https://clojure.org/guides/getting_started</a></p><h4>Setup project structure</h4><p>Clojure has 3 build systems: Leiningen, Boot and deps.edn. Deps is the built in implementation, Lein and Boot are third-party libraries.</p><p>You can think of them as node’s package.json. They help you specify dependencies and tasks.</p><p><strong>Create a folder to hold the API</strong></p><pre>cd ~/where/ever/you/keep/your/stuff<br>mkdir dealer_api</pre><p><strong>Create deps.edn, resources and src folders</strong></p><ul><li>deps.edn will help with dependency management</li><li>resources folder holds static resources (images, sql files, config)</li><li>src folder, well you know what’s that for</li></ul><pre>cd dealer_api<br>touch deps.edn<br>mkdir -p src/dealer_api<br>mkdir resources</pre><p>You might wonder why I created a src/dealer_api folder. It’s just a convention in Clojure namespaces.</p><p><strong>Add dependencies to deps.edn</strong></p><p>An edn file is like a json file, except it has support for more data types than strings, and you type in Clojure maps and not JavaScript objects. Here’s what our deps.edn file should look like.</p><pre>{:paths [&quot;src&quot;]<br> :deps<br> {io.pedestal/pedestal.service {:mvn/version &quot;0.5.7&quot;}<br>  io.pedestal/pedestal.jetty {:mvn/version &quot;0.5.7&quot;}<br>  com.layerware/hugsql {:mvn/version &quot;0.4.9&quot;}<br>  org.clojure/tools.namespace {:mvn/version &quot;0.2.11&quot;}<br>  org.clojure/tools.logging {:mvn/version &quot;0.3.1&quot;}<br>  ch.qos.logback/logback-classic {:mvn/version &quot;1.1.3&quot;}}<br> :mvn/repos<br> {&quot;central&quot; {:url &quot;<a href=\"https://repo1.maven.org/maven2/\">https://repo1.maven.org/maven2/</a>&quot;}<br>  &quot;clojars&quot; {:url &quot;<a href=\"https://clojars.org/repo\">https://clojars.org/repo</a>&quot;}}}</pre><ul><li>The :paths config is telling Clojure where to look for source code. The colon indicates it’s a keyword.</li><li>Unlike JSON, Clojure maps don’t need a comma or semi-colon</li><li>:deps key tells which dependencies to fetch</li><li>We are adding Maven versions to each dependancy, i.e. fetching Java libs. Truth be told, Clojure is just Java (and ClojureScript is just JavaScript).</li><li>:mvn/repos configures where we should be looking for the required deps. You can add private repos here. You can also pull deps directly from github.</li><li>More info on deps.edn at <a href=\"https://clojure.org/reference/deps_and_cli\">https://clojure.org/reference/deps_and_cli</a></li><li>pedestal.service and pedestal.jetty are used for routing and as a server. Hugsql helps convert sql files to Clojure functions. Other 3 dependencies help with logging and reloading code.</li></ul><p><strong>Check your progress by downloading dependencies</strong></p><p>In the root folder, issue the clj command. This will download all the required dependencies and start a prompt called REPL.</p><p>If you have ever played GTA Vice City, then think of REPL as a cheat code, that most other languages do not have. Your terminal should look something as follows:</p><pre><strong>$ clj</strong><br><em>Downloading: io/pedestal/pedestal.jetty/0.5.7/pedestal.jetty-0.5.7.pom from https://clojars.org/repo/<br>...<br>...<br>Downloading: org/eclipse/jetty/jetty-alpn-server/9.4.18.v20190429/jetty-alpn-server-9.4.18.v20190429.jar from https://repo1.maven.org/maven2/<br>Clojure 1.9.0<br>user=></em></pre><h4>Setup your editor</h4><blockquote>LISPs are notoriously hard to write.</blockquote><blockquote>— Every Noob Ever</blockquote><p>Clojure (and other LISPS) have a different syntax from most mainstream languages. sum(1, 2) becomes (sum 1 2) . The bracket is moved outside the function, leading your code to be just a collection of vectors (aka a tree). Now this is hard to write, because as your programs grow, bracket matching can become a pain.</p><p>That’s where <a href=\"https://www.emacswiki.org/emacs/ParEdit\">Paredit</a> and <a href=\"http://shaunlebron.github.io/parinfer/\">Parinfer</a> come into picture. The purpose of these tools is to match your brackets for you. Automagically.</p><p>Parinfer is like an Apple’s iPhone. Everything will work seamlessly out of the box. Paredit is like a flagship Android phone. You’ll have to spend some time getting used to it.</p><p>I’d recommend using Parinfer when you are getting started, or Paredit if you are brave. I started with Paredit, not because I’m brave, but because:</p><ul><li>I didn’t know Parinfer existed</li><li>I was comfortable with Paredit, when I discovered Parinfer, and couldn’t go back</li></ul><p>Parinfer is available for atom, vscode and probably all the other text editors that cool kids use. You can also use Cursive Mode for IntelliJ. I don’t know much about that, so will not refer to Cursive specific steps going further.</p><h4>Create your first route</h4><p>In the src/dealer_api directory, create a file called core.clj.</p><pre>;; src/dealer_api/core.clj</pre><pre>(<strong>ns</strong> dealer-api.core<br>  (:require [io.pedestal.http :as http]))</pre><pre>(<strong>defn</strong> respond-hello [request]<br>  {:status 200<br>   :body &quot;Hello World&quot;})</pre><pre>(<strong>def</strong> routes<br>  #{[&quot;/hello&quot; :get `respond-hello]})</pre><pre>(<strong>defn</strong> server []<br>  (-> {::http/routes routes<br>       ::http/port 8890<br>       ::http/type :jetty}<br>      http/create-server<br>      http/start))</pre><ul><li>ns stands for namespace</li><li>defn is a function that can be used to define a new function, the last form in the defn vector is the return value of the function (in this case a map).</li><li>respond-hello is a function that takes a request and returns a 200 OK</li><li>def is a function to define immutable variables</li><li>-> is the thread first macro. It helps with readability of deeply nested functions. The above function server can also be written without thread first macro as:</li></ul><pre>(defn server [] <br>  (http/start (http/create-server {::http/routes routes<br>                                   ::http/port 8890<br>                                   ::http/type :jetty})))</pre><ul><li>Words with a colon prefix (ex :jetty)are called keywords, they are like Ruby’s keywords</li><li>Words with double colon prefix are (ex: ::http/routes) are namespaced keywords, i.e. are automatically appended with the namespace. In this case ::http/routes is same as :dealer-api.core.http/routes.</li></ul><h4>Run the REPL (and your app)</h4><p>We have enough code for our server to start working. Go to the project’s root and start the repl using clj command:</p><pre>$ clj</pre><p>If everything works, you should be in a prompt called a REPL. Here you can import your namespace and start the server :</p><pre>user=> (require '[dealer-api.core :as core])<br><strong>nil<br></strong>user=> (core/start)</pre><p>If your code is correct, core/start function will freeze the REPL. At this point, you can go to <a href=\"http://localhost:8890/hello\">http://localhost:8890/hello</a> and your should see what you expect to see.</p><h4>Fix your DX</h4><p>If you make a change to your API, you would not notice any change in the browser. Also, the REPL doesn’t give any indication that the server is running successfully. Let’s fix that.</p><p><strong>Create an atom to hold your running server instance</strong></p><p>Clojure data structures are immutable. They never change. Except using a special structure called atom. Our strategy to not freeze the REPL is to save the running instance of the server in an atom and return from the start function.</p><p>We will get rid of the server function and require the refresh function:</p><pre>(<strong>ns</strong> dealer-api.core<br>  (<strong>:require</strong> [io.pedestal.http :as http]<br>            [clojure.tools.namespace.repl :refer [refresh]]))</pre><p>We’ll also create a reset function that can be called to reload changes:</p><pre>(<strong>def</strong> service-map<br>  {::http/routes routes<br>   ::http/type   :jetty<br>   ::http/port   8890})</pre><pre>;; For interactive development<br>(<strong>defonce</strong> server (atom nil))</pre><pre>(<strong>defn</strong> go []<br>  (reset! server<br>          (http/start (http/create-server<br>                       (assoc service-map<br>                              ::http/join? false))))<br>  (prn &quot;Server started on localhost:8890&quot;)<br>  (prn &quot;Enter (reset) to reload.&quot;)<br>  :started)</pre><pre>(<strong>defn</strong> halt []<br>  (http/stop <a href=\"http://twitter.com/server\">@server</a>))</pre><pre>(<strong>defn</strong> reset []<br>  (halt)<br>  (refresh :after 'dealer-api.core/go))</pre><h4>Test new DX</h4><p>Now close the repl using Ctrl+C. This is probably the last time you’ll shut it down. Now start it again using $ clj.</p><p>Next import the required functions: go and reset</p><pre>$ clj<br>Clojure 1.9.0<br>user=> <strong>(require '[dealer-api.core :refer [go reset]])</strong><br>nil<br>user=> <strong>(go)<br></strong>;; You'll see a ton of logs followed by</pre><pre><strong>&quot;Server started on localhost:8890&quot;<br>&quot;Enter (reset) to reload.&quot;<br>:started</strong></pre><p>Now go back to localhost:8890/hello and you should see your message. Change your message and reset the code as follows:</p><pre>user=> <strong>(go)<br></strong>;; You'll see a ton of logs followed by</pre><pre>&quot;Server started on localhost:8890&quot;<br>&quot;Enter (reset) to reload.&quot;<br>:started<strong><br></strong>user=> <strong>(reset)</strong></pre><p>Again, go back to the browser, refresh and you’ll see the new changes.</p><p>This DX is workable going forward. A REPL is always working in the background. You make changes and reset. What we did here is not ideal. Most production projects tend to have a dedicated namespace for handling resets, but then again, this is not a prod project. This is only a get-your-feet-wet project.</p><h4>Hmm, why did I have to do so much to get reset ?</h4><p><em>Also it doesn’t have live reload like node does.</em></p><p>You have a valid point. Watch <a href=\"https://www.infoq.com/presentations/Simple-Made-Easy/\">Simple Made Easy</a> by Rich Hickey and probably you’ll be able to satiate your curiosity.</p><h4>Part 1, Conclusion</h4><ul><li>We setup our editor to write LISP using Paredit or Parinfer</li><li>We wrote and EDN file, the json equivalent in the Clojure world</li><li>We setup a simple project using deps.edn</li><li>We setup a simple API using Pedestal</li><li>Saw how we can reload code using a REPL using clj command line</li></ul><p>In the next part, we’ll introduce a database and make a more realistic API.</p><figure><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/30/0*azCSuo5J0CWyaETt\"></figure><figure><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/802/1*C3tSLJCiKrndCy6083PTdA.jpeg\"></figure><blockquote><em>If you liked Part 1 &amp; want to stay updated, please follow me on: </em><a href=\"https://medium.com/@shivekkhurana\"><em>Medium</em></a><em>, </em><a href=\"https://github.com/shivekkhurana\"><em>Github</em></a><em> &amp; </em><a href=\"https://twitter.com/shivek_khurana\"><em>Twitter</em></a></blockquote><figure><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/805/1*IXzRtvecjteLH3XNKexi3A.png\"></figure><p>You may also like:</p><ul><li><a href=\"https://medium.com/@shivekkhurana/what-i-learned-after-writing-clojure-for-424-days-straight-8884ec471f8e\">What I learned after writing Clojure for 424 days, straight</a></li><li><a href=\"https://medium.com/@shivekkhurana/ethical-open-sourced-and-profitable-at-the-same-time-16c53efdfe5a\">Ethical, open sourced and profitable at the same time</a></li></ul><img width=\"1\" src=\"https://medium.com/_/stat?event=post.clientViewed&referrerSource=full_rss&postId=83bd4adb9946\" height=\"1\">",
   :direction "ltr"},
  :updated 1566892755000,
  :entities
  [{:mentions [{:text "API"}],
    :id "nlp/f/entity/wd:165194",
    :salienceLevel "mention",
    :label "application programming interface"}
   {:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "src"} {:text "source code"} {:text "source"}],
    :id "nlp/f/entity/wd:128751",
    :salienceLevel "mention",
    :label "source code"}
   {:mentions [{:text "REPL"}],
    :id "nlp/f/entity/wd:2032810",
    :salienceLevel "mention",
    :label "Read–eval–print loop"}
   {:mentions [{:text "Java"}],
    :id "nlp/f/entity/wd:251",
    :salienceLevel "mention",
    :label "Java"}],
  :alternate
  [{:href
    "https://medium.com/@shivekkhurana/learn-clojure-by-building-a-drug-dealer-api-part-1-83bd4adb9946?source=rss-8bbc23a01e06------2",
    :type "text/html"}],
  :title "Learn Clojure by Building a Drug Dealer API-Part 1",
  :author "Shivek Khurana",
  :published-str "Tue Aug 27 00:59:15 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16cd23895f2:347464:49b12733",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url
   "https://cdn-images-1.medium.com/max/1024/1*ZigE5BeEaXIfx2_FnP4UWg.png",
   :width 1024,
   :height 678,
   :contentType "image/png"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://medium.com/p/83bd4adb9946",
  :commonTopics
  [{:score 102.02230383381728,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.941,
    :id "nlp/f/topic/116",
    :salienceLevel "about",
    :label "api"}
   {:score 0.933,
    :id "nlp/f/topic/1092",
    :salienceLevel "about",
    :label "hosting"}
   {:score 0.834,
    :id "nlp/f/topic/2461",
    :salienceLevel "mention",
    :label "web design"}
   {:score 0.834,
    :id "nlp/f/topic/2148",
    :salienceLevel "mention",
    :label "spiritual"}
   {:score 0.82,
    :id "nlp/f/topic/2460",
    :salienceLevel "mention",
    :label "web 2.0"}
   {:score 0.743,
    :id "nlp/f/topic/527",
    :salienceLevel "mention",
    :label "concept art"}
   {:score 0.727,
    :id "nlp/f/topic/774",
    :salienceLevel "mention",
    :label "engineering"}
   {:score 0.721,
    :id "nlp/f/topic/2035",
    :salienceLevel "mention",
    :label "sec tools"}],
  :published 1566892755000,
  :fingerprint "9ca32fc3",
  :canonicalUrl
  "https://medium.com/@shivekkhurana/learn-clojure-by-building-a-drug-dealer-api-part-1-83bd4adb9946?source=rss-8bbc23a01e06------2"}
 {:engagement 8,
  :unread false,
  :crawled 1566895019506,
  :content
  {:content
   "<p>Recently I was working on a <a href=\"https://docs.cider.mx/cider/about/history.html\">history\npage</a> for CIDER and I realized\nthat this month marks 6 years since the first release under my stewardship of\nthe project - namely 0.1.8.<sup><a href=\"http://metaredux.com/posts/2019/08/27/6-years-of-brewing-cider.html#fn:1\">1</a></sup> I haven’t had much time for writing recently\nbetween “Heart of Clojure”, lots of work at my day job, lots of work on CIDER\nand its Orchard, and preparing for the upcoming “Clojure/south” conference, but\nI decided that I should jot down a few thoughts about this small anniversary.</p>\n<p>Looking back at those 6 years I’m genuinely amazed at how far the project went\nand its impact on the Clojure ecosystem in general. It’s amusing that I started\nmy tenure at the helm of CIDER with the modest ambition to build a great Clojure\nplugin for Emacs and down the road I’ve switched to the much more ambitious goal of\ndeveloping a robust common foundation for Clojure development tools.<sup><a href=\"http://metaredux.com/posts/2019/08/27/6-years-of-brewing-cider.html#fn:2\">2</a></sup> I’ve yet\nto achieve any of those goals, and I might never manage to do so, but it has\nbeen one fun, wild, stressful and very educational ride for me.</p>\n<p>I’d like to take moment to everyone who’ve supported CIDER and friends, to everyone\nwho contributed to the projects, to everyone who used the projects. You’re\nawesome and CIDER, nREPL and the rest of the Orchard wouldn’t be the same without you!\nYour help, support, positive energy and general greatness have kept me and the\nprojects going all this time. It’s truly an honor and a\nprivilege to be part of the awesome Clojure community!</p>\n<p>How far can CIDER and CIDER’s Orchard go? Well, I guess sky is the limit, right?\nI’ll be speaking on this subject later this week at “Clojure/south” and I really hope\nto meet some of you there!</p>\n<p>Here’s to the next 6 years! Cheers!</p>\n<div>\n<ol>\n<li>\n<p>Technically speaking, it was still <code>nrepl.el</code> back then. <a href=\"http://metaredux.com/posts/2019/08/27/6-years-of-brewing-cider.html#fnref:1\">↩</a></p>\n</li>\n<li>\n<p>CIDER’s Orchard. <a href=\"http://metaredux.com/posts/2019/08/27/6-years-of-brewing-cider.html#fnref:2\">↩</a></p>\n</li>\n</ol>\n</div>",
   :direction "ltr"},
  :updated 1566891780000,
  :entities
  [{:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "about",
    :label "Clojure"}
   {:mentions [{:text "Emacs"}],
    :id "nlp/f/entity/wd:189722",
    :salienceLevel "mention",
    :label "Emacs"}],
  :alternate
  [{:href
    "http://metaredux.com/posts/2019/08/27/6-years-of-brewing-cider.html",
    :type "text/html"}],
  :title "6 Years of Brewing CIDER",
  :author "Bozhidar Batsov",
  :published-str "Tue Aug 27 00:43:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16cd23895f2:347463:49b12733",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "http://metaredux.com/posts/2019/08/27/6-years-of-brewing-cider",
  :published 1566891780000,
  :fingerprint "886fc810",
  :canonicalUrl
  "http://metaredux.com/posts/2019/08/27/6-years-of-brewing-cider.html"}
 {:engagement 4,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1566847385810,
  :recrawled 1567163957759,
  :content
  {:content
   "Marc O'Morain talks about CircleCI's new Windows support, their new JavaScript frontend, and fighting cryptominers.. Introducing Windows support on CircleCI The development of queueing theory - Wikipedia CircleCI Series D fundraising round CircleCI Careers CircleCI’s WAFL Pipelines CircleCI’s new pricing circle.ci/cli",
   :direction "ltr"},
  :updated 1566838800000,
  :entities
  [{:mentions [{:text "Windows"}],
    :id "nlp/f/entity/wd:1406",
    :salienceLevel "about",
    :label "Microsoft Windows"}
   {:mentions [{:text "JavaScript"}],
    :id "nlp/f/entity/wd:2005",
    :salienceLevel "mention",
    :label "JavaScript"}
   {:mentions [{:text "queueing theory"}],
    :id "nlp/f/entity/wd:847526",
    :salienceLevel "mention",
    :label "queueing theory"}
   {:mentions [{:text "WAFL"}],
    :id "nlp/f/entity/wd:7984357",
    :salienceLevel "mention",
    :label "West Australian Football League"}],
  :alternate
  [{:href "https://www.therepl.net/episodes/29/", :type "text/html"}],
  :title "29: Marc O'Morain on adding Windows support to CircleCI",
  :author "Daniel Compton",
  :published-str "Mon Aug 26 10:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16ccf61c0d2:eedbe2:97b0c8f7",
  :visual {:url "none"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://www.therepl.net/episodes/29/",
  :updateCount 1,
  :published 1566838800000,
  :fingerprint "9bd201cd",
  :canonicalUrl "https://www.therepl.net/episodes/29/"}
 {:engagement 4,
  :unread false,
  :crawled 1566844691498,
  :recrawled 1566886354323,
  :content
  {:content
   "<p>Functional programming cannot be suited for everything, right? Well, let’s not be so sure. Functional programming, like imperative programming and object-oriented programming, is a paradigm. It is a fundamental way to approach software. There are many languages that fall within the umbrella of FP. It is quite possible that everything we know how to do in software, we know how to do well with FP, the same way we know how to do it with imperative and with OOP.</p>\n<p></p>\n<h2>Transcript</h2>\n<p>Eric Normand: What kind of software is functional programming not suited for? We will go over this question and explore it in some depth by the end of the episode. Hi, my name is Eric Normand, and I help people thrive with functional programming.</p>\n<p>This is an important question, because if we are being honest with ourselves, we’re going to find places where something isn’t a good fit. If it’s a good fit for one thing, there’s going to be a bad fit somewhere else. To say that a thing is good at everything is probably to delude yourself.</p>\n<p>I want you, my listener, to have a more balanced view of what’s going on, so we’re going to explore this question. I’m going to make reference to other paradigms, object-oriented paradigm and imperative paradigm, and we’ll see. We’ll see how they all do as paradigms.</p>\n<p>The question is, what kind of software, what applications, what domains, what kind of context is functional programming not suited for? My first impression is this is like asking what object-oriented programming is not suited for, or what imperative programming is not suited for.</p>\n<p>Even though I don’t generally endorse imperative programming, like in the same way I endorse functional programming, it’s hard for me to think of a domain where imperative programming is not great. I don’t feel like I’m being biased by saying that I think that there’s something wrong with the question. I want to go into why that might be.</p>\n<p>The thing is, these are general approaches. These paradigms are general-purpose approaches to software. They are more like a world view from which to begin your exploration of a problem domain and how you might solve it. It’s not like they’re mutually exclusive.</p>\n<p>Their ideas certainly aren’t mutually exclusive. They just kind of set a groundwork, a framework, in which you’re going to continue exploring.</p>\n<p>They’re a whole system of thinking, and so it’s hard to say that some kind of application wouldn’t do well in imperative programming. It’s a system of thinking. It’s a place to start. Likewise with object-oriented programming. It’s a place to start.</p>\n<p>Just to be super clear, when I’m talking about the three major paradigms, object-oriented, imperative, and functional, I’ll quickly give a nutshell description of these as paradigms.</p>\n<p>Imperative programming turns everything into a sequence of steps. That is your main programming unit is a routine or a subroutine. You can break up a sequence of steps into further steps, call those and name them, and refer to them that way. You could see that this is a generally applicable paradigm.</p>\n<p>A lot of people say, “Functional is really good with math.” A lot of high-performance math routine software, is written in an imperative style. It’s written in Fortran, so it’s really hard to make that argument that functional programming is better at math than Fortran.</p>\n<p>Object-oriented programming, there’s basically three main concepts. There are objects, which hold state and accept messages, there are the messages that are sent between objects, and there are the methods, which are the code that runs when the message is received.</p>\n<p>In this way, you create this network of objects that communicate with each other. The computation happens through the dispatch of different messages and what each object does with the messages it receives.</p>\n<p>Likewise, you look at software written today, a lot of it is written in object-oriented programming, in an object-oriented style. It spans all sorts of domains, all over the spectrum. It’s really hard to say that it’s not suitable for this stuff.</p>\n<p>People have built systems to do aircraft engineering, to embedded systems, to simple web applications. Everything is built in this OO framework.</p>\n<p>I’m going to say the same for FP, that there’s really nothing that FP isn’t suited for. Real quick, functional programming as a paradigm begins with three things, the three main concepts — actions, calculations, and data. These are mutually exclusive categories that everything falls into.</p>\n<p>When I read answers on the Internet, one thing that I see come up a lot as a good answer or as common answer — and people like this answer, they upvote it and stuff — is that anything that’s main purpose or the main function of the software is to keep track of and change state.</p>\n<p>They give the examples of stuff like a game engine, where characters and other items are constantly changing. They’re moving. Their health points are changing. There’s a lot of state, and it doesn’t make sense to do this in functional programming, because it’s much easier to just set mutable fields on objects.</p>\n<p>I want to address this, because it is a very common answer. Functional programmers do use state. Let me just put it bluntly. We do. There is a particular definition of functional programming that I don’t agree with that says that functional programming is exclusively programming with pure functions.</p>\n<p>That means no state, no side effects, nothing, just pure functions. If that is the case, if it is programming with pure functions, then these answers are right. The trouble is that that is not what most functional programmers do in their day job.</p>\n<p>When they’re actually building a real system, they are making practical compromises. They are not sticking to this very rigid reductionist definition of functional programming.</p>\n<p>That would be like saying in Java, you could only do stuff with message passing, meaning no if statements, no for loops, no primitives. Everything has to be an object. Nobody does that. It’s just not the way it’s done.</p>\n<p>Now, there are some languages that make it easier to do that, like I believe with Smalltalk, everything, even if statements were done with messages. That was a choice they made, just like Haskell makes a choice to be a very pure language, although it does have I/O. Don’t forget about that.</p>\n<p>I don’t agree with that definition. Functional programmers do use state. They do use side effects. They just have a tidy place to put them. They put them in the actions category. All that is to say that functional programming is big.</p>\n<p>There’s a lot of room in this umbrella of functional programming to solve any problem you might have. That’s why it’s not really possible to say, “Well, it’s not good at this,” because it’s a big umbrella. That thing fits under there, and someone may have found a way to do it. There’s lots of languages.</p>\n<p>I’m going to name two domains that maybe I would feel like just intuitively, “Oh, these things, these domains, no. They’re not good for functional programming,” but then I researched them, and it turns out that there are functional programming solutions in there.</p>\n<p>The first one is embedded systems. I looked into this, because I figured embedded systems are super constrained in terms of memory and CPU processing. You’re not going to be able to fit a garbage collector in the kind of runtime that we’re used to when we’re dealing with nice functional languages. But, I was wrong.</p>\n<p>There are several versions of Scheme, or other Lisps, that are made to run in an embedded environment. They’re pared down. They’re not the Scheme you would run on your desktop or on a server. They’re very small, and they encourage a lot of functional programming practices, and they discourage others.</p>\n<p>There’s going to be mutable data, like the const cells, the things you make linked lists out of — they’re mutable — but it encourages recursion. It has first-class functions. You make a tradeoff there for space. Now, there’s other languages, too. I’m just picking on Scheme, but there’s other functional languages.</p>\n<p>Then you get to something like Rust. Rust is a very functional language. A lot of it falls under the functional umbrella.</p>\n<p>It has a really nice type system that can optimize away a lot of stuff that we’ve relied on runtimes for in the past — memory safety, being able to efficiently store and deal with mutable state in a safe way.</p>\n<p>Rust is a perfect example of functional programming for embedded systems. It’s just, it proves that [laughs] it is suitable for everything.</p>\n<p>There might not be a language for that particular problem yet, but it doesn’t mean that FP isn’t good for it. It doesn’t mean that all languages are. I would never use Clojure in an embedded system. It’s too big. Everyone knows that. No one’s going to dispute that.</p>\n<p>The other one is the GPU. There are many systems for writing the language that GPUs speak, which is OpenCL, something like that. Oh, I forgot the name. Let me look it up real quick. Yeah, there’s Cuda and OpenCL.</p>\n<p>These are C-like languages. They’re imperative. Like in Clojure, there’s ways of writing what looks like Clojure, that gets compiled into OpenCL, and then sent to the GPU. That’s not what I’m talking about. I’m talking about a functional paradigm approach to programming the GPU.</p>\n<p>I didn’t know that this existed, but it does. I would have said, “No, you just want imperative. Just give me the raw code, and let me do it by hand.” No, there’s a thing called Futhark, F-U-T-H-A-R-K, that is a functional language that operates on arrays.</p>\n<p>It has map, filter, reduce, and it happens all in parallel on the GPUs. It compiles to OpenCL or Cuda, and it is a completely pure, type-safe functional language that is competitive with hand-optimized code. It’s high level in the way that an imperative language wouldn’t be.</p>\n<p>To me, this is it. It’s saying, “Yeah, sure, maybe Clojure or Haskell itself won’t compile right to the GPU, but here is a small functional language that will compile nicely to the GPU.” That’s what it’s made for. It’s made for interop with a regular language, like a CPU-bound language.</p>\n<p>You’re running it in Python, and then you need to call out to something fast on the GPU. You could write it in this nice functional language in a functional style.</p>\n<p>I’m going to conclude. I think that FP is generally applicable, because it really is just a general approach to software.</p>\n<p>In the same way that object-oriented programming is probably OK, I don’t know if OOP would be good on the GPU. Just saying, just because the message passing might…I don’t know. I’m not a GPU person, but it just seems like the message passing would be not a good fit for the architecture of the GPU.</p>\n<p>That’s not to say that it’s not possible. I don’t know. The thing is, when we talk about whether it’s a good fit for a certain environment or application domain, we’re usually thinking about a particular language that we are thinking about.</p>\n<p>We’re saying, “Is Haskell good for this?” OK, Haskell is not good for everything. Clojure is not good for everything. There are particular domains where it is a good fit and not, but FP encompasses all of them. As a framework, as a paradigm, it is flexible, it can do it all, and I think that’s the case with imperative and with object-oriented.</p>\n<p>Well, yep, that’s all I have to say. I hope I’ve brought some clarity to this. A lot of the fine points are on the definition of FP as a paradigm. I think that state and side effects are a part of FP, just the fact that we have names for them in a way that other paradigms don’t. That’s it. I’m done.</p>\n<p>If you liked this episode, you can find all the past episodes at lispcast.com/podcast. There you can find audio, video, and text of all of the past episodes. You’ll also find links to subscribe to the podcast and to find me on social media, be it email, Twitter, or LinkedIn.</p>\n<p>I really think the social part of social media is the main thing. It’s not a broadcast medium, it’s a way of getting in touch with more people, keeping in touch with people, engaging with them, forming relationships, friendships, nice, deep discussions.</p>\n<p>Please find me and send me a message and that’s it. Thanks for listening and rock on.</p>\n<p>The post <a rel=\"nofollow\" href=\"https://lispcast.com/what-kind-of-software-is-functional-programming-not-suited-for/\">What kind of software is functional programming not suited for?</a> appeared first on <a rel=\"nofollow\" href=\"https://lispcast.com\">LispCast</a>.</p>",
   :direction "ltr"},
  :updated 1566817200000,
  :entities
  [{:mentions
    [{:text "functional programming"} {:text "functional language"}],
    :id "nlp/f/entity/wd:193076",
    :salienceLevel "about",
    :label "functional programming"}
   {:mentions [{:text "OOP"} {:text "Object-oriented programming"}],
    :id "nlp/f/entity/wd:79872",
    :salienceLevel "mention",
    :label "object-oriented programming"}
   {:mentions [{:text "imperative programming"}],
    :id "nlp/f/entity/wd:275596",
    :salienceLevel "mention",
    :label "imperative programming"}
   {:mentions [{:text "message passing"} {:text "message"}],
    :id "nlp/f/entity/wd:1859284",
    :salienceLevel "mention",
    :label "message passing"}
   {:mentions [{:text "Haskell"}],
    :id "nlp/f/entity/wd:34010",
    :salienceLevel "mention",
    :label "Haskell"}],
  :alternate
  [{:href
    "https://lispcast.com/what-kind-of-software-is-functional-programming-not-suited-for/",
    :type "text/html"}],
  :title
  "What kind of software is functional programming not suited for?",
  :author "Eric Normand",
  :published-str "Mon Aug 26 04:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16ccf38a42a:e9dd44:69b9f616",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url
   "https://lispcast.com/wp-content/uploads/2018/07/ERIC-NORMAND-LISPCAST.COM_.jpg",
   :width 513,
   :height 557,
   :contentType "image/jpeg"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://lispcast.com/what-kind-of-software-os-functional-programming-not-suited-for/",
  :updateCount 3,
  :commonTopics
  [{:score 127.15944465321591,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.984,
    :id "nlp/f/topic/525",
    :salienceLevel "about",
    :label "computer science"}
   {:score 0.811,
    :id "nlp/f/topic/1722",
    :salienceLevel "mention",
    :label "pentest"}
   {:score 0.784,
    :id "nlp/f/topic/2010",
    :salienceLevel "mention",
    :label "scalability"}],
  :published 1566817200000,
  :fingerprint "de41cce3",
  :canonicalUrl
  "https://lispcast.com/what-kind-of-software-is-functional-programming-not-suited-for/"}
 {:engagement 5,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/todo",
    :label "todo"}
   {:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1566817323378,
  :content
  {:content
   "<div>\n<p><em>Issue 341 – August 26, 2019 · <a href=\"https://purelyfunctional.tv/newsletter-archives/\">Archives</a> · <a title=\"Thanks, Jeff!\" href=\"https://purelyfunctional.tv/newsletter/\">Subscribe</a></em></p>\n<h2>Clojure Tip 💡</h2>\n<p><em>keep your <code>ns</code> declaration tidy</em></p>\n<p>We’ve all done it at some point. We’re really rolling on a new project and we’re itching to import a new library. So we copy and paste from the example in the README and paste it right into our code.</p>\n<p>After a few hours, the top of our file looks like this:</p>\n<pre><code>(ns my-project.core\n       (:use some-library)\n       (:use another-library)\n  (:require [clojure.string :refer [upper-case lower-case])\n  (:require [clojure.java.io :as io]\n                 [foo.bar :refer [baz\n                                        ;; cux \n                  ]])))\n\n(use 'favorite-lib.core)\n\n(require 'lib4clj.core)\n\n(import 'java.util.Date)\n</code></pre>\n<p>It’s a mess! It’s hard to see what’s been imported, and it will slow you down. (Also: there’s a bug in there that would be way easier to spot with some tidying.)</p>\n<p>But what’s worse is the impression it makes on others. If you’re looking for a job and you send someone this code, here is what is going through their mind: “Oh, no! This person has never worked on a serious project.”</p>\n<p>At least that’s the strong impression it gives me. If you want to make a good impression, clean that up. Cleaning it up will exercise your code movement skills. You will be moving a lot of code once you get the job. It also shows respect for the person who will be reading the code.</p>\n<p>Here’s what the above code looks like when it’s neat and tidy:</p>\n<pre><code>(ns my-project.core\n  (:require [some-library :refer :all]\n            [another-library :refer :all]\n            [clojure.string :refer [upper-case lower-case]]\n            [clojure.java.io :as io]\n            [foo.bar :refer [baz]]\n            [favorite-lib.core :refer :all]\n            [lib4clj.core])\n  (:import java.util.Date))\n</code></pre>\n<p>It’s much easier to read and gives a more organized impression. However, I would go further. I converted <code>use</code> into <code>require</code> with <code>:refer :all</code>. This is usually not ideal if you’re doing it to a lot of namespaces. You should choose a namespace alias and use it instead.</p>\n<pre><code>(ns my-project.core\n  (:require [some-library      :as sl]\n            [another-library   :as al]\n            [clojure.string    :as str]\n            [clojure.java.io   :as io]\n            [foo.bar           :refer [baz]]\n            [favorite-lib.core :as fl]\n            [lib4clj.core      :as lib4clj])\n  (:import java.util.Date))\n</code></pre>\n<p>Woah! Clean as a whistle and easy on the eyes.</p>\n<p>Here are some recommendations for squeaky-clean <code>ns</code> declarations:</p>\n<ol>\n<li>Put all dependencies into the <code>ns</code>. No exceptions.</li>\n<li>Don’t use <code>:use</code>. In general, people recommend against it. If you need similar functionality, use <code>:require</code> with <code>:refer :all</code>. But see #3.</li>\n<li>Avoid <code>:refer :all</code> unless you have a good reason. Laziness is not a good reason. A good reason is that it is a well-known library whose functions are named to help you know where they came from. An example is <code>clojure.test</code> inside of a testing namespace.</li>\n<li>Give your namespaces short, descriptive aliases. Abbreviation is good. Use well-known aliases for common libraries, like <code>str</code> for <code>clojure.string</code>.</li>\n<li>Don’t <code>:refer</code> too many names. A handful is okay.</li>\n<li>Use good whitespace. New lines are important. Alignment can help readability. Keep it indented correctly.</li>\n</ol>\n<p>Are there any guidelines you follow? Hit reply and let me know.</p>\n<h2>Book status 📖</h2>\n<p>My book is out! You can buy the book now in early access. The first three chapters are available and you’ll get updates as new chapters come out.</p>\n<p><a title href=\"https://lispcast.com/gs\">Grokking Simplicity</a> teaches functional programming in a friendly way, to those who are not familiar with it or who were turned off by the overly academic resources.</p>\n<p>You can get 50% off the normal prices with discount code MLNORMAND. It will work until August 31, so don’t delay. I don’t really control the sales and discounts, so I don’t know when the next one will be.</p>\n<p>Also, there’s no “look inside” on my book, so I’ll share some images of pages here. Click the picture to see a bigger version.</p>\n<p><a title href=\"https://lispcast.com/wp-content/uploads/2019/08/Page-3.png\"><img title=\"\" src=\"https://lispcast.com/wp-content/uploads/2019/08/Page-3-245x300.png\"></a> <a title href=\"https://lispcast.com/wp-content/uploads/2019/08/Page-11.png\"><img title=\"\" src=\"https://lispcast.com/wp-content/uploads/2019/08/Page-11-256x300.png\"></a> <a title href=\"https://lispcast.com/wp-content/uploads/2019/08/Page-16.png\"><img title=\"\" src=\"https://lispcast.com/wp-content/uploads/2019/08/Page-16-245x300.png\"></a> <a title href=\"https://lispcast.com/wp-content/uploads/2019/08/Page-55.png\"><img title=\"\" src=\"https://lispcast.com/wp-content/uploads/2019/08/Page-55-235x300.png\"></a></p>\n<h2>Retraction ❌</h2>\n<p>I regret describing <em>The Bell Curve</em> as a “racist, pseudoscientific screed”. Last week I mentioned the book in the context of <em>Apollo: The race to the moon</em>.</p>\n<p><em>The Bell Curve</em> is indeed a controversial book. I was told about it in High School by a teacher who said it was racist. I never read it myself. I simply parroted what he taught me to you in this newsletter. You deserve better than repeated hearsay.</p>\n<p>A couple of readers disagreed with my words. I looked into it and I realized my mistake. I know nothing about the book, and very little about the controversy around it. I’m not defending the book nor am I supporting it. But I should not have used such strong language about a topic I know nothing of. If the topic interests you, please form your own opinions.</p>\n<p>I am grateful that you put your trust in me to have my newsletter in your inbox every week. I betrayed that trust by speaking out of turn. I apologize.</p>\n<h2>Conference alert 🚨</h2>\n<p><a title href=\"http://2019.clojure-conj.org/\">Clojure/conj</a> <a title href=\"http://2019.clojure-conj.org/call-for-proposals/\">CFP</a> and <a title href=\"http://2019.clojure-conj.org/opportunity-grants/\">Opportunity Grant applications</a> are due soon. The conference is in November in Durham, NC.</p>\n<h2>Currently recording 🎥</h2>\n<p>I am now recording a course called <a title href=\"https://purelyfunctional.tv/courses/property-based-testing-with-test-check/\"><em>Property-Based Testing with test.check</em></a>. Property-based testing (PBT) is a powerful tool for generating tests instead of writing them. You’ll love the way PBT makes you think about your system. And you can <a title href=\"https://purelyfunctional.tv/courses/property-based-testing-with-test-check/\">buy it now</a> in Early Access. Of course, PF.tv members have had access since the beginning, along with all of the other courses.</p>\n<p>New lessons this week include:</p>\n<ol>\n<li><a title href=\"https://purelyfunctional.tv/lesson/testing-pure-functions/\">Testing pure functions</a> — Pure functions are the easiest to test, so that’s where we start. We test three fairly mathematical functions (<code>reverse</code>, <code>sum</code>, and <code>min</code>). We look for complete coverage of the behavior by trying to find an incorrect implementation that could pass the tests. Then we test two real-world functions I snagged from some real projects. These are a little more involved since we need to create custom generators for them. All the better to learn from!</li>\n<li><a title href=\"https://purelyfunctional.tv/lesson/testing-stateful-systems/\">Testing stateful systems</a> — Once you bring in mutable state, the complexity of your system skyrockets. Now you have to deal with actions performed in arbitrary order. We look at two examples of stateful systems and how to test them. Testing mutable state is where Property-Based Testing really starts to shine. We essentially test every part of the interface in hundreds of combinations.</li>\n</ol>\n<p>I’ve made the first and fifth lessons free to watch. <a title href=\"https://purelyfunctional.tv/courses/property-based-testing-with-test-check/\">Go check them out</a>.</p>\n<p>Members already have access to the lessons. The Early Access Program is open. If you <a title href=\"https://purelyfunctional.tv/courses/property-based-testing-with-test-check/\">buy now</a>, you will get the already published material and everything else that comes out at a serious discount. There are already 9 hours of video, and looking at my plan, this one might be 12 hours. But that’s just an estimate. It could be more or less. The uncertainty about it is why there’s such a discount for the Early Access Program.</p>\n<h2>Brain skill 😎</h2>\n<p><em>focus</em></p>\n<p>We can often learn better in long periods of focus. Learning means challenging your brain. That can be uncomfortable. Your brain will rebel and seek out distractions. Often the most uncomfortable part is right at the beginning. Being able to focus means sticking with it long enough to get over the initial hurdle.</p>\n<p>Focus also helps you keep more stuff in your head at once. Our attention is very limited. A distracting noise or idea could bump out the hour of work you’ve done to load a difficult concept into your head. Being able to focus means eliminating those distractions so you can work with the idea efficiently.</p>\n<p><a title href=\"https://www.scotthyoung.com/blog/2018/07/12/guide-to-focus/\">This guide</a> from Scott Young has useful tips for increasing your ability to focus.</p>\n<h2>Clojure Challenge 🤔</h2>\n<h3>Last week’s challenge</h3>\n<p>The puzzle in <a title href=\"https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-340-fewer-side-effects-is-better-than-more/\">Issue 340</a> was to write a simplifier for the symbolic differentiator we did the week before.</p>\n<p>You can check out the submissions <a title href=\"https://gist.github.com/ericnormand/7935bebce9fbbfbb15f36063063172b3\">here</a>.</p>\n<h3>This week’s challenge</h3>\n<p><em>permutations of a sequence</em></p>\n<p>The permutations of a sequence are all of the sequences with the same elements but in different orders. Here are some examples.</p>\n<p>The permutations of <code>[1, 2]</code> are <code>[1, 2]</code> and <code>[2, 1]</code>.</p>\n<p>The permutations of <code>[1, 2, 3]</code> are <code>[1, 2, 3]</code>, <code>[1, 3, 2]</code>, <code>[2, 1, 3]</code>, <code>[2, 3, 1]</code>, <code>[3, 1, 2]</code>, and <code>[3, 2, 1]</code>.</p>\n<p>The number of permutations grows really fast with the size of the list.</p>\n<p>Your challenge is to write a function that generates all permutations of a list. Your function should return a lazy sequence.</p>\n<p>Note: there already is a great, fast implementation of this function in <a title href=\"https://github.com/clojure/math.combinatorics\">clojure.math.combinatorics</a></p>\n<p>As usual, please send me your implementations. I’ll share them all in next week’s issue. If you send me one, but you don’t want me to share it publicly, please let me know.</p>\n<p>Rock on!<br>Eric Normand</p>\n</div>\n<p>The post <a rel=\"nofollow\" href=\"https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-341-tip-tidy-up-your-ns-form/\">PurelyFunctional.tv Newsletter 341: Tip: tidy up your ns form</a> appeared first on <a rel=\"nofollow\" href=\"https://purelyfunctional.tv\">PurelyFunctional.tv</a>.</p>",
   :direction "ltr"},
  :updated 1566813600000,
  :entities
  [{:mentions [{:text "newsletter"}],
    :id "nlp/f/entity/wd:264238",
    :salienceLevel "about",
    :label "newsletter"}
   {:mentions [{:text "copy and paste"}],
    :id "nlp/f/entity/wd:1058748",
    :salienceLevel "mention",
    :label "cut, copy, and paste"}
   {:mentions [{:text "The Bell Curve"}],
    :id "nlp/f/entity/wd:575800",
    :salienceLevel "mention",
    :label "The Bell Curve"}
   {:mentions [{:text "README"}],
    :id "nlp/f/entity/wd:539662",
    :salienceLevel "mention",
    :label "README"}
   {:mentions [{:text "functional programming"}],
    :id "nlp/f/entity/wd:193076",
    :salienceLevel "mention",
    :label "functional programming"}],
  :alternate
  [{:href
    "https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-341-tip-tidy-up-your-ns-form/",
    :type "text/html"}],
  :title
  "PurelyFunctional.tv Newsletter 341: Tip: tidy up your ns form",
  :author "Eric Normand",
  :published-str "Mon Aug 26 03:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16ccd970972:c42441:49b12733",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url
   "https://lispcast.com/wp-content/uploads/2019/08/Page-11-256x300.png",
   :width 256,
   :height 300,
   :contentType "image/png"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://purelyfunctional.tv/?p=31926",
  :commonTopics
  [{:score 0.957,
    :id "nlp/f/topic/575",
    :salienceLevel "about",
    :label "crm"}
   {:score 0.917,
    :id "nlp/f/topic/294",
    :salienceLevel "about",
    :label "bodybuilding"}
   {:score 0.852,
    :id "nlp/f/topic/874",
    :salienceLevel "about",
    :label "fitness"}
   {:score 0.79,
    :id "nlp/f/topic/774",
    :salienceLevel "mention",
    :label "engineering"}],
  :published 1566813600000,
  :fingerprint "9e7f13d5",
  :canonicalUrl
  "https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-341-tip-tidy-up-your-ns-form/"}
 {:engagement 5,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1566809025842,
  :recrawled 1566822532034,
  :content
  {:content
   "<p>Hot Reload is a very popular concept within the ClojureScript community and refers to the automatic reloading of code during development while keeping the application state. The concept was first introducing by <a href=\"https://twitter.com/bhauman\">Bruce Hauman</a> and his implementation in <a href=\"https://github.com/bhauman/lein-figwheel\">figwheel</a>. If you haven’t watched his <a href=\"https://www.youtube.com/watch?v=j-kj2qwJa_E\">introductory talk</a> you definitely should.</p>\n<p><a href=\"https://github.com/thheller/shadow-cljs\">shadow-cljs</a> has its own implementation for Hot-Reloading which works similarly to what <code>figwheel</code> does. It does expose a few extra hooks that allow a bit more control over the process when needed but the underlying concept is very much the same.</p>\n<p>In this post I provide a few more technical details of how it works in <code>shadow-cljs</code> to remove some of the mystery since the underlying process is really simple. I’m going to frame this in the context of a SPA (Single Page Application) since the concept is most useful when combined with a virtual DOM library like <code>React</code> which constructs the UI in a functional manner based on our data. It also is essential that all your data is kept in a central place since hot-reloading gets a lot more complex if data is spread all over the place. Even to the point of not being useful at all anymore.</p>\n<h2>Application Lifecycle</h2>\n<p>Any application using Hot Reload should be structured in a similar fashion where each lifecycle event is executed at the correct time and can potentially be re-executed when required. The setup I recommend uses 3 simple stages</p>\n<ul>\n<li><code>init</code>: Executed only once, when the application is first loaded. Calls <code>start</code> when done</li>\n<li><code>start</code>: Actually renders the application, called after hot-reload is applied</li>\n<li><code>stop</code>: Optional, called before any hot-reload is applied (allows shutting down transient state started in <code>start</code>)</li>\n</ul>\n<p>In code terms this looks something like this:</p>\n<pre><code>(ns example.app)\n\n(defn ^:dev/after-load start []\n  (js/console.log &quot;start&quot;))\n\n(defn init []\n  (js/console.log &quot;init&quot;)\n  (start))\n\n;; optional\n(defn ^:dev/before-load stop []\n  (js/console.log &quot;stop&quot;))\n</code></pre>\n<p>The build config should use <code>:modules {:app {:init-fn example.app/init}}</code> to ensure the <code>init</code> fn is called when the app is first loaded. The dummy just directly calls <code>start</code> but actual apps can initialize themselves here.</p>\n<p>The <code>^:dev/after-load</code> on <code>start</code> (and <code>^:dev/before-load</code> on <code>stop</code>) metadata tells <code>shadow-cljs</code> to call those functions at the appropriate time in the application lifecycle.</p>\n<p>Note that the names <code>init/start/stop</code> don’t actually mean anything special so you can use any name you like instead, they just happen to be the names I chose in my projects.</p>\n<p>On the backend the running <code>shadow-cljs watch app</code> process will watch the filesystem for changes and automatically recompile namespaces on change. Once that compilation finishes the update is shipped to the runtime (ie. Browser) and it starts calling all <code>^:dev/before-load</code> functions (can be zero or more). Once those complete the recompiled code is loaded and the <code>^:dev/after-load</code> functions are called (should be one or more).</p>\n<h4>Async Lifecycle Hooks</h4>\n<p>There are also async variants of those hooks in case you need to do async work that should complete before proceeding with the reload. Suppose you are using a <code>node</code> <code>http</code> server where its <a href=\"https://nodejs.org/api/http.html#http_server_close_callback\"><code>.close</code></a> function takes a callback that is called once the server is actually closed.</p>\n<pre><code>(defonce server-ref (atom nil))\n\n(defn start-server []\n  ...)\n\n(defn ^:dev/after-load start []\n  (reset! server-ref (start-server)))\n\n(defn ^:dev/before-load-async stop [done]\n  (let [srv @server-ref]\n    (reset! server-ref nil)\n    (.close srv done)))\n</code></pre>\n<p>The async lifecycle hooks just receive on extra argument (ie. <code>done</code>) which is a simple callback fn that should be called once the work is done. In this case it can be passed directly to the <code>.close</code> fn. You must ensure this <code>done</code> fn is actually called though. Hot reload will otherwise not proceed.</p>\n<p>When using the sync version of the lifecycle hooks the <code>before-load</code> would be called which would queue the <code>.close</code> but given the async nature of the <code>node</code> code this would actually not do anything just yet. <code>shadow-cljs</code> would just immediately proceed with reloading and calling <code>after-load</code> again. The <code>.close</code> never had a chance to complete and your server would now likely fail to start since the old one is still running.</p>\n<h2>Hooking up React</h2>\n<p>Note that reloading the code itself doesn’t actually do anything to your UI unless you used a <code>^:dev/after-load</code> hook to actually trigger the re-render.</p>\n<p>When using something like <a href=\"https://github.com/reagent-project/reagent\">reagent</a> you’d trigger the re-render like this.</p>\n<pre><code>(def dom-root (js/document.getElementById &quot;app&quot;))\n\n(defn ui []\n  [:div &quot;hello world&quot;])\n\n(defn ^:dev/after-load start []\n  (reagent/render [ui] dom-root))\n</code></pre>\n<p>Depending on your setup you may also need to actually ensure that reagent/react don’t decide to skip the re-render. Sometimes they may think that nothing has changed if you only changed something further down.</p>\n<p>With frameworks like <a href=\"https://github.com/Day8/re-frame\">re-frame</a> you should call <code>(re-frame/clear-subscription-cache!)</code>. When using <code>reagent</code> directly you might need to add an additional prop to signal “change”, so it doesn’t immediately skip since <code>ui</code> didn’t change. As explained later due to the difference in the recompile logic this may not have been necessary in <code>figwheel</code>.</p>\n<pre><code>(defn ^:dev/after-load start []\n  ;; dummy prop that always changes\n  (reagent/render [ui {:x (js/Date.now)}] dom-root))\n</code></pre>\n<p>When using a single atom to hold all your state it might be enough to just touch and change that.</p>\n<pre><code>(ns example.app.db)\n\n(defonce app-state (atom {::dummy 0}))\n\n(ns example.app\n  (:require [example.app.db :as db]))\n\n...\n(defn ^:dev/after-load start []\n  (swap! db/app-state update ::dummy inc)\n  (reagent/render [ui] dom-root))\n</code></pre>\n<h2>Behind the Scenes</h2>\n<p>Code reloading in ClojureScript is deceptively simple compared to hot-reload mechanisms from other languages (eg. HMR in JS) because of the way the code is structured. Everything is executed in the same scope and a tree of namespace objects is created. The above code will just create this underlying JS</p>\n<pre><code>goog.provide(&quot;example.app&quot;); // creates the var example = {app: {}}; global once\n\nexample.app.start = function() {\n  return console.log(&quot;start&quot;);\n};\n\nexample.app.init = function() {\n  console.log(&quot;init&quot;);\n  return example.app.start();\n};\n\nexample.app.stop = function() {\n  return console.log(&quot;stop&quot;);\n};\n</code></pre>\n<p>On reload this will effectively just redefine <code>example.app.start</code> (and the others from that namespace) with new function definitions. If code from other namespaces is reloaded this way the namespaces using it will have accessed it via its fully qualified name so they will automatically call the new version.</p>\n<h2>Recompile Logic</h2>\n<p>On the backend the <code>shadow-cljs watch app</code> process will compile a namespace when it is changed and also recompile the direct dependents of that namespace (ie. namespaces that <code>:require</code> it). This is done to ensure that changes to the namespace structure are reflected properly and code isn’t using old references.</p>\n<pre><code>(ns example.util)\n\n(defn foo [] ...)\n\n(ns example.app\n  (:require [example.util :as util]))\n\n(defn bar []\n  (util/foo))\n</code></pre>\n<p>Suppose you changed <code>example.util</code> and renamed <code>(defn foo [] ...)</code> to <code>(defn bar [] ...)</code>. If <code>example.app</code> wasn’t automatically recompiled together with <code>example.util</code> you would not get a proper warning that <code>example.util/foo</code> no longer exist. Given that the old definition even still exists in the runtime the code would actually keep working until you reload your browser (or restarted the <code>watch</code>).</p>\n<p><code>shadow-cljs</code> will only automatically recompile the direct dependents since in theory dependencies further up cannot be directly affected by those interface changes. This is different from <code>figwheel</code> since it defaults to using <code>:recompile-dependents true</code> from the ClojureScript compiler. This will recompile ALL dependents so any namespace with a <code>:require</code> on the changed namespace and then all namespaces that required those and so on. This can make recompiles rather slow in larger apps and in the vast majority of cases simply isn’t necessary.</p>\n<h1>Don’t forget about the REPL</h1>\n<p>Hot Reload is sort of brute force since it always replaces the entire namespace. Depending on the size of that namespace and the amount of direct dependents this can noticeably increase the feedback time during development given the amount of time it takes to compile.</p>\n<p>It also blindly triggers on file change which will often lead to unnecessary recompiles since you might just save a file in the midst of other pending changes. I have Cursive setup to save files when the editor loses focus so this means that a hot-reload is triggered as soon as I tab out to look up some documentation or so. This can be a bit annoying if you are in the midst of a large new feature/rewrite.</p>\n<p>The REPL allows for much finer grained control over this entire process. When using a CLJS REPL you can replace a single function directly which will be a whole lot faster and provide feedback pretty much instantly. However if said feedback requires rendering the UI you’ll need to trigger that re-render. You could just call <code>(example.app/start)</code> if you use the setup from above. Depending on your REPL setup you may want to bind that to a keyboard shortcut.</p>\n<p><code>shadow-cljs</code> also provides a few extra REPL hooks if you still want to the convenience of doing the whole lifecycle and proper dependent namespace checks. This will let you trigger the recompile when you want it to instead of automatically on file change.</p>\n<p>When in a CLJ REPL you can first tell the <code>watch</code> to not automatically rebuild on file change via</p>\n<pre><code>(shadow.cljs.devtools.api/watch :app {:autobuild false})\n</code></pre>\n<p>This will cause the <code>watch</code> to not trigger an automatic recompile and instead only remember the files that were changed. You can then trigger an actual recompile and the hot-reload lifecycle via</p>\n<pre><code>;; trigger compile for specific build\n(shadow.cljs.devtools.api/watch-compile! :app)\n;; or all running watches\n(shadow.cljs.devtools.api/watch-compile-all!)\n</code></pre>\n<p>These are also great candidates for keyboard shortcuts.</p>\n<p>With much more control over when things actually happen you can get rid of a lot of “noise” you might otherwise receive. I find myself using this whenever working on changes to my domain model or architecture and using the automatic reloading whenever I’m tweaking the UI (eg. styles and layout).</p>\n<h2>Things to avoid</h2>\n<p>Hot Reload can only do so much and requires some discipline in your code architecture.</p>\n<h3>Holding Code references in State</h3>\n<p>Hot Reload can only replace code in the global scope. If you hold onto references (eg. functions) directly in some other places those references won’t be replaced and will continue using old versions.</p>\n<pre><code>(defonce some-state (atom {:x somewhere/foo}))\n</code></pre>\n<p>This will keep a reference to <code>foo</code> directly in the map which will not be updated when hot-reloading. One way to avoid this is adding an extra function.</p>\n<pre><code>(defonce some-state (atom {:x #(somewhere/foo %)})) ;; assuming it expects one arg\n</code></pre>\n<p>This isn’t the best approach but works in a pinch. A better idea would be to keep only actual data in atoms and then deciding what code to call on that later in the actual code</p>\n<pre><code>(defonce some-state (atom {:x ::foo}))\n\n(defn do-something [{:keys [x] :as data}]\n  (case x\n    ::bar\n    (some/bar)\n    ::foo\n    (somewhere/foo data)))\n\n(defn ^:dev/after-load start []\n  (do-something @some-state))\n</code></pre>\n<h3>Missing :ns require</h3>\n<p><code>shadow-cljs</code> is rather strict about namespace references and things can go wrong quickly if you “cheat”. Technically CLJS allows using the fully qualified name of something to directly reference without ns alias but only the actual <code>:require</code> ensures things are actually available and properly reflected when hot-reloading.</p>\n<pre><code>(ns example.foo)\n\n(defn foo? [x]\n  (some.thing/else? x &quot;foo&quot;))\n</code></pre>\n<p>Don’t do this. At least add <code>(:require [some.thing])</code> to the <code>ns</code>, better yet with an alias. Without the <code>:require</code> <code>shadow-cljs</code> won’t properly recompile <code>example.foo</code> when <code>some.thing</code> is changed. It may also lead to other weird race conditions due to parallel compiles. Just don’t do this.</p>\n<h3>Invoking code directly in the namespace</h3>\n<p>Avoid calling code directly in the top level of your namespace since that will be executed every time your code is reloaded. Suppose we didn’t use the <code>:init-fn</code> feature <code>shadow-cljs</code> provides and instead used directly called <code>init</code> ourselves.</p>\n<pre><code>(ns example.app)\n\n...\n\n(defn init []\n  (js/console.log &quot;init&quot;)\n  (start))\n\n(init)\n</code></pre>\n<p>In a <code>release</code> mode app the <code>init</code> would only be called once so everything would be ok but with hot-reloading the full ns will be reloaded and therefore the <code>(init)</code> would execute each time. <code>:init-fn</code> ensures this doesn’t happen and therefore ensures the code is only executed once as intended.</p>\n<p>It may be OK for other code to be directly called in your namespace but be aware that it will get called every time your code is reloaded. Frameworks like <code>re-frame</code> ensure that it properly updates references it creates.</p>\n<p>Note that an exception during the load of a namespace process may break hot-reload entirely. Avoid running code as much as possible and instead use the <code>^:dev/after-load</code> hooks when needed.</p>",
   :direction "ltr"},
  :updated 1566727200000,
  :entities
  [{:mentions [{:text "REPL"}],
    :id "nlp/f/entity/wd:2032810",
    :salienceLevel "mention",
    :label "Read–eval–print loop"}
   {:mentions [{:text "React"}],
    :id "nlp/f/entity/wd:19399674",
    :salienceLevel "mention",
    :label "ReactJS"}
   {:mentions [{:text "bind"} {:text "keyboard shortcut"}],
    :id "nlp/f/entity/wd:118470",
    :salienceLevel "mention",
    :label "keyboard shortcut"}
   {:mentions [{:text "Behind the Scenes"}],
    :id "nlp/f/entity/wd:814486",
    :salienceLevel "mention",
    :label "Behind the Scenes"}
   {:mentions [{:text "HMR"}],
    :id "nlp/f/entity/wd:3887748",
    :salienceLevel "mention",
    :label "Hamar Airport"}],
  :alternate
  [{:href
    "https://code.thheller.com/blog/shadow-cljs/2019/08/25/hot-reload-in-clojurescript.html",
    :type "text/html"}],
  :title "Hot Reload in ClojureScript",
  :author "Thomas Heller",
  :published-str "Sun Aug 25 03:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16ccd186d32:b8c5dc:49b12733",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://code.thheller.com/blog/shadow-cljs/2019/08/25/hot-reload-in-clojurescript",
  :updateCount 1,
  :commonTopics
  [{:score 38.20583441627917,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.917,
    :id "nlp/f/topic/444",
    :salienceLevel "about",
    :label "children"}
   {:score 0.908,
    :id "nlp/f/topic/1555",
    :salienceLevel "about",
    :label "net"}
   {:score 0.899,
    :id "nlp/f/topic/2461",
    :salienceLevel "about",
    :label "web design"}
   {:score 0.829,
    :id "nlp/f/topic/774",
    :salienceLevel "mention",
    :label "engineering"}],
  :published 1566727200000,
  :fingerprint "bcb5f730",
  :canonicalUrl
  "https://code.thheller.com/blog/shadow-cljs/2019/08/25/hot-reload-in-clojurescript.html"}
 {:engagement 5,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1566806442156,
  :recrawled 1566825586734,
  :content
  {:content
   "<p><em>В этой главе мы поговорим о системах. Рассмотрим, как составить проект из\nотдельных частей и заставить их работать вместе.</em></p>\n<h2>\nСодержание\n</h2>\n<ul>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%9F%D0%BE%D0%B4%D1%80%D0%BE%D0%B1%D0%BD%D0%B5%D0%B5-%D0%BE-%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D0%B5\">Подробнее о системе</a></li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%97%D0%B0%D0%B2%D0%B8%D1%81%D0%B8%D0%BC%D0%BE%D1%81%D1%82%D0%B8\">Зависимости</a></li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%9F%D1%80%D0%B5%D0%B8%D0%BC%D1%83%D1%89%D0%B5%D1%81%D1%82%D0%B2%D0%B0\">Преимущества</a></li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%9F%D0%BE%D0%B4%D0%B3%D0%BE%D1%82%D0%BE%D0%B2%D0%BA%D0%B0-%D0%BA-%D0%BE%D0%B1%D0%B7%D0%BE%D1%80%D1%83\">Подготовка к обзору</a></li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%91%D0%B0%D0%B7%D0%B0-%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85\">База данных</a></li>\n<li><a href=\"https://grishaev.me/feed.xml#docker\">Docker</a></li>\n<li><a href=\"https://grishaev.me/feed.xml#mount\">Mount</a> <ul>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%9F%D0%B5%D1%80%D0%B2%D0%B0%D1%8F-%D1%81%D1%83%D1%89%D0%BD%D0%BE%D1%81%D1%82%D1%8C\">Первая сущность</a></li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%A1%D0%B2%D1%8F%D0%B7%D1%8C-%D1%81-%D0%BA%D0%BE%D0%BD%D1%84%D0%B8%D0%B3%D1%83%D1%80%D0%B0%D1%86%D0%B8%D0%B5%D0%B9\">Связь с конфигурацией</a></li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%91%D0%B0%D0%B7%D0%B0-%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85-1\">База данных</a></li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%A4%D0%BE%D0%BD%D0%BE%D0%B2%D0%B0%D1%8F-%D0%B7%D0%B0%D0%B4%D0%B0%D1%87%D0%B0\">Фоновая задача</a></li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%92%D1%81%D0%B5-%D0%B2%D0%BC%D0%B5%D1%81%D1%82%D0%B5\">Все вместе</a></li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%97%D0%B0%D0%B2%D0%B8%D1%81%D0%B8%D0%BC%D0%BE%D1%81%D1%82%D0%B8-1\">Зависимости</a></li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%92%D0%BD%D1%83%D1%82%D1%80%D0%B5%D0%BD%D0%BD%D0%B5%D0%B5-%D1%83%D1%81%D1%82%D1%80%D0%BE%D0%B9%D1%81%D1%82%D0%B2%D0%BE\">Внутреннее устройство</a></li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%A1%D0%BE%D1%81%D1%82%D0%BE%D1%8F%D0%BD%D0%B8%D0%B5\">Состояние</a></li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%92%D1%8B%D0%B1%D0%BE%D1%80%D0%BE%D1%87%D0%BD%D1%8B%D0%B9-%D0%B7%D0%B0%D0%BF%D1%83%D1%81%D0%BA\">Выборочный запуск</a></li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%9F%D1%80%D0%BE%D0%B1%D0%BB%D0%B5%D0%BC%D0%B0-%D0%BF%D0%B5%D1%80%D0%B5%D0%B7%D0%B0%D0%B3%D1%80%D1%83%D0%B7%D0%BA%D0%B8\">Проблема перезагрузки</a></li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%A1%D0%B0%D0%BC%D0%BE%D1%81%D1%82%D0%BE%D1%8F%D1%82%D0%B5%D0%BB%D1%8C%D0%BD%D0%B0%D1%8F-%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D0%B0\">Самостоятельная работа</a></li>\n</ul>\n</li>\n<li><a href=\"https://grishaev.me/feed.xml#component\">Component</a> <ul>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%A3%D1%81%D1%82%D1%80%D0%BE%D0%B9%D1%81%D1%82%D0%B2%D0%BE\">Устройство</a></li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%9F%D0%B5%D1%80%D0%B2%D1%8B%D0%B9-%D0%BA%D0%BE%D0%BC%D0%BF%D0%BE%D0%BD%D0%B5%D0%BD%D1%82\">Первый компонент</a></li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%9A%D0%BE%D0%BD%D1%81%D1%82%D1%80%D1%83%D0%BA%D1%82%D0%BE%D1%80\">Конструктор</a></li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%9E%D1%81%D0%BE%D0%B1%D0%B5%D0%BD%D0%BD%D0%BE%D1%81%D1%82%D1%8C-%D1%81%D0%BB%D0%BE%D1%82%D0%BE%D0%B2\">Особенность слотов</a></li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%9A%D0%BE%D0%BC%D0%BF%D0%BE%D0%BD%D0%B5%D0%BD%D1%82-%D0%B1%D0%B0%D0%B7%D1%8B\">Компонент базы</a></li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%A2%D1%80%D0%B0%D0%BD%D0%B7%D0%B0%D0%BA%D1%86%D0%B8%D0%BE%D0%BD%D0%BD%D1%8B%D0%B9-%D0%BA%D0%BE%D0%BC%D0%BF%D0%BE%D0%BD%D0%B5%D0%BD%D1%82\">Транзакционный компонент</a></li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%92%D0%BE%D1%80%D0%BA%D0%B5%D1%80\">Воркер</a></li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%A0%D1%83%D1%87%D0%BD%D1%8B%D0%B5-%D0%B7%D0%B0%D0%B2%D0%B8%D1%81%D0%B8%D0%BC%D0%BE%D1%81%D1%82%D0%B8\">Ручные зависимости</a></li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%9F%D1%80%D0%BE%D0%BC%D1%8B%D1%88%D0%BB%D0%B5%D0%BD%D0%BD%D0%B0%D1%8F-%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D0%B0\">Промышленная система</a></li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%A5%D1%80%D0%B0%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5-%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D1%8B\">Хранение системы</a></li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%9A%D0%BE%D1%80%D1%80%D0%B5%D0%BA%D1%82%D0%BD%D0%BE%D0%B5-%D0%B7%D0%B0%D0%B2%D0%B5%D1%80%D1%88%D0%B5%D0%BD%D0%B8%D0%B5\">Корректное завершение</a></li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%9E%D0%B6%D0%B8%D0%B4%D0%B0%D0%BD%D0%B8%D0%B5-%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D1%8B\">Ожидание системы</a></li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%A3%D0%BB%D1%83%D1%87%D1%88%D0%B0%D0%B5%D0%BC-%D0%B7%D0%B0%D0%B2%D0%B8%D1%81%D0%B8%D0%BC%D0%BE%D1%81%D1%82%D0%B8\">Улучшаем зависимости</a></li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%93%D1%80%D1%83%D0%BF%D0%BF%D0%B8%D1%80%D0%BE%D0%B2%D0%BA%D0%B0-%D1%81%D0%BB%D0%BE%D1%82%D0%BE%D0%B2\">Группировка слотов</a></li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%A3%D1%81%D0%BB%D0%BE%D0%B2%D0%BD%D0%B0%D1%8F-%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D0%B0\">Условная система</a></li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%A1%D0%BF%D1%83%D1%81%D0%BA-%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D1%8B\">Спуск системы</a></li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%98%D0%B4%D0%B5%D0%BC%D0%BF%D0%BE%D1%82%D0%B5%D0%BD%D1%82%D0%BD%D0%BE%D1%81%D1%82%D1%8C\">Идемпотентность</a></li>\n</ul>\n</li>\n<li><a href=\"https://grishaev.me/feed.xml#integrant\">Integrant</a> <ul>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%91%D0%B0%D0%B7%D0%BE%D0%B2%D0%BE%D0%B5-%D1%83%D1%81%D1%82%D1%80%D0%BE%D0%B9%D1%81%D1%82%D0%B2%D0%BE\">Базовое устройство</a></li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%9F%D0%B5%D1%80%D0%B2%D1%8B%D0%B5-%D0%BA%D0%BE%D0%BC%D0%BF%D0%BE%D0%BD%D0%B5%D0%BD%D1%82%D1%8B\">Первые компоненты</a></li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%97%D0%B0%D0%B2%D0%B8%D1%81%D0%B8%D0%BC%D0%BE%D1%81%D1%82%D0%B8-2\">Зависимости</a></li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%9F%D0%B0%D1%80%D0%B0%D0%BB%D0%BB%D0%B5%D0%BB%D0%B8-%D1%81-component\">Параллели с Component</a></li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%9F%D1%80%D0%BE%D0%B1%D0%BB%D0%B5%D0%BC%D0%B0-%D0%BF%D0%BE%D1%82%D0%B5%D1%80%D0%B8-%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%B9\">Проблема потери ключей</a></li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%A1%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D0%B0-%D0%B2-%D1%84%D0%B0%D0%B9%D0%BB%D0%B5\">Система в файле</a></li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%9D%D0%B0%D1%81%D0%BB%D0%B5%D0%B4%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5-%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%B9\">Наследование ключей</a></li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%94%D1%80%D1%83%D0%B3%D0%B8%D0%B5-%D1%81%D1%82%D0%B0%D0%B4%D0%B8%D0%B8-%D0%BA%D0%BE%D0%BC%D0%BF%D0%BE%D0%BD%D0%B5%D0%BD%D1%82%D0%B0\">Другие стадии компонента</a></li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%9F%D0%BE%D0%B4%D0%B3%D0%BE%D1%82%D0%BE%D0%B2%D0%BA%D0%B0\">Подготовка</a></li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%A1%D0%BF%D0%B5%D0%BA%D0%B0\">Спека</a></li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%9F%D1%80%D0%B8%D0%BE%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0\">Приостановка</a></li>\n</ul>\n</li>\n<li><a href=\"https://grishaev.me/feed.xml#%D0%97%D0%B0%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%BD%D0%B8%D0%B5\">Заключение</a></li>\n</ul>\n<p>Понятие системы тесно связано с конфигурацией, которую мы подробно рассмотрели\nнедавно. На этапе черновика конфигурация и системы составляли одну главу, но со\nвременем стало ясно, что это отдельные темы. Причина кроется не столько в объеме\nматериала, сколько в семантике. Конфигурация и система это не одно и то же.</p>\n<p>Конфигурация учит тому, как получить параметры из внешнего мира. Как выстроить\nэтот процесс согласно производству и пожеланиям команды. Система означает\nвнутреннее устройство программы. Это набор компонентов с логическими связями и\nиерархией.</p>\n<p>Система зависит от конфигурации, но не строго один к одному. Для одной и той же\nконфигурации бывают разные системы и наоборот. Главное отличие в следующем:\nконфигурация отвечает на вопрос как получить параметры, а система знает, как ими\nраспорядиться.</p>\n<h2>Подробнее о системе</h2>\n<p>Понятие системы появилось в момент, когда возник спрос на долгоиграющие\nприложения. При разработке скриптов или утилит этот вопрос не стоял остро. Время\nработы скрипта обычно коротко, и его состояние тоже живет недолго. При\nзавершении программы занятые ресурсы освобождаются, поэтому нет нужды в особом\nконтроле за ними.</p>\n<p>Это не так при работе с серверными приложениями. Они рассчитаны на постоянную\nработу и потому устроены иначе, чем разовые скрипты. Приложение состоит из\nкомпонентов, которые работают в фоне. Каждый компонент выполняет какую-то узкую\nзадачу. При запуске приложение включает компоненты в правильном порядке и строит\nмежду ними связи.</p>\n<p>Компонент это любой объект, который несет состояние. На него действуют две\nоперации: включить и выключить. Как правило, включить компонент означает\nустановить соединение с каким-либо ресурсом, а выключить — закрыть его.</p>\n<p>Типичные компоненты веб-приложения это HTTP-сервер, база данных и кэш. Так,\nчтобы не открывать новое TCP-соединение на каждый запрос к базе, понадобится пул\nсоединений. Но создавать его вручную и передавать в функции это слишком рутинная\nзадача. Должен быть компонент, который при включении открывает пул соединений и\nхранит его внутри. Для сторонних потребителей компонент предлагает функции для\nработы с БД. Внутри эти функции опираются на открытый пул.</p>\n<p>На первый взгляд схема напоминает концепцию ООП и ее принцип инкапсуляции. Но в\nмире Clojure компоненты работают иначе. Пусть читатель не торопится с\nвыводами. Ниже мы рассмотрим техническую разницу между объектами и компонентами.</p>\n<h2>Зависимости</h2>\n<p>Центральная проблема систем это зависимость компонентов друг от друга. В примере\nвыше все компоненты — сервер, база и кэш — работают обособленно. Например,\nподключение к базе требуется только для отдельных страниц, а кэширование\nустроено так, что неработающий кэш не ломает приложение. Говорят, что это\nбазовые компоненты системы.</p>\n<p>Компоненты высокого уровня опираются на базовые. Примером такого компонента\nможет быть фоновый поток, который читает данные из базы и отправляет\nписьма. Будет неправильно, если компонент откроет собственные подключения к\nобоим ресурсам. Вместо этого он принимает уже запущенные компоненты базы и почты\nи работает с ними как с черным ящиком.</p>\n<p>Важно, что компонент не пытается управлять жизненным циклом его зависимостей. В\nмомент старта дочерние компоненты части уже запущены. Порядок запуска и\nостановки компонентов в правильном порядке остается на откуп системы.</p>\n<p>Система это комбинация компонентов с учетом их зависимостей. Ключевая\nобязанность системы — запустить и остановить дерево компонентов в правильном\nпорядке. Например, если компонент A зависит от B и C, то к моменту запуска A\nпоследние два уже должны быть запущены. При завершении программы компонент C\nнельзя тушить до тех пор, пока работает A.</p>\n<p>Технически задача сводится к построению графа зависимостей между\nкомпонентами. При запуске и выключении нужно обойти этот граф так, чтобы\nудовлетворить запросы каждого компонента.</p>\n<p>К продвинутым системам предъявляют дополнительные требования. Например, не\nдопустить ситуацию, когда система запущена частично. Такое возможно, когда один\nиз компонентов выбросил исключение. Включился сервер, почта, а база данных\nнедоступна.</p>\n<p>Это досадная ситуация, потому что мы застряли в пограничном состоянии. С точки\nзрения программы запуск системы не удался. Если починить БД и включить систему\nво второй раз, мы получим другую ошибку. Система попытается включить компоненты,\nкоторые уже работают, что приведет к конфликту в сетевых подключениях.</p>\n<p>Будет правильно, если дойдя до проблемного компонента, загрузчик системы не\nвывалится с исключением, а поместит его в переменную. Затем пойдет в обратном\nнаправлении и выключит все компоненты, что уже успел включить. И только потом\nвыбросит исключение, которое поймал.</p>\n<p>Система должна быть устроена так, чтобы было легко добавить в нее новый\nкомпонент. Чтобы достичь этого, система должна быть описана декларативно. В\nидеальном случае система это структура данных — комбинация словарей и\nсписков. Код загрузки пробегает по этой структуре и включает\nкомпоненты. Расширить систему означает добавить новый узел в коллекцию.</p>\n<p>Когда система знает о зависимостях компонентов, появляется приятная возможность\nзапустить ее подмножество. Например, нужно отладить работу фонового обработчика\nпочты. Это компонент, который зависит от базы и SMTP-сервера. Веб-сервер и кэш в\nданном случае не нужны, и запуск всей системы будет излишним. Продвинутые\nсистемы предлагают функцию с семантикой “запусти это компонент и все его\nзависимости”.</p>\n<h2>Преимущества</h2>\n<p>На первый взгляд кажется, что система — лишнее усложнение в проекте. Это\nдополнительная библиотека, новые соглашения в команде, рефакторинг кода и\nограничения. Но первичные неудобства окупаются со временем.</p>\n<p>Система приводит проект в порядок. С ростом кодовой базы становится критически\nважным, чтобы разные части проекта были выполнены в одном стиле. Это особенно\nудобно, когда продукт состоит из отдельных сервисов. В таких случаях\nразработчиков выручает повторное использование кода, в том числе банальная\n“копипаста”.</p>\n<p>Системы полезны на стадиях производства, особенно тестировании. Для тестов\nзапускают измененную версию системы, где отдельные компоненты работают\nпо-другому. Предположим, для отправки смс в систему подкладывают компонент,\nкоторый пишет сообщения в файл.</p>\n<p>Подобно конфигурации, у системы свой жизненный цикл. Понимая этот цикл, мы можем\nвмешиваться в работу системы и вносить корректировки. Например, на стадии\nопределения системы внедрить операторы <code>if</code>, <code>when</code>, <code>cond-></code>, чтобы добавить\nили убрать компоненты в зависимости от конфигурации.</p>\n<h2>Подготовка к обзору</h2>\n<p>В <a href=\"https://grishaev.me/clj-book-mutability/\">главе об изменяемых данных</a> мы впервые заговорили о\nсистемах. Это был раздел про <code>alter-var-root</code>, и мы только что узнали, как\nменять глобальные переменные. Идея в том, чтобы вынести каждый компонент в\nмодуль и снабдить его функциями <code>start!</code> и <code>stop!</code>. Функции включают и выключают\nсостояние модуля: веб-сервер, базу данных и так далее. Запуск системы сводится к\nвызову функций в правильном порядке.</p>\n<p>Это слабое, любительское решение. Такая система не знает о зависимостях между\nкомпонентами. Она хрупкая, работает в ручном режиме, и любое ее изменение\nтребует проверок.</p>\n<p>В оставшейся части главы мы не будем писать свою систему. В этом нет смысла,\nпотому что при разработке системы важна ее семантика, идеологическая\nчасть. Когда семантика найдена, написать код становится тривиальным занятием.</p>\n<p>В мире Clojure существует несколько библиотек для работы с системами. Мы\nрассмотрим проекты mount, component и integrant. Их кодовые базы невелики,\nкаждая по нескольку сотен строк кода. Библиотеки различаются принципами,\nидеологией при построении систем. Они исповедуют разный подход для описания\nкомпонентов и связей между ними. Тем интересней будет взглянуть на проблему с\nразных сторон.</p>\n<p>Библиотеки специально расставлены в таком порядке. Mount следует первым, потому\nчто с него легче начать. Он будет удачным выбором для начинающих. Component стал\nпромышленным стандартом. Мы уделим ему больше внимания и поэтому поставим в\nсередину. Integrant замыкает обзор, потому что его рассматривают как\nальтернативу Component, с котором читатель уже должен быть знаком.</p>\n<p>В практических примерах нам бы хотелось избежать банальности. Вместо наивных\n<code>foo</code> и <code>bar</code> мы построим настоящую систему, похожую на промышленные\nаналоги. Система состоит из веб-сервера, базы данных и фонового процесса,\nкоторый дополняет базу из внешнего источника.</p>\n<p>Схема специально устроена так, чтобы в ней встречались зависимые\nкомпоненты. Например, фоновый процесс нуждается в компоненте базы данных. Так мы\nнаучимся работать с зависимостями. Топологию системы можно изобразить так:</p>\n<div><div><pre><code>           ┌────────────┐\n           │   Config   │┼──────────────────┐\n           └────────────┘                   │\n                  ┼                         │\n          ┌───────┴──────┐                  │\n          │              │                  │\n   ┌────────────┐  ┌────────────┐    ┌────────────┐\n   │   Server   │  │  Database  │┼───│   Worker   │\n   └────────────┘  └────────────┘    └────────────┘\n</code></pre></div></div>\n<p>Стрелки на схеме означают зависимости. Выражение A → B означает “А зависит\nот В”. В нашей системе все компоненты зависят от конфигурации. Дополнительно\nфоновый обработчик зависит от базы данных. Над этой топологией мы и будем\nработать до конца главы.</p>\n<h2>База данных</h2>\n<p>Отдельно рассмотрим компонент базы данных. В прошлых главах мы упоминали, что\nоткрывать новое соединение на каждый запрос неоптимально. В настоящих проектах с\nбазой работают через пул соединений. Пул это сущность с внутренним состоянием,\nпоэтому его тоже “включают и выключают”.</p>\n<p>Другие обучающие материалы приводят примеры с in-memory базами данных: SQLite,\nH2. Это базы, которые хранят данные в оперативной памяти без доступа к\nдиску. Преимущество в том, что такие базы не нужно устанавливать в систему и\nзапускать в отдельном процессе. Как правило, исходный код этой базы слинкован с\nбиблиотекой для вашего языка. Достаточно подключить зависимость в проект и\nработать с базой как с модулем.</p>\n<p>Вариант с базой в памяти удобен для быстрого старта, но не отражает реалии\nпроизводства — то, к чему мы стремимся в этой книге. Для in-memory-баз не\nиспользуют пулы соединений. В этом нет смысла, потому что данные лежат в памяти\nпроцесса, а не в сети. Поэтому мы используем настоящую реляционную БД PostgreSQL\nв связке с пулом HikariCP.</p>\n<p>В нашей системе работает фоновый процесс, воркер. Это отдельный поток, который\nвыбирает из базы не до конца заполненные записи и извлекает нужную информацию из\nсети. В главе про изменяемость мы рассматривали случай с\nгео-координатами. Мобильное приложение отправляет текущие широту и долготу, и мы\nзаписываем их в базу. Поскольку вывод данных о локации может быть долгим, мы\nделаем это в фоне.</p>\n<p>Для этой главы мы подобрали другой пример. Предположим, фирма ведет свою\nаналитику посещений. Каждый раз, когда кто-то открывает страницу, приложение\nзаписывает в базу ее адрес и базовые поля запроса: заголовок User-Agent,\nIP-адрес клиента. Чтобы строить отчеты в разрезе стран и городов, нужно извлечь\nэти данные из тех, что у нас на руках. Чаще всего это дорогая операция, поэтому\nзаписи присваивают статус “ждет обработки” и выносят логику в фон.</p>\n<h2>Docker</h2>\n<p>Возможно, у вас уже установлен PostgreSQL. Тогда вам останется только создать\nновую базу и таблицу в ней. Если нет, самое время попробовать Docker. Это\nсистема для запуска приложений из образов. Под образом понимают специальный\nфайл, внутри которого спрятано приложение со всем необходимым для\nзапуска. Запущенный образ называют контейнером.</p>\n<p>У контейнеров несколько преимуществ. Приложение запускается в изолированной\nсреде и тем самым отделено от основной системы. Кроме безопасности, это решает\nпроблему чистоты — по завершении контейнер не оставляет следов работы, если это\nне настроено специально.</p>\n<p>Существует публичный репозиторий образов, откуда Docker их\nскачивает. Производители ПО выкладывают образы программ в различных версиях и\nкомплектации. Например, если приложению нужна БД версии 9.3 с определенными\nрасширениями, просто скачайте этот образ. Локальная установка, скорее всего,\nвступит в конфликт с уже имеющейся БД.</p>\n<p>Некоторые образы подготовлены так, что их удобно настроить переменными среды или\nфайлами. Когда вы запускаете базу, то, скорее всего, ожидаете определенные\nтаблицы и данные. Образ postgres устроен так, что при старте он загружает все\n<code>*.sql</code> файлы из папки <code>/docker-entrypoint-initdb.d</code>. Если сопоставить этой\nпапке локальный том с sql-схемой и миграциями, получится готовая база без\nстрочки кода.</p>\n<p>В комплекте с Docker идет утилита docker-compose. Она запускает контейнеры на\nбазе файла конфигурации. Стандартное имя этого файла <code>docker-compose.yaml</code>. Это\nYAML-документ , где перечислены образы и параметры их запуска. В примере ниже\nуказан один контейнер, postgres с определенными портами, томами и переменными\nсреды.</p>\n<div><div><pre><code><span>version</span><span>:</span> <span>'</span><span>2'</span>\n<span>services</span><span>:</span>\n  <span>postgres</span><span>:</span>\n    <span>image</span><span>:</span> <span>postgres</span>\n    <span>volumes</span><span>:</span>\n      <span>-</span> <span>./initdb.d:/docker-entrypoint-initdb.d</span>\n    <span>ports</span><span>:</span>\n      <span>-</span> <span>5432:5432</span>\n    <span>environment</span><span>:</span>\n      <span>POSTGRES_DB</span><span>:</span> <span>book</span>\n      <span>POSTGRES_USER</span><span>:</span> <span>book</span>\n      <span>POSTGRES_PASSWORD</span><span>:</span> <span>book</span>\n</code></pre></div></div>\n<p>В папке <code>initdb.d</code> лежат sql-файлы для старта базы. Нам достаточно файла\n<code>01.init.sql</code> с одной таблицей:</p>\n<div><div><pre><code><span>drop</span> <span>table</span> <span>if</span> <span>exists</span> <span>requests</span><span>;</span>\n<span>create</span> <span>table</span> <span>requests</span> <span>(</span>\n    <span>id</span>            <span>serial</span> <span>primary</span> <span>key</span><span>,</span>\n    <span>created_at</span>    <span>timestamp</span> <span>with</span> <span>time</span> <span>zone</span>\n                    <span>not</span> <span>null</span> <span>default</span> <span>now</span><span>(),</span>\n    <span>path</span>          <span>text</span> <span>not</span> <span>null</span><span>,</span>\n    <span>ip</span>            <span>inet</span> <span>not</span> <span>null</span><span>,</span>\n    <span>is_processed</span>  <span>boolean</span> <span>not</span> <span>null</span> <span>default</span> <span>false</span><span>,</span>\n    <span>zip</span>           <span>text</span><span>,</span>\n    <span>country</span>       <span>text</span><span>,</span>\n    <span>city</span>          <span>text</span><span>,</span>\n    <span>lat</span>           <span>float</span><span>,</span>\n    <span>lon</span>           <span>float</span>\n<span>);</span>\n</code></pre></div></div>\n<p>Если запустить <code>docker-compose up</code>, то через некоторое время в системе\nзаработает сервер PostgreSQL на 5432 порту и готовой базой book.</p>\n<p>Мы не будем уделять внимание установке Docker и тонкостям его настройки,\nпоскольку эта тема заслуживает отдельной книги. Всю необходимую информацию вы\nнайдете на официальном сайте проекта — <a href=\"https://docker.com\">docker.com</a>.</p>\n<h2>Mount</h2>\n<p>Библиотека <a href=\"https://github.com/tolitius/mount\">Mount</a> описывает сущности с двумя состояниями: запущено и\nостановлено. По команде сущность “включается” и принимает значение, которое\nвернул код из фазы старта. При выключении срабатывает код из фазы останова.</p>\n<p>Mount использует некоторые трюки, чтобы максимально упростить работу\nпрограммисту. Ее сущности напоминают глобальные переменные, которые меняют\nзначения по команде. С точки зрения потребителя mount устроен просто, и потому\nудобен для начинающих.</p>\n<p>Центральная точка библиотеки это макрос <code>defstate</code>, который объявляет новую\nсущность. Макрос похож на форму <code>def</code>: он тоже объявляет переменную в текущем\nпространстве. Разница в том, что вместо значения defstate принимает два\nвыражения: первое для старта, второе для остановки.</p>\n<p>Пока сущность не включена, в переменной хранится особое значение\n<code>DerefableState</code>. Когда ее включили, переменная принимает значение, которое\nвернуло выражение старта. Выключение работает слегка по-другому. Выполняется код\nостанова, и переменная становится особым значением <code>NotStartedState</code>.</p>\n<h3>Первая сущность</h3>\n<p>Опишем с помощью Mount компонент веб-сервера. Поместим его в отдельный модуль в\nфайле <code>src/book/systems/mount/server.clj</code>. Приложение app это функция, которая\nвозвращает одинаковый ответ для любого запроса.</p>\n<div><div><pre><code><span>(</span><span>ns</span><span> </span><span>book.systems.mount.server</span><span>\n</span><span>(</span><span>:require</span><span>\n</span><span>[</span><span>mount.core</span><span> </span><span>:as</span><span> </span><span>mount</span><span> </span><span>:refer</span><span> </span><span>[</span><span>defstate</span><span>]]</span><span>\n</span><span>[</span><span>ring.adapter.jetty</span><span> </span><span>:refer</span><span> </span><span>[</span><span>run-jetty</span><span>]]))</span><span>\n</span><span>(</span><span>def</span><span> </span><span>app</span><span> </span><span>(</span><span>constantly</span><span> </span><span>{</span><span>:status</span><span> </span><span>200</span><span> </span><span>:body</span><span> </span><span>&quot;Hello&quot;</span><span>}))</span><span>\n</span><span>(</span><span>defstate</span><span> </span><span>server</span><span>\n</span><span>:start</span><span> </span><span>(</span><span>run-jetty</span><span> </span><span>app</span><span> </span><span>{</span><span>:join?</span><span> </span><span>false</span><span> </span><span>:port</span><span> </span><span>8080</span><span>})</span><span>\n</span><span>:stop</span><span> </span><span>(</span><span>.stop</span><span> </span><span>server</span><span>))</span><span>\n</span></code></pre></div></div>\n<p>В макросе <code>defstate</code> фазы отделены ключами <code>:start</code> и <code>:stop</code>. Пока что мы\nтолько объявили состояние, но ничего не включили. Если выполнить выражение\nserver, увидим примерно следующее:</p>\n<div><div><pre><code><span>#</span><span>mount.core.DerefableState</span><span>[{</span><span>:status</span><span> </span><span>:pending,</span><span> </span><span>:val</span><span> </span><span>nil</span><span>}</span><span> </span><span>0</span><span>x358e34df</span><span>]</span><span>\n</span></code></pre></div></div>\n<p>Чтобы запустить компонент, выполните <code>(mount/start)</code>. Функция пробегает по всем\nобъявленным сущностями и включает их. Выражение <code>(run-jetty ...)</code> под ключом\n<code>:start</code> возвращает объект сервера, который работает в фоне. После запуска\nпроверьте, что сервер работает: по адресу http://127.0.0.1:8080 браузер покажет\nприветствие. Переменная <code>server</code> станет объектом класса <code>Server</code> из пакета\njetty:</p>\n<div><div><pre><code><span>(</span><span>type</span><span> </span><span>server</span><span>)</span><span>\n</span><span>org.eclipse.jetty.server.Server</span><span>\n</span></code></pre></div></div>\n<p>Чтобы выключить систему, выполните <code>(mount/stop)</code>. Обратите внимание, что в\nвыражении <code>(.stop server)</code> сущность обращается к самой себе. Это нормально,\nпотому что на этапе выключения переменная server будет именно тем, что мы\nожидаем. После остановки server станет особым значением, которое означает\nзавершение.</p>\n<div><div><pre><code><span>(</span><span>type</span><span> </span><span>server</span><span>)</span><span>\n</span><span>mount.core.NotStartedState</span><span>\n</span></code></pre></div></div>\n<p>По такому принципу строят систему. Сперва находят сущности, которые работают в\nтечение всего жизненного цикла программы. Как правило, это сетевые подключения\nили фоновые задачи. Затем выносят их в отдельные модули, где описывают логику\nвключения и завершения.</p>\n<h3>Связь с конфигурацией</h3>\n<p>В примере выше мы допускаем ту же ошибку, что и в прошлой главе. Параметры\nсервера “захардкожены” на месте его запуска. Это затрудняет работу с\nпроектом. Параметры каждой сущности должны приходить из конфигурации.</p>\n<p>Мы уже научились работать с конфигурацией и знакомы с cprop, yummy и\nаналогами. В прошлый раз мы запускали ее вручную функцией\n<code>(load-config!)</code>. Поскольку мы строим систему, логично вынести конфигурацию в\nотдельный компонент. При его запуске срабатывают все шаги, что мы рассмотрели\nранее: чтение файла и переменных среды, вывод типов и валидация.</p>\n<p>Поместим конфигурацию в модуль <code>src/book/systems/mount/config.clj</code>. Для\nкраткости опустим описание спеки <code>::config</code>: пусть это будет только проверка на\nсловарь. Фаза <code>:start</code> читает edn-файл, проверяет спекой и возвращает\nданные. Замените <code>:start</code> на вызов библиотеки Yummy, Aero или свое решение.</p>\n<div><div><pre><code><span>(</span><span>ns</span><span> </span><span>book.systems.mount.config</span><span>\n</span><span>(</span><span>:require</span><span>\n</span><span>[</span><span>mount.core</span><span> </span><span>:as</span><span> </span><span>mount</span><span> </span><span>:refer</span><span> </span><span>[</span><span>defstate</span><span>]]</span><span>\n</span><span>[</span><span>clojure.spec.alpha</span><span> </span><span>:as</span><span> </span><span>s</span><span>]</span><span>\n</span><span>[</span><span>clojure.edn</span><span> </span><span>:as</span><span> </span><span>edn</span><span>]))</span><span>\n</span><span>(</span><span>s/def</span><span> </span><span>::config</span><span> </span><span>map?</span><span>)</span><span>\n</span><span>(</span><span>defstate</span><span> </span><span>config</span><span>\n</span><span>:start</span><span>\n</span><span>(</span><span>-></span><span> </span><span>&quot;system.config.edn&quot;</span><span>\n</span><span>slurp</span><span>\n</span><span>edn/read-string</span><span>\n</span><span>(</span><span>as-></span><span> </span><span>config</span><span>\n</span><span>(</span><span>s/conform</span><span> </span><span>::config</span><span> </span><span>config</span><span>))))</span><span>\n</span></code></pre></div></div>\n<p>Для компонента выше не нужна фаза <code>:stop</code>. Конфигурация не содержит открытых\nресурсов, поэтому дополнительная логика останова не требуется.</p>\n<p>Улучшим компонент сервера так, чтобы он зависел от конфигурации. Технически это\nсводится к тому, чтобы импортировать в модуль сервера объект конфигурации и\nработать с ним как с обычным словарем.</p>\n<p>Пусть файл <code>system.config.edn</code> содержит словарь, где ключ это имя компонента, а\nзначение — словарь его параметров. Поместим параметры сервера под ключ <code>:jetty</code>:</p>\n<div><div><pre><code><span>{</span><span>:jetty</span><span> </span><span>{</span><span>:join?</span><span> </span><span>false</span><span> </span><span>:port</span><span> </span><span>8088</span><span>}}</span><span>\n</span></code></pre></div></div>\n<p>Обновим модуль сервера. В список <code>:require</code> добавим импорт конфигурации:</p>\n<div><div><pre><code><span>[</span><span>book.systems.mount.config</span><span> </span><span>:refer</span><span> </span><span>[</span><span>config</span><span>]]</span><span>\n</span></code></pre></div></div>\n<p>Перепишем компонент так, чтобы параметры приходили из словаря:</p>\n<div><div><pre><code><span>(</span><span>defstate</span><span>\n</span><span>server</span><span>\n</span><span>:start</span><span>\n</span><span>(</span><span>let</span><span> </span><span>[{</span><span>jetty-opt</span><span> </span><span>:jetty</span><span>}</span><span> </span><span>config</span><span>]</span><span>\n</span><span>(</span><span>run-jetty</span><span> </span><span>app</span><span> </span><span>jetty-opt</span><span>))</span><span>\n</span><span>:stop</span><span> </span><span>(</span><span>.stop</span><span> </span><span>server</span><span>))</span><span>\n</span></code></pre></div></div>\n<p>На этом этапе у нас уже получилась система из двух компонентов, где один зависит\nот другого. Убедитесь, что после вызова <code>(mount/start)</code> сервер работает как\nожидалось.</p>\n<h3>База данных</h3>\n<p>Подготовим компонент для работы с базой данных. Понадобяться две библиотеки:\n<code>clojure.java.jdbc</code> и <code>hikari-cp</code>. Первая предлагает универсальный доступ к\nреляционным базам данных. Это набор функций, которые работают одинаково для\nразных типов баз. Например, выражения:</p>\n<div><div><pre><code><span>(</span><span>jdbc/get-by-id</span><span> </span><span>db</span><span> </span><span>:users</span><span> </span><span>42</span><span>)</span><span>\n</span><span>(</span><span>jdbc/insert!</span><span> </span><span>db</span><span> </span><span>:users</span><span> </span><span>{</span><span>:name</span><span> </span><span>&quot;Ivan&quot;</span><span> </span><span>:email</span><span> </span><span>&quot;ivan@test.com&quot;</span><span>})</span><span>\n</span></code></pre></div></div>\n<p>прочитают и запишут нового пользователя в PostgreSQL, MySQL или Oracle. Для\nкаждого бекенда JDBC построит правильный SQL-запрос.</p>\n<p>Каждая jdbc-функция принимает первым параметром то, что называется\nJDBC-спекой. В простом случае это словарь с параметрами подключения к базе:\nадрес и порт сервера, имя базы, пользователь и пароль. На каждый запрос JDBC\nсоздает новый источник данных с этими параметрами, открывает соединение,\nобменивается данными и закрывает его.</p>\n<p>Спека может содержать необязательный ключ :datasource с уже подготовленным\nисточником. Тогда JDBC игнорирует другие ключи и работает напрямую с\n<code>:datasource</code>. Библиотека hikari-cp предлагает функцию, чтобы построить источник\nданных с пулом соединений. Каждый раз, когда мы запрашиваем соединение у\nисточника, мы не открываем новое, а получаем одно из созданных ранее.</p>\n<p>Поскольку пул это объект с жизненным циклом, его выносят в компонент. Подготовим\nмодуль <code>src/book/systems/mount/db.clj</code>:</p>\n<div><div><pre><code><span>(</span><span>ns</span><span> </span><span>book.systems.mount.db</span><span>\n</span><span>(</span><span>:require</span><span>\n</span><span>[</span><span>mount.core</span><span> </span><span>:as</span><span> </span><span>mount</span><span> </span><span>:refer</span><span> </span><span>[</span><span>defstate</span><span>]]</span><span>\n</span><span>[</span><span>hikari-cp.core</span><span> </span><span>:as</span><span> </span><span>cp</span><span>]</span><span>\n</span><span>[</span><span>book.systems.mount.config</span><span> </span><span>:refer</span><span> </span><span>[</span><span>config</span><span>]]))</span><span>\n</span><span>(</span><span>defstate</span><span> </span><span>db</span><span>\n</span><span>:start</span><span>\n</span><span>(</span><span>let</span><span> </span><span>[{</span><span>pool-opt</span><span> </span><span>:pool</span><span>}</span><span> </span><span>config</span><span>\n</span><span>store</span><span> </span><span>(</span><span>cp/make-datasource</span><span> </span><span>pool-opt</span><span>)]</span><span>\n</span><span>{</span><span>:datasource</span><span> </span><span>store</span><span>})</span><span>\n</span><span>:stop</span><span>\n</span><span>(</span><span>-></span><span> </span><span>db</span><span> </span><span>:datasource</span><span> </span><span>cp/close-datasource</span><span>))</span><span>\n</span></code></pre></div></div>\n<p>На этапе старта мы возвращаем JDBC-спеку — словарь с одним ключом\n<code>:datasource</code>. На стадии выключения функция <code>close-datasource</code> закрывает пул и\nвсе открытые соединения.</p>\n<p>В файл конфигурации добавим настройки пула:</p>\n<div><div><pre><code><span>{</span><span>:pool</span><span> </span><span>{</span><span>:minimum-idle</span><span> </span><span>10</span><span>\n</span><span>:maximum-pool-size</span><span> </span><span>10</span><span>\n</span><span>:pool-name</span><span> </span><span>&quot;book-pool&quot;</span><span>\n</span><span>:adapter</span><span> </span><span>&quot;postgresql&quot;</span><span>\n</span><span>:username</span><span> </span><span>&quot;book&quot;</span><span>\n</span><span>:password</span><span> </span><span>&quot;book&quot;</span><span>\n</span><span>:database-name</span><span> </span><span>&quot;book&quot;</span><span>\n</span><span>:server-name</span><span> </span><span>&quot;127.0.0.1&quot;</span><span>\n</span><span>:port-number</span><span> </span><span>5432</span><span>}}</span><span>\n</span></code></pre></div></div>\n<p>Для экономии места обозначим только самые важные параметры. Это свойства\nподключения (адрес и имя базы, пользователь, пароль) и размерность\nпула. Дополнительно можно задать тайминг для каждой стадии работы с БД. Полный\nсписок параметров с их описанием перечислен на странице GitHub-проекта.</p>\n<p>Запустите систему и выполните простой запрос:</p>\n<div><div><pre><code><span>(</span><span>mount/start</span><span>)</span><span>\n</span><span>(</span><span>require</span><span> </span><span>'</span><span>[</span><span>clojure.java.jdbc</span><span> </span><span>:as</span><span> </span><span>jdbc</span><span>])</span><span>\n</span><span>(</span><span>jdbc/query</span><span> </span><span>db</span><span> </span><span>&quot;select 42 as answer&quot;</span><span>)</span><span>\n</span><span>;; ({:answer 42})</span><span>\n</span></code></pre></div></div>\n<h3>Фоновая задача</h3>\n<p>Все готово для последнего и самого сложного компонента системы. Это фоновый\nпроцесс, воркер, который работает в отдельном потоке. Процесс выбирает из базы\nне обработанные записи и дополняет пустые поля данными из стороннего сервиса.</p>\n<p>Напомним, что в таблице requests мы храним дату, адрес страницы и IP-адрес\nклиента. Поле <code>is_processed</code> это признак того, была ли уже обработана\nзапись. Искомые поля <code>city</code>, <code>country</code> и другие по умолчанию не заполняются и\nравны <code>null</code>.</p>\n<p>Задача воркера сводится к тому, чтобы каждый интервал времени запрашивать одну\nзапись с флагом <code>NOT is_processed</code>. Затем сделать запрос к сервису, который\nвернет гео-данные по IP. Обновить поля записи и сохранить изменения в базе. Все\nописанное делать в транзакции.</p>\n<p>Подумаем, как выразить воркер в терминах Mount. Поскольку задача работает в\nотдельном потоке, очевидно это будет тред или футура с бесконечным циклом. Но мы\nбы хотели остановить воркер по запросу. Значит, цикл должен быть не бесконечным,\nа с каким-то условием. Например, с проверкой состояния на каждом шаге. Это\nсостояние должно быть доступно и воркеру, и стороннему наблюдателю.</p>\n<p>В Clojure эта задача решается парой атом и футура. В атоме хранят логический\nфлаг — признак продолжения цикла. На каждом шаге футура проверяет флаг, и если\nон истина, то в очередной раз выполняет задачу. Чтобы корректно завершить\nфутуру, мы совершаем два действия. Первое — устанавливаем флаг в ложь. Второе —\nждем до тех пор, пока футура не станет <code>realized</code>. В терминах Clojure это\nзначит, что футура завершила работу с некоторым результатом.</p>\n<p>Подготовим модуль воркера. Понадобится импорт конфигурации, компонента базы,\nлогирование и HTTP-клиент:</p>\n<div><div><pre><code><span>(</span><span>ns</span><span> </span><span>book.systems.mount.worker</span><span>\n</span><span>(</span><span>:require</span><span>\n</span><span>[</span><span>mount.core</span><span> </span><span>:as</span><span> </span><span>mount</span><span> </span><span>:refer</span><span> </span><span>[</span><span>defstate</span><span>]]</span><span>\n</span><span>[</span><span>clojure.java.jdbc</span><span> </span><span>:as</span><span> </span><span>jdbc</span><span>]</span><span>\n</span><span>[</span><span>clj-http.client</span><span> </span><span>:as</span><span> </span><span>client</span><span>]</span><span>\n</span><span>[</span><span>clojure.tools.logging</span><span> </span><span>:as</span><span> </span><span>log</span><span>]</span><span>\n</span><span>[</span><span>book.systems.mount.db</span><span> </span><span>:refer</span><span> </span><span>[</span><span>db</span><span>]]</span><span>\n</span><span>[</span><span>book.systems.mount.config</span><span> </span><span>:refer</span><span> </span><span>[</span><span>config</span><span>]]))</span><span>\n</span></code></pre></div></div>\n<p>Технически компонент сводится к словарю с полями <code>:flag</code> и <code>:task</code>. Первое поле\nхранит атом состояния, а второе футуру.</p>\n<div><div><pre><code><span>(</span><span>defstate</span><span> </span><span>worker</span><span>\n</span><span>:start</span><span>\n</span><span>(</span><span>let</span><span> </span><span>[{</span><span>task-opt</span><span> </span><span>:worker</span><span>}</span><span> </span><span>config</span><span>\n</span><span>flag</span><span> </span><span>(</span><span>atom</span><span> </span><span>true</span><span>)</span><span>\n</span><span>task</span><span> </span><span>(</span><span>make-task</span><span> </span><span>flag</span><span> </span><span>task-opt</span><span>)]</span><span>\n</span><span>{</span><span>:flag</span><span> </span><span>flag</span><span> </span><span>:task</span><span> </span><span>task</span><span>})</span><span>\n</span><span>:stop</span><span>\n</span><span>(</span><span>let</span><span> </span><span>[{</span><span>:keys</span><span> </span><span>[</span><span>flag</span><span> </span><span>task</span><span>]}</span><span> </span><span>worker</span><span>]</span><span>\n</span><span>(</span><span>reset!</span><span> </span><span>flag</span><span> </span><span>false</span><span>)</span><span>\n</span><span>(</span><span>while</span><span> </span><span>(</span><span>not</span><span> </span><span>(</span><span>realized?</span><span> </span><span>task</span><span>))</span><span>\n</span><span>(</span><span>log/info</span><span> </span><span>&quot;Waiting for the task to complete&quot;</span><span>)</span><span>\n</span><span>(</span><span>Thread/sleep</span><span> </span><span>300</span><span>))))</span><span>\n</span></code></pre></div></div>\n<p>В фазе <code>:start</code> мы создали состояние и футуру и вернули их композицию в виде\nсловаря. Функции <code>make-task</code> пока что не существует, но мы считаем, что она\nвернет футуру. В фазе <code>:stop</code> мы возводим состояние в ложь и бесконечно ждем до\nтех пор, пока футура не завершится. Идея в том, что <code>flag</code> доступен внутри\nфутуры, и на очередном шаге она должна проверить его статус и завершиться.</p>\n<p>Код выше учит хорошей практике, о которой следует сказать явно. Код компонента\nне должен быть большим. В компоненте должна быть только его логика, набор\nшагов. Технически возможно описать футуру прямо внутри <code>defstate</code>. Но это займет\nлишних десять строк, и жизненный цикл компонента станет читаться хуже.</p>\n<p>Добавим в EDN-файл параметры воркера. Достаточно одного поля — сколько\nмиллисекунд ждать на каждом шаге цикла.</p>\n<div><div><pre><code><span>{</span><span>:worker</span><span> </span><span>{</span><span>:sleep</span><span> </span><span>1000</span><span>}}</span><span>\n</span></code></pre></div></div>\n<p>Опишем функцию <code>make-task</code>. Она принимает состояние и словарь параметров.</p>\n<div><div><pre><code><span>(</span><span>defn</span><span> </span><span>make-task</span><span>\n</span><span>[</span><span>flag</span><span> </span><span>opt</span><span>]</span><span>\n</span><span>(</span><span>let</span><span> </span><span>[{</span><span>:keys</span><span> </span><span>[</span><span>sleep</span><span>]}</span><span> </span><span>opt</span><span>]</span><span>\n</span><span>(</span><span>future</span><span>\n</span><span>(</span><span>while</span><span> </span><span>@</span><span>flag</span><span>\n</span><span>(</span><span>try</span><span>\n</span><span>(</span><span>task-fn</span><span>)</span><span>\n</span><span>(</span><span>catch</span><span> </span><span>Throwable</span><span> </span><span>e</span><span>\n</span><span>(</span><span>log/error</span><span> </span><span>e</span><span>))</span><span>\n</span><span>(</span><span>finally</span><span>\n</span><span>(</span><span>Thread/sleep</span><span> </span><span>sleep</span><span>)))))))</span><span>\n</span></code></pre></div></div>\n<p>В примере <code>(task-fn)</code> это целевая функция, в которой заключена бизнес-логика\nприложения. Недостаточно просто вызвать эту функцию; нужно обернуть ее в цикл с\nусловием и перехватом ошибок, чтобы футура не завершилась аварийно. Даже если\nпроизошло исключение, мы пишем его в лог и переходим на следующую итерацию.</p>\n<p>Тем временем кто-то мог установить <code>flag</code> в ложь. Если это произошло, мы выходим\nиз цикла <code>while</code> и логика футуры завершается.</p>\n<p>Теперь опишем <code>task-fn</code>. Функция читает из базы записи, которые еще не были\nобработаны. Для каждой записи ищем гео-данные по IP с помощью <code>get-ip-info</code>. Мы\nпока что не знаем, как работает эта функция, но уверены, что это словарь с\nполями <code>:city</code>, <code>:country</code> и так далее. В конце мы обновляем запись этими\nполями.</p>\n<div><div><pre><code><span>(</span><span>defn</span><span> </span><span>task-fn</span><span>\n</span><span>[]</span><span>\n</span><span>(</span><span>jdbc/with-db-transaction</span><span> </span><span>[</span><span>tx</span><span> </span><span>db</span><span>]</span><span>\n</span><span>(</span><span>let</span><span> </span><span>[</span><span>requests</span><span> </span><span>(</span><span>jdbc/query</span><span> </span><span>tx</span><span> </span><span>requests-query</span><span>)]</span><span>\n</span><span>(</span><span>doseq</span><span> </span><span>[</span><span>request</span><span> </span><span>requests</span><span>]</span><span>\n</span><span>(</span><span>let</span><span> </span><span>[{</span><span>:keys</span><span> </span><span>[</span><span>id</span><span> </span><span>ip</span><span>]}</span><span> </span><span>request</span><span>\n</span><span>info</span><span> </span><span>(</span><span>get-ip-info</span><span> </span><span>ip</span><span>)</span><span>\n</span><span>fields</span><span> </span><span>{</span><span>:is_processed</span><span> </span><span>true</span><span>\n</span><span>:zip</span><span> </span><span>(</span><span>:postal_code</span><span> </span><span>info</span><span>)</span><span>\n</span><span>:country</span><span> </span><span>(</span><span>:country_name</span><span> </span><span>info</span><span>)</span><span>\n</span><span>:city</span><span> </span><span>(</span><span>:city</span><span> </span><span>info</span><span>)</span><span>\n</span><span>:lat</span><span> </span><span>(</span><span>:lat</span><span> </span><span>info</span><span>)</span><span>\n</span><span>:lon</span><span> </span><span>(</span><span>:lng</span><span> </span><span>info</span><span>)}]</span><span>\n</span><span>(</span><span>jdbc/update!</span><span> </span><span>tx</span><span> </span><span>:requests</span><span>\n</span><span>fields</span><span>\n</span><span>[</span><span>&quot;id = ?&quot;</span><span> </span><span>id</span><span>]))))))</span><span>\n</span></code></pre></div></div>\n<p>Запрос на чтение мы вынесли в переменную requests-query, чтобы не отвлекаться на\nнего в коде <code>task-fn</code>. Это SQL-выражение с оператором <code>FOR UPDATE</code>. Оператор\nозначает, что выбранная запись блокируется на изменение другими клиентами.</p>\n<div><div><pre><code><span>(</span><span>def</span><span> </span><span>requests-query</span><span>\n</span><span>&quot;SELECT * FROM requests\nWHERE NOT is_processed\nLIMIT 1 FOR UPDATE;&quot;</span><span>)</span><span>\n</span></code></pre></div></div>\n<p>Эффект <code>FOR UPDATE</code> работает только в транзакции, поэтому тело функции обернуто\nв <code>(jdbc/with-db-transaction)</code>. Это макрос, внутри которого доступна\nтранзакционная версия соединения с базой. Символ <code>tx</code> связан с транзакционным\nсоединением, полученным на основе db. Внутри макроса мы передаем в jdbc-функции\n<code>tx</code>, а не <code>db</code>.</p>\n<p>Осталось написать <code>get-ip-info</code>. Это функция, которая обращается стороннему HTTP\nAPI. В нашем случае это один из многочисленных сервисов, который принимает POST\nзапрос с полем ip и возвращает JSON-документ. В промышленных системах это могут\nбыть службы Google или собственная база адресов.</p>\n<div><div><pre><code><span>(</span><span>defn</span><span> </span><span>get-ip-info</span><span>\n</span><span>[</span><span>ip</span><span>]</span><span>\n</span><span>(</span><span>:body</span><span>\n</span><span>(</span><span>client/post</span><span> </span><span>&quot;https://iplocation.com&quot;</span><span>\n</span><span>{</span><span>:form-params</span><span> </span><span>{</span><span>:ip</span><span> </span><span>ip</span><span>}</span><span>\n</span><span>:as</span><span> </span><span>:json</span><span>})))</span><span>\n</span></code></pre></div></div>\n<p>Если вызвать <code>get-ip-info</code> с адресом из диапазона сетей Берлина, получим\nследующий словарь:</p>\n<div><div><pre><code><span>(</span><span>get-ip-info</span><span> </span><span>&quot;85.214.132.117&quot;</span><span>)</span><span>\n</span><span>{</span><span>:postal_code</span><span> </span><span>&quot;12529&quot;</span><span>\n</span><span>:continent_code</span><span> </span><span>&quot;EU&quot;</span><span>\n</span><span>:region_name</span><span> </span><span>&quot;Land Berlin&quot;</span><span>\n</span><span>:city</span><span> </span><span>&quot;Berlin&quot;</span><span>\n</span><span>:isp</span><span> </span><span>&quot;Strato AG&quot;</span><span>\n</span><span>:region</span><span> </span><span>&quot;BE&quot;</span><span>\n</span><span>:country_code</span><span> </span><span>&quot;DE&quot;</span><span>\n</span><span>:country_name</span><span> </span><span>&quot;Germany&quot;</span><span>\n</span><span>:time_zone</span><span> </span><span>&quot;Europe/Berlin&quot;</span><span>\n</span><span>:lat</span><span> </span><span>52.5167</span><span>\n</span><span>:company</span><span> </span><span>&quot;Strato AG&quot;</span><span>\n</span><span>:lng</span><span> </span><span>13.4</span><span>}</span><span>\n</span></code></pre></div></div>\n<p>Тем самым мы описали последний неизвестный элемент воркера, и он готов к\nработе. Проверим его: запишем в базу несколько записей, запустим воркер и через\nнекоторое время прочитаем их снова.</p>\n<div><div><pre><code><span>(</span><span>jdbc/insert!</span><span> </span><span>db</span><span> </span><span>:requests</span><span> </span><span>{</span><span>:path</span><span> </span><span>&quot;/help&quot;</span><span> </span><span>:ip</span><span> </span><span>&quot;31.148.198.0&quot;</span><span>})</span><span>\n</span><span>(</span><span>mount/start</span><span>)</span><span>\n</span><span>;; wait for a while</span><span>\n</span><span>(</span><span>jdbc/query</span><span> </span><span>db</span><span> </span><span>&quot;select * from requests&quot;</span><span>)</span><span>\n</span><span>({</span><span>:path</span><span> </span><span>&quot;/help&quot;</span><span> </span><span>:ip</span><span> </span><span>&quot;31.148.198.0&quot;</span><span> </span><span>:is_processed</span><span> </span><span>true</span><span>\n</span><span>:city</span><span> </span><span>&quot;Pinsk&quot;</span><span> </span><span>:zip</span><span> </span><span>&quot;225710&quot;</span><span> </span><span>:id</span><span> </span><span>1</span><span>\n</span><span>:lon</span><span> </span><span>26.0728</span><span> </span><span>:lat</span><span> </span><span>52.1214</span><span> </span><span>:country</span><span> </span><span>&quot;Belarus&quot;</span><span>})</span><span>\n</span></code></pre></div></div>\n<p>Поля заполнены верно, и мы переходим к последнему этапу.</p>\n<h3>Все вместе</h3>\n<p>Когда все компоненты готовы и работают по отдельности, осталось собрать их в\nединую композицию. Это модуль, который импортирует все компоненты системы. Вызов\n<code>(mount/start)</code> из этого модуля запустит их все.</p>\n<p>Единый модуль решает проблему потерянного компонента. Выше мы упоминали, что\nфункции <code>start</code> и <code>stop</code> работают только с теми компонентами, которые известны\nMount. Например, если загрузить модуль воркера, то Mount будет знать о\nкомпонентах <code>worker</code>, <code>db</code> и <code>config</code>. Модуль <code>book.systems.mount.server</code> не\nбудет загружен, и система не узнает про компонент веб-сервера.</p>\n<p>Объявим модуль <code>book.systems.mount.core</code>. Предоставим функцию <code>start</code> для\nзапуска системы целиком.</p>\n<div><div><pre><code><span>(</span><span>ns</span><span> </span><span>book.systems.mount.core</span><span>\n</span><span>(</span><span>:require</span><span>\n</span><span>[</span><span>mount.core</span><span> </span><span>:as</span><span> </span><span>mount</span><span>]</span><span>\n</span><span>book.systems.mount.server</span><span>\n</span><span>book.systems.mount.worker</span><span>))</span><span>\n</span><span>(</span><span>defn</span><span> </span><span>start</span><span> </span><span>[]</span><span>\n</span><span>(</span><span>mount/start</span><span>))</span><span>\n</span></code></pre></div></div>\n<p>В списке импорта мы не указали модули <code>db</code> и <code>config</code>. В нашем случае это не\nобязательно. Модули <code>server</code> и <code>worker</code> зависят от них, поэтому компилятор\nзагрузит db и config автоматически.</p>\n<h3>Зависимости</h3>\n<p>В начале главы мы говорили о центральной проблеме систем. Это зависимости между\nкомпонентами, их разрешение и порядок обхода. Mount предлагает интересный способ\nрешить эти задачи, и ниже мы рассмотрим его техническое устройство.</p>\n<p>Наверное, читатель заметил, что при объявлении компонента мы не указываем его\nзависимости. Так, worker нуждается в config и db, но об этом нигде не сказано\nявно. Когда мы вызываем <code>(mount/start)</code>, система каким-то образом угадывает\nпорядок запуска компонентов: <code>config</code>, <code>db</code>, <code>worker</code>. Если переставить любые\nдва элемента в этом списке, система не запустится. Как это устроено?</p>\n<p>Чтобы определить порядок компонентов, Mount полагается на компилятор\nClojure. Пространства имен в Clojure работают примерно так же, как и система\nкомпонентов. При загрузке имен компилятор ищет зависимости в теле ns и загружает\nих первыми. Вспомним, как выглядит ns воркера:</p>\n<div><div><pre><code><span>(</span><span>ns</span><span> </span><span>book.systems.mount.worker</span><span>\n</span><span>(</span><span>:require</span><span>\n</span><span>[</span><span>book.systems.mount.db</span><span> </span><span>:refer</span><span> </span><span>[</span><span>db</span><span>]]</span><span>\n</span><span>[</span><span>book.systems.mount.config</span><span> </span><span>:refer</span><span> </span><span>[</span><span>config</span><span>]]))</span><span>\n</span></code></pre></div></div>\n<p>С точки зрения компилятора граф зависимостей выглядит так:</p>\n<div><div><pre><code>\n    ┌──────────────┐\n    │ mount.worker │\n    └──────────────┘\n            │  ┌────────────┐\n            ├─┼│  mount.db  │\n            │  └────────────┘\n            │  ┌───────────────┐\n            └─┼│ mount.config  │\n               └───────────────┘\n</code></pre></div></div>\n<p>Компилятор не загрузит <code>mount.worker</code> до тех пор, пока не разрешит\nзависимости. Он начнет с модуля <code>mount.db</code>. Его упрощенное определение:</p>\n<div><div><pre><code><span>(</span><span>ns</span><span> </span><span>book.systems.mount.db</span><span>\n</span><span>(</span><span>:require</span><span>\n</span><span>[</span><span>book.systems.mount.config</span><span> </span><span>:refer</span><span> </span><span>[</span><span>config</span><span>]]))</span><span>\n</span></code></pre></div></div>\n<p>Что с точки зрения компилятора:</p>\n<div><div><pre><code>    ┌──────────────┐\n    │   mount.db   │\n    └──────────────┘\n            │  ┌───────────────┐\n            └─┼│ mount.config  │\n               └───────────────┘\n</code></pre></div></div>\n<p>Теперь прежде чем загрузить <code>db</code>, компилятор займется <code>config</code>. Будем считать,\nчто <code>config</code> не зависит других модулей, и поэтому будет загружен первым. Затем\nкомпилятор загрузит <code>db</code>. Дальше он поднимется обратно на уровень\n<code>mount.worker</code>. Модуль <code>mount.db</code> загружен, следующий по списку\n<code>mount.config</code>. Но конфигурация уже была загружена на этапе <code>mount.db</code>. В\nClojure модуль не может быть загружен больше одного раза, поэтому компилятор\nпропустит <code>mount.config</code>. И на последнем шаге загрузит <code>mount.worker</code>.</p>\n<p>Мы вывели порядок загрузки модулей: <code>config</code>, <code>db</code>, <code>worker</code>. Это значит, что\nкаждая форма <code>defstate</code> выполняется в такой же последовательности. В этом и\nзаключается трюк: каждый вызов <code>defstate</code> увеличивает внутренний счетчик\nMount. В момент создания компонент запоминает это число. Сущности <code>config</code>, <code>db</code>\nи <code>worker</code> получат номера 1, 2 и 3. Чтобы запустить систему, Mount сортирует\nкомпоненты по возрастанию номера, а чтобы остановить — по убыванию.</p>\n<h3>Внутреннее устройство</h3>\n<p>Mount хранит сведения о компонентах в приватных атомах. Они недоступны сторонним\nмодулям, но Clojure оставляет техническую возможность добраться до них. Когда\nкомпоненты загружены, выполните выражение:</p>\n<div><div><pre><code><span>(</span><span>def</span><span> </span><span>_state</span><span> </span><span>@@</span><span>(</span><span>resolve</span><span> </span><span>'mount.core/meta-state</span><span>))</span><span>\n</span></code></pre></div></div>\n<p>В переменной <code>_state</code> окажется словарь компонентов. Двойной оператор <code>@</code> играет\nследующую роль. Функция <code>resolve</code> по символу возвращает объект <code>Var</code>. Из прошлых\nглав мы помним, что это контейнер, который хранит внутри значение. Первый <code>@</code>\nизвлекает значение из <code>Var</code>. Это атом со словарем. Второй <code>@</code> извлекает словарь\nиз атома.</p>\n<p>Ключ словаря это текстовая ссылка на компонент, например\n<code>#'book.systems.mount.config/config</code>. Ей сопоставлен другой словарь с полной\nинформацией о текущем состоянии компонента. Нас интересует поле <code>:order</code> — тот\nсамый счетчик, по возрастанию которого нужно включать компоненты.</p>\n<p>Расставим компоненты вручную. Видим, что порядок их загрузки верный:</p>\n<div><div><pre><code><span>(</span><span>->></span><span> </span><span>_state</span><span>\n</span><span>vals</span><span>\n</span><span>(</span><span>sort-by</span><span> </span><span>:order</span><span>)</span><span>\n</span><span>(</span><span>map</span><span> </span><span>#</span><span>(</span><span>-></span><span> </span><span>%</span><span> </span><span>:var</span><span> </span><span>meta</span><span> </span><span>:name</span><span>)))</span><span>\n</span><span>;; (config server db worker)</span><span>\n</span></code></pre></div></div>\n<p>Выражение</p>\n<div><div><pre><code><span>@@</span><span>(</span><span>resolve</span><span> </span><span>'mount.core/running</span><span>)</span><span>\n</span></code></pre></div></div>\n<p>вернет словарь запущенных компонентов с похожей структурой. Атом <code>state-seq</code>\nхранит глобальный счетчик компонентов. Чтобы прочитать его, выполните:</p>\n<div><div><pre><code><span>@@</span><span>(</span><span>resolve</span><span> </span><span>'mount.core/state-seq</span><span>)</span><span>\n</span></code></pre></div></div>\n<p>Результатом будет число 4, что верно. Значения от 0 до 3 уже заняты нашими\nкомпонентами.</p>\n<p>Заметим, что при работе с Mount мы не должны изменять его внутренние\nатомы. Примеры выше нужны для того, чтобы читатель лучше понял устройство\nбиблиотеки.</p>\n<h3>Состояние</h3>\n<p>Легкость, с которой компонент изменяется при вызове <code>start</code> и <code>stop</code> напоминает\nмагию. Макрос <code>defstate</code> изящно скрывает технические шаги, которые срабатывают в\nмомент его работы. На нижнем уровне состояние работает на функции\n<code>alter-var-root</code>, которую мы рассмотрели в главе про изменяемость.</p>\n<p>Вспомним, как мы описали компонент сервера:</p>\n<div><div><pre><code><span>(</span><span>defstate</span><span> </span><span>server</span><span>\n</span><span>:start</span><span> </span><span>(</span><span>let</span><span> </span><span>[{</span><span>jetty-opt</span><span> </span><span>:jetty</span><span>}</span><span> </span><span>config</span><span>]</span><span>\n</span><span>(</span><span>run-jetty</span><span> </span><span>app</span><span> </span><span>jetty-opt</span><span>))</span><span>\n</span><span>:stop</span><span> </span><span>(</span><span>.stop</span><span> </span><span>^</span><span>Server</span><span> </span><span>server</span><span>))</span><span>\n</span></code></pre></div></div>\n<p>В общих словах, <code>defstate</code> разворачивается в несколько определений. Это\nглобальная переменная без значения:</p>\n<div><div><pre><code><span>(</span><span>def</span><span> </span><span>server</span><span>)</span><span>\n</span></code></pre></div></div>\n<p>и две анонимные функции старта и останова. Тела функций это формы <code>:start</code> и\n<code>:stop</code>.</p>\n<div><div><pre><code><span>(</span><span>fn</span><span> </span><span>start</span><span> </span><span>[]</span><span>\n</span><span>(</span><span>alter-var-root</span><span> </span><span>#</span><span>'server</span><span>\n</span><span>(</span><span>fn</span><span> </span><span>[</span><span>_</span><span>]</span><span>\n</span><span>(</span><span>let</span><span> </span><span>[{</span><span>jetty-opt</span><span> </span><span>:jetty</span><span>}</span><span> </span><span>config</span><span>]</span><span>\n</span><span>(</span><span>run-jetty</span><span> </span><span>app</span><span> </span><span>jetty-opt</span><span>)))))</span><span>\n</span><span>(</span><span>fn</span><span> </span><span>stop</span><span> </span><span>[]</span><span>\n</span><span>(</span><span>alter-var-root</span><span> </span><span>#</span><span>'server</span><span>\n</span><span>(</span><span>fn</span><span> </span><span>[</span><span>_</span><span>]</span><span>\n</span><span>(</span><span>.stop</span><span> </span><span>^</span><span>Server</span><span> </span><span>server</span><span>))))</span><span>\n</span></code></pre></div></div>\n<p>Mount помещает анонимные функции и прочую информацию в атом <code>meta-state</code>. Чтобы\nвключить компонент, достаточно найти в словаре функцию включения и вызвать\nее. Эта функция назначит переменной <code>#'server</code> новое значение. Остановка\nкомпонента работает аналогично.</p>\n<h3>Выборочный запуск</h3>\n<p>До сих пор мы запускали систему целиком. Вызов <code>(mount/start)</code> без аргументов\nпробегает по meta-state и стартует все компоненты. Но это не всегда\nудобно. Предположим, мы работаем над воркером и хотели бы запустить только его и\nзависимые компоненты. В этом случае веб-сервер не нужен.</p>\n<p>Чтобы запустить только нужные компоненты, их явно передают в функцию. Компонент\nдолжен быть не значением, а объектом <code>Var</code>.</p>\n<div><div><pre><code><span>(</span><span>mount/start</span><span> </span><span>#</span><span>'book.systems.mount.config/config</span><span>\n</span><span>#</span><span>'book.systems.mount.db/db</span><span>\n</span><span>#</span><span>'book.systems.mount.worker/worker</span><span>)</span><span>\n</span></code></pre></div></div>\n<p>Если передать значение, Mount не запустит компонент. В примере ниже не будет\nошибки или сообщения, просто ничего не произойдет:</p>\n<div><div><pre><code><span>;; does nothing</span><span>\n</span><span>(</span><span>mount/start</span><span> </span><span>book.systems.mount.config/config</span><span>\n</span><span>book.systems.mount.db/db</span><span>\n</span><span>book.systems.mount.worker/worker</span><span>)</span><span>\n</span></code></pre></div></div>\n<p>Тот факт, что функция ожидает именно <code>Var</code>, а не значение, сбивает с толку\nновичков. Это не очевидно, поскольку в Clojure мы редко прибегаем к переменным.</p>\n<p>Недостаток ручного запуска в том, что он не контролирует зависимости. Вспомним,\nчто mount не хранит зависимости явно. Библиотека знает только как упорядочить\nкомпоненты, но не как они связаны. Предположим, мы забыли, что базе и воркеру\nтребуется конфигурация:</p>\n<div><div><pre><code><span>(</span><span>mount/start</span><span> </span><span>#</span><span>'book.systems.mount.db/db</span><span>\n</span><span>#</span><span>'book.systems.mount.worker/worker</span><span>)</span><span>\n</span></code></pre></div></div>\n<p>Такой вызов выбросит странное исключение. Оно возникнет в компоненте <code>db</code>, где\nмы попытаемся создать пул из конфигурации. Объект <code>config</code> не запущен, и\nвыражение <code>(:pool config)</code> вернет <code>nil</code>. При попытке создать пул из <code>nil</code>\nполучим исключение.</p>\n<p>С ростом системы становится сложнее отслеживать зависимости. Это слабое место\nMount — запуск подсистемы сводится к ручному перечислению компонентов. Чтобы\nоблегчить этот сценарий, библиотека предлагает вспомогательные функции-селекторы\nкомпонентов: <code>only</code>, <code>except</code> и другие.</p>\n<p>Например, <code>except</code> вернет имена всех компонентов кроме перечисленных. Если если\nпередать результат в start, получим систему без указанных компонентов. Пример\nниже запустит подмножество системы без веб-сервера:</p>\n<div><div><pre><code><span>(</span><span>-></span><span> </span><span>[</span><span>#</span><span>'book.systems.mount.server/server</span><span>]</span><span>\n</span><span>mount/except</span><span>\n</span><span>mount/start</span><span>)</span><span>\n</span></code></pre></div></div>\n<p>Эти функции и их комбинации описаны на странице GitHub проекта.</p>\n<h3>Проблема перезагрузки</h3>\n<p>В режиме разработки наш редактор соединен с REPL-сессией. Когда мы меняем код,\nредактор отправляет изменения на сервер. Возникает вопрос: что случится, если\nвнести правки в уже написанный компонент? Как mount отреагирует на повторную\nзагрузку модуля?</p>\n<p>Если вы работаете в Emacs и Cider, подключитесь к проекту через <code>M-x\ncider-connect</code>. Из модуля <code>book.systems.mount.core</code> запустите систему, как мы\nделали это выше. Теперь откройте модуль сервера. Выполните команду <code>M-x\ncider-eval-buffer</code> (или с клавиатуры через <code>C-c C-k</code>). Команда исполнит\nсодержимое файла сервера. Это значит, что все определения, включая <code>ns</code>, <code>def</code>,\n<code>defstate</code> будут выполнены повторно.</p>\n<p>В сеансе REPL вы увидете логи с текстом, что сервер был остановлен и снова\nзапущен. Mount достаточно умен и учитывает этот сценарий. Макрос <code>defstate</code>\nпроверяет, что такой компонент уже объявлен, и перезагружает его.</p>\n<p>Перезагрузка компонента это не всегда желаемое поведение. Во время интенсивных\nизменений может случиться т.н. “рассинхрон”. Это ситуация, когда компонент\nсчитается выключенным, но ресурс все еще работает. Например, мы допустили ошибку\nв фазе <code>:stop</code> и не вызвали у сервера метод <code>(.stop)</code>. Если выключить такой\nкомпонент и снова включить, мы получим ошибку с семантикой “порт уже занят”.</p>\n<p>Поведение компонента при перезагрузке задают в его метаданных. Это поле\n<code>:on-reload</code>, которое по умолчанию равно <code>:restart</code>. С этим значением компонент\nперезагружает себя при повторном вызове <code>defstate</code>. Если задать <code>:stop</code>,\nкомпонент будет остановлен. Наиболее удобно значение <code>:noop</code>, что значит не\nделать ничего.</p>\n<p>Компонент с метаданными выглядит так:</p>\n<div><div><pre><code><span>(</span><span>defstate</span><span> </span><span>^</span><span>{</span><span>:on-reload</span><span> </span><span>:noop</span><span>}</span><span> </span><span>server</span><span>\n</span><span>:start</span><span> </span><span>(</span><span>run-jetty</span><span> </span><span>app</span><span> </span><span>{</span><span>:join?</span><span> </span><span>false</span><span> </span><span>:port</span><span> </span><span>8080</span><span>})</span><span>\n</span><span>:stop</span><span> </span><span>(</span><span>.stop</span><span> </span><span>server</span><span>))</span><span>\n</span></code></pre></div></div>\n<p>Считается хорошей практикой указывать <code>:on-reload</code> для всех\nкомпонентов. Поведение <code>:noop</code> удобно тем, что освобождает от побочных\nэффектов. Возможно, вы изменили не компонент, а исправили опечатку в соседней\nстроке. Перезагружать компонент в таком случае не требуется. Но даже если\nизменения относятся к компоненту, лучше перезагрузить его вручную.</p>\n<h3>Самостоятельная работа</h3>\n<p>Вспомним, как устроена функция <code>get-ip-info</code> из модуля воркера. Для каждого\nIP-адреса она выполняет HTTP-запрос к серверу. На низком уровне мы каждый раз\nоткрываем TCP-соединение, работаем с ним и закрываем. Это не оптимально, и\nпроблему решают так же, как и с базами данных — пулом постоянных соединений.</p>\n<p>Минимальный пример с жизненным циклом пула</p>\n<div><div><pre><code><span>;; create a new pool</span><span>\n</span><span>(</span><span>def</span><span> </span><span>cm</span><span> </span><span>(</span><span>clj-http.conn-mgr/make-reusable-conn-manager</span><span>\n</span><span>{</span><span>:timeout</span><span> </span><span>2</span><span> </span><span>:threads</span><span> </span><span>3</span><span>}))</span><span>\n</span><span>;; make a request within the pool</span><span>\n</span><span>(</span><span>client/get</span><span> </span><span>&quot;http://example.org/&quot;</span><span>\n</span><span>{</span><span>:connection-manager</span><span> </span><span>cm</span><span>})</span><span>\n</span><span>;; shut down the pool</span><span>\n</span><span>(</span><span>clj-http.conn-mgr/shutdown-manager</span><span> </span><span>cm</span><span>)</span><span>\n</span></code></pre></div></div>\n<p>Найдите <a href=\"https://github.com/dakrone/clj-http\">в документации к clj-http</a> более подробные примеры. Напишите\nкомпонент HTTP-клиента, который выполняет запросы через пул. Параметры\nкомпонента (тайминг, число тредов) приходят из конфигурации. На старте компонент\nзапускает пул, при остановке закрывает его. Перепишите воркер так, чтобы он\nзависел от нового компонента.</p>\n<h2>Component</h2>\n<p>Библиотека <a href=\"https://github.com/stuartsierra/component\">Component</a> тоже служит для описания компонентов и\nсистем. Это небольшой фремворк, в котором главную роль играет не объем кода, а\nидея. Дизайн Component в корне отличаются от техники mount, которую мы\nрассмотрели выше.</p>\n<p>Разница в том, что сущности Component это не глобальные переменные, а обычные\nобъекты. В библиотеке нет скрытых атомов, которые хранят информацию о\nкомпонентах. Программист выстраивает систему явно, подобно тому как мы описываем\nструктуру данных.</p>\n<p>Как и в Mount, на компонент действуют две операции: <code>start</code> и <code>stop</code>. Каждая их\nних возвращает копию компонента в другом состоянии. Функции не меняют исходный\nкомпонент. Можно сказать, что компоненты неизменяемы. Это отсекает целый пласт\nошибок, связанных с состоянием.</p>\n<p>Система это комбинация компонентов с указанием зависимостей. Каждый компонент в\nсистеме носит машинное имя. На первом этапе программист составляет систему в\nсостоянии покоя. Она состоит из компонентов, которые еще не были запущены.</p>\n<p>В момент запуска специальный код обходит компоненты и запускает их. В результате\nполучится запущенная копия системы. Она аналогична исходной, но каждый компонент\nв ней заменен на включенную копию себя. Остановка работает аналогично: вы\nполучите выключенную копию системы.</p>\n<p>Идеи Component не терпят глобального состояния. Один компонент может работать с\nдругим только если это указано в зависимостях. Компонент не должен хранить\nвнутреннее состояние в атоме или другой изменяемой сущности. На каждое действие\nон возвращает новую копию себя.</p>\n<h3>Устройство</h3>\n<p>Технически компонент это объект, который реализует протокол\n<code>Lifecycle</code>. Протокол несет две операции: <code>start</code> и <code>stop</code>. Компоненты удобно\nописывать типизированными словарями. Это сущности, которые объявляют формой\n<code>defrecord</code>. По-другому их называют типизированными записями или “рекорды” с\nударением на первый слог.</p>\n<p>Обычный словарь может содержать любые поля. Запись перечисляет возможные поля в\nмомент объявления. Эти поля называют слотами записи. Доступ к ним работает\nбыстрее, чем у обычного словаря. Компонент резервирует несколько слотов для\nвходных и внутренних параметров.</p>\n<p>Форма <code>defrecord</code> работает в паре с протоколом. При объявлении записи можно\nсразу расширить ее протоколом. Преимущество этого подхода в том, что слоты\nзаписи доступны протоколу как локальные переменные. Это уменьшает код и держит\nнаше внимание на главном.</p>\n<p>Компонент таит в себе состояние, и только он знает, как им управлять. Будет\nгрубой ошибкой “вынимать” из него отдельные поля и передавать их функции. Для\nвнешних потребителей компонент реализует еще один протокол, в котором\nперечислены операции над компонентом.</p>\n<p>Программирование на Component отдаленно напоминает ООП. Компонент это объект с\nданными и фиксированным набором операций над ним. Как и классы, компонент\nинициируют, запускают и останавливают. Разница в том, что, во-первых, компоненты\nнеизменяемы. Переход к новому состоянию не изменяет слоты объекта, в то время\nкак в промышленных ОО-языках мы их перезаписываем.</p>\n<p>Во-вторых, принцип <code>SOLID</code> и классическая тройка инкапсуляция, наследование,\nполиморфизм не имеют той же силы в Clojure. Большая часть этих принципов\nотпадает за ненадобностью. Программируя на Clojure, мы не волнуемся о том, что\nнарушили правила ООП. Код исходит из здравого смысла.</p>\n<h3>Первый компонент</h3>\n<p>Перейдем к практике: перепишем систему из прошлого раздела на Component. Начнем\nс веб-сервера. Поместим его в файл <code>src/book/systems/comp/server.clj</code>. Объявим\nпространство имен:</p>\n<div><div><pre><code><span>(</span><span>ns</span><span> </span><span>book.systems.comp.server</span><span>\n</span><span>(</span><span>:require</span><span>\n</span><span>[</span><span>com.stuartsierra.component</span><span> </span><span>:as</span><span> </span><span>component</span><span>]</span><span>\n</span><span>[</span><span>ring.adapter.jetty</span><span> </span><span>:refer</span><span> </span><span>[</span><span>run-jetty</span><span>]]))</span><span>\n</span></code></pre></div></div>\n<p>Компонент это запись с двумя слотами: <code>options</code> и <code>server</code>. В опциях записаны\nпараметры Jetty-сервера, в server — его экземпляр. Строка <code>component/Lifecycle</code>\nозначает протокол, который реализует запись. Ниже следует реализация протокола.</p>\n<div><div><pre><code><span>(</span><span>defrecord</span><span> </span><span>Server</span><span>\n</span><span>[</span><span>options</span><span> </span><span>server</span><span>]</span><span>\n</span><span>component/Lifecycle</span><span>\n</span><span>(</span><span>start</span><span> </span><span>[</span><span>this</span><span>]</span><span>\n</span><span>(</span><span>let</span><span> </span><span>[</span><span>server</span><span> </span><span>(</span><span>run-jetty</span><span> </span><span>app</span><span> </span><span>options</span><span>)]</span><span>\n</span><span>(</span><span>assoc</span><span> </span><span>this</span><span> </span><span>:server</span><span> </span><span>server</span><span>)))</span><span>\n</span><span>(</span><span>stop</span><span> </span><span>[</span><span>this</span><span>]</span><span>\n</span><span>(</span><span>.stop</span><span> </span><span>server</span><span>)</span><span>\n</span><span>(</span><span>assoc</span><span> </span><span>this</span><span> </span><span>:server</span><span> </span><span>nil</span><span>)))</span><span>\n</span></code></pre></div></div>\n<p>Метод <code>start</code> вернет ту же запись, но с непустым слотом <code>:server</code>. В него\nзаписан объект сервера. Метод <code>stop</code> принимает запущенный компонент. Он\nвыключает сервер и возвращает новый компонент, где слот <code>:server</code> установлен в\nnil.</p>\n<p>Обратите внимание: внутри методов мы свободно обращаемся к слотам записи, словно\nэто локальные переменные. Это работает только в тех случаях, когда методы\nрасположены внутри <code>defrecord</code>. Если мы расширяем запись в отдельной форме,\nнапример через extend, доступ к слотам теряется. Приходится извлекать слоты из\nпеременной <code>this</code>.</p>\n<p>Запустим компонент вручную. Сущность <code>Server</code> это еще не компонент, а его\nабстрактное описание. На первом шаге его инициируют, то есть получают экземпляр\nзаписи. Чтобы создать экземпляр, вызывают функцию <code>map->&lt;Record></code>, где\n<code>&lt;Record></code> это имя записи. Макрос <code>defrecord</code> автоматически порождает эту\nфункцию. В нашем случае это <code>map->Server</code>. Функция принимает обычный словарь и\nвозвращает его типизированную версию. Ключи словаря должны совпадать со слотами\nзаписи. Если ключ не найден, слот равен nil.</p>\n<div><div><pre><code><span>(</span><span>def</span><span> </span><span>s-created</span><span>\n</span><span>(</span><span>map->Server</span><span>\n</span><span>{</span><span>:options</span><span> </span><span>{</span><span>:port</span><span> </span><span>8080</span><span> </span><span>:join?</span><span> </span><span>false</span><span>}}))</span><span>\n</span></code></pre></div></div>\n<p>Переменная <code>s-created</code> это экземпляр записи <code>Server</code>. При инициализации мы\nуказали слот options, но не server. В этом нет смысла, потому что server будет\nзаполнен автоматически в процессе жизненного цикла.</p>\n<div><div><pre><code><span>(</span><span>def</span><span> </span><span>s-started</span><span> </span><span>(</span><span>component/start</span><span> </span><span>s-created</span><span>))</span><span>\n</span></code></pre></div></div>\n<p>Эта строка вернет запущенную версию компонента. Откройте браузер по адресу\nhttp://127.0.0.1:8080/ и проверьте, что сервер работает. На этот раз у записи\n<code>s-started</code> слот <code>:server</code> заполнен:</p>\n<div><div><pre><code><span>(</span><span>-></span><span> </span><span>s-started</span><span> </span><span>:server</span><span> </span><span>type</span><span>)</span><span>\n</span><span>org.eclipse.jetty.server.Server</span><span>\n</span></code></pre></div></div>\n<p>Остановите компонент. Проверьте браузер и слоты <code>s-stopped</code>:</p>\n<div><div><pre><code><span>(</span><span>def</span><span> </span><span>s-stopped</span><span> </span><span>(</span><span>component/stop</span><span> </span><span>s-started</span><span>))</span><span>\n</span></code></pre></div></div>\n<p>Мы прошли жизненный цикл одного компонента. Это инициирование, запуск и\nостановка. Переход на каждую стадию возвращает новую копию. В промышленных\nсистемах вам не придется управлять компонентами поштучно. Этим занимается\nсистема.</p>\n<h3>Конструктор</h3>\n<p>Вспомним, как мы создали экземпляр <code>Server</code>:</p>\n<div><div><pre><code><span>(</span><span>def</span><span> </span><span>s-created</span><span>\n</span><span>(</span><span>map->Server</span><span>\n</span><span>{</span><span>:options</span><span> </span><span>{</span><span>:port</span><span> </span><span>8080</span><span> </span><span>:join?</span><span> </span><span>false</span><span>}}))</span><span>\n</span></code></pre></div></div>\n<p>У такой записи есть недостаток. Мы вынуждены помнить, какие слоты нужны для\nинициализации, а какие для внутреннего использования. Для простых записей это не\nкритично, но в боевых системах встречаются компоненты с десятью и более\nслотами. Чтобы программист не запутался, объявляют функцию-конструктор.</p>\n<p>Конструктор принимает только те аргументы, которые нужны для инициализации\nкомпонента. В нашем случае это options, поэтому функция выглядит так:</p>\n<div><div><pre><code><span>(</span><span>defn</span><span> </span><span>make-server</span><span>\n</span><span>[</span><span>options</span><span>]</span><span>\n</span><span>(</span><span>map->Server</span><span> </span><span>{</span><span>:options</span><span> </span><span>options</span><span>}))</span><span>\n</span><span>(</span><span>def</span><span> </span><span>s-created</span><span> </span><span>(</span><span>make-server</span><span> </span><span>{</span><span>:port</span><span> </span><span>8080</span><span> </span><span>:join?</span><span> </span><span>false</span><span>}))</span><span>\n</span></code></pre></div></div>\n<p>Конструктор упрощает создание сервера. С таким подходом невозможно передать в\n<code>map->Server</code> что-то лишнее. Дополняйте каждый компонент системы конструктором\nдаже в тривиальных случаях.</p>\n<h3>Особенность слотов</h3>\n<p>При остановке компонента мы совершаем два действия: физически выключаем сервер и\nзамещаем его слот значением nil. Читатель заметит, почему бы не заменить <code>assoc</code>\nна <code>dissoc?</code> Зачем хранить nil, когда можно отсоединить поле?</p>\n<div><div><pre><code><span>(</span><span>assoc</span><span> </span><span>this</span><span> </span><span>:server</span><span> </span><span>nil</span><span>)</span><span>\n</span><span>;; should have become</span><span>\n</span><span>(</span><span>dissoc</span><span> </span><span>this</span><span> </span><span>:server</span><span>)</span><span>\n</span></code></pre></div></div>\n<p>Причина в том, как устроены записи и слоты. Запись сохраняет свои уникальные\nсвойства до тех пор, пока все ее слоты на месте. Если забрать у записи слот\nчерез <code>dissoc</code>, получим обычный словарь. Покажем это на примере:</p>\n<div><div><pre><code><span>(</span><span>-></span><span> </span><span>s-stopped</span><span> </span><span>(</span><span>assoc</span><span> </span><span>:server</span><span> </span><span>nil</span><span>)</span><span> </span><span>type</span><span>)</span><span>\n</span><span>book.systems.comp.server.Server</span><span>\n</span><span>(</span><span>-></span><span> </span><span>s-stopped</span><span> </span><span>(</span><span>dissoc</span><span> </span><span>:server</span><span>)</span><span> </span><span>type</span><span>)</span><span>\n</span><span>clojure.lang.PersistentArrayMap</span><span>\n</span></code></pre></div></div>\n<p>Если один компонентов вызывает <code>dissoc</code> на самом себе, при переходе на новую\nстадию мы получим не компонент, а словарь. Это досадная ошибка, которая ведет к\nстранному поведению системы. Например, при попытке выключить компонент он\nпродолжает работу.</p>\n<p>Когда запись расширяют протоколом, тем самым устанавливают связь между типом\nпервого аргумента и логикой. Для аргумента с типом <code>Server</code> методы <code>start</code> и\n<code>stop</code> выполнят одно, для типов <code>DB</code> или <code>Worker</code> — другое. На другие типы\nдействует реализация по умолчанию, которая возвращает this. Это значит, что если\nметод start вернул не компонент, а словарь, мы не сможем вызвать правильный stop\nдля этого словаря.</p>\n<p>Приведем неудачный пример компонента. Его метод <code>start</code> Возвращает словарь с\nодноименным полем <code>server</code>:</p>\n<div><div><pre><code><span>(</span><span>defrecord</span><span> </span><span>BadServer</span><span>\n</span><span>[</span><span>options</span><span> </span><span>server</span><span>]</span><span>\n</span><span>component/Lifecycle</span><span>\n</span><span>(</span><span>start</span><span> </span><span>[</span><span>this</span><span>]</span><span>\n</span><span>{</span><span>:server</span><span> </span><span>(</span><span>run-jetty</span><span> </span><span>app</span><span> </span><span>options</span><span>)})</span><span>\n</span><span>(</span><span>stop</span><span> </span><span>[</span><span>this</span><span>]</span><span>\n</span><span>(</span><span>.stop</span><span> </span><span>server</span><span>)</span><span>\n</span><span>nil</span><span>))</span><span>\n</span></code></pre></div></div>\n<p>Запуск такого компонента сработает без ошибок. Выполнив два выражения ниже,\nпереключитесь браузер и проверьте сервер:</p>\n<div><div><pre><code><span>(</span><span>def</span><span> </span><span>bs-created</span><span> </span><span>(</span><span>map->BadServer</span><span> </span><span>{</span><span>:options</span><span> </span><span>{</span><span>:port</span><span> </span><span>8080</span><span> </span><span>:join?</span><span> </span><span>false</span><span>}}))</span><span>\n</span><span>(</span><span>def</span><span> </span><span>bs-started</span><span> </span><span>(</span><span>component/start</span><span> </span><span>bs-created</span><span>))</span><span>\n</span></code></pre></div></div>\n<p>Но переменная <code>bs-started</code> уже не запись, а словарь. Реализация <code>stop</code> для\nсловаря вернет его же без каких либо действий. Можно сколько угодно вызывать\n<code>component/stop</code>, но сервер не будет остановлен.</p>\n<div><div><pre><code><span>(</span><span>type</span><span> </span><span>bs-started</span><span>)</span><span>\n</span><span>clojure.lang.PersistentArrayMap</span><span>\n</span><span>(</span><span>def</span><span> </span><span>bs-stopped</span><span> </span><span>(</span><span>component/stop</span><span> </span><span>bs-started</span><span>))</span><span>\n</span><span>;; does nothing, the server still works</span><span>\n</span></code></pre></div></div>\n<p>Похожие трудности возникнут, если исправить <code>start</code> без учета <code>stop</code>. При\nостановке плохой компонент выключит сервер, но вернет nil. При запуске nil\nполучим исключение, что тип не реализует протокол <code>Lifecycle</code>.</p>\n<p>Следите за тем, чтобы компонент менял только значения слотов, но не их состав.</p>\n<h3>Компонент базы</h3>\n<p>Напишем компонент для работы с базой данных. Концепция пула соединений уже\nизвестна читателю из прошлых разделов. Компонент содержит два слота: <code>options</code> и\n<code>db-spec</code>. Первый это словарь опций будущего пула. Слот <code>db-spec</code> предназначен\nдля внутреннего использования. Он хранит JDBC-спеку с открытым пулом.</p>\n<div><div><pre><code><span>(</span><span>defrecord</span><span> </span><span>DB</span><span>\n</span><span>[</span><span>options</span><span> </span><span>db-spec</span><span>]</span><span>\n</span><span>component/Lifecycle</span><span>\n</span><span>(</span><span>start</span><span> </span><span>[</span><span>this</span><span>]</span><span>\n</span><span>(</span><span>let</span><span> </span><span>[</span><span>pool</span><span> </span><span>(</span><span>cp/make-datasource</span><span> </span><span>options</span><span>)]</span><span>\n</span><span>(</span><span>assoc</span><span> </span><span>this</span><span> </span><span>:db-spec</span><span> </span><span>{</span><span>:datasource</span><span> </span><span>pool</span><span>})))</span><span>\n</span><span>(</span><span>stop</span><span> </span><span>[</span><span>this</span><span>]</span><span>\n</span><span>(</span><span>-></span><span> </span><span>db-spec</span><span> </span><span>:datasource</span><span> </span><span>cp/close-datasource</span><span>)</span><span>\n</span><span>(</span><span>assoc</span><span> </span><span>this</span><span> </span><span>:db-spec</span><span> </span><span>nil</span><span>)))</span><span>\n</span></code></pre></div></div>\n<p>Добавим функцию-конструктор:</p>\n<div><div><pre><code><span>(</span><span>defn</span><span> </span><span>make-db</span><span> </span><span>[</span><span>options</span><span>]</span><span>\n</span><span>(</span><span>map->DB</span><span> </span><span>{</span><span>:options</span><span> </span><span>options</span><span>}))</span><span>\n</span></code></pre></div></div>\n<p>Компонент готов к запуску, и его можно прогнать через функции <code>make-db</code> →\n<code>component/start</code> → <code>component/stop</code>.</p>\n<p>Пока что неясно, как выполнять запросы через этот компонент. Нас интересует слот\n<code>db-spec</code>, который хранит спеку. Технически возможно вычленить его и передать в\njdbc-функцию:</p>\n<div><div><pre><code><span>(</span><span>let</span><span> </span><span>[{</span><span>:keys</span><span> </span><span>[</span><span>db-spec</span><span>]}</span><span> </span><span>db-started</span><span>\n</span><span>users</span><span> </span><span>(</span><span>jdbc/query</span><span> </span><span>db-spec</span><span> </span><span>&quot;select * from users&quot;</span><span>)]</span><span>\n</span><span>(</span><span>process-users</span><span> </span><span>users</span><span>))</span><span>\n</span></code></pre></div></div>\n<p>Но это варварский подход. Мы не должны вторгаться во внутренности компонента,\nдаже если язык предлагает такую возможность. Этим мы нарушаем концепцию\nкомпонента, который неделим с точки зрения стороннего наблюдателя. В этом плане\nкомпоненты близки к объектам в современных языках.</p>\n<p>Дополним DB методами для работы с базой. Сначала определим протокол с методами\nзапроса и обновления. Сигнатуры аналогичны их jdbc-версиям с той разницей, что\nпервый параметр это не <code>db-спека</code>, а <code>this</code>, компонент:</p>\n<div><div><pre><code><span>(</span><span>defprotocol</span><span> </span><span>IDB</span><span>\n</span><span>(</span><span>query</span><span> </span><span>[</span><span>this</span><span> </span><span>sql-params</span><span>])</span><span>\n</span><span>(</span><span>update!</span><span> </span><span>[</span><span>this</span><span> </span><span>table</span><span> </span><span>set-map</span><span> </span><span>where-clause</span><span>]))</span><span>\n</span></code></pre></div></div>\n<p>В теле <code>defrecord</code>, сразу после <code>stop</code>, поместим реализацию этого\nпротокола. Реализация сводится к jdbc-функциям, в которые мы передаем слот\n<code>:db-spec</code> и аргументы метода.</p>\n<div><div><pre><code><span>(</span><span>;; ........</span><span>\n</span><span>(</span><span>stop</span><span> </span><span>[</span><span>this</span><span>]</span><span>\n</span><span>(</span><span>-></span><span> </span><span>db-spec</span><span> </span><span>:datasource</span><span> </span><span>cp/close-datasource</span><span>)</span><span>\n</span><span>(</span><span>assoc</span><span> </span><span>this</span><span> </span><span>:db-spec</span><span> </span><span>nil</span><span>))</span><span>\n</span><span>IDB</span><span>\n</span><span>(</span><span>query</span><span> </span><span>[</span><span>this</span><span> </span><span>sql-params</span><span>]</span><span>\n</span><span>(</span><span>jdbc/query</span><span> </span><span>db-spec</span><span> </span><span>sql-params</span><span>))</span><span>\n</span><span>(</span><span>update!</span><span> </span><span>[</span><span>this</span><span> </span><span>table</span><span> </span><span>set-map</span><span> </span><span>where-clause</span><span>]</span><span>\n</span><span>(</span><span>jdbc/update!</span><span> </span><span>db-spec</span><span> </span><span>table</span><span> </span><span>set-map</span><span> </span><span>where-clause</span><span>)))</span><span>\n</span></code></pre></div></div>\n<p>На этом этапе компонент уже готов к запросам. Обратите внимание, что мы вызываем\nне jdbc-функции, а методы протокола. Тем самым мы изолируем зависимость от JDBC\nвнутри компонента.</p>\n<div><div><pre><code><span>(</span><span>def</span><span> </span><span>db-created</span><span> </span><span>(</span><span>make-db</span><span> </span><span>options</span><span>))</span><span>\n</span><span>(</span><span>def</span><span> </span><span>db-started</span><span> </span><span>(</span><span>component/start</span><span> </span><span>db-created</span><span>))</span><span>\n</span><span>(</span><span>query</span><span> </span><span>db-started</span><span> </span><span>&quot;select * from requests&quot;</span><span>)</span><span>\n</span><span>(</span><span>update!</span><span> </span><span>db-started</span><span> </span><span>:requests</span><span> </span><span>{</span><span>:is_processed</span><span> </span><span>false</span><span>}</span><span> </span><span>[</span><span>&quot;id = ?&quot;</span><span> </span><span>42</span><span>])</span><span>\n</span><span>(</span><span>def</span><span> </span><span>db-stopped</span><span> </span><span>(</span><span>component/stop</span><span> </span><span>db-started</span><span>))</span><span>\n</span></code></pre></div></div>\n<h3>Транзакционный компонент</h3>\n<p>Из прошлого раздела мы помним, что для согласованных изменений в базе нужны\nтранзакции. Раньше мы пользовались <code>jdbc/with-db-transaction</code>. Он связывает\nсимвол с транзакционным соединением, полученным из обычного.</p>\n<p>Напишем одноименный макрос с такой же сигнатурой. В отличии от JDBC-версии, наш\nмакрос работает с компонентами. Он принимает обычный компонент БД и связывает с\nсимволом его транзакционную версию. Технически макрос сводится к следующим\nшагам:</p>\n<ul>\n<li>получить из компонента текущее соединение;</li>\n<li>обернуть тело в макрос jdbc, получить транзакционное соединение;</li>\n<li>связать с символом <code>comp-tx</code> компонент, у которого слот :db-spec заменен на\nтранзакционное соединение.</li>\n</ul>\n<div><div><pre><code><span>(</span><span>defmacro</span><span> </span><span>with-db-transaction</span><span>\n</span><span>[[</span><span>comp-tx</span><span> </span><span>comp-db</span><span> </span><span>&amp;</span><span> </span><span>trx-opt</span><span>]</span><span> </span><span>&amp;</span><span> </span><span>body</span><span>]</span><span>\n</span><span>`</span><span>(</span><span>let</span><span> </span><span>[{</span><span>db-spec</span><span>#</span><span> </span><span>:db-spec</span><span>}</span><span> </span><span>~</span><span>comp-db</span><span>]</span><span>\n</span><span>(</span><span>jdbc/with-db-transaction</span><span>\n</span><span>[</span><span>t-conn</span><span>#</span><span> </span><span>db-spec</span><span>#</span><span> </span><span>~@</span><span>trx-opt</span><span>]</span><span>\n</span><span>(</span><span>let</span><span> </span><span>[</span><span>~</span><span>comp-tx</span><span> </span><span>(</span><span>assoc</span><span> </span><span>~</span><span>comp-db</span><span> </span><span>:db-spec</span><span> </span><span>t-conn</span><span>#</span><span>)]</span><span>\n</span><span>~@</span><span>body</span><span>))))</span><span>\n</span></code></pre></div></div>\n<p>Читатель заметит, что в макросе мы нарушаем принцип закрытости\nкомпонента. Например, мы вручную читаем и заменяем его приватный слот. В случае\nс макросом это нормально. Подобно компоненту, макрос изолирует низкоуровневые\nдействия, поэтому сторонний потребитель не заметит манипуляций со слотами.</p>\n<p>Пример работы макроса:</p>\n<div><div><pre><code><span>(</span><span>with-db-transaction</span><span>\n</span><span>[</span><span>db-tx</span><span> </span><span>db-started</span><span>]</span><span>\n</span><span>(</span><span>let</span><span> </span><span>[</span><span>requests</span><span> </span><span>(</span><span>query</span><span> </span><span>db-tx</span><span> </span><span>&quot;select * from requests limit 1 for update&quot;</span><span>)]</span><span>\n</span><span>(</span><span>when-let</span><span> </span><span>[</span><span>request</span><span> </span><span>(</span><span>first</span><span> </span><span>requests</span><span>)]</span><span>\n</span><span>(</span><span>update!</span><span> </span><span>db-tx</span><span> </span><span>:requests</span><span> </span><span>{</span><span>:is_processed</span><span> </span><span>false</span><span>}</span><span> </span><span>[</span><span>&quot;id = ?&quot;</span><span> </span><span>(</span><span>:id</span><span> </span><span>request</span><span>)]))))</span><span>\n</span></code></pre></div></div>\n<p>В логах PostgreSQL мы увидим следующие записи:</p>\n<div><div><pre><code><span>BEGIN</span>\n<span>select</span> <span>*</span> <span>from</span> <span>requests</span> <span>limit</span> <span>1</span> <span>for</span> <span>update</span>\n<span>UPDATE</span> <span>requests</span> <span>SET</span> <span>is_processed</span> <span>=</span> <span>$</span><span>1</span> <span>WHERE</span> <span>id</span> <span>=</span> <span>$</span><span>2</span>\n<span>DETAIL</span><span>:</span>  <span>parameters</span><span>:</span> <span>$</span><span>1</span> <span>=</span> <span>'f'</span><span>,</span> <span>$</span><span>2</span> <span>=</span> <span>'3'</span>\n<span>COMMIT</span>\n</code></pre></div></div>\n<p>Выражения <code>select</code> и <code>update</code> действительно выполнены в транзакции.</p>\n<h3>Воркер</h3>\n<p>Напишем компонент воркера. Для этого объявим новый модуль и подключим\nзависимости:</p>\n<div><div><pre><code><span>(</span><span>ns</span><span> </span><span>book.systems.comp.worker</span><span>\n</span><span>(</span><span>:require</span><span>\n</span><span>[</span><span>com.stuartsierra.component</span><span> </span><span>:as</span><span> </span><span>component</span><span>]</span><span>\n</span><span>[</span><span>book.systems.comp.db</span><span> </span><span>:as</span><span> </span><span>db</span><span>]</span><span>\n</span><span>[</span><span>clj-http.client</span><span> </span><span>:as</span><span> </span><span>client</span><span>]</span><span>\n</span><span>[</span><span>clojure.tools.logging</span><span> </span><span>:as</span><span> </span><span>log</span><span>]))</span><span>\n</span></code></pre></div></div>\n<p>Воркер это запись, которая реализует два протокола: <code>Lifecycle</code> и\n<code>IWorker</code>. Протокол <code>Lifecycle</code> уже знаком читателю: это функции <code>start</code> и\n<code>stop</code>. Они опираются на методы <code>IWorker</code>, который выглядит так:</p>\n<div><div><pre><code><span>(</span><span>defprotocol</span><span> </span><span>IWorker</span><span>\n</span><span>(</span><span>make-task</span><span> </span><span>[</span><span>this</span><span>])</span><span>\n</span><span>(</span><span>task-fn</span><span> </span><span>[</span><span>this</span><span>]))</span><span>\n</span></code></pre></div></div>\n<p>Мы ожидаем, что <code>task-fn</code> это функция, которую воркер вызывает на каждом шаге\nцикла. Метод <code>make-task</code> оборачивает ее в цикл и <code>try/catch</code>.</p>\n<p>Запись хранит четыре слота: входные опции, флаг продолжения цикла, футура с\nциклом и база данных. Это зависимый компонент, который мы описали на предыдущем\nшаге. Для начала реализуем <code>Lifecycle</code>:</p>\n<div><div><pre><code><span>(</span><span>defrecord</span><span> </span><span>Worker</span><span>\n</span><span>[</span><span>options</span><span> </span><span>flag</span><span> </span><span>task</span><span> </span><span>db</span><span>]</span><span>\n</span><span>component/Lifecycle</span><span>\n</span><span>(</span><span>start</span><span> </span><span>[</span><span>this</span><span>]</span><span>\n</span><span>(</span><span>let</span><span> </span><span>[</span><span>flag</span><span> </span><span>(</span><span>atom</span><span> </span><span>true</span><span>)</span><span>\n</span><span>this</span><span> </span><span>(</span><span>assoc</span><span> </span><span>this</span><span> </span><span>:flag</span><span> </span><span>flag</span><span>)</span><span> </span><span>;; note</span><span>\n</span><span>task</span><span> </span><span>(</span><span>make-task</span><span> </span><span>this</span><span>)]</span><span>\n</span><span>(</span><span>assoc</span><span> </span><span>this</span><span> </span><span>:task</span><span> </span><span>task</span><span>)))</span><span>\n</span><span>(</span><span>stop</span><span> </span><span>[</span><span>this</span><span>]</span><span>\n</span><span>(</span><span>reset!</span><span> </span><span>flag</span><span> </span><span>false</span><span>)</span><span>\n</span><span>(</span><span>while</span><span> </span><span>(</span><span>not</span><span> </span><span>(</span><span>realized?</span><span> </span><span>task</span><span>))</span><span>\n</span><span>(</span><span>log/info</span><span> </span><span>&quot;Waiting for the task to complete&quot;</span><span>)</span><span>\n</span><span>(</span><span>Thread/sleep</span><span> </span><span>300</span><span>))</span><span>\n</span><span>(</span><span>assoc</span><span> </span><span>this</span><span> </span><span>:flag</span><span> </span><span>nil</span><span> </span><span>:task</span><span> </span><span>nil</span><span>))</span><span>\n</span><span>;; to be continued</span><span>\n</span><span>)</span><span>\n</span></code></pre></div></div>\n<p>Отдельно прокомментируем строку с меткой <code>;; note</code>. Мы заменяем <code>this</code> на его же\nверсию с флагом состояния. Это нужно для того, чтобы <code>make-task</code> смог прочитать\nфлаг из переданного <code>this</code>. Если строку убрать, <code>make-task</code> получит запись с\nфлагом nil, что приведет к ошибке.</p>\n<p>Опишем протокол <code>IWorker</code>. Код <code>make-task</code> и <code>task-fn</code> уже знаком читателю из\nпрошлого раздела про Mount. Разница в том, что теперь мы работаем не с\nфункциями, а методами. Поскольку метод имеет прямой доступ к слотам, нет смысла\nпередавать <code>db</code>, <code>flag</code> и другие параметры, как мы делали это с\nфункциями. Каждый метод принимает только <code>this</code>.</p>\n<div><div><pre><code><span>(</span><span>defrecord</span><span> </span><span>Worker</span><span>\n</span><span>;; skipped</span><span>\n</span><span>IWorker</span><span>\n</span><span>(</span><span>make-task</span><span> </span><span>[</span><span>this</span><span>]</span><span>\n</span><span>(</span><span>future</span><span>\n</span><span>(</span><span>while</span><span> </span><span>@</span><span>flag</span><span>\n</span><span>(</span><span>try</span><span> </span><span>(</span><span>task-fn</span><span> </span><span>this</span><span>)</span><span>\n</span><span>(</span><span>catch</span><span> </span><span>Throwable</span><span> </span><span>e</span><span>\n</span><span>(</span><span>log/error</span><span> </span><span>e</span><span>))</span><span>\n</span><span>(</span><span>finally</span><span>\n</span><span>(</span><span>Thread/sleep</span><span> </span><span>(</span><span>:sleep</span><span> </span><span>options</span><span>)))))))</span><span>\n</span><span>(</span><span>task-fn</span><span> </span><span>[</span><span>this</span><span>]</span><span>\n</span><span>(</span><span>db/with-db-transaction</span><span> </span><span>[</span><span>tx</span><span> </span><span>db</span><span>]</span><span>\n</span><span>(</span><span>when-let</span><span> </span><span>[</span><span>request</span><span> </span><span>(</span><span>first</span><span> </span><span>(</span><span>db/query</span><span> </span><span>tx</span><span> </span><span>requests-query</span><span>))]</span><span>\n</span><span>(</span><span>let</span><span> </span><span>[{</span><span>:keys</span><span> </span><span>[</span><span>id</span><span> </span><span>ip</span><span>]}</span><span> </span><span>request</span><span>\n</span><span>info</span><span> </span><span>(</span><span>get-ip-info</span><span> </span><span>ip</span><span>)</span><span>\n</span><span>fields</span><span> </span><span>{</span><span>:is_processed</span><span> </span><span>true</span><span>\n</span><span>:zip</span><span> </span><span>(</span><span>:postal_code</span><span> </span><span>info</span><span>)</span><span>\n</span><span>:lat</span><span> </span><span>(</span><span>:lat</span><span> </span><span>info</span><span>)</span><span>\n</span><span>:lon</span><span> </span><span>(</span><span>:lng</span><span> </span><span>info</span><span>)}]</span><span>\n</span><span>(</span><span>db/update!</span><span> </span><span>tx</span><span> </span><span>:requests</span><span> </span><span>fields</span><span> </span><span>[</span><span>&quot;id = ?&quot;</span><span> </span><span>id</span><span>]))))))</span><span>\n</span></code></pre></div></div>\n<p>Добавим конструктор, и компонент готов:</p>\n<div><div><pre><code><span>(</span><span>defn</span><span> </span><span>make-worker</span><span>\n</span><span>[</span><span>options</span><span>]</span><span>\n</span><span>(</span><span>map->Worker</span><span> </span><span>{</span><span>:options</span><span> </span><span>options</span><span>}))</span><span>\n</span></code></pre></div></div>\n<h3>Ручные зависимости</h3>\n<p>Воркер отличается от других компонентов тем, что имеет зависимости. Пока что не\nясно, как воркер узнает о базе данных, потому что его конструктор принимает\nтолько опции. Забегая вперед скажем, что эту проблему решает система, а не\nразработчик. Мы не должны передавать компоненты друг другу в момент их создания.</p>\n<p>Хотелось бы проверить воркер до того, как мы двинемся дальше. Во время\nразработки это правило можно нарушить. Мы вручную соберем мини-систему из двух\nкомпонентов. Так мы проверим код, который написали и поймем, как работает\nсистема.</p>\n<p>Проведем эксперимент с системой в отдельном модуле core. Импортируйте в него\nконструкторы и библиотеку Component:</p>\n<div><div><pre><code><span>(</span><span>ns</span><span> </span><span>book.systems.comp.core</span><span>\n</span><span>(</span><span>:require</span><span>\n</span><span>[</span><span>com.stuartsierra.component</span><span> </span><span>:as</span><span> </span><span>component</span><span>]</span><span>\n</span><span>[</span><span>book.systems.comp.server</span><span> </span><span>:refer</span><span> </span><span>[</span><span>make-server</span><span>]]</span><span>\n</span><span>[</span><span>book.systems.comp.worker</span><span> </span><span>:refer</span><span> </span><span>[</span><span>make-worker</span><span>]]</span><span>\n</span><span>[</span><span>book.systems.comp.db</span><span> </span><span>:refer</span><span> </span><span>[</span><span>make-db</span><span>]]))</span><span>\n</span></code></pre></div></div>\n<p>Наивная система приведена ниже. Это функция, которая принимает конфигурацию. Мы\nвручную запускаем базу и воркер и возвращаем словарь компонентов. В строке с\nкомментарием вы передаем воркеру слот с компонентом базы. Важен момент, в\nкоторый мы это делаем. Компонент базы уже должен быть включен, а воркер еще нет.</p>\n<div><div><pre><code><span>(</span><span>defn</span><span> </span><span>my-system-start</span><span>\n</span><span>[</span><span>config</span><span>]</span><span>\n</span><span>(</span><span>let</span><span> </span><span>[{</span><span>db-opt</span><span> </span><span>:pool</span><span>\n</span><span>worker-opt</span><span> </span><span>:worker</span><span>}</span><span> </span><span>config</span><span>\n</span><span>db</span><span> </span><span>(</span><span>-></span><span> </span><span>db-opt</span><span>\n</span><span>make-db</span><span>\n</span><span>component/start</span><span>)</span><span>\n</span><span>worker</span><span> </span><span>(</span><span>-></span><span> </span><span>worker-opt</span><span>\n</span><span>make-worker</span><span>\n</span><span>(</span><span>assoc</span><span> </span><span>:db</span><span> </span><span>db</span><span>)</span><span> </span><span>;; note</span><span>\n</span><span>component/start</span><span>)]</span><span>\n</span><span>{</span><span>:db</span><span> </span><span>db</span><span> </span><span>:worker</span><span> </span><span>worker</span><span>}))</span><span>\n</span></code></pre></div></div>\n<p>Чтобы запустить систему, передайте в функцию словарь с параметрами пула и\nворкера. Сохраните систему в переменной, чтобы выключить ее позже.</p>\n<div><div><pre><code><span>(</span><span>def</span><span> </span><span>_sys</span><span> </span><span>(</span><span>my-system-start</span><span> </span><span>{</span><span>:pool</span><span> </span><span>{</span><span>...</span><span>}</span><span> </span><span>:worker</span><span> </span><span>{</span><span>...</span><span>}}))</span><span>\n</span></code></pre></div></div>\n<p>Пока система работает, проверьте ее, как мы делали это в прошлом\nразделе. Добавьте несколько записей в таблицу <code>requests</code> и убедитесь, что воркер\nдополняет поля.</p>\n<p>Функция выключения останавливает компоненты в верном порядке.</p>\n<div><div><pre><code><span>(</span><span>defn</span><span> </span><span>my-system-stop</span><span>\n</span><span>[</span><span>system</span><span>]</span><span>\n</span><span>(</span><span>-></span><span> </span><span>system</span><span>\n</span><span>(</span><span>update</span><span> </span><span>:worker</span><span> </span><span>component/stop</span><span>)</span><span>\n</span><span>(</span><span>update</span><span> </span><span>:db</span><span> </span><span>component/stop</span><span>)))</span><span>\n</span><span>(</span><span>my-system-stop</span><span> </span><span>_sys</span><span>)</span><span>\n</span></code></pre></div></div>\n<h3>Промышленная система</h3>\n<p>Рассмотрим, как работает настоящая, промышленная система. Функция <code>system-map</code>\nпринимает цепочку значений, где каждый нечетный элемент это ключ, машинное имя\nкомпонента в системе. Четные элементы это инициированные компоненты (т.е. вызовы\nих конструкторов). Функция возвращает систему в состоянии покоя.</p>\n<p>Построение системы не должно носить побочных эффектов. Технически вызов\n<code>system-map</code> аналогичен объявлению структуры данных. Конструкторы компонентов\nтолько возвращают экземпляры записей с заполненными слотами. Если конструктор\nобращается к консоли, диску и глобальному состоянию, это грубая ошибка.</p>\n<p>Поскольку система зависит от конфигурации, ее построение оборачивают в отдельную\nфункцию <code>make-system</code>. Эта функция принимает словарь конфигурации и разделяет\nего на составные части. Каждый конструктор вызывается со своей\nпод-конфигурацией. Удобно, когда конфигурация повторяет топологию системы: на\nверхнем уровне ключи компонентов, а под ними словари опций.</p>\n<p>Чтобы сообщить компоненту зависимости, его оборачивают в функцию\n<code>component/using</code>. Вторым аргументом передают ключи компонентов, которые\nнеобходимо сообщить целевому компоненту до его старта. Ключи могут быть вектором\nили словарем. Если имя слота совпадает с именем компонента в системе, это\nвектор. Если имена отличаются, передают словарь вида <code>{:slot-name\n:system-name}</code>.</p>\n<p>В примере ниже функция <code>make-system</code> строит систему, о которой мы договаривались\nв начале главы. Компонент <code>worker</code>, который зависит от базы данных, обернут в\n<code>component/using</code>. Поскольку имя слота <code>:db</code> совпадает с именем компонента в\nсистеме, мы передали вектор <code>[:db]</code>.</p>\n<div><div><pre><code><span>(</span><span>defn</span><span> </span><span>make-system</span><span>\n</span><span>[</span><span>config</span><span>]</span><span>\n</span><span>(</span><span>let</span><span> </span><span>[{</span><span>:keys</span><span> </span><span>[</span><span>jetty</span><span> </span><span>pool</span><span> </span><span>worker</span><span>]}</span><span> </span><span>config</span><span>]</span><span>\n</span><span>(</span><span>component/system-map</span><span>\n</span><span>:server</span><span> </span><span>(</span><span>make-server</span><span> </span><span>jetty</span><span>)</span><span>\n</span><span>:db</span><span> </span><span>(</span><span>make-db</span><span> </span><span>pool</span><span>)</span><span>\n</span><span>:worker</span><span> </span><span>(</span><span>component/using</span><span>\n</span><span>(</span><span>make-worker</span><span> </span><span>worker</span><span>)</span><span>\n</span><span>[</span><span>:db</span><span>]))))</span><span>\n</span></code></pre></div></div>\n<p>Если бы имя компонента в системе было <code>:storage</code>, мы бы передали словарь\nсоответствия имен:</p>\n<div><div><pre><code><span>(</span><span>component/system-map</span><span>\n</span><span>:server</span><span> </span><span>(</span><span>make-server</span><span> </span><span>jetty</span><span>)</span><span>\n</span><span>:storage</span><span> </span><span>(</span><span>make-db</span><span> </span><span>pool</span><span>)</span><span>\n</span><span>:worker</span><span> </span><span>(</span><span>component/using</span><span>\n</span><span>(</span><span>make-worker</span><span> </span><span>worker</span><span>)</span><span>\n</span><span>{</span><span>:db</span><span> </span><span>:storage</span><span>}))</span><span>\n</span></code></pre></div></div>\n<p>Вариант со словарем полезен, когда вы подключаете сторонние компоненты. Их\nразработчики не знают наверняка, как именуют сущности в вашем проекте. Например,\nчужой компонент зависит от некого <code>:storage</code>. Это слишком абстрактное имя: в\nсистеме бывает несколько хранилищ данных: <code>:postgres</code>, <code>:cassandra</code>,\n<code>:redis</code>. Система маппинга снимает проблему расхождения имен.</p>\n<p>Чтобы запустить систему, ее передают в <code>component/start</code>. Система реализует\nпротокол <code>Lifecycle</code> и с технической точки зрения ведет себя как\nкомпонент. Разница в том, что система аккумулирует другие компоненты и управляет\nих жизненным циклом.</p>\n<p>В момент запуска алгоритм обходит компоненты и строит граф зависимостей. Из\nэтого графа система выводит порядок обхода. Перед тем как запустить компонент с\nзависимостями, система сообщает их компоненту через assoc, как мы делали это\nвыше. Аналогично работает выключение системы.</p>\n<div><div><pre><code><span>(</span><span>def</span><span> </span><span>config</span><span> </span><span>{</span><span>...</span><span>})</span><span>\n</span><span>(</span><span>def</span><span> </span><span>sys-init</span><span> </span><span>(</span><span>make-system</span><span> </span><span>config</span><span>))</span><span>\n</span><span>(</span><span>def</span><span> </span><span>sys-started</span><span> </span><span>(</span><span>component/start</span><span> </span><span>sys-init</span><span>))</span><span>\n</span><span>(</span><span>def</span><span> </span><span>sys-stopped</span><span> </span><span>(</span><span>component/stop</span><span> </span><span>sys-started</span><span>))</span><span>\n</span></code></pre></div></div>\n<h3>Хранение системы</h3>\n<p>Выше мы определили систему через <code>def</code>, что не совсем правильно. Система это\nсущность, которая включается по требованию. Считается грубой ошибкой, если форма\ndef срабатывает в функции, а не на верхнем уровне модуля. Поэтому с системой\nобращаются как глобальной переменной, которая меняет значение. С технической\nстороны для этого подходит <code>alter-var-root</code>.</p>\n<p>В главном модуле приложения выделяют переменную для глобальной системы. Ее\nобъявляют через defonce, чтобы случайно не переопределить ее при перезагрузке\nмодуля. Функция alter-system это сокращенная версия <code>(alter-var-root #'system\n...)</code>. Код с ней получается короче.</p>\n<p>Как мы выяснили, компонент может находиться в трех состояниях: покой, запуск и\nостановка. То же самое применимо к системе. Функции <code>system-init</code>,\n<code>system-start</code> и <code>system-stop</code> устанавливают глобальную систему в нужное\nсостояние. Первая функция принимает словарь конфигурации.</p>\n<div><div><pre><code><span>(</span><span>defonce</span><span> </span><span>system</span><span> </span><span>nil</span><span>)</span><span>\n</span><span>(</span><span>def</span><span> </span><span>alter-system</span><span> </span><span>(</span><span>partial</span><span> </span><span>alter-var-root</span><span> </span><span>#</span><span>'system</span><span>))</span><span>\n</span><span>(</span><span>defn</span><span> </span><span>system-init</span><span> </span><span>[</span><span>config</span><span>]</span><span>\n</span><span>(</span><span>alter-system</span><span> </span><span>(</span><span>constantly</span><span> </span><span>(</span><span>make-system</span><span> </span><span>config</span><span>))))</span><span>\n</span><span>(</span><span>defn</span><span> </span><span>system-start</span><span> </span><span>[]</span><span>\n</span><span>(</span><span>alter-system</span><span> </span><span>component/start</span><span>))</span><span>\n</span><span>(</span><span>defn</span><span> </span><span>system-stop</span><span> </span><span>[]</span><span>\n</span><span>(</span><span>alter-system</span><span> </span><span>component/stop</span><span>))</span><span>\n</span></code></pre></div></div>\n<p>Этот простой код дает все необходимое, чтобы управлять приложением. Функция\n<code>-main</code> приложения сводится к трем шагам: чтению конфигурации, подготовке\nсистемы и ее запуску.</p>\n<div><div><pre><code><span>(</span><span>defn</span><span> </span><span>-main</span><span> </span><span>[</span><span>&amp;</span><span> </span><span>args</span><span>]</span><span>\n</span><span>(</span><span>let</span><span> </span><span>[</span><span>config</span><span> </span><span>(</span><span>load-config</span><span> </span><span>&quot;config.edn&quot;</span><span>)]</span><span>\n</span><span>(</span><span>system-init</span><span> </span><span>config</span><span>)</span><span>\n</span><span>(</span><span>system-start</span><span>)))</span><span>\n</span></code></pre></div></div>\n<p>Заметим, что хотя система и глобальна, к ней нельзя обращаться напрямую. Если\nодин компонент извлекает другой из недр системы, это провал разработчика. Такой\nподход сводит на нет саму идею системы и компонентов. Обращаться к системе\nнапрямую можно только в режиме разработки или тестов.</p>\n<p>Для большей надежности переменную системы делают приватной:</p>\n<div><div><pre><code><span>(</span><span>defonce</span><span> </span><span>^</span><span>:private</span><span> </span><span>system</span><span> </span><span>nil</span><span>)</span><span>\n</span></code></pre></div></div>\n<p>Этим мы обезопасим систему от обращения извне. В режиме разработки нам все еще\nдоступен трюк с resolve и символом переменной, чтобы сослаться на нее.</p>\n<h3>Корректное завершение</h3>\n<p>Подход с глобальной переменной идет вразрез с тем, что пишет автор\nбиблиотеки. На странице проекта в его описании встречается следующая фраза:</p>\n<blockquote>\n<p>In production, the system map is ephemeral. It is used to start all the\ncomponents running, then it is discarded.</p>\n</blockquote>\n<p>Что в переводе:</p>\n<blockquote>\n<p>В промышленном запуске система эфемерна. Она запускает все компоненты и затем\nисчезает.</p>\n</blockquote>\n<p>Это редкий случай, когда мы не согласимся с автором. Даже в боевом режиме вам\nнужна ссылка на систему. Без ссылки невозможно выполнить т.н. “graceful\nshutdown”, что значит корректно завершить программу. Под корректностью понимают\nфакт того, что все ресурсы были закрыты.</p>\n<p>Система управляет состоянием приложения. Некоторые его части бывают очень\nсложны: это очереди задач, каналы данных, транзакции. При завершении программы\nмы не можем полагаться на стандартные средства JVM. Например, если вынужденно\nзаверить компонент очереди, мы потеряем сообщение или обработаем его дважды. Мы\nобязаны закрыть ресурсы правильно, даже если придется подождать.</p>\n<p>В боевом режиме приложение перехватывает <code>POSIX</code>-сигналы и реагирует на них\nдолжным образом. Например, если поступил <code>SIGTERM</code>, приложение останавливает\nсистему, дожидается ее остановки и только потом завершается.</p>\n<p>Библиотека <code>spootnik/signal</code> предлагает изящный макрос, чтобы связать сигнал с\nреакцией на него. Подключите библиотеку в проект и модуль core:</p>\n<div><div><pre><code><span>;; project.clj</span><span>\n</span><span>[</span><span>spootnik/signal</span><span> </span><span>&quot;0.2.2&quot;</span><span>]</span><span>\n</span><span>;; src/book/systems/comp/core.clj</span><span>\n</span><span>(</span><span>ns</span><span> </span><span>...</span><span>\n</span><span>(</span><span>:require</span><span> </span><span>[</span><span>signal.handler</span><span> </span><span>:refer</span><span> </span><span>[</span><span>with-handler</span><span>]]))</span><span>\n</span></code></pre></div></div>\n<p>Расширьте функцию <code>-main</code>: сразу после запуска системы добавьте обработчики\nсигналов <code>SIGTERM</code>, <code>SIGINT</code> и <code>SIGHUP</code>. На первые два мы завершаем систему и\nвыходим из программы. Сигнал <code>SIGHUP</code> мы расцениваем как сигнал к перезагрузке\nсистемы. В примере ниже функция <code>(exit)</code> это аналог <code>(System/exit)</code> с\nдополнительной логикой.</p>\n<div><div><pre><code><span>(</span><span>with-handler</span><span> </span><span>:term</span><span>\n</span><span>(</span><span>log/info</span><span> </span><span>&quot;caught SIGTERM, quitting&quot;</span><span>)</span><span>\n</span><span>(</span><span>system-stop</span><span>)</span><span>\n</span><span>(</span><span>log/info</span><span> </span><span>&quot;all components shut down&quot;</span><span>)</span><span>\n</span><span>(</span><span>exit</span><span>))</span><span>\n</span><span>(</span><span>with-handler</span><span> </span><span>:int</span><span>\n</span><span>(</span><span>log/info</span><span> </span><span>&quot;caught SIGINT, quitting&quot;</span><span>)</span><span>\n</span><span>(</span><span>system-stop</span><span>)</span><span>\n</span><span>(</span><span>log/info</span><span> </span><span>&quot;all components shut down&quot;</span><span>)</span><span>\n</span><span>(</span><span>exit</span><span>))</span><span>\n</span><span>(</span><span>with-handler</span><span> </span><span>:hup</span><span>\n</span><span>(</span><span>log/info</span><span> </span><span>&quot;caught SIGHUP, reloading&quot;</span><span>)</span><span>\n</span><span>(</span><span>system-stop</span><span>)</span><span>\n</span><span>(</span><span>system-start</span><span>)</span><span>\n</span><span>(</span><span>log/info</span><span> </span><span>&quot;system reloaded&quot;</span><span>))</span><span>\n</span></code></pre></div></div>\n<p>Заметим, что обработка сигналов не работает, когда проект запущен через <code>lein\nrun</code> или вручную в REPL-сеансе. Чтобы проверить сигналы, скомпилируйте uberjar и\nзапустите его как java-приложение.</p>\n<div><div><pre><code>lein uberjar\njava <span>-jar</span> target/myproject.jar\n</code></pre></div></div>\n<p>После запуска нажмите <code>Ctrl-C</code>. Приложение завершится не сразу, и вы увидите\nлоги о том, что система остановлена.</p>\n<p>При работе с системой позаботьтесь о том, чтобы безопасно остановить ее даже в\nаварийном случае.</p>\n<h3>Ожидание системы</h3>\n<p>Вспомним функцию <code>-main</code> приложения. Это входная точка старта Java-программы:</p>\n<div><div><pre><code><span>(</span><span>defn</span><span> </span><span>-main</span><span> </span><span>[</span><span>&amp;</span><span> </span><span>args</span><span>]</span><span>\n</span><span>(</span><span>let</span><span> </span><span>[</span><span>config</span><span> </span><span>(</span><span>load-config</span><span> </span><span>&quot;config.edn&quot;</span><span>)]</span><span>\n</span><span>(</span><span>system-init</span><span> </span><span>config</span><span>)</span><span>\n</span><span>(</span><span>system-start</span><span>)))</span><span>\n</span></code></pre></div></div>\n<p>У читателя, не знакомого с тонкостями JVM, возникнет вопрос. Что помешает\nпрограмме завершиться после вызова <code>(system-start)</code>? Ниже этой формы нет\nкакого-то бесконечного цикла, хука или события. Почему платформа продолжит\nработу?</p>\n<p>Это стандартное поведение JVM. Если программа завершается не аварийно, главный\nтред ожидает, пока не остановятся остальные. Запуск системы порождает состояние\nв новых потоках (сервер, пул соединений). Поэтому после <code>(system-start)</code>\nосновной поток повиснет в ожидании их завершения. Он будет ждать до тех пор,\nпока систему не выключит кто-то другой и параллельного треда или не придет\n<code>POSIX</code>-сигнал. Как приложению реагировать на сигналы мы рассмотрели выше.</p>\n<h3>Улучшаем зависимости</h3>\n<p>Когда мы объявили систему, то сообщили компоненту <code>:worker</code> о его\nзависимостях. В примере ниже мы буквально говорим компоненту: ты зависишь от\nбазы данных.</p>\n<div><div><pre><code><span>(</span><span>component/system-map</span><span>\n</span><span>;; ...</span><span>\n</span><span>:worker</span><span> </span><span>(</span><span>component/using</span><span>\n</span><span>(</span><span>make-worker</span><span> </span><span>worker</span><span>)</span><span> </span><span>[</span><span>:db</span><span>]))</span><span>\n</span></code></pre></div></div>\n<p>Когда компонентов много, перечисление их зависимостей занимает место и зашумляет\nкод. Помогает следующий трюк: зависимости компонента выносят в конструктор.</p>\n<p>В примере выше <code>(make-worker {...})</code> возвращает наивную версию компонента,\nкоторая не знает о зависимостях. Наивная версия попадает в <code>component/using</code>,\nкоторая сообщает их. Мы могли бы втянуть <code>component/using</code> в конструктор, чтобы\nновый компонент был сразу “заряжен” зависимостями. Тогда на уровне системы шаг\n<code>component/using</code> станет не нужен.</p>\n<p>Перепишем конструктор воркера:</p>\n<div><div><pre><code><span>(</span><span>defn</span><span> </span><span>make-worker</span><span> </span><span>[</span><span>config</span><span>]</span><span>\n</span><span>(</span><span>-></span><span> </span><span>config</span><span>\n</span><span>map->Worker</span><span>\n</span><span>(</span><span>component/using</span><span> </span><span>[</span><span>:db</span><span>])))</span><span>\n</span></code></pre></div></div>\n<p>Теперь система выглядит чище:</p>\n<div><div><pre><code><span>(</span><span>component/system-map</span><span>\n</span><span>:server</span><span> </span><span>(</span><span>make-server</span><span> </span><span>jetty</span><span>)</span><span>\n</span><span>:db</span><span> </span><span>(</span><span>make-db</span><span> </span><span>pool</span><span>)</span><span>\n</span><span>:worker</span><span> </span><span>(</span><span>make-worker</span><span> </span><span>worker</span><span>))</span><span>\n</span></code></pre></div></div>\n<p>Такой подход требует, чтобы имена в системе совпадали с зависимыми слотами. Если\nэто ваши компоненты, достаточно один раз договориться с командой об\nименовании. Для сторонних компонентов легко написать свой конструктор.</p>\n<p>Коротко рассмотрим, как хранятся данные о зависимостях. Очевидно, что вызов\n<code>component/using</code> сообщает компоненту новые сведения, однако сам компонент от\nэтого не меняется. У него не появляется нового поля <code>:deps</code> или что-то в этом\nроде. Компонент хранит зависимости в метаданных.</p>\n<p>Метаданные это словарь дополнительных сведений об объекте. Метаданные работают с\nколлекциями и некоторым другим типам Clojure, например, символом или\nпеременной. К метаданным прибегают, когда нужно сообщить добавочные сведения об\nобъекте, не изменяя его. Зависимости компонента подходят на роль таких сведений.</p>\n<p>Функция meta возвращает словарь метаданных объекта. Пример ниже показывает, что\nконструктор порождает компонент с заполненными зависимостями:</p>\n<div><div><pre><code><span>(</span><span>-></span><span> </span><span>{</span><span>...</span><span>}</span><span> </span><span>make-worker</span><span> </span><span>meta</span><span>)</span><span>\n</span><span>#</span><span>:com.stuartsierra.component</span><span>{</span><span>:dependencies</span><span> </span><span>{</span><span>:db</span><span> </span><span>:db</span><span>}}</span><span>\n</span></code></pre></div></div>\n<p>Чтобы увидеть метаданные другим способом, установите глобальную переменную\n<em>print-meta</em> в истину. Тогда при выводе объекта в REPL он будет дополнен\nметаданными:</p>\n<div><div><pre><code><span>(</span><span>set!</span><span> </span><span>*print-meta*</span><span> </span><span>true</span><span>)</span><span>\n</span><span>(</span><span>make-worker</span><span> </span><span>{</span><span>...</span><span>})</span><span>\n</span><span>^#</span><span>:com.stuartsierra.component</span><span>{</span><span>:dependencies</span><span> </span><span>{</span><span>:db</span><span> </span><span>:db</span><span>}}</span><span>\n</span><span>#</span><span>book.systems.comp.worker.Worker</span><span>{</span><span>...</span><span>}</span><span>\n</span></code></pre></div></div>\n<h3>Группировка слотов</h3>\n<p>Слоты компонента делятся на три группы. Это параметры инициализации, поля\nвнутреннего состояния и зависимости. Вспомним, как мы объявили компонент\nворкера:</p>\n<div><div><pre><code><span>(</span><span>defrecord</span><span> </span><span>Worker</span><span>\n</span><span>[</span><span>options</span><span> </span><span>flag</span><span> </span><span>task</span><span> </span><span>db</span><span>])</span><span>\n</span></code></pre></div></div>\n<p>В этом примере слот <code>options</code> относится к инициализации, <code>flag</code> и <code>task</code> к\nсостоянию, <code>db</code> — зависимость. Чем сложнее компонент, тем больше у него слотов в\nкаждой группе. Когда слоты перечислены беспорядочно, трудно понять их\nсемантику. Поэтому хорошей практикой считается группировать слоты вручную и\nразделять их комментарием:</p>\n<div><div><pre><code><span>(</span><span>defrecord</span><span> </span><span>Worker</span><span>\n</span><span>[</span><span>;; init</span><span>\n</span><span>options</span><span>\n</span><span>;; runtime</span><span>\n</span><span>flag</span><span> </span><span>task</span><span>\n</span><span>;; deps</span><span>\n</span><span>db</span><span>])</span><span>\n</span></code></pre></div></div>\n<p>Первой идет группа <code>init</code>, входящие параметры. Это слоты, необходимые для нового\nкомпонента. Ожидается, что конструктор принимает такие же параметры. Группа\n<code>runtime</code> перечисляет слоты, которые компонент заполнит сам в момент старта. В\n<code>deps</code> указаны зависимости. Вектор этих зависимостей передают в\n<code>component/using</code> в конструкторе.</p>\n<p>Сортировка слотов облегчает работу с кодом. Договоритесь с членами команды,\nчтобы внедрить эту практику. Но когда слотов слишком много, это говорит о том,\nчто компонент излишне сложен. Тогда часть слотов и логики выносят в отдельный\nкомпонент и подключают его как зависимость.</p>\n<p>В последующих примерах мы не группируем слоты, потому что иначе код займет\nслишком много места. В вашем коде слоты должны быть сгруппированы.</p>\n<h3>Условная система</h3>\n<p>В главе про конфигурацию мы писали про т.н. feature flags. Это логические\nпараметры, которые включают или отключают целые пласты логики. Флаги удобны тем,\nчто быстро отключают функциональность без пересборки приложения. Достаточно\nпоменять конфигурацию и перезагрузить сервис.</p>\n<p>Система компонентов может быть построена не линейно, а по условиям. Вспомним,\nчто технически задача сводится к тому, чтобы передать ключи и компоненты в\nфункцию <code>system-map</code>. Если список аргументов предварительно обработать, получим\nнужную функциональность.</p>\n<p>Предположим, компонент воркера все еще в испытательном режиме. Пусть в\nконфигурации будет поле, которое означает “включить воркер”. Если оно ложь,\nсистема должна запуститься без этого компонента.</p>\n<p>Выделим в конфигурации группу <code>:features</code>. Это словарь флагов для “фич”, которые\nпод вопросом:</p>\n<div><div><pre><code><span>{</span><span>:features</span><span> </span><span>{</span><span>:worker</span><span> </span><span>true</span><span>}</span><span>\n</span><span>:jetty</span><span> </span><span>{</span><span>:join?</span><span> </span><span>false</span><span> </span><span>:port</span><span> </span><span>8088</span><span>}</span><span>\n</span><span>;; etc</span><span>\n</span><span>}</span><span>\n</span></code></pre></div></div>\n<p>Перепишем функцию <code>make-system</code>. Теперь компоненты, перед тем как попасть в\nsystem-map проходят предварительный просев. Макрос <code>cond-></code> “пробрасывает”\nвектор базовых компонентов через цепочку условий и форм. Если выражение\n<code>(:worker features)</code> вернет истину, следующая за ней форма добавит в вектор\nзначения <code>:worker</code> и <code>(make-worker {...})</code>. Ниже могут располагаться другие\nфлаги или проверки.</p>\n<div><div><pre><code><span>(</span><span>defn</span><span> </span><span>make-system</span><span>\n</span><span>[</span><span>config</span><span>]</span><span>\n</span><span>(</span><span>let</span><span> </span><span>[{</span><span>:keys</span><span> </span><span>[</span><span>features</span><span> </span><span>jetty</span><span> </span><span>pool</span><span> </span><span>worker</span><span>]}</span><span> </span><span>config</span><span>\n</span><span>components</span><span>\n</span><span>(</span><span>cond-></span><span> </span><span>[</span><span>:server</span><span> </span><span>(</span><span>make-server</span><span> </span><span>jetty</span><span>)</span><span>\n</span><span>:db</span><span> </span><span>(</span><span>make-db</span><span> </span><span>pool</span><span>)]</span><span>\n</span><span>(</span><span>:worker</span><span> </span><span>features</span><span>)</span><span>\n</span><span>(</span><span>conj</span><span> </span><span>:worker</span><span> </span><span>(</span><span>make-worker</span><span> </span><span>worker</span><span>)))]</span><span>\n</span><span>(</span><span>apply</span><span> </span><span>component/system-map</span><span> </span><span>components</span><span>)))</span><span>\n</span></code></pre></div></div>\n<p>Убедимся, что механизм флагов работает. Поскольку система это запись, функция\nkeys вернет список ее слотов. В примерах ниже видно, что слот <code>:worker</code>\nпоявляется в зависимости от конфигурации:</p>\n<div><div><pre><code><span>(</span><span>keys</span><span> </span><span>(</span><span>make-system</span><span> </span><span>{</span><span>:features</span><span> </span><span>{</span><span>:worker</span><span> </span><span>false</span><span>}}))</span><span>\n</span><span>(</span><span>:server</span><span> </span><span>:db</span><span>)</span><span>\n</span><span>(</span><span>keys</span><span> </span><span>(</span><span>make-system</span><span> </span><span>{</span><span>:features</span><span> </span><span>{</span><span>:worker</span><span> </span><span>true</span><span>}}))</span><span>\n</span><span>(</span><span>:server</span><span> </span><span>:db</span><span> </span><span>:worker</span><span>)</span><span>\n</span></code></pre></div></div>\n<p>Система флагов облегчает работу с проектом. Некоторые компоненты очень сложны и\nтребуют специального окружения. Если такой компонент нельзя отключить, это\nстанет проблемой для ваших коллег. И наоборот, если компонент регулируется\nгалочкой, вы сэкономите их время и нервы.</p>\n<h3>Спуск системы</h3>\n<p>Пока сущности приложения это компоненты, они свободно общаются друг с\nдругом. Если одному компоненту понадобился другой, мы указываем зависимость и\nдобавляем слот. Проблемы начинаются, когда к системе обращается не компонент, а\nдругая сущность.</p>\n<p>Чаще всего это функция-обработчик HTTP-запроса. Мы подробно говорили о них в\nпервой главе. По своей природе функция не ложится на концепцию\nкомпонента. Компонент хранит состояние, а функция, напротив, избегает\nего. Запуск и остановка функции это бессмысленная операция. Это не хорошо и не\nплохо, просто функция и компонент противоположны друг другу.</p>\n<p>Рассмотрим случай, когда обработчик HTTP-запроса нуждается в компоненте базы\nданных. Возникает вопрос: как спустить отдельные части системы в функции, не\nнарушив принципы библиотеки? Обращение к системе как глобальной переменной мы не\nрассматриваем, потому что это плохая практика. В промышленных решениях прибегают\nк двум способам: пробросу и замыканию.</p>\n<p>Проброс означает, что отдельные компоненты передают в объекте запроса. Этот\nвариант имеет право на жизнь, потому что запрос это часть сервера, а сервер это\nкомпонент. Поэтому сервер имеет право сообщать дополнительные поля запросу.</p>\n<p>Чтобы компонент базы стал доступен серверу, подключим его в\nзависимостях. Добавим слот в запись сервера и зависимости в конструктор:</p>\n<div><div><pre><code><span>(</span><span>defrecord</span><span> </span><span>Server</span><span>\n</span><span>[</span><span>options</span><span> </span><span>server</span><span> </span><span>db</span><span>])</span><span>\n</span><span>(</span><span>defn</span><span> </span><span>make-server</span><span>\n</span><span>[</span><span>options</span><span>]</span><span>\n</span><span>(</span><span>-></span><span> </span><span>(</span><span>map->Server</span><span> </span><span>{</span><span>:options</span><span> </span><span>options</span><span>})</span><span>\n</span><span>(</span><span>component/using</span><span> </span><span>[</span><span>:db</span><span>])))</span><span>\n</span></code></pre></div></div>\n<p>Расширим метод сервера <code>start</code>. Если раньше мы передавали app напрямую в\n<code>run-jetty</code>, то теперь мы вводим дополнительный шаг. Функция <code>make-handler</code>\nоборачивает app таким образом, что каждый запрос в app дополнен компонентом\nбазы.</p>\n<div><div><pre><code><span>(</span><span>defn</span><span> </span><span>make-handler</span><span> </span><span>[</span><span>app</span><span> </span><span>db</span><span>]</span><span>\n</span><span>(</span><span>fn</span><span> </span><span>[</span><span>request</span><span>]</span><span>\n</span><span>(</span><span>app</span><span> </span><span>(</span><span>assoc</span><span> </span><span>request</span><span> </span><span>:db</span><span> </span><span>db</span><span>))))</span><span>\n</span><span>(</span><span>start</span><span> </span><span>[</span><span>this</span><span>]</span><span>\n</span><span>(</span><span>let</span><span> </span><span>[</span><span>handler</span><span> </span><span>(</span><span>make-handler</span><span> </span><span>app</span><span> </span><span>db</span><span>)</span><span>\n</span><span>server</span><span> </span><span>(</span><span>run-jetty</span><span> </span><span>handler</span><span> </span><span>options</span><span>)]</span><span>\n</span><span>(</span><span>assoc</span><span> </span><span>this</span><span> </span><span>:server</span><span> </span><span>server</span><span>)))</span><span>\n</span></code></pre></div></div>\n<p>Представим, что главная страница приложения выводит данные из базы. Пример ниже\nпоказывает, как выполнить запрос к базе из обработчика HTTP-запроса. Чтобы не\nусложнять пример версткой HTML, мы возвращаем данные в виде текста.</p>\n<div><div><pre><code><span>(</span><span>defn</span><span> </span><span>app</span><span>\n</span><span>[</span><span>request</span><span>]</span><span>\n</span><span>(</span><span>let</span><span> </span><span>[{</span><span>:keys</span><span> </span><span>[</span><span>db</span><span>]}</span><span> </span><span>request</span><span>\n</span><span>data</span><span> </span><span>(</span><span>db/query</span><span> </span><span>db</span><span> </span><span>&quot;select * from requests&quot;</span><span>)]</span><span>\n</span><span>{</span><span>:status</span><span> </span><span>200</span><span>\n</span><span>:body</span><span> </span><span>(</span><span>with-out-str</span><span>\n</span><span>(</span><span>clojure.pprint/pprint</span><span> </span><span>data</span><span>))}))</span><span>\n</span></code></pre></div></div>\n<p>Со временем приложению могут понадобиться другие компоненты, например очередь\nзадач или кэш. Их добавляют аналогично: сперва вводят новый компонент в систему,\nуказывают зависимости в сервере и пробрасывают в <code>make-handler</code>.</p>\n<p>Когда компонентов все больше, хранить их на верхнем уровне запроса становится\nнеудобно: возникает риск конфликта ключей. Будет логично записывать их во\nвложенный словарь <code>:system</code> или <code>:engine</code>. Важно понимать, что <code>:system</code>\nсодержит не глобальную систему, а ее минимальное подмножество, необходимое для\nвеб-части приложения.</p>\n<p>Замыкание отличается от проброса способом передачи аргументов. В случае с\nзамыканием компоненты передают отдельным аргументом. С таким подходом\nфункция-HTTP обработчик принимает не один, а два аргумента: подмножество системы\nи текущий запрос.</p>\n<p>Чтобы собрать нужные компоненты в одну структуру, в систему вводят особый\nгруппировочный компонент. Он ничего не делает при запуске и остановке, а только\nаккумулирует зависимости. Компонент сервера зависит от этого группировочного\nкомпонента. На базе него мы строим дерево маршрутов (роутер), где каждый\nобработчик принимает компонент первым аргументом.</p>\n<p>Введем группировочный компонент <code>:web</code>. Пока что он зависит в только от базы\nданных, но в будущем, возможно, потребует и другие компоненты:</p>\n<div><div><pre><code><span>(</span><span>defrecord</span><span> </span><span>Web</span><span> </span><span>[</span><span>db</span><span>])</span><span>\n</span><span>(</span><span>defn</span><span> </span><span>make-web</span><span> </span><span>[]</span><span>\n</span><span>(</span><span>-></span><span> </span><span>(</span><span>map->Web</span><span> </span><span>{})</span><span>\n</span><span>(</span><span>component/using</span><span> </span><span>[</span><span>:db</span><span>])))</span><span>\n</span></code></pre></div></div>\n<p>В функции make-system подключим его в систему:</p>\n<div><div><pre><code><span>(</span><span>component/system-map</span><span>\n</span><span>:web</span><span> </span><span>(</span><span>make-web</span><span>)</span><span>\n</span><span>:server</span><span> </span><span>(</span><span>make-server</span><span> </span><span>jetty</span><span>)</span><span>\n</span><span>:db</span><span> </span><span>(</span><span>make-db</span><span> </span><span>pool</span><span>)</span><span>\n</span><span>:worker</span><span> </span><span>(</span><span>make-worker</span><span> </span><span>worker</span><span>))</span><span>\n</span></code></pre></div></div>\n<p>Переключим зависимости сервера: теперь он зависит не от базы данных, а от\nгруппировочного <code>web</code>:</p>\n<div><div><pre><code><span>(</span><span>defrecord</span><span> </span><span>Server</span><span>\n</span><span>[</span><span>options</span><span> </span><span>server</span><span> </span><span>web</span><span>])</span><span>\n</span><span>(</span><span>defn</span><span> </span><span>make-server</span><span>\n</span><span>[</span><span>options</span><span>]</span><span>\n</span><span>(</span><span>-></span><span> </span><span>(</span><span>map->Server</span><span> </span><span>{</span><span>:options</span><span> </span><span>options</span><span>})</span><span>\n</span><span>(</span><span>component/using</span><span> </span><span>[</span><span>:web</span><span>])))</span><span>\n</span></code></pre></div></div>\n<p>Из первой главы про веб-разработку вспомним, как мы строили роуты. Проще всего\nэто сделать макросом <code>defroutes</code> из пакета Compojure. Макрос возвращает функцию,\nкоторая принимает запрос и возвращает ответ.</p>\n<div><div><pre><code><span>(</span><span>defroutes</span><span> </span><span>app</span><span>\n</span><span>(</span><span>GET</span><span> </span><span>&quot;/&quot;</span><span> </span><span>request</span><span> </span><span>(</span><span>page-index</span><span> </span><span>request</span><span>))</span><span>\n</span><span>(</span><span>GET</span><span> </span><span>&quot;/hello&quot;</span><span> </span><span>request</span><span> </span><span>(</span><span>page-hello</span><span> </span><span>request</span><span>))</span><span>\n</span><span>page-404</span><span>)</span><span>\n</span></code></pre></div></div>\n<p>Но теперь дерево маршрутов не статично, а строится по запросу. Функция\nmake-routes принимает группировочный компонент и возвращает маршруты, замкнутые\nна нем. В функции <code>page-index</code> и другие приходят два аргумента: компонент и\nтекущий запрос. Компонент будет постоянным, в том состоянии, что он пришел в\nmake-routes:</p>\n<div><div><pre><code><span>(</span><span>defn</span><span> </span><span>make-routes</span><span> </span><span>[</span><span>web</span><span>]</span><span>\n</span><span>(</span><span>routes</span><span>\n</span><span>(</span><span>GET</span><span> </span><span>&quot;/&quot;</span><span> </span><span>request</span><span> </span><span>(</span><span>page-index</span><span> </span><span>web</span><span> </span><span>request</span><span>))</span><span>\n</span><span>(</span><span>GET</span><span> </span><span>&quot;/hello&quot;</span><span> </span><span>request</span><span> </span><span>(</span><span>page-hello</span><span> </span><span>web</span><span> </span><span>request</span><span>))))</span><span>\n</span></code></pre></div></div>\n<p>Метод <code>start</code> сервера строит маршруты и передает в <code>run-jetty</code>:</p>\n<div><div><pre><code><span>(</span><span>start</span><span> </span><span>[</span><span>this</span><span>]</span><span>\n</span><span>(</span><span>let</span><span> </span><span>[</span><span>routes</span><span> </span><span>(</span><span>make-routes</span><span> </span><span>web</span><span>)</span><span>\n</span><span>server</span><span> </span><span>(</span><span>run-jetty</span><span> </span><span>routes</span><span> </span><span>options</span><span>)]</span><span>\n</span><span>(</span><span>assoc</span><span> </span><span>this</span><span> </span><span>:server</span><span> </span><span>server</span><span>)))</span><span>\n</span></code></pre></div></div>\n<p>Рассмотрим, как может выглядеть обработчик <code>page-index</code>, который обращается к\nбазе данных. Поскольку первый аргумент интересует нас только как хранилище\nкомпонентов, мы распакуем его на уровне сигнатуры.</p>\n<div><div><pre><code><span>(</span><span>defn</span><span> </span><span>page-index</span><span>\n</span><span>[{</span><span>:keys</span><span> </span><span>[</span><span>db</span><span>]}</span><span> </span><span>request</span><span>]</span><span>\n</span><span>(</span><span>let</span><span> </span><span>[</span><span>data</span><span> </span><span>(</span><span>db/query</span><span> </span><span>db</span><span> </span><span>&quot;select * from requests&quot;</span><span>)]</span><span>\n</span><span>{</span><span>:status</span><span> </span><span>200</span><span>\n</span><span>:body</span><span> </span><span>(</span><span>with-out-str</span><span>\n</span><span>(</span><span>clojure.pprint/pprint</span><span> </span><span>data</span><span>))}))</span><span>\n</span></code></pre></div></div>\n<p>Проброс и замыкание в целом похожи: они решают одну и ту же задачу. Разница в\nтом, как технически передать аргументы в функцию. Вариант с пробросом удобен\nтем, что обычно HTTP-функции принимают один аргумент, и нам не придется менять\nвсе сигнатуры.</p>\n<p>С другой стороны, передача данных через запрос не всегда очевидна. Когда в\nзапросе слишком много полей, становится трудно его конструировать при разработке\nили в тестах. При записи запроса в лог или на экран возникает риск получить\nслишком большой выхлоп. Вариант с замыканием и двумя аргументами в целом\nвыглядит понятнее. Сигнатура функции прямо говорит о том, какие данные ожидают\nна входе.</p>\n<p>Выбор конкретного способа зависит от соглашений в команде.</p>\n<h3>Идемпотентность</h3>\n<p>До сих пор мы писали компоненты так, что их повторный запуск или остановка\nприводили к ошибке. Покажем это на примере веб-сервера:</p>\n<div><div><pre><code><span>(</span><span>def</span><span> </span><span>s</span><span> </span><span>(</span><span>-></span><span> </span><span>{</span><span>:port</span><span> </span><span>8088</span><span> </span><span>:join?</span><span> </span><span>false</span><span>}</span><span>\n</span><span>make-server</span><span>\n</span><span>component/start</span><span>))</span><span>\n</span><span>(</span><span>component/start</span><span> </span><span>s</span><span>)</span><span>\n</span><span>Execution</span><span> </span><span>error</span><span> </span><span>(</span><span>BindException</span><span>)</span><span> </span><span>at</span><span> </span><span>...</span><span>\n</span><span>Address</span><span> </span><span>already</span><span> </span><span>in</span><span> </span><span>use</span><span>\n</span></code></pre></div></div>\n<p>В теле <code>start</code> мы не проверяем, что сервер уже работает. При попытке включить\nуже запущенный компонент получим исключение о том, что порт уже занят. Это\nправильное поведение системы: мы бы не хотели, чтобы запустилось два сервера. Но\nдля других компонентов исключения может и не быть. Например, если повторно\nзапустить базу данных, получим новый пул соединений. Старый пул останется где-то\nв памяти и будет работать и писать логи. Так происходит утечка ресурсов.</p>\n<p>Свойство, когда повторная операция над объектом возвращает тот же результат, что\nи в начале, называется идемпотентность. Чтобы избежать утечки ресурсов,\nкомпонент должен быть идемпотентен. Повторный вызов start или stop срабатывают\nтолько один раз для данного состояния.</p>\n<p>На уровне кода это сводится к проверке слотов перед тем, как открывать\nресурс. Например, если слот сервера nil, мы порождаем новый сервер и записываем\nего в слот. Если не nil, это значит, что сервер уже запущен, и возвращают\n<code>this</code>.</p>\n<div><div><pre><code><span>(</span><span>start</span><span> </span><span>[</span><span>this</span><span>]</span><span>\n</span><span>(</span><span>if</span><span> </span><span>server</span><span>\n</span><span>this</span><span>\n</span><span>(</span><span>let</span><span> </span><span>[</span><span>server</span><span> </span><span>(</span><span>run-jetty</span><span> </span><span>app</span><span> </span><span>options</span><span>)]</span><span>\n</span><span>(</span><span>assoc</span><span> </span><span>this</span><span> </span><span>:server</span><span> </span><span>server</span><span>))))</span><span>\n</span></code></pre></div></div>\n<p>Аналогично работает <code>stop</code>: перед тем, как закрыть ресурс, слот проверяют на\nзаполненность:</p>\n<div><div><pre><code><span>(</span><span>stop</span><span> </span><span>[</span><span>this</span><span>]</span><span>\n</span><span>(</span><span>when</span><span> </span><span>server</span><span>\n</span><span>(</span><span>.stop</span><span> </span><span>server</span><span>))</span><span>\n</span><span>(</span><span>assoc</span><span> </span><span>this</span><span> </span><span>:server</span><span> </span><span>nil</span><span>))</span><span>\n</span></code></pre></div></div>\n<p>Вариант с макросом or выглядит декларативнее. При запуске мы всегда записываем\nслот, но значение это либо новый сервер, либо текущий.</p>\n<div><div><pre><code><span>(</span><span>start</span><span> </span><span>[</span><span>this</span><span>]</span><span>\n</span><span>(</span><span>let</span><span> </span><span>[</span><span>server</span><span> </span><span>(</span><span>or</span><span> </span><span>server</span><span> </span><span>(</span><span>run-jetty</span><span> </span><span>app</span><span> </span><span>options</span><span>))]</span><span>\n</span><span>(</span><span>assoc</span><span> </span><span>this</span><span> </span><span>:server</span><span> </span><span>server</span><span>)))</span><span>\n</span></code></pre></div></div>\n<h2>Integrant</h2>\n<p>Библиотека <a href=\"https://github.com/weavejester/integrant\">Integrant</a> это следующий виток мысли о том, как строить\nсистемы. Мы поместили ее последней в обзоре по нескольким причинам. Integrant\nотталкивается от идей Component, которые мы только что рассмотрели. Библиотека\nустроена гибче и в целом более продвинута, чем Component. Читатель должен\nподойти к ней с некоторым практическим опытом.</p>\n<p>Как и в случае с Component, основная задача библиотеки — избежать глобального\nсостояния. Вместе с тем Integrant исправляет слабые моменты Component. Кратко\nперечислим тезисы, которые предложил автора Integrant.</p>\n<p>Сущности Component напоминают классы и ООП. В мире Clojure, где в основном\nработают с данными и функциями, это выглядит усложнением. Пусть компоненты будут\nфункциями. Функция проще объекта, потому что над ней определена только одна\nоперация — вызов.</p>\n<p>Component выделяет только два состояния компонента — запущен и\nостановлен. Integrant предлагает дополнительные стадии, например, приостановка и\nвозобновление, валидация спекой, подготовка параметров. По умолчанию эти стадии\nпустые, но любой компонент может подписаться на них. С этим подходом система\nстановится гибче и удобней в поддержке.</p>\n<p>Integrant делает ставку на декларативность системы. Технически возможно описать\nсистему в edn-файле и считать одной функцией. Это выгодно отличает Integrant от\nComponent с ручным вызовом конструкторов.</p>\n<p>Integrant лоялен к зависимостям. Если в Component зависимость требует два\nдействия — добавить слот и метаданные, — то в Integrant это один шаг. В\nComponent зависимость может быть только другим компонентом. Иногда объект\nоборачивают в компонент только чтобы выполнить это требование. В Integrant\nзависимостью может быть что угодно: словарь, объект, функция.</p>\n<p>В целом Integrant выглядит легче и удобнее Component. Он решает задачи простым\nспособом, как это принято в мире Clojure.</p>\n<h3>Базовое устройство</h3>\n<p>Работу с Integrant начинают с описания будущей системы. Это структура данных,\nкаркас, за который цепляется дальнейшая логика. На уровне кода система это\nсловарь. Вот так мы бы описали систему из веб-сервера и пула для базы данных:</p>\n<div><div><pre><code><span>(</span><span>def</span><span> </span><span>config</span><span>\n</span><span>{</span><span>::server</span><span> </span><span>{</span><span>:port</span><span> </span><span>8080</span><span> </span><span>:join?</span><span> </span><span>false</span><span>}</span><span>\n</span><span>::db</span><span> </span><span>{</span><span>:username</span><span> </span><span>&quot;book&quot;</span><span>\n</span><span>:password</span><span> </span><span>&quot;book&quot;</span><span>\n</span><span>:database-name</span><span> </span><span>&quot;book&quot;</span><span>\n</span><span>:server-name</span><span> </span><span>&quot;127.0.0.1&quot;</span><span>\n</span><span>:port-number</span><span> </span><span>5432</span><span>}})</span><span>\n</span></code></pre></div></div>\n<p>Ключ словаря это машинное имя компонента, а значение — параметры запуска. Уже на\nэтом этапе видно одно из преимуществ Integrant — его декларативность. Эту\nструктуру можно скопировать или считать из файла.</p>\n<p>Система и компоненты связаны через мультиметоды. Чтобы добавить реакцию на\nопределенное событие, мы расширяем нужный мультиметод по ключу\nкомпонента. Например, при старте система вызывает метод <code>init-key</code> для каждого\nключа. Чтобы объяснить системе, как запускать сервер, метод предварительно\nрасширяют ключом <code>::server</code>.</p>\n<p>Integrant ожидает, что ключ реализует минимум два метода: запуск и\nостановка. Это ключевые операции для работы с системой, поэтому для них не\nпредусмотрены действия по умолчанию. Другие события опциональны и остаются на\nусмотрение разработчика.</p>\n<h3>Первые компоненты</h3>\n<p>Как и в прошлых разделах, мы начнем практику с описания компонентов сервера и\nбазы. Они просты и не имеют зависимостей. Подготовьте модуль\n<code>src/book/integrant.clj</code> со следующей шапкой:</p>\n<div><div><pre><code><span>(</span><span>ns</span><span> </span><span>book.integrant</span><span>\n</span><span>(</span><span>:require</span><span> </span><span>[</span><span>integrant.core</span><span> </span><span>:as</span><span> </span><span>ig</span><span>]))</span><span>\n</span></code></pre></div></div>\n<p>Для краткости мы опустим импорты Jetty, HikariCP и других библиотек. Они\nаналогичны тем, что мы писали в упражнениях с Mount и Component.</p>\n<p>Начнем с сервера. Метод init-key принимает два параметра: ключ и словарь его\nопций. Для конфигурации выше это значения <code>::server</code> и <code>{:port 8080 :join?\nfalse}</code>. Метод должен вернуть объект-состояние компонента. Достаточно передать в\nфункцию <code>run-jetty</code> обработчик запроса, объявленный где-то выше, и словарь\nопций.</p>\n<div><div><pre><code><span>(</span><span>defmethod</span><span> </span><span>ig/init-key</span><span> </span><span>::server</span><span>\n</span><span>[</span><span>_</span><span> </span><span>options</span><span>]</span><span>\n</span><span>(</span><span>run-jetty</span><span> </span><span>app</span><span> </span><span>options</span><span>))</span><span>\n</span></code></pre></div></div>\n<p>Поскольку ключ известен из определения метода, первый параметр затеняют символом\nподчеркивания. По аналогии опишем базу данных. Состояние компонента это\nJDBC-спека, которую передают в функции из пакета clojure.java.jdbc.</p>\n<div><div><pre><code><span>(</span><span>defmethod</span><span> </span><span>ig/init-key</span><span> </span><span>::db</span><span>\n</span><span>[</span><span>_</span><span> </span><span>options</span><span>]</span><span>\n</span><span>{</span><span>:datasource</span><span> </span><span>(</span><span>cp/make-datasource</span><span> </span><span>options</span><span>)})</span><span>\n</span></code></pre></div></div>\n<p>Функция <code>init</code> пробегает по каркасу системы и вызывает для каждого ключа\nмультиметод <code>init-key</code>. В результате получим словарь-систему, где ключ это имя\nкомпонента, а значение — его состояние:</p>\n<div><div><pre><code><span>(</span><span>def</span><span> </span><span>_sys</span><span> </span><span>(</span><span>ig/init</span><span> </span><span>config</span><span>))</span><span>\n</span><span>(</span><span>keys</span><span> </span><span>_sys</span><span>)</span><span>\n</span><span>(</span><span>:book.integrant/db</span><span> </span><span>:book.integrant/server</span><span>)</span><span>\n</span></code></pre></div></div>\n<p>В терминах Integrant остановка системы называется <code>halt</code>. Метод <code>halt-key!</code>\nопределяет, как выключить определенный ключ. Он принимает два параметра: ключ и\nсостояние, которые мы вернули из метода <code>init-key</code>. Определим эти события для\nсервера и базы:</p>\n<div><div><pre><code><span>(</span><span>defmethod</span><span> </span><span>ig/halt-key!</span><span> </span><span>::server</span><span> </span><span>[</span><span>_</span><span> </span><span>server</span><span>]</span><span>\n</span><span>(</span><span>.stop</span><span> </span><span>server</span><span>))</span><span>\n</span><span>(</span><span>defmethod</span><span> </span><span>ig/halt-key!</span><span> </span><span>::db</span><span> </span><span>[</span><span>_</span><span> </span><span>db-spec</span><span>]</span><span>\n</span><span>(</span><span>-></span><span> </span><span>db-spec</span><span> </span><span>:datasource</span><span> </span><span>cp/close-datasource</span><span>))</span><span>\n</span></code></pre></div></div>\n<p>Функция halt! останавливает систему целиком:</p>\n<div><div><pre><code><span>(</span><span>ig/halt!</span><span> </span><span>_sys</span><span>)</span><span>\n</span></code></pre></div></div>\n<h3>Зависимости</h3>\n<p>Чтобы указать ключу зависимости, в его опции добавляют специальный ссылочный\nпараметр. При запуске Integrant просматривает каркас системы на наличие таких\nпараметров и строит по ним граф зависимостей. Ссылочный параметр задают функцией\n<code>ig/ref</code>. Она принимает ключ, на который следует сослаться.</p>\n<p>Рассмотрим зависимость на примере воркера. Добавьте в конфигурацию новый ключ:</p>\n<div><div><pre><code><span>{</span><span>::worker</span><span> </span><span>{</span><span>:options</span><span> </span><span>{</span><span>:sleep</span><span> </span><span>1000</span><span>}</span><span>\n</span><span>:db</span><span> </span><span>(</span><span>ig/ref</span><span> </span><span>::db</span><span>)}}</span><span>\n</span></code></pre></div></div>\n<p>Чтобы <code>:db</code> не слиплось с общими настройками воркера, мы вынесли их в отдельное\nполе <code>:options</code>.</p>\n<p>Теперь когда метод <code>init-key</code> дойдет до ключа <code>::worker</code>, в поле <code>:db</code> будет\nзначение, которое <code>init-key</code> вернул для этого ключа. В нашем случае это\nJDBC-спека с пулом соединений.</p>\n<p>Код запуска и остановки воркера аналогичен тому, что мы писали для Mount и\nComponent. Для экономии места приведем только реализации <code>init-key</code> и\n<code>halt-key!</code>. Если вдруг вы забыли, как устроен воркер, обратитесь к прошлым\nразделам главы.</p>\n<div><div><pre><code><span>(</span><span>defmethod</span><span> </span><span>ig/init-key</span><span> </span><span>::worker</span><span>\n</span><span>[</span><span>_</span><span> </span><span>{</span><span>:keys</span><span> </span><span>[</span><span>db</span><span> </span><span>options</span><span>]}]</span><span>\n</span><span>(</span><span>let</span><span> </span><span>[</span><span>flag</span><span> </span><span>(</span><span>atom</span><span> </span><span>true</span><span>)</span><span>\n</span><span>task</span><span> </span><span>(</span><span>make-task</span><span> </span><span>db</span><span> </span><span>flag</span><span> </span><span>options</span><span>)]</span><span>\n</span><span>{</span><span>:flag</span><span> </span><span>flag</span><span> </span><span>:task</span><span> </span><span>task</span><span>}))</span><span>\n</span><span>(</span><span>defmethod</span><span> </span><span>ig/halt-key!</span><span> </span><span>::worker</span><span>\n</span><span>[</span><span>_</span><span> </span><span>{</span><span>:keys</span><span> </span><span>[</span><span>flag</span><span> </span><span>task</span><span>]}]</span><span>\n</span><span>(</span><span>reset!</span><span> </span><span>flag</span><span> </span><span>false</span><span>)</span><span>\n</span><span>(</span><span>while</span><span> </span><span>(</span><span>not</span><span> </span><span>(</span><span>realized?</span><span> </span><span>task</span><span>))</span><span>\n</span><span>(</span><span>Thread/sleep</span><span> </span><span>300</span><span>)))</span><span>\n</span></code></pre></div></div>\n<h3>Параллели с Component</h3>\n<p>Многие из приемов, которые мы рассмотрели для Component, работают и в Integrant\nВспомним некоторые их них.</p>\n<p><strong>Глобальное хранилище.</strong> Чтобы управлять системой, нужно где-то ее\nхранить. Проще всего добавить глобальную переменную и вспомогательные функции\nдля запуска и остановки.</p>\n<div><div><pre><code><span>(</span><span>defonce</span><span> </span><span>^</span><span>:private</span><span> </span><span>system</span><span> </span><span>nil</span><span>)</span><span>\n</span><span>(</span><span>def</span><span> </span><span>alter-system</span><span> </span><span>(</span><span>partial</span><span> </span><span>alter-var-root</span><span> </span><span>#</span><span>'system</span><span>))</span><span>\n</span><span>(</span><span>defn</span><span> </span><span>system-start</span><span> </span><span>[]</span><span>\n</span><span>(</span><span>alter-system</span><span> </span><span>(</span><span>constantly</span><span> </span><span>(</span><span>ig/init</span><span> </span><span>config</span><span>))))</span><span>\n</span><span>(</span><span>defn</span><span> </span><span>system-stop</span><span> </span><span>[]</span><span>\n</span><span>(</span><span>alter-system</span><span> </span><span>ig/halt!</span><span>))</span><span>\n</span></code></pre></div></div>\n<p>Как и в Component, система должна быть приватной. Недопустимо, чтобы компоненты\nсвободно обращались к ней.</p>\n<p><strong>Ожидание и сигналы.</strong> Перед тем как закончить работу, приложение ожидает, пока\nвсе компоненты корректно остановятся. Пример с макросом <code>with-handler</code> и\nперехватом сигналов работает аналогично для Integrant:</p>\n<div><div><pre><code><span>(</span><span>with-handler</span><span> </span><span>:term</span><span>\n</span><span>(</span><span>log/info</span><span> </span><span>&quot;caught SIGTERM, quitting&quot;</span><span>)</span><span>\n</span><span>(</span><span>system-stop</span><span>)</span><span>\n</span><span>(</span><span>log/info</span><span> </span><span>&quot;all components shut down&quot;</span><span>)</span><span>\n</span><span>(</span><span>exit</span><span>))</span><span>\n</span></code></pre></div></div>\n<p><strong>Спуск системы и маршруты.</strong> В Integrant легче решить проблему доступа к\nсистеме из HTTP-обработчика. Достаточно выразить обработчик в виде компонента с\nнужными зависимостями. Представим, что главная страница веб-сервера выводит\nчисло записей в базе. Добавим в систему новый ключ, который зависит от базы:</p>\n<div><div><pre><code><span>{</span><span>::handler</span><span> </span><span>{</span><span>:db</span><span> </span><span>(</span><span>ig/ref</span><span> </span><span>::db</span><span>)}}</span><span>\n</span></code></pre></div></div>\n<p>При запуске ключа вернем функцию-обработчик, замкнутую на <code>db</code>:</p>\n<div><div><pre><code><span>(</span><span>defmethod</span><span> </span><span>ig/init-key</span><span> </span><span>::handler</span><span>\n</span><span>[</span><span>_</span><span> </span><span>{</span><span>:keys</span><span> </span><span>[</span><span>db</span><span>]}]</span><span>\n</span><span>(</span><span>fn</span><span> </span><span>[</span><span>request</span><span>]</span><span>\n</span><span>(</span><span>let</span><span> </span><span>[</span><span>query</span><span> </span><span>&quot;select count(*) as total from requests&quot;</span><span>\n</span><span>result</span><span> </span><span>(</span><span>jdbc/query</span><span> </span><span>db</span><span> </span><span>query</span><span>)</span><span>\n</span><span>total</span><span> </span><span>(</span><span>-></span><span> </span><span>result</span><span> </span><span>first</span><span> </span><span>:total</span><span>)]</span><span>\n</span><span>{</span><span>:status</span><span> </span><span>200</span><span>\n</span><span>:body</span><span> </span><span>(</span><span>format</span><span> </span><span>&quot;You've got %s requests.&quot;</span><span> </span><span>total</span><span>)})))</span><span>\n</span></code></pre></div></div>\n<p>Доработаем сервер так, чтобы он зависел от обработчика:</p>\n<div><div><pre><code><span>{</span><span>::server</span><span> </span><span>{</span><span>:options</span><span> </span><span>{</span><span>:port</span><span> </span><span>8080</span><span> </span><span>:join?</span><span> </span><span>false</span><span>}</span><span>\n</span><span>:handler</span><span> </span><span>(</span><span>ig/ref</span><span> </span><span>::handler</span><span>)}}</span><span>\n</span><span>(</span><span>defmethod</span><span> </span><span>ig/init-key</span><span> </span><span>::server</span><span>\n</span><span>[</span><span>_</span><span> </span><span>{</span><span>:keys</span><span> </span><span>[</span><span>handler</span><span> </span><span>options</span><span>]}]</span><span>\n</span><span>(</span><span>run-jetty</span><span> </span><span>handler</span><span> </span><span>options</span><span>))</span><span>\n</span></code></pre></div></div>\n<p>Теперь браузер покажет фразу “You’ve got N requests.”, где N — число записей в\nбазе. Как и в примере с Component, <code>::handler</code> может вернуть дерево маршрутов,\nпостроенное с помощью Compojure.</p>\n<p><strong>Условное построение.</strong> Конфигурация системы это словарь, поэтому в него можно\nдобавить или удалить ключи по каким-либо условиям, как мы делали это в\nComponent. Например, специальная функция определяет, будет ли запущен воркер или\nнет. Если будет, мы добавляем в систему ключ и его настройки.</p>\n<div><div><pre><code><span>(</span><span>cond-></span><span> </span><span>sys-config</span><span>\n</span><span>(</span><span>is-worker-supported?</span><span>)</span><span>\n</span><span>(</span><span>assoc</span><span> </span><span>::worker</span><span> </span><span>{</span><span>:options</span><span> </span><span>{</span><span>:sleep</span><span> </span><span>1000</span><span>}</span><span>\n</span><span>:db</span><span> </span><span>(</span><span>ig/ref</span><span> </span><span>::db</span><span>)}))</span><span>\n</span></code></pre></div></div>\n<p>Есть и другой способ запустить подмножество системы, аналогичный Mount. Функция\n<code>init</code> принимает необязательный список ключей. Этот список, а еще лучше\nмножество, можно подготовить заранее на базе определенной логики.</p>\n<div><div><pre><code><span>(</span><span>let</span><span> </span><span>[</span><span>components</span><span> </span><span>(</span><span>-></span><span> </span><span>config</span><span> </span><span>keys</span><span> </span><span>set</span><span>)</span><span>\n</span><span>components</span><span> </span><span>(</span><span>cond-></span><span> </span><span>components</span><span>\n</span><span>(</span><span>not</span><span> </span><span>(</span><span>is-worker-supported?</span><span>))</span><span>\n</span><span>(</span><span>disj</span><span> </span><span>::worker</span><span>))]</span><span>\n</span><span>(</span><span>ig/init</span><span> </span><span>config</span><span> </span><span>components</span><span>))</span><span>\n</span></code></pre></div></div>\n<h3>Проблема потери ключей</h3>\n<p>Обратите внимание, что мы указываем полные (квалифицированные) ключи для\nкомпонентов, например <code>::server</code> или <code>::db</code>. Двойное двоеточие означает текущее\nпространство имен, в котором объявлен ключ. Запись <code>::db</code> это краткий вариант\n<code>:book.integrant/db</code>.</p>\n<p>Когда ключ полный, то есть с пространством, легко определить, в каком модуле он\nобъявлен. В промышленных системах бывает несколько десятков\nкомпонентов. Представьте, что возникла проблема с ключом <code>:queue</code>. Как понять, в\nкаком месте мы расширили мультиметод этим ключом? Наоборот, ключ\n<code>:my-project.utils.queue/queue</code> несет эту информацию. Всегда используйте полные\nключи.</p>\n<p>Возможна ситуация, когда вы забыли импортировать модуль, в котором расширяете\nмультиметод. Иногда трудно понять, почему возникла ошибка: вы точно помните, что\nписали этот код. Чтобы избежать ошибки, добавьте эти модули в заголовок <code>ns</code>\nглавного модуля, который загружается всегда. Пусть это будет модуль, в котором\nвы собираете систему.</p>\n<div><div><pre><code><span>(</span><span>ns</span><span> </span><span>project.system</span><span>\n</span><span>(</span><span>:require</span><span> </span><span>project.db</span><span>\n</span><span>project.server</span><span>\n</span><span>project.worker</span><span>\n</span><span>project.utils.queue</span><span>))</span><span>\n</span></code></pre></div></div>\n<p>Возможно, утилиты для проверки синтаксиса (линтеры) будут выдавать\nпредупреждение для этих модулей. С их точки зрения утилиты вы добавили модуль,\nно не используете его, потому что в коде нет ни одного выражения\n<code>project.db/&lt;something></code>. Чтобы подавить эти предупреждения, добавьте модули в\nконфигурацию линтера в секцию “known namespaces” или аналогичную.</p>\n<p>Integrant предлагает функцию <code>load-namespaces</code> для автоматической загрузки\nмодулей. На вход подают конфигурацию системы. Для каждого ключа функция\nвычисляет его пространство и загружает его. Вот как выглядит промышленная\nсистема с ключами из разных модулей:</p>\n<div><div><pre><code><span>(</span><span>def</span><span> </span><span>config</span><span>\n</span><span>{</span><span>:project.server/server</span><span> </span><span>{</span><span>:options</span><span> </span><span>{</span><span>:port</span><span> </span><span>8080</span><span> </span><span>:join?</span><span> </span><span>false</span><span>}</span><span>\n</span><span>:handler</span><span> </span><span>(</span><span>ig/ref</span><span> </span><span>:project.handlers/index</span><span>)}</span><span>\n</span><span>:project.db/db</span><span> </span><span>{</span><span>...</span><span>}</span><span>\n</span><span>:project.worker/worker</span><span> </span><span>{</span><span>:options</span><span> </span><span>{</span><span>:sleep</span><span> </span><span>1000</span><span>}</span><span>\n</span><span>:db</span><span> </span><span>(</span><span>ig/ref</span><span> </span><span>:project.db/db</span><span>)}</span><span>\n</span><span>:project.handlers/index</span><span> </span><span>{</span><span>:db</span><span> </span><span>(</span><span>ig/ref</span><span> </span><span>:project.db/db</span><span>)}})</span><span>\n</span></code></pre></div></div>\n<p>Чтобы загрузить все модули, которые участвуют в этой системе, добавьте\nвыражение:</p>\n<div><div><pre><code><span>(</span><span>ig/load-namespaces</span><span> </span><span>config</span><span>)</span><span>\n</span></code></pre></div></div>\n<p>Заметим, что явная загрузка модулей все же предпочтительнее. Мы советуем\nначинающим воздержаться от автоматических импортов. Размещайте их явно в блоке\n<code>ns</code>: этот вариант хоть и многословен, но зато очевиден. Прибегайте к помощи\n<code>load-namespaces</code> только если точно знаете, как работает система пространств в\nClojure.</p>\n<h3>Система в файле</h3>\n<p>Выше мы упоминали, что Integrant делает ставку на декларативность. В идеале\nконфигурация системы это статичная структура данных, словарь. Для экономии места\nсистему можно вынести в EDN-файл и прочитать функцией из модуля <code>clojure.edn</code>.</p>\n<p>Читатель заметит, что мы указываем зависимости через функцию <code>ig/ref</code>, и не\nсовсем ясно, как поместить это выражение в файл. Вспомним систему тегов: при\nчтении EDN-данных мы указываем связь между тегом и функцией, которая обработает\nследующее за тегом значение. Для зависимостей Integrant предлагает тег\n<code>#ig/ref</code>. В примере ниже мы выразили зависимость тегом:</p>\n<div><div><pre><code><span>{</span><span>:project.worker/worker</span><span> </span><span>{</span><span>:options</span><span> </span><span>{</span><span>:sleep</span><span> </span><span>1000</span><span>}</span><span>\n</span><span>:db</span><span> </span><span>#</span><span>ig/ref</span><span> </span><span>:project.db/db</span><span>}}</span><span>\n</span></code></pre></div></div>\n<p>Integrant предлагает функцию <code>read-string</code> что чтения EDN-данных. Это обертка\nвокруг <code>clojure.edn/read-string</code>, заряженная дополнительными тегами. Чтобы\nпрочитать систему из файла, выполните:</p>\n<div><div><pre><code><span>(</span><span>def</span><span> </span><span>config</span><span>\n</span><span>(</span><span>-></span><span> </span><span>&quot;config.edn&quot;</span><span> </span><span>slurp</span><span> </span><span>ig/read-string</span><span>))</span><span>\n</span></code></pre></div></div>\n<p>Из главы про конфигурацию мы помним, что нежелательно хранить в файле пароли и\nключи доступа. Этот принцип нарушает компонент <code>:project.db/db</code>: пароль к базе\nданных записан открыто. Сделаем так, чтобы парсер читал пароль из переменной\nсреды.</p>\n<p>Вынесем конфигурацию в файл <code>integrant.test.edn</code> (ниже ее фрагмент):</p>\n<div><div><pre><code><span>{</span><span>:project.db/db</span><span> </span><span>{</span><span>:password</span><span> </span><span>#</span><span>env</span><span> </span><span>DB_PASSWORD</span><span>}</span><span>\n</span><span>:project.worker/worker</span><span> </span><span>{</span><span>:options</span><span> </span><span>{</span><span>:sleep</span><span> </span><span>1000</span><span>}</span><span>\n</span><span>:db</span><span> </span><span>#</span><span>ig/ref</span><span> </span><span>:project.db/db</span><span>}}</span><span>\n</span></code></pre></div></div>\n<p>Обернем чтение конфигурации в функцию. Первым аргументом в <code>ig/read-string</code>\nукажем словарь с тегами. Функцию <code>tag-env</code> для тега <code>#env</code> мы перенесли из\nпрошлой главы. На нижнем уровне Integrant дополнит наш словарь тегов\nсобственными, поэтому оба <code>#ig/ref</code> и <code>#env</code> будут работать.</p>\n<p>Теперь система хранится в файле, а теги описывают ее точнее и гибче.</p>\n<div><div><pre><code><span>(</span><span>defn</span><span> </span><span>load-config</span><span>\n</span><span>[</span><span>filename</span><span>]</span><span>\n</span><span>(</span><span>ig/read-string</span><span> </span><span>{</span><span>:readers</span><span> </span><span>{</span><span>'env</span><span> </span><span>tag-env</span><span>}}</span><span>\n</span><span>(</span><span>slurp</span><span> </span><span>filename</span><span>)))</span><span>\n</span><span>(</span><span>load-config</span><span> </span><span>&quot;integrant.test.edn&quot;</span><span>)</span><span>\n</span><span>{</span><span>:project.db/db</span><span> </span><span>{</span><span>:password</span><span> </span><span>&quot;c8497b517da25&quot;</span><span>}</span><span>\n</span><span>:project.worker/worker</span><span> </span><span>{</span><span>:options</span><span> </span><span>{</span><span>:sleep</span><span> </span><span>1000</span><span>}</span><span>\n</span><span>:db</span><span> </span><span>#</span><span>integrant.core.Ref</span><span>{</span><span>:key</span><span> </span><span>:project.db/db</span><span>}}}</span><span>\n</span></code></pre></div></div>\n<h3>Наследование ключей</h3>\n<p>В Clojure ключи могут выстраиваться в иерархию. Функция <code>derive</code> принимает два\nключа и задает превосходство первого над вторым.</p>\n<div><div><pre><code><span>(</span><span>derive</span><span> </span><span>::postgresql</span><span> </span><span>::database</span><span>)</span><span>\n</span></code></pre></div></div>\n<p>Когда мультиметод разрешает действие по ключу, он учитывает его\nиерархию. Например, если мультиметод реализован для <code>::database</code>, вызов с\n<code>::postgresql</code> не приведет к ошибке: сработает реализация <code>::database</code>.</p>\n<p>Поскольку Integrant устроен на мультиметодах, из наследования ключей можно\nизвлечь пользу. Например, нагруженные проекты работают с двумя базами данных:\nмастер для записи и реплика для чтения. Пусть это будут компоненты <code>::db-master</code>\nи <code>::db-replica</code>. Технически они одинаковы и отличаются только входными\nпараметрами.</p>\n<p>Если бы мы не знали про наследование, то расширили бы <code>ig/init-key</code> и\n<code>ig/halt-key!</code> каждым ключом. Пришлось бы копировать код каждой реализации, что\nне гибко и считается плохой практикой. Вспомним, что мы уже описали поведение\nбазы компонентом <code>::db</code>. Унаследуем от него две других базы:</p>\n<div><div><pre><code><span>(</span><span>derive</span><span> </span><span>::db-master</span><span> </span><span>::db</span><span>)</span><span>\n</span><span>(</span><span>derive</span><span> </span><span>::db-replica</span><span> </span><span>::db</span><span>)</span><span>\n</span></code></pre></div></div>\n<p>Изменим конфигурацию так, что в ней две базы данных: мастер и реплика. Для\nреплики мы выставили флаг <code>:read-only</code> true, чтобы обезопасить себя от записи не\nв тот источник. Обратите внимание от какой базы зависит каждый\nкомпонент. Поскольку воркер пишет данные в базу, он зависит от\n<code>::db-master</code>. Компонент <code>::hander</code> только читает данные, поэтому зависит от\n<code>::db-replica</code>.</p>\n<div><div><pre><code><span>(</span><span>def</span><span> </span><span>config</span><span>\n</span><span>{</span><span>::server</span><span> </span><span>{</span><span>:options</span><span> </span><span>{</span><span>:port</span><span> </span><span>8080</span><span> </span><span>:join?</span><span> </span><span>false</span><span>}</span><span>\n</span><span>:handler</span><span> </span><span>(</span><span>ig/ref</span><span> </span><span>::handler</span><span>)}</span><span>\n</span><span>::db-master</span><span> </span><span>{</span><span>;; other fields</span><span>\n</span><span>:read-only</span><span> </span><span>false</span><span>}</span><span>\n</span><span>::db-replica</span><span> </span><span>{</span><span>;; other fields</span><span>\n</span><span>:read-only</span><span> </span><span>true</span><span>}</span><span>\n</span><span>::worker</span><span> </span><span>{</span><span>:options</span><span> </span><span>{</span><span>:sleep</span><span> </span><span>1000</span><span>}</span><span>\n</span><span>:db</span><span> </span><span>(</span><span>ig/ref</span><span> </span><span>::db-master</span><span>)}</span><span>\n</span><span>::handler</span><span> </span><span>{</span><span>:db</span><span> </span><span>(</span><span>ig/ref</span><span> </span><span>::db-replica</span><span>)}})</span><span>\n</span></code></pre></div></div>\n<p>Функция <code>ig/refset</code> и одноименный тег вернут множество зависимостей с учетом\nиерархии. Предположим, что один из компонентов ожидает все базы данных для\nкакой-то ручной синхронизации. Чтобы не ссылаться на каждую базу вручную, укажем\nее корневой ключ.</p>\n<p>Добавим в конфигурацию компонент <code>::sync</code> с зависимостью через <code>refset</code>. Объявим\nпустой <code>init-key</code> для этого компонента: он ничего не делает, а только возвращает\nпараметры. При запуске компонент получит множество баз в поле <code>:dbs</code></p>\n<div><div><pre><code><span>{</span><span>::sync</span><span> </span><span>{</span><span>:dbs</span><span> </span><span>(</span><span>ig/refset</span><span> </span><span>::db</span><span>)}}</span><span>\n</span><span>(</span><span>defmethod</span><span> </span><span>ig/init-key</span><span> </span><span>::sync</span><span>\n</span><span>[</span><span>_</span><span> </span><span>opt</span><span>]</span><span> </span><span>opt</span><span>)</span><span>\n</span><span>(</span><span>system-start</span><span> </span><span>config</span><span>)</span><span>\n</span><span>(</span><span>-></span><span> </span><span>system</span><span> </span><span>::sync</span><span> </span><span>:dbs</span><span> </span><span>count</span><span>)</span><span>\n</span><span>2</span><span>\n</span></code></pre></div></div>\n<h3>Другие стадии компонента</h3>\n<p>Кроме запуска и остановки, Integrant выделяет дополнительные стадии, которые\nпроходит компонент. В отличии от запуска, они не обязательны к\nреализации. Дополнительные стадии устроены как мультиметоды, которым задано\nдействие по умолчанию (вернуть nil или исходный объект). Чтобы подписать\nкомпонент на событие, расширите мультиметод его ключом. Ниже мы рассмотрим\nнесколько полезных стадий.</p>\n<h3>Подготовка</h3>\n<p>Метод <code>ig/prep-key</code> служит для предварительной подготовки параметров. Чаще всего\nэто объединение параметров по умолчанию с теми, что мы получили из\nконфигурации. Например, мы выяснили, что для нашей инфраструктуры важны именно\nтакие метрики пула БД. Чтобы не указывать в конфигурации все поля, вынесем их\nфиксированную часть в словарь опций по умолчанию.</p>\n<div><div><pre><code><span>(</span><span>def</span><span> </span><span>db-defaults</span><span>\n</span><span>{</span><span>:auto-commit</span><span> </span><span>false</span><span>\n</span><span>:read-only</span><span> </span><span>false</span><span>\n</span><span>:connection-timeout</span><span> </span><span>30000</span><span>\n</span><span>:validation-timeout</span><span> </span><span>5000</span><span>\n</span><span>:idle-timeout</span><span> </span><span>600000</span><span>\n</span><span>:max-lifetime</span><span> </span><span>1800000</span><span>\n</span><span>:minimum-idle</span><span> </span><span>10</span><span>\n</span><span>:maximum-pool-size</span><span> </span><span>10</span><span>})</span><span>\n</span><span>(</span><span>defmethod</span><span> </span><span>ig/prep-key</span><span> </span><span>::db</span><span>\n</span><span>[</span><span>_</span><span> </span><span>options</span><span>]</span><span>\n</span><span>(</span><span>merge</span><span> </span><span>db-defaults</span><span> </span><span>options</span><span>))</span><span>\n</span></code></pre></div></div>\n<p>Метод <code>prep-key</code> объединяет этот словарь с параметрами. Теперь в конфигурации\nдостаточно указать только параметры подключения и, если требуется,\nпереопределения:</p>\n<div><div><pre><code><span>{</span><span>::db</span><span> </span><span>{</span><span>:auto-commit</span><span> </span><span>true</span><span> </span><span>;; override the default</span><span>\n</span><span>:adapter</span><span> </span><span>&quot;postgresql&quot;</span><span>\n</span><span>:username</span><span> </span><span>&quot;book&quot;</span><span>\n</span><span>:password</span><span> </span><span>&quot;book&quot;</span><span>\n</span><span>:database-name</span><span> </span><span>&quot;book&quot;</span><span>\n</span><span>:server-name</span><span> </span><span>&quot;127.0.0.1&quot;</span><span>\n</span><span>:port-number</span><span> </span><span>5432</span><span>}}</span><span>\n</span></code></pre></div></div>\n<p>Функция <code>ig/prep</code> принимает конфигурацию и запускает метод для каждого\nключа. Чтобы не забыть этот шаг, сделайте его частью функции <code>load-config</code>,\nкоторую мы описали выше.</p>\n<h3>Спека</h3>\n<p>Метод <code>ig/pre-init-spec</code> связывает параметры компонента со спекой. Если метод\nвернул спеку для определенного ключа, параметры проходят проверку. Например, для\nбазы данных обязательны параметры подключения. Проверим их перед запуском пула:</p>\n<div><div><pre><code><span>(</span><span>require</span><span> </span><span>'</span><span>[</span><span>clojure.spec.alpha</span><span> </span><span>:as</span><span> </span><span>s</span><span>])</span><span>\n</span><span>(</span><span>s/def</span><span> </span><span>:db/username</span><span> </span><span>string?</span><span>)</span><span>\n</span><span>;; other db fields</span><span>\n</span><span>(</span><span>defmethod</span><span> </span><span>ig/pre-init-spec</span><span> </span><span>::db</span><span>\n</span><span>[</span><span>_</span><span>]</span><span>\n</span><span>(</span><span>s/keys</span><span> </span><span>:req-un</span><span> </span><span>[</span><span>:db/username</span><span>\n</span><span>:db/password</span><span>\n</span><span>:db/database-name</span><span>\n</span><span>:db/server-name</span><span>\n</span><span>:db/port-number</span><span>]))</span><span>\n</span></code></pre></div></div>\n<p>Если запустить систему с неверными параметрами, получим ошибку spec:</p>\n<div><div><pre><code>Execution error (ExceptionInfo) at integrant.core/spec-exception (core.cljc:385).\nSpec failed on key :book.integrant/db when building system\n&quot;book&quot; - failed: string? in: [:username] at: [:username] spec: :db/username\n</code></pre></div></div>\n<h3>Приостановка</h3>\n<p>Кроме <code>init</code> и <code>halt</code>, Integrant выделяет третье состояние системы —\n<code>suspended</code>. Приостановленный компонент не теряет состояние, а только ставит на\nпаузу внутренние процессы. Например, если это потребитель сообщений из очереди\n<code>(KafkaConsumer)</code>, он не закрывает соединение с очередью, а временно перестает\nчитать сообщения (вызывать метод <code>poll</code>). Обратная операция называется\nresume. При возобновлении компонент, не порождая новых тредов или соединений,\nпродолжает работу.</p>\n<p>По умолчанию приостановка и возобновление работают как <code>halt</code> и <code>init</code>. Это\nзначит, что если компонент не реализует эти события, он останавливается и\nзапускается заново. Чтобы задать верную реакцию на suspend и resume, реализуйте\nметоды <code>ig/suspend-key!</code> и <code>ig/resume-key</code>. Это потребует углубленного внимания\nи чтения документации. Мы оставим этот раздел читателю на самостоятельное\nизучение.</p>\n<h2>Заключение</h2>\n<p>Подобно тому, как машина складывается из деталей, программа состоит из\nкомпонентов. Система управляет компонентами. Это соглашение о том, как они\nустроены и связаны друг с другом.</p>\n<p>Любой проект нуждается в системе, и чем дальше он развивается, тем сильнее\nпотребность. Если в проекте нет соглашения о том, как проектировать составные\nчасти, он начинает буксовать. Поддержка проекта становится слишком затратной.</p>\n<p>Clojure предлагает разные подходы для систем. Наиболее популярные из них —\nMount, Compojure и Integrant — мы рассмотрели в этой главе. Библиотеки\nисповедуют разный подход, и скорее всего разработчик найдет то, что ему по душе.</p>\n<p>Проект Mount отталкивается от глобальных переменных. Если проект написан в таком\nстиле:</p>\n<div><div><pre><code><span>(</span><span>def</span><span> </span><span>server</span><span> </span><span>(</span><span>run-jetty</span><span> </span><span>app</span><span> </span><span>{</span><span>:port</span><span> </span><span>8080</span><span>}))</span><span>\n</span></code></pre></div></div>\n<p>, то портировать его на Mount будет легко. Переменная server станет сущностью,\nкоторая меняет значение по команде. Mount подойдет тем, кто только начал\nзнакомство с Clojure.</p>\n<p>Библиотека Component это шаг в сторону настоящих компонентов. Такие компоненты\nэто отдельные сущности, которые изолируют состояние. Компоненты и протоколы\nнапоминают классы и объекты и из современных языков программирования. По этой\nпричине некоторые разработчики недолюбливают Component и обвиняют его в излишней\nраздутости, “энтерпрайзности”.</p>\n<p>Действительно, иногда решение на компонентах занимает больше места, чем на\nатомах и функциях. С другой стороны, именно Component дает понимание того, как\nстроить устойчивые системы. Читатель заметит, что большую часть вопросов мы\nобсудили в разделе именно про Component.</p>\n<p>Проект Integrant ставит цель исправить некоторые недостатки Component. Он лишен\nООП-тяжести и целом более “кложурный”. Integrant опирается на идиомы и техники,\nпринятые в Clojure, и тем самым подкупает опытных разработчиков.</p>\n<p>Эта глава не ставит цель выяснить, какая из библиотек лучше. Не бросайтесь\nпереписывать проект с условного Mount на Component. Архитектура библиотек\nслишком отличается друг от друга. Это изнуряющий труд, и вы не поймете, каких\nпреимуществ достигли, пока не ощутите в них потребность.</p>\n<p>Вопрос о том, какая система лучше ниже рангом другого, более важного вопроса:\nзачем система нужна проекту. Когда вы понимаете важность системного подхода,\nтехнические решения найдутся сами.</p>",
   :direction "ltr"},
  :updated 1566691200000,
  :entities
  [{:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "Component"}],
    :id "nlp/f/entity/wd:2997928",
    :salienceLevel "mention",
    :label "Connected component"}
   {:mentions [{:text "Docker"}],
    :id "nlp/f/entity/wd:15206305",
    :salienceLevel "mention",
    :label "Docker"}
   {:mentions [{:text "Jetty"}],
    :id "nlp/f/entity/wd:1085688",
    :salienceLevel "mention",
    :label "Jetty"}
   {:mentions [{:text "PostgreSQL"} {:text "Postgres"}],
    :id "nlp/f/entity/wd:192490",
    :salienceLevel "mention",
    :label "PostgreSQL"}],
  :alternate
  [{:href "https://grishaev.me/clj-book-systems/", :type "text/html"}],
  :title "Системы в Clojure",
  :author "Ivan Grishaev",
  :published-str "Sat Aug 24 17:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16cccf100ac:b5993a:49b12733",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://grishaev.me/clj-book-systems/",
  :updateCount 1,
  :commonTopics
  [{:score 64.92870674924603,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1566691200000,
  :fingerprint "406f5901",
  :canonicalUrl "https://grishaev.me/clj-book-systems/"}
 {:tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1566727439166,
  :recrawled 1566737795159,
  :content
  {:content
   "<p>Cal Newport’s <a href=\"https://manuel-uberti.github.io/real-life/2019/04/10/digital-minimalism/\">Digital\nMinimalism</a>\nhas really changed my perspective on a lot of things in my life. Since I started\nmy decluttering process I’ve noticed several benefits. In particular, I’m less\nprone to distractions and leisure has become time for engaging activities.</p>\n<p>This new approach has prompted me to reconsider how I organise my days, weeks,\nand months. For a couple of years I’ve been using my custom variation of\n<a href=\"https://gettingthingsdone.com/\">GTD</a>, tracking everything with Org files in\nEmacs, and using <a href=\"https://syncthing.net/\">Syncthing</a> and\n<a href=\"http://www.orgzly.com/\">Orgzly</a> to keep it all synced with my phone. However,\nas I already explained when I wrote about Cal Newport’s book, my smartphone is\nnot my best friend, and so the whole setup is actually of little use. And\nlet’s be frank: sometimes I can leave Emacs alone.</p>\n<p>I also write a lot, everyday. <a href=\"https://www.filmsinwords.eu/\">I write about\nfilms</a>, note my ideas on the music I listen to and\nthe books I read, and I write for this blog too. Hence I need a place which can\nbe useful both for organising my life and for my basic urge to write. Enter\n<a href=\"https://bulletjournal.com/\">Bullet Journal</a>.</p>\n<p>I recently rediscovered the pleasure of pen and paper when in Leuven for <a href=\"https://manuel-uberti.github.io/clojure/2019/08/04/clojure-heart/\">Heart\nof Clojure</a>.\nSince I left the laptop at home on purpose, I spent almost every spare moment on\nmy notebook, and much of the article on the conference came straight from its\npages. As Ryder Carroll, the man behind Bullet Journal, points out in his book,\nthe connection our brain establishes with pen and paper is completely different\nfrom the one with keyboard and monitor. For me it’s mostly been a feeling\nI sensed when writing on my notebook. My thoughts just came out with a\nspontaneity I’ve rarely enjoyed with the digital counterparts.</p>\n<p>I won’t bother you with the details about Bullet Journal. The website has\ntutorials, videos, there is a book about it, so everything you need to know is\nout there. I picked this system because I find it simple and clear, modular and\npractical. Starting next month, I am going to fully migrate my GTD setup to\nBullet Journal and once again step back to distance myself from pervasive\ntechnology consumption.</p>",
   :direction "ltr"},
  :updated 1566691200000,
  :entities
  [{:mentions [{:text "Cal Newport"}],
    :id "nlp/f/entity/wd:16733303",
    :salienceLevel "about",
    :label "Cal Newport"}
   {:mentions [{:text "Emacs"}],
    :id "nlp/f/entity/wd:189722",
    :salienceLevel "mention",
    :label "Emacs"}],
  :alternate
  [{:href "http://manuel-uberti.github.io//real-life/2019/08/25/bujo/",
    :type "text/html"}],
  :title "A pen and a notebook",
  :author "Manuel Uberti",
  :published-str "Sat Aug 24 17:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16cc83b833e:69ea9a:69b9f616",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "http://manuel-uberti.github.io//real-life/2019/08/25/bujo/",
  :updateCount 1,
  :commonTopics
  [{:score 0.835,
    :id "nlp/f/topic/367",
    :salienceLevel "mention",
    :label "calligraphy"}
   {:score 0.742,
    :id "nlp/f/topic/1828",
    :salienceLevel "mention",
    :label "productivity"}],
  :published 1566691200000,
  :fingerprint "ec0b14f2"}
 {:engagement 4,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/todo",
    :label "todo"}
   {:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1566698096279,
  :recrawled 1566850462472,
  :content
  {:content
   "<h3>Idle in 50 Lines of Code — (idle?)</h3><figure><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/1000/0*j1a8CTFmKzI8ZJzP\">Photo by <a href=\"https://unsplash.com/@danedeaner?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText\">Dane Deaner</a> on <a href=\"https://unsplash.com/search/photos/snowboarding-big-jump?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText\">Unsplash</a>.</figure><p>I often advocate for ClojureScript over other languages, and usually it’s really difficult to appreciate the ease and simplicity of the language without experiencing it first-hand. So today we are going to cover a simple implementation of “Detecting Inactivity” or idle status.</p><p>This implementation is inspired by <a href=\"https://github.com/shawnmclean/Idle.js\">Idle.js</a>, it’s worth referencing if you are familiar with CoffeeScript. Written in ~150 loc, which is great for a small library.</p><p>But I think we can do even better and wrap this functionality in ~50 loc.</p><p>First we want to define what events will trigger activity within our application.</p><pre>(def *default-events*<br>  [&quot;click&quot; &quot;keydown&quot; &quot;scroll&quot; &quot;mousemove&quot; &quot;mouseenter&quot; &quot;mousewheel&quot;<br>   &quot;touchstart&quot; &quot;touchmove&quot;])</pre><p>We need to know when these events were fired. So let’s get the current date-time in milliseconds.</p><pre>(defn- time-now []<br>  (.getTime (js/Date.)))</pre><p>Once we have the current time we can compare that to our users last known activity.</p><pre>(defn- time-diff [initial timeout]<br>  (> timeout (- (time-now) initial))))</pre><p>Our final helpers will be used to log last user activity and set an interval of when to check for user activity.</p><pre>(defn- activity! [timestamp activity]<br>  (fn [_]<br>    (reset! timestamp (time-now))<br>    (reset! activity true))))</pre><pre>(defn when-interval [ms func]<br>  (js/setInterval func ms))</pre><p>Now we need a place to store our idle state, these are the default cells but we make them dynamic so that the state can be rebound if needed.</p><blockquote>We use the <em>j</em> symbol in reference to <em>javelin.core</em> .</blockquote><pre>(def ^:dynamic *active* (j/cell true))</pre><pre>(def ^:dynamic *last-active* (j/cell (time-now)))</pre><p>Our idle detecting library wouldn’t be any useful without a convenient way to access our idle state.</p><pre>(def idle? (j/cell= (not *active*)))</pre><pre>(def active? (j/cell= *active*))</pre><p>Finally we initialize our idle state detection, this has the dual function of attaching our event handler to all our activity events. As well as set the interval to check for user activity based on a configurable timeout.</p><p>If the difference between the last activity timestamp and the current time is greater than our timeout, user activity is considered idle.</p><pre>(defn idle! [&amp; opts]<br>  (let [timeout   (:timeout   opts 30000)<br>        events    (:events    opts *default-events*)<br>        activity  (:activity  opts *active*)<br>        timestamp (:timestamp opts *last-activity*)]<br>    (doseq [e events]<br>      (.addEventListener js/window e <br>        #(activity! timestamp activity)))<br>    (when-interval timeout<br>      #(when (time-diff @timestamp timeout)<br>        (reset! activity false)))))</pre><p>💥This library is available as part of <a href=\"https://github.com/degree9/enterprise\">degree9/enterprise</a>.</p><img width=\"1\" src=\"https://medium.com/_/stat?event=post.clientViewed&referrerSource=full_rss&postId=40ad24fe5bd5\" height=\"1\"><hr><p><a href=\"https://medium.com/degree9/idle-in-50-lines-of-code-idle-40ad24fe5bd5\">Idle in 50 Lines of Code — (idle?)</a> was originally published in <a href=\"https://medium.com/degree9\">degree9</a> on Medium, where people are continuing the conversation by highlighting and responding to this story.</p>",
   :direction "ltr"},
  :updated 1566694262000,
  :entities
  [{:mentions [{:text "CoffeeScript"}],
    :id "nlp/f/entity/wd:1106819",
    :salienceLevel "about",
    :label "CoffeeScript"}],
  :alternate
  [{:href
    "https://medium.com/degree9/idle-in-50-lines-of-code-idle-40ad24fe5bd5?source=rss----b6c2485247e4--clojure",
    :type "text/html"}],
  :title "Idle in 50 Lines of Code — (idle?)",
  :author "flyboarder",
  :published-str "Sat Aug 24 17:51:02 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16cc67bc697:54aa57:97b0c8f7",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url "https://cdn-images-1.medium.com/max/1000/0*j1a8CTFmKzI8ZJzP",
   :width 1000,
   :height 1250,
   :contentType "image/jpeg"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://medium.com/p/40ad24fe5bd5",
  :updateCount 2,
  :published 1566694262000,
  :fingerprint "b91049f5",
  :canonicalUrl
  "https://medium.com/degree9/idle-in-50-lines-of-code-idle-40ad24fe5bd5?source=rss----b6c2485247e4--clojure"}
 {:engagement 4,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/todo",
    :label "todo"}
   {:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1566684330714,
  :content
  {:content
   "The REPL\n<center>\n<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" align=\"center\" height=\"100%\">\n<tbody><tr>\n<td valign=\"top\" align=\"center\">\n<table border=\"0\" cellspacing=\"0\" width=\"100%\" cellpadding=\"0\">\n<tbody><tr>\n<td align=\"center\" valign=\"top\">\n<table border=\"0\" cellspacing=\"0\" width=\"100%\" cellpadding=\"0\">\n<tbody><tr>\n<td align=\"center\" valign=\"top\">\n<table border=\"0\" cellspacing=\"0\" width=\"600\" cellpadding=\"0\">\n<tbody><tr>\n<td valign=\"top\"><table border=\"0\" cellspacing=\"0\" width=\"100%\" cellpadding=\"0\">\n<tbody>\n<tr>\n<td valign=\"top\">\n<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" align=\"left\">\n<tbody><tr>\n<td valign=\"top\">\nReflections\n</td>\n</tr>\n</tbody></table>\n<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" align=\"left\">\n<tbody><tr>\n<td valign=\"top\">\n<a href=\"https://mailchi.mp/9060505d0662/iw2yp8uwia?e=[UNIQID]\" target=\"_blank\">View this email in your browser</a>\n</td>\n</tr>\n</tbody></table>\n</td>\n</tr>\n</tbody>\n</table></td>\n</tr>\n</tbody></table>\n</td> </tr>\n</tbody></table>\n</td>\n</tr>\n<tr>\n<td align=\"center\" valign=\"top\">\n<table border=\"0\" cellspacing=\"0\" width=\"100%\" cellpadding=\"0\">\n<tbody><tr>\n<td align=\"center\" valign=\"top\">\n<table border=\"0\" cellspacing=\"0\" width=\"600\" cellpadding=\"0\">\n<tbody><tr>\n<td valign=\"top\"><table border=\"0\" cellspacing=\"0\" width=\"100%\" cellpadding=\"0\">\n<tbody>\n<tr>\n<td valign=\"top\">\n<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" align=\"left\">\n<tbody><tr>\n<td valign=\"top\">\n<h1>The REPL</h1>\n<div>Supported by <a href=\"https://www.deps.co/?utm_source=therepl&utm_medium=email&utm_content=header-link\" target=\"_blank\">Deps - Private Hosted Maven Repositories</a></div>\n</td>\n</tr>\n</tbody></table>\n</td>\n</tr>\n</tbody>\n</table><table border=\"0\" cellspacing=\"0\" width=\"100%\" cellpadding=\"0\">\n<tbody>\n<tr>\n<td>\n<table border=\"0\" cellspacing=\"0\" width=\"100%\" cellpadding=\"0\">\n<tbody><tr>\n<td>\n<span></span>\n</td>\n</tr>\n</tbody></table>\n</td>\n</tr>\n</tbody>\n</table></td>\n</tr>\n</tbody></table>\n</td>\n</tr>\n</tbody></table>\n</td>\n</tr>\n<tr>\n<td align=\"center\" valign=\"top\">\n<table border=\"0\" cellspacing=\"0\" width=\"100%\" cellpadding=\"0\">\n<tbody><tr>\n<td align=\"center\" valign=\"top\">\n<table border=\"0\" cellspacing=\"0\" width=\"600\" cellpadding=\"0\">\n<tbody><tr>\n<td valign=\"top\"><table border=\"0\" cellspacing=\"0\" width=\"100%\" cellpadding=\"0\">\n<tbody>\n<tr>\n<td valign=\"top\">\n<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" align=\"left\">\n<tbody><tr>\n<td valign=\"top\">\n<p><strong>Notes.</strong></p>\n<p>I have to start this newsletter with a correction. <a href=\"https://www.therepl.net/91/\">Last time</a>, I said that I thought CircleCI was the Clojure company that had raised the most money. I was wrong, Nubank has <a href=\"https://techcrunch.com/2019/07/26/fintech-decacorn-nubank-raises-400m-led-by-tcv/\">raised</a> $820 million dollars, and has a valuation over $10 billion dollars. That makes them one of the most highly valued fintech startups. For context Stripe’s most recent valuation in 2019 put them at $22.5 billion dollars.</p>\n<p>Since the last newsletter I’ve been to Belgium and back for Heart of Clojure. It was a great event and I’m very happy I got to go. I met lots of readers and Clojurists Together members which was a big highlight for me.</p>\n<p><strong>-main</strong></p>\n<ul>\n<li>The <a href=\"https://www.youtube.com/playlist?list=PLhYmIiHOMWoEgJEvgkmUe8D0agxy_T2vR\">talks</a> from Heart of Clojure have just gone up, including my talk <a href=\"https://youtu.be/z_q6nVeD_K4?list=PLhYmIiHOMWoEgJEvgkmUe8D0agxy_T2vR\">Building Stable Foundations</a></li>\n<li>I wrote about why I think <a href=\"https://danielcompton.net/2019/08/24/heart-of-clojure\">Heart of Clojure was so special</a>. See also reflections from <a href=\"https://lambdaisland.com/blog/2019-08-09-fork-this-conference\">Fork This Conference</a>, <a href=\"http://manuel-uberti.github.io//clojure/2019/08/04/clojure-heart/\">The people’s conference</a>, <a href=\"https://quanttype.net/posts/2019-08-12-hallway-track-conference.html\">The hallway track conference</a>, <a href=\"http://www.saskialindner.com/blog/2019-08-16-community-with-heart/\">Community with lots of heart</a>, and <a href=\"https://mallozup.github.io/posts/heartofclojure/\">A courageous conference?</a></li>\n<li><a href=\"https://danielcompton.net/2019/08/24/heart-of-clojure\">What’s the state of error messages?</a></li>\n<li><a href=\"https://mccormick.cx/news/entries/clojurescript-pixel-game-engine-with-blender-live-reloading\">ClojureScript Pixel Game Engine With Blender Live-reloading</a></li>\n<li><a href=\"http://www.flyingmachinestudios.com/programming/why-programmers-need-frameworks/\">Frameworks and Why (Clojure) Programmers Need Them</a></li>\n<li>I <a href=\"https://www.therepl.net/episodes/28/\">talked</a> with Ambrose Bonnaire-Sergeant about his PhD in Typed Clojure.</li>\n<li>Clojurists Together is <a href=\"https://www.clojuriststogether.org/news/q3-2019-funding-announcement/\">funding</a> Shadow CLJS with Thomas Heller, Meander with Joel Holdbrooks, Calva with Peter Strömberg, and CIDER with Bozhidar Batsov. This is thanks to the generosity of all of the <a href=\"https://www.clojuriststogether.org/members/\">members</a> of Clojurists Together.</li>\n<li><a href=\"https://circleci.com/blog/ci-cd-meet-cas-continuous-application-security/\">How CircleCI processes over 30 million builds per month</a></li>\n<li><a href=\"https://www.clojuriststogether.org/beyond/\">Beyond Clojurists Together</a> is a page listing Clojure projects that you can support directly.</li>\n</ul>\n<p><strong>Libraries &amp; Books.</strong></p>\n<ul>\n<li>Metosin continue to push performance boundaries, this time with <a href=\"https://github.com/metosin/porsas\">porsas</a>, an experimental set of tools for doing JDBC queries in idiomatic Clojure but with Java performance.</li>\n<li>Erik Norman’s new book <a href=\"https://www.manning.com/books/grokking-simplicity\">Grokking Clojure</a> is out in Manning’s early access program. You can get a 50% discount with code MLNORMAND.</li>\n</ul>\n<p><strong>People are worried about Types. </strong><a href=\"https://danielcompton.net/2016/07/11/people-are-worried-about-types\"><strong>?</strong></a></p>\n<ul>\n<li>Functional Works has written a <em>very</em> extensive guide to <a href=\"https://functional.works-hub.com/learn/a-guide-to-the-clojure-spec-library-606d6\">spec</a></li>\n<li>Metosin has written about their <a href=\"https://github.com/metosin/malli#motivation\">motivations</a> for Malli, their new data schema tool for Clojure/Script.</li>\n</ul>\n<p><strong>Foundations.</strong></p>\n<ul>\n<li>“Describing all non-copying relocating collectors as ‘Mark Compact’ is like referring to the bulk of zoology as the study of non-elephant animals.” - <a href=\"https://groups.google.com/forum/#!msg/mechanical-sympathy/Kk0rQij7q8I/1COVmJc_AgAJ\">Mechanical Sympathy</a></li>\n<li>If you’ve been hankering to mix your Rust code with Clojure, <a href=\"https://github.com/ruestigraben/ruesti-base\">Rüstigraben</a> is a work-in-progress to let you run Rust code in GraalVM.</li>\n</ul>\n<p><strong>Tools.</strong></p>\n<ul>\n<li>Speaking on Nubank, they’ve open sourced <a href=\"https://github.com/nubank/workspaces\">Workspaces</a>, a devcards-like UI component development library.</li>\n<li><a href=\"https://github.com/Viasat/salt\">salt</a> is an experimental tool to convert a subset of Clojure into TLA+ (!)</li>\n<li><a href=\"https://clojureverse.org/t/calva-funding-and-reinforcements-and-more/4712\">Calva Funding and Reinforcements and more!</a></li>\n<li>clj-kondo now has support for emitting <a href=\"https://github.com/borkdude/clj-kondo/blob/master/analysis/README.md\">analysis data</a></li>\n<li>Also from Michiel Borkent, <a href=\"https://github.com/borkdude/babashka\">babashka</a> lets you write a subset of Clojure in shell scripts or other places you need quick startup. <a href=\"https://github.com/borkdude/sci\">sci</a> is the Small Clojure Interpreter that is backing it.</li>\n<li><a href=\"https://github.com/borkdude/jet\" target=\"_blank\">jet</a>, again from Michiel Borkent is a CLI tool for transforming between JSON, EDN, and Transit</li>\n<li><a href=\"http://jr0cket.co.uk/2019/08/community-tools-and-templates-for-Clojure-CLI-tools.html\">Community Tools and Templates for Clojure CLI Tools</a></li>\n<li><a href=\"http://www.arachnid.co.nz/blog/neanderthalrebl\">Setting up</a> Neanderthal with REBL and Cursive from fellow kiwi Nick Jones.</li>\n<li>lvh has written <a href=\"https://github.com/latacora/wernicke\">wernicke</a>, a Graal based data redaction tool. This is especially useful for transforming production data into a form safe to use in tests.</li>\n</ul>\n<p><strong>Recent Developments.</strong></p>\n<ul>\n<li><a href=\"http://insideclojure.org/2019/08/10/journal/\">Journal 2019.22 - spec updates, tools.deps</a></li>\n</ul>\n<p><strong>Learning</strong></p>\n<ul>\n<li><a href=\"http://www.parens-of-the-dead.com/\">Parens of the Dead</a> is back after a hiatus. These are screencasts building games in Clojure and ClojureScript. You can catch the first three episodes of season 2 on <a href=\"https://www.twitch.tv/magnars78/videos\">Twitch</a>.</li>\n<li>A <a href=\"https://twitter.com/roman01la/status/1162661056147329025\">quick summary</a> of how to interop with JS from ClojureScript.</li>\n</ul>\n<p><strong>Misc.</strong></p>\n<p><a href=\"https://craigmod.com/essays/fast_software/\">Fast Software, the Best Software</a>, and <a href=\"https://www.hillelwayne.com/post/performance-matters/\">Performance Matters</a> are two good reflections on performance.</p>\n<p>I’m Daniel Compton. I maintain public Maven repositories at <a href=\"https://clojars.org/\">Clojars</a>, private ones at <a href=\"https://www.deps.co/\">Deps</a>, and help fund OSS Clojure projects (along with tons of generous <a href=\"https://www.clojuriststogether.org/\">members</a> like <a href=\"https://pitch.com/\">Pitch</a>, <a href=\"https://nubank.com.br/\">Nubank</a>, <a href=\"https://juxt.pro/\">JUXT</a>, <a href=\"https://www.metosin.fi/\">Metosin</a>, <a href=\"http://www.adgoji.com/\">Adgoji</a>, and <a href=\"https://www.fundingcircle.com/\">Funding Circle</a>) at <a href=\"https://www.clojuriststogether.org/\">Clojurists Together</a>. If you’ve enjoyed reading this, tell your friends to sign up at <a href=\"https://www.therepl.net/\">therepl.net</a>, or post a link in your company chatroom. If you’ve seen (or published) a blog post, library, or anything else Clojure/JVM related please reply to this to let me know about it.</p>\n<p>If you’d like to support the work that I’m doing, consider signing up for a trial of <a href=\"https://www.deps.co/\">Deps</a>, a private, hosted, Maven Repository service that I run.</p>\n<p>Thanks!</p>\n<p> </p>\n</td>\n</tr>\n</tbody></table>\n</td>\n</tr>\n</tbody>\n</table></td>\n</tr>\n</tbody></table>\n</td>\n</tr>\n</tbody></table>\n</td>\n</tr>\n<tr>\n<td align=\"center\" valign=\"top\">\n<table border=\"0\" cellspacing=\"0\" width=\"100%\" cellpadding=\"0\">\n<tbody><tr>\n<td align=\"center\" valign=\"top\">\n<table border=\"0\" cellspacing=\"0\" width=\"600\" cellpadding=\"0\">\n<tbody><tr>\n<td valign=\"top\"><table border=\"0\" cellspacing=\"0\" width=\"100%\" cellpadding=\"0\">\n<tbody>\n<tr>\n<td>\n<table border=\"0\" cellspacing=\"0\" width=\"100%\" cellpadding=\"0\">\n<tbody><tr>\n<td>\n<span></span>\n</td>\n</tr>\n</tbody></table>\n</td>\n</tr>\n</tbody>\n</table><table border=\"0\" cellspacing=\"0\" width=\"100%\" cellpadding=\"0\">\n<tbody>\n<tr>\n<td valign=\"top\" align=\"center\">\n<table border=\"0\" cellspacing=\"0\" width=\"100%\" cellpadding=\"0\">\n<tbody><tr>\n<td align=\"center\">\n<table border=\"0\" cellspacing=\"0\" width=\"100%\" cellpadding=\"0\">\n<tbody><tr>\n<td align=\"center\" valign=\"top\">\n<table border=\"0\" cellspacing=\"0\" align=\"center\" cellpadding=\"0\">\n<tbody><tr>\n<td align=\"center\" valign=\"top\">\n<table border=\"0\" cellspacing=\"0\" align=\"left\" cellpadding=\"0\">\n<tbody><tr>\n<td valign=\"top\">\n<table border=\"0\" cellspacing=\"0\" width=\"100%\" cellpadding=\"0\">\n<tbody><tr>\n<td align=\"left\" valign=\"middle\">\n<table border=\"0\" cellspacing=\"0\" width align=\"left\" cellpadding=\"0\">\n<tbody><tr>\n<td width=\"24\" valign=\"middle\" align=\"center\">\n<a href=\"https://twitter.com/the_repl\" target=\"_blank\"><img alt=\"Twitter\" width=\"24\" src=\"https://cdn-images.mailchimp.com/icons/social-block-v2/dark-twitter-48.png\" height=\"24\"></a>\n</td>\n</tr>\n</tbody></table>\n</td>\n</tr>\n</tbody></table>\n</td>\n</tr>\n</tbody></table>\n</td>\n</tr>\n</tbody></table>\n</td>\n</tr>\n</tbody></table>\n</td>\n</tr>\n</tbody></table>\n</td>\n</tr>\n</tbody>\n</table><table border=\"0\" cellspacing=\"0\" width=\"100%\" cellpadding=\"0\">\n<tbody>\n<tr>\n<td valign=\"top\">\n<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" align=\"left\">\n<tbody><tr>\n<td valign=\"top\">\n<em>Copyright © 2019 Daniel Compton, All rights reserved.</em>\n<br>\n<br>\n<br>\nWant to change how you receive these emails?<br>\nYou can <a href=\"https://danielcompton.us7.list-manage.com/profile?u=fef380870c4a5633a21f55d8e&id=b5272e542b&e=[UNIQID]\">update your preferences</a> or <a href=\"https://danielcompton.us7.list-manage.com/unsubscribe?u=fef380870c4a5633a21f55d8e&id=b5272e542b&e=[UNIQID]&c=4d2d6d4fbf\">unsubscribe from this list</a>\n<br>\n<br>\n<a href=\"http://www.mailchimp.com/monkey-rewards/?utm_source=freemium_newsletter&utm_medium=email&utm_campaign=monkey_rewards&aid=fef380870c4a5633a21f55d8e&afl=1\"><img border=\"0\" src=\"https://cdn-images.mailchimp.com/monkey_rewards/MC_MonkeyReward_15.png\" alt=\"Email Marketing Powered by Mailchimp\" width=\"139\" title=\"Mailchimp Email Marketing\" height=\"54\"></a>\n</td>\n</tr>\n</tbody></table>\n</td>\n</tr>\n</tbody>\n</table><table border=\"0\" cellspacing=\"0\" width=\"100%\" cellpadding=\"0\">\n<tbody>\n<tr>\n<td>\n<table border=\"0\" cellspacing=\"0\" width=\"100%\" cellpadding=\"0\">\n<tbody><tr>\n<td>\n<span></span>\n</td>\n</tr>\n</tbody></table>\n</td>\n</tr>\n</tbody>\n</table></td>\n</tr>\n</tbody></table>\n</td>\n</tr>\n</tbody></table>\n</td>\n</tr>\n</tbody></table>\n</td>\n</tr>\n</tbody></table>\n</center>",
   :direction "ltr"},
  :updated 1566682290000,
  :entities
  [{:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "REPL"}],
    :id "nlp/f/entity/wd:2032810",
    :salienceLevel "mention",
    :label "Read–eval–print loop"}
   {:mentions [{:text "Maven"}],
    :id "nlp/f/entity/wd:139941",
    :salienceLevel "mention",
    :label "Apache Maven"}
   {:mentions [{:text "Nubank"}],
    :id "nlp/f/entity/wd:25422888",
    :salienceLevel "mention",
    :label "Nubank"}
   {:mentions [{:text "Community"}],
    :id "nlp/f/entity/wd:728553",
    :salienceLevel "mention",
    :label "Community"}],
  :alternate
  [{:href "https://mailchi.mp/9060505d0662/iw2yp8uwia",
    :type "text/html"}],
  :title "The REPL",
  :author "The REPL",
  :published-str "Sat Aug 24 14:31:30 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16cc5a9bada:473590:69b9f616",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url
   "https://cdn-images.mailchimp.com/monkey_rewards/MC_MonkeyReward_15.png",
   :width 276,
   :height 108,
   :contentType "image/png"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://mailchi.mp/9060505d0662/iw2yp8uwia",
  :commonTopics
  [{:score 46.891910601058726,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.782,
    :id "nlp/f/topic/1833",
    :salienceLevel "mention",
    :label "project management"}
   {:score 0.717,
    :id "nlp/f/topic/1555",
    :salienceLevel "mention",
    :label "net"}],
  :published 1566682290000,
  :fingerprint "ea08cd3e",
  :canonicalUrl "https://mailchi.mp/9060505d0662/iw2yp8uwia"}
 {:engagement 8,
  :unread false,
  :crawled 1566639045103,
  :recrawled 1566686936595,
  :content
  {:content
   "<p>A few weeks ago I got to attend and speak at <a href=\"https://heartofclojure.eu\">Heart of Clojure</a>. I met lots of online friends in person for the first time, and made some new ones too. I’ve thought a lot about how to describe it since then, and evey time I come back to the word special.</p>\n<p>Others have also posted their thoughts on Heart of Clojure: <a href=\"https://lambdaisland.com/blog/2019-08-09-fork-this-conference\">Fork This Conference</a>, <a href=\"http://manuel-uberti.github.io//clojure/2019/08/04/clojure-heart/\">The people’s conference</a>, <a href=\"https://quanttype.net/posts/2019-08-12-hallway-track-conference.html\">The hallway track conference</a>, <a href=\"http://www.saskialindner.com/blog/2019-08-16-community-with-heart/\">Community with lots of heart</a>, and <a href=\"https://mallozup.github.io/posts/heartofclojure/\">A courageous conference?</a>.</p>\n<p>Here were some things that I think made Heart of Clojure so special. If you’re running a conference, consider stealing some of these ideas.</p>\n<ul>\n<li>There was an <a href=\"https://activities.heartofclojure.eu\">site</a> which listed activities around the event. Anyone could host an activity and others could join. Having it on a website meant everyone knew what was happening around the conference. I felt like this helped Heart of Clojure feel very welcoming to all of the conference goers, especially those who were less outgoing.</li>\n<li>One of the nights I joined an activity for an adventurous dinner. People got split into groups of 6-8 with a reservation at a restaraunt in Leuven. This broke up friend groups and introduced me to a bunch of new people. The restaurant we went to had their own brewery, and I got to try the flavours of a beer soup, beer stew, and beer crème brûlée!</li>\n<li>Yulia Startsev’s talk <a href=\"https://www.youtube.com/watch?v=-IGViUlbemo&feature=youtu.be\">To loosen up, to put together</a> set the tone for the conference and captured the spirit of mixing technology and the humanities. Many of the talks and conversations referenced her talk throughout the rest of the event.</li>\n<li>Leuven was a perfect town to have the conference. It was large enough to have a good nightlife, but small enough that you could walk between the conference venue, the bars, restauruants, and hotels in 10-15 minutes.</li>\n<li>In the months before the conference, <a href=\"https://www.janstepien.com\">Jan Stępień</a> paired up new speakers with more experienced speakers. This was my first conference talk, and I got paired up with Tiago Luchini. Tiago was a very experienced public speaker and gave me great feedback on my talk. Having to show someone my presentation helped me get it into shape well before the conference. I think Jan’s work here contributed to the high quality of the talks at the conference.</li>\n<li>I’m not a vegeterian, but I really appreciated that all of the breakfast and lunches were vegeterian. I can imagine it would have made things very easy for vegeterians. The food was delicious and healthy tasting.</li>\n<li>There was ample time left around the talks so that you didn’t need to choose between the ‘hallway track’ and the conference track. On the Saturday there was a siesta break between 12pm and 4pm. You could do one of the activities, take a nap, or just chat with others. I was a bit skeptical before the conference that this was going to be too long, but it worked out really well.</li>\n<li>The lightning talks on Saturday broke up the afternoon and left space for serendipity to strike. Connie’s <a href=\"https://www.youtube.com/watch?v=qyhjok21Y3o&list=PLhYmIiHOMWoEgJEvgkmUe8D0agxy_T2vR&index=16&t=0s\">talk</a> on waffles, Vim, and building her own language captured the audience.</li>\n<li>On the Saturday evening after the conference ended, lots of people stayed behind to help pack down the auditorium. This made the job much easier.</li>\n<li>There was a large contingent of people from Berlin, and they were all incredible. Berlin feels like it has a really vibrant community, one day I’d like to visit it.</li>\n</ul>\n<p>Heart of Clojure was a very special event. I can’t imagine how much work it was for Arne Brasseur, Martin Klepsch, and all of the other helpers before, during, and after the event but it paid off. Heart of Clojure felt like a very polished event, not something being put on for the first time. Thanks to everyone who organised, helped out, spoke, sponsored, and attended the conference. I hope there is another Heart of Clojure in the future, if you get a chance to go, I highly recommend it.</p>",
   :direction "ltr"},
  :updated 1566680045000,
  :entities
  [{:mentions [{:text "Leuven"}],
    :id "nlp/f/entity/wd:118958",
    :salienceLevel "mention",
    :label "Leuven"}
   {:mentions [{:text "crème brûlée"}],
    :id "nlp/f/entity/wd:312839",
    :salienceLevel "mention",
    :label "crème brûlée"}
   {:mentions [{:text "beer soup"}],
    :id "nlp/f/entity/wd:557521",
    :salienceLevel "mention",
    :label "beer soup"}],
  :alternate
  [{:href "https://danielcompton.net/2019/08/24/heart-of-clojure",
    :type "text/html"}],
  :title "Why Heart of Clojure was special",
  :author "Daniel Compton",
  :published-str "Sat Aug 24 13:54:05 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16cc2f6b9ef:1e64c9:97b0c8f7",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url "http://img.youtube.com/vi/-IGViUlbemo/0.jpg",
   :width 480,
   :height 360,
   :contentType "image/jpeg"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "http://danielcompton.net/2019/08/24/heart-of-clojure",
  :updateCount 4,
  :commonTopics
  [{:score 0.926,
    :id "nlp/f/topic/387",
    :salienceLevel "about",
    :label "cardiology"}
   {:score 0.801,
    :id "nlp/f/topic/850",
    :salienceLevel "mention",
    :label "feminism"}],
  :published 1566680045000,
  :fingerprint "661c5cb7",
  :canonicalUrl
  "https://danielcompton.net/2019/08/24/heart-of-clojure"}
 {:engagement 4,
  :unread false,
  :crawled 1566577519633,
  :content
  {:content
   "<p>Each week, we answer a different question about Clojure and functional programming.</p>\n<p>If you have a question you’d like us to discuss, tweet <a href=\"https://twitter.com/clojuredesign\">@clojuredesign</a>, send an email to <a href=\"mailto:feedback@clojuredesign.club\">feedback@clojuredesign.club</a>, or join the <code>#clojuredesign-podcast</code> channel on the <a href=\"http://clojurians.net/\">Clojurians Slack</a>.</p>\n<p>This week, the question is: <strong>“What is ‘faking’ a resource?”</strong> We talk about the virtues of faking and then outline several real techniques for getting work done.</p>\n<p>Selected quotes:</p>\n<ul>\n<li>“We like to mock mocking, so don’t mock us if we mock mocking.”</li>\n<li>“No object is an island, they always refer to each other.”</li>\n<li>“It’s all about getting work done.”</li>\n<li>“Why make my own fake data when the computer is so good at it?”</li>\n<li>“It’s like training a small diminutive version of the external service to behave in the ways you want it to so you can get stuff done.”</li>\n<li>“Fake it while you make it.”</li>\n</ul>\n<p>Related episodes</p>\n<ul>\n<li><a href=\"https://clojuredesign.club/episode/014-fiddle-with-the-repl\">014: Fiddle with the REPL</a></li>\n<li><a href=\"https://clojuredesign.club/episode/025-fake-results-real-speed\">025: Fake Results, Real Speed</a></li>\n</ul>",
   :direction "ltr"},
  :updated 1566572400000,
  :entities
  [{:mentions [{:text "functional programming"}],
    :id "nlp/f/entity/wd:193076",
    :salienceLevel "about",
    :label "functional programming"}
   {:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "about",
    :label "Clojure"}
   {:mentions [{:text "REPL"}],
    :id "nlp/f/entity/wd:2032810",
    :salienceLevel "mention",
    :label "Read–eval–print loop"}],
  :alternate
  [{:href
    "https://clojuredesign.club/episode/043-what-is-faking-a-resource/",
    :type "text/html"}],
  :title "Ep 043: What Is 'Faking' a Resource?",
  :author "Christoph Neumann and Nate Jones",
  :published-str "Fri Aug 23 08:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16cbf4bec11:3ba41c0:340e5e89",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://clojuredesign.club/episode/043-what-is-faking-a-resource/",
  :commonTopics
  [{:score 0.993,
    :id "nlp/f/topic/603",
    :salienceLevel "about",
    :label "cybercrime"}
   {:score 0.98,
    :id "nlp/f/topic/501",
    :salienceLevel "about",
    :label "college"}
   {:score 0.973,
    :id "nlp/f/topic/349",
    :salienceLevel "about",
    :label "business"}
   {:score 0.817,
    :id "nlp/f/topic/861",
    :salienceLevel "mention",
    :label "finance"}
   {:score 0.75,
    :id "nlp/f/topic/1695",
    :salienceLevel "mention",
    :label "parenting"}],
  :published 1566572400000,
  :fingerprint "46a1967b",
  :canonicalUrl
  "https://clojuredesign.club/episode/043-what-is-faking-a-resource/"}
 {:engagement 44,
  :unread false,
  :crawled 1566521565931,
  :content
  {:content
   "<p><i>This is a follow-up post from <a href=\"https://stackshare.io/circleci/how-circleci-processes-4-5-million-builds-per-month\" target=\"new\">How CircleCI Processes 4.5 Million Builds Per Month</a>. It was originally published on Stackshare <a href=\"https://stackshare.io/circleci/update-how-circleci-processes-over-30-million-builds-per-month\" target=\"new\">here</a>.</i></p>\n<p>CircleCI is a continuous integration and delivery platform that enables you to automate your development process quickly, safely, and at scale. Engineers around the world at companies of all sizes trust us to run their tests and deploy their software. We’ve earned that trust by using a solid stack of software allowing our users and their teams to continuously deliver value to their users.</p>\n<p>As CTO at CircleCI, I help make the big technical decisions and keep our teams happy and out of trouble. Before this, I was CTO of Copious, where I learned a lot of important lessons about tech in service of building a consumer marketplace. I like snowboarding, Funkadelic, and cappuccino.</p>\n<h2>The teams</h2>\n<p>In the last year, we have seen tremendous growth on our engineering teams. This growth forced us to rethink our engineering growth paths as well as what we needed in engineering managers. One key result of this was an update to our engineering competency matrix that we <a href=\"https://docs.google.com/spreadsheets/d/131XZCEb8LoXqy79WWrhCX4sBnGhCM1nAIz4feFZJsEo/edit#gid=0\" target=\"new\">published</a>. This has helped us in hiring for our <a href=\"https://circleci.com/careers/\" target=\"new\">open positions</a> and creating better career paths for our current engineers. It also increases transparency in expectation. Reasonable and clear expectations, team alignment, and transparency are key values of our engineering teams as they consist of engineers working remotely at locations distributed around the world.</p>\n<p>We use Pingboard to find out who is “in” or “out” of the office, <a href=\"https://stackshare.io/zoom\" target=\"new\">Zoom</a> for video conferencing and screen sharing with those who are “in”, <a href=\"https://stackshare.io/slack\" target=\"new\">Slack</a> for synchronous and asynchronous communication, and to organize all of the efforts across the teams, we use <a href=\"https://stackshare.io/jira\" target=\"new\">JIRA</a>. Additionally, Slack-based integration tools such as <a href=\"https://stackshare.io/hubot\" target=\"new\">Hubot</a>, <a href=\"https://stackshare.io/pagerduty\" target=\"new\">PagerDuty</a>, <a href=\"https://stackshare.io/looker\" target=\"new\">Looker</a>, <a href=\"https://stackshare.io/amplitude\" target=\"new\">Amplitude</a>, <a href=\"https://stackshare.io/datadog\" target=\"new\">Datadog</a>, and <a href=\"https://stackshare.io/rollbar\" target=\"new\">Rollbar</a> are used to bring information and data into our primary communication tool. <a href=\"https://giphy.com/\" target=\"new\">Giphy</a>’s Slack-based integration has also proven itself to be invaluable.</p>\n<h2>The stack</h2>\n<h3>Languages</h3>\n<p>Most of CircleCI is written in <a href=\"https://stackshare.io/clojure\" target=\"new\">Clojure</a> and it has been this way since almost the beginning. Early development included Rails, but by the time that CircleCI was released to the public, it was written entirely in Clojure. Clojure is still at our platform’s core. It helps having a common language across much of our stack to allow for our engineers to move between layers of the stack without much overhead.</p>\n<p>Being fans of Clojure is not reason enough to build out the entire stack in that language. When we launched our 2.0 platform, the build agent was written in <a href=\"https://stackshare.io/go\" target=\"new\">Go</a> because it allows us to inject a multi-platform static binary into an environment where we can’t rely on lists of dependencies. Go is also used for CLI tools. Here, fast start-up and static dependency compilation outweigh our affinity for Clojure. Clojure remains our language of choice, but as we continue to pull microservices from our monolith (over a dozen at this point), we are committed to using the right set of tools for the job and we evaluate that decision for each new service.</p>\n<h3>The frontend</h3>\n<p>We are in the process of adopting <a href=\"https://stackshare.io/next-js\" target=\"new\">Next.js</a> as our React framework and using <a href=\"https://stackshare.io/react-storybook\" target=\"new\">Storybook</a> to help build our React components in isolation. This new part of our frontend is written in <a href=\"https://stackshare.io/typescript\" target=\"new\">Typescript</a>, and we use <a href=\"https://stackshare.io/emotion\" target=\"new\">Emotion</a> for CSS/styling. For delivering data, we use <a href=\"https://stackshare.io/graphql\" target=\"new\">GraphQL</a> and <a href=\"https://stackshare.io/apollo\" target=\"new\">Apollo</a>. <a href=\"https://stackshare.io/jest\" target=\"new\">Jest</a>, <a href=\"https://stackshare.io/percy\" target=\"new\">Percy</a>, and <a href=\"https://stackshare.io/cypress\" target=\"new\">Cypress</a> are used for testing.</p>\n<h3>The backend</h3>\n<h4>Two pools of machines</h4>\n<p>Our backend consists of two major pools of machines. One pool hosts the systems that run our site, manage jobs, and send notifications. These services are deployed within <a href=\"https://stackshare.io/docker\" target=\"new\">Docker</a> containers orchestrated in <a href=\"https://stackshare.io/kubernetes\" target=\"new\">Kubernetes</a>. Due to Kubernetes’ ecosystem and toolchain, it was an obvious choice for our fairly statically-defined processes: the rate of change of job types or how many we may need in our internal stack is relatively low.</p>\n<p>The other pool of machines is for running our users’ jobs. Because we cannot dynamically predict demand, what types of jobs our users need to have run, nor the resources required for each of those jobs, we found that <a href=\"https://stackshare.io/nomad\" target=\"new\">Nomad</a> excelled over Kubernetes in this area. Our users’ jobs are changing constantly. The fast, flexible, built-in scheduler that comes with Nomad distributes our users’ jobs across our second pool of machines, reserved specifically for scheduling purposes.</p>\n<p>We did evaluate both Kubernetes and Nomad to do All These Things, but neither tool was optimized for such an all-inclusive job. Additionally, we treat Nomad’s scheduling role as more a piece of our software stack than as a part of the management or ops layer. So we use Kubernetes to manage the Nomad servers.</p>\n<p>We’re also using <a href=\"https://stackshare.io/helm\" target=\"new\">Helm</a> to make it easier to deploy new services into Kubernetes. We create a chart (i.e. package) for each service. This lets us easily roll back new software and gives us an audit trail of what was installed or upgraded.</p>\n<h3>Infrastructure</h3>\n<p>Previously, we had run all of our infrastructure on <a href=\"https://stackshare.io/amazon-ec2\" target=\"new\">AWS</a>. At first, it was simple because our architecture was simple. As our architecture grew in complexity, our AWS infrastructure grew to include a complex stack of <a href=\"https://stackshare.io/amazon-vpc\" target=\"new\">VPCs</a>, Security Groups, and everything else AWS offers to help partition and restrict resources. We are also running across multiple regions. We have adopted Terraform to help us manage this complexity in a scaling team.</p>\n<p>Once we launched CircleCI Enterprise (our on-prem offering), we began to support different deployment models. During this time, we also began to package our code in Docker containers. This allowed us to start using cloud-agnostic Kubernetes to manage resources and distributions and it reduced our cloud vendor lock-in.</p>\n<p>We now push a part of our workload to <a href=\"https://stackshare.io/google-compute-engine\" target=\"new\">GCP</a>. If you use our machine executor to run a job, it will run in GCP. This executor type allocates a full VM for tasks that need it. GCP is well-suited for running small, short-lived VMs. We’ve also wrapped GCP in a VM service that preallocates machines, then tears everything down once you’re finished. Using an entire VM means you have full control over a much faster machine. We’re pretty happy with this architecture since it smooths out future forays into other platforms: we can just drop in the Go build agent and be on our merry way.</p>\n<h3>Communication with the frontend</h3>\n<p>To get the frontend to communicate with the backend, we use a dedicated tier of API hosts. We manage these API hosts with Kubernetes as well, but in a separate cluster to increase isolation. A number of our APIs are public, meaning that we use the same interfaces that are available to our users. By dogfooding our APIs, we’ve been able to keep them clean and spot and fix errors before our users discover them.</p>\n<p>When you interact with our web application, all of your requests are hitting the API hosts. We handle the majority of our authentication via OAuth from <a href=\"https://stackshare.io/github\" target=\"new\">GitHub</a> or <a href=\"https://stackshare.io/bitbucket\" target=\"new\">Bitbucket</a>. We provide programmatic access to everything exposed in the UI through an API token that you can generate once you have authenticated.</p>\n<h3>Data! Data! Data!</h3>\n<p>We use <a href=\"https://stackshare.io/mongodb\" target=\"new\">MongoDB</a> as our primary datastore. Mongo’s approach to replica sets enables some fantastic patterns for operations like maintenance, backups, and ETL. We’re happy to see progress being made in <a href=\"http://www.wiredtiger.com/\" target=\"new\">WiredTiger</a>, and our operations have greatly improved, but we’re still suffering from a legacy of our early mistakes in schema enforcement on a dataset that is too large to clean efficiently.</p>\n<p>As we pull microservices from our monolith, we are taking the opportunity to build them with their own datastores using <a href=\"https://stackshare.io/postgresql\" target=\"new\">PostgreSQL</a>. We also use <a href=\"https://stackshare.io/redis\" target=\"new\">Redis</a> to cache data we’d never store permanently, and to rate-limit our requests to partners’ APIs (like GitHub).</p>\n<p>When we’re dealing with large blobs of immutable data (logs, artifacts, and test results), we store them in <a href=\"https://stackshare.io/amazon-s3\" target=\"new\">Amazon S3</a>. We handle any side-effects of S3’s eventual consistency model within our own code. This ensures that we deal with user requests correctly while writes are in process.</p>\n<h3>A Build is born</h3>\n<p>When we process a webhook from GitHub/Bitbucket telling us that a user pushed some new code, we use the information to create a new pipeline representation with associated workflows and jobs in our datastores. We then pass the definition of the work to be performed to Nomad, which is responsible for allocating hardware to run the jobs.</p>\n<h3>Running the build</h3>\n<p>The gritty details of processing a build are executed by the creatively named <i>build agent</i>. It parses configuration, executes commands, and synthesizes actions that create artifacts and test results. Most builds run in a Docker container, or set of containers, which is defined by the user for a completely tailored build environment.</p>\n<p>The build agent streams the results of its work over <a href=\"http://www.grpc.io/\" target=\"new\">gRPC</a> to the output processor, a secure façade that understands how to write to all our internal systems. In order to get this live streaming data to your browser, we use WebSockets managed by <a href=\"https://stackshare.io/pusher\" target=\"new\">Pusher</a>. We also use this channel to deliver state change notifications to the browser, e.g. when a build completes. We also make use of Redis’s amazing performance to stash bits of output as we collate it for permanent S3 storage.</p>\n<h2>A Hubot postscript</h2>\n<p>We have added very little to the CoffeeScript <a href=\"https://stackshare.io/hubot\" target=\"new\">Hubot</a> application – just enough to allow it to talk to our Hubot workers. The hubot workers implement our operational management functionality and expose it to Hubot so we can get chat integration for free. We’ve also tailored the authentication and authorization code of Hubot to meet the needs of roles within our team.</p>\n<p>For larger tasks, we’ve got an internal CLI written in <a href=\"https://stackshare.io/go\" target=\"new\">Go</a> that talks to the same API as Hubot, giving access to the same functionality we have in Slack, with the addition of scripting, piping, and all of our favorite Unix tools. When the Hubot worker recognizes the CLI is in use, it logs the commands to Slack to maintain visibility of operational changes.</p>\n<h3>Analytics &amp; monitoring</h3>\n<p>Our primary source of monitoring and alerting is <a href=\"https://stackshare.io/datadog\" target=\"new\">Datadog</a>. We’ve got prebuilt dashboards for every scenario and integration with <a href=\"https://stackshare.io/pagerduty\" target=\"new\">PagerDuty</a> to manage routing any alerts. We’ve definitely scaled past the point where managing dashboards is easy, but we haven’t had time to invest in using features like Anomaly Detection. We’ve started using <a href=\"https://stackshare.io/honeycomb\" target=\"new\">Honeycomb</a> for some targeted debugging of complex production issues and we are liking what we’ve seen. We capture any unhandled exceptions with <a href=\"https://stackshare.io/rollbar\" target=\"new\">Rollbar</a> and, if we realize one will keep happening, we quickly convert the metrics to point back to Datadog, to keep Rollbar as clean as possible.</p>\n<p>We use <a href=\"https://stackshare.io/segment\" target=\"new\">Segment</a> to consolidate all of our trackers, the most important of which goes to <a href=\"https://stackshare.io/amplitude\" target=\"new\">Amplitude</a> to analyze user patterns. However, if we need a more consolidated view, we push all of our data to our own data warehouse running PostgreSQL; this is available for analytics and dashboard creation through <a href=\"https://stackshare.io/looker\" target=\"new\">Looker</a>.</p>\n<h2>In summary</h2>\n<p>At CircleCI, we get to practice what we preach. Instead of long dry spells between releases, we push several changes per day to keep our feedback loops short and our codebase clean. We’re small enough that we can move quickly but large enough that our teams have the resources that they need.</p>\n<p>This is our stack today. As our users demand solutions for more complex problems, we’ll adopt new tools and languages to deal with emerging tech. We are excited about the future, but while we wait for that future to unfold, there is no reason you should be waiting for good code. <a href=\"https://circleci.com/signup/\" target=\"new\">Start building on CircleCI</a> today and ship your code faster. We’re also looking for people who are interested in collaboration and learning and who want to join us in shaping the future of software engineering supporting our internal teams, as well as the thousands of organizations using our product. <a href=\"https://circleci.com/careers/\" target=\"new\">Come work with us</a> and help us ship our own code faster!</p>",
   :direction "ltr"},
  :updated 1566505800000,
  :entities
  [{:mentions [{:text "Slack"}],
    :id "nlp/f/entity/wd:58436",
    :salienceLevel "mention",
    :label "Slackware"}
   {:mentions [{:text "Kubernetes"}],
    :id "nlp/f/entity/wd:22661306",
    :salienceLevel "mention",
    :label "Kubernetes"}
   {:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "CLI"}],
    :id "nlp/f/entity/wd:189053",
    :salienceLevel "mention",
    :label "command-line interface"}
   {:mentions [{:text "Nomad"}],
    :id "nlp/f/entity/wd:648864",
    :salienceLevel "mention",
    :label "PBY Catalina"}],
  :alternate
  [{:href
    "https://circleci.com/blog/update-how-circleci-processes-over-30-million-builds-per-month/",
    :type "text/html"}],
  :title
  "Update: How CircleCI processes over 30 million builds per month",
  :author "Rob Zuber",
  :published-str "Thu Aug 22 13:30:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16cbbf622eb:35b4b83:fd909f4f",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url
   "https://circleci.com/blog/media/2019-08-19-RubeGoldberg-v1.jpg",
   :width 2502,
   :height 1407,
   :contentType "image/jpeg"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://circleci.com/blog/update-how-circleci-processes-over-30-million-builds-per-month/",
  :commonTopics
  [{:score 92.61317835872919,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.963,
    :id "nlp/f/topic/651",
    :salienceLevel "about",
    :label "devops"}
   {:score 0.959,
    :id "nlp/f/topic/774",
    :salienceLevel "about",
    :label "engineering"}
   {:score 0.888,
    :id "nlp/f/topic/1975",
    :salienceLevel "about",
    :label "running"}
   {:score 0.838,
    :id "nlp/f/topic/2010",
    :salienceLevel "mention",
    :label "scalability"}
   {:score 0.792,
    :id "nlp/f/topic/680",
    :salienceLevel "mention",
    :label "docker"}
   {:score 0.769,
    :id "nlp/f/topic/253",
    :salienceLevel "mention",
    :label "big data"}
   {:score 0.732,
    :id "nlp/f/topic/2461",
    :salienceLevel "mention",
    :label "web design"}
   {:score 0.725,
    :id "nlp/f/topic/2124",
    :salienceLevel "mention",
    :label "software"}
   {:score 0.704,
    :id "nlp/f/topic/1555",
    :salienceLevel "mention",
    :label "net"}],
  :published 1566505800000,
  :fingerprint "348ffb82",
  :canonicalUrl
  "https://stackshare.io/circleci/update-how-circleci-processes-over-30-million-builds-per-month"}
 {:engagement 8,
  :unread false,
  :crawled 1566521565931,
  :content
  {:content
   "<div><h1>Clojure Engineer</h1><div>Attendify | Kyiv, Kyiv City, Ukraine</div><div><a href=\"http://attendify.com\">http://attendify.com</a></div><br><div><p>We're looking for a strong backend engineer to join our growing Clojure Team.</p><p>Here at Attendify we're developing a platform that helps event organizers sell tickets, interact with attendees in a mobile app, receive their feedback and analyze their interests.</p><p>We run more than 40 microservices that interact with each other. Most of our codebase is Clojure. Our Clojure team owns new features development, maintains our products at all levels, and implements CI/DI best practices.</p><p>Our data processing stack includes Kafka, ElasticSearch, PostgreSQL, Amazon S3. The list of technologies we use expands fast just like the complexity of our products.</p><p>We don't require being an expert in Clojure, but our ideal candidate is curious and ready to learn it. If you are interested in functional programming, please read on...</p><p><strong>What you'll do at Attendify:</strong></p>\n<ul>\n<li>Design and build large-scale Clojure microservices</li>\n<li>Improve infrastructure and delivery practices</li>\n<li>Develop solid test coverage to deploy high-quality code</li>\n<li>Conduct code review for other team members</li>\n<li>Perform technical research for the new features development</li>\n<li>Collaborate with product and engineering teams</li>\n</ul><p><strong>What we expect from you:</strong></p>\n<ul>\n<li>3+ years of experience in web-development</li>\n<li>Interest in functional programming</li>\n<li>Hands-on experience with microservice architecture</li>\n<li>Experience with Relational Database Management System</li>\n<li>Good knowledge of the algorithms and data structures</li>\n<li>Vast experience with HTTP</li>\n</ul><p><strong>Nice to have but not required:</strong></p>\n<ul>\n<li>Functional development experience</li>\n<li>Experience with message brokers or event stores like Rabbit, Kafka, ActiveMQ</li>\n<li>Interest in DevOps practices</li>\n<li>Understanding of concurrency</li>\n<li>Hands-on experience with different databases like PostgreSQL, MS SQL, MySQL, Oracle</li>\n<li>Understanding of JVM internals</li>\n<li>Good knowledge of ElasticSearc</li>\n</ul><h2>BENEFITS</h2>\n<ul>\n<li>Unique work environment where you can be a part of creating a new and innovative product</li>\n<li>Competitive salary &amp; career growth opportunities, based on experience</li>\n<li>Friendly team of like-minded professionals</li>\n<li>Corporate library, tech talks and other opportunities to broaden your knowledge</li>\n<li>Great team atmosphere with office located in the center of Kiev</li>\n</ul><p>Ready to join an amazing team and work in an ambitious, fast-paced environment? Send us your resume and we'll be in touch.</p></div></div>",
   :direction "ltr"},
  :updated 1566504746000,
  :entities
  [{:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "about",
    :label "Clojure"}
   {:mentions [{:text "Kyiv"} {:text "Kiev"}],
    :id "nlp/f/entity/wd:1899",
    :salienceLevel "mention",
    :label "Kiev"}
   {:mentions [{:text "PostgreSQL"}],
    :id "nlp/f/entity/wd:192490",
    :salienceLevel "mention",
    :label "PostgreSQL"}
   {:mentions [{:text "functional programming"}],
    :id "nlp/f/entity/wd:193076",
    :salienceLevel "mention",
    :label "functional programming"}
   {:mentions [{:text "mobile app"}],
    :id "nlp/f/entity/wd:620615",
    :salienceLevel "mention",
    :label "mobile app"}],
  :alternate
  [{:href
    "https://jobs.braveclojure.com/jobs/17592186047046/clojure-engineer-attendify",
    :type "text/html"}],
  :title "Clojure Engineer",
  :author "Brave Clojure Jobs",
  :published-str "Thu Aug 22 13:12:26 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16cbbf622eb:35b4b82:fd909f4f",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://jobs.braveclojure.com/jobs/17592186047046/clojure-engineer-attendify",
  :commonTopics
  [{:score 79.6861025177494,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.943,
    :id "nlp/f/topic/619",
    :salienceLevel "about",
    :label "database"}
   {:score 0.821,
    :id "nlp/f/topic/52",
    :salienceLevel "mention",
    :label "agile"}
   {:score 0.816,
    :id "nlp/f/topic/651",
    :salienceLevel "mention",
    :label "devops"}
   {:score 0.701,
    :id "nlp/f/topic/1827",
    :salienceLevel "mention",
    :label "product management"}],
  :published 1566504746000,
  :fingerprint "47013b47",
  :canonicalUrl
  "https://jobs.braveclojure.com/jobs/17592186047046/clojure-engineer-attendify"}
 {:engagement 4,
  :unread false,
  :crawled 1566504167016,
  :content
  {:content
   "<p>A few years ago I came across a Leiningen project that defined profiles for <code>:project/dev</code>, <code>:profiles/dev</code>, <code>:project/test</code>, and <code>:profiles/test</code>. It took me a little bit of digging, but eventually I discovered what was happening. This is a convention that I think originated with <a href=\"https://github.com/weavejester\">James Reeves</a>. I’m reposting my <a href=\"https://github.com/weavejester/environ/issues/15#issuecomment-293144253\">issue comment</a> here, so it can be more accessible for searchers.</p>\n<p>If you see profiles like this in a <code>project.clj</code>, here is what is happening:</p>\n<pre><code>:dev  [:project/dev  :profiles/dev]\n:test [:project/test :profiles/test]\n:profiles/dev  {}\n:profiles/test {}\n:project/dev  { ... }\n:project/test { ... }\n</code></pre>\n<p>Leiningen has a feature called <a href=\"https://github.com/technomancy/leiningen/blob/master/doc/PROFILES.md#composite-profiles\">Composite Profiles</a>. On startup, if Leiningen sees a vector of keywords for a profile, it will lookup each keyword as a profile, and merge them together. For the <code>:dev</code> profile, Leiningen will merge the values of <code>:project/dev</code> and <code>:profiles/dev</code>.</p>\n<p>If you want to add any custom settings or dependencies for your own use, you can place them into the <code>:profiles/dev</code> or <code>:profiles/test</code> in your <code>~/.lein/profiles.clj</code>. If either of these are set in the user’s <code>profiles.clj</code>, they will override the empty <code>:profiles/dev</code> map specified in the <code>project.clj</code>. You need an empty map for <code>:profiles/dev {}</code> in the <code>project.clj</code>, because otherwise Leiningen will complain about a missing profile.</p>",
   :direction "ltr"},
  :updated 1566545028000,
  :entities
  [{:mentions [{:text "Leiningen"}],
    :id "nlp/f/entity/wd:205362",
    :salienceLevel "about",
    :label "Leiningen"}
   {:mentions [{:text "James Reeves"}],
    :id "nlp/f/entity/wd:6141932",
    :salienceLevel "mention",
    :label "James Reeves"}],
  :alternate
  [{:href
    "https://danielcompton.net/2019/08/23/what-do-project-dev-profiles-dev-mean-leiningen",
    :type "text/html"}],
  :title
  "What do :project/dev and :profiles/dev mean in a Leiningen project?",
  :author "Daniel Compton",
  :published-str "Fri Aug 23 00:23:48 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16cbaeca668:345046c:fd909f4f",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "http://danielcompton.net/2019/08/23/what-do-project-dev-profiles-dev-mean-leiningen",
  :commonTopics
  [{:score 61.9119781182584,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1566545028000,
  :fingerprint "c9cec80d",
  :canonicalUrl
  "https://danielcompton.net/2019/08/23/what-do-project-dev-profiles-dev-mean-leiningen"}
 {:engagement 4,
  :unread false,
  :crawled 1566470500546,
  :content
  {:content
   "<p>All the posts so far..</p>\n<ul>\n<li><a href=\"http://codeofrob.com/entries/introducing-pinto-and-stetson---opinionated-purescript-bindings-to-otp-and-cowboy.html\">Introduction to Pinto/Stetson - Opinionated Bindings to OTP/Cowboy</a></li>\n<li><a href=\"http://codeofrob.com/entries/the-structure-of-an-end-to-end-purescript-otp-project.html\">The structure of an end-to-end purescript OTP project</a></li>\n<li><a href=\"http://codeofrob.com/entries/building-on-top-of-otp-with-purescript-with-pinto.html\">Building on top of OTP with Purescript with Pinto</a></li>\n</ul>\n<p>Useful links</p>\n<ul>\n<li><a href=\"https://github.com/id3as/demo-ps\">demo-ps</a> The demo codebase we're talking about here</li>\n<li><a href=\"https://github.com/id3as/purescript-erl-pinto\">erl-pinto</a> (the opinionated bindings to OTP we're using)</li>\n<li><a href=\"https://github.com/id3as/purescript-erl-stetson\">erl-stetson</a> (the opinionated bindings to Cowboy we're using)</li>\n</ul>\n<p>Having now gotten a basic OTP application up and running, it'd be nice to get some data out to the world.</p>\n<h1>Cowboy</h1>\n<p>Cowboy is the defacto web server in the Erlang world, each route loosely maps to a module which has callbacks defined in it to handle various stages of the decisioning process.</p>\n<pre><code>\n<span>-module</span><span>(my_handler)</span>.\n\n<span>-export</span><span>([init/<span>2</span>,\nget_text/<span>2</span>,\ncontent_types_provided/<span>2</span>\n])</span>.\n\n<span><span>init</span><span>(Req, _Opts)</span> -></span>\n  { cowboy_rest, Req, #state{} }.\n\n<span><span>content_types_provided</span><span>(Req, State)</span> -></span>\n  {[{ &lt;&lt;<span>&quot;text/plain&quot;</span>>>, get_text}], Req, State}.\n\n<span><span>get_json</span><span>(Req, State)</span> -></span>\n  { &lt;&lt;<span>&quot;Hello World&quot;</span>>>, Req, State }.\n</code></pre>\n<p>This is directly representable in Purescript, using <a href=\"https://github.com/purerl/purescript-erl-cowboy\">erl-cowboy</a>.</p>\n<pre><code><span>module</span> MyHandler <span>where</span>\n\n<span>init</span> :: <span>forall</span> a. <span>InitHandler</span> a a\n<span>init</span> = mkEffectFn2 \\req c -> pure (initResult c req)\n\n<span>content_types_provided</span> :: <span>forall</span> s. <span>ContentTypesProvidedHandler</span> s\n<span>content_types_provided</span> =  mkEffectFn2 \\req s -> pure $\n  restResult\n    (contentTypesProvidedResult $ fromFoldable\n      [ tuple2 (<span>ContentType</span> <span>&quot;text&quot;</span> <span>&quot;plain&quot;</span> <span>AnyParams</span>) (<span>ProvideCallback</span> $ atom <span>&quot;asText&quot;</span>) ]\n    )\n    s req\n\n\n<span>asText</span> :: <span>forall</span> s. <span>EffectFn2</span> <span>Req</span> s (<span>Tuple3</span> <span>String</span> <span>Req</span> s)\n<span>asText</span> = mkEffectFn2 \\req s -> pure $ tuple3 <span>&quot;Hello World&quot;</span> req s\n</code></pre>\n<p>However, this doesn't make the best use of Purescript itself - and writing out a few dozen handlers like this would soon get a bit tedious, which is why I went away and wrote <a href=\"https://github.com/id3as/purescript-erl-stetson\">Stetson</a>. Purescript is a functional programming language and it makes sense that rather than provide a bunch of loosely typed callbacks referred to by name using strings, that we built an API that took functions to do all the heavy lifting.</p>\n<pre><code>\n<span>helloWorld</span> :: <span>StetsonHandler</span> <span>Unit</span>\n<span>helloWorld</span> =\n  <span>Rest</span>.handler (\\req -> <span>Rest</span>.initResult req unit)\n    # <span>Rest</span>.contentTypesProvided (\\req state -> <span>Rest</span>.result (tuple2 <span>&quot;text/html&quot;</span> asText) req state)\n    # <span>Rest</span>.yeeha\n    <span>where</span> \n      asText req state = <span>do</span>\n        <span>Rest</span>.result <span>&quot;Hello World&quot;</span> req state)\n</code></pre>\n<p>The idea of course being that we can configure Stetson/Cowboy at the top level by providing a pile of functions and abstract over the common bits like &quot;This is an accept handler that turns state into JSON because State has the typeclass &quot;WriteForeign&quot;, and start to get rid of a lot of duplication across our routes.</p>\n<pre><code>\n<span>init</span> :: <span>BookWebStartArgs</span> -> <span>Effect</span> <span>State</span>\n<span>init</span> args = <span>do</span>\n  <span>Stetson</span>.configure\n    # <span>Stetson</span>.route <span>&quot;/api/books&quot;</span> books\n    # <span>Stetson</span>.route <span>&quot;/api/books/:isbn&quot;</span> book\n    # <span>Stetson</span>.static <span>&quot;/assets/[...]&quot;</span> (<span>PrivDir</span> <span>&quot;demo_ps&quot;</span> <span>&quot;www/assets&quot;</span>)\n    # <span>Stetson</span>.static <span>&quot;/[...]&quot;</span> (<span>PrivFile</span> <span>&quot;demo_ps&quot;</span> <span>&quot;www/index.html&quot;</span>)\n    # <span>Stetson</span>.port args.webPort\n    # <span>Stetson</span>.bindTo <span>0</span> <span>0</span> <span>0</span> <span>0</span>\n    # <span>Stetson</span>.startClear <span>&quot;http_listener&quot;</span>\n  pure $ <span>State</span> {}\n</code></pre>\n<p>where books and book are handlers as described above. In our own applications, we have ended up with pretty much the entire web server and all routes in a single file - which is in stark contrast to our usual Erlang apps where we have a folder containing dozens of separate erlang modules.</p>\n<pre><code><span>books</span> :: <span>StetsonHandler</span> (<span>List</span> <span>Book</span>)\n<span>books</span> =\n  <span>Rest</span>.handler (\\req -> <span>do</span>\n                        state &lt;- <span>BookLibrary</span>.findAll\n                        <span>Rest</span>.initResult req state)\n    # <span>Rest</span>.allowedMethods (\\req state -> <span>Rest</span>.result (<span>Stetson</span>.<span>POST</span> :  <span>Stetson</span>.<span>HEAD</span> : <span>Stetson</span>.<span>GET</span> : <span>Stetson</span>.<span>OPTIONS</span> : nil) req state)\n    # <span>Rest</span>.contentTypesProvided (\\req state -> <span>Rest</span>.result (jsonWriter : nil) req state)\n    # <span>Rest</span>.contentTypesAccepted (\\req state -> <span>Rest</span>.result ((tuple2 <span>&quot;application/json&quot;</span> acceptJson) : nil)\n                                req state)\n    # <span>Rest</span>.yeeha\n    <span>where</span> \n          acceptJson req state = <span>do</span>\n            body &lt;- allBody req mempty\n            result &lt;- either (pure &lt;&lt;&lt; <span>Left</span> &lt;&lt;&lt; show) <span>BookLibrary</span>.create $ readJSON $ unsafeCoerce body\n            <span>case</span> result <span>of</span>\n                 <span>Left</span> err -> <span>Rest</span>.result false (setBody err req) state\n                 <span>Right</span> c -> <span>Rest</span>.result true req state\n\n<span>jsonWriter</span> :: <span>forall</span> a. <span>WriteForeign</span> a => <span>Tuple2</span> <span>String</span> (<span>Req</span> -> a -> (<span>Effect</span> (<span>RestResult</span> <span>String</span> a)))\n<span>jsonWriter</span> = tuple2 <span>&quot;application/json&quot;</span> (\\req state -> <span>Rest</span>.result (writeJSON state) req state)\n</code></pre>\n<p>So that's a handler that has a state of type <em>'List Book'</em>, which it gets from our <em>BookLibrary</em> via a call (as in the previous blog entry), jsonWriter being a function as decscribed above - simply taking that model and spitting it out as JSON, leveraging our model which happens to implement that type class.</p>\n<p>We'll look more into that in the next entry, where we talk about that model and how we're using it on both client and server.</p>",
   :direction "ltr"},
  :updated 1566466200000,
  :entities
  [{:mentions [{:text "web server"}],
    :id "nlp/f/entity/wd:11288",
    :salienceLevel "about",
    :label "web server"}
   {:mentions [{:text "Stetson"}],
    :id "nlp/f/entity/wd:2092839",
    :salienceLevel "mention",
    :label "Stetson"}
   {:mentions [{:text "Erlang"}],
    :id "nlp/f/entity/wd:334879",
    :salienceLevel "mention",
    :label "Erlang"}
   {:mentions [{:text "JSON"}],
    :id "nlp/f/entity/wd:2063",
    :salienceLevel "mention",
    :label "JavaScript Object Notation"}
   {:mentions [{:text "API"}],
    :id "nlp/f/entity/wd:165194",
    :salienceLevel "mention",
    :label "application programming interface"}],
  :alternate
  [{:href
    "http://codeofrob.com/entries/building-a-purescript-web-server-with-stetson-and-pinto.html",
    :type "text/html"}],
  :title "Building a Purescript web server with Stetson and Pinto",
  :author "Rob Ashton",
  :published-str "Thu Aug 22 02:30:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16cb8eaf0c2:330706a:49b12733",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "http://codeofrob.com/entries/building-a-purescript-web-server-with-stetson-and-pinto.html",
  :commonTopics
  [{:score 46.427603700491,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.978,
    :id "nlp/f/topic/2322",
    :salienceLevel "about",
    :label "trail running"}
   {:score 0.846,
    :id "nlp/f/topic/630",
    :salienceLevel "mention",
    :label "deep learning"}
   {:score 0.723,
    :id "nlp/f/topic/91",
    :salienceLevel "mention",
    :label "anarchism"}],
  :published 1566466200000,
  :fingerprint "2d452b9d",
  :canonicalUrl
  "http://codeofrob.com/entries/building-a-purescript-web-server-with-stetson-and-pinto.html"}
 {:engagement 8,
  :unread false,
  :crawled 1566440644302,
  :recrawled 1566521565931,
  :content
  {:content
   "<p>My new book, Grokking Simplicity, all about functional programming, is now available in early access. The first three chapters are ready to read. Go to <a href=\"https://lispcast.com/gs\">https://lispcast.com/gs</a>, add the book to the cart, and use discount code MLNORMAND for 50% off.</p>\n<p></p>\n<h2>Transcript</h2>\n<p>Eric Normand: Hello. My book is launched. You can get the book by going to lispcast.com/gs. There’s a 50 percent discount when you check out. Just add the discount code MLNORMAND, M-L-N-O-R-M-A-N-D. I wanted to get that message out of the way before I explain more.</p>\n<p>I started this podcast back in the beginning of 2018, I can’t remember. Was it February, March? It was to practice to explore the ideas of functional programming that I wanted to turn into a book. I’ve been publishing two per week. Since then, I’ve missed a couple of those scheduled spots. In general, I’ve been publishing two of these episodes every week.</p>\n<p>My audience, that’s you, you’ve been a huge help in really exploring these ideas. I get emails, I get tweets, I even get LinkedIn messages asking about the concepts, asking for clarification, going deeper, really great questions. All of these have really helped, come up with better ways of explaining. Of realizing that it can go deeper and putting that into the book.</p>\n<p>I signed the book contract in June. After I started my — there’s a little history — podcast, I was contacted by Manning. They wanted to do a book. They, I guess, saw that I was talking about writing a book.</p>\n<p>I hadn’t done much yet, I just put together some ideas, and some notes and things. I had been doing the podcast. They wanted to do a book with me. We talked it over. After a few meetings, they sent me a contract. I signed the contract and I got started.</p>\n<p>That was over a year ago. I went through many drafts, many revisions of the first chapters. Then I have meetings every week with my editor, to try to get the material to something learnable. Something important, something profound.</p>\n<p>It wasn’t until January, that I finally figured out a format that will work. It’s not just text, that’s how I started out was just typing text. There were so many ideas, they would all come out at once in my text. I actually had 60, 75 pages of text that went out for review. Is the first three chapters, it went out for review in November.</p>\n<p>I didn’t like it, my editor and like, it is getting mixed reviews. Then there with this new format, it just clicked. Like, “I get what I need to do now, understand the format.” Let me talk about the format. It’s a much more visual book. I was trying to do something visual, but I just wasn’t hitting it. It was too much text.</p>\n<p>Now it is super visual. Things are explained really well using real-world scenarios. We go right into solving real problems using functional concepts. Who this book is for? It’s for people who know functional programming, who want to recommend a book to someone who doesn’t know anything, in functional programming.</p>\n<p>So many people are like they’re known amongst their friends, the one who’s into functional programming. If you’re into functional programming, you probably are past the first half of the book at least. You probably don’t need the book, right, or you get bored in the first half. Then when you want to point someone to a book to get them started.</p>\n<p>There’s nothing there while now there is, it’s called “Grokking Simplicity.”</p>\n<p>It is all about applying functional programming in the real world. It starts with actions, calculations and data. I don’t want to go into everything, I’ve talked about in the year and a half since I started this podcast. You can binge it if you want. Actions, calculations and data are the entry way into functional programming.</p>\n<p>The next entryway is higher order functions. Then the next entryway is algebraic thinking. It’s available in MEAP right now. MEAP is M-E-A-P, Manning Early Access Program. The way that works is, you can buy an eBook version today and you will get updates as they come out.</p>\n<p>The schedule I have with my project manager, is a chapter a month. You can get what’s available now, it just released and in a month, you’ll get the next chapter. There are three chapters in the MEAP right now. Today is August 21st 2019. Just to give some context, if you’re listening a little later.</p>\n<p>There are two formats you can buy on manning.com. It’s only available on manning.com right now. When it’s published, it’ll be everywhere. Right now, it’s manning.com. There’s two formats. One is the eBook only and that has PDF…Right now it just has PDF. Eventually it’ll have Kindle and ePub and all the others and an HTML version you can read on the Web.</p>\n<p>Then there’s the eBookPLUS what they call pBook, which is a clever way of saying print book. You will get all the eBook formats and when it finally publishes, you get a print one in the mail. It’s only a little bit more expensive to buy the print book. If you like print books, I recommend doing that.</p>\n<p>You still get the ebook updates as they come out. Then one day, you will also get the pBook in the mail when it’s finally done. The schedule for the book, they’re estimating early 2019. I think, April, let me double check that. I have not been thinking of it. No, spring 2020 is what they said. I said 2019. But I said 2020.</p>\n<p>There’s no guarantee, it’s just an estimate. There’s three chapters now, podcast only exclusive. There are three other chapters that are in the can. Those are waiting to go out, so I have a little buffer, in case I’m late one month with a chapter.</p>\n<p>There’s already six written and there’s two more that are really close. I’m just chugging away on them right now. Just stay tuned on the podcast. I’ll keep you up to date on the news. I’ll probably give another one of these nonfunctional programming, but more book-oriented updates when the next chapter becomes available.</p>\n<p>LIspcast.com/gs is the short link. It’ll take you right to the Manning page. You’ll be able to buy it. The discount code 50 percent off. The discount code is MLNORMAND, like my last name, and it will expire on August 31st 2019 so use it now.</p>\n<p>If you’re listening in your podcast player. Pull over if you’re in the car, or pop open a browser tab and go there now and buy it because this 50 percent discount won’t last. I don’t get to issue new discount codes. This is the marketing team at Manning gave me this one. I don’t know when the next discount will be, so act now.</p>\n<p>Thank you so much. I’ve been obsessing about the stats and watching. Watching sales come in. It’s very exciting. I just need to get back to work on the book and get more chapters done. Awesome. Thank you and rock on.</p>\n<p>The post <a rel=\"nofollow\" href=\"https://lispcast.com/grokking-simplicity-launch/\">Grokking Simplicity Launch</a> appeared first on <a rel=\"nofollow\" href=\"https://lispcast.com\">LispCast</a>.</p>",
   :direction "ltr"},
  :updated 1566432000000,
  :entities
  [{:mentions [{:text "functional programming"}],
    :id "nlp/f/entity/wd:193076",
    :salienceLevel "about",
    :label "functional programming"}
   {:mentions [{:text "ebook"}],
    :id "nlp/f/entity/wd:128093",
    :salienceLevel "mention",
    :label "e-book"}
   {:mentions [{:text "HTML"}],
    :id "nlp/f/entity/wd:8811",
    :salienceLevel "mention",
    :label "HyperText Markup Language"}
   {:mentions [{:text "LinkedIn"}],
    :id "nlp/f/entity/wd:213660",
    :salienceLevel "mention",
    :label "LinkedIn"}
   {:mentions [{:text "Kindle"}],
    :id "nlp/f/entity/wd:136469",
    :salienceLevel "mention",
    :label "Amazon Kindle"}],
  :alternate
  [{:href "https://lispcast.com/grokking-simplicity-launch/",
    :type "text/html"}],
  :title "Grokking Simplicity Launch",
  :author "Eric Normand",
  :published-str "Wed Aug 21 17:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16cb7235ece:2f3e52e:fd909f4f",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url
   "https://lispcast.com/wp-content/uploads/2018/07/ERIC-NORMAND-LISPCAST.COM_.jpg",
   :width 513,
   :height 557,
   :contentType "image/jpeg"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://lispcast.com/?p=1994",
  :updateCount 1,
  :commonTopics
  [{:score 27.40640876452825,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.925,
    :id "nlp/f/topic/301",
    :salienceLevel "about",
    :label "bookbinding"}
   {:score 0.901,
    :id "nlp/f/topic/721",
    :salienceLevel "about",
    :label "ebooks"}
   {:score 0.871,
    :id "nlp/f/topic/2140",
    :salienceLevel "about",
    :label "space"}
   {:score 0.771,
    :id "nlp/f/topic/2514",
    :salienceLevel "mention",
    :label "writing"}
   {:score 0.767,
    :id "nlp/f/topic/1852",
    :salienceLevel "mention",
    :label "publishing"}
   {:score 0.704,
    :id "nlp/f/topic/1960",
    :salienceLevel "mention",
    :label "romance"}],
  :published 1566432000000,
  :fingerprint "5d223dd7",
  :canonicalUrl "https://lispcast.com/grokking-simplicity-launch/"}
 {:engagement 9,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/todo",
    :label "todo"}
   {:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1566435011384,
  :content
  {:content
   "<p>Monads are real, y’all. They are all around us. In this metaphor-free episode, I’ll share two real-world monads you interact with all the time. No burritos or space suits, I promise! Plus, we’ll see why monads are useful in Haskell.</p>\n<p></p>\n<h2>Transcript</h2>\n<p>Eric Normand: Today, we’re looking at monads in the real world. By the end of this episode, we will have a pretty good idea of what they are based on real, concrete, actual, real world stuff. I hope we can see a little bit of how they’re defined mathematically.</p>\n<p>I just want to also say that this is going to be a completely metaphor-free monad explanation. These are not metaphors. I am trying to look for monads in the real world.</p>\n<p>We can talk about other categories and how we see them in the real world, for instance, monoids. Lots of monoids in the real world, so when you have a toy train set, you can detach them and then reattach them, and they maintain the order when you reattach them, so it’s a monoid. It’s an associative. It has an identity.</p>\n<p>There’s a whole episode on that. If you want to learn about monoids, which are cooler than monads, by the way, go check out the monoid episode. This one’s all about monads though. Metaphor-free, the real monads that you have dealt with before.</p>\n<p>Before I get to the real-world things, I want to briefly talk about what a monad is in the abstract. We’ll touch on these and explain this through real-world examples.</p>\n<p>Monads are mathematical objects. They’re values that have a couple of properties. One is that they’re functors. I have a whole episode on functors. Basically, it means you can map over them.</p>\n<p>Some people think of functors as containers, but don’t do that, that’s a metaphor. I’m not doing that in this one. A functor is something that you can map over, so a list, obviously, an array, you can map over an array.</p>\n<p>You can map over a maybe, meaning you apply the function if it has a value. If it doesn’t have the value, if it’s nothing or none, then you don’t apply that function.</p>\n<p>Now, the second thing, so all monads are functors. Let’s just get that out of our way. There’s a whole episode on functors, you should watch that.</p>\n<p>In addition to being a functor, a monad has a join operation, and that’s the one we are going to go deeply into in a couple of real-world examples. So why are monads important? I’m going to try to explain this with an example you might be familiar with.</p>\n<p>Let’s say I was giving a gift to my friend, and I told my friend, his name is Bill. “Bill, I’m giving you a box of chocolates, happy birthday.” He takes the box, you know, kind of a sizable box, and he thinks, “Wow thank you.”</p>\n<p>He goes home, and at home, he opens the box, and inside are lots of little boxes, boxes that fit inside the bigger box. He opens those boxes up, and inside of those boxes are the chocolates. Now, is he going to call me and say, “Hey Eric, you said it was a box of chocolates, but it was actually a box of boxes of chocolates.”</p>\n<p>No, he is not going to do that, he’s going to eat the chocolates and just be happy. A type checker would balk at you. It would say, “Wohoho, you said a box of chocolates, but there is an extra nesting of boxes in there, that you forgot to mention.”</p>\n<p>What do you do when you have this type error? It is a type error. I was not very specific. I was not as pedantic as a type checker needs to be. I’m admitting that. I was acting [laughs] as a birthday gift, this was like very human level.</p>\n<p>That’s what this join operation does. It allows you to go from box of boxes of chocolates, to box of chocolates. Removes one level of nesting in a structured way that makes sense for that monad. That’s all it is. It just removes that one level of nesting. In Scala and probably other languages I am not familiar with, functor is called mappable because it has the map method on it.</p>\n<p>Monad, it also has the map. Remember, all monads are functors, but it has flat mappable. That flat is like you’re flattening one level of nesting. That’s called join. Let’s look at another example. Let’s have a to-do list.</p>\n<p>You know it’s like household chores and stuff, but then I get to one thing that is actually a big enough task that it has five subtasks. I want to make sure to get all of it done.</p>\n<p>As I’m going through, I just go through one, two, three, four and then when I get to five, I have to do 5.1, 5.2, 5.3 etc. I’m still doing them in order. It’s just they’re nested in one list more.</p>\n<p>I can do a join operation to flatten it into a single list, which is what I’m doing in my mind. As I read it, I flatten it. I read them sequentially from top to bottom. I ignore the nesting.</p>\n<p>This join operation lets us do the nesting in the structure of our data, but then undo it when we want it to be flat. That’s what join is all about. This to-do list example gives a clue about why something like Haskell uses monads for sequencing I/O operations.</p>\n<p>Sometimes, an I/O operation actually has several steps in it. What it needs to do is flatten them all out into just like a long string of things to do. It doesn’t want to have to go nesting there and become like a stack, as a tree, because it would turn into a tree, it can flatten it all out and just run straight down.</p>\n<p>That’s one part of the monad that Haskell uses. I hope that by showing this as a real-world example that you see that these aren’t that hard to understand. Now, when you take them out of the real world and into a very abstract expression, there’s not much to them because every monad is different really.</p>\n<p>Every monad has a different structure and different way of joining different semantics for how they join. There’s not that much in common, except that it’s a functor.</p>\n<p>It has a join operation. There’s a few monad laws because it has to be associative and it has to have an identity. Those usually are pretty straightforward. Now, in Haskell and in Scala with flat map, remember I talked about flat map, the equivalent in Haskell is called “bind.”</p>\n<p>What bind does is it’s really joining the map from the functor joining. It’s composing the map with a join. It’s sometimes more convenient to use bind than to use the map and join. It’s more convenient to use flat map than the map and flatten.</p>\n<p>That’s why we see bind together defined as one of the two operations of monad, but really, I think that the join is easier to work with from real-world stuff. The map already comes from it being a functor, so you don’t have to define two different operations. I want to go over Maybe, which is a type in Haskell. It has equivalents in other languages.</p>\n<p>It’s called Option in Scala, but it’s really got the same semantics. Maybe as a type that has two possible cases two constructors. One is when you have a value and one is when you don’t.</p>\n<p>It’s used for representing optional values. I either have the value or I don’t. This has the two cases. In a lot of languages, you might use a value or null to represent I don’t have it. In Haskell, there’s a type that represents this.</p>\n<p>That helps you, if you don’t have a Maybe, you know you will not get null. There’s only certain cases that you have to specifically call out. I may or may not have an answer on this function.</p>\n<p>In that case, the two cases are called just and nothing. Just is when you have the value. You might say, “I have just five. It’s just five.” There’s no other meaning behind it besides I have it and the nothing is when you don’t have the answer.</p>\n<p>How does join work on a Maybe because Maybe is a monad? First, let’s do the functor. How does map work on a monad?</p>\n<p>Let’s say I want to have five and I want to map increment over that just five. We have to cover the two cases, let’s do that just case first. I want to map increment over this value and it’s a just. It’s just five.</p>\n<p>What it’s going to do, because it’s a just, it’s going to return five plus one in a new just. It’s going to make a new Maybe with a just constructor. That’s got the answer to reaching into the Maybe, grabbing the value, calling the function on it, get an answer, put it back in the type.</p>\n<p>It’s a just with six. If it has a nothing, that’s easy, there’s nothing to call the function on so you just return a nothing again. Those are the two cases. You’ve covered it all. That’s what map does over Maybe.</p>\n<p>Now, what about join? In join, we have to deal with the nesting. I’ll handle the easiest case first. This is the type, signature would be Maybe/Maybe Int. Nested inside the Maybe is a Maybe Int.</p>\n<p>The easiest form of this type, the easiest value of this type, is if the outer maybe is a nothing. There’s actually several cases that we have to deal with now because we have the nesting. The outer Maybe is a nothing, so that’s easy.</p>\n<p>I just return nothing. That’s what the join us. Now, the other cases if the outer one is a just and the inner one is a nothing, we have to get rid of the nesting. I don’t have a value. That’s also nothing.</p>\n<p>We have two cases that result in nothing, but if I have a just, just five, then when I join that, it becomes just five. It gets rid of one of the layers of Maybe on it. Those are the three possible cases.</p>\n<p>If the outer one is nothing, it returns nothing. If the inner one is nothing, it returns nothing. Otherwise, it just collapses it into a single just instead of two justs. That’s it. That’s monad.</p>\n<p>They’re used a lot in Haskell because of this property of being able to unnest stuff in a way that you can expect and reason about. If I have a calculation that returns a Maybe and then I want to do something to the thing inside of it, but sometimes it’s nothing, I don’t have to think about that.</p>\n<p>I don’t have to put an if statement that says, if it’s nothing then do this, but if it’s something, do this. I don’t have to write that anymore. It’s that conditional that those two cases are handled automatically by the join.</p>\n<p>That is why they use it in Haskell because it makes it easy to write the nice case where everything is returning values and the case where something returns a nothing happens automatically for you. That’s why they do that.</p>\n<p>This has been a deeper episode than I thought it would be. We’ve got into what a monad is mathematically. It’s a functor with a join operation. We went over two real-world examples, “A box of boxes of chocolates,” and also a to-do list where there’s like nested lists in there.</p>\n<p>We also saw how Maybe works in Haskell, and why it’s used in Haskell, what it’s useful for. Awesome. I hope this helped. If it did, you might want to see other episodes.</p>\n<p>You can go to lispcast.com/podcast, and see all the old episodes. Each one includes audio, video, and text. You can also find links to subscribe wherever you want to subscribe and social media so you can get in touch with me and complain that I’ve created yet another monad tutorial.</p>\n<p>This has been my thought on functional programming. My name is Eric Normand. Thank you for being there. Rock on.</p>\n<p>The post <a rel=\"nofollow\" href=\"https://lispcast.com/monads-in-the-real-world/\">Monads in the real world</a> appeared first on <a rel=\"nofollow\" href=\"https://lispcast.com\">LispCast</a>.</p>",
   :direction "ltr"},
  :updated 1566432000000,
  :entities
  [{:mentions [{:text "Haskell"}],
    :id "nlp/f/entity/wd:34010",
    :salienceLevel "mention",
    :label "Haskell"}
   {:mentions [{:text "Maybe"}],
    :id "nlp/f/entity/wd:15936362",
    :salienceLevel "mention",
    :label "Maybe"}
   {:mentions [{:text "functors"}],
    :id "nlp/f/entity/wd:2120608",
    :salienceLevel "mention",
    :label "function word"}
   {:mentions [{:text "I/O"}],
    :id "nlp/f/entity/wd:219320",
    :salienceLevel "mention",
    :label "input/output"}
   {:mentions [{:text "semantics"}],
    :id "nlp/f/entity/wd:39645",
    :salienceLevel "mention",
    :label "semantics"}],
  :alternate
  [{:href "https://lispcast.com/monads-in-the-real-world/",
    :type "text/html"}],
  :title "Monads in the real world",
  :author "Eric Normand",
  :published-str "Wed Aug 21 17:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16cb6cd6b38:2ede66a:fd909f4f",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url
   "https://lispcast.com/wp-content/uploads/2019/08/Monads-in-the-real-world.jpg",
   :width 1280,
   :height 720,
   :contentType "image/jpeg"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://lispcast.com/?p=1985",
  :commonTopics
  [{:score 39.86058149840982,
    :id "nlp/f/topic/3009",
    :salienceLevel "about",
    :label "music"}],
  :published 1566432000000,
  :fingerprint "7a474bfe",
  :canonicalUrl "https://lispcast.com/monads-in-the-real-world/"}
 {:engagement 6,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1566295544044,
  :content
  {:content
   "<p>All the posts so far..</p>\n<ul>\n<li><a href=\"http://codeofrob.com/entries/introducing-pinto-and-stetson---opinionated-purescript-bindings-to-otp-and-cowboy.html\">Introduction to Pinto/Stetson - Opinionated Bindings to OTP/Cowboy</a></li>\n<li><a href=\"http://codeofrob.com/entries/the-structure-of-an-end-to-end-purescript-otp-project.html\">The structure of an end-to-end purescript OTP project</a></li>\n</ul>\n<p>Useful links</p>\n<ul>\n<li><a href=\"https://github.com/id3as/demo-ps\">demo-ps</a> The demo codebase we're talking about here</li>\n<li><a href=\"https://github.com/id3as/purescript-erl-pinto\">erl-pinto</a> (the opinionated bindings to OTP we're using)</li>\n<li><a href=\"https://github.com/id3as/purescript-erl-stetson\">erl-stetson</a> (the opinionated bindings to Cowbou we're using)</li>\n</ul>\n<p>We left the last post demonstrating that an end-to-end Purescript project was essentially a pile of Purescript written in the right place, in order that the usual Erlang application/rebar3/etc can just work with it.</p>\n<h1>That entry point again then</h1>\n<p>We looked at <em>BookApp.purs</em>, which compiled into an Erlang module called <em>bookApp@ps</em>. which ends up in <em>src/compiled_ps</em> and gets picked up with the usual Erlang structure. Let's look at that file and see what we see:</p>\n<pre><code><span>module</span> BookApp <span>where</span>\n\n<span>import</span> Prelude\n<span>import</span> BookSup <span>as</span> BookSup\n\n<span>import</span> Pinto.App <span>as</span> App\n\n<span>start</span> = <span>App</span>.simpleStart <span>BookSup</span>.startLink</code></pre>\n<p>That <em>simpleStart</em> function is just a Pinto helper that describes an entry point that doesn't worry about inputs, and provided a Supervisor will start that Supervisor when the application is started.</p>\n<p>This gets compiled into the following Erlang</p>\n<pre><code><span>% Generated by purs version 0.12.3</span>\n<span>-module</span><span>(bookApp@ps)</span>.\n<span>-export</span><span>([start/<span>0</span>, start/<span>2</span>])</span>.\n<span>-compile</span><span>(nowarn_shadow_vars)</span>.\n<span>-compile</span><span>(nowarn_unused_vars)</span>.\n<span>-compile</span><span>(no_auto_import)</span>.\n<span>-file</span><span>(<span>&quot;src/BookApp.purs&quot;</span>, <span>8</span>)</span>.\n<span><span>start</span><span>()</span> -></span> (pinto_app@ps:simpleStart((bookSup@ps:startLink()))).\n<span>-file</span><span>(<span>&quot;src/BookApp.purs&quot;</span>, <span>8</span>)</span>.\n<span><span>start</span><span>(_@<span>0</span>,_@<span>1</span>)</span> -></span> ((pinto_app@ps:simpleStart((bookSup@ps:startLink())))(_@<span>0</span>, _@<span>1</span>)).</code></pre>\n<p>If get rid of the cruft, that's essentially just</p>\n<pre><code><span>-module</span><span>(bookApp@ps)</span>.\n<span>-export</span><span>([start/<span>0</span>, start/<span>2</span>])</span>.\n<span><span>start</span><span>()</span> -></span> (pinto_app@ps:simpleStart((bookSup@ps:startLink()))).\n<span><span>start</span><span>(_@<span>0</span>,_@<span>1</span>)</span> -></span> ((pinto_app@ps:simpleStart((bookSup@ps:startLink())))(_@<span>0</span>, _@<span>1</span>)).</code></pre>\n<p>This is just a standard application module that you'd find in an Erlang application, exporting the usual start function that calls into a supervisor to start it. This is the only time I'll be loading up the compiled Purescript as it's the simplest example - but nearly all of the Pinto helpers are about making sure we can end up exposing a module that looks like the equivalent OTP erlang module.</p>\n<p>The supervisor? More of the same</p>\n<pre><code><span>module</span> BookSup <span>where</span>\n\n<span>-- [[ imports redacted ]]</span>\n\n<span>startLink</span> :: <span>Effect</span> <span>Pinto</span>.<span>StartLinkResult</span>\n<span>startLink</span> = <span>Sup</span>.startLink <span>&quot;book_sup&quot;</span> init\n\n<span>init</span> :: <span>Effect</span> <span>SupervisorSpec</span>\n<span>init</span> = <span>do</span>\n  connectionString &lt;- <span>BookConfig</span>.connectionString\n  webPort &lt;- <span>BookConfig</span>.webPort\n  pure $ buildSupervisor\n                # supervisorStrategy <span>OneForOne</span>\n                # supervisorChildren ( ( buildChild\n                                       # childType <span>Worker</span>\n                                       # childId <span>&quot;book_web&quot;</span>\n                                       # childStart <span>BookWeb</span>.startLink  { webPort } )\n                                       : \n                                       ( buildChild\n                                       # childType <span>Worker</span>\n                                       # childId <span>&quot;book_library&quot;</span>\n                                       # childStart <span>BookLibrary</span>.startLink { connectionString } )\n                                        : nil)</code></pre>\n<p><em>Sup.startLink</em> is a Pinto helper that'll end up calling our usual <em>supervisor:start_link</em> under the hood, with our <em>init</em> function being invoked within the context of that created supervisor and returning a supervisor spec when invoked. </p>\n<p>The supervisor spec structure is quite a complicated tangle of maps in Erlang, and while possible to directly represent these in Purescript with records, there are convenience builders/etc provided by Pinto to describe these specs in a more Purescripty and type safe manner - all of these values are pretty much relatable right back to the OTP documentation which is handy and intentional.</p>\n<p>Now, let's break down one of these gen servers to see what we can see - we'll have to do this piece-meal as there is a lot to uncover. We'll be looking at <em>BookLibrary.purs</em>, invoked above in the second child of the supervision tree with BookLibrary.startLink and the code for which is shown below..</p>\n<pre><code>\n<span>serverName</span> :: <span>ServerName</span> <span>State</span>\n<span>serverName</span> = <span>ServerName</span> <span>&quot;book_library&quot;</span>\n\n<span><span>type</span> <span>BookLibraryStartArgs</span> = {\n<span>connectionString</span> :: <span>ConnectionString</span>\n}</span>\n\n<span>startLink</span> :: <span>BookLibraryStartArgs</span> -> <span>Effect</span> <span>StartLinkResult</span>\n<span>startLink</span> args =\n  <span>Gen</span>.startLink serverName $ init args\n</code></pre>\n<p>So there is nothing too special about this, we're exporting a function called startLink that takes some configuration from the supervisor, and that calls into the Pinto function <em>Gen.startLink</em> with the serverName, and an init function to invoke within the context of the started GenServer along with those args. This isn't disimilar to how this looks in the Erlang world so far. </p>\n<p>That serverName construct represents both the unique identifier for this started process, and also encapsulates the type of the 'state' that is held by the GenServer, and will be used in all interactions with the <em>Gen</em> module.</p>\n<p>That init function?</p>\n<pre><code>\n<span>init</span> :: <span>BookLibraryStartArgs</span> -> <span>Effect</span> <span>State</span>\n<span>init</span> args = <span>do</span>\n  connection &lt;- <span>Redis</span>.open args.connectionString\n  pure $ { connection }\n</code></pre>\n<p>Takes place inside the context of the newly started GenServer, and is responsible for effectfully creating the initial state of the GenServer, which is just a Redis connection (We'll talk about that later). This is actually all we need to create a running GenServer as everything else is entirely optonal.</p>\n<p>Obviously that's useless, so let's look at how we can externally call into this GenServer to do something useful</p>\n<pre><code>\n<span>findAll</span> :: <span>Effect</span> (<span>List</span> <span>Book</span>)\n<span>findAll</span> = \n  <span>Gen</span>.doCall serverName \\state@{ connection } -> <span>do</span>\n    books &lt;- <span>Redis</span>.findAll dbPrefix connection\n    pure $ <span>CallReply</span> books state\n</code></pre>\n<p>We can export a plain ol' Purescript function called findAll that returns a plain ol' Effect producing a List of Book, and we can do the rest of the work by invoking a 'call' with the <em>Gen</em> module, by giving <em>Gen.doCall</em> our <em>serverName</em> construct, we are able to then provide a typed callback that will be invoked within the context of the gen-server as part of a <em>handle_call</em>, and therefore gain access to the state and return some books by calling into the Redis connection.</p>\n<p>The original Erlang would of course look a little like this.</p>\n<pre><code>\n<span>-export</span><span>([start_link/<span>1</span>, init/<span>1</span>,\nfind_all/<span>0</span>])</span>.\n\n<span>-record</span><span>(args, {\nconnection_string :: connection_string()\n})</span>.\n\n<span>-record</span><span>(state, {\nconnection :: redis:connection()\n})</span>.\n\n<span><span>find_all</span><span>()</span> -></span>\n  gen_server:call({via, gproc, {n, l, ?MODULE}}, find_all).\n\n<span><span>start_link</span><span>(Args)</span> -></span>\n  gen_server:start_link({via, gproc, {n, l, ?MODULE}}, ?MODULE, [Args], []).\n\n<span><span>init</span><span>([#args { connection_string = ConnectionString }])</span> -></span>\n  { ok, Connection } = redis:open(ConnectionString),\n  {ok, #state { connection = Connection }}.\n\n<span><span>handle_call</span><span>(find_all, _Sender, State = #state { connection = Connection })</span> -></span>\n  { ok, Result } = redis:find_prefix(dbPrefix, Connection),\n  { reply, Result, State }.\n\n</code></pre>\n<p>This is a bit unwieldy, lacks any notion of type safety across the calls being made, but is still pleasantly relatable to the Purescript variant.</p>\n<pre><code>\n<span>serverName</span> :: <span>ServerName</span> <span>State</span>\n<span>serverName</span> = <span>ServerName</span> <span>&quot;book_library&quot;</span>\n\n<span><span>type</span> <span>BookLibraryStartArgs</span> = {\n<span>connectionString</span> :: <span>ConnectionString</span>\n}</span>\n\n<span><span>type</span> <span>State</span> = {\n<span>connection</span> :: <span>RedisConnection</span>\n}</span>\n\n<span>startLink</span> :: <span>BookLibraryStartArgs</span> -> <span>Effect</span> <span>StartLinkResult</span>\n<span>startLink</span> args =\n  <span>Gen</span>.startLink serverName $ init args\n\n<span>init</span> :: <span>BookLibraryStartArgs</span> -> <span>Effect</span> <span>State</span>\n<span>init</span> args = <span>do</span>\n  connection &lt;- <span>Redis</span>.open args.connectionString\n  pure $ { connection }\n\n<span>findAll</span> :: <span>Effect</span> (<span>List</span> <span>Book</span>)\n<span>findAll</span> = \n  <span>Gen</span>.doCall serverName \\state@{ connection } -> <span>do</span>\n    books &lt;- <span>Redis</span>.findAll dbPrefix connection\n    pure $ <span>CallReply</span> books state\n</code></pre>\n<p>Note: Wrapping up a connection behind a genserver is nearly always not the thing you want to do (effectively it introduces a read/write lock), but sample code gonna sample code.</p>\n<p>Next up, we'll look at how we could use this GenServer from Stetson to provide a restful JSON API to our client.</p>",
   :direction "ltr"},
  :updated 1566293400000,
  :entities
  [{:mentions [{:text "args"} {:text "entry point"}],
    :id "nlp/f/entity/wd:2005914",
    :salienceLevel "mention",
    :label "entry point"}
   {:mentions [{:text "app"} {:text "application"}],
    :id "nlp/f/entity/wd:166142",
    :salienceLevel "mention",
    :label "application"}
   {:mentions [{:text "Erlang"}],
    :id "nlp/f/entity/wd:334879",
    :salienceLevel "mention",
    :label "Erlang"}
   {:mentions [{:text "Gen"}],
    :id "nlp/f/entity/wd:9184",
    :salienceLevel "mention",
    :label "Book of Genesis"}
   {:mentions [{:text "Prelude"}],
    :id "nlp/f/entity/wd:7240062",
    :salienceLevel "mention",
    :label "Prelude"}],
  :alternate
  [{:href
    "http://codeofrob.com/entries/building-on-top-of-otp-with-purescript-with-pinto.html",
    :type "text/html"}],
  :title "Building on top of OTP with Purescript with Pinto",
  :author "Rob Ashton",
  :published-str "Tue Aug 20 02:30:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16cae7d50ec:248e132:340e5e89",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "http://codeofrob.com/entries/building-on-top-of-otp-with-purescript-with-pinto.html",
  :commonTopics
  [{:score 40.99663410819026,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1566293400000,
  :fingerprint "eae8a68",
  :canonicalUrl
  "http://codeofrob.com/entries/building-on-top-of-otp-with-purescript-with-pinto.html"}
 {:engagement 4,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1566212616510,
  :content
  {:content
   "<div>\n<p><em>Issue 340 – August 19, 2019 · <a href=\"https://purelyfunctional.tv/newsletter-archives/\">Archives</a> · <a title=\"Thanks, Jeff!\" href=\"https://purelyfunctional.tv/newsletter/\">Subscribe</a></em></p>\n<h2>Clojure Tip 💡</h2>\n<p><em>Fewer side-effects is better than more</em></p>\n<p>You probably know that if a function doesn’t have any side-effects, it is considered <em>pure</em>. When a function is a pure function, it can be used without regard to when it is called or how many times it is called. It makes parallel programming easier, it makes testing easier, it makes higher-order operations easier.</p>\n<p>However, is it better to go from 2 side-effects down to 1? The benefit is not so clear. You’re not into pure function territory, but you’ve made things easier. What about from 10 down to 9? Certainly, if you can go from 10 to 0, you’re in the functional programming sweet spot. But do you get benefits for having fewer side-effects if you can’t get down to zero?</p>\n<p>I believe that you do. It is better to have fewer side-effects, even if you can’t get down to zero. Zero is the magic number, but 1 is better than 2. The same benefits apply: a function is 1 side-effect is easier to make parallel, easier to test, and easier to use in higher-order operations, than a function with 2 side-effects. That means it’s worth it to refactor even if you can’t go all the way.</p>\n<h2>Awesome book 📖</h2>\n<p><a title href=\"https://www.goodreads.com/book/show/282086.Apollo\"><em>Apollo: The race to the moon</em></a> by Charles Murray and Catherine Bly Cox.</p>\n<p>What an adventure the Apollo program was! This book was first published in 1989. It tells an amazing story of engineering skill and organizational genius that went into building, testing, and commanding the Apollo missions. It focuses much less on the astronauts and much more on the politics and engineering. I really loved to learn about how the major decisions were made and how mission control came to be.</p>\n<p>One last point: I’m not sure about the pedigree of the authors—Murray also wrote <em>The Bell Curve</em>, which is a pseudoscientific racist screed. I didn’t know that before reading <em>Apollo</em>, but I wish I had. I didn’t notice anything amiss save for perhaps the description of the german rocket scientists and their relationships to the Nazi party. They received very little attention in the book, but if I were to read it again, I’d take everything about them with a grain of salt.</p>\n<h2>Book status 📖</h2>\n<p>The book’s title has changed and it now has a cover. It used to be called <em>Taming Complex Software</em>. Now it’s <em>Grokking Simplicity</em>.</p>\n<p>It’s still not available yet. You can check out the cover, watch me read the first reviews that have come back (they’re positive!), and sign up to learn when it launches. <a title href=\"https://lispcast.com/grokking-simplicity/\">Click here</a>.</p>\n<h2>Currently recording 🎥</h2>\n<p>I am now recording a course called <a title href=\"https://purelyfunctional.tv/courses/property-based-testing-with-test-check/\"><em>Property-Based Testing with test.check</em></a>. Property-based testing (PBT) is a powerful tool for generating tests instead of writing them. You’ll love the way PBT makes you think about your system. And you can <a title href=\"https://purelyfunctional.tv/courses/property-based-testing-with-test-check/\">buy it now</a> in Early Access. Of course, PF.tv members have had access since the beginning, along with all of the other courses.</p>\n<p>New lessons this week include:</p>\n<ol>\n<li><a title href=\"https://purelyfunctional.tv/lesson/behind-the-scenes-shrinkage/\">Behind the scenes: shrinkage</a> — in which we shine a microscope on the shrinkage process and watch it happen, step-by-step. Shrinkage is how test.check reports useful failing cases. Without shrinkage, the failing cases would be too big and random.</li>\n<li><a title href=\"https://purelyfunctional.tv/lesson/strategies-for-properties-metamorphic-properties/\">Building complex generators: mutation testing</a> — in which we generate values that are <em>almost</em> correct.</li>\n</ol>\n<p>Last week I said that there were three more lessons for properties, and here I am showing you only two. I reviewed the notes for the third one and I had already covered everything. Soon we’re going to get into real testing examples. But before that, we have to talk about shrinkage.</p>\n<p>I’ve made the first and fifth lessons free to watch. <a title href=\"https://purelyfunctional.tv/courses/property-based-testing-with-test-check/\">Go check them out</a>.</p>\n<p>Members already have access to the lessons. The Early Access Program is open. If you <a title href=\"https://purelyfunctional.tv/courses/property-based-testing-with-test-check/\">buy now</a>, you will get the already published material and everything else that comes out at a serious discount. There are already 7 hours of video, and looking at my plan, this one might be 9-10 hours. But that’s just an estimate. It could be more or less. The uncertainty about it is why there’s such a discount for the Early Access Program.</p>\n<h2>Clojure Challenge 🤔</h2>\n<h3>Last week’s challenge</h3>\n<p>The puzzle in <a title href=\"https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-339-design-is-about-pulling-things-apart/\">Issue 339</a> was to write a symbolic differentiator.</p>\n<p>You can check out the submissions <a title href=\"https://gist.github.com/ericnormand/397337f77faa6b68815c29f60f532db0\">here</a>.</p>\n<h3>This week’s challenge</h3>\n<p><em>symbolic differentiation, pt 2</em></p>\n<p>Now that we’ve got a basic symbolic differentiator (and the numeric one), we could simplify the expressions. SICP gives some basic simplifications.</p>\n<ol>\n<li><code>(+ 0 x) => x</code> or additive identity</li>\n<li><code>(* 1 x) => x</code> or multiplicative identity</li>\n<li><code>(+ 1 2) => 3</code> or constant simplification</li>\n<li><code>(* 3 2) => 6</code> or constant simplification</li>\n</ol>\n<p>Here’s the <a title href=\"https://mitpress.mit.edu/sites/default/files/sicp/full-text/book/book-Z-H-16.html#%_sec_2.3.2\">relevant link into SICP</a>, for reference.</p>\n<p>The challenge this week is to integrate these easy simplifications into the differentiator. If you didn’t do last week’s challenge, grab <a title href=\"https://gist.github.com/ericnormand/397337f77faa6b68815c29f60f532db0\">someone else’s code</a> and work from that.</p>\n<p>As usual, please send me your implementations. I’ll share them all in next week’s issue. If you send me one, but you don’t want me to share it publicly, please let me know.</p>\n<p>Rock on!<br>Eric Normand</p>\n</div>\n<p>The post <a rel=\"nofollow\" href=\"https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-340-fewer-side-effects-is-better-than-more/\">PurelyFunctional.tv Newsletter 340: Fewer side-effects is better than more</a> appeared first on <a rel=\"nofollow\" href=\"https://purelyfunctional.tv\">PurelyFunctional.tv</a>.</p>",
   :direction "ltr"},
  :updated 1566208800000,
  :entities
  [{:mentions
    [{:text "zero"} {:text "love"} {:text "additive identity"}],
    :id "nlp/f/entity/wd:204",
    :salienceLevel "mention",
    :label "0"}
   {:mentions [{:text "Apollo program"}],
    :id "nlp/f/entity/wd:46611",
    :salienceLevel "mention",
    :label "Apollo space program"}
   {:mentions [{:text "functional programming"}],
    :id "nlp/f/entity/wd:193076",
    :salienceLevel "mention",
    :label "functional programming"}
   {:mentions [{:text "magic number"}],
    :id "nlp/f/entity/wd:11606",
    :salienceLevel "mention",
    :label "magic number"}
   {:mentions [{:text "The Bell Curve"}],
    :id "nlp/f/entity/wd:575800",
    :salienceLevel "mention",
    :label "The Bell Curve"}],
  :alternate
  [{:href
    "https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-340-fewer-side-effects-is-better-than-more/",
    :type "text/html"}],
  :title
  "PurelyFunctional.tv Newsletter 340: Fewer side-effects is better than more",
  :author "Eric Normand",
  :published-str "Mon Aug 19 03:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16ca98bf13e:1e17838:340e5e89",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://purelyfunctional.tv/?p=31894",
  :published 1566208800000,
  :fingerprint "967f664a",
  :canonicalUrl
  "https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-340-fewer-side-effects-is-better-than-more/"}
 {:engagement 9,
  :unread false,
  :crawled 1566177520898,
  :content
  {:content
   "<p>My favorite definitions of parallelism and concurrency come from Brian Goetz. They are not the traditional ones, which focus mostly on # of cores. In modern computing, we are sharing so many resources, parallelism and concurrency need to account for that. In this episode, we go over those definitions.</p>\n<p></p>\n<h2>Transcript</h2>\n<p>Eric Normand: What is the difference between parallelism and concurrency?</p>\n<p>In this episode, we’re going to go right to the heart, and we’re going to talk about my favorite definition that distinguishes between these two. My name is Eric Normand, and I help people thrive with functional programming.</p>\n<p>This is an important topic. These are two words that are often confused. They’re very closely related, very similar even. I and other people use them incorrectly in passing all the time.</p>\n<p>We interchange them really. It’s just because they are such closely related concepts, but they are different enough that they do warrant their own terms. If you really need to be precise, then they do have very precise definitions that we could use to gain a little bit of power over our systems.</p>\n<p>What is the difference? I’m going to define both of them. Concurrency is the ability to share resources safely and efficiently. When it says resources, typically, back in the past, we used to think of concurrency as a CPU sharing system. How do we share the CPU safely and efficiently?</p>\n<p>Overtime, we’ve realized that the CPU is only one resource that we might want to share. You could also share memory. You could also share a database. You could share a thread pool. You could share a socket pool, if you’re doing something like an HTTP server. This is concurrency. How do you share it efficiently?</p>\n<p>You have multiple things that want this limited resource. How do you make sure that everybody gets all those things that are wanting to access it? How do they get it fairly so no one gets starved? How do you do it so it doesn’t take too much processing to switch between them? This is concurrency.</p>\n<p>Parallelism is a much simpler idea. It’s deceptively simple. It is simply adding more resources so that you can do more work faster. This is adding another core. This is adding a mirror database or adding more memory. How do you scale it so that you can do more work?</p>\n<p>They work together. If you don’t know how to share the cores, adding more cores might not help your problem. You need them to work together, but they are separate because you can have concurrency where you’re sharing a single resource.</p>\n<p>If you’re in an apartment that has one bathroom and you’ve got four roommates, you can have a concurrent system where you get in line, or you have a lock or something to make sure that only one person uses the bathroom at a time. You have some system to keep it fair. That’s concurrency.</p>\n<p>Then, once you’ve got that system, “Wow, we can put in a new bathroom, and now twice as many people can use the bathroom at the same time,” but you still need a system to share them. They work together.</p>\n<p>I like this definition because I’ve seen others, but they miss out on what’s important that it’s not just about the CPU. I’ve seen it where concurrency is about sharing resources, like memory or the CPU, and parallelism is just adding more cores.</p>\n<p>I think that doesn’t really get to the heart of it. You can have multiple databases running in parallel and they’re not even on the same machine. They’re on different machines in the Cloud, but that will help your system go faster. That is parallel. You can run two queries in parallel. It’s just a more general definition.</p>\n<p>I think that’s all I have to say on this. It’s a very useful concept to be able to distinguish between concurrency and parallelism. It’s confusing because we don’t use them quite so properly all the time because they’re so related.</p>\n<p>It is something that, if you need to be precise about it, this is where the distinction should be made. Awesome. If you like this episode, if you want to get all the past episodes, you can go to lispcast.com/podcast.</p>\n<p>There, you’ll find audio, video, and text transcripts of all of the past episodes. You’ll also find links to subscribe as RSS for your podcast subscription or if you want to subscribe on YouTube. It’s all there.</p>\n<p>You’ll also find links to get in touch with me on social media, including email, Twitter, LinkedIn, etc. I love to get into discussions, so please hit me up. Don’t be afraid.</p>\n<p>Cool. My name is Eric Normand. This has been my thought on functional programming. Thank you for being there, and rock on.</p>\n<p>The post <a rel=\"nofollow\" href=\"https://lispcast.com/what-is-the-difference-between-parallelism-and-concurrency/\">What is the difference between parallelism and concurrency?</a> appeared first on <a rel=\"nofollow\" href=\"https://lispcast.com\">LispCast</a>.</p>",
   :direction "ltr"},
  :updated 1566172800000,
  :entities
  [{:mentions [{:text "CPU"}],
    :id "nlp/f/entity/wd:5300",
    :salienceLevel "mention",
    :label "central processing unit"}
   {:mentions [{:text "functional programming"}],
    :id "nlp/f/entity/wd:193076",
    :salienceLevel "mention",
    :label "functional programming"}
   {:mentions [{:text "HTTP server"}],
    :id "nlp/f/entity/wd:11288",
    :salienceLevel "mention",
    :label "web server"}
   {:mentions [{:text "RSS"}],
    :id "nlp/f/entity/wd:45432",
    :salienceLevel "mention",
    :label "Rich Site Summary"}
   {:mentions [{:text "Twitter"}],
    :id "nlp/f/entity/wd:918",
    :salienceLevel "mention",
    :label "Twitter"}],
  :alternate
  [{:href
    "https://lispcast.com/what-is-the-difference-between-parallelism-and-concurrency/",
    :type "text/html"}],
  :title "What is the difference between parallelism and concurrency?",
  :author "Eric Normand",
  :published-str "Sun Aug 18 17:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16ca7746d02:1bb123a:340e5e89",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url
   "https://lispcast.com/wp-content/uploads/2019/08/What-is-the-difference-between-parallelism-and-concurrency_.jpg",
   :width 1280,
   :height 720,
   :contentType "image/jpeg"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://lispcast.com/?p=1980",
  :commonTopics
  [{:score 27.79531414970575,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1566172800000,
  :fingerprint "a9cf5d72",
  :canonicalUrl
  "https://lispcast.com/what-is-the-difference-between-parallelism-and-concurrency/"}
 {:engagement 4,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/todo",
    :label "todo"}
   {:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1566150301400,
  :recrawled 1566171915213,
  :content
  {:content
   "<p><a title=\"Perfect mirror\" href=\"https://www.flickr.com/photos/horlik/2901925672/in/photolist-5qr8pf-qkv3m8-32RwmC-dZBC2B-ja8ch-48vDg-f56TGS-oUfNKn-652ZqG-QnCrbX-y3C828-jeGkmu-dxwE9L-jKaGtZ-haQ6j3-61w8UJ-WmitYz-tLymA-dZCHC4-CGvx3R-CC3GPE-BSxzda-eu625R-vHAgnk-cR7WAE-jZiLgu-BsZwLP-fhfvPT-dN1Rf9-o8Mkby-8zDocw-5DvC7S-CEij58-oaw922-akUgeW-ayQiGU-aay1vS-2fVFske-2eoRpCe-rqwa4o-9VJPtv-opgEcq-MDfFe-9yzUaK-4is9Z9-cutXnm-f9U23-L7hpoe-3i3H-enSJKf\"><img alt=\"Perfect mirror\" width=\"500\" src=\"https://live.staticflickr.com/3274/2901925672_325f5faeb8.jpg\" height=\"364\"></a></p>\n<p><em>If you look long enough into the autoencoder, it looks back at you.</em></p>\n<p>The Autoencoder is a fun deep learning model to look into. Its goal is simple: given an input image, we would like to have the same output image.</p>\n<p>It’s sort of an identity function for deep learning models, but it is composed of two parts: an encoder and decoder, with the encoder translating the images to a <em>latent space representation</em> and the encoder translating that back to a regular images that we can view.</p>\n<p><img alt=\"\" src=\"https://camo.githubusercontent.com/1ab40362a922059fa3686914cf5cff803ba7dd43/68747470733a2f2f63646e2d696d616765732d312e6d656469756d2e636f6d2f6d61782f3830302f312a4c53594e57356d33544e377852583631425a686f5a412e706e67\"></p>\n<p>We are going to make a simple autoencoder with Clojure MXNet for handwritten digits using the MNIST dataset.</p>\n<h3>The Dataset</h3>\n<p>We first load up the training data into an iterator that will allow us to cycle through all the images.</p>\n<figure><span></span><div><table><tbody><tr><td><pre><span>1</span>\n<span>2</span>\n<span>3</span>\n<span>4</span>\n<span>5</span>\n<span>6</span>\n</pre></td><td><pre><code><span><span>(</span><span>def </span><span>train-data</span> <span>(</span><span>mx-io/mnist-iter</span> <span>{</span><span>:image</span> <span>(</span><span>str </span><span>data-dir</span> <span>&quot;train-images-idx3-ubyte&quot;</span><span>)</span>\n</span><span> <span>:label</span> <span>(</span><span>str </span><span>data-dir</span> <span>&quot;train-labels-idx1-ubyte&quot;</span><span>)</span>\n</span><span> <span>:input-shape</span> <span>[</span><span>784</span><span>]</span>\n</span><span> <span>:flat</span> <span>true</span>\n</span><span> <span>:batch-size</span> <span>batch-size</span>\n</span><span> <span>:shuffle</span> <span>true</span><span>}))</span>\n</span></code></pre></td></tr></tbody></table></div></figure>\n<p>Notice there the the input shape is 784. We are purposely flattening out our 28x28 image of a number to just be a one dimensional flat array. The reason is so that we can use a simpler model for the autoencoder.</p>\n<p>We also load up the corresponding test data.</p>\n<figure><span></span><div><table><tbody><tr><td><pre><span>1</span>\n<span>2</span>\n<span>3</span>\n<span>4</span>\n<span>5</span>\n<span>6</span>\n</pre></td><td><pre><code><span><span>(</span><span>def </span><span>test-data</span> <span>(</span><span>mx-io/mnist-iter</span> <span>{</span><span>:image</span> <span>(</span><span>str </span><span>data-dir</span> <span>&quot;t10k-images-idx3-ubyte&quot;</span><span>)</span>\n</span><span> <span>:label</span> <span>(</span><span>str </span><span>data-dir</span> <span>&quot;t10k-labels-idx1-ubyte&quot;</span><span>)</span>\n</span><span> <span>:input-shape</span> <span>[</span><span>784</span><span>]</span>\n</span><span> <span>:batch-size</span> <span>batch-size</span>\n</span><span> <span>:flat</span> <span>true</span>\n</span><span> <span>:shuffle</span> <span>true</span><span>}))</span>\n</span></code></pre></td></tr></tbody></table></div></figure>\n<p>When we are working with deep learning models we keep the training and the test data separate. When we train the model, we won’t use the test data. That way we can evaluate it later on the unseen test data.</p>\n<h3>The Model</h3>\n<p>Now we need to define the layers of the model. We know we are going to have an input and an output. The input will be the array that represents the image of the digit and the output will also be an array which is reconstruction of that image.</p>\n<figure><span></span><div><table><tbody><tr><td><pre><span>1</span>\n<span>2</span>\n<span>3</span>\n<span>4</span>\n<span>5</span>\n<span>6</span>\n<span>7</span>\n<span>8</span>\n<span>9</span>\n<span>10</span>\n<span>11</span>\n<span>12</span>\n<span>13</span>\n<span>14</span>\n<span>15</span>\n<span>16</span>\n<span>17</span>\n<span>18</span>\n<span>19</span>\n<span>20</span>\n<span>21</span>\n<span>22</span>\n<span>23</span>\n<span>24</span>\n<span>25</span>\n<span>26</span>\n</pre></td><td><pre><code><span><span>(</span><span>def </span><span>input</span> <span>(</span><span>sym/variable</span> <span>&quot;input&quot;</span><span>))</span>\n</span><span><span>(</span><span>def </span><span>output</span> <span>(</span><span>sym/variable</span> <span>&quot;input_&quot;</span><span>))</span>\n</span><span>\n</span><span><span>(</span><span>defn </span><span>get-symbol</span> <span>[]</span>\n</span><span> <span>(</span><span>as-></span> <span>input</span> <span>data</span>\n</span><span> <span>;; encode</span>\n</span><span> <span>(</span><span>sym/fully-connected</span> <span>&quot;encode1&quot;</span> <span>{</span><span>:data</span> <span>data</span> <span>:num-hidden</span> <span>100</span><span>})</span>\n</span><span> <span>(</span><span>sym/activation</span> <span>&quot;sigmoid1&quot;</span> <span>{</span><span>:data</span> <span>data</span> <span>:act-type</span> <span>&quot;sigmoid&quot;</span><span>})</span>\n</span><span>\n</span><span> <span>;; encode</span>\n</span><span> <span>(</span><span>sym/fully-connected</span> <span>&quot;encode2&quot;</span> <span>{</span><span>:data</span> <span>data</span> <span>:num-hidden</span> <span>50</span><span>})</span>\n</span><span> <span>(</span><span>sym/activation</span> <span>&quot;sigmoid2&quot;</span> <span>{</span><span>:data</span> <span>data</span> <span>:act-type</span> <span>&quot;sigmoid&quot;</span><span>})</span>\n</span><span>\n</span><span> <span>;; decode</span>\n</span><span> <span>(</span><span>sym/fully-connected</span> <span>&quot;decode1&quot;</span> <span>{</span><span>:data</span> <span>data</span> <span>:num-hidden</span> <span>50</span><span>})</span>\n</span><span> <span>(</span><span>sym/activation</span> <span>&quot;sigmoid3&quot;</span> <span>{</span><span>:data</span> <span>data</span> <span>:act-type</span> <span>&quot;sigmoid&quot;</span><span>})</span>\n</span><span>\n</span><span> <span>;; decode</span>\n</span><span> <span>(</span><span>sym/fully-connected</span> <span>&quot;decode2&quot;</span> <span>{</span><span>:data</span> <span>data</span> <span>:num-hidden</span> <span>100</span><span>})</span>\n</span><span> <span>(</span><span>sym/activation</span> <span>&quot;sigmoid4&quot;</span> <span>{</span><span>:data</span> <span>data</span> <span>:act-type</span> <span>&quot;sigmoid&quot;</span><span>})</span>\n</span><span>\n</span><span> <span>;;output</span>\n</span><span> <span>(</span><span>sym/fully-connected</span> <span>&quot;result&quot;</span> <span>{</span><span>:data</span> <span>data</span> <span>:num-hidden</span> <span>784</span><span>})</span>\n</span><span> <span>(</span><span>sym/activation</span> <span>&quot;sigmoid5&quot;</span> <span>{</span><span>:data</span> <span>data</span> <span>:act-type</span> <span>&quot;sigmoid&quot;</span><span>})</span>\n</span><span>\n</span><span> <span>(</span><span>sym/linear-regression-output</span> <span>{</span><span>:data</span> <span>data</span> <span>:label</span> <span>output</span><span>})))</span>\n</span></code></pre></td></tr></tbody></table></div></figure>\n<p>From the model above we can see the input (image) being passed through simple layers of encoder to its latent representation, and then boosted back up from the decoder back into an output (image). It goes through the pleasingly symmetric transformation of:</p>\n<p>784 (image) –> 100 –> 50 –> 50 –> 100 –> 784 (output)</p>\n<p>We can now construct the full model with the <em>module</em> api from clojure-mxnet.</p>\n<figure><span></span><div><table><tbody><tr><td><pre><span>1</span>\n<span>2</span>\n<span>3</span>\n<span>4</span>\n<span>5</span>\n<span>6</span>\n<span>7</span>\n</pre></td><td><pre><code><span><span>(</span><span>def </span><span>data-desc</span> <span>(</span><span>first </span><span>(</span><span>mx-io/provide-data-desc</span> <span>train-data</span><span>)))</span>\n</span><span>\n</span><span><span>(</span><span>def </span><span>model</span> <span>(</span><span>-> </span><span>(</span><span>m/module</span> <span>(</span><span>get-symbol</span><span>)</span> <span>{</span><span>:data-names</span> <span>[</span><span>&quot;input&quot;</span><span>]</span> <span>:label-names</span> <span>[</span><span>&quot;input_&quot;</span><span>]})</span>\n</span><span> <span>(</span><span>m/bind</span> <span>{</span><span>:data-shapes</span> <span>[(</span><span>assoc </span><span>data-desc</span> <span>:name</span> <span>&quot;input&quot;</span><span>)]</span>\n</span><span> <span>:label-shapes</span> <span>[(</span><span>assoc </span><span>data-desc</span> <span>:name</span> <span>&quot;input_&quot;</span><span>)]})</span>\n</span><span> <span>(</span><span>m/init-params</span> <span>{</span><span>:initializer</span> <span>(</span><span>initializer/uniform</span> <span>1</span><span>)})</span>\n</span><span> <span>(</span><span>m/init-optimizer</span> <span>{</span><span>:optimizer</span> <span>(</span><span>optimizer/adam</span> <span>{</span><span>:learning-rage</span> <span>0.001</span><span>})})))</span>\n</span></code></pre></td></tr></tbody></table></div></figure>\n<p>Notice that when we are binding the <code>data-shapes</code> and <code>label-shapes</code> we are using only the <code>data</code> from our handwritten digit dataset, (the images), and not the labels. This will ensure that as it trains it will seek to recreate the input image for the output image.</p>\n<h3>Before Training</h3>\n<p>Before we start our training, let’s get a baseline of what the original images look like and what the output of the untrained model is.</p>\n<p>To look at the original images we can take the first training batch of 100 images and visualize them. Since we are initially using the flattened <code>[784]</code> image representation. We need to reshape it to the 28x28 image that we can recognize.</p>\n<figure><span></span><div><table><tbody><tr><td><pre><span>1</span>\n<span>2</span>\n<span>3</span>\n<span>4</span>\n</pre></td><td><pre><code><span><span>(</span><span>def </span><span>my-batch</span> <span>(</span><span>mx-io/next</span> <span>train-data</span><span>))</span>\n</span><span><span>(</span><span>def </span><span>images</span> <span>(</span><span>mx-io/batch-data</span> <span>my-batch</span><span>))</span>\n</span><span><span>(</span><span>ndarray/shape</span> <span>(</span><span>ndarray/reshape</span> <span>(</span><span>first </span><span>images</span><span>)</span> <span>[</span><span>100</span> <span>1</span> <span>28</span> <span>28</span><span>]))</span>\n</span><span><span>(</span><span>viz/im-sav</span> <span>{</span><span>:title</span> <span>&quot;originals&quot;</span> <span>:output-path</span> <span>&quot;results/&quot;</span> <span>:x</span> <span>(</span><span>ndarray/reshape</span> <span>(</span><span>first </span><span>images</span><span>)</span> <span>[</span><span>100</span> <span>1</span> <span>28</span> <span>28</span><span>])})</span>\n</span></code></pre></td></tr></tbody></table></div></figure>\n<p><a title=\"originals\" href=\"https://www.flickr.com/photos/50581552@N06/48567560737/in/dateposted-public/\"><img alt=\"originals\" width=\"420\" src=\"https://live.staticflickr.com/65535/48567560737_672d065ac2.jpg\" height=\"420\"></a></p>\n<p>We can also do the same visualization with the test batch of data images by putting them into the <code>predict-batch</code> and using our model.</p>\n<figure><span></span><div><table><tbody><tr><td><pre><span>1</span>\n<span>2</span>\n<span>3</span>\n<span>4</span>\n<span>5</span>\n</pre></td><td><pre><code><span><span>;;; before training</span>\n</span><span> <span>(</span><span>def </span><span>my-test-batch</span> <span>(</span><span>mx-io/next</span> <span>test-data</span><span>))</span>\n</span><span> <span>(</span><span>def </span><span>test-images</span> <span>(</span><span>mx-io/batch-data</span> <span>my-test-batch</span><span>))</span>\n</span><span> <span>(</span><span>def </span><span>preds</span> <span>(</span><span>m/predict-batch</span> <span>model</span> <span>{</span><span>:data</span> <span>test-images</span><span>}</span> <span>))</span>\n</span><span> <span>(</span><span>viz/im-sav</span> <span>{</span><span>:title</span> <span>&quot;before-training-preds&quot;</span> <span>:output-path</span> <span>&quot;results/&quot;</span> <span>:x</span> <span>(</span><span>ndarray/reshape</span> <span>(</span><span>first </span><span>preds</span><span>)</span> <span>[</span><span>100</span> <span>1</span> <span>28</span> <span>28</span><span>])})</span>\n</span></code></pre></td></tr></tbody></table></div></figure>\n<p><a title=\"before-training-preds\" href=\"https://www.flickr.com/photos/50581552@N06/48567589067/in/dateposted-public/\"><img alt=\"before-training-preds\" width=\"420\" src=\"https://live.staticflickr.com/65535/48567589067_e44eeda1a9.jpg\" height=\"420\"></a></p>\n<p>They are not anything close to recognizable as numbers.</p>\n<h3>Training</h3>\n<p>The next step is to train the model on the data. We set up a training function to step through all the batches of data.</p>\n<figure><span></span><div><table><tbody><tr><td><pre><span>1</span>\n<span>2</span>\n<span>3</span>\n<span>4</span>\n<span>5</span>\n<span>6</span>\n<span>7</span>\n<span>8</span>\n<span>9</span>\n<span>10</span>\n<span>11</span>\n<span>12</span>\n<span>13</span>\n<span>14</span>\n</pre></td><td><pre><code><span><span>(</span><span>def </span><span>my-metric</span> <span>(</span><span>eval-metric/mse</span><span>))</span>\n</span><span>\n</span><span><span>(</span><span>defn </span><span>train</span> <span>[</span><span>num-epochs</span><span>]</span>\n</span><span> <span>(</span><span>doseq </span><span>[</span><span>epoch-num</span> <span>(</span><span>range </span><span>0</span> <span>num-epochs</span><span>)]</span>\n</span><span> <span>(</span><span>println </span><span>&quot;starting epoch &quot;</span> <span>epoch-num</span><span>)</span>\n</span><span> <span>(</span><span>mx-io/do-batches</span>\n</span><span> <span>train-data</span>\n</span><span> <span>(</span><span>fn </span><span>[</span><span>batch</span><span>]</span>\n</span><span> <span>(</span><span>-> </span><span>model</span>\n</span><span> <span>(</span><span>m/forward</span> <span>{</span><span>:data</span> <span>(</span><span>mx-io/batch-data</span> <span>batch</span><span>)</span> <span>:label</span> <span>(</span><span>mx-io/batch-data</span> <span>batch</span><span>)})</span>\n</span><span> <span>(</span><span>m/update-metric</span> <span>my-metric</span> <span>(</span><span>mx-io/batch-data</span> <span>batch</span><span>))</span>\n</span><span> <span>(</span><span>m/backward</span><span>)</span>\n</span><span> <span>(</span><span>m/update</span><span>))))</span>\n</span><span> <span>(</span><span>println </span><span>&quot;result for epoch &quot;</span> <span>epoch-num</span> <span>&quot; is &quot;</span> <span>(</span><span>eval-metric/get-and-reset</span> <span>my-metric</span><span>))))</span>\n</span></code></pre></td></tr></tbody></table></div></figure>\n<p>For each batch of 100 images it is doing the following:</p>\n<ul>\n<li>Run the forward pass of the model with both the data and label being the image</li>\n<li>Update the accuracy of the model with the <code>mse</code> (mean squared error metric)</li>\n<li>Do the backward computation</li>\n<li>Update the model according to the optimizer and the forward/backward computation.</li>\n</ul>\n<p>Let’s train it for 3 epochs.</p>\n<figure><span></span><div><table><tbody><tr><td><pre><span>1</span>\n<span>2</span>\n<span>3</span>\n<span>4</span>\n<span>5</span>\n<span>6</span>\n</pre></td><td><pre><code><span><span>starting</span> <span>epoch</span> <span>0</span>\n</span><span><span>result</span> <span>for </span><span>epoch</span> <span>0</span> <span>is</span> <span>[</span><span>mse</span> <span>0.06460866</span><span>]</span>\n</span><span><span>starting</span> <span>epoch</span> <span>1</span>\n</span><span><span>result</span> <span>for </span><span>epoch</span> <span>1</span> <span>is</span> <span>[</span><span>mse</span> <span>0.033874355</span><span>]</span>\n</span><span><span>starting</span> <span>epoch</span> <span>2</span>\n</span><span><span>result</span> <span>for </span><span>epoch</span> <span>2</span> <span>is</span> <span>[</span><span>mse</span> <span>0.027255038</span><span>]</span>\n</span></code></pre></td></tr></tbody></table></div></figure>\n<h3>After training</h3>\n<p>We can check the test images again and see if they look better.</p>\n<figure><span></span><div><table><tbody><tr><td><pre><span>1</span>\n<span>2</span>\n<span>3</span>\n<span>4</span>\n<span>5</span>\n</pre></td><td><pre><code><span><span>;;; after training</span>\n</span><span><span>(</span><span>def </span><span>my-test-batch</span> <span>(</span><span>mx-io/next</span> <span>test-data</span><span>))</span>\n</span><span><span>(</span><span>def </span><span>test-images</span> <span>(</span><span>mx-io/batch-data</span> <span>my-test-batch</span><span>))</span>\n</span><span><span>(</span><span>def </span><span>preds</span> <span>(</span><span>m/predict-batch</span> <span>model</span> <span>{</span><span>:data</span> <span>test-images</span><span>}</span> <span>))</span>\n</span><span><span>(</span><span>viz/im-sav</span> <span>{</span><span>:title</span> <span>&quot;after-training-preds&quot;</span> <span>:output-path</span> <span>&quot;results/&quot;</span> <span>:x</span> <span>(</span><span>ndarray/reshape</span> <span>(</span><span>first </span><span>preds</span><span>)</span> <span>[</span><span>100</span> <span>1</span> <span>28</span> <span>28</span><span>])})</span>\n</span></code></pre></td></tr></tbody></table></div></figure>\n<p><a title=\"after-training-preds\" href=\"https://www.flickr.com/photos/50581552@N06/48567523206/in/dateposted-public/\"><img alt=\"after-training-preds\" width=\"420\" src=\"https://live.staticflickr.com/65535/48567523206_d78480012f.jpg\" height=\"420\"></a></p>\n<p>Much improved! They definitely look like numbers.</p>\n<h3>Wrap up</h3>\n<p>We’ve made a simple autoencoder that can take images of digits and compress them down to a latent space representation the can later be decoded into the same image.</p>\n<p>If you want to check out the full code for this example, you can find it <a href=\"https://github.com/gigasquid/clojure-mxnet-autoencoder\">here</a>.</p>\n<p>Stay tuned. We’ll take this example and build on it in future posts.</p>",
   :direction "ltr"},
  :updated 1565986560000,
  :entities
  [{:mentions [{:text "Model"}],
    :id "nlp/f/entity/wd:1630100",
    :salienceLevel "about",
    :label "art model"}
   {:mentions [{:text "deep learning"}],
    :id "nlp/f/entity/wd:197536",
    :salienceLevel "mention",
    :label "deep learning"}
   {:mentions [{:text "mean squared error"} {:text "MSE"}],
    :id "nlp/f/entity/wd:1940696",
    :salienceLevel "mention",
    :label "mean squared error"}
   {:mentions [{:text "identity function"}],
    :id "nlp/f/entity/wd:321119",
    :salienceLevel "mention",
    :label "identity function"}
   {:mentions [{:text "linear regression"}],
    :id "nlp/f/entity/wd:10861030",
    :salienceLevel "mention",
    :label "linear regression"}],
  :alternate
  [{:href
    "http://gigasquid.github.io/blog/2019/08/16/simple-autoencoder/",
    :type "text/html"}],
  :title "Simple Autoencoder",
  :author "Carin Meier",
  :published-str "Fri Aug 16 13:16:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16ca5d516d8:1928a4d:fd909f4f",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url "https://live.staticflickr.com/3274/2901925672_325f5faeb8.jpg",
   :width 500,
   :height 364,
   :contentType "image/jpeg"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "http://gigasquid.github.io/blog/2019/08/16/simple-autoencoder",
  :updateCount 2,
  :commonTopics
  [{:score 54.257100248559176,
    :id "nlp/f/topic/3000",
    :salienceLevel "about",
    :label "artificial intelligence"}
   {:score 43.38116240402471,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.783,
    :id "nlp/f/topic/1871",
    :salienceLevel "mention",
    :label "quant"}
   {:score 0.753,
    :id "nlp/f/topic/253",
    :salienceLevel "mention",
    :label "big data"}
   {:score 0.748,
    :id "nlp/f/topic/2010",
    :salienceLevel "mention",
    :label "scalability"}
   {:score 0.716,
    :id "nlp/f/topic/526",
    :salienceLevel "mention",
    :label "computer vision"}],
  :published 1565986560000,
  :fingerprint "c272960",
  :canonicalUrl
  "http://gigasquid.github.io/blog/2019/08/16/simple-autoencoder/"}
 {:engagement 8,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1565998073945,
  :content
  {:content
   "<p>Each week, we answer a different question about Clojure and functional programming.</p>\n<p>If you have a question you’d like us to discuss, tweet <a href=\"https://twitter.com/clojuredesign\">@clojuredesign</a>, send an email to <a href=\"mailto:feedback@clojuredesign.club\">feedback@clojuredesign.club</a>, or join the <code>#clojuredesign-podcast</code> channel on the <a href=\"http://clojurians.net/\">Clojurians Slack</a>.</p>\n<p>This week, the question is: <strong>“What does it mean to be ‘data-oriented’?”</strong> We merge together different aspects of Clojure’s data orientation, and specify which of those help make development more pleasant.</p>\n<p>Selected quotes:</p>\n<ul>\n<li>“Clojure has the corner on data.”</li>\n<li>“Other languages have data too, it’s just locked in little cages.”</li>\n<li>“Data is inert, it can’t harm you.”</li>\n<li>“Because Clojure is expressed in its own data structures, and those structures are simple, that makes Clojure syntax simple.”</li>\n<li>“Find a good way to represent the information that you want to work with, in a way that feels appropriate for the subject matter.”</li>\n<li>“If you find a good way of representing your information, that representation tends to be pretty stable. All of the change is in the functions you use to work with it.”</li>\n</ul>",
   :direction "ltr"},
  :updated 1565967600000,
  :entities
  [{:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "about",
    :label "Clojure"}
   {:mentions [{:text "functional programming"}],
    :id "nlp/f/entity/wd:193076",
    :salienceLevel "mention",
    :label "functional programming"}
   {:mentions [{:text "subject matter"}],
    :id "nlp/f/entity/wd:164573",
    :salienceLevel "mention",
    :label "subject"}],
  :alternate
  [{:href
    "https://clojuredesign.club/episode/042-what-does-it-mean-to-be-data-oriented/",
    :type "text/html"}],
  :title "Ep 042: What Does It Mean to Be 'Data-Oriented'?",
  :author "Christoph Neumann and Nate Jones",
  :published-str "Fri Aug 16 08:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16c9cc24859:10f3d58:fd909f4f",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://clojuredesign.club/episode/042-what-does-it-mean-to-be-data-oriented/",
  :commonTopics
  [{:score 37.52968988712971,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.975,
    :id "nlp/f/topic/501",
    :salienceLevel "about",
    :label "college"}
   {:score 0.906,
    :id "nlp/f/topic/1695",
    :salienceLevel "about",
    :label "parenting"}
   {:score 0.819,
    :id "nlp/f/topic/861",
    :salienceLevel "mention",
    :label "finance"}],
  :published 1565967600000,
  :fingerprint "6235eeb8",
  :canonicalUrl
  "https://clojuredesign.club/episode/042-what-does-it-mean-to-be-data-oriented/"}
 {:engagement 4,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1565883505937,
  :content
  {:content
   "<div>\n<div>\n<div>\n<p>Like many in the Clojure community, I’ve considered JSON as a rather\nhorrible syntax (compared to the obvious superiority of <a href=\"https://github.com/edn-format/edn\">EDN</a>).</p>\n</div>\n<div>\n<p>As a configuration format, JSON is used almost everywhere: npm’s package.json, AWS CloudFormation, Hashicorp Terraform, Open API, .NET, the list is endless.</p>\n</div>\n<div>\n<p>For me, the worst issue is the exclusion of comments. Of all the\nproblems we’re leaving to future generations, the complete lack of\nexplanation in the configuration files of future legacy software\nsystems must be among the most irksome. Understanding is good,\nclear explanations are good; discouraging the use of helpful and\nclarifying comments is inexcusable.</p>\n</div>\n<div>\n<p>The situation would improve if developers stopped adopting JSON for\nconfiguration files - and there are JSON-like formats available that\nare much better suited to this task, such as\n<a href=\"https://hjson.org/\">Hjson</a>, <a href=\"https://jsonnet.org/\">Jsonnet</a>,\n<a href=\"https://yaml.org/\">YAML</a> and others. The downside of these is that they\nrequire special format reading software which is rarely built-in to\nlanguages. At JUXT, we use <a href=\"https://github.com/juxt/aero\">Aero</a>, which\nwe consider to be the best of all worlds.</p>\n</div>\n</div>\n</div>\n<div>\n<h2><a href=\"https://juxt.pro/blog/rss.xml?category=clojure&since=2016-03-13#_change_the_perspective\"></a>Change the perspective</h2>\n<div>\n<div>\n<p>Let’s start again and think about what JSON is:</p>\n</div>\n<div>\n<div>\n<pre><code>{\n&quot;list&quot;: [&quot;string&quot; {&quot;map&quot;: {&quot;key&quot;: &quot;value&quot;}}]\n}</code></pre>\n</div>\n</div>\n<div>\n<p>It’s maps, lists, maps-of-lists, lists-of-maps, lists-of-lists,\nmaps-of-maps.</p>\n</div>\n<div>\n<p>In fact, from a Clojure perspective, things couldn’t be better:\nClojure is, hands down, the most adept language at processing this\nnear-ubiquitous format. Of course, we’re a little bit biased at JUXT!</p>\n</div>\n<div>\n<p>Back when everything was XML, and everyone wrote Java (or C#), I\nremember working on a large project. We spent weeks (literally,\nweeks!) working on serialisation and de-serialisation of data from XML\ninto Java and back. I/O is a critical part of any program. Getting\ndata in and out of a program shouldn’t be that hard, and with\nClojure and JSON it isn’t.</p>\n</div>\n<table>\n<colgroup>\n<col>\n<col>\n</colgroup>\n<thead>\n<tr>\n<th>Data format</th>\n<th>Ideal processing language</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><p>CSV</p></td>\n<td><p>SQL</p></td>\n</tr>\n<tr>\n<td><p>SGML</p></td>\n<td><p>DSSSL</p></td>\n</tr>\n<tr>\n<td><p>XML</p></td>\n<td><p>XSLT</p></td>\n</tr>\n<tr>\n<td><p>JSON</p></td>\n<td><p>CLJ/S (Clojure)</p></td>\n</tr>\n</tbody>\n</table>\n<div>\n<p>It’s almost as if, behind the scenes, there’s been this <em>Grand Lisp\nConspiracy</em> to get everyone programming in Lisp, whether or not they\nrealise it.</p>\n</div>\n<div>\n<div>\n<img alt=\"guy steele\" width=\"50%\" src=\"https://juxt.pro/img/guy-steele.png\">\n</div>\n</div>\n<div>\n<p>By disguising itself with some ornamental punctuation, JSON has infected\nthe whole world with Lisp.</p>\n</div>\n</div>\n</div>\n<div>\n<h2><a href=\"https://juxt.pro/blog/rss.xml?category=clojure&since=2016-03-13#_json_schema\"></a>JSON Schema</h2>\n<div>\n<div>\n<p><a href=\"https://json-schema.org/\">JSON Schema</a> is an emerging standard which is used to define the structure of JSON documents. It’s mostly used to validate that JSON documents conform to expectations. However, since JSON allows anyone to define new keywords and add them to 'vocabularies', I believe JSON Schema should be thought of as a more general way of specifying meta-data.</p>\n</div>\n<div>\n<p>When combined with meta-data, data takes on some magical super-powers.</p>\n</div>\n<div>\n<div>\n<img alt=\"react jsonschema form\" width=\"50%\" src=\"https://juxt.pro/img/react-jsonschema-form.png\">\n</div>\n</div>\n<div>\n<p>One example is\n<a href=\"https://mozilla-services.github.io/react-jsonschema-form/\">Mozilla’s\nReact JSON Schema Form</a> which demonstrates a React component that can\ndynamically produce forms via introspecting JSON data and its schema.</p>\n</div>\n<div>\n<p>I believe there will be plenty of other uses of JSON Schema in the future.</p>\n</div>\n<div>\n<div>\n<img alt=\"json schema\" width=\"50%\" src=\"https://juxt.pro/img/json-schema.png\">\n</div>\n</div>\n<div>\n<p>One example I’m particularly interested in is the use of JSON Schema\nas a pull-syntax for our <a href=\"https://juxt.pro/crux\">Crux</a> database. JSON Schema allows you to declare the structure of the document you want to 'pull' out of Crux, Crux will perform the necessary graph queries against its documents. The result documents will successfully validate against the schema, as the query <em>is</em> the schema.</p>\n</div>\n</div>\n</div>\n<div>\n<h2><a href=\"https://juxt.pro/blog/rss.xml?category=clojure&since=2016-03-13#_jinx\"></a>jinx</h2>\n<div>\n<div>\n<p>I wanted to explore the potential of JSON Schema to provide a way of\naccessing metadata about documents in order to make the data more\nuseful and powerful.</p>\n</div>\n<div>\n<p>Thanks to some help from some colleagues (in particular, Shivek\nKhurana and Sunita Kawane), these explorations have resulted in a new\nClojure(Script) library called <strong>jinx</strong>, which provides schema-powered\ncapabilities, which of course includes validation. We’re hoping this\ncan be used for a variety of applications, not just to validate data\ndocuments but to access the annotations made via the JSON Schema\ndocument.</p>\n</div>\n<div>\n<p>A quick example:</p>\n</div>\n<div>\n<div>\n<pre><code>(juxt.jinx.validate/validate\n  {&quot;firstName&quot; &quot;John&quot;\n   &quot;lastName&quot; &quot;Doe&quot;\n   &quot;age&quot; 21}\n  (juxt.jinx.schema/schema\n   {&quot;$id&quot; &quot;https://example.com/person.schema.json&quot;\n    &quot;$schema&quot; &quot;http://json-schema.org/draft-07/schema#&quot;\n    &quot;title&quot; &quot;Person&quot;\n    &quot;type&quot; &quot;object&quot;\n    &quot;properties&quot;\n    {&quot;firstName&quot;\n     {&quot;type&quot; &quot;string&quot;\n      &quot;description&quot; &quot;The person's first name.&quot;}\n     &quot;lastName&quot;\n     {&quot;type&quot; &quot;string&quot;\n      &quot;description&quot; &quot;The person's last name.&quot;}\n     &quot;age&quot; {&quot;description&quot; &quot;Age in years which must be equal to or greater than zero.&quot;\n            &quot;type&quot; &quot;integer&quot;\n            &quot;minimum&quot; 0}}}))\n\n=>\n\n{:instance {&quot;firstName&quot; &quot;John&quot;, &quot;lastName&quot; &quot;Doe&quot;, &quot;age&quot; 21},\n :annotations\n {&quot;title&quot; &quot;Person&quot;,\n  :properties\n  {&quot;firstName&quot; {&quot;description&quot; &quot;The person's first name.&quot;},\n   &quot;lastName&quot; {&quot;description&quot; &quot;The person's last name.&quot;},\n   &quot;age&quot;\n   {&quot;description&quot;\n    &quot;Age in years which must be equal to or greater than zero.&quot;}}},\n :type &quot;object&quot;,\n :valid? true}</code></pre>\n</div>\n</div>\n<div>\n<p>Our jinx library is still in ALPHA status but it would be great to\nhear all feedback and comments. It’s available on GitHub at\n<a href=\"https://github.com/juxt/jinx\">https://github.com/juxt/jinx</a>.</p>\n</div>\n</div>\n</div>\n<div>\n<h2><a href=\"https://juxt.pro/blog/rss.xml?category=clojure&since=2016-03-13#_references\"></a>References</h2>\n<div>\n<div>\n<ul>\n<li>\n<p><a href=\"https://arp242.net/json-config.html\">https://arp242.net/json-config.html</a></p>\n</li>\n<li>\n<p><a href=\"https://revelry.co/json-configuration-file-format/\">https://revelry.co/json-configuration-file-format/</a></p>\n</li>\n<li>\n<p><a href=\"https://dzone.com/articles/why-json-isnt-a-good-configuration-language\">https://dzone.com/articles/why-json-isnt-a-good-configuration-language</a></p>\n</li>\n</ul>\n</div>\n</div>\n</div>",
   :direction "ltr"},
  :updated 1565877600000,
  :entities
  [{:mentions [{:text "JSON"}],
    :id "nlp/f/entity/wd:2063",
    :salienceLevel "about",
    :label "JavaScript Object Notation"}
   {:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "XML"}],
    :id "nlp/f/entity/wd:2115",
    :salienceLevel "mention",
    :label "Extensible Markup Language"}
   {:mentions [{:text "Lisp"}],
    :id "nlp/f/entity/wd:132874",
    :salienceLevel "mention",
    :label "Lisp"}
   {:mentions [{:text "Java"}],
    :id "nlp/f/entity/wd:251",
    :salienceLevel "mention",
    :label "Java"}],
  :alternate
  [{:href
    "https://juxt.pro/blog/posts/we-need-to-talk-about-json.html",
    :type "text/html"}],
  :title "We need to talk about JSON",
  :author "The JUXT Blog",
  :published-str "Thu Aug 15 07:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16c95ee1d11:90992f:340e5e89",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url "https://juxt.pro/img/guy-steele.png",
   :width 906,
   :height 427,
   :contentType "image/png"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://juxt.pro/blog/posts/we-need-to-talk-about-json.html",
  :commonTopics
  [{:score 104.863654161687,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1565877600000,
  :fingerprint "5c28d09f",
  :canonicalUrl
  "https://juxt.pro/blog/posts/we-need-to-talk-about-json.html"}
 {:engagement 13,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1565864770236,
  :content
  {:content
   "<p>All the posts so far..</p>\n<ul>\n<li><a href=\"http://codeofrob.com/entries/introducing-pinto-and-stetson---opinionated-purescript-bindings-to-otp-and-cowboy.html\">Introduction to Pinto/Stetson - Opinionated Bindings to OTP/Cowboy</a></li>\n</ul>\n<p>Useful links</p>\n<ul>\n<li><a href=\"https://github.com/id3as/demo-ps\">demo-ps</a> The demo codebase we're talking about here</li>\n<li><a href=\"https://github.com/id3as/purescript-erl-pinto\">erl-pinto</a> (the opinionated bindings to OTP we're using)</li>\n<li><a href=\"https://github.com/id3as/purescript-erl-stetson\">erl-stetson</a> (the opinionated bindings to Cowbou we're using)</li>\n</ul>\n<h1>The structure of an end-to-end Purescript OTP project</h1>\n<p>Our <a href=\"https://github.com/id3as/demo-ps\">demo-ps</a> can be viewed as two separate chunks of code, the base layer is just a plain old Erlang application built using rebar3 and such, and then on top of that we have a pile of Purescript that compiles into Erlang that can then be compiled and used by the usual development workflow.</p>\n<h1>The Erlangy bits</h1>\n<ul>\n<li><em>release-files</em>: Assets to be shipped during the release process</li>\n<li><em>src</em>: This is usually where the Erlang application lives, but there is no Erlang code<ul>\n<li><em>demo_ps.app.src</em>: The entry point, just points at a Purescript module, we'll talk about that</li>\n</ul>\n</li>\n<li><em>rebar.config</em>: Erlang dependencies and such</li>\n<li><em>priv</em>: Assets/files we want access to from code (static html/js/etc is covered here)</li>\n</ul>\n<h1>The purescript bits</h1>\n<ul>\n<li><em><a href=\"https://github.com/id3as/demo-ps/tree/master/server\">server</a></em>: The Purescript application that we want to compile into Erlang lives here</li>\n<li><em><a href=\"https://github.com/id3as/demo-ps/tree/master/client\">client</a></em>: The Purescript application we want to compile into JS lives here</li>\n<li><em>Makefile</em>: Turns the Purescript into JS/Erlang</li>\n<li><em>shared</em>: Contains Purescript we'll share between JS/Erlang</li>\n</ul>\n<p>In an ideal world, we'd just have a single Purescript entry point and forego our interaction with the Erlang world, but this would involve building out a lot more tooling - the result of this, is that sometimes you will be bringing Purescript dependencies down that require Erlang dependencies and then adding these to rebar.config and the entry point will be your responsibility.</p>\n<p>The purescript dependencies can be found in in <em>psc-package.json</em> inside the server and client directories, and the Erlang dependencies can be found in rebar.config at the top level.</p>\n<p>As a team already familiar with the Erlang ecosystem, this doesn't represent a hardship for us; but this definitely represents an area which could be improved by an enterprising developer or two, probably a plugin to the Purescript stack that stashes the rebar assets/etc in another build folder and allows us to just write PS/Erlang in the right place. (But this would then also involve modifying our editor plugins to know about this new structure, and as you can already see, it's a lot of work when we have something that is already functional..)</p>\n<h1>That entry point then</h1>\n<pre><code>{application, demo_ps,\n [{description, <span>&quot;An OTP application&quot;</span>},\n  {vsn, <span>&quot;0.1.0&quot;</span>},\n  {registered, []},\n  {mod, { bookApp@ps, []}},\n  {applications,\n   [kernel,\n    stdlib,\n    lager,\n    gproc,\n    recon,\n    cowboy,\n    jsx,\n    eredis\n   ]},\n  {env,[]},\n  {modules, []},\n  {maintainers, []},\n  {licenses, []},\n  {links, []}\n ]}.</code></pre>\n<p>One of the key things to note here, is that we have cowboy as a dependency, this is to support (as mentioned), the Purescript libraries that binds to it (<a href=\"https://github.com/id3as/purescript-erl-stetson\">stetson</a> and <a href=\"https://github.com/purerl/purescript-erl-cowboy\">erl-cowboy</a>. </p>\n<p>The other big note, is that entry point module is <em>'bookApp@ps'</em> - that module can be found in server/src/BookApp.purs, which defines a module <em>'BookApp'</em> - the Purescript compiler will compile Purescript modules into *@ps*, as this is unlikely to clash with anything else in the global application namespace. Beyond this entry point there is no Erlang code in the application itself - it's Purescript all the way down...</p>\n<p>The Makefile in <em>server/Makefile</em> does the work of compiling this Purescript into Erlang that can then be compiled by the usual rebar3 toolchain. The gist of the below Makefile being that we take all the .purs files lying around in the 'server' folder, and compile them into .erl files that end up in ../../src/compiled_ps.</p>\n<p>We'll go into detail on the Purescript stuff in the next post, as that's the key; we put a pile of Erlang supporting files in the right location, and then write PS in the other location and everything &quot;just kinda works&quot;.</p>",
   :direction "ltr"},
  :updated 1565861400000,
  :alternate
  [{:href
    "http://codeofrob.com/entries/the-structure-of-an-end-to-end-purescript-otp-project.html",
    :type "text/html"}],
  :title "The structure of an end-to-end Purescript OTP project",
  :author "Rob Ashton",
  :published-str "Thu Aug 15 02:30:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16c94d03abc:6f3e1a:fd909f4f",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "http://codeofrob.com/entries/the-structure-of-an-end-to-end-purescript-otp-project.html",
  :commonTopics
  [{:score 94.19036360948124,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.841,
    :id "nlp/f/topic/1743",
    :salienceLevel "mention",
    :label "philosophy"}
   {:score 0.754,
    :id "nlp/f/topic/774",
    :salienceLevel "mention",
    :label "engineering"}],
  :published 1565861400000,
  :fingerprint "1e71c426",
  :canonicalUrl
  "http://codeofrob.com/entries/the-structure-of-an-end-to-end-purescript-otp-project.html"}
 {:engagement 9,
  :unread false,
  :crawled 1565848560796,
  :content
  {:content
   "<p>A few people have asked me how to develop Level 3 thinking. I’m not sure. But I’ve got some directions to try. In this episode, I go over 3 and a half ways to develop algebraic thinking.</p>\n<p></p>\n<h2>Transcript</h2>\n<p>Eric Normand: How do you develop algebraic thinking? By the end of this episode, you should have three or maybe four different approaches to it. My name is Eric Normand. I help people thrive with functional programming.</p>\n<p>I’ve been getting a bunch of questions along the lines of, “How do I develop level three thinking?” I’m writing a book. To do that, it’s part of writing the book. It’s a book about functional programming.</p>\n<p>I’m trying to organize the material. Functional programming is a big, broad field. I have to choose what to teach and what not to teach. I’ve organized functional programming into three levels. I probably should call it functional thinking.</p>\n<p>The first level is where you are able to distinguish actions from calculations and data. You can spot side effects. You’re pretty good with immutability. You know how to solve problems without resorting to side effects like global immutable variables, things like that. You can move stuff around and isolate the calculation from the action, that kind of thing.</p>\n<p>Level two gets a little bit more sophisticated. You’re able to do higher order thinking. You’re using higher order functions, higher order actions. You’re using first class actions and even first class state if you need to. This lets you do stuff like data transformation pipelines with map filter and reduce, things like that.</p>\n<p>Then there’s level three which is what we’re talking about today. This I’m calling algebraic thinking. I’ve also thought about calling it…Because algebraic thinking just brings up all sorts of questions like why algebra? This isn’t high school math, those kinds of associations with the term algebra. It’s about building composable models.</p>\n<p>This may be a better way of talking about it but it’s a third level where you’re building very robust abstractions and basically algebras. Which I explained in the last episode so you should look that up.</p>\n<p>I’ve been getting a bunch of questions about how to develop this. Now this whole show has been me exploring these ideas so that I can figure out how to put them into the book and so this is another exploration. I’m not sure. I don’t know.</p>\n<p>This part is the last part of the book. It is the part that I have worked on the least and so these are really rough. Which is cool, you get to see them really early.</p>\n<p>Here are three approaches to self-study to get to level three. Here we go. The first one I’m going to bring up is property-based testing. You’re probably familiar with unit testing or example-based testing where you give some arguments to a function and tell the system what to expect and that’s your test. You give specific values.</p>\n<p>In property-based testing you don’t give specific values, those are generated randomly and you have to give a function basically that will tell the system whether the system under test got the right answer. This is called property-based testing because you’re developing properties — like algebraic properties — that your function must obey, must uphold.</p>\n<p>Let’s just really quick because I don’t want to teach property-based testing right now. I just want to give it as an example. If you were going to test the Sort function, like you write a new Sort, you could test that with two properties. One is that the returned list — you call Sort and you get a list back — that that list is in order.</p>\n<p>There’s another property you need which is that the return list is a permutation of the argument that you pass to Sort, the input list.</p>\n<p>With those two properties you kind of covered the whole behavior of that function. You could test it with examples. You could give it the empty list. The empty list, sorting the empty list gives you empty list. Sorting a one gives you a one.</p>\n<p>Sorting the list 2-1 gives you the list 1-2. You could give all the examples, but you never have to think higher order. You have somewhere in the back of your mind that it’s got to be the same elements. You have somewhere in the back of your mind that it’s got to be sorted when it comes out.</p>\n<p>What you haven’t thought about how to write that down. How do you actually write a test that says for any input list, the output list is in order? What does it mean to be in order? How do I test that it is actually in order?</p>\n<p>Likewise, how do I test that this list is a permutation of another list? How do I write that down? Those kinds of thinking where you have to deal with not just a given list, but every list. Any list. Each and every list. That is the kind of thinking that gets you to that next level.</p>\n<p>It’s like first order logic. It’s not just A and B, it’s for all A. It’s a different level of thinking. By doing property-based testing I think you really force your mind to go there, because it’s all mental stuff. It’s all mental skills. I’m not talking about some very concrete thing, it’s all in your head.</p>\n<p>Very related, that’s number two, is algebraic properties. There’s a lot of talk in the functional programming world about categories, category theory. This is similar reason to learn them, to learn categories as well as algebraic properties. Same idea.</p>\n<p>They are very succinct truths about certain operations. They’re expressed in very small formulas. They’re relationships between a function and itself, or a function and another function. As an example, I could say a function F is commutative if F of A and B is equal to F of B and A.</p>\n<p>To relationship, it’s an equality, and it’s of that one function F with itself. It relates how this function should operate in a totally abstract sense. We didn’t say what A was. We didn’t say what B was. We’re basically saying for all A and all B that are valid arguments to that function, then this should be true.</p>\n<p>We’re thinking at a more abstract level, at an algebraic level, where you can start talking about F of A and B. You don’t have to say F of one and seven, those are very specific numbers. You’re talking about all numbers, A and B, or any numbers A and B.</p>\n<p>It’s the same thinking, but it’s a different approach. You study algebra, you start to see that things can have meaning without being specific.</p>\n<p>Addition, you can say A+B because you’ve been to algebra class. You sat through it, you did all the exercises, and now you get that there’s stuff that you know about A+B, even though you don’t know A or B.</p>\n<p>That’s the kind of thinking that you need to get, to get to level three. Another one, the third one. This one is much more difficult material, but it is material. It is something I can link you to that you can watch. Whereas, the other two are a little bit more general concepts.</p>\n<p>The third thing is called denotational design. This is basically some talks and some papers by Conal Elliott. He’s big in the Haskell community. He gave a really good talk. It’s like a workshop. It’s 2 hours and 20 minutes of him stepping through his thought process, which he calls denotational design for building a graphics system.</p>\n<p>I’ve watched it many times. [laughs] I think that that is the best resource available for understanding the mindset from first principles designing something like that. Some notable things about it. The first one is that he’s working with the type signatures of the functions.</p>\n<p>The function signatures, what arguments does it take, what does it return, totally never shows a single implementation of what an image is. The fact that he can walk through slide after slide of code with no implementation. He’s just showing the function signatures. That is the level you need to get to.</p>\n<p>I have a whole thing on types which I’m about to say after I finish with denotational design. I’m not saying you need types. I’m not. What I’m saying is that he was thinking at the level of this function does this. I can talk about it and how it behaves without showing the implementation.</p>\n<p>He starts from first principles, he builds a type for the image, what is an image, and then he starts showing how you could implement a combinator that acts on the image. How do we overlay two images? How do we have a mask where a shape, a region is shown through and then the rest isn’t shown?</p>\n<p>How do we add a background color, a certain transparent color? All these operations he does show how they are simply implemented, as long as you have this very simple notion. Simple, but elegant simple. It’s a very elegant notion of what an image is.</p>\n<p>You never know how he’d implemented image, which is where you need to get to. You need to be able to think about the operations on image, without thinking about the concrete implementation. In his system, an image isn’t an array of pixels because you’ve already limited yourself to a certain representation.</p>\n<p>He has said, “Let’s not even implement it yet, so that we can talk about the kinds of operations we want to be able to do in the abstract.” You notice I’m trying to get at something almost ineffable without using the term algebra. [laughs]</p>\n<p>With all these three examples, the property-based testing, the algebraic properties, the denotational design, you’re able to think about the system without caring about how it’s implemented. That’s the algebra part. You’re thinking in this static reasoning. You can look at the expressions that you can build out of this algebra and reason about them.</p>\n<p>A couple of people asked if this was something that types help with. I mentioned that Conal Elliott uses the types to talk about functions without having to implement them. I don’t want to get into the typed versus untyped debate. Not in this episode. I don’t think that types are necessary in the language you write them in. I think that this is all stuff that’s happening here.</p>\n<p>What the types do help you with though, if you used a strongly typed language, a statically typed, strongly-typed language, like Haskell, what you get is the discipline for free. You are forced to internalize the type system. What you’re internalizing that helps is a few things that helps with this kind of thinking. One is the case-based thinking.</p>\n<p>In Haskell, if you have multiple cases in your algebraic data type, there’s a warning or you can turn it into an error if you forget on your cases. I suggest turning it into an error so you always have to deal with all the cases.</p>\n<p>What that makes you do is make sure that you’re covering the whole thing, that you create a total function. At least it helps. It makes you think about that. I’m going to make this function work for all values of this type. That is something that I see people not doing in the untyped world that they could learn better from. They’ll have to do it themselves [laughs] with internal discipline. Sit and really make sure that all the bases are covered.</p>\n<p>The function works for all values because you don’t want corner cases. That messes up your algebra. Another thing is pushing information into the type. What do I mean by that? Some functions don’t work for negative numbers. There’s no built-in type in Haskell for non-negative numbers, but you can make one and it wouldn’t be hard. It’s a common exercise to do. It’s a few lines. Then you have this type that represents non-negative numbers.</p>\n<p>What is a little harder and speaks to the level three thinking — algebraic thinking — is to realize that when you’re using that type you don’t really need to care where it came from. It came from somewhere.</p>\n<p>When I’m programming this function, when I’m implementing this function and it has that type, it’s a function that takes a non-negative integer, I don’t have to care where it came from. I’m not thinking about that. I just know that this type guarantees x, y, z.</p>\n<p>I’m pushing that information into the type. That kind of encapsulation is also part of it. That I don’t really have to worry about where it comes from. I can let that be for now. I’m encapsulating that knowledge. This function’s functionality.</p>\n<p>Conal Elliot once said that one of the cool things about numbers and one of the reason why they’re so useful is if you have the number seven, you can’t know how you got that seven. You don’t know if it was 3+4, or 5+2, or 1+6, or 14*0.5, or whatever. You don’t know where it came from. It’s equal to every other seven, regardless of where it came from.</p>\n<p>That’s it. That’s level three. [laughs] I don’t know how else to say it. If you’re thinking in those terms, I don’t care where this come from, I don’t care how it got generated, that is level three.</p>\n<p>To bring back the video example, I’ve been developing this example over several episodes. When I’m concatenating two videos, I don’t care where the videos came from. I want to be able to concatenate them, regardless of where they came from. I shouldn’t care. That is what I’m talking about, where you don’t care where it came from.</p>\n<p>If you start in the wrong place, you could say, “Well, a video is a file on disc that has a sequence of frames.” Now when I’m developing concatenate, I brought all of this concrete stuff to concatenate. I might think, to implement concatenate, I open up a new file, copy the existing frames, and then add the other frames to the end of it.</p>\n<p>You’ve already lost the abstract game. We do that. Before level three, we do that way too much, where we’re actually thinking about how to implement it way too fast. Way before we’ve thought about, what should it mean, what should it do, how does it relate to the other operations that are allowed.</p>\n<p>This is a thing that I’ve experienced in Haskell where, if the type starts getting complicated, then you know you’ve got a problem. If you’ve got seven fields on your type, now there’s something wrong. You’re not really doing this kind of algebraic thinking.</p>\n<p>The type has become too complex, it’s going to be impossible to do this kind of smooth, elegant algebra anymore. When you push information into the type, you got a signal for how complex the thing is. That’s really all I’ve got about to how to get to level three.</p>\n<p>Part of it is pointing at it. Trying to point out to people who are not there and part of it is to try to use things that are there that you could go learn right now that will help you, that will help you get the ideas to get there.</p>\n<p>My challenge as the author of the book that’s trying to get people there is to come up with good examples, good scenarios where this is useful. [laughs] It’s not just some abstract notion and also the exercises will get you there. You could see the benefit because it is a feeling. It’s not something. There’s a gray line that you cross.</p>\n<p>At some point, you think, “Wow, this is a really solid algebra. No corner cases, very small and elegant. I can think abstractly about it.” It’s just some invisible line that you cross at some point.</p>\n<p>If you like this episode, you can find all the old past episodes at lispcast.com/podcast. There you’ll find audio, video, and text versions of all the episodes. You’ll also find links to subscribe whether it’s on your podcast player or YouTube or however you want to consume it. Also links to social media where you can get in discussion with me.</p>\n<p>That’s all I’ve got. This has been my thought on functional programming. I’m Eric Normand. Thank you for being there and rock on.</p>\n<p>The post <a rel=\"nofollow\" href=\"https://lispcast.com/how-do-you-develop-algebraic-thinking/\">How do you develop algebraic thinking?</a> appeared first on <a rel=\"nofollow\" href=\"https://lispcast.com\">LispCast</a>.</p>",
   :direction "ltr"},
  :updated 1565845200000,
  :entities
  [{:mentions [{:text "type"} {:text "data type"}],
    :id "nlp/f/entity/wd:190087",
    :salienceLevel "mention",
    :label "data type"}
   {:mentions [{:text "functional programming"}],
    :id "nlp/f/entity/wd:193076",
    :salienceLevel "mention",
    :label "functional programming"}
   {:mentions [{:text "Haskell"}],
    :id "nlp/f/entity/wd:34010",
    :salienceLevel "mention",
    :label "Haskell"}
   {:mentions [{:text "Sort"}],
    :id "nlp/f/entity/wd:12690",
    :salienceLevel "mention",
    :label "Sort"}
   {:mentions [{:text "unit testing"}],
    :id "nlp/f/entity/wd:907375",
    :salienceLevel "mention",
    :label "unit testing"}],
  :alternate
  [{:href
    "https://lispcast.com/how-do-you-develop-algebraic-thinking/",
    :type "text/html"}],
  :title "How do you develop algebraic thinking?",
  :author "Eric Normand",
  :published-str "Wed Aug 14 22:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16c93d8e49c:63f666:340e5e89",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url
   "https://lispcast.com/wp-content/uploads/2019/08/How-do-you-develop-algebraic-thinking_.jpg",
   :width 1280,
   :height 720,
   :contentType "image/jpeg"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://lispcast.com/?p=1977",
  :commonTopics
  [{:score 33.16057259953728,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.903,
    :id "nlp/f/topic/1421",
    :salienceLevel "about",
    :label "math education"}],
  :published 1565845200000,
  :fingerprint "f141a641",
  :canonicalUrl
  "https://lispcast.com/how-do-you-develop-algebraic-thinking/"}
 {:engagement 190,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1565810737953,
  :content
  {:content
   "<p>There is a lot of hype around functional programming(FP) and a lot of cool kids are doing it but it is not a silver bullet. Like other programming paradigms/styles, functional programming also has its pros and cons and one may prefer one paradigm over the other. If you are a Go developer and wants to venture into functional programming, do not worry, you don't have to learn functional programming oriented languages like Haskell or Clojure(or even Scala or JavaScript though they are not pure functional programming languages) since Go has you covered and this post is for you.</p>\n<p>If you are looking for functional programming in Java then check this out</p>\n<div>\n<a href=\"https://dev.to/deepu105\">\n<div>\n<img alt=\"deepu105 image\" src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--SrOpDDUH--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://res.cloudinary.com/practicaldev/image/fetch/s--r6ed2tD---/c_fill%2Cf_auto%2Cfl_progressive%2Ch_150%2Cq_auto%2Cw_150/https://thepracticaldev.s3.amazonaws.com/uploads/user/profile_image/178939/20b6c844-abd4-48c5-ac47-dbaaa30cce9d.jpeg\">\n</div>\n</a>\n<a href=\"https://dev.to/deepu105/functional-programming-in-java-a-primer-13nb\">\n<div>\n<h2>7 Functional programming techniques in Java - A primer</h2>\n<h3>Deepu K Sasidharan ・ Jul 30 ・ 10 min read</h3>\n<div>\n<span>#java</span>\n<span>#functional</span>\n<span>#beginners</span>\n<span>#programming</span>\n</div>\n</div>\n</a>\n</div>\n<p>I'm not gonna dive into all functional programming concepts in detail, instead, I'm gonna focus on things that you can do in Go which are in line with functional programming concepts. I'm also not gonna discuss the pros and cons of functional programming in general.</p>\n<h2>\n<a href=\"https://dev.to/feed#what-is-functional-programming\">\n</a>\nWhat is functional programming?\n</h2>\n<p>As per Wikipedia, </p>\n<blockquote>\n<p>Functional programming is a programming paradigm—a style of building the structure and elements of computer programs—that treats computation as the evaluation of mathematical functions and avoids changing-state and mutable data. </p>\n</blockquote>\n<p>Hence in functional programming, there are two very important rules</p>\n<ul>\n<li>\n<strong>No Data mutations</strong>: It means a data object should not be changed after it is created.</li>\n<li>\n<strong>No implicit state</strong>: Hidden/Implicit state should be avoided. In functional programming state is not eliminated, instead, its made visible and explicit</li>\n</ul>\n<p>This means:</p>\n<ul>\n<li>\n<strong>No side effects</strong>: A function or operation should not change any state outside of its functional scope. I.e, A function should only return a value to the invoker and should not affect any external state. This means programs are easier to understand.</li>\n<li>\n<strong>Pure functions only</strong>: Functional code is idempotent. A function should return values only based on the arguments passed and should not affect(side-effect) or depend on global state. Such functions always produce the same result for the same arguments.</li>\n</ul>\n<p>Apart from these there are functional programming concepts below that can be applied in Go, we will touch upon these further down.</p>\n<ul>\n<li><a href=\"https://en.wikipedia.org/wiki/Higher-order_function\">Higher-order-functions</a></li>\n<li><a href=\"https://en.wikipedia.org/wiki/Closure_(computer_programming)\">Closures</a></li>\n<li><a href=\"https://en.wikipedia.org/wiki/Currying\">Currying</a></li>\n<li><a href=\"https://en.wikipedia.org/wiki/Recursion_(computer_science)\">Recursion</a></li>\n<li><a href=\"https://en.wikipedia.org/wiki/Evaluation_strategy\">Lazy evaluations</a></li>\n<li>\n<a href=\"https://en.wikipedia.org/wiki/Referential_transparency\">Referential transparency</a> </li>\n</ul>\n<p>Using functional programming doesn't mean its all or nothing, you can always use functional programming concepts to complement Object-oriented or imperative concepts in Go. The benefits of functional programming can be utilized whenever possible regardless of the paradigm or language you use. And that is exactly what we are going to see.</p>\n<h2>\n<a href=\"https://dev.to/feed#functional-programming-in-go\">\n</a>\nFunctional programming in Go\n</h2>\n<p>Golang is a multi-paradigm language so let us see how we can apply some of the functional programming concepts above in Go.</p>\n<h3>\n<a href=\"https://dev.to/feed#firstclass-and-higherorder-functions\">\n</a>\nFirst-class and higher-order functions\n</h3>\n<p>First-class functions(function as a first-class citizen) means you can assign functions to variables, pass a function as an argument to another function or return a function from another. Go supports this and hence makes concepts like closures, currying, and higher-order-functions easy to write. </p>\n<p>A function can be considered as a higher-order-function only if it takes one or more functions as parameters or if it returns another function as a result.</p>\n<p>In Go, this is quite easy to do<br>\n</p>\n<div><pre><code><span>func</span> <span>main</span><span>()</span> <span>{</span>\n    <span>var</span> <span>list</span> <span>=</span> <span>[]</span><span>string</span><span>{</span><span>&quot;Orange&quot;</span><span>,</span> <span>&quot;Apple&quot;</span><span>,</span> <span>&quot;Banana&quot;</span><span>,</span> <span>&quot;Grape&quot;</span><span>}</span>\n    <span>// we are passing the array and a function as arguments to mapForEach method.</span>\n    <span>var</span> <span>out</span> <span>=</span> <span>mapForEach</span><span>(</span><span>list</span><span>,</span> <span>func</span><span>(</span><span>it</span> <span>string</span><span>)</span> <span>int</span> <span>{</span>\n        <span>return</span> <span>len</span><span>(</span><span>it</span><span>)</span>\n    <span>})</span>\n    <span>fmt</span><span>.</span><span>Println</span><span>(</span><span>out</span><span>)</span> <span>// [6, 5, 6, 5]</span>\n\n<span>}</span>\n\n<span>// The higher-order-function takes an array and a function as arguments</span>\n<span>func</span> <span>mapForEach</span><span>(</span><span>arr</span> <span>[]</span><span>string</span><span>,</span> <span>fn</span> <span>func</span><span>(</span><span>it</span> <span>string</span><span>)</span> <span>int</span><span>)</span> <span>[]</span><span>int</span> <span>{</span>\n    <span>var</span> <span>newArray</span> <span>=</span> <span>[]</span><span>int</span><span>{}</span>\n    <span>for</span> <span>_</span><span>,</span> <span>it</span> <span>:=</span> <span>range</span> <span>arr</span> <span>{</span>\n        <span>// We are executing the method passed</span>\n        <span>newArray</span> <span>=</span> <span>append</span><span>(</span><span>newArray</span><span>,</span> <span>fn</span><span>(</span><span>it</span><span>))</span>\n    <span>}</span>\n    <span>return</span> <span>newArray</span>\n<span>}</span>\n</code></pre></div>\n<p>Closures and currying are also possible in Go<br>\n</p>\n<div><pre><code><span>// this is a higher-order-function that returns a function</span>\n<span>func</span> <span>add</span><span>(</span><span>x</span> <span>int</span><span>)</span> <span>func</span><span>(</span><span>y</span> <span>int</span><span>)</span> <span>int</span> <span>{</span>\n    <span>// A function is returned here as closure</span>\n    <span>// variable x is obtained from the outer scope of this method and memorized in the closure</span>\n    <span>return</span> <span>func</span><span>(</span><span>y</span> <span>int</span><span>)</span> <span>int</span> <span>{</span>\n        <span>return</span> <span>x</span> <span>+</span> <span>y</span>\n    <span>}</span>\n<span>}</span>\n\n<span>func</span> <span>main</span><span>()</span> <span>{</span>\n\n    <span>// we are currying the add method to create more variations</span>\n    <span>var</span> <span>add10</span> <span>=</span> <span>add</span><span>(</span><span>10</span><span>)</span>\n    <span>var</span> <span>add20</span> <span>=</span> <span>add</span><span>(</span><span>20</span><span>)</span>\n    <span>var</span> <span>add30</span> <span>=</span> <span>add</span><span>(</span><span>30</span><span>)</span>\n\n    <span>fmt</span><span>.</span><span>Println</span><span>(</span><span>add10</span><span>(</span><span>5</span><span>))</span> <span>// 15</span>\n    <span>fmt</span><span>.</span><span>Println</span><span>(</span><span>add20</span><span>(</span><span>5</span><span>))</span> <span>// 25</span>\n    <span>fmt</span><span>.</span><span>Println</span><span>(</span><span>add30</span><span>(</span><span>5</span><span>))</span> <span>// 35</span>\n<span>}</span>\n</code></pre></div>\n<p>There are also many built-in higher-order-functions in Go standard libraries. There are also some functional style libraries like <a href=\"https://github.com/wesovilabs/koazee\">this</a> and <a href=\"https://github.com/yanatan16/itertools\">this</a> offering map-reduce like functional methods in Go.</p>\n<h3>\n<a href=\"https://dev.to/feed#pure-functions\">\n</a>\nPure functions\n</h3>\n<p>As we saw already a pure function should return values only based on the arguments passed and should not affect or depend on global state. It is possible to do this in Go easily. </p>\n<p>This is quite simple, take the below this is a pure function. It will always return the same output for the given input and its behavior is highly predictable. We can safely cache the method if needed.<br>\n</p>\n<div><pre><code><span>func</span> <span>sum</span><span>(</span><span>a</span><span>,</span> <span>b</span> <span>int</span><span>)</span> <span>int</span> <span>{</span>\n    <span>return</span> <span>a</span> <span>+</span> <span>b</span>\n<span>}</span>\n</code></pre></div>\n<p>If we add an extra line in this function, the behavior becomes unpredictable as it now has a side effect that affects an external state.<br>\n</p>\n<div><pre><code><span>var</span> <span>holder</span> <span>=</span> <span>map</span><span>[</span><span>string</span><span>]</span><span>int</span><span>{}</span>\n\n<span>func</span> <span>sum</span><span>(</span><span>a</span><span>,</span> <span>b</span> <span>int</span><span>)</span> <span>int</span> <span>{</span>\n    <span>c</span> <span>:=</span> <span>a</span> <span>+</span> <span>b</span>\n    <span>holder</span><span>[</span><span>fmt</span><span>.</span><span>Sprintf</span><span>(</span><span>&quot;%d+%d&quot;</span><span>,</span> <span>a</span><span>,</span> <span>b</span><span>)]</span> <span>=</span> <span>c</span>\n    <span>return</span> <span>c</span>\n<span>}</span>\n</code></pre></div>\n<p>So try to keep your functions pure and simple.</p>\n<h3>\n<a href=\"https://dev.to/feed#recursion\">\n</a>\nRecursion\n</h3>\n<p>Functional programming favors recursion over looping. Let us see an example for calculating the factorial of a number.</p>\n<p>In traditional iterative approach:<br>\n</p>\n<div><pre><code><span>func</span> <span>factorial</span><span>(</span><span>num</span> <span>int</span><span>)</span> <span>int</span> <span>{</span>\n    <span>result</span> <span>:=</span> <span>1</span>\n    <span>for</span> <span>;</span> <span>num</span> <span>></span> <span>0</span><span>;</span> <span>num</span><span>--</span> <span>{</span>\n        <span>result</span> <span>*=</span> <span>num</span>\n    <span>}</span>\n    <span>return</span> <span>result</span>\n<span>}</span>\n\n<span>func</span> <span>main</span><span>()</span> <span>{</span>\n    <span>fmt</span><span>.</span><span>Println</span><span>(</span><span>factorial</span><span>(</span><span>20</span><span>))</span> <span>// 2432902008176640000</span>\n<span>}</span>\n</code></pre></div>\n<p>The same can be done using recursion as below which is favored in functional programming.<br>\n</p>\n<div><pre><code><span>func</span> <span>factorial</span><span>(</span><span>num</span> <span>int</span><span>)</span> <span>int</span> <span>{</span>\n    <span>if</span> <span>num</span> <span>==</span> <span>0</span> <span>{</span>\n        <span>return</span> <span>1</span>\n    <span>}</span>\n    <span>return</span> <span>num</span> <span>*</span> <span>factorial</span><span>(</span><span>num</span><span>-</span><span>1</span><span>)</span>\n<span>}</span>\n<span>func</span> <span>main</span><span>()</span> <span>{</span>\n    <span>fmt</span><span>.</span><span>Println</span><span>(</span><span>factorial</span><span>(</span><span>20</span><span>))</span> <span>// 2432902008176640000</span>\n<span>}</span>\n</code></pre></div>\n<p>The downside of the recursive approach is that it will be slower compared to an iterative approach most of the times(The advantage we are aiming for is code simplicity and readability) and might result in stack overflow errors since every function call needs to be saved as a frame to the stack. To avoid this tail recursion is preferred, especially when the recursion is done too many times. In tail recursion, the recursive call is the last thing executed by the function and hence the functions stack frame need not be saved by the compiler. Most compilers can optimize the tail recursion code the same way iterative code is optimized hence avoiding the performance penalty. Go compiler, unfortunately, does not do this optimization.</p>\n<p>Now using tail recursion the same function can be written as below, but Go doesn't optimize this, though there are <a href=\"https://www.reddit.com/r/golang/comments/3vndco/why_no_tail_call_elimination/cxphgqe/\">workarounds</a>, still it performed better in benchmarks.<br>\n</p>\n<div><pre><code><span>func</span> <span>factorialTailRec</span><span>(</span><span>num</span> <span>int</span><span>)</span> <span>int</span> <span>{</span>\n    <span>return</span> <span>factorial</span><span>(</span><span>1</span><span>,</span> <span>num</span><span>)</span>\n<span>}</span>\n\n<span>func</span> <span>factorial</span><span>(</span><span>accumulator</span><span>,</span> <span>val</span> <span>int</span><span>)</span> <span>int</span> <span>{</span>\n    <span>if</span> <span>val</span> <span>==</span> <span>1</span> <span>{</span>\n        <span>return</span> <span>accumulator</span>\n    <span>}</span>\n    <span>return</span> <span>factorial</span><span>(</span><span>accumulator</span><span>*</span><span>val</span><span>,</span> <span>val</span><span>-</span><span>1</span><span>)</span>\n<span>}</span>\n\n<span>func</span> <span>main</span><span>()</span> <span>{</span>\n    <span>fmt</span><span>.</span><span>Println</span><span>(</span><span>factorialTailRec</span><span>(</span><span>20</span><span>))</span> <span>// 2432902008176640000</span>\n<span>}</span>\n</code></pre></div>\n<p>I ran some benchmarks with all 3 approaches and here is the result, as you can see looping is still the most performing followed by the tail recursion.<br>\n</p>\n<div><pre><code>goos: linux\ngoarch: amd64\nBenchmarkFactorialLoop-12           100000000           11.7 ns/op         0 B/op          0 allocs/op\nBenchmarkFactorialRec-12            30000000            52.9 ns/op         0 B/op          0 allocs/op\nBenchmarkFactorialTailRec-12        50000000            44.2 ns/op         0 B/op          0 allocs/op\nPASS\nok      _/home/deepu/workspace/deepu105.github.io/temp  5.072s\nSuccess: Benchmarks passed.\n</code></pre></div>\n<p>Consider using recursion when writing Go code for readability and immutability, but if performance is critical or if the number of iterations will be huge use standard loops.</p>\n<h3>\n<a href=\"https://dev.to/feed#lazy-evaluation\">\n</a>\nLazy evaluation\n</h3>\n<p>Lazy evaluation or non-strict evaluation is the process of delaying evaluation of an expression until it is needed. In general, Go does strict/eager evaluation but for operands like <code>&amp;&amp;</code> and <code>||</code> it does a lazy evaluation. We can utilize higher-order-functions, closures, goroutines, and channels to emulate lazy evaluations.</p>\n<p>Take this example where Go eagerly evaluates everything.<br>\n</p>\n<div><pre><code><span>func</span> <span>main</span><span>()</span> <span>{</span>\n    <span>fmt</span><span>.</span><span>Println</span><span>(</span><span>addOrMultiply</span><span>(</span><span>true</span><span>,</span> <span>add</span><span>(</span><span>4</span><span>),</span> <span>multiply</span><span>(</span><span>4</span><span>)))</span>  <span>// 8</span>\n    <span>fmt</span><span>.</span><span>Println</span><span>(</span><span>addOrMultiply</span><span>(</span><span>false</span><span>,</span> <span>add</span><span>(</span><span>4</span><span>),</span> <span>multiply</span><span>(</span><span>4</span><span>)))</span> <span>// 16</span>\n<span>}</span>\n\n<span>func</span> <span>add</span><span>(</span><span>x</span> <span>int</span><span>)</span> <span>int</span> <span>{</span>\n    <span>fmt</span><span>.</span><span>Println</span><span>(</span><span>&quot;executing add&quot;</span><span>)</span> <span>// this is printed since the functions are evaluated first</span>\n    <span>return</span> <span>x</span> <span>+</span> <span>x</span>\n<span>}</span>\n\n<span>func</span> <span>multiply</span><span>(</span><span>x</span> <span>int</span><span>)</span> <span>int</span> <span>{</span>\n    <span>fmt</span><span>.</span><span>Println</span><span>(</span><span>&quot;executing multiply&quot;</span><span>)</span> <span>// this is printed since the functions are evaluated first</span>\n    <span>return</span> <span>x</span> <span>*</span> <span>x</span>\n<span>}</span>\n\n<span>func</span> <span>addOrMultiply</span><span>(</span><span>add</span> <span>bool</span><span>,</span> <span>onAdd</span><span>,</span> <span>onMultiply</span> <span>int</span><span>)</span> <span>int</span> <span>{</span>\n    <span>if</span> <span>add</span> <span>{</span>\n        <span>return</span> <span>onAdd</span>\n    <span>}</span>\n    <span>return</span> <span>onMultiply</span>\n<span>}</span>\n</code></pre></div>\n<p>This will produce the below output and we can see that both functions are executed always<br>\n</p>\n<div><pre><code>executing add\nexecuting multiply\n8\nexecuting add\nexecuting multiply\n16\n</code></pre></div>\n<p>We can use higher-order-functions to rewrite this into a lazily evaluated version<br>\n</p>\n<div><pre><code><span>func</span> <span>add</span><span>(</span><span>x</span> <span>int</span><span>)</span> <span>int</span> <span>{</span>\n    <span>fmt</span><span>.</span><span>Println</span><span>(</span><span>&quot;executing add&quot;</span><span>)</span>\n    <span>return</span> <span>x</span> <span>+</span> <span>x</span>\n<span>}</span>\n\n<span>func</span> <span>multiply</span><span>(</span><span>x</span> <span>int</span><span>)</span> <span>int</span> <span>{</span>\n    <span>fmt</span><span>.</span><span>Println</span><span>(</span><span>&quot;executing multiply&quot;</span><span>)</span>\n    <span>return</span> <span>x</span> <span>*</span> <span>x</span>\n<span>}</span>\n\n<span>func</span> <span>main</span><span>()</span> <span>{</span>\n    <span>fmt</span><span>.</span><span>Println</span><span>(</span><span>addOrMultiply</span><span>(</span><span>true</span><span>,</span> <span>add</span><span>,</span> <span>multiply</span><span>,</span> <span>4</span><span>))</span>\n    <span>fmt</span><span>.</span><span>Println</span><span>(</span><span>addOrMultiply</span><span>(</span><span>false</span><span>,</span> <span>add</span><span>,</span> <span>multiply</span><span>,</span> <span>4</span><span>))</span>\n<span>}</span>\n\n<span>// This is now a higher-order-function hence evaluation of the functions are delayed in if-else</span>\n<span>func</span> <span>addOrMultiply</span><span>(</span><span>add</span> <span>bool</span><span>,</span> <span>onAdd</span><span>,</span> <span>onMultiply</span> <span>func</span><span>(</span><span>t</span> <span>int</span><span>)</span> <span>int</span><span>,</span> <span>t</span> <span>int</span><span>)</span> <span>int</span> <span>{</span>\n    <span>if</span> <span>add</span> <span>{</span>\n        <span>return</span> <span>onAdd</span><span>(</span><span>t</span><span>)</span>\n    <span>}</span>\n    <span>return</span> <span>onMultiply</span><span>(</span><span>t</span><span>)</span>\n<span>}</span>\n</code></pre></div>\n<p>This outputs the below and we can see that only required functions were executed<br>\n</p>\n<div><pre><code>executing add\n8\nexecuting multiply\n16\n</code></pre></div>\n<p>There are also other ways of doing it using Sync &amp; Futures like <a href=\"https://blog.merovius.de/2015/07/17/lazy-evaluation-in-go.html\">this</a> and using channels and goroutines like <a href=\"https://gist.github.com/nickcarenza/0ac9057ad06036d1e934\">this</a>. Doing Lazy evaluations in Go might not be worth the code complexity most of the times, but if the functions in question are heavy in terms of processing then its is absolutely worth it to lazy evaluate them.</p>\n<h3>\n<a href=\"https://dev.to/feed#type-system\">\n</a>\nType system\n</h3>\n<p>Go has a strong type system and also has pretty decent type inference. The only thing missing compared to other functional programming languages are something like case classes and pattern matching.</p>\n<h3>\n<a href=\"https://dev.to/feed#referential-transparency\">\n</a>\nReferential transparency\n</h3>\n<p>From Wikipedia:</p>\n<blockquote>\n<p>Functional programs do not have assignment statements, that is, the value of a variable in a functional program never changes once defined. This eliminates any chances of side effects because any variable can be replaced with its actual value at any point of execution. So, functional programs are referentially transparent.</p>\n</blockquote>\n<p>Unfortunately, there are not many ways to strictly limit data mutation in Go, however by using pure functions and by explicitly avoiding data mutations and reassignment using other concepts we saw earlier this can be achieved. Go by default passes variables by value, except for slices and maps. So, avoid passing them by reference(using pointers) as much as possible.</p>\n<p>For example, the below will mutate external state as we are passing a parameter by reference and hence doesn't ensure referential transparency<br>\n</p>\n<div><pre><code><span>func</span> <span>main</span><span>()</span> <span>{</span>\n    <span>type</span> <span>Person</span> <span>struct</span> <span>{</span>\n        <span>firstName</span> <span>string</span>\n        <span>lastName</span>  <span>string</span>\n        <span>fullName</span>  <span>string</span>\n        <span>age</span>       <span>int</span>\n    <span>}</span>\n    <span>var</span> <span>getFullName</span> <span>=</span> <span>func</span><span>(</span><span>in</span> <span>*</span><span>Person</span><span>)</span> <span>string</span> <span>{</span>\n        <span>in</span><span>.</span><span>fullName</span> <span>=</span> <span>in</span><span>.</span><span>firstName</span> <span>+</span> <span>in</span><span>.</span><span>lastName</span> <span>// data mutation</span>\n        <span>return</span> <span>in</span><span>.</span><span>fullName</span>\n    <span>}</span>\n\n    <span>john</span> <span>:=</span> <span>Person</span><span>{</span>\n        <span>&quot;john&quot;</span><span>,</span> <span>&quot;doe&quot;</span><span>,</span> <span>&quot;&quot;</span><span>,</span> <span>30</span><span>,</span>\n    <span>}</span>\n\n    <span>fmt</span><span>.</span><span>Println</span><span>(</span><span>getFullName</span><span>(</span><span>&amp;</span><span>john</span><span>))</span> <span>// johndoe</span>\n    <span>fmt</span><span>.</span><span>Println</span><span>(</span><span>john</span><span>)</span> <span>// {john doe johndoe 30}</span>\n<span>}</span>\n</code></pre></div>\n<p>If we pass parameters by the value we can ensure referential transparency even if there is an accidental mutation of passed data within the function<br>\n</p>\n<div><pre><code><span>func</span> <span>main</span><span>()</span> <span>{</span>\n    <span>type</span> <span>Person</span> <span>struct</span> <span>{</span>\n        <span>firstName</span> <span>string</span>\n        <span>lastName</span>  <span>string</span>\n        <span>fullName</span>  <span>string</span>\n        <span>age</span>       <span>int</span>\n    <span>}</span>\n    <span>var</span> <span>getFullName</span> <span>=</span> <span>func</span><span>(</span><span>in</span> <span>Person</span><span>)</span> <span>string</span> <span>{</span>\n        <span>in</span><span>.</span><span>fullName</span> <span>=</span> <span>in</span><span>.</span><span>firstName</span> <span>+</span> <span>in</span><span>.</span><span>lastName</span>\n        <span>return</span> <span>in</span><span>.</span><span>fullName</span>\n    <span>}</span>\n\n    <span>john</span> <span>:=</span> <span>Person</span><span>{</span>\n        <span>&quot;john&quot;</span><span>,</span> <span>&quot;doe&quot;</span><span>,</span> <span>&quot;&quot;</span><span>,</span> <span>30</span><span>,</span>\n    <span>}</span>\n\n    <span>fmt</span><span>.</span><span>Println</span><span>(</span><span>getFullName</span><span>(</span><span>john</span><span>))</span>\n    <span>fmt</span><span>.</span><span>Println</span><span>(</span><span>john</span><span>)</span>\n<span>}</span>\n</code></pre></div>\n<p>We cannot rely on this when passed parameters are maps or slices.</p>\n<h3>\n<a href=\"https://dev.to/feed#data-structures\">\n</a>\n<a href=\"https://en.wikipedia.org/wiki/Purely_functional_data_structure\">Data structures</a>\n</h3>\n<p>When using functional programming techniques it is encouraged to use functional data types such as Stacks, Maps and Queues. <br>\nHence maps are better than arrays or hash sets in functional programming as data stores.</p>\n<h2>\n<a href=\"https://dev.to/feed#conclusion\">\n</a>\nConclusion\n</h2>\n<p>This is just an introduction for those who are trying to apply some functional programming techniques in Go. There are a lot more that can be done in Go and with the addition of generics in the next major version, this should be even easier. As I said earlier functional programming is not a silver bullet but it offers a lot of useful techniques for more understandable, maintainable and testable code. It can co-exist perfectly well with imperative and object-oriented programming styles. In fact, we all should be using the best of everything.</p>\n<p>I hope you find this useful. If you have any question or if you think I missed something please add a comment.</p>\n<p>If you like this article, please leave a like or a comment.</p>\n<p>You can follow me on <a href=\"https://twitter.com/deepu105\">Twitter</a> and <a href=\"https://www.linkedin.com/in/deepu05/\">LinkedIn</a>.</p>",
   :direction "ltr"},
  :updated 1565777182000,
  :entities
  [{:mentions [{:text "functional programming"}],
    :id "nlp/f/entity/wd:193076",
    :salienceLevel "about",
    :label "functional programming"}
   {:mentions [{:text "functional"} {:text "higher-order function"}],
    :id "nlp/f/entity/wd:1474542",
    :salienceLevel "mention",
    :label "higher-order function"}
   {:mentions [{:text "lazy evaluation"}],
    :id "nlp/f/entity/wd:573952",
    :salienceLevel "mention",
    :label "lazy evaluation"}
   {:mentions [{:text "referential transparency"}],
    :id "nlp/f/entity/wd:1754278",
    :salienceLevel "mention",
    :label "referential transparency"}
   {:mentions [{:text "tail recursion"}],
    :id "nlp/f/entity/wd:1340959",
    :salienceLevel "mention",
    :label "tail recursion"}],
  :alternate
  [{:href
    "https://dev.to/deepu105/7-easy-functional-programming-techniques-in-go-3idp",
    :type "text/html"}],
  :title "7 Easy functional programming techniques in Go",
  :author "Deepu K Sasidharan",
  :published-str "Wed Aug 14 03:06:22 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16c9197c321:3b3183:340e5e89",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url
   "https://res.cloudinary.com/practicaldev/image/fetch/s--SrOpDDUH--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://res.cloudinary.com/practicaldev/image/fetch/s--r6ed2tD---/c_fill%2Cf_auto%2Cfl_progressive%2Ch_150%2Cq_auto%2Cw_150/https://thepracticaldev.s3.amazonaws.com/uploads/user/profile_image/178939/20b6c844-abd4-48c5-ac47-dbaaa30cce9d.jpeg",
   :width 150,
   :height 150,
   :contentType "image/jpeg"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://dev.to/deepu105/7-easy-functional-programming-techniques-in-go-3idp",
  :commonTopics
  [{:score 143.77938729341284,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.817,
    :id "nlp/f/topic/525",
    :salienceLevel "mention",
    :label "computer science"}
   {:score 0.79,
    :id "nlp/f/topic/76",
    :salienceLevel "mention",
    :label "algorithms"}],
  :published 1565777182000,
  :fingerprint "c6c5a17b",
  :canonicalUrl
  "https://dev.to/deepu105/7-easy-functional-programming-techniques-in-go-3idp"}
 {:engagement 41,
  :unread false,
  :crawled 1565732201561,
  :recrawled 1565808067201,
  :content
  {:content
   "<p>It seems like there's a strong aversion to using frameworks in the\nClojure community. Other languages might need frameworks, but not\nours! Libraries all the way, baby!</p>\n<p>This attitude did not develop without reason. Many of us came to\nClojure after getting burned on magical frameworks like Rails, where\nwe ended up spending an inordinate amount of time coming up with hacks\nfor the framework's shortcomings. Another &quot;problem&quot; is that Clojure\ntools like <a href=\"http://www.luminusweb.net/\">Luminus</a> and the top-rate web\ndev libraries it bundles provide such a productive experience that\nframeworks seem superfluous.</p>\n<p>Be that as it may, I'm going to make the case for why the community's\ndominant view of frameworks needs revision. Frameworks are useful. To\nconvince you, I'll start by explaining what a framework is. I have yet\nto read a definition of <em>framework</em> that satisfies me, and I think\nsome of the hate directed at them stems from a lack of clarity about\nwhat exactly they are. Are they just glorified libraries? Do they have\nto be magical? Is there some law decreeing that they have to be more\ntrouble than they're worth? All this and more shall be revealed.</p>\n<p>I think the utility of frameworks will become evident by describing\nthe purpose they serve and how they achieve that purpose. The\ndescription will also clarify what makes a <em>good</em> framework and\nexplain why some frameworks end up hurting us. My hope is that you'll\nfind this discussion interesting and satisfying, and that it will give\nyou a new, useful perspective not just on frameworks but on\nprogramming in general. Even if you still don't want to use a\nframework after you finish reading, I hope you'll have a better\nunderstanding of the problems frameworks are meant to solve and that\nthis will help you design applications better.</p>\n<p>Frameworks have second-order benefits, and I'll cover those too. They\nmake it possible for an ecosystem of reusable components to\nexist. They make programming fun. They make it easier for beginners to\nmake stuff.</p>\n<p>Last, I'll cover some ways that I think Clojure is uniquely suited to\ncreating kick-ass frameworks.</p>\n<p>(By the way: I've written this post because I'm building a Clojure\nframework! So yeah this is totally my Jedi mind trick to prime you to\nuse <em>my</em> framework. The framework's not released yet, but I've used it\nto build <a href=\"https://gratefulplace.com\">Grateful Place, a community for people who are into\ncultivating gratitude, compassion, generosity, and other positive\npractices</a>. Just as learning Clojure makes\nyou a better programmer, learning to approach each day with\ncompassion, curiosity, kindness, and gratitude will make you a more\njoyful person. If you want to brighten your day and mine, please\njoin!)</p>\n<h2>What is a Framework?</h2>\n<p>A framework is a set of libraries that:</p>\n<ul>\n<li>Manages the complexity of coordinating the <em>resources</em> needed to\nwrite an application...</li>\n<li>by providing <em>abstractions</em> for those resources...</li>\n<li>and <em>systems for communicating</em> between those resources...</li>\n<li>within an <em>environment</em>...</li>\n<li>so that programmers can <em>focus on writing the business logic</em> that's\nspecific to their product</li>\n</ul>\n<p>I'll elaborate on each of these points using examples from\n<a href=\"https://rubyonrails.org/\">Rails</a> and from the ultimate framework: the\n<em>operating system</em>. </p>\n<p>You might wonder, how is an OS a framework? When you look at the list\nof framework responsibilities, you'll notice that the OS handles all\nof them, and it handles them exceedingly well. Briefly: an OS provides\nvirtual abstractions for hardware resources so that programmers don't\nhave to focus on the details of, say, pushing bytes onto some\nparticular disk or managing CPU scheduling. It also provides the\nconventions of a hierarchical filesystem with an addressing system\nconsisting of names separated by forward slashes, and these\nconventions provide one way for resources to communicate with each\nother (Process A can write to <code>/foo/bar</code> while Process B reads from\nit) - if every programmer came up with her own bespoke addressing\nsystem, it would be a disaster. The OS handles this for us so we can\nfocus on application-specific tasks.</p>\n<p>Because operating systems are such successful frameworks we'll look at\na few of their features in some detail so that we can get a better\nunderstanding of what good framework design looks like.</p>\n<h3>Coordinating Resources</h3>\n<p><em>Resources</em> are the &quot;materials&quot; used by programs to do their work, and\ncan be divided into four categories: storage, computation,\ncommunication, and interfaces. Examples of storage include files,\ndatabases, and caches. Computation examples include processes,\nthreads, actors, background jobs, and core.async processes. For\ncommunication there are HTTP requests, message queues, and event\nbuses. Interfaces typically include keyboard and mouse, plus screens\nand the systems used to display stuff on them: gui toolkits, browsers\nand the DOM, etc.</p>\n<p>Specialized resources are built on top of more general-purpose\nresources. (Some refer to these specialized resources as <em>services</em> or\n<em>components</em>.) We start with hardware and build virtual resources on\ntop. With storage, the OS starts with disks and memory and creates the\nfilesystem as a virtual storage resource on top. Databases like\nPostgres use the filesystem to create another virtual storage resource\nto handle use cases not met by the filesystem. Datomic uses other\ndatabases like Cassandra or DynamoDB as its storage layer. Browsers\ncreate their own virtual environments and introduce new resources like\nlocal storage and cookies.</p>\n<p>For computation, the OS introduces processes and threads as virtual\nresources representing and organizing program execution. Erlang\ncreates an environment with a process model that's dramatically\ndifferent from the underlying OS's. Same deal with Clojure's\n<code>core.async</code>, which introduces the <em>communicating sequential\nprocesses</em> computation model. It's a virtual model defined by Clojure\nmacros, &quot;compiled&quot; to core clojure, then compiled to JVM bytecode (or\nJavaScript!), which then has to be executed by operating system\nprocesses.</p>\n<p>Interfaces follow the same pattern: on the visual display side, the OS\npaints to monitors, applications paint to their own virtual canvas,\nbrowsers are applications which introduce their own resources (the DOM\nand <code>&lt;canvas></code>), and React introduces a virtual DOM. Emacs is an\noperating system on top of the operating system, and it provides\nwindows and frames.</p>\n<p>Resources manage their own <em>entities</em>: in a database, entities could\ninclude tables, rows, triggers, and sequences. Filesystem entities\ninclude directories and files. A GUI manages windows, menu bars, and\nother components.</p>\n<p>(I realize that this description of <em>resource</em> is not the kind of\nairtight, axiomatic, comprehensive description that programmers like.\nOne shortcoming is that the boundary between resource and application\nis pretty thin: Postgres is an application in its own right, but from\nthe perspective of a Rails app it's a resource. Still, hopefully my\nuse of <em>resource</em> is clear enough that you nevertheless understand\nwhat the f I'm talking about when I talk about resources.)</p>\n<p>Coordinating these resources is inherently complex. Hell, coordinating\nanything is complex. I still remember the first time I got smacked in\nthe face with a baseball in little league thanks to a lack of\ncoordination. There was also a time period where I, as a child, took\ntae kwon do classes and frequently ended up sitting with my back\nagainst the wall with my eyes closed in pain because a) my mom for\nsome reason refused to buy me an athletic cup and b) I did not possess\nthe coordination to otherwise protect myself during sparring.</p>\n<p>When building a product, you have to decide how to create, validate,\nsecure, and dispose of resource entities; how to convey entities from\none resource to another; and how to deal with issues like timing (race\nconditions) and failure handling that arise whenever resources\ninteract, all without getting hit in the face. Rails, for instance,\nwas designed to coordinate browsers, HTTP servers, and databases. It\nhad to convey user input to a database, and also retrieve and render\ndatabase records for display by the user interface, via HTTP requests\nand responses.</p>\n<p>There is no obvious or objectively correct way to coordinate these\nresources. In Rails, HTTP requests would get dispatched to a\nController, which was responsible for interacting with a database and\nmaking data available to a View, which would render HTML that could be\nsent back to the browser.</p>\n<p>You don't <em>have</em> to coordinate web app resources using the\nModel/View/Controller (MVC) approach Rails uses, but you do have to\ncoordinate these resources <em>somehow</em>. These decisions involve making\ntradeoffs and imposing constraints to achieve a balance of\nextensibility (creating a system generic enough for new resources to\nparticipate) and power (allowing the system to fully exploit the\nunique features of a specific resource).</p>\n<p>This is a very difficult task even for experienced developers, and the\nchoices you make could have negative repercussions that aren't\napparent until you're heavily invested in them. With Rails, for\ninstance, ActiveRecord (AR) provided a good generic abstraction for\ndatabases, but early on it was very easy to produce extremely\ninefficient SQL, and sometimes very difficult to produce efficient\nSQL. You'd often have to hand-write SQL, eliminating some of the\nbenefits of using AR in the first place.</p>\n<p>For complete beginners, the task of making these tradeoffs is\nimpossible because doing so requires experience. Beginners won't even\nknow that it's necessary to make these decisions. At the same time,\nmore experienced developers would prefer to spend their time and\nenergy solving more important problems.</p>\n<p>Frameworks make these decisions for us, allowing us to focus on\nbusiness logic, and they do so by introducing <em>communication systems</em>\nand <em>abstractions</em>.</p>\n<h3>Resource Abstractions</h3>\n<p>Our software interacts with resources via their <em>abstractions</em>. I\nthink of abstractions as:</p>\n<ul>\n<li>the data structures used to represent a resource</li>\n<li>the set of messages that a resource responds to</li>\n<li>the mechanisms the resource uses to call your application's code</li>\n</ul>\n<p>(<em>Abstraction</em> might be a terrible word to use here. Every developer\nover three years old has their own definition, and if mine doesn't\ncorrespond to yours just cut me a little slack and run with it :)</p>\n<p>Rails exposes a database resource that your application code interacts\nwith via the <code>ActiveRecord</code> abstraction. Tables correspond to classes,\nand rows to objects of that class. This a choice with tradeoffs - rows\ncould have been represented as Ruby hashes (a primitive akin to a JSON\nobject), which might have made them more portable while making it more\ndifficult to concisely express database operations like <code>save</code> and\n<code>destroy</code>. The abstraction also responds to <code>find</code>, <code>create</code>,\n<code>update</code>, and <code>destroy</code>. It calls your application's code via\nlifecycle callback methods like <code>before_validation</code>. Frameworks add\nvalue by identifying these lifecycles and providing interfaces for\nthem when they're absent from the underlying resource.</p>\n<p>You already know this, but it bears saying: abstractions let us code\nat a higher level. Framework abstractions handle the concerns that are\nspecific to resource management, letting us focus on building\nproducts. Designed well, they enable loose coupling.</p>\n<p>Nothing exemplifies this better than the massively successful <em>file</em>\nabstraction that the UNIX framework introduced. We're going to look at\nin detail because it embodies design wisdom that can help us\nunderstand what makes a good framework.</p>\n<p>The core file functions are <code>open</code>, <code>read</code>, <code>write</code>, and\n<code>close</code>. Files are represented as sequential streams of bytes, which\nis just as much a choice as ActiveRecord's choice to use Ruby\nobjects. Within processes, open files are represented as <em>file\ndescriptors</em>, which are usually a small integer. The <code>open</code> function\ntakes a path and returns a file descriptor, and <code>read</code>, <code>write</code>, and\n<code>close</code> take a file descriptor as an argument to do their work.</p>\n<p>Now here's the amazing magical kicker: <em>file</em> doesn't have to mean\n<em>file on disk</em>. Just as Rails implements the ActiveRecord abstraction\nfor MySQL and Postgres, the OS implements the file abstraction for\n<strong>pipes</strong>, terminals, and other resources, meaning that your programs\ncan write to them using the same system calls as you'd use to write\nfiles to disk - indeed, from your program's standpoint, all it knows\nis that it's writing to a file; it doesn't know that the &quot;file&quot; that a\nfile descriptor refers to might actually be a pipe.</p>\n<blockquote>\n<p>Exercise for the reader: write a couple paragraphs explaining\nprecisely the design choices that enable this degree of loose\ncoupling. How can these choices help us in evaluating and designing\nframeworks?</p>\n</blockquote>\n<p>This design is a huge part of UNIX's famed simplicity. It's what lets\nus run this in a shell:</p>\n<div><pre><span># list files in the current directory and perform a word count on the output</span>\nls <span>|</span> wc\n</pre></div>\n<p>The shell interprets this by launching an <code>ls</code> process. Normally, when\na process is launched it creates three file descriptors (which,\nremember, represent open files): <code>0</code> for <code>STDIN</code>, <code>1</code> for <code>STDOUT</code>,\nand <code>2</code> for <code>STDERR</code>, and the shell sets each file descriptor to refer\nto your terminal (terminals can be files!! what!?!?). Your shell sees\nthe pipe, <code>|</code>, and sets <code>ls</code>'s <code>STDOUT</code> to the pipe's <code>STDIN</code>, and the\npipe's <code>STDOUT</code> to <code>wc</code>'s <code>STDIN</code>. The pipe links processes' file\ndescriptors, while the processes get to read and write &quot;files&quot; without\nhaving to know what's actually on the other end. No joke, every time I\nthink of this I get a little excited tingle at the base of my\nspine because I am a:</p>\n<p>This is why file I/O is referred to as <em>the universal I/O model</em>. I'll\nhave more to say about this in the next section, but I share it here\nto illustrate how much more powerful your programming environment can\nbe if you find the right abstractions. The file I/O model still\ndominates decades after its introduction, making our lives easier\n<em>without our even having to understand how it actually works</em>.</p>\n<p>The canonical first exercise any beginner programmer performs is to\nwrite a program that prints out, <em>Wassup, homies?</em>. This program makes\nuse of the file model, but the beginner doesn't have to even know that\nsuch a thing exists. This is what a good framework does. A\nwell-designed framework lets you easily get started building simple\napplications, without preventing you building more complicated and\nuseful ones as you learn more.</p>\n<p>One final point about abstractions: they provide mechanisms for\ncalling your application's code. We saw this a bit earlier with\nActiveRecord's lifecycle methods. Frameworks will usually provide the\noverall structure for how an application should interact with its\nenvironment, defining sets of events that you write custom handlers\nfor. With ActiveRecord lifecycles, the structure of <code>before_create</code>,\n<code>create</code>, <code>after_create</code> is predetermined, but you can define what\nhappens at each step. This pattern is called <em>inversion of control</em>,\nand many developers consider it a key feature of frameworks.</p>\n<p>With *nix operating systems, you could say that in C programs the\n<code>main</code> function is a kind of <code>onStart</code> callback. The OS calls <code>main</code>,\nand <code>main</code> tells the OS what instructions should be run. However, the\nOS controls when instructions are actually executed because the OS is\nin charge of scheduling. It's a kind of inversion of control, right? 🤔</p>\n<h3>Communication</h3>\n<p>Frameworks coordinate resources, and (it's almost a tautology to say\nthis) coordination requires <em>communication</em>. Communication is\n<em>hard</em>. Frameworks make it easier by translating the disparate\n&quot;languages&quot; spoken by resources into one or more common languages that\nare easy to understand and efficient, while also ensuring\nextensibility and composability. Frameworks also do some of the work\nof ensuring resilience. This usually entails:</p>\n<ul>\n<li>Establishing naming and addressing conventions</li>\n<li>Establishing conventions for how to structure content</li>\n<li>Introducing communication brokers</li>\n<li>Handling communication failures (the database is down! that file\ndoesn't exist!)</li>\n</ul>\n<p>One example many people are familiar with is the HTTP stack, a\n&quot;language&quot; used to communicate between browser and server resources:</p>\n<ul>\n<li>HTTP structures content (request headers and request body as text)</li>\n<li>TCP handles communication failures</li>\n<li>IP handles addressing</li>\n</ul>\n<h4>Conventions</h4>\n<p>The file model is a &quot;common language&quot;, and the OS uses device drivers\nto translate between between the file model and whatever local\nlanguage is spoken by hardware devices. It has naming and addressing\nconventions, letting you specify files on the filesystem using\ncharacter strings separated by slashes that it translates to an\ninternal inode (a data structure that stores file and directory\ndetails, like ownership and permissions). We're so used to this that\nit's easy to forget it's a convention; *nix systems could have been\ndesigned so that you had to refer to files using a number or a\nUUID. The file descriptors I described in the last section are also a\nconvention.</p>\n<p>Another convention the file model introduces is to structure content\nas byte streams, as opposed to bit streams, character streams, or xml\ndocuments. However, bytes are usually too low-level, so the OS\nincludes a suite of command line tools that introduce the further\nconvention of structuring bytes by interpreting them as characters\n(<code>sed</code>, <code>awk</code>, <code>grep</code>, and friends). More recently, more tools have\nbeen introduced that interpret text as YAML or JSON. The Clojure world\nhas further tools to interpret JSON as transit. My YAML tools can't do\njack with your JSON files, but because these formats are all expressed\nin terms of lower-level formats, the lower-level tools can still work\nwith them. Structure affects composability.</p>\n<p>The file model's simplicity is what allows it to be the &quot;universal I/O\nmodel.&quot; I mean, just imagine if all Linux processes had to communicate\nwith XML instead of byte streams! Hoo boy, what a crazy world that\nwould be. Having a simple, universal communication system makes it\nextremely easy for new resources to participate without having to be\ndirectly aware of each other. It allows us to easily compose command\nline tools. It allows one program to write to a log while another\nreads from it. In other words, it enables loose coupling and all the\nattendant benefits.</p>\n<h4>Communication Brokers</h4>\n<p><em>Globally addressable communication brokers</em> (like the filesystem, or\nKafka queues, or databases) are essential to enabling composable\nsystems. <em>Global</em> means that every resource can access\nit. <em>Addressable</em> means that the broker maintains identifiers for\nentities independently of its clients, and it's possible for clients\nto specify entities using those identifiers. <em>Communication broker</em>\nmeans that the system's purpose is to convey data from one resource to\nanother, and it has well-defined semantics: a queue has FIFO\nsemantics, the file system has update-in-place semantics, etc.</p>\n<p>If Linux had no filesystem and processes were only allowed to\ncommunicate via pipes, it would be a nightmare. Indirect communication\nis more flexible than direct communication. It supports decoupling\nover time, in that reads and writes don't have to happen\nsynchronously. It also allows participants to drop in and out of the\ncommunication system independently of each other. (By the way, I can't\nthink of the name for this concept or some better way to express it,\nand would love feedback here.)</p>\n<p>I think this is the trickiest part of framework design. At the\nbeginning of the article I mentioned that developers might end up\nhacking around a framework's constraints, and I think the main\nconstraint is often the absence of a communication broker. The\nframework's designers introduce new resources and abstractions, but\nthe only way to compose them is through direct communication, and\nsometimes that direct communication is handled magically. (I seem to\nrecall that Rails worked with this way, with tight coupling between\nController and Views and a lack of options for conveying Controller\ndata to other parts of the system). If someone wants to introduce new\nabstractions, they have to untangle all the magic and hook deep into\nthe framework's internals, using -- or even patching! -- code that's\nmeant to be private.</p>\n<p>I remember running into this with Rails back when MongoDB was\nreleased; the <em>document database</em> resource was sufficiently different\nfrom the <em>relational database resource</em> that it was pretty much\nimpossible for MongoDB to take part in the ActiveRecord abstraction,\nand it was also very difficult to introduce a new data store\nabstraction that would play well with the rest of the Rails ecosystem.</p>\n<p>For a more current example, a frontend framework might identify the\nform as a resource, and create a nice abstraction for it that handles\nthings like validation and the submission lifecycle. If the form\nabstraction is written in a framework that has no communication broker\n(like a global state container), then it will be very difficult to\nmeet the common use case of using a form to filter rows in a table\nbecause there's no way for the code that renders table data to access\nthe form inputs' values. You might come up with some hack like\ndefining handlers for exporting the form's state, but doing this on an\nad-hoc basis results in confusing and brittle code.</p>\n<p>By contrast, the presence of a communication broker can make life much\neasier. In the Clojure world, the React frameworks\n<a href=\"https://github.com/Day8/re-frame/\">re-frame</a> and\n<a href=\"https://github.com/omcljs/om\">om.next</a> have embraced global state\natoms, a kind of communication broker similar to the filesystem (atoms\nare an in-memory storage mechanism). They also both have well defined\ncommunication protocols. I'm not very familiar with\n<a href=\"https://redux.js.org/\">Redux</a> but I've heard tell that it also has\nembraced a global, central state container.</p>\n<p>If you create a form abstraction using re-frame, it's possible to\ntrack its state in a global state atom. It's further possible to\nestablish a naming convention for forms, making it easier for other\nparticipants to look up the form's data and react to it. (Spoiler\nalert: the framework I've been working on does this!)</p>\n<p>Communication systems are fundamental. Without them, it's difficult to\nbuild anything but the simplest applications. By providing\ncommunication systems, frameworks relieve much of the cognitive burden\nof building a program. By establishing communication standards,\nframeworks make it possible for developers to create composable tools,\ntools that benefit everybody who uses that framework. Standards make\ninfrastructure possible, and infrastructure enables productivity.</p>\n<p>In this section I focused primarily on the file model because it's\nbeen so successful and I think we can learn a lot from it. Other\nmodels include event buses and message queues. I'm not going to write\nabout these because I'm not made of words, ok?!?</p>\n<h3>Environments</h3>\n<p>Frameworks are built to coordinate resources within a particular\n<em>environment</em>. When we talk about desktop apps, web apps, single page\napps, and mobile apps, we're talking about different\nenvironments. From the developer's perspective, environments are\ndistinguished by the resources that are available, while from the\nuser's perspective different environments entail different usage\npatterns and expectations about distribution, availability, licensing,\nand payment.</p>\n<p>As technology advances, new resources become available (the Internet!\ndatabases! smart phones! powerful browsers! AWS!), new environments\nevolve to combine those resources, and frameworks are created to\ntarget those environments. This is why we talk about mobile frameworks\nand desktop frameworks and the like.</p>\n<p>One of the reasons I stopped using Rails was because it was a <em>web\napplication framework</em>, but I wanted to build <em>single page\napplications</em>. At the time (around 2012?), I was learning to use\nAngular and wanted to deploy applications that used it, but it didn't\nreally fit with Rails's design.</p>\n<p>And that's OK. Some people write programs for Linux, some people write\nfor macOS, some people still write for Windows for some reason (just\nkidding! don't kill me!). A framework is a tool, and tools are built\nfor a specific purpose. If you're trying to achieve a purpose the tool\nisn't built for, use a different tool.</p>\n<h2>More Benefits of Using Frameworks</h2>\n<p>So far I've mostly discussed how frameworks bring benefits to the\nindividual developer. In this section I'll explain how frameworks\nbenefit communities, how they make programming fun, and (perhaps most\nimportantly) how they are a great boon for beginners.</p>\n<p>First, to recap, a framework is a set of libraries that:</p>\n<ul>\n<li>Manages the complexity of coordinating the <em>resources</em> needed to\nwrite an application</li>\n<li>By providing <em>abstractions</em> for those resources</li>\n<li>And <em>systems for communicating</em> between those resources</li>\n<li>Within an <em>environment</em>\n</li>\n<li>So that programmers can focus on writing the business logic that's\nspecific to their product</li>\n</ul>\n<p>This alone lifts a huge burden off of developers. In case I haven't\nsaid it enough, this kind of work is <em>hard</em>, and if you had to do it\nevery time you wanted to make an application it would be frustrating\nan exhausting. Actually, let me rephrase that: I <em>have</em> had to do this\nwork, and it <em>is</em> frustrating and exhausting. It's why Rails was such\na godsend when I first encountered it in 2005.</p>\n<h3>Frameworks Bring Community Benefits</h3>\n<p>Clear abstractions and communication systems allow people to share\nmodules, plugins, or whatever you want to call framework extensions,\ncreating a vibrant ecosystem of reusable components.</p>\n<p>If you accept my assertion that an operating system is a framework,\nthen you can consider any program which communicates via one of the\nOS's communication systems (sockets, the file model, etc) to be an\nextension of the framework. Postgres is a framework extension that adds\nan RDBMS resource. statsd is an extension that adds a monitoring\nresource.</p>\n<p>Similarly, Rails makes it possible for developers to identify\nspecialized resources and extend the framework to easily support\nthem. One of the most popular and powerful is\n<a href=\"https://github.com/plataformatec/devise\">Devise</a>, which coordinates\nRails resources to introduce a new user authentication resource. Just\nas using Postgres is usually preferable to rolling your own database,\nusing Devise is usually preferable to rolling your own authentication\nsystem.</p>\n<p>Would it be possible to create a Devise for Clojure? I don't think\nso. Devise is designed to be database agnostic, but because Clojure\ndoesn't really have a go-to framework that anoints or introduces a\ngo-to database abstraction, no one can write the equivalent of Devise\nin such a way that it could easily target any RDBMS. Without a\nframework, it's unlikely that someone will be able to write a\nfull-featured authentication solution that you can reuse, and if you\nwrite one it's unlikely others would see much benefit if you shared\nit. I think it's too bad that Clojure is missing out on these kinds of\necosystem benefits.</p>\n<p>Another subtler benefit frameworks bring is that they present a\ncoherent story for how developers can build applications in your\nlanguage, and that makes your language more attractive. Building an\napplication means coordinating resources for the environment you're\ntargeting (desktop, mobile, SPA, whatever). If your language has no\nframeworks for a target environment, then learning or using the\nlanguage is much riskier. There's a much higher barrier to building\nproducts: not only does a dev have to learn the language's syntax\nand paradigms, she has to figure out how to perform the complex task\nof abstracting and coordinating resources using the language's\nparadigms. If your goal is to create a mass-market product, choosing a\nlanguage that doesn't have frameworks for your target environments is\na risky choice.</p>\n<p>Finally, frameworks become a base layer that you can create tooling\nfor. The introduction of the filesystem made it possible for people to\nwrite tools that easily create and manipulate files. Rails's\nabstractions made it easy to generate code for creating a new database\ntable, along with an entire stack - model, view, controller - for\ninteracting with it.</p>\n<h3>Frameworks Make Development Fun</h3>\n<p>If you still think frameworks are overkill or more trouble than\nthey're worth, believe me I get it. When I switched from Rails to\nClojure and its &quot;libraries not frameworks&quot; approach, I <em>loved</em> it. A\nframework felt unnecessary because all the pieces were so simple that\nit was trivial for me to glue them together myself. Also, it was just\nplain fun to solve a problem I was familiar with because it helped me\nlearn the language.</p>\n<p>Well, call me a jaded millenial fart, but I don't think that this work\nis fun anymore. I want to build products, not build the infrastructure\nfor building products. I want a plugin that will handle the reset\npassword process for me. I want an admin panel that I can get working\nin five minutes. Frameworks handle the kind of work that ideally only\nhas to be done once. I don't want to have to do this work over and\nover every time I want to make something.</p>\n<p>For me, programming is a creative endeavor. I love making dumb things\nand putting them in front of people to see what will happen. Rails let\nme build (now defunct) sites like phobiatopia.com, where users could\nshare what they're afraid of. The site would use their IP address to\ncome up with some geo coordinates and use Google Maps to display a\nglobal fear map. A lot of people were afraid of bears.</p>\n<p>Frameworks let you focus on the fun parts of building an app. They let\nyou release an idea, however dumb, more quickly.</p>\n<h3>Frameworks Help Beginners</h3>\n<p>Frameworks help beginners by empowering them to build real,\nhonest-to-god running applications that they can show to their friends\nand even make money with, without having to fully understand or even\nbe aware of all the technology they're using. Being able to conjure up\na complete creation, no matter how small or ill-made, is the very\nbreath of wonder and delight. (I don't know exactly what this means,\nbut I like how it sounds!)</p>\n<p>There's a kind of thinking that says frameworks are bad because they\nallow beginners to make stuff without having to know how it all\nworks. ActiveRecord is corrupting the youth, allowing them to build\napps without even knowing how to pronounce <em>SQL</em>.</p>\n<p>There's another line of thinking that says it's bad to try to make\nthings easier for beginners. It's somehow virtuous for people to\nstruggle or suffer for the sake of learning.</p>\n<p>Hogwash. Fiddlefaddle. Poppycock. Joy beats suffering every time, and\nmaking learning more joyful allows more people to reap the benefits of\nwhatever tool or product you've created.</p>\n<p>I am a photographer. I have a professional camera, and I know how to\nuse it. Some of my photos require a fair amount of technical knowledge\nand specialized equipment:</p>\n<p><img alt=\"tea\" src=\"http://feeds.feedburner.com/assets/images/posts/why-programmers-need-frameworks/tea.jpg\"></p>\n<p>This isn't something you can create with a camera phone, yet somehow\nI'm able to enjoy myself and my art without complaining that\npoint-and-shoot cameras exist and that people like them.</p>\n<p>Novices benefit greatly from expert guidance. I don't think you can\nbecome a master photographer using your phone's camera, but with the\nphone's &quot;guidance&quot; you can take some damn good photos and be proud of\nthem. And if you do want to become a master, that kind of positive\nfeedback and sense of accomplishment will give you the motivation to\nstick with it and learn the hard stuff. Frameworks provide this\nguidance by creating a safe path around all the quicksand and pit\ntraps that you can stumble into when creating an app. Frameworks help\nbeginners. This is a feature, not a bug.</p>\n<h2>A Clojure Framework</h2>\n<p>Frameworks are all about managing the complexity of coordinating\nresources. Well, guess what: Managing Complexity is Clojure's middle\nname. Clojure &quot;Managing Complexity&quot; McCarthy-Lisp. Personally, I want\na single-page app (SPA) framework, and there are many aspects of\nClojure's design and philosophy that I think will make it possible to\ncreate one that seriously kicks ass. I'll give just a few examples.</p>\n<p>First, consider how Linux tools like <code>sed</code> and <code>awk</code> are\ntext-oriented. Developers can add additional structure to text by\nformatting it as JSON or YAML, and those text-processing tools can\nstill work the structured text.</p>\n<p>In the same way, Clojure's emphasis on simple data structures means\nthat we can create specialized structures to represent forms and ajax\nrequest, and tools to process those structures. If we define those\nstructures in terms of maps and vectors, though, we'll still be able\nto use a vast ecosystem of functions for working with those simpler\nstructures. In other words, creating specialized structures does not\npreclude us from using the tools built for simpler structures, and\nthis isn't the case for many other languages.</p>\n<p>Second, Clojure's abstraction mechanisms (protocols and multimethods)\nare extremely flexible, making it easy for us to implement\nabstractions for new resources as they become available.</p>\n<p>Third, <em>you can use the same language for the frontend and backend!!!</em>\nNot only that, Transit allows the two to effortlessly\ncommunicate. This eliminates an entire class of coordination problems\nthat frameworks in other languages have to contend with.</p>\n<p>In my opinion, the Clojurian stance that frameworks are more trouble\nthan they're worth is completely backwards: Clojure gives us the\nfoundation to build a completely kick-ass framework! One that's simple\n<em>and</em> easy. One can dream, right?</p>\n<p>My ambition in building a SPA framework is to empower current and\nfuture Clojure devs to get our ideas into production <em>fast</em>. I want us\nto be able to spend more time on the hard stuff, the fun stuff, the\ninteresting stuff. And I want us to be able to easily ship with\nconfidence.</p>\n<p>The framework I'm building is built on top of some truly amazing\nlibraries, primarily Integrant, re-frame, and Liberator. Integrant\nintroduces a <em>component</em> abstraction and handles the start/stop\nlifecycle of an application. re-frame provides a filesystem and\ncommunication broker for the frontend. Liberator introduces a standard\nmodel for handling HTTP requests.</p>\n<p>If my framework is useful at all it's because the creators of those\ntools have done all the heavy lifting. My framework introduces more\nresources and abstractions specific to creating single-page apps. For\nexample, it creates an abstraction for wrapping AJAX requests so that\nyou can easily display activity indicators when a request is\nactive. It creates a form abstraction that handles all the plumbing of\nhandling input changes and dispatching form submission, as well the\nentire form lifecycle of <em>fresh</em>, <em>dirty</em>, <em>submitted</em>, <em>invalid</em>,\n<em>succeeded</em>, etc. It imposes some conventions for organizing data.</p>\n<p>As I mentioned, the framework is not quite ready for public\nconsumption yet becaause there's still a lot of churn while I work out\nideas, and because there's basically no documentation, but I hope to\nrelease it in the near future.</p>\n<p>If you'd like to see a production app that uses the framework,\nhowever, I invite you to check out <a href=\"https://gratefulplace.com\">Grateful\nPlace</a>, a community site for people who\nwant to support each other in growing resilience, peace, and joy by\npracticing compassion, gratitude, generosity, and other positive\nvalues. By joining, you're not just helping yourself, you're helping\nothers by letting them know that you support them and share their\nvalues.</p>\n<p>Please click around and look at the snazzy loading animations. And if\nyou feel so moved, please do join! I <em>love</em> getting to interact with\npeople in that context of mutual support for shared values. One of the\nonly things I care about more than Clojure is helping people develop\nthe tools to navigate this crazy-ass world :D</p>\n<p>In the mean time, I'll keep working on getting this framework ready\nfor public consumption. Expect another blawg article sharing some\ndetails on how Grateful Place is implemented. Then, eventually,\nhopefully, an actual announcement for the framework itself :)</p>\n<p>If you don't want to wait for my slow butt, then check out some ofthe\namazing Clojure tools that already exist:</p>\n<ul>\n<li><a href=\"http://www.luminusweb.net\">Luminus</a></li>\n<li>\n<a href=\"http://book.fulcrologic.com/\">Fulcro</a> which probably does\neverything I want my framework to, only better</li>\n<li>\n<a href=\"https://github.com/Day8/re-frame/\">re-frame</a> remains my favorite\nfrontend framework</li>\n<li>\n<a href=\"https://github.com/duct-framework/duct\">duct</a> is great but its docs\naren't that great yet</li>\n<li>\n<a href=\"https://github.com/coast-framework/coast\">Coast on Clojure</a>, a full\nstack web framework</li>\n</ul>\n<p>(Sorry if I neglected your amazing Clojure tool!)</p>\n<p>Thanks to the following people who read drafts of this article and\nhelped me develop it:</p>\n<ul>\n<li>Mark Bastian</li>\n<li><a href=\"https://twitter.com/yogthos\">Dmitri Sotnikov aka @yogthos</a></li>\n<li>Sergey Shvets</li>\n<li>Kenneth Kalmer</li>\n<li>Sean whose last name I don't know</li>\n<li>Tom Brooke</li>\n<li>Patrick whose last name I don't know (update: It's Patrick French!)</li>\n<li>Fed Reggiardo</li>\n<li>Vincent Raerek</li>\n<li>Ernesto de Feria</li>\n<li>Bobby Towers</li>\n<li>Chris Oakman</li>\n<li>The TriClojure meetup</li>\n</ul>",
   :direction "ltr"},
  :updated 1565730000000,
  :entities
  [{:mentions [{:text "framework"}],
    :id "nlp/f/entity/wd:271680",
    :salienceLevel "mention",
    :label "software framework"}
   {:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "Rails"}],
    :id "nlp/f/entity/wd:190478",
    :salienceLevel "mention",
    :label "Ruby on Rails"}
   {:mentions [{:text "communicating sequential processes"}],
    :id "nlp/f/entity/wd:1120460",
    :salienceLevel "mention",
    :label "communicating sequential processes"}
   {:mentions [{:text "Beginners"}],
    :id "nlp/f/entity/wd:814343",
    :salienceLevel "mention",
    :label "Beginners"}],
  :alternate
  [{:href
    "http://www.flyingmachinestudios.com/programming/why-programmers-need-frameworks/",
    :type "text/html"}],
  :title "Frameworks and Why (Clojure) Programmers Need Them",
  :author "Daniel Higginbotham",
  :published-str "Tue Aug 13 14:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16c8ce96459:1658693:73d34570",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "tag:www.flyingmachinestudios.com,2019-08-13:/programming/why-programmers-need-frameworks/",
  :updateCount 4,
  :commonTopics
  [{:score 172.72472350452745,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.911,
    :id "nlp/f/topic/2010",
    :salienceLevel "about",
    :label "scalability"}],
  :published 1565730000000,
  :fingerprint "50b54203",
  :canonicalUrl
  "http://www.flyingmachinestudios.com/programming/why-programmers-need-frameworks/"}
 {:engagement 4,
  :unread false,
  :crawled 1565691972234,
  :content
  {:content
   "<p>If you're reading this, you've either been given the link to the posts ahead of time cos you've asked to see what is going on, or I've hit the publish button in which case hooray. Either way, this is a little series of posts going through some of the Purescript/Purerl code that we've quietly open sourced on Github under the Apache 2.0 license. Hopefully betwen these posts, the published markdown docs and the sample application there will be enough to get started with.</p>\n<p>Over the last year or so, we've been gradually building out our capacity to create applications end-to-end in Purescript, compiled to JS on the front-end and compiled to Erlang on the back, building on top of both OTP and our existing libraries from nearly a decade of company history doing business on top of the Erlang stack.</p>\n<p>The repositories we're looking at are:</p>\n<ul>\n<li><a href=\"https://github.com/purerl/\">Purerl</a> itself</li>\n<li>The <a href=\"https://github.com/purerl/package-sets\">purerl-package-sets</a></li>\n<li><a href=\"https://github.com/id3as/purescript-erl-stetson\">Stetson</a> (Opinionated Cowboy bindings)</li>\n<li><a href=\"http://codeofrob.com/git@github.com:id3as/purescript-erl-pinto.git\">Pinto</a> (Opinionated OTP bindings)</li>\n<li><a href=\"https://github.com/id3as/demo-ps\">demo-ps</a> (end-to-end sample code)</li>\n</ul>\n<p>The best place to start if you want to dive right in, is probably the demo-ps project as it demonstrates the usage of most of the above, and that is indeed where we'll be starting in this series.</p>\n<h1>Purerl</h1>\n<p>The Purerl organisation contains the core sets of bindings to much of Erlang's base libraries, as well as the fork of the Purescript compiler that can generate Erlang as a backend. </p>\n<h1>Purerl-package-sets</h1>\n<p>Essentially a pile of Dhall that generates a package.json containing a list of versions of the various Purerl libraries that work together, you'll not need to touch this directly unless you end up using Purerl internally in an organisation and you want to fork it and add your own internal/private Purerl dependencies.</p>\n<h1>Stetson</h1>\n<p><a href=\"https://github.com/ninenines/cowboy\">Cowboy</a> is the de-facto webserver in the Erlang world, and <a href=\"https://github.com/purerl/purescript-erl-cowboy\">direct bindings</a> exist for the project already, however when it came time to start building applications on top of this, it was clear that there was little gain to be had by directly using them over simply writing Erlang in the first place. Stetson was my attempt to mirror the experience I've had in other functional languages using libraries such as <a href=\"https://github.com/weavejester/compojure\">Compojure</a> and <a href=\"https://github.com/scotty-web/scotty\">Scotty</a>. It isn't by any means complete, and merely serves as a statement of intent around the kind of interaction I'd personally like to have around routing/etc in a Purerl world. I fully hope/expect that somebody will write a native http server in time rather than simply wrapping Cowboy as I have done here.</p>\n<h1>Pinto</h1>\n<p>There have been a <a href=\"https://github.com/purerl/purerl_otp_sandbox\">few examples</a> written demonstrating how to interact with OTP from Purerl, but again at the point of building a real application, direct bindings don't offer a good user experience once you start building out functionality and repeating yourself a whole ton. I cheated a lot when putting together Pinto and skipped the direct bindings step, going straight to the &quot;desired usage&quot; step and doing a pile of cheats around types and such. It seeks to largely mirror the existing OTP interactions, but in a more functional manner. Much like with Stetson, I fully expect/hope that in time somebody (maybe even us) will want a more idiomatic Purescript experience and choose to build something even more opinionated outside the familiar comfort of the OTP vocabulary. For now, we have Pinto.. :)</p>\n<h1>Demo-ps</h1>\n<p>This is a completely pointless web app that uses <a href=\"https://github.com/id3as/purescript-erl-stetson\">purescript-erl-stetson</a>, <a href=\"https://github.com/id3as/purescript-erl-pinto\">purescript-erl-pinto</a>, <a href=\"https://github.com/purerl/purescript-simple-json\">purescript-simple-json</a> and <a href=\"https://github.com/slamdata/purescript-halogen\">purescript-halogen</a> to store data in Redis using some FFI and display it in a single page application, sharing the view models between the server and client components. It seeks to demonstrate rough usages of all of these without cluttering up the interactions with &quot;real code&quot; (read: business logic).</p>\n<p>Next post, we'll look at the structure of the demo-ps project, as understanding this is essential if you wish to build your own.</p>",
   :direction "ltr"},
  :updated 1565688600000,
  :entities
  [{:mentions [{:text "OTP"}],
    :id "nlp/f/entity/wd:257631",
    :salienceLevel "about",
    :label "Henri Coandă International Airport"}
   {:mentions [{:text "Erlang"}],
    :id "nlp/f/entity/wd:334879",
    :salienceLevel "mention",
    :label "Erlang"}
   {:mentions [{:text "de facto"}],
    :id "nlp/f/entity/wd:712144",
    :salienceLevel "mention",
    :label "de facto"}
   {:mentions [{:text "user experience"}],
    :id "nlp/f/entity/wd:1047808",
    :salienceLevel "mention",
    :label "user experience"}
   {:mentions [{:text "web app"}],
    :id "nlp/f/entity/wd:189210",
    :salienceLevel "mention",
    :label "web application"}],
  :alternate
  [{:href
    "http://codeofrob.com/entries/introducing-pinto-and-stetson---opinionated-purescript-bindings-to-otp-and-cowboy.html",
    :type "text/html"}],
  :title
  "Introducing Pinto and Stetson - Opinionated Purescript bindings to OTP and Cowboy",
  :author "Rob Ashton",
  :published-str "Tue Aug 13 02:30:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16c8a838a8a:12fc120:4b2e0c8b",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "http://codeofrob.com/entries/introducing-pinto-and-stetson---opinionated-purescript-bindings-to-otp-and-cowboy.html",
  :commonTopics
  [{:score 47.211565796095734,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1565688600000,
  :fingerprint "1b377516",
  :canonicalUrl
  "http://codeofrob.com/entries/introducing-pinto-and-stetson---opinionated-purescript-bindings-to-otp-and-cowboy.html"}
 {:engagement 4,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1565635090616,
  :content
  {:content
   "I went to a conference, ignored all the talks and had a good time.",
   :direction "ltr"},
  :updated 1565629751000,
  :alternate
  [{:href
    "https://quanttype.net/posts/2019-08-12-hallway-track-conference.html",
    :type "text/html"}],
  :title "The hallway track conference",
  :author "quanttype",
  :published-str "Mon Aug 12 10:09:11 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16c871f98b8:f102fc:561e4df6",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url "https://quanttype.net/images/feest-bw.jpg",
   :width 1200,
   :height 800,
   :contentType "image/jpeg"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://quanttype.net/posts/2019-08-12-hallway-track-conference.html",
  :commonTopics
  [{:score 0.777,
    :id "nlp/f/topic/1326",
    :salienceLevel "mention",
    :label "lettering"}],
  :published 1565629751000,
  :fingerprint "666272fd",
  :canonicalUrl
  "https://quanttype.net/posts/2019-08-12-hallway-track-conference.html"}
 {:engagement 4,
  :unread false,
  :crawled 1565632068811,
  :recrawled 1565686257603,
  :content
  {:content
   "<p>Level 3 of functional thinking is all about algebraic thinking. But what do I mean by algebra? In this episode, I try to distill down the characteristics of an algebra and explore why algebras are worth developing.</p>\n<p></p>\n<h2>Transcript</h2>\n<p>Eric Normand: What is an algebra? By the end of this episode you will know the two characteristics that make an API into an algebra. My name is Eric Normand, and I help people thrive with functional programming. So this topic, I’m bringing it up because this is very important for level three of functional thinking.</p>\n<p>People have been asking me a lot of questions. Level three is all about algebraic thinking. They’ve been asking, “How do I develop that skill?” and “How do I get to level three, I’m at level two.”</p>\n<p>One of the things that you need to know is, what is an algebra? It’s good to describe what it is. I’ve used the term before with some programmers who don’t really understand why I would be using algebra. To them, algebra is this thing you learned in high school where you used a lot of letters instead of numbers and you learned to solve quadratic equations.</p>\n<p>What does this software design, basically functional programming software design, what does that have to do with an algebra? What is an algebra as opposed to algebra? That’s what I’m talking about in this episode.</p>\n<p>What is an algebra from a software-design perspective, not from a math perspective? I’m not trying to define algebra in the mathematical sense. They have a much more precise definition. It’s also used in several different ways. This is, I’m trying to get at what I’m trying to explain.</p>\n<p>I’m not the only one to use this term. I’ve heard Alan Kay talk about it. They’re like, “The point of software design is to find algebras.” I’m not alone. [laughs] There’s prior art from people who are way smarter and more certified than I am.</p>\n<p>The first approach I’m going to take to explain this — I’m also working on my approach right now — is that Martin Fowler wrote a book about domain-specific languages, DSL. In it, he tries to explain what an internal DSL is. When you write one, it looks a lot like just a regular interface. A regular API, you might call it.</p>\n<p>Why would you give that a different name? He talks about it. What he says, what his idea is — I tend to agree with this — is that, a DSL is an API, an internal DSL, not like you actually create a new grammar, you parse it, and stuff like that.</p>\n<p>An internal DSL where you use the host language’s pieces to make a new thing that it crosses some qualitative line and becomes very fluent. That’s his word. Starts to get very expressive. You can say what you need to say without resorting to any tricks or anything like that. It’s a qualitative measure.</p>\n<p>It’s still an API but you go from this push-button API — do this, do that — to a fluency, like, “Oh, I want my picture to look like this.” It’s a very similar qualitative change going from an API, an interface’s set of functions, to an algebra. There are two qualities to it that push it over that line. It is a spectrum.</p>\n<p>The line where it is is fuzzy, but pushing stuff toward the algebra side is a good idea. Here are the two characteristics. One, it’s abstract. Two, it is cohesive. I’ll explain what I mean.</p>\n<p>When we’re doing arithmetic, we’re working with numbers — 4, 10, 15. We got these operations like plus, times, minus, divide. When we first start algebra class, we start to replace those numbers with letters. It can be confusing. A lot of students don’t know what’s going on. They want to know what x is, for instance.</p>\n<p>Often you’ll say, “Oh, wait, it could be anything,” or you don’t know what x is, but you still have to figure out how to continue solving the problem. We got this number. Number is an abstract concept but it’s more concrete than a letter that represents some unknown number or all numbers. Put one number at a time but it could be out of all numbers.</p>\n<p>It’s a much more abstract concept. It lets you realize that there are things that are true about numbers and those operations that doesn’t depend on the individual number. You could say x/x = 1, as long as x doesn’t equal 0.</p>\n<p>This is a statement where, at the beginning of algebra class, the beginning of the year, a student could say, “What is x? I want to check. If it’s 3, then it’s 3/3. That does equal one. I can do that. If it’s 5, then it’s 5/5. Yes, it equals one.”</p>\n<p>Eventually, by doing enough of these problems, seeing enough of these formulas, they come to realize, “OK. I don’t need to know what x is. I can operate on the equation itself in this abstract, symbolic way and still do a lot of good, interesting work.” That’s what I mean by abstract. We’re able to start replacing specific values with variables. We still have meaning.</p>\n<p>I gave an example when I talked about level three, the three levels before. In level three, I talked about a video, “Algebra.”</p>\n<p>I could say something like, “If I concatenate video A with video B, I get video C whose length is the sum of the length of A and B.” I’m starting to speak very abstractly. This is a true statement regardless of what A is or what B is, how it was created, what type it is, any of those things. It doesn’t matter. I’m saying A and B in the abstract meaning anything, any video. That’s abstract.</p>\n<p>Now, cohesive, is required as well. Cohesive in the general sense means things go really well together. They are related. They work well together. I want to be a little bit more specific than that for my definition.</p>\n<p>Yes, they have to go well together but they have to go so well together, that you can start to define relationships between them using each other. We have what we call, identities in math. They’re basically equalities, their formulas with an equal sign.</p>\n<p>They relate how addition relates to subtraction, how addition relates to multiplication, how multiplication relates to division. You start to actually have these formal definitions for how they interrelate. It’s all expressed within the cohesive set of operations that you have. You don’t have to go elsewhere.</p>\n<p>One thing that happens in programming is we might come up with this really nice set of operations on a data type and then to define its behavior, we go outside that, we write some unit tests, and we get to do other things in the unit test.</p>\n<p>Wouldn’t it be better if we could say something like we say in mathematical algebra class. We could say A + B = C, means that C – A = B. We do that all the time. We will move the A to the other side of the equation.</p>\n<p>C – A = B is derivable from the first one, A + B = C. This is setting up a little relationship that if one is true, the other is true. If we can start to do that, if our set of operations is cohesive enough, we can start to set up these equalities.</p>\n<p>We can start to say, if I cut a video in half, or let’s say I could cut anywhere, as I say I cut the video A into B and C, and then I concatenate them back together, it should be the same as A. That’s like a little identity to say how they work, but in terms of each other very abstractly.</p>\n<p>Then, you can start to do those kinds of symbolic manipulations that you do in algebra class. You can work on the equation, you can move stuff around and cancel things out, and move all the known to one side so that you can solve for the unknown.</p>\n<p>You can do all those kinds of manipulations, not ever having a specific value for those variables. You don’t have to have the value. That’s the kind of place that we want to get in level three, where we don’t even have to have the value.</p>\n<p>We’re able to reason on paper, on the chalkboard just moving stuff around and what we’re doing is true. What we’re doing is making progress toward whatever goal we have, but we never actually had a real value.</p>\n<p>These things are so cohesive and abstract that we can start building on them and they’re likely never to change like you could get it to the point where you’ve gotten rid of all the corner cases, it’s a small API, and now you can compose them together to solve your problem.</p>\n<p>You can compose a whole video editing suite out of these basic little operations, so you get those right and now it’s just like a game of making the UI. That’s the idea of level three, and that’s what I mean by algebra.</p>\n<p>There’s two algebras that you’re probably familiar with as a programmer. There is Boolean algebra, which operates on true, false, and it defines all these operators like “or” and “and,” and stuff like that.</p>\n<p>They’re defined in terms of each other. You can define or… [laughs] or you can define in terms of negation and arrow. Double arrow can be defined in terms of “arrow” and “and.” They’re all interrelated. That is what makes it an algebra.</p>\n<p>You can transform the not of an or, the negation of an or, into the and of the negation. It’s like all these little identities that let you manipulate symbols. You don’t have to know if it’s true or false.</p>\n<p>You can manipulate symbols and you can find an answer without ever having specific values. Another one is the relational algebra and this defines relations, which are like database tables.</p>\n<p>They have two pools with name values in them and defines all sorts of operations on them. You can define some operations in terms of others, and you always are operating at this level of relations, which is another thing that I’m not sure of, but I’m going to bring it up.</p>\n<p>Algebra is probably, I’m not sure, it’s probably always with one or maybe a small number two or three very related types. Usually, it’s one type. Like look at the relational algebra. It’s one type, the relation.</p>\n<p>Even if you have one row in your table, one tuple, that it’s a relation of one. You have an empty relation, and you’re always manipulating relations. Same with Boolean algebra. You’re always dealing with true and false, a Boolean value, and you can’t escape it because everything returns another Boolean.</p>\n<p>Likewise, in the video-editing algebra, you’re always dealing with a segment of video. You take a segment and another segment, and you put them together, now you have a new segment.</p>\n<p>I think that’s pretty secure, but I’m not ready to go there yet. I would love to hear your thoughts on that. If you like this episode and you want to see past episodes, you can go to lispcast.com/podcast. There you will find all the past episodes including audio, video and text transcripts.</p>\n<p>You’ll also find links to subscribe to the episodes, either podcast or on YouTube or RSS, if you’re doing the blog reader. You’ll also find links to social media, where you can get into discussions with me. If you have any ideas on this, email me, tweet me, LinkedIn message me, love to get into discussions and really dig deep into this. Cool.</p>\n<p>My name is Eric Normand. This has been my thought on functional programming. Thank you for being there and rock on.</p>\n<p>The post <a rel=\"nofollow\" href=\"https://lispcast.com/what-is-an-algebra/\">What is an algebra?</a> appeared first on <a rel=\"nofollow\" href=\"https://lispcast.com\">LispCast</a>.</p>",
   :direction "ltr"},
  :updated 1565586000000,
  :entities
  [{:mentions [{:text "API"}],
    :id "nlp/f/entity/wd:165194",
    :salienceLevel "mention",
    :label "application programming interface"}
   {:mentions [{:text "software design"}],
    :id "nlp/f/entity/wd:857102",
    :salienceLevel "mention",
    :label "software design"}
   {:mentions [{:text "functional programming"}],
    :id "nlp/f/entity/wd:193076",
    :salienceLevel "mention",
    :label "functional programming"}
   {:mentions [{:text "type"} {:text "data type"}],
    :id "nlp/f/entity/wd:190087",
    :salienceLevel "mention",
    :label "data type"}
   {:mentions [{:text "video editing"}],
    :id "nlp/f/entity/wd:1154312",
    :salienceLevel "mention",
    :label "video editing"}],
  :alternate
  [{:href "https://lispcast.com/what-is-an-algebra/",
    :type "text/html"}],
  :title "What is an algebra?",
  :author "Eric Normand",
  :published-str "Sun Aug 11 22:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16c86f17ccb:e9c6d9:4b2e0c8b",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url
   "https://lispcast.com/wp-content/uploads/2018/07/ERIC-NORMAND-LISPCAST.COM_.jpg",
   :width 513,
   :height 557,
   :contentType "image/jpeg"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://lispcast.com/what-is-an-algebra/",
  :updateCount 1,
  :commonTopics
  [{:score 44.52419133480729,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.998,
    :id "nlp/f/topic/1421",
    :salienceLevel "about",
    :label "math education"}
   {:score 0.95,
    :id "nlp/f/topic/1689",
    :salienceLevel "about",
    :label "paper"}],
  :published 1565586000000,
  :fingerprint "49d555c",
  :canonicalUrl "https://lispcast.com/what-is-an-algebra/"}
 {:engagement 4,
  :unread false,
  :crawled 1565606816761,
  :content
  {:content
   "<div>\n<p><em>Issue 339 – August 12, 2019 · <a href=\"https://purelyfunctional.tv/newsletter-archives/\">Archives</a> · <a title=\"Thanks, Jeff!\" href=\"https://purelyfunctional.tv/newsletter/\">Subscribe</a></em></p>\n<h2>Clojure Tip 💡</h2>\n<p><em>Design is about pulling things apart</em></p>\n<p>I think it was Rich Hickey who said this. It’s a big part of the philosophy of Clojure and its community. Pulling things apart is why we have reducers. It pulls apart folding from order so it can be parallelized. Pulling things apart is why we have transducers. It pulls apart sequence operations (like <code>map</code>: do <code>f</code> to every element) from where you find the items (sequences or core.async channels). It’s also what lets Datomic scale reads separate from writes. And of course, there’s the term <em>decomplect</em>.</p>\n<p>I don’t now if design is <em>only</em> about pulling things apart, but it’s a big part of it. Pulling things apart lets you get really granular when you’re controlling things. So much complexity comes from not having the precise control you need. Instead, you’re doing workarounds, which add complexity. If you could just get down a layer, where things are controlled separately, you could do just what was needed.</p>\n<p>But it’s not easy. The first step is to recognize the problem. The second step is to see that maybe things could be separated. Third is figuring out how to separate them. This third step is usually a messy, iterative process with many experiments. You won’t know if you can succeed until you do.</p>\n<p>Even if you don’t succeed, it’s worth the effort. You’ll learn a lot.</p>\n<h2>Just finished reading 📖</h2>\n<p><a title href=\"https://www.goodreads.com/book/show/319006.At_Home_in_the_Universe\"><em>At home in the universe</em></a> by Stuart Kauffman.</p>\n<p>Well, what a great book. It came out in 1995. Complexity theory was so hot then, and this book had a lot to do with it. By working with computational models, Kauffman explains a lot about our universe and why there is life. After reading a few chapters, I was very convinced that life is inevitable. The details are random, but it’s quite easy to reach a critical mass of proteins that self-catalyze. Once you’re over the threshold, you get a mess of new proteins, and those new proteins make it even more likely to catalyze.</p>\n<p>It made me think a lot about computation. What can we learn from life to design distributed systems that are vastly larger than we currently do? How can you guarantee that it will converge on an answer?</p>\n<p>This book has not changed my life, but I think it could have if I had read it when I was younger. In High School, I was getting into Complexity Theory and Artificial Life, but I never came across this book. If I had read it then, it may have altered my path substantially.</p>\n<h2>Book status 📖</h2>\n<p>Well, I am confident now that the book will be published very soon. It was in process internally at the publisher for a while, but it looks like it could emerge this week. Yes, it has been stressful. I want my book out there, and if the messages I get are any indication, many people also want it. But the publisher is making it as good as they can before it comes out.</p>\n<p>I’ll keep posting about it weekly in the newsletter. Or you can sign up for the book-specific launch list <a title href=\"https://lispcast660.activehosted.com/f/3\">here</a>.</p>\n<h2>Currently recording 🎥</h2>\n<p>I am now recording a course called <a title href=\"https://purelyfunctional.tv/courses/property-based-testing-with-test-check/\"><em>Property-Based Testing with test.check</em></a>. Property-based testing (PBT) is a powerful tool for generating tests instead of writing them. You’ll love the way PBT makes you think about your system. And you can <a title href=\"https://purelyfunctional.tv/courses/property-based-testing-with-test-check/\">buy it now</a> in Early Access. Of course, PF.tv members have had access since the beginning, along with all of the other courses.</p>\n<p>New lessons this week include:</p>\n<ol>\n<li><a title href=\"https://purelyfunctional.tv/lesson/strategies-for-properties-generate-the-output/\">Strategies for properties: generate the output</a> — in which test things that are not easy to generate.</li>\n<li><a title href=\"https://purelyfunctional.tv/lesson/strategies-for-properties-metamorphic-properties/\">Strategies for properties: metamorphic properties</a> — in which we test things even if we don’t know exactly what they do.</li>\n<li><a title href=\"https://purelyfunctional.tv/lesson/behind-the-scenes-size/\">Behind the scenes: size</a> — in which we peer behind the curtain at how random values are.</li>\n</ol>\n<p>Last week I said that there were three more lessons for properties, and here I am showing you only two. I reviewed the notes for the third one and I had already covered everything. Soon we’re going to get into real testing examples. But before that, we have to talk about shrinkage.</p>\n<p>I’ve made the first and fifth lessons free to watch. <a title href=\"https://purelyfunctional.tv/courses/property-based-testing-with-test-check/\">Go check them out</a>.</p>\n<p>Members already have access to the lessons. The Early Access Program is open. If you <a title href=\"https://purelyfunctional.tv/courses/property-based-testing-with-test-check/\">buy now</a>, you will get the already published material and everything else that comes out at a serious discount. There are already 6 hours of video, and looking at my plan, this one might be 9-10 hours. But that’s just an estimate. It could be more or less. The uncertainty about it is why there’s such a discount for the Early Access Program.</p>\n<h2>Clojure Challenge 🤔</h2>\n<h3>Last week’s challenge</h3>\n<p>The puzzle in <a title href=\"https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-338-tip-re-implement-multiple-times/\">Issue 338</a> was to write a function that created the derivative of a function using the limit definition of the derivative.</p>\n<p>You can check out the submissions <a title href=\"https://gist.github.com/ericnormand/7846a50315f101e54e0038ad12c9a46b\">here</a>.</p>\n<h3>This week’s challenge</h3>\n<p><em>symbolic differentiation</em></p>\n<p>I got excited last week by the numeric differentiator challenge. When I originally read that section of SICP so many years ago, I was elated. Do you know how hard that would be to do in Java?</p>\n<p>Now for something that’s even harder to do in Java: symbolic differentiation.</p>\n<p>Here’s the <a title href=\"https://mitpress.mit.edu/sites/default/files/sicp/full-text/book/book-Z-H-16.html#%_sec_2.3.2\">relevant link into SICP</a>, for reference.</p>\n<p>The challenge this week is to use four differentiation formulas to make a symbolic differentiator. It has been a while since I’ve done any calculus, so I had to look these up:</p>\n<ol>\n<li><code>dc/dx = 0</code> (for a constant c, or variable c different from x)</li>\n<li><code>dx/dx = 1</code></li>\n<li><code>d(u+v)/dx = du/dx + dv/dx</code> (addition rule)</li>\n<li><code>d(uv)/dx = u(dv/dx) + v(du/dx)</code> (product rule)</li>\n</ol>\n<p>This won’t differentiate every formula, but it will differentiate sums and products of variables and numbers. You should make a function that takes an expression and a variable to differentiate by, like so:</p>\n<pre><code>(deriv '(+ x 5) 'x) ;=> (+ 1 0)\n</code></pre>\n<p>Don’t worry about simplifying the final expression. Just make sure it’s right.</p>\n<p>As usual, please send me your implementations. I’ll share them all in next week’s issue. If you send me one, but you don’t want me to share it publicly, please let me know.</p>\n<p>Rock on!\nEric Normand</p>\n</div>\n<p>The post <a rel=\"nofollow\" href=\"https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-339-design-is-about-pulling-things-apart/\">PurelyFunctional.tv Newsletter 339: Design is about pulling things apart</a> appeared first on <a rel=\"nofollow\" href=\"https://purelyfunctional.tv\">PurelyFunctional.tv</a>.</p>",
   :direction "ltr"},
  :updated 1565604000000,
  :entities
  [{:mentions [{:text "newsletter"}],
    :id "nlp/f/entity/wd:264238",
    :salienceLevel "about",
    :label "newsletter"}
   {:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "Kauffman"} {:text "Stuart Kauffman"}],
    :id "nlp/f/entity/wd:516009",
    :salienceLevel "mention",
    :label "Stuart Kauffman"}
   {:mentions [{:text "critical mass"}],
    :id "nlp/f/entity/wd:208470",
    :salienceLevel "mention",
    :label "critical mass"}
   {:mentions [{:text "SICP"}],
    :id "nlp/f/entity/wd:1249747",
    :salienceLevel "mention",
    :label "Structure and Interpretation of Computer Programs"}],
  :alternate
  [{:href
    "https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-339-design-is-about-pulling-things-apart/",
    :type "text/html"}],
  :title
  "PurelyFunctional.tv Newsletter 339: Design is about pulling things apart",
  :author "Eric Normand",
  :published-str "Mon Aug 12 03:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16c85702bf9:c851fe:561e4df6",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://purelyfunctional.tv/?p=31833",
  :published 1565604000000,
  :fingerprint "11dec66d",
  :canonicalUrl
  "https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-339-design-is-about-pulling-things-apart/"}
 {:engagement 4,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1565593354078,
  :recrawled 1565922822873,
  :content
  {:content
   "Ambrose Bonnaire-Sergeant talks about Spec, typing, and doing three degrees in Typed Clojure. Typed Clojure In Theory and Practice - Ambrose Bonnaire-Sergeant (pdf) Spectrum Patreon - Ambrose core.typed.analyzer.jvm core.typed.annotator.jvm cljfx Ambrose’s Blog",
   :direction "ltr"},
  :updated 1565587721000,
  :alternate
  [{:href "https://www.therepl.net/episodes/28/", :type "text/html"}],
  :title "28: Ambrose Bonnaire-Sergeant on Typed Clojure",
  :author "Daniel Compton",
  :published-str "Sun Aug 11 22:28:41 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16c84a2bf5e:b583ec:4b2e0c8b",
  :visual {:url "none"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://www.therepl.net/episodes/28/",
  :updateCount 1,
  :commonTopics
  [{:score 29.043431402264453,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1565587721000,
  :fingerprint "d55eac84",
  :canonicalUrl "https://www.therepl.net/episodes/28/"}
 {:engagement 5,
  :unread false,
  :crawled 1565465201292,
  :recrawled 1565632068811,
  :content
  {:content
   "<p>In the last few months, I have learned a lot about modern JavaScript and CSS development with a local toolchain powered by Node 8, Webpack 4, and Babel 7. As part of that, I am doing my second “re-introduction to JavaScript”. I first learned JS in 1998. Then relearned it from scratch in 2008, in the era of “The Good Parts”, Firebug, jQuery, IE6-compatibility, and eventually the then-fledgling Node ecosystem. In that era, I wrote one of the most widely deployed pieces of JavaScript on the web, and maintained a system powered by it.</p>\n<div align=\"center\">\n<img alt=\"\" width=\"500\" src=\"http://amontalenti.com/wordpress/wp-content/uploads/2019/01/js_crossout.png\" class=\"wp-image-2689\" height=\"656\">\n</div>\n<p>Now I am re-learning it in the era of ECMAScript (ES6 / ES2017), transpilation, formal support for libraries and modularization, and, mobile web performance with things like PWAs, code splitting, and WebWorkers / ServiceWorkers. I am also pleasantly surprised that JS, via the ECMAScript standard and Babel, has evolved into a pretty good programming language, all things considered.</p>\n<p>To solidify all this stuff, I am using webpack/babel to build all static assets for a simple Python/Flask web app, which ends up deployed as a multi-hundred-page static site.</p>\n<p>One weekend, I ported everything from <code>Flask-Assets</code> to <code>webpack</code>, and to play around with ES2017 features, as well as explore the Sass CSS preprocessor and some D3.js examples. And boy, did that send me down a yak shaving rabbit hole. Let’s start from the beginning!</p>\n<h2>JavaScript in 1998</h2>\n<p>I first learned JavaScript in 1998. It’s hard to believe that this was 20 years — two decades! — ago. This post will chart the two decades since — covering JavaScript in 1998, 2008, and 2018. The focus of the article will be on “modern” JavaScript, as of my understanding in 2018/2019, and, in particular, what a non-JavaScript programmer should know about how the language — and its associated tooling and runtime — have dramatically evolved. If you’re the kind of programmer who thinks, “I code in Python/Java/Ruby/C/whatever, and thus I have no use for JavaScript and don’t need to know anything about it”, you’re wrong, and I’ll describe why. Incidentally, you were right in 1998, you could get by without it in 2008, and you are dead wrong in 2018.</p>\n<p>Further, if you are the kind of programmer who thinks, “JavaScript is a tire fire I’d rather avoid because it lacks basic infrastructure we take for granted in ‘real’ programming languages”, then you are also wrong. I’ll be able to show you how “not taking JavaScript seriously” is the 2018 equivalent of the skeptical 2008-era programmer not taking Python or Ruby seriously. JavaScript is a language that is not only here to stay, but has already — and will continue to — take over the world in several important areas. To be a serious programmer, you’ll have to know JavaScript’s Modern and Good Parts — as well as some other server-side language, like Python, Ruby, Go, Elixir, Clojure, Java, and so on. But, though you can swap one backend language for the other, you can’t avoid JavaScript: it’s pervasive in every kind of web deployment scenario. And, the developer tooling has fully caught up to your expectations.</p>\n<p><span></span></p>\n<h2>JavaScript during The Browser Wars</h2>\n<p>Browsers were a harsh environment to target for development; not only was Internet adoption low and not only were internet connections slow, but the browser wars — mainly between Netscape and Microsoft — were creating a lot of confusion.</p>\n<p>Netscape Navigator 4 was released in 1997, and Internet Explorer 5 was released in 1998. The web was still trying to make sense of HTML and CSS; after all, CSS1 had only been released a year earlier.</p>\n<p>In this environment, the definitive web development book of the era was “JavaScript: The Definitive Guide”, which weighed in at over 500 pages. Note that, in 1998, the most widely used programming languages were C, C++, and Java, as well as Microsoft Visual Basic for Windows programmers. So expectations about “what programming was” were framed mostly around these languages.</p>\n<p>In this sense, JavaScript was quite, quite different. There was no compiler. There was no debugger (at least, not very good ones). There was no way to “run a JavaScript program”, except to write scripts in your browser, and see if they ran. Development tools for JavaScript were still primitive or inexistent. There was certainly not much of an open source community around JS; to figure out how to do things, you would typically “view source” on other people’s websites. Plus, much of the discussion in the programming community of web developers was how JavaScript represented a <em>compatibility and security nightmare</em>.</p>\n<p>Not only differing implementations across browsers, but also many ways for you to compromise the security of your web application by relying upon JavaScript too directly. A common security bug in that era was to validate forms with JavaScript, but still allow invalid (and insecure) values to be passed to the server. Or, to password-protect a system, but in a way that inspection of JavaScript code could itself crack access to that system. Combined with the lack of a proper development environment, the “real web programmers” used JavaScript as nothing more than a last resort — a way to inject a little bit of client-side code and logic into pages where doing it server-side made no sense. I remember one of the most common use cases for JavaScript at the time was nothing more than changing an image upon hover, as a stylistic effect, or implementing a basic on-hover menu on a complex multi-tab form. These days, these tasks can be achieved with vanilla CSS, but, at the time, JavaScript DOM manipulation was your only option.</p>\n<h2>JavaScript in 2008</h2>\n<p>Fast forward 10 years. In 2008, Douglas Crockford released the book, <a href=\"https://amzn.to/2YISBfz\">“JavaScript: The Good Parts”</a>. By using a language subsetting approach, Crockford pointed out that, not only was JavaScript not a bad language, it was actually a good language, well-designed, with certain key features that made it stand out vs competitors.</p>\n<p>Around this time, several JavaScript libraries were becoming popular, notably jQuery, Prototype, YUI, and Dojo. These libraries attempted to provide JavaScript with something it was missing: a cross-browser compatibility layer and programming model for doing dynamic manipulation of pages inside the browser, and especially for a new model of JavaScript programming that was emerging, with the moniker AJAX. This was the beginning of the trend of rich internet applications, “dynamic” web apps, single-page applications, and the like.</p>\n<h2>JavaScript’s Tooling Leaps</h2>\n<p>The developer tooling for JavaScript also took some important leaps. In 2006, the Firefox team released Firebug, a JavaScript and DOM debugger for Firefox, which was then one of the world’s most popular web browsers, and open source. Two years later, Google would make the first release of Google Chrome, which bundled some developer tooling. Around the same time that Chrome was released, Google also released V8, the JavaScript engine that was embedded inside of Chrome. That marked the first time that the world had seen a full-fledged, performant open source implementation of the JavaScript language that was not completely tied to a browser. Firefox’s JS engine, SpiderMonkey, was part of its source tree, but was not necessarily marketed to be modularized and used outside the context of the Firefox browser.</p>\n<p>I remember that aside from Crockford’s work on identifying the good parts of JavaScript, and aside from the new (and better) developer tooling, a specific essay on Mozilla’s website helped me re-appreciate the language, and throw away my 1998 conception. That article was called <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/A_re-introduction_to_JavaScript\">“A Reintroduction to JavaScript”</a>. It showed how JavaScript was actually a real programming language, once you got past the tooling bumps. A little under-powered in its standard library, thus you had to rely upon frameworks (like jQuery) to give you some tools, and little micro-libraries beyond that.</p>\n<p>A year after reading that essay, I wrote my own about JavaScript, which was called “Real, Functional Programs with JavaScript” (<a href=\"https://www.dropbox.com/s/0fyzrx32ppfkqph/functional_js.pdf?dl=0\">archived PDF here</a>). It described how JavaScript was, quite surprisingly, more of a functional language than Java 8 or Python 2.7. And that with a little focus on understanding the functional core, really good programs could be written. I recently converted this essay into a set of instructional slides with the name, “Lambda JavaScript” (<a href=\"https://amontalenti.com/pub/lambda-javascript/notes/\">archived notes here</a>), which I now use to teach new designers/developers the language from first principles.</p>\n<p>But, let’s return to history. Only a year after the release of Chrome, in 2009, we saw the first release of NodeJS, which took the V8 JavaScript engine and embedded it into a server-side environment, which could be used to both experiment with JavaScript on a REPL, write scripts, and write HTTP servers on a performant event loop.</p>\n<p>People began to experiment with command-line tools written in JavaScript, and with web frameworks written in JavaScript. It was at this point that the pace of development in the JavaScript community accelerated. In 2010, npm — the Node Package Manager — was released, and it and its package registry quickly grew to represent the full JavaScript open source community. Over the next few years, the browser vendors of Mozilla, Google, Apple, and Microsoft engaged in the “JavaScript Engine Wars”, with each developing SpiderMonkey, V8, Nitro, and Chakra to new heights.</p>\n<p>Meanwhile, NodeJS and V8 became the “standard” JS engine running on developer’s machines from the command line. Though developers still had to target old “ECMAScript 3” browsers (such as IE6), and thus had to write restrained JavaScript code, the “evergreen” (auto-updating) browsers from Mozilla, Google, and Apple gained support for ECMAScript 5 and beyond, and mobile web browsing went into ascendancy, thus making Chrome and Safari dominant in market share especially on smartphones.</p>\n<p>In all of this noise of web 2.0, cloud, and mobile, we finally reached “mobilegeddon” in 2015, where mobile traffic surpassed desktop traffic, and we also saw several desktop operating systems move to a mostly-evergreen model, such as Windows 10, Mac OS X, and ChromeOS. As a result, as early as 2015 — but certainly by 2018 — JavaScript became the most widely deployed and performant programming language with “built-in support” on almost every desktop and mobile computer in the world.</p>\n<p>In other words, if you want your code to be “write once, run everywhere” in 2018, your best option is JavaScript.</p>\n<h2>JavaScript in 2018-2019</h2>\n<p>In 2018-2019, several things have changed about the JavaScript community. Development tools are no longer fledgling, but are, instead, mature. There are built-in development tools in all of Safari, Firefox, and Chrome browsers (and the Firebug project is mostly deprecated). There are also ways to debug mobile web browsers using mobile development tools. NodeJS and npm are mature projects that are shared infrastructure for the whole JavaScript community.</p>\n<p>What’s more, JavaScript, as a language, has evolved. It’s no longer just the kernel language we knew in 1998, nor the “good parts” we knew in 2008, but instead the “modern parts” of JavaScript include several new language features that go by the name “ES6” (ECMAScript v6) or “ES2017” (ECMAScript 2017 Edition), and beyond.</p>\n<p>Some concepts in HTML have evolved, such as HTML5 video and audio elements. CSS, too, has evolved, with the CSS2 and CSS3 specifications being ratified and widely adopted. JSON has all but entirely replaced XML as an interchange format and is, of course, JavaScript-based.</p>\n<p>The V8 engine has also gotten a ton of performance-oriented development. It is now a JIT compiled language with speedy startup times and speedy near-native performance for CPU-bound blocks. Modern web performance techniques are almost entirely based on a speedy JavaScript engine and the ability to script different elements of a web application’s loading approach.</p>\n<p>The language itself has become comfortable with something akin to “compiler” and “command line” toolchains you might find in Python, Ruby, C, and Java communities. In lieu of a JavaScript “compiler”, we have node, JavaScript unit testing frameworks like Mocha/Jest, as well as eslint and babel for syntax checking. (More on this later.)</p>\n<p>In lieu of a “debugger”, we have the devtools built into our favorite browser, like Chrome or Firefox. This includes rich debuggers, REPLs/consoles, and visual inspection tools. Scriptable remote connections to a node environment or a browser process (via new tools like Puppeteer) further close the development loop.</p>\n<p>To use JavaScript in 2018, therefore, is to adopt a system that has achieved 2008-era maturity that you would see in programming ecosystems like Python, Ruby, and Java. But, in many ways, JavaScript has surpassed those communities. For example, where Python 3’s reference implementation, CPython, is certainly fast as far as dynamic languages go, JavaScript’s reference implementation, V8, is optimized by JIT and hotspot optimization techniques that are only found in much older programming communities, such as Java’s. That means that unmodified, hotspot JavaScript code can be optimized into native code automatically by the Node runtime and by browsers such as Chrome.</p>\n<p>Whereas Java and C users may still have debates about where, exactly, open source projects should publish their releases, that issue is settled in the JavaScript community: it’s npm, which operates similarly to PyPI and pip in the Python community.</p>\n<p>Some essential developer tooling issues were only recently settled. For example, because modern JavaScript (such as code written using ES2017 features) needs to target older browsers, a “transpilation” toolchain is necessary, to compile ES2017 code into ES3 or ES5 JavaScript code, suitable for older browsers. Because “old JavaScript” is a Turing complete, functional programming language, we know we can translate almost any new “syntactic sugar” to the old language, and, indeed, the designers of the new language features are being careful to only introduce syntax that can be safely transpiled.</p>\n<p>What this means, however, is that to do JavaScript development “The Modern Way”, while adopting its new features, you <em>simply must</em> use a local transpiler toolchain. The community standard for this at the moment is known as <a href=\"https://babeljs.io\">babel</a>, and it’s likely to remain the community standard well into the future.</p>\n<p>Another issue that plagued 2008-era JavaScript was build tooling and modularization. In the 2008-2012 era, ad-hoc tools like <code>make</code> were used to concatenate JavaScript modules together, and often Java-based tools such as Google’s Closure Compiler or UglifyJS were used to assemble JavaScript projects into modules that could be included onto pages. In 2012, the Grunt tool was released as a JavaScript build tool, written atop NodeJS, runnable from the command-line, and configurable using a JavaScript “Gruntfile”. A whole slew of build tools similar to this were released in the period, creating a whole lot of code churn and confusion.</p>\n<p>Thankfully, today, Single Page Application frameworks like React have largely solved this problem, with the ascendancy of <code>webpack</code> and the reliance on <code>npm run-script</code>. Today, <a href=\"https://webpack.js.org\">the webpack community</a> has come up with a sane approach to JavaScript modularization that relies upon the modern JS support for modules, and then development-time tooling, provided mainly through the <code>webpack</code> CLI tool, allow for local development and production builds. This can all be scripted and wired together with simple <code>npm run-script</code> commands. And since <code>webpack</code> can be itself installed by <code>npm</code>, this keeps the entire development stack self-contained in a way that doesn’t feel too dissimilar from what you might enjoy with <code>lein</code> in Clojure or <code>python/pip</code> in Python.</p>\n<p>Yes, it has taken 20 years, but JavaScript is now just as viable a choice for your backend and CLI tooling projects as Python was in the past. And, for web frontends, it’s your only choice. So, if you are a programmer who cares, at all, about distribution of your code to users, it’s time to care about JavaScript!</p>\n<p>In a future post, I plan to go even deeper on JavaScript, covering:</p>\n<ul>\n<li>How to structure your first “modern” JavaScript project</li>\n<li>Using Modern JS with Python’s Flask web framework for simple static sites</li>\n<li>Understanding <code>webpack</code>, and why it’s important</li>\n<li>Modules, modules, modules. Why JS modules matter.</li>\n<li>Understanding <code>babel</code>, and why it’s important</li>\n<li>Transpilation, and how to think about evolving JS/ES features and “compilation”</li>\n<li>Using <code>eslint</code> for bonus points</li>\n<li>Using sourcemaps for debugging</li>\n<li>Using <code>console.assert</code> and <code>console</code> for debugging</li>\n<li>Production minification with <code>uglify</code></li>\n<li>Building automated tests with <code>jest</code></li>\n<li>Understanding the value of Chrome scripting and <code>puppeteer</code></li>\n</ul>\n<p>Want me to keep going? Let me know via <a href=\"https://twitter.com/amontalenti\">@amontalenti</a> on Twitter.</p>",
   :direction "ltr"},
  :updated 1565420451000,
  :entities
  [{:mentions [{:text "JavaScript"}],
    :id "nlp/f/entity/wd:2005",
    :salienceLevel "mention",
    :label "JavaScript"}
   {:mentions [{:text "JS engine"} {:text "JavaScript engine"}],
    :id "nlp/f/entity/wd:591919",
    :salienceLevel "mention",
    :label "JavaScript engine"}
   {:mentions [{:text "CPython"} {:text "Python"}],
    :id "nlp/f/entity/wd:599384",
    :salienceLevel "mention",
    :label "CPython"}
   {:mentions [{:text "Node"} {:text "NodeJS"}],
    :id "nlp/f/entity/wd:756100",
    :salienceLevel "mention",
    :label "Node.js"}
   {:mentions [{:text "Babel"}],
    :id "nlp/f/entity/wd:191074",
    :salienceLevel "mention",
    :label "Babel"}],
  :alternate
  [{:href
    "http://amontalenti.com/2019/08/10/javascript-the-modern-parts",
    :type "text/html"}],
  :title "JavaScript: The Modern Parts",
  :author "Andrew Montalenti",
  :published-str "Sat Aug 10 00:00:51 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16c7cff4a8c:47427f:73d34570",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url
   "http://amontalenti.com/wordpress/wp-content/uploads/2019/01/js_crossout.png",
   :width 500,
   :height 656,
   :contentType "image/png"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://amontalenti.com/?p=2506",
  :updateCount 2,
  :commonTopics
  [{:score 229.60297829582535,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.943,
    :id "nlp/f/topic/1555",
    :salienceLevel "about",
    :label "net"}
   {:score 0.877,
    :id "nlp/f/topic/590",
    :salienceLevel "about",
    :label "css"}
   {:score 0.874,
    :id "nlp/f/topic/334",
    :salienceLevel "about",
    :label "browsers"}
   {:score 0.871,
    :id "nlp/f/topic/2461",
    :salienceLevel "about",
    :label "web design"}
   {:score 0.817,
    :id "nlp/f/topic/774",
    :salienceLevel "mention",
    :label "engineering"}],
  :published 1565420451000,
  :fingerprint "f173ca40",
  :canonicalUrl
  "http://amontalenti.com/2019/08/10/javascript-the-modern-parts"}
 {:engagement 5,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1565454380713,
  :recrawled 1565462188268,
  :content
  {:content
   "<h2>Spec 2 - closed spec checking redo</h2>\n<p>I’ve mostly been doing spec 2 work in the last couple weeks. I finally completed the closed check rewrite that I started a while back. When I <a href=\"http://insideclojure.org/2019/04/19/journal/\">last visited</a> closed spec checking, we had gone down the path of a stateful approach to managing closed specs. After some reflection and feedback from the community, this has been replaced.</p>\n<p>The first big API level change is that all of the conform-oriented API calls (<code>conform</code>, <code>valid?</code>, <code>explain</code>, <code>explain-data</code>) now take an optional last argument <code>settings</code> which is a map keyed by setting. Initially there is just one setting available <code>:closed</code>, which takes a set of closed spec names. A brief example of closed spec checking:</p>\n<figure><pre><code><span>(</span><span>require</span><span> </span><span>'</span><span>[</span><span>clojure.spec-alpha2</span><span> </span><span>:as</span><span> </span><span>s</span><span>])</span><span>\n</span><span>(</span><span>s/def</span><span> </span><span>::f</span><span> </span><span>string?</span><span>)</span><span>\n</span><span>(</span><span>s/def</span><span> </span><span>::l</span><span> </span><span>string?</span><span>)</span><span>\n</span><span>(</span><span>s/def</span><span> </span><span>::s</span><span> </span><span>(</span><span>s/schema</span><span> </span><span>[</span><span>::f</span><span> </span><span>::l</span><span>]))</span><span>\n</span><span>;; &quot;extra&quot; keys are ok normally - open maps are the default</span><span>\n</span><span>(</span><span>s/valid?</span><span> </span><span>::s</span><span> </span><span>{</span><span>::f</span><span> </span><span>&quot;Bugs&quot;</span><span> </span><span>::l</span><span> </span><span>&quot;Bunny&quot;</span><span> </span><span>::x</span><span> </span><span>10</span><span>})</span><span>\n</span><span>;;=> true</span><span>\n</span><span>;; but closed spec checking can be more restrictive</span><span>\n</span><span>(</span><span>s/valid?</span><span> </span><span>::s</span><span> </span><span>{</span><span>::f</span><span> </span><span>&quot;Bugs&quot;</span><span> </span><span>::l</span><span> </span><span>&quot;Bunny&quot;</span><span> </span><span>::x</span><span> </span><span>10</span><span>}</span><span> </span><span>{</span><span>:closed</span><span> </span><span>#</span><span>{</span><span>::s</span><span>}})</span><span>\n</span><span>;;=> false</span><span>\n</span><span>(</span><span>s/explain</span><span> </span><span>::s</span><span> </span><span>{</span><span>::f</span><span> </span><span>&quot;Bugs&quot;</span><span> </span><span>::l</span><span> </span><span>&quot;Bunny&quot;</span><span> </span><span>::x</span><span> </span><span>10</span><span>}</span><span> </span><span>{</span><span>:closed</span><span> </span><span>#</span><span>{</span><span>::s</span><span>}})</span><span>\n</span><span>#</span><span>:user</span><span>{</span><span>:f</span><span> </span><span>&quot;Bugs&quot;</span><span>,</span><span> </span><span>:l</span><span> </span><span>&quot;Bunny&quot;</span><span>,</span><span> </span><span>:x</span><span> </span><span>10</span><span>}</span><span> </span><span>-</span><span> </span><span>failed</span><span>:</span><span> </span><span>(</span><span>subset?</span><span> </span><span>(</span><span>set</span><span> </span><span>(</span><span>keys</span><span> </span><span>%</span><span>))</span><span> </span><span>#</span><span>{</span><span>:user/f</span><span> </span><span>:user/l</span><span>})</span></code></pre></figure>\n<p>One note around this change is its a pretty big change internally to the Spec protocol. It is pretty helpful though in opening up an avenue to other kinds of conditional checks in the future without needing any new api changes.</p>\n<h2>Spec 2 - symbolic data specs</h2>\n<p>One use case that we wanted to work on in spec 2 centers around programmatic creation and transformation of symbolic specs.\nWhile it’s possible to do this with symbolic spec forms, and the support for that has even been extended in spec 2 to avoid\nthe macro layer entirely, the form-oriented nature has been a barrier to some.</p>\n<p>As such, we are working on introducing a symbolic map format for ops that will parallel the symbolic form for ops. Parts of\nthis are in master now but it’s under active work still and will likely change a bit.</p>\n<p>But a quick example in its current form:</p>\n<figure><pre><code><span>;; creating a spec with symbolic form</span><span>\n</span><span>(</span><span>s/def</span><span> </span><span>::of</span><span> </span><span>(</span><span>s/or</span><span> </span><span>:k</span><span> </span><span>keyword?</span><span> </span><span>:i</span><span> </span><span>int?</span><span>))</span><span>\n</span><span>;; creating the same spec with symbolic map instead</span><span>\n</span><span>;; s/spec* is programmatic entry point to create spec objects from symbolic specs</span><span>\n</span><span>;; s/register is a function variant of s/def</span><span>\n</span><span>(</span><span>s/register</span><span> </span><span>::om</span><span> </span><span>(</span><span>s/spec*</span><span> </span><span>`</span><span>{</span><span>:clojure.spec/op</span><span> </span><span>s/or</span><span> </span><span>:keys</span><span> </span><span>[</span><span>:k</span><span> </span><span>:i</span><span>]</span><span> </span><span>:specs</span><span> </span><span>[</span><span>keyword?</span><span> </span><span>int?</span><span>]}))</span><span>\n</span><span>;; they produce the same spec in the registry</span><span>\n</span><span>(</span><span>s/conform</span><span> </span><span>::of</span><span> </span><span>100</span><span>)</span><span>\n</span><span>;;=> [:i 100]</span><span>\n</span><span>(</span><span>s/conform</span><span> </span><span>::om</span><span> </span><span>100</span><span>)</span><span>\n</span><span>;;=> [:i 100]</span><span>\n</span><span>(</span><span>s/explain</span><span> </span><span>::om</span><span> </span><span>&quot;abc&quot;</span><span>)</span><span>\n</span><span>&quot;abc&quot;</span><span> </span><span>-</span><span> </span><span>failed</span><span>:</span><span> </span><span>keyword?</span><span> </span><span>at</span><span>:</span><span> </span><span>[</span><span>:k</span><span>]</span><span> </span><span>spec</span><span>:</span><span> </span><span>:user/om</span><span>\n</span><span>&quot;abc&quot;</span><span> </span><span>-</span><span> </span><span>failed</span><span>:</span><span> </span><span>int?</span><span> </span><span>at</span><span>:</span><span> </span><span>[</span><span>:i</span><span>]</span><span> </span><span>spec</span><span>:</span><span> </span><span>:user/om</span><span>\n</span><span>(</span><span>s/form</span><span> </span><span>::om</span><span>)</span><span>\n</span><span>;;=> (clojure.spec-alpha2/or :k clojure.core/keyword? :i clojure.core/int?)</span><span>\n</span><span>;; new operation to expand a form to a map</span><span>\n</span><span>(</span><span>s/expand-spec</span><span> </span><span>`</span><span>(</span><span>s/or</span><span> </span><span>:k</span><span> </span><span>keyword?</span><span> </span><span>:i</span><span> </span><span>int?</span><span>))</span><span>\n</span><span>;;=> {:clojure.spec/op clojure.spec-alpha2/or, </span><span>\n</span><span>;; :keys [:k :i], </span><span>\n</span><span>;; :specs [clojure.core/keyword? clojure.core/int?]}</span></code></pre></figure>\n<p>We’re continuing to push on the relationship between the symbolic form, symbolic map, and even the conform output and consider more automated conversions between the form and map versions, ways to potentially work/transform specs in the map form, support for datafy, etc. More to come.</p>\n<h2>tools.deps</h2>\n<p>I spent some time this week on a few bugs and some perf issues in tools.deps based on some reports. Exclusion symbols were never canonicalized (so <code>compojure</code> wouldn’t exclude <code>compojure/compojure</code>). That should be fixed in next release. I happened to notice that pom deps were including all transitive deps regardless of scope, instead of narrowing to just compile and runtime deps so I fixed that. And there have been some complaints that tools.deps includes slf4j-nop as a dep. slf4j is a pluggable logging framework and the nop logger is a “don’t log” plugin, which takes away the choice for library consumers to plug as they wish. tools.deps will remove that dependency but it will still be included in the clj installation.</p>\n<p>Finally, there were some perf-related issues where it seemed like the same resource was being requested many times. I did some poking at this and we were a) not installing the Maven session repository cache and b) not reusing the Maven session throughout the classpath generation process. In many cases, this doesn’t make that much of a difference, but it is particularly pronounced if you have a large number of deps and if you include slow repositories (like an s3 repo). Anyhow, there is now a session API that will be available for tooling consumers and it’s enabled for use with clj. The next version of clj should have, in some cases, faster classpath generation (but won’t affect anything if cp is already cached). I do not think this is the end of the story - there are still a few additional things that caught my eye but this seemed like a big improvement in the meantime.</p>\n<p>I am still testing some of these changes, so new clj is not yet available. tools.deps has been released though - if you’re a tool maker, feel free to follow up on clojurians slack.</p>\n<h2>Ask Clojure</h2>\n<p>Lots of questions coming in on the <a href=\"https://ask.clojure.org\">Ask Clojure forum</a> this week! If you haven’t yet, check it out.</p>\n<p>Also, I made a Twitter account, <a href=\"https://twitter.com/AskClojure\">@AskClojure</a> that is tweeting any new questions if you want to watch that. There are many RSS feeds available on the Ask Clojure site - if you need a link to something (like recent questions, recent activity, etc), let me know.</p>",
   :direction "ltr"},
  :updated 1565395200000,
  :entities
  [{:mentions [{:text "API"}],
    :id "nlp/f/entity/wd:165194",
    :salienceLevel "about",
    :label "application programming interface"}
   {:mentions [{:text "Maven"}],
    :id "nlp/f/entity/wd:139941",
    :salienceLevel "mention",
    :label "Apache Maven"}
   {:mentions [{:text "RSS"}],
    :id "nlp/f/entity/wd:45432",
    :salienceLevel "mention",
    :label "Rich Site Summary"}
   {:mentions [{:text "Twitter"}],
    :id "nlp/f/entity/wd:918",
    :salienceLevel "mention",
    :label "Twitter"}],
  :alternate
  [{:href "http://insideclojure.org/2019/08/10/journal/",
    :type "text/html"}],
  :title "Journal 2019.22 - spec updates, tools.deps",
  :author "Inside Clojure",
  :published-str "Fri Aug 09 17:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16c7c5a2ea9:3d734f:561e4df6",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "http://insideclojure.org/2019/08/10/journal/",
  :updateCount 1,
  :commonTopics
  [{:score 28.010805443878468,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.998,
    :id "nlp/f/topic/334",
    :salienceLevel "about",
    :label "browsers"}
   {:score 0.81,
    :id "nlp/f/topic/501",
    :salienceLevel "mention",
    :label "college"}],
  :published 1565395200000,
  :fingerprint "cf6b733c",
  :canonicalUrl "http://insideclojure.org/2019/08/10/journal/"}
 {:engagement 4,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1565424569837,
  :content
  {:content
   "How to get REBL, MKL and Cursive setup for work with Neanderthal.",
   :direction "ltr"},
  :updated 1565481600000,
  :alternate
  [{:href "http://www.arachnid.co.nz/blog/neanderthalrebl",
    :type "text/html"}],
  :title "setting up neanderthal with rebl and cursive",
  :author "Nick Jones Clojure Blog",
  :published-str "Sat Aug 10 17:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16c7a934ded:209644:561e4df6",
  :visual {:url "none"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "http://www.arachnid.co.nz/blog/neanderthalrebl",
  :published 1565481600000,
  :fingerprint "105af233",
  :canonicalUrl "http://www.arachnid.co.nz/blog/neanderthalrebl"}
 {:engagement 4,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1565387586303,
  :content
  {:content
   "<p>Each week, we answer a different question about Clojure and functional programming.</p>\n<p>If you have a question you’d like us to discuss, tweet <a href=\"https://twitter.com/clojuredesign\">@clojuredesign</a>, send an email to <a href=\"mailto:feedback@clojuredesign.club\">feedback@clojuredesign.club</a>, or join the <code>#clojuredesign-podcast</code> channel on the <a href=\"http://clojurians.net/\">Clojurians Slack</a>.</p>\n<p>This week, the question is: <strong>“Why do Clojurians make such a big deal about immutability?”</strong> We cover several practical side effects of immutability and why we’ve become such big fans of data that doesn’t let us down.</p>\n<p>Selected quotes:</p>\n<ul>\n<li>“Well, we don’t have Monads to talk about.”</li>\n<li>“What good is a program, if you can’t change stuff!?”</li>\n<li>“The memory cost of data structures is in proportion to the changes, not the users.”</li>\n<li>“I can hang on to a reference to the old state and a reference to the new state very cheaply.”</li>\n<li>“You can reduce comparison to referential equality.”</li>\n<li>“Once you can efficiently save every version of the state, going back to a previous version is no big deal.”</li>\n<li>“I love determinism. Determinism is trustable.”</li>\n<li>“I can trust immutable data. And if I can trust it, then it can occupy a smaller part of my brain.”</li>\n</ul>\n<p>Related episodes:</p>\n<ul>\n<li><a href=\"https://clojuredesign.club/episode/002-tic-tac-toe-state-in-a-row\">002: Tic-Tac-Toe, State in a Row</a></li>\n<li><a href=\"https://clojuredesign.club/episode/039-why-use-clojure-over-another-functional-language\">039: Why use Clojure over another functional language?</a></li>\n</ul>",
   :direction "ltr"},
  :updated 1565362800000,
  :entities
  [{:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "about",
    :label "Clojure"}
   {:mentions
    [{:text "functional programming"} {:text "functional language"}],
    :id "nlp/f/entity/wd:193076",
    :salienceLevel "mention",
    :label "functional programming"}
   {:mentions [{:text "Tic Tac Toe"}],
    :id "nlp/f/entity/wd:662416",
    :salienceLevel "mention",
    :label "Tic Tac Toe"}],
  :alternate
  [{:href
    "https://clojuredesign.club/episode/041-why-do-clojurians-make-such-a-big-deal-about-immutability/",
    :type "text/html"}],
  :title
  "Ep 041: Why Do Clojurians Make Such a Big Deal About Immutability?",
  :author "Christoph Neumann and Nate Jones",
  :published-str "Fri Aug 09 08:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16c785efaff:40ad91e:73d34570",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://clojuredesign.club/episode/041-why-do-clojurians-make-such-a-big-deal-about-immutability/",
  :commonTopics
  [{:score 37.440545803228844,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.966,
    :id "nlp/f/topic/349",
    :salienceLevel "about",
    :label "business"}
   {:score 0.951,
    :id "nlp/f/topic/861",
    :salienceLevel "about",
    :label "finance"}
   {:score 0.841,
    :id "nlp/f/topic/1695",
    :salienceLevel "mention",
    :label "parenting"}],
  :published 1565362800000,
  :fingerprint "1d9e6ec7",
  :canonicalUrl
  "https://clojuredesign.club/episode/041-why-do-clojurians-make-such-a-big-deal-about-immutability/"}
 {:engagement 4,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1565355339090,
  :content
  {:content
   "<div><p>Last weekend Heart of Clojure took place in Leuven, Belgium. As one of the core\norganizers it was extremely gratifying to see this event come to life. We\nstarted with a vision of a particular type of event we wanted to create, and I\nfeel like we delivered on all fronts.</p><p>For an impression of what it was like you can check out <a shape=\"rect\" href=\"https://twitter.com/malweene/status/1157931033477701632\">Malwine’s comic summary</a>, or <a shape=\"rect\" href=\"https://manuel-uberti.github.io/clojure/2019/08/04/clojure-heart/\">Manuel’s blog post</a>.</p><p>It seems people had a good time, and a lot of people are already asking about\nthe next edition. However we don’t intend to make this a yearly recurring\nconference. We might be back in two years, maybe with another Heart of Clojure,\nmaybe with something else. We need to think about that.</p><p>But I do hope the legacy of Heart of Clojure can live on. One of the things we\noptimized for was socializing, making connections. We brought people from 31 (!)\ncountries together, and enabled countless new connections. This will without a\ndoubt have an impact on the Clojure community.</p><p>One of my goals with Heart of Clojure was also to provide people with new ideas.\nWe had a very wide range of talks, many of them not directly related to Clojure,\nbut all of them inspiring and sparking interesting conversation.</p><p>Finally I wanted to inspire other conference organizers. I have visited\ncountless technical conferences over the years, and have developed strong\nopinions about what I think makes an event great. Some of these ideas are\nalready wide spread, some of them are well accepted in other communities, but\nnot yet prevalent in Clojure. In particular I was hoping to introduce some ideas\nfrom Ruby conferences like Eurucamp and Isle of Ruby into the Clojure community.</p><p>So that’s what this post is about, a quick recap of the specific things we did,\nthat we would love to see others copy. Maybe the existing conferences will pick\nup a thing or two, or maybe someone else will feel inspired to create a new\nevent. Seems there’s a market for a European summer conference, maybe you want\nto fill that gap?</p><h2>A Two Phase CFP</h2><p>This is already well known by now, but still worth mentioning. Our selection\nprocess occured in two steps. First we had a group of reviewers rate talks\nanonymously. They did not see the speaker’s name or other identifiable details,\nthey just had the title and the abstract. This way you get a largely unbiased\nrating of the proposal itself.</p><p>Once all proposals are rated the program committee made a final selection. This\ntime they did look at who the speakers were, to assure we had a balanced and\ndiverse program, including first time speakers, and speakers from different\nplaces geographically, with a strong European representation, since we wanted to\nalso showcase our local talent.</p><p>Finally also worth mentioning that after this final selection we paired all\nspeakers up with a mentor. Some people worked together with their mentor\nextensively, others only checked in once or twice, but the offer was there, to\nmake sure people are supported in delivering the best talk they could.</p><p>This is not the final word on finding a good CFP process, I heard that for ClojuTRE Metosin is experimenting with rating talks on multiple criteria, and then making a shotgun spread so you get talks across the spectrum. Hopefully they will write about their experience, and maybe even open source the app they developed for this.</p><p>To run our CFP we forked the <a shape=\"rect\" href=\"https://github.com/heartofclojure/cfp-app\">CFP App developed for RubyConf</a>.</p><h2>Long breaks</h2><p>We had 16 sessions spread over two days. That’s not that many, for comparison,\nthe upcoming <a shape=\"rect\" href=\"https://clojutre.org/2019/#program\">ClojuTRE</a> has well over 20, which I’d say is fairly typical.</p><p>However we made the choice to keep the program fairly light. The sessions are what bring the people\ntogether, they provide inspiration and a shared experience, but in my mind a\nconference is really about meeting people, so we wanted to optimize for that.</p><p>We also wanted to prevent (to some extent) the mental exhaustion that easily\nsets in after a day of listening to talks. So we had plenty of breaks, typically\nhalf an hour each, with a one and a half hour lunch break the first day, and an\nextended lunch+siesta break on the second day.</p><p>This siesta break concept was pioneered by Eurucamp, and it took a little bit of\nconvincing to get everyone on the team on board with it, but it’s so great, and\npeople loved it. Basically on Saturday from noon to four people could do\nwhatever. We offered lunch of course, and there were some activities to opt-in\nto (more on that later), but really it was “space intentionally left blank”. And\nso people grab a drink, sit on the grass, have long extended conversations. They\ngo back to their hotel to freshen up or take a nap, they head into town, visit a\nmuseum, or pull out their laptops to share what they are working on.</p><p>The result: a much more interactive event, with deeper, more genuine\nconnections. Trust me, four o’clock is there before you know it.</p><h2>Activities</h2><p>All these people travel to a country and city they’ve never been to, that has so\nmuch to offer, only to sit in a hall and stare at a screen until they’re\nexhausted. Isn’t that a shame? We wanted people to interact, to explore the\ncity, to do things in small groups, which are so much more amenable to getting\nto know people.</p><p>So we organized Activities. We had guided city tours the day before, we did a\ncreative code jam during the siesta break, there was a screen printing company\non site where you could go to get our logo printed or create your own designs.</p><p>And other people could create activities as well. Juxt organized an impromptu\nworkshop about Crux, people went bouldering, we had competing beer and wine\ntasting events, and over a dozen people learned from our sketchnoter Malwine how\nto sketchnote.</p><p>On Friday evening one of our speakers and Leuven native Maarten Truyens\norganized an “adventurous dinner”. Everyone who signed up got split into twelve\ngroups of six to eight people each, and we made twelve different restaurant\nreservations, so people could get a dinner with a small group, and meet some of\nthe other attendees, sponsors, and speakers.</p><p>Compare this with what usually happens: everyone stands around at the end of the\nday, clustering into ever bigger groups, and by the time you start moving you\nrealize you need to on the spot find a place that will fit 20 people without\nprior notice.</p><p>To make this all possible we used the <a shape=\"rect\" href=\"https://github.com/heartofclojure/activities\">activities\napp</a> first developed for Eurucamp, we just had to style it a bit, and promote it.</p><h2>Lightning talks</h2><p>This has always been one of my favorite parts of Ruby conferences. To qualify as\na lightning talk a few requirements need to be met. The talks are exactly five\nminutes each, after five minutes the audience starts clapping and its over, and\npeople sign up for them on the spot, by simply writing their name and talk title\ndown on a big sheet that’s hung up in the venue.</p><p>If you like to have everything under control this may seem scary. There’s no\ntelling what people will bring to the stage, but that’s what makes them so\ngreat. You get really spontaneous, diverse, and entertaining talks most of the\ntime. And if it’s not, then in five minutes there’s already the next one.</p><p>This format allows people to show something they hacked together the day before,\nor to respond to a talk that they saw earlier at the conference. It allows\npeople who feel a bit insecure to make a last minute call. It’s just a really\ngreat format, and I’ve rarely seen it gone wrong. Just make sure everyone is\nwell aware of the code of conduct!</p><p>Also worth mentioning is that we did not end the day with lightning talks, which is fairly common. Instead we kept a closing keynote to close off the day and the event. This way you don’t end on the erratic, chaotic energy of the lightning talk session.</p><p>We also made sure this closing keynote wasn’t a deep technical talk. I’ve seen a few Clojure conferences do this, and I find it really hard to still engage with at the end of the day, my brain is just too fried. Instead we had a talk about community, focusing on the human aspects, which I thought was a great takeaway to end the day.</p><h2>Start the second day a little later</h2><p>Conferences bring far away friends together, and so what do they do after a day\nof focusing on talks? They go and relax, get a bite, grab a drink, and before\nyou know it it’s two in the morning and you’re calculating how much sleep you\ncan still get and if you’ll skip the first talk or not.</p><p>This isn’t necessarily what we recommend people to do, we did mention in a few\nplaces to be careful with Belgian beers, and to try and be fresh and bright in\nthe morning (or to at least keep the partying until the end of the second day),\nbut this is still the reality for a good part of the attendees.</p><p>So we start a little later the second day (and don’t start too soon in any\ncase). The first day we had doors at 9:00, and started the sessions at 9:30, on\nSaturday doors opened at 9:45, and sessions started at 10:15. I’ve been to\nconferences where the first speaker on the second day is talking to just a\nhandful of people, that’s not a fun place to be.</p><h2>Conclusion</h2><p>These weren’t the only things that made Heart of Clojure great, some things are\nharder to copy, and sometimes you have to get a little lucky. I think our\nbiggest strength was the awesome venue, and we were lucky to find it, but it’s also our biggest weakness. If\nit had been a heat wave like the weak before, or if we had had serious\nthunderstorms, we would have been in trouble. We were also very close on capacity, there is no room to grow for us at this location.</p><p>We were also really lucky with the\naccessibility, being close to the train station and to Brussels airport, and to be in a city that’s compact and walkable. These are all circumstances that might be hard to replicate elsewhere.</p><p>And a final caveat: these things I listed here may not be the right thing for\nyour event. You need to be the judge of that. Different people like different things, and different organizers set different priorities. But hopefully one or two of these ideas\ncan trickle into some of the other great conferences we already have.</p><p>And if you do feel inspired to organize a new Clojure conference, once or\nrepeating, then get in touch. We would be really happy to help. Maybe next\nsummer?</p></div>",
   :direction "ltr"},
  :updated 1565352190000,
  :entities
  [{:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "CFP"}],
    :id "nlp/f/entity/wd:310667",
    :salienceLevel "mention",
    :label "carbon footprint"}
   {:mentions [{:text "Belgium"} {:text "Belgian"}],
    :id "nlp/f/entity/wd:31",
    :salienceLevel "mention",
    :label "Belgium"}
   {:mentions [{:text "Leuven"}],
    :id "nlp/f/entity/wd:118958",
    :salienceLevel "mention",
    :label "Leuven"}
   {:mentions [{:text "European"}],
    :id "nlp/f/entity/wd:458",
    :salienceLevel "mention",
    :label "European Union"}],
  :alternate
  [{:href
    "https://lambdaisland.com/blog/2019-08-09-fork-this-conference",
    :type "text/html"}],
  :title "Fork This Conference",
  :author "Arne Brasseur",
  :published-str "Fri Aug 09 05:03:10 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16c7672ed52:3da5fd9:561e4df6",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://lambdaisland.com/blog/2019-08-09-fork-this-conference",
  :commonTopics
  [{:score 0.995,
    :id "nlp/f/topic/1585",
    :salienceLevel "about",
    :label "nlp"}
   {:score 0.869,
    :id "nlp/f/topic/1326",
    :salienceLevel "about",
    :label "lettering"}
   {:score 0.732,
    :id "nlp/f/topic/493",
    :salienceLevel "mention",
    :label "coaching"}],
  :published 1565352190000,
  :fingerprint "5dc1734e",
  :canonicalUrl
  "https://lambdaisland.com/blog/2019-08-09-fork-this-conference"}
 {:engagement 8,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1565220885388,
  :content
  {:content
   "<h1>Lots of Releases</h1>\n<p>Over the last week or so I’ve released minor updates to several of the projects I maintain, so I thought it would be nice to have a summary blog post rather than a scattering of minor announcements.</p>\n<h2>clj-time 0.15.2</h2>\n<p>Add type hints, fix a bug in <code>overlaps?</code>, improve tests and documentation.</p>\n<p>See the <a href=\"https://github.com/clj-time/clj-time/blob/master/ChangeLog.md\">change log</a> for more details.</p>\n<h2>jkk/honeysql 0.9.5</h2>\n<p>Support JDK11 for dev/test, support Turkish language users, enhance <code>format-predicate</code> to match <code>format</code> (<code>parameterizer</code>).</p>\n<p>See the <a href=\"https://github.com/jkk/honeysql/blob/master/CHANGES.md\">change log</a> for more details.</p>\n<h2>seancorfield/clj-new 0.7.7</h2>\n<p>Pin Clojure (and <code>test.check</code>) version in generated projects instead of using <code>&quot;RELEASE&quot;</code>.</p>\n<p>See the <a href=\"https://github.com/seancorfield/clj-new/blob/master/CHANGELOG.md\">change log</a> for more details.</p>\n<h2>seancorfield/depstar 0.3.1</h2>\n<p>Add <code>-m</code> / <code>--main</code> option to override <code>Main-Class</code> in generated manifest.</p>\n<p>See the <a href=\"https://github.com/seancorfield/depstar#changes\">change log</a> for more details.</p>\n<h2>seancorfield/next.jdbc 1.0.5</h2>\n<p><code>plan</code>’s “mapified” <code>ResultSet</code> is now a full <code>IPersistentMap</code> implementation which adds support for <code>cons</code>, <code>count</code>, <code>dissoc</code>, <code>empty</code>, etc. Continued improvements to documentation.</p>\n<p>See the <a href=\"https://github.com/seancorfield/next-jdbc/blob/master/CHANGELOG.md\">change log</a> for more details.</p>",
   :direction "ltr"},
  :updated 1565191800000,
  :entities
  [{:mentions [{:text "change log"}],
    :id "nlp/f/entity/wd:255135",
    :salienceLevel "about",
    :label "changelog"}
   {:mentions [{:text "Turkish language"}],
    :id "nlp/f/entity/wd:256",
    :salienceLevel "mention",
    :label "Turkish"}],
  :alternate
  [{:href "http://corfield.org/blog/2019/08/07/releases/",
    :type "text/html"}],
  :title "Release! Release! Release!",
  :author "Sean Corfield",
  :published-str "Wed Aug 07 08:30:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16c6e6f538c:3378717:73d34570",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "http://corfield.org/blog/2019/08/07/releases",
  :published 1565191800000,
  :fingerprint "5e270dca",
  :canonicalUrl "http://corfield.org/blog/2019/08/07/releases"}
 {:engagement 27,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1565187588210,
  :recrawled 1565190237058,
  :content
  {:content
   "<div><p>When I was 16 I was visited by a man who said he had come from the future. He\nhad traveled twenty years back to 1999 to sit down with me and have a chat.</p><p>We talked for an hour or so, and in the end he gave me a few pieces of advice. I\nhave lived by these and they have served me well, and now I dispense this advice\nto you.</p><h2>Become allergic to The Churn</h2><p>First he warned me about the churn, and I have since learned to recognize it.</p><p>The Churn is losing a day debugging because a transitive dependency changed a\nfunction signature. The Churn is spending a week just to get a project you wrote\na year ago to even run. The Churn is rewriting your front-end because a shiny\nnew thing came around.</p><p>Many people are blind to The Churn. They waste days, weeks, months of their\nlives without blinking, or worse, they get a perverse sense of achievement\nbecause the thing which was working fine works <em>again</em>.</p><p>The Churn is a resource sapping disease, and the first step to recovering from\nThe Churn is to recognize The Churn, the second step is realizing it doesn’t\nhave to be this way.</p><p>There are a plethora of techniques available to combat The Churn that have been\naround for decades, but our industry is slave to a hype cycle driven by\npopularity contests, with little regard for upgrade paths, backward\ncompatibility, and long term support.</p><p>Luckily many people do see The Churn for what it is, and once your doors of\nperception are cleansed you will learn to recognize these people and the work\nthey do. You will discover vast ecosystems of languages and tools that will go\nto great lengths not to break what wasn’t broken.</p><p>These are the olives of technology. Olives aren’t candy, and tasting them the\nfirst time isn’t always pleasant, but soon you will develop a taste for them.\nThey have been here since ancient times, and they will remain for centuries to\ncome. They are <em>good</em> for you, solid, reliable, nutritious. Eat less candy and\nmore olives.</p><p><strong>Examples</strong>: Clojure, Common Lisp, HTML, Make</p><p><strong>Counter-examples</strong>: JavaScript, Ruby, React-Preact-Vue-Angular-…</p><h2>Study the Great Traditions</h2><p>He then went on to speak about The Great Traditions. These are technologies that\nhave been around for so long they form their own worlds. They are like great\nphilosophical traditions, with foundational documents, and generations of\ncommentaries and derived works.</p><p>From the outside looking in they are like alien civilizations, complete with\ntheir own languages and cultures, perhaps unlike anything you’ve come across\nbefore.</p><p>The combined effort and experience that has gone into creating each of these\ntraditions is measured in millenia. These people <em>know</em> things. They have <em>seen</em>\nthings. And when you scratch away the hipster veneer of your technology stack\nyou will find they are <em>everywhere</em>.</p><p>So how do you go about approaching something this vast? First off, don’t rush\nit, time is on your side. Maybe you are Young and have More Important Things To\nDo First. That’s fine. These things were here before you, and they will\npatiently wait until you’re ready.</p><p>If possible find a mentor, someone to be your shifu and teach you these ancient\narts. Stay humble, and let your curiosity guide you.</p><p>Some of the things you learn will be eminently practical in your day to day\nwork, but beyond that you will develop an appreciation for technologies that\nstand the test of time, and the design, the culture, the principles they are\nborn from.</p><p><strong>Examples</strong>: UNIX, LISP, The Web, Emacs, TeX</p><p>We spoke about many more things in the end, and maybe one day I’ll write about\nthose too. And then he left, mysteriously as he had come.</p><p>Now twenty years later, prepping my time machine, I know that person was me.</p></div>",
   :direction "ltr"},
  :updated 1565187690000,
  :entities
  [{:mentions [{:text "Common Lisp"}],
    :id "nlp/f/entity/wd:849146",
    :salienceLevel "mention",
    :label "Common Lisp"}
   {:mentions [{:text "backward compatibility"}],
    :id "nlp/f/entity/wd:844605",
    :salienceLevel "mention",
    :label "backward compatibility"}
   {:mentions [{:text "TeX"}],
    :id "nlp/f/entity/wd:5301",
    :salienceLevel "mention",
    :label "TeX"}
   {:mentions [{:text "LISP"}],
    :id "nlp/f/entity/wd:132874",
    :salienceLevel "mention",
    :label "Lisp"}
   {:mentions [{:text "Emacs"}],
    :id "nlp/f/entity/wd:189722",
    :salienceLevel "mention",
    :label "Emacs"}],
  :alternate
  [{:href
    "https://lambdaisland.com/blog/2019-08-07-advice-to-younger-self",
    :type "text/html"}],
  :title "Advice to My Younger Self",
  :author "Arne Brasseur",
  :published-str "Wed Aug 07 07:21:30 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16c6c734072:30239b8:4b2e0c8b",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://lambdaisland.com/blog/2019-08-07-advice-to-younger-self",
  :updateCount 1,
  :commonTopics
  [{:score 38.89118975737357,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1565187690000,
  :fingerprint "dde75ecf",
  :canonicalUrl
  "https://lambdaisland.com/blog/2019-08-07-advice-to-younger-self"}
 {:engagement 9,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1565111576842,
  :content
  {:content
   "In the last blog post, we bootstrapped the Clojure project using Mount and Aero. We are going to continue from we left off and configure database connection pooling, migration &amp; Reloaded Workflow in this blog post.\nThis blog post is a part 2 of the blog series Building an E-Commerce Marketplace Middleware in Clojure.\nConfiguring Hikari-CP Let’s get started by adding the hikari-cp, a Clojure wrapper to HikariCP, and the Postgres driver dependencies in the project.",
   :direction "ltr"},
  :updated 1565108943000,
  :entities
  [{:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "about",
    :label "Clojure"}
   {:mentions [{:text "Postgres"}],
    :id "nlp/f/entity/wd:192490",
    :salienceLevel "mention",
    :label "PostgreSQL"}],
  :alternate
  [{:href
    "https://www.demystifyfp.com/clojure/marketplace-middleware/configuring-database-connection-pooling-migration-reloaded-workflow/",
    :type "text/html"}],
  :title
  "Configuring Database Connection Pooling, Migration and Reloaded Workflow",
  :author "Demystify FP",
  :published-str "Tue Aug 06 09:29:03 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16c67eb690a:2a2b75e:4b2e0c8b",
  :visual {:url "none"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://www.demystifyfp.com/clojure/marketplace-middleware/configuring-database-connection-pooling-migration-reloaded-workflow/",
  :commonTopics
  [{:score 35.82904316085026,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1565108943000,
  :fingerprint "7b729cd2",
  :canonicalUrl
  "https://www.demystifyfp.com/clojure/marketplace-middleware/configuring-database-connection-pooling-migration-reloaded-workflow/"}
 {:engagement 4,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/todo",
    :label "todo"}
   {:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1565097988315,
  :content
  {:content
   "<div>\n<div>\n<div>\n<p>In this post I will show you how to get going with <a href=\"https://juxt.pro/crux\">Crux</a>\nand <a href=\"https://www.confluent.io/confluent-cloud/\">Confluent Cloud</a> to create a\nhighly-scalable\n<a href=\"https://martin.kleppmann.com/2015/03/04/turning-the-database-inside-out.html\">unbundled</a>\ndatabase. Crux provides an immutable document model on top of Apache Kafka with\nbitemporal queries (using Datalog) and efficient data eviction. Assuming you\nhave a working knowledge of Clojure, all you need to follow along is 5 minutes\nand a valid payment method for monthly billing.</p>\n</div>\n<div>\n<p><span><img alt=\"confluent cloud crux\" src=\"https://juxt.pro/img/confluent-cloud-crux.png\"></span></p>\n</div>\n<div>\n<p>Note that Crux supports equivalent HTTP and Java APIs, but this post is\nfocussed on Clojure. Also, Crux nodes may either be embedded in your\napplication instances or made available as a more traditional load-balanced\ncluster. See the docs for more information about the various\n<a href=\"https://juxt.pro/crux/docs/deployment.html\">deployment options</a>.</p>\n</div>\n</div>\n</div>\n<div>\n<h2><a href=\"https://juxt.pro/blog/rss.xml?category=clojure&since=2016-03-13#_confluent_cloud\"></a>Confluent Cloud</h2>\n<div>\n<div>\n<p>Confluent is the primary steward of Apache Kafka and they provide, amongst\nother enterprise offerings, a fully-managed Kafka service via Confluent Cloud.\nThe latest update to Confluent Cloud is particularly compelling for small Crux\ndeployments because there are no minimum fees and the pricing structure is very\nsimple:</p>\n</div>\n<div>\n<p><code>Monthly Cost = Data In + Data Out + Data Retained</code></p>\n</div>\n<div>\n<p>This is a significant milestone in the world of Kafka-as-a-Service (KaaS).\nThere is no longer a need to think about &quot;brokers&quot; or other infrastructure\ncosts. You only pay for what you use and there are no upfront costs or\ntermination fees. The service can be deployed into your choice of GCP/AWS/Azure\nregions and it scales elastically for up to 100Mbps cluster throughput.</p>\n</div>\n<div>\n<p>For example, a modest 20GB Crux database with 5GB ingress and 100GB egress\nwould currently cost as little as <code>$13.55 / month</code> in the cheapest GCP region\n(based on <code>20*0.10 + 5*0.11 + 100*0.11</code>).</p>\n</div>\n</div>\n</div>\n<div>\n<h2><a href=\"https://juxt.pro/blog/rss.xml?category=clojure&since=2016-03-13#_steps\"></a>Steps</h2>\n<div>\n<div>\n<h3><a href=\"https://juxt.pro/blog/rss.xml?category=clojure&since=2016-03-13#_0_sign_in_to_confluent_cloud_and_create_a_cluster\"></a>0. Sign in to Confluent Cloud and create a cluster</h3>\n<div>\n<p>Follow the short sequence of sign-up steps to create an account if you don’t\nalready have one: <a href=\"https://www.confluent.io/confluent-cloud/\">https://www.confluent.io/confluent-cloud/</a></p>\n</div>\n<div>\n<p>Once you have to accessed your default environment you can create a cluster.\nYou will need to choose a name (e.g. <code>crux-1</code>), cloud provider (e.g. <code>GCP</code>) and\nregion (e.g. <code>London</code>). Then you need to provide a valid credit/debit card in\norder to create the cluster.</p>\n</div>\n</div>\n<div>\n<h3><a href=\"https://juxt.pro/blog/rss.xml?category=clojure&since=2016-03-13#_1_create_an_api_key\"></a>1. Create an API key</h3>\n<div>\n<p>Under &quot;CLI and client configuration&quot; click on the &quot;Java client&quot; tab then\n&quot;Create Kafka Cluster API key &amp; secret&quot;. Tick the &quot;I have saved my API key and\nsecret and am ready to continue&quot; checkbox and press continue. Your key and\nsecret have now been embedded in a configuration snippet on the page. Copy the\nsnippet and save it as a <code>.properties</code> file in a safe location that will be\naccessible from your Crux REPL (e.g. ~/cc-config.properties).</p>\n</div>\n</div>\n<div>\n<h3><a href=\"https://juxt.pro/blog/rss.xml?category=clojure&since=2016-03-13#_2_start_a_clojure_repl\"></a>2. Start a Clojure REPL</h3>\n<div>\n<p>Feel free to look through the <a href=\"https://juxt.pro/crux/tutorial\">Crux tutorial</a> or\nrefer to the <a href=\"https://juxt.pro/crux/docs/index.html\">documentation</a> if you are\ntrying to understand the Crux APIs.</p>\n</div>\n<div>\n<p>If you have <code>lein</code> installed you can clone the\n<a href=\"https://github.com/juxt/crux\">repo</a>, navigate to <code>crux-dev</code> and run <code>lein repl</code>.\nOr alternatively you can launch a <code>clj</code> REPL and provide the latest\n<code>crux-kafka</code> on Clojars using:</p>\n</div>\n<div>\n<div>\n<pre><code>clj -Sdeps '{:deps {juxt/crux-kafka {:mvn/version &quot;RELEASE&quot;}}}'</code></pre>\n</div>\n</div>\n<div>\n<p>Update the various configuration values in the snippet below according to the\ninline comments (for <code>:bootstrap-servers</code> and <code>:kafka-properties-file</code> in\nparticular) and run the code in your REPL. This will create a Crux node that is\nconnected to your Confluent Cloud cluster.</p>\n</div>\n<div>\n<div>\n<pre><code>(require '[crux.api :as crux])\n(import (crux.api ICruxAPI))\n\n(def ^crux.api.ICruxAPI node\n  (crux/start-cluster-node\n   {:kv-backend &quot;crux.kv.memdb.MemKv&quot; ; use RocksDB or LMDB for production deployments\n    :tx-topic &quot;tx-1&quot; ; choose your tx-topic name\n    :doc-topic &quot;doc-1&quot; ; choose your doc-topic name\n    :replication-factor 3 ; Confluent Cloud requires this to be `3`\n    :doc-partitions 6 ; Confluent Cloud default\n    :bootstrap-servers &quot;&quot; ; update with the `bootstrap.servers` value found in your properties file\n    :kafka-properties-file &quot;path/to/my-kafka.properties&quot;})) ; update with the path of your properties file</code></pre>\n</div>\n</div>\n<div>\n<p>Submit a transaction:</p>\n</div>\n<div>\n<div>\n<pre><code>(def my-doc {:crux.db/id :some-id\n             :color &quot;red&quot;})\n\n(crux/submit-tx node [[:crux.tx/put my-doc]]) ; returns a transaction result map</code></pre>\n</div>\n</div>\n<div>\n<p>Retrieve the document:</p>\n</div>\n<div>\n<div>\n<pre><code>(crux/entity (crux/db node) :some-id) ; returns my-doc</code></pre>\n</div>\n</div>\n<div>\n<p>You could even try this from a second REPL with a second node connecting to the\nsame cluster.</p>\n</div>\n<div>\n<p>Note that Crux will automatically generate topics with the required\nretention/compaction configurations and will set the number of partitions for the\ntransaction topic to <code>1</code>.</p>\n</div>\n<div>\n<p>You can also create and manage topics independently of Crux using a CLI tool or\nthe Confluent Cloud web interface, but they will need to be configured\nappropriately (see\n<a href=\"https://github.com/juxt/crux/blob/master/crux-kafka/src/crux/kafka.clj\">kafka.clj</a>).</p>\n</div>\n</div>\n<div>\n<h3><a href=\"https://juxt.pro/blog/rss.xml?category=clojure&since=2016-03-13#_3_finished\"></a>3. Finished</h3>\n<div>\n<p>Congratulations! You now have a Crux infrastructure fit for production\napplications. However, if you would still prefer to use a regular JDBC database\n(such as SQLite, Postgres or Oracle) instead of Kafka then you may want to take\na look at the <code>crux-jdbc</code> module.</p>\n</div>\n<div>\n<p>In addition to Confluent Cloud’s unique pricing and multi-cloud model you also\nget access to many interesting non-Apache features. The standard service is\nprobably good enough for most small-scale users of Crux as it stands, however\nConfluent Cloud Enterprise offers\n<a href=\"https://docs.confluent.io/current/cloud/limits.html\">a number of additional\nfeatures</a> for large-scale and mission-critical deployments including >100Mbps\nthroughput, multi-zone high availability and ACLs.</p>\n</div>\n</div>\n</div>\n</div>\n<div>\n<h2><a href=\"https://juxt.pro/blog/rss.xml?category=clojure&since=2016-03-13#_looking_ahead\"></a>Looking Ahead</h2>\n<div>\n<div>\n<p><span><img alt=\"crux heart kafka\" src=\"https://juxt.pro/img/crux-heart-kafka.png\" height=\"150\"></span></p>\n</div>\n<div>\n<p>A common perception of Apache Kafka is that it is not viable for serious\nconsideration unless you have a large enough problem to warrant the non-trivial\neffort of introducing it into your organisation. Kafka is known primarily for\nits suitability within large enterprises and web-scale startups. However, with\nthe rise of Confluent Cloud and other commodity KaaS offerings it seems\ninevitable that perceptions of the broader market will shift, demand will\nincrease, and KaaS prices will be driven down towards the price floors of more\ncommon forms of cloud storage. I look forward to seeing a truly cross-cloud\nservice emerge that optimises the use of low-cost tiered storage for infinite\nretention (a key requirement for Crux).</p>\n</div>\n<div>\n<p>In summary, Apache Kafka has never been easier to get started with, whether\nrunning it yourself or otherwise, and I strongly suspect that Confluent will\ncontinue on its meteoric trajectory. This is all great news for Crux.</p>\n</div>\n<div>\n<p><span><img alt=\"crux confluent\" src=\"https://juxt.pro/img/crux-confluent.png\"></span></p>\n</div>\n<div>\n<p>Our official support channel is\n<a href=\"https://juxt-oss.zulipchat.com/#narrow/stream/194466-crux\">Zulip</a>, but most\npeople appear in the <a href=\"http://clojurians.slack.com/messages/crux\">#crux channel on\nthe Clojurians slack</a>. You can also reach us via\n<a href=\"mailto:crux@juxt.pro\">crux@juxt.pro</a>.</p>\n</div>\n</div>\n</div>",
   :direction "ltr"},
  :updated 1565085300000,
  :entities
  [{:mentions [{:text "Crux"}],
    :id "nlp/f/entity/wd:10542",
    :salienceLevel "about",
    :label "Crux"}
   {:mentions [{:text "Kafka"} {:text "Apache Kafka"}],
    :id "nlp/f/entity/wd:16235208",
    :salienceLevel "mention",
    :label "Apache Kafka"}
   {:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "REPL"}],
    :id "nlp/f/entity/wd:2032810",
    :salienceLevel "mention",
    :label "Read–eval–print loop"}
   {:mentions [{:text "CLI"}],
    :id "nlp/f/entity/wd:189053",
    :salienceLevel "mention",
    :label "command-line interface"}],
  :alternate
  [{:href "https://juxt.pro/blog/posts/crux-confluent-cloud.html",
    :type "text/html"}],
  :title
  "Create an unbundled database with Crux and Confluent Cloud Kafka in 5 minutes",
  :author "The JUXT Blog",
  :published-str "Tue Aug 06 02:55:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16c671c10db:2975684:73d34570",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url "https://juxt.pro/img/confluent-cloud-crux.png",
   :width 2348,
   :height 1114,
   :contentType "image/png"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://juxt.pro/blog/posts/crux-confluent-cloud.html",
  :commonTopics
  [{:score 40.03847210807651,
    :id "nlp/f/topic/3032",
    :salienceLevel "about",
    :label "astronomy"}
   {:score 37.5333926559172,
    :id "nlp/f/topic/3036",
    :salienceLevel "about",
    :label "physical science"}
   {:score 36.572745424815984,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.978,
    :id "nlp/f/topic/487",
    :salienceLevel "about",
    :label "cloud"}
   {:score 0.915,
    :id "nlp/f/topic/774",
    :salienceLevel "about",
    :label "engineering"}
   {:score 0.878,
    :id "nlp/f/topic/488",
    :salienceLevel "about",
    :label "cloud security"}
   {:score 0.839,
    :id "nlp/f/topic/1092",
    :salienceLevel "mention",
    :label "hosting"}
   {:score 0.706,
    :id "nlp/f/topic/116",
    :salienceLevel "mention",
    :label "api"}],
  :published 1565085300000,
  :fingerprint "e29d6287",
  :canonicalUrl
  "https://juxt.pro/blog/posts/crux-confluent-cloud.html"}
 {:engagement 8,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1565079271683,
  :content
  {:content
   "For those who’ve been asking why I’m not so active in NI….. Errrm, I haven’t. So far 2019 has thrown …<p><a href=\"https://dataissexy.wordpress.com/2019/08/06/where-have-you-been-hiding-nitech-ni-machinelearning-ai-customerloyalty-clojure-java/\">Continue reading <span>→</span></a></p>",
   :direction "ltr"},
  :updated 1565077163000,
  :alternate
  [{:href
    "https://dataissexy.wordpress.com/2019/08/06/where-have-you-been-hiding-nitech-ni-machinelearning-ai-customerloyalty-clojure-java/",
    :type "text/html"}],
  :title
  "“Where have you been hiding?…..” #nitech #ni #machinelearning #ai #customerloyalty #clojure #java",
  :author "Jason Bell",
  :published-str "Tue Aug 06 00:39:23 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16c65fe7903:2738720:4b2e0c8b",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url
   "https://dataissexy.files.wordpress.com/2017/12/cropped-24961595908_e21a3d155c_k.jpg",
   :width 960,
   :height 317,
   :contentType "image/jpeg"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "http://dataissexy.wordpress.com/?p=1791",
  :published 1565077163000,
  :fingerprint "cd13d83c",
  :canonicalUrl
  "https://dataissexy.wordpress.com/2019/08/06/where-have-you-been-hiding-nitech-ni-machinelearning-ai-customerloyalty-clojure-java/"}
 {:engagement 9,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/todo",
    :label "todo"}
   {:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1565062408386,
  :content
  {:content
   "<p><em>Summary: The benefits of automation are not limited to saving time. We go over many advantages, some pitfalls to avoid, and some principles to follow.</em></p>\n<p>Here’s an XKCD cartoon about the pitfalls of automation.</p>\n<figure class=\"wp-caption\"><img alt=\"xkcd Automation Cartoon, showing how silly it is to automate.\" width=\"297\" src=\"https://lispcast.com/wp-content/uploads/2019/08/automation-297x300.png\" class=\"wp-image-1969\" height=\"300\">https://xkcd.com/1319/</figure>\n<p>It shows how automation is sometimes a fool’s errand. We think we are spending a lot of time on the task. We decide to automate it by writing some software. We wind up spending much more time on the software than we ever did on the task.</p>\n<p>I have to admit that I’ve done this before. I’ve tried to automate something and found that in the end, the bugs and general unreliability of software made it not worth it from a “time spent” perspective. Automation is not all roses.</p>\n<p>However, in my experience, automation does help tremendously, despite sometimes being a wild goose chase. Further, I think the focus on time spent is a very Taylorist view of the way we spend our time. We shouldn’t measure productivity or efficiency with a stopwatch. There are many human factors involved. For example, building a robot to mow your lawn may be more fun than mowing your lawn, even though it’s unlikely to replace you without lots of work.</p>\n<p>It’s a silly example, but it shows that there are many benefits besides time savings. I want to explore automation from a system-level perspective—including human factors and other system-level thinking.</p>\n<p>Let’s start with the benefits.</p>\n<h2>Time saved</h2>\n<p>Sometimes you do hit gold and an automation straight up saves you time. Computers are fast. You no longer spend one hour doing a task. Now it takes you three minutes, thanks to software. You could easily imagine a formula to calculate the time saved. The variables are how long it used to take, how long it takes with the automation, how many times you do it, and how long it took to build the automation.</p>\n<p>Bottom line: computers are faster than humans at many tasks.</p>\n<h2>Consistency</h2>\n<p>I send a <a href=\"https://purelyfunctional.tv/newsletter/\">newsletter</a> out every week. I have a lot of the process automated, including layout. It does save time, but more importantly, the automation allows me to be more consistent. There are stylistic decisions that I’ve encoded right into the software. I care a lot about stylistic consistency, so I would spend the time to maintain it. But now that it’s automated, I can relax. This frees me up to focus on the content. Likewise, if I find a way to be more consistent, or if I choose to change one of those decisions, I have a place to put it.</p>\n<p>Bottom line: computers are more consistent than humans at many things.</p>\n<h2>Fewer defects</h2>\n<p>My newsletter often has many links in it. When I lay it out by hand, there are many ways you can get the link wrong. Sure, there are copy-paste errors. But sometimes it’s more subtle. You put in a placeholder link, then forget to come back to it. I rarely have those problems these days.</p>\n<p>Why? Because having an automated system, I have a place to add in automated checks. These are checks I probably should have done manually before. But look at the process: send myself a test email. Click on each link in the email and see if it goes to the right page. Make sure I’m using an incognito browser so that I’m not logged into my own blog, because if you’re logged into the blog, you’ll see your drafts, even before they’re published. It’s a total pain! I just never did it.</p>\n<p>Automation lets me do those things I wouldn’t have done. And here we see the first bit of alchemy that is missing from the stopwatch measurement of efficiency. The software is adding benefit that the human wouldn’t add themselves. You need to have at least the beginnings of an automation to be able to add these kinds of benefits.</p>\n<p>Bottom line: computers can avoid certain errors better than a human.</p>\n<h2>Frequency</h2>\n<p>I’ve automated most of <a href=\"https://lispcast.com/podcast/\">my podcast</a> production and publishing as well. I decided early on that I wouldn’t do the podcast if it took too much time away from my direct money-making activities. It would have to fit into the unused spaces in my life. For instance, while walking or driving. In short, I needed to spend nearly zero minutes editing and uploading.</p>\n<p>I experimented with a few different ways to do it, but in the end, I settled on a pretty stable workflow: film myself with my phone, upload it to YouTube (setting title and description). From there, an automation would download the video from YouTube, extract out the audio, title, and description, then create a post on my blog and attach the audio.</p>\n<p>The fact that it was automated made it so I could do it at all. When it was so easy, I was posting 3-5 new episodes per week (that would publish at a twice-a-week cadence).</p>\n<p>Programmers will also be familiar with continuous delivery. If we make deploying fast and easy, usually through automation, we do it more frequently. If it is entirely manual, we will do it less frequently. If you just did the stopwatch math, you would conclude that we don’t do it enough to justify automating it. The automation unlocks the ability to deliver features in hours instead of weeks.</p>\n<p>Bottom line: automations enable us to do a thing more frequently than we would have without it, and frequency might open up new benefits.</p>\n<h2>Ease</h2>\n<p>There are many tasks that are harder than they need to be, just because of the user interface. Although a person could do them, and even do them quickly, there’s an amount of tedium to them that makes the work stressful. When I use Twitter, I often want to add someone to a list. To do that, the best way I’ve found is to open that person’s profile in a new tab, wait for the profile to load, click the menu, choose “add to list”, click the list I’d like to add them to, click “Save”, then close the tab. That’s a lot of work, especially when you consider how “easy” the task could be.</p>\n<p>On the other hand, I could easily script up the same thing. Even though the task might take longer to perform (I’d have to switch to the command line, type in the command, etc), a script that added someone to a list might be easier. And by going to the command line (an easier place to automate in general), I could benefit from other automations, such as text expansion to auto-insert the command.</p>\n<p>Bottom line: bad interfaces (especially mouse-driven ones) can make some tasks difficult, even when they shouldn’t be. Sometimes it is better to make a task easier, even if it takes more time, because you’re reducing coginitive load.</p>\n<h2>Scalability</h2>\n<p>Because the newsletter layout and sending is mostly automated, I feel like I could handle another newsletter or two. Better, I would trust someone else to be able to send the newsletters while maintaining the consistency. What that really means is I don’t have to find someone with my unique blend of tastes and talents. They could be an expert on the topic of the newsletter, and not give a hoot about how consistent it is. That person would be easier to find.</p>\n<p>Bottom line: even if it doesn’t save time, automation can make it easier to scale out.</p>\n<h2>Waiting</h2>\n<p>You don’t know how many processes I have to wait for before I can continue working. That puts me in a dilemma. I can either wait for it (and waste time and increase stress) or work on something else which will be interrupted when it’s time to get back to it. Both are evil in human-factor terms. That time when you’re expecting an interruption is rarely productive.</p>\n<p>Automations can eliminate this waiting time. I transfer a lot of big video files over the internet in order to publish them. These can take forever. Some workflows require you to upload first, then take an action when it’s done. Do I really have to wait for it? Too often, the answer is “yes”.</p>\n<p>Automations can help you move the work around, because they’re like a little assistant who does the work for you. For example, to upload my video to YouTube, I have it ask me up front for the title and description. That way, I can type those in when I’m still engaged, hit Enter, and walk away. The automation handles retries and sets the title and description at the right point in the process. I don’t have to be there.</p>\n<p>Bottom line: waiting is evil and automations can reduce waiting. You might say “do something else while you wait”, but that time is usually unproductive.</p>\n<h2>Queues</h2>\n<p>Many tasks come in batches. If you got one X per week, and X took 2 hours, it may be something you just do manually. But what if you get ten Xs one week, and none for the other nine? If you devote 20 hours to it, that might eat into other responsibilities you have to get done every week. And if you queue them up, the turnaround time for the last one will be really bad. You could work overtime to finish them quickly, but that’s not sustainable.</p>\n<p>However, if you automate it, you might be able to get through them faster when they come in all at once. That would avoid the pileup. But what if that automation costs 3 hours per week to maintain? That means 30 hours of regular work vs. 20 hours of rushed work. Is it worth it?</p>\n<p>Of course, it depends on what X is and how valuable it is. But it’s worth considering that you should trade off time for regularity, so that you can avoid long queues and long turnaround times.</p>\n<p>Bottom line: long queues of work are bad, and have secondary consequences. It may be worth it to spend more time automating than you spend on the task to avoid queues.</p>\n<h2>Simplifying</h2>\n<p>It has happened to me many times that automating something has made the task simpler. For instance, I would never use `ffmpeg` to edit video. It’s a command-line application. To really edit video, I need to see what it will look like. That’s why I use a video editor with a nice interface. However, once I start automating my video pipeline, a switch to `ffmpeg` and a little time figuring out how to do the tasks I do in my video editor with it, may remove the video editor—an entire piece of software—from the process.</p>\n<p>In general, the fewer moving parts you have, the more reliable your process can be. Automation can often remove the need for whole steps. For instance, my workflow before required me to open Screenflow (my video editor), create a new document, import the video file, trim it to size, etc, etc. The new workflow does not require Screenflow at all. Those steps are now unnecessary.</p>\n<p>Bottom line: automation can simplify a process by removing steps that were necessary when done manually.</p>\n<h2>Learning</h2>\n<p>Automating a task is a learning process. You get to know the workflow better since you are essentially encoding your tacit knowledge into a program. You are also learning more about the tools available, how they work, and what they are capable of. Those learnings could be valuable for manual processes as well as future automations.</p>\n<p>Bottom line: learning about your tools and media can open up the door to better automations or more efficient manual work.</p>\n<h2>Mental space</h2>\n<p>I can’t switch between lots of different cognitive tasks very quickly. I doubt anyone can. Automating a task often means that I don’t have to think about it for it to happen. It could be set up on a timer or something, and it just happens without intervention. That frees up space to get more important work done. And that space is very valuable, more valuable than the time spent automating the task.</p>\n<p>Let’s look at an example. Let’s say I work from 8-12 am. I have to tweet at 10 am every day. It doesn’t take long, maybe 10 minutes, but it cuts the morning in half. Anything I have been working on in the early morning is swapped out and it will have to be swapped back in to continue work on it. Swapping out and in can take 20-30 minutes.</p>\n<p>However, if I automate the task well, I can forget about it. My morning becomes one continuous four-hour block without interruptions. That is invaluable.</p>\n<p>And I have automated many of my tweets. I use a service that sends out tweets from a reservoir. It takes time to fill up the reservoir, but it’s paid back in continuity of focus.</p>\n<p>Bottom line: automating a task can give you more continuity of focus, which is more valuable than the time it takes to automate the task.</p>\n<h2>Infrequent tasks</h2>\n<p>Some tasks are so infrequent that I forget how to do them. If I did it every day, I’d remember the steps and I could to it in 20 minutes. But because I haven’t done it in three months, I can’t remember where the pieces are that I need. I clumsily search for them, and I sometimes interrupt other people to figure out how to do it. The task that should take 20 minutes takes 45 minutes.</p>\n<p>However, if it’s automated, there might be just one step. My favorite is when the automation guides you through the steps, like a wizard. You just have to remember how to start it.</p>\n<p>Bottom line: it’s easy to forget how to do infrequent tasks and have them take longer than they should. Automation can turn them into self-driving workflows.</p>\n<h2>Compounding</h2>\n<p>The more you automate, the more ability you have to build higher-order automations. As a programmer, I think this one is pretty cool. Seriously, once I have a script to upload a YouTube video, I can write a script that uses that one to upload 100 videos. Things compound pretty quickly. Even an automation that isn’t “worth the time” (because it took longer to write than you save by running it) might become part of a larger automation that does save time. It’s non-linear.</p>\n<p>Bottom line: compounding is real. The more you automate, the more you can automate. And piece of automation gives more benefit.</p>\n<h2>Accumulating</h2>\n<p>Many automations won’t actually compound. You’ll never use one automation to automate another process. However, even when that doesn’t happen, automations do add up. You automate yourself some mental space, that gives you more mental space to use automating. And if you automate half of a process today, in six months you might find the secret to automate the rest. The point is, starting to automate little things can snowball into entire processes taking care of themselves.</p>\n<p>Bottom line: start automating now, even if you can’t see the end of the process. Every little bit counts.</p>\n<p>Now that I’ve sung the praises of automation, let’s talk about the downsides.</p>\n<h2>More code</h2>\n<p>Automations typically require code. Code is a liability. It rots. It has to be maintained. And bugs can cause serious problems. If you’ve got a script to order transcripts for your videos or to email your customers, a poorly written <code>for</code> loop can do serious damage.</p>\n<h2>Rabbit holes</h2>\n<p>Some automations don’t work. You think it’ll save time and you’ll use it a lot. But you don’t. Or you spend ten hours trying to connect to that API and you can’t get it to work. They’re mistakes in judgment. I chose to do X because I thought it would be good, but X was not good. I was wrong.</p>\n<p>But that’s not what I’m talking about with <em>rabbit holes</em>. Rabbit holes are different. Rabbit holes are failures of judgment. You’re not making decisions. You’re letting the decisions make you.</p>\n<p>If you’re in a rabbit hole, you think you’re making progress. You’re perpetually <em>almost done, </em>but not quite. You get carried away with features. You spend a lot of time on it. And maybe it works, but it adds no value. This is probably what the xkcd cartoon is referring to.</p>\n<p>Rabbit holes are dangerous because it’s so easy to focus on the problem ahead without checking back in with the big picture. It’s wise to be skeptical of automation because one fall down a rabbit hole could eat you alive.</p>\n<h2>Almost automated</h2>\n<p>There’s another phenomenon where a process is almost 100% automated, but still requires some human steps in it. That seems like it should be acceptable. After all, you removed a lot of the work. But I find it frustrating that what should be doable from a shell script still requires human intervention. What’s more, I’ve invested money and time into those tools under the false belief that they would be automatable.</p>\n<p>For instance, I send email with a service that calls itself an “automation platform”, but their API does not work according to their documentation. My newsletter workflow still requires me to copy and paste html and text versions of the newsletter into their web gui.</p>\n<p>But instead of thinking “they just don’t have that feature”, I get frustrated by it in a way that would not frustrate me if I hadn’t automated it. Is that frustration a cost? Yeah, probably a minor one. But I can’t help but notice every time I run that workflow that there’s only one step left that’s not automatic. Do I file a feature request? Do I switch services? I think about it a lot.</p>\n<p>Now let’s talk about some principles that I use to minimize the downside and</p>\n<h2>Simplicity</h2>\n<p>The KISS rules applies to automations. It’s very easy to overcomplicate a process in order to save work. Processes that are complicated, whether they are automated or not, are more work than they need to be.</p>\n<p>In general, removing steps is good. Removing moving parts is good. Removing choices is good. Keep it simple, silly!</p>\n<h2>Outsourcing</h2>\n<p>Sometimes you will benefit from an external service or software. For instance, I publish a lot of videos for my membership site. I want them to be available online to watch, and also available to download in different sizes—HD, MD, and Phone. People pay for the content. The video is just the medium for that content. Video codecs is not my area of expertise.</p>\n<p>That’s why I outsource video transcoding to Vimeo. I upload a video, it gets converted to a web-friendly format for embedding in a web page. And Vimeo also produces the HD, MD, and Phone videos that I can download and host. They do a better job than I can do, and I’m happy to pay for it.</p>\n<h2>Insourcing</h2>\n<p>Sometimes, however, you want to bring the service under your control, so you can modify it. You might want half of a process, or you genuinely might have a better way to do it. For instance, I may one day bring my automated tweets back into software I write. I’ve written Twitter clients before, so I have the code. That will let me automate it a bit more how I like it, instead of how they’ve done it as a mass-market service. I like the service, it’s just not exactly how I would do it.</p>\n<h2>Human-in-the-loop</h2>\n<p>As a programmer, I have the temptation to completely automate a thing. But sometimes it’s best to stay in the loop. Even <a href=\"https://www.fastcompany.com/40461624/how-toyota-is-putting-humans-first-in-an-era-of-increasing-automation\">Toyota is keeping humans in the process</a>. Even when they can automate something fully with robots, they choose to pay a person to be there. Why?</p>\n<p>Well, according to them, humans can spot problems and further remove waste from the system. Humans have general intelligence and can come up with new ideas. Keep a human in the loop and build the process around them. Think about enhancing a person instead of replacing them.</p>\n<h2>Small pieces</h2>\n<p>It’s a fool’s errand to automate away an entire complicated workflow. You likely won’t succeed. But if you automate a piece of one, you’ll finish quickly and have something to show for it. Add bits to it over time. But start small and let it grow as your time allows.</p>\n<h2>Lowered expectations</h2>\n<p>Your software will never paint like Picasso. Hell! It won’t paint like my six-year-old daughter. But that’s okay. If you really need to automate it, maybe it’s okay that it’s not hand-crafted and artisanal. If you need human-level artistry, automation is not going to work.</p>\n<p>Sometimes, automating a task forces me to really think about what is important about the task. I’m surprised by how much human attention I’m paying to things that nobody cares about—not my reader, not my customers, and not even me, when I am honest with myself.</p>\n<h2>Different process</h2>\n<p>Automatic workflows are different from their human-run equivalents. Humans and computers have different ergonomic needs. A computer can do many things at once. A human wants to get immediate feedback for every action. We have different needs.</p>\n<p>Because of that, I often find that I have to rearrange parts of the process to make it make sense for a computer. Some steps would be ridiculous for a person to do, but to a computer it’s natural.</p>\n<p>For instance, if I’m publishing lessons to a course, I know what lessons I just recorded. I can upload them, make pages on my site, and embed the videos to just the ones I am working on. However, my automated software doesn’t know what I’ve done. It has to find out. So the first thing it does is download metadata for <em>all</em> videos, for <em>all</em> lessons, and for <em>all</em> files. It uses that information to figure out what is missing, what has changed, and what is extra. From there, it can take the right actions.</p>\n<p>The software runs every 15 minutes, checking for new videos that need publishing. I, as a human, would never do that. I would start the process only after I recorded a new video. We’re different, and we have to change the process.</p>\n<h2>Ongoing process</h2>\n<p>Automation is an ongoing process. Our automations evolve over time. We will never be done.</p>\n<p>That should be relaxing and permissive. We should feel okay to not have everything automated yet. And we should feel okay to start anywhere and automate just a little.</p>\n<h2>Take your time</h2>\n<p>I find one of the best ways to make good automations as opposed to bad ones is to let them sit a while. Don’t rush to automate something. Do it manually first. Understand it well. Search for tools. Casually read documentation that might help you. Let it simmer. Slowly gather the ingredients. Do tests to see if you can perform a step adequately.</p>\n<p>When you’ve got all the pieces, start assembling them. There is no rush. You can continue doing it the manual way if it doesn’t work. Take your time. Comment your code. If it’s a good automation, you won’t be reading the code very often; on the contrary, you’ll let how it works slip from your mind. Time is a good test.</p>\n<h2>Conclusions</h2>\n<p>When we do a simple time accounting of a task, it rarely takes into account the real benefits of automation. Yes, there are rabbit holes we can go down. There are automations gone wrong. But you can’t look at the modern world and say that automation has been all bad.</p>\n<p>I like automation. It has helped me grow my business and avoid tedium. As an experienced programmer, I find it very pleasing to construct a helper that relieves me of work and does a good job of it.</p>\n<p>That said, I find it challenging to keep it organized and simple. There is simply a lot that needs to be done, and I’m not that organized of a person. Further, I really dislike most software. Most software offers very little room for automation. A lot of software even requires the mouse for interaction. Dragging and dropping might be okay for moving a few files around. But if you need to move thousands, the <code>mv</code> command works way better. I wish that the features of applications were accessible outside of those applications. I paid for them.</p>\n<p>In the end, I’m always on the lookout to make things run smoother and to make processes add more value. Automation is just one technique we have to do that. Don’t overuse it. But when it’s good, it’s real good and it can multiply your effectiveness.</p>\n<p>The post <a rel=\"nofollow\" href=\"https://lispcast.com/automation/\">The Surprising Benefits of Automation</a> appeared first on <a rel=\"nofollow\" href=\"https://lispcast.com\">LispCast</a>.</p>",
   :direction "ltr"},
  :updated 1565058189000,
  :entities
  [{:mentions [{:text "YouTube"}],
    :id "nlp/f/entity/wd:866",
    :salienceLevel "mention",
    :label "YouTube"}
   {:mentions [{:text "video editor"}],
    :id "nlp/f/entity/wd:1373429",
    :salienceLevel "mention",
    :label "video editing software"}
   {:mentions [{:text "xkcd"}],
    :id "nlp/f/entity/wd:13915",
    :salienceLevel "mention",
    :label "xkcd"}
   {:mentions [{:text "human factors"}],
    :id "nlp/f/entity/wd:1750812",
    :salienceLevel "mention",
    :label "ergonomics"}
   {:mentions [{:text "Phone"}],
    :id "nlp/f/entity/wd:685838",
    :salienceLevel "mention",
    :label "Phone"}],
  :alternate
  [{:href "https://lispcast.com/automation/", :type "text/html"}],
  :title "The Surprising Benefits of Automation",
  :author "Eric Normand",
  :published-str "Mon Aug 05 19:23:09 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16c64fd28c2:269cabc:73d34570",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url
   "https://lispcast.com/wp-content/uploads/2019/08/automation-297x300.png",
   :width 297,
   :height 300,
   :contentType "image/png"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://lispcast.com/?p=1968",
  :commonTopics
  [{:score 0.961,
    :id "nlp/f/topic/193",
    :salienceLevel "about",
    :label "automation"}
   {:score 0.924,
    :id "nlp/f/topic/261",
    :salienceLevel "about",
    :label "biohacking"}
   {:score 0.82,
    :id "nlp/f/topic/651",
    :salienceLevel "mention",
    :label "devops"}
   {:score 0.717,
    :id "nlp/f/topic/1828",
    :salienceLevel "mention",
    :label "productivity"}],
  :published 1565058189000,
  :fingerprint "7349afa1",
  :canonicalUrl "https://lispcast.com/automation/"}
 {:engagement 7,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/todo",
    :label "todo"}
   {:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1565023760040,
  :recrawled 1565451787075,
  :content
  {:content
   "<img src=\"http://jr0cket.co.uk/images/clojure-logo.png\">\n<p>There are a number of tools from the Clojure community which add build tool features to the Clojure CLI tools. This enables developers to have a very lightweight and customisable set of tools that just do what they need.</p>\n<p>This article just covers the very basics of each tool, see each projects documentation to get the full benefit of each tool.</p>\n<ul>\n<li><a rel=\"external\" href=\"https://github.com/Olical/depot\" target=\"_blank\">depot</a> finds newer versions of libraries (from Clojars and Git repositories)</li>\n<li><a rel=\"external\" href=\"https://github.com/lambdaisland/kaocha\" target=\"_blank\">kaocha</a> full featured next gen Clojure test runner</li>\n<li><a rel=\"external\" href=\"https://github.com/seancorfield/depstar\" target=\"_blank\">depstar</a> to package up your application for the JVM platform</li>\n</ul>\n<p>Please see earlier articles in this series for background:</p>\n<ul>\n<li><a href=\"http://jr0cket.co.uk/2019/07/gaining-confidence-with-Clojure-CLI-tools.html\">Experimenting With Clojure CLI Tools Options</a></li>\n<li><a href=\"http://jr0cket.co.uk/2019/07/a-deeper-understanding-of-Clojure-CLI-tools.html\">A Deeper Understanding of Clojure CLI Tools</a></li>\n<li><a href=\"http://jr0cket.co.uk/2019/07/getting-started-with-Clojure-CLI-tools.html\">Getting Started With Clojure CLI Tools</a></li>\n</ul>\n<a></a>\n<h2><a href=\"http://jr0cket.co.uk/categories/clojure/atom.xml#depot-find-new-library-versions\" title=\"depot - find new library versions\"></a><a rel=\"external\" href=\"https://github.com/Olical/depot\" target=\"_blank\">depot</a> - find new library versions</h2><p><a rel=\"external\" href=\"https://github.com/Olical/depot\" target=\"_blank\">depot</a> will look for newer versions of the maven (clojars, maven central) and git dependencies in the project <code>deps.edn</code> file.</p>\n<p>Install depot by adding an alias to the project <code>deps.edn</code> file or <code>$HOME/.clojure/deps.edn</code> file</p>\n<figure><table><tbody><tr><td><pre><div>1</div><div>2</div><div>3</div></pre></td><td><pre><div><span>:outdated</span> {<span>:extra-deps</span></div><div> {olical/depot {<span>:mvn/version</span> <span>&quot;1.8.4&quot;</span>}}</div><div> <span>:main-opts</span> [<span>&quot;-m&quot;</span> <span>&quot;depot.outdated.main&quot;</span>]}</div></pre></td></tr></tbody></table></figure>\n<p>To automatically update the dependency, add the <code>--update</code> option</p>\n<figure><table><tbody><tr><td><pre><div>1</div><div>2</div><div>3</div><div>4</div></pre></td><td><pre><div><span>:depot</span> {<span>:extra-deps</span></div><div> {olical/depot {<span>:mvn/version</span> <span>&quot;1.8.4&quot;</span>}}</div><div><span>:outdated</span> {<span>:main-opts</span> [<span>&quot;-m&quot;</span> <span>&quot;depot.outdated.main&quot;</span>]}</div><div><span>:outdated-update</span> {<span>:main-opts</span> [<span>&quot;-m&quot;</span> <span>&quot;depot.outdated.main&quot;</span> <span>&quot;--version&quot;</span>]}}</div></pre></td></tr></tbody></table></figure>\n<p>Show the outdated dependencies with <code>clojure -A:depot:outdated</code>.</p>\n<p>Automatically update the dependencies with <code>clojure -A:depot:outdated-update</code></p>\n<h2><a href=\"http://jr0cket.co.uk/categories/clojure/atom.xml#koacha-test-runner\" title=\"koacha test runner\"></a><a rel=\"external\" href=\"https://github.com/lambdaisland/kaocha\" target=\"_blank\">koacha</a> test runner</h2><p><a rel=\"external\" href=\"https://github.com/lambdaisland/kaocha\" target=\"_blank\">koacha</a> is a new test runner that works with Clojure CLI tools, Leiningen and Boot. Kaocha understands different types of tests including clojure.test, ClojureScript, Cucumber, Fudje, Expectations, allowing all tests to be handled in the same way. This test runner also produces very useful reports using pretty printing so its easy to get meaning from them.</p>\n<p>Install by editing your <code>deps.edn</code> file and add an alias for kaocha</p>\n<figure><table><tbody><tr><td><pre><div>1</div><div>2</div></pre></td><td><pre><div><span>:test</span> {<span>:extra-deps</span></div><div> {lambdaisland/kaocha {<span>:mvn/version</span> <span>&quot;0.0-529&quot;</span>}}}</div></pre></td></tr></tbody></table></figure>\n<p>Create a wrapper script called <code>bin/kaocha</code></p>\n<figure><table><tbody><tr><td><pre><div>1</div><div>2</div></pre></td><td><pre><div><span>#!/usr/bin/env bash</span></div><div>clojure -A:<span>test</span> -m kaocha.runner <span>&quot;<span>$@</span>&quot;</span></div></pre></td></tr></tbody></table></figure>\n<p><a rel=\"external\" href=\"https://cljdoc.org/d/lambdaisland/kaocha/0.0-529/doc/3-configuration\" target=\"_blank\">Create a tests.edn file</a> at the root of the project. Start with a default configuration by just adding the following line:</p>\n<figure><table><tbody><tr><td><pre><div>1</div></pre></td><td><pre><div>#kaocha/v1 {}</div></pre></td></tr></tbody></table></figure>\n<p><a rel=\"external\" href=\"https://cljdoc.org/d/lambdaisland/kaocha/0.0-529/doc/readme\" target=\"_blank\">Read the detailed documentation</a> to get the most out of Kaocha.</p>\n<h2><a href=\"http://jr0cket.co.uk/categories/clojure/atom.xml#depstar\" title=\"depstar\"></a><a rel=\"external\" href=\"https://github.com/seancorfield/depstar\" target=\"_blank\">depstar</a></h2><p><a rel=\"external\" href=\"https://github.com/seancorfield/depstar\" target=\"_blank\">depstar</a> creates a jar of your application or uberjar that also includes the Clojure library and can be deployed directly on the JVM platform. depstar does not ahead of time (aot) compile your project.</p>\n<p>Add the <code>:depstar</code> alias to the project <code>deps.edn</code> or <code>$HOME/.clojure/deps.edn</code> to make depstar available for all projects.</p>\n<figure><table><tbody><tr><td><pre><div>1</div><div>2</div><div>3</div></pre></td><td><pre><div><span>:aliases</span> {<span>:depstar</span></div><div> {<span>:extra-deps</span></div><div> {seancorfield/depstar {<span>:mvn/version</span> <span>&quot;0.3.1&quot;</span>}}}}</div></pre></td></tr></tbody></table></figure>\n<p>Create a jar or uberjar file using the respective command:</p>\n<figure><table><tbody><tr><td><pre><div>1</div><div>2</div></pre></td><td><pre><div>clojure -A:depstar -m hf.depstar.jar myJar.jar</div><div>clojure -A:depstar -m hf.depstar.uberjar myUberJar.jar</div></pre></td></tr></tbody></table></figure>\n<p>The <code>-v</code> or <code>--verbose</code> after the filename lists all the files that are added to the jar file.</p>\n<p>Add web assets into an uberjar by including an alias in your deps.edn:</p>\n<figure><table><tbody><tr><td><pre><div>1</div><div>2</div></pre></td><td><pre><div>{<span>:paths</span> [<span>&quot;src&quot;</span>]</div><div> <span>:aliases</span> {<span>:webassets</span> {<span>:extra-paths</span> [<span>&quot;public-html&quot;</span>]}}}</div></pre></td></tr></tbody></table></figure>\n<p>Then invoke depstar with the chosen aliases:</p>\n<figure><table><tbody><tr><td><pre><div>1</div></pre></td><td><pre><div>clojure -A:depstar:webassets -m hf.depstar.uberjar MyProject.jar</div></pre></td></tr></tbody></table></figure>\n<p>An uberjar is run using the command:</p>\n<figure><table><tbody><tr><td><pre><div>1</div></pre></td><td><pre><div>java -jar MyProject.jar -m project.core</div></pre></td></tr></tbody></table></figure>\n<h2><a href=\"http://jr0cket.co.uk/categories/clojure/atom.xml#Other-tools-to-investigate-at-another-time\" title=\"Other tools to investigate at another time\"></a>Other tools to investigate at another time</h2><ul>\n<li><a rel=\"external\" href=\"https://github.com/borkdude/clj-kondo/\" target=\"_blank\">clj-kondo</a> linter written in Clojure with <a rel=\"external\" href=\"https://github.com/borkdude/clj-kondo/blob/master/analysis/README.md#namespace-graph\" target=\"_blank\">GraphViz based dependency graph</a> and <a rel=\"external\" href=\"https://github.com/borkdude/clj-kondo/blob/master/analysis/README.md#example-tools\" target=\"_blank\">other tools</a></li>\n<li><a rel=\"external\" href=\"https://github.com/juxt/pack.alpha\" target=\"_blank\">juxt.pack</a> to package your applications as a jar, uberjar, clojars, maven, lambda and docker</li>\n<li><a rel=\"external\" href=\"https://github.com/RickMoynihan/lein-tools-deps\" target=\"_blank\">lein-tools-deps</a> - dependencies with Leiningen</li>\n<li><a rel=\"external\" href=\"https://github.com/matthias-margush/aka\" target=\"_blank\">aka</a> is for sharing aliases (not very clear what that means or why its useful - see project)</li>\n<li><a rel=\"external\" href=\"https://laughing-banach-af1115.netlify.com/\" target=\"_blank\">Plum</a> is a tool for managing Clojure projects - a wrapper for several community projects.</li>\n<li><a rel=\"external\" href=\"https://github.com/xsc/version-clj\" target=\"_blank\">version-clj</a> Clojure &amp; ClojureScript library for analysis and comparison of artifact version numbers (used by depot)</li>\n<li><a rel=\"external\" href=\"https://github.com/danielsz/meyvn\" target=\"_blank\">Meyvn</a> enables you to generate uberjars (executables) and jars (libraries), and to deploy them on remote servers, e.g. Clojars</li>\n<li><a rel=\"external\" href=\"https://github.com/borkdude/jet\" target=\"_blank\">jet</a> - CLI to transform between JSON, EDN and Transit, powered with a minimal query language.</li>\n</ul>\n<blockquote>\n<p>Visit <a rel=\"external\" href=\"https://github.com/seancorfield/dot-clojure\" target=\"_blank\">Sean Corfield’s dot-clojure repository</a> for more tools and how to configure them with Clojure CLI tools.</p>\n</blockquote>\n<h2><a href=\"http://jr0cket.co.uk/categories/clojure/atom.xml#Interesting-articles-on-Clojure-CLI-tools\" title=\"Interesting articles on Clojure CLI tools\"></a>Interesting articles on Clojure CLI tools</h2><ul>\n<li><a rel=\"external\" href=\"https://oli.me.uk/2018-02-26-clojure-projects-from-scratch/\" target=\"_blank\">Clojure CLI projects from scratch Oli.me.uk</a></li>\n<li><a rel=\"external\" href=\"https://devcenter.heroku.com/categories/clojure-support\" target=\"_blank\">Clojure on Heroku</a> now supports Clojure CLI tools.</li>\n<li><a rel=\"external\" href=\"https://tomekw.com/clojure-deps-edn-a-basic-guide/\" target=\"_blank\">Clojure deps.edn - a basic guide</a></li>\n<li><a rel=\"external\" href=\"https://manuel-uberti.github.io/programming/2018/11/14/deps-shadow-cljs/\" target=\"_blank\">Moving to deps.edn and shadow-cljs</a></li>\n<li><a rel=\"external\" href=\"https://gitlab.com/lambdatronic/clojure-webapp-template\" target=\"_blank\">a streamlined template for developing a new Clojure+Clojurescript web application with the Clojure CLI tools</a><br>*</li>\n</ul>\n<p>Thank you.<br><a rel=\"external\" href=\"https://twitter.com/jr0cket\" target=\"_blank\">@jr0cket</a></p>",
   :direction "ltr"},
  :updated 1565352752000,
  :entities
  [{:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "about",
    :label "Clojure"}
   {:mentions [{:text "CLI"}],
    :id "nlp/f/entity/wd:189053",
    :salienceLevel "about",
    :label "command-line interface"}
   {:mentions [{:text "JVM"}],
    :id "nlp/f/entity/wd:193321",
    :salienceLevel "mention",
    :label "Java Virtual Machine"}
   {:mentions [{:text "$HOME"}],
    :id "nlp/f/entity/wd:818391",
    :salienceLevel "mention",
    :label "home directory"}
   {:mentions [{:text "Leiningen"}],
    :id "nlp/f/entity/wd:205362",
    :salienceLevel "mention",
    :label "Leiningen"}],
  :alternate
  [{:href
    "http://jr0cket.co.uk/2019/08/community-tools-and-templates-for-Clojure-CLI-tools.html",
    :type "text/html"}],
  :title "Community Tools and Templates for Clojure CLI Tools",
  :author "John Stevenson",
  :published-str "Fri Aug 09 05:12:32 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16c62af6ea8:23ae0da:73d34570",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url "http://jr0cket.co.uk/images/clojure-logo.png",
   :width 236,
   :height 248,
   :contentType "image/png"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "http://jr0cket.co.uk/2019/08/community-tools-and-templates-for-Clojure-CLI-tools.html",
  :updateCount 2,
  :commonTopics
  [{:score 77.98470856702541,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.965,
    :id "nlp/f/topic/380",
    :salienceLevel "about",
    :label "canning"}
   {:score 0.819,
    :id "nlp/f/topic/1833",
    :salienceLevel "mention",
    :label "project management"}
   {:score 0.795,
    :id "nlp/f/topic/2035",
    :salienceLevel "mention",
    :label "sec tools"}
   {:score 0.72,
    :id "nlp/f/topic/2501",
    :salienceLevel "mention",
    :label "woodworking"}],
  :published 1565352752000,
  :fingerprint "912a6262",
  :canonicalUrl
  "http://jr0cket.co.uk/2019/08/community-tools-and-templates-for-Clojure-CLI-tools.html"}
 {:engagement 4,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1565015439729,
  :content
  {:content
   "<p>You may not be concerned with what version of Java or Node you are using to run your JavaScript on a regular basis. However, setting up a CI build that can run successfully and repeatedly over the years is a pretty crucial endeavor. Here are a few pointers to set up Java and Node properly in Linux.<span></span></p>\n<h2>Locking Down a Java Runtime</h2>\n<p>Your version of Linux will likely come with a version of Java (such as Java, <a href=\"http://feeds.feedblitz.com/~/t/0/0/atomicspin/~https://clojure.org\">Clojure</a>, or even <a href=\"http://feeds.feedblitz.com/~/t/0/0/atomicspin/~https://kotlinlang.org\">Kotlin</a>) already installed, which will give you a Java Virtual Machine (JVM) to run your application. Though your app may be flexible enough to run on whatever modern-ish Java version at runtime, that may not hold true over time, due to the various libraries and dependencies you pick up over the lifetime of your application.</p>\n<p>It’s natural to want to upgrade your Java environment as the world marches forward, but you’ll also want to ensure that your application will still work in an older Java environment. That may mean having multiple Java Development Kits (JDKs) and Java Runtime Environments (JREs) installed on your development machine.</p>\n<p>You will likely use your operating system’s package manager to install other Javas, but choosing the right one is crucial to your workflow. In addition to verifying that your JAVA_HOME variable is set properly, you’ll also need to check that ‘java’ and ‘javac’ executables are pointing to the right binaries to run.</p>\n<p>You could manage this all manually, but I strongly recommend you use a tool designed just for this purpose. Though ‘update-alternatives’ tool is one option, the ‘update-java-alternatives’ tool nicely coordinates them all. I recommend using ‘update-java-alternatives’ to install the various Java frameworks and switch between them.</p>\n<h2>Locking Down Node</h2>\n<p>Managing your Node version is a little easier, thanks to a couple of decent tools.</p>\n<h3>NVM – Node Version Manager</h3>\n<p>To install a new version of Node.js, (the latest is currently V.10), simply do the following: <code>nvm install 10</code>.\n<br>\nUse this to switch to Node 10: <code>nvm use 10</code>.\n<br>\nTo list all of the versions of Node.js installed: <code>nvm ls</code>.</p>\n<p>It is also easy to set a default Node version for any given project by creating a file <code>.nvmrc</code> in the root of your project/repository containing the string indicating which Node version to use.</p>\n<h3>N – Another Node Version Manager</h3>\n<p>Another alternative to manage multiple Node.js installations is called simply “N.” It has an even simpler API:</p>\n<p>To install and/or switch to version 10: <code>n 10</code>\n<br>\nTo list all installed versions on Node.js: <code>n</code>\n<br>\nYep, that’s it!</p>\n<p>The post <a rel=\"nofollow\" href=\"http://feeds.feedblitz.com/~/t/0/0/atomicspin/~https://spin.atomicobject.com/2019/08/05/manage-java-environment/\">Taming Your Java Environment</a> appeared first on <a rel=\"nofollow\" href=\"http://feeds.feedblitz.com/~/t/0/0/atomicspin/~https://spin.atomicobject.com\">Atomic Spin</a>.</p>\n<img border=\"0\" src=\"https://feeds.feedblitz.com/~/i/605269596/0/atomicspin\" alt=\"\" width=\"1\" align=\"left\" hspace=\"0\" height=\"1\">",
   :direction "ltr"},
  :updated 1565010860000,
  :entities
  [{:mentions [{:text "Java"}],
    :id "nlp/f/entity/wd:251",
    :salienceLevel "mention",
    :label "Java"}
   {:mentions [{:text "Node"}],
    :id "nlp/f/entity/wd:1225562",
    :salienceLevel "mention",
    :label "Node"}
   {:mentions [{:text "Linux"}],
    :id "nlp/f/entity/wd:388",
    :salienceLevel "mention",
    :label "Linux"}
   {:mentions [{:text "Node"}],
    :id "nlp/f/entity/wd:756100",
    :salienceLevel "mention",
    :label "Node.js"}
   {:mentions [{:text "NVM"}],
    :id "nlp/f/entity/wd:10997658",
    :salienceLevel "mention",
    :label "non-volatile memory"}],
  :alternate
  [{:href
    "https://feeds.feedblitz.com/~/605269596/0/atomicspin~Taming-Your-Java-Environment/",
    :type "text/html"}],
  :title "Taming Your Java Environment",
  :author "Greg Williams",
  :published-str "Mon Aug 05 06:14:20 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16c62307971:22f2f1a:73d34570",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url "https://spin.atomicobject.com/wp-content/uploads/Java.png",
   :width 1000,
   :height 538,
   :contentType "image/png"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://spin.atomicobject.com/?p=153163",
  :commonTopics
  [{:score 80.33841813849624,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.827,
    :id "nlp/f/topic/52",
    :salienceLevel "mention",
    :label "agile"}],
  :published 1565010860000,
  :fingerprint "d0c14316",
  :canonicalUrl
  "https://feeds.feedblitz.com/~/605269596/0/atomicspin~Taming-Your-Java-Environment/"}
 {:tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1565015439729,
  :content
  {:content
   "<img src=\"https://res.infoq.com/presentations/music-functional-composition/en/headerimage/Chris-Ford-h-1560408129965.jpg\"><p>Chris Ford demonstrates that music theory can be delightfully represented as code. He shows how to make music starting with the basic building block of sound, the sine wave, and gradually accumulates abstractions culminating in a canon by Johann Sebastian Bach. Examples will be live-coded in Clojure.</p> <i>By Chris Ford</i>",
   :direction "ltr"},
  :updated 1565010000000,
  :entities
  [{:mentions [{:text "Johann Sebastian Bach"}],
    :id "nlp/f/entity/wd:1339",
    :salienceLevel "about",
    :label "Johann Sebastian Bach"}
   {:mentions [{:text "music theory"}],
    :id "nlp/f/entity/wd:193544",
    :salienceLevel "mention",
    :label "music theory"}
   {:mentions [{:text "sine wave"}],
    :id "nlp/f/entity/wd:207527",
    :salienceLevel "mention",
    :label "sine wave"}
   {:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}],
  :alternate
  [{:href
    "https://www.infoq.com/presentations/music-functional-composition?utm_campaign=infoq_content&utm_source=infoq&utm_medium=feed&utm_term=global",
    :type "text/html"}],
  :title "Presentation: Functional Composition",
  :author "Chris Ford",
  :published-str "Mon Aug 05 06:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16c62307971:22f2f19:73d34570",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url
   "https://res.infoq.com/presentations/music-functional-composition/en/headerimage/Chris-Ford-h-1560408129965.jpg",
   :width 800,
   :height 533,
   :contentType "image/jpeg"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://www.infoq.com/presentations/music-functional-composition?utm_campaign=infoq_content&utm_source=infoq&utm_medium=feed&utm_term=global",
  :commonTopics
  [{:score 66.14844093378358,
    :id "nlp/f/topic/3009",
    :salienceLevel "about",
    :label "music"}
   {:score 28.786338495161342,
    :id "nlp/f/topic/3017",
    :salienceLevel "about",
    :label "basketball"}
   {:score 0.757,
    :id "nlp/f/topic/1524",
    :salienceLevel "mention",
    :label "music production"}],
  :published 1565010000000,
  :fingerprint "3a6b624e",
  :canonicalUrl
  "https://www.infoq.com/presentations/music-functional-composition?utm_campaign=infoq_content&utm_source=infoq&utm_medium=feed&utm_term=global"}
 {:engagement 4,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1565001508731,
  :content
  {:content
   "<div>\n<p><em>Issue 338 – August 05, 2019 · <a href=\"https://purelyfunctional.tv/newsletter-archives/\">Archives</a> · <a title=\"Thanks, Jeff!\" href=\"https://purelyfunctional.tv/newsletter/\">Subscribe</a></em></p>\n<h2>Clojure Tip 💡</h2>\n<p><em>Re-implement your code multiple times</em></p>\n<p>One of the best ways to get good at the idiom-level coding is to re-implement the same function multiple times. Implement it once, and get it working. Then have fun and try to implement it a different way. Try to do it without let-bound variables. Then try it with only built-in functions. Try it in point-free style (using <code>partial</code> and <code>comp</code>). What does it look like if you change the order of arguments.</p>\n<p>Each of these constraints will force you to come up with creative solutions. Your brain is taxed and you get better. Over time, you’ll find that your expressivity with the code is much better. Your first attempt will be better than before. It’s a great way to get better.</p>\n<p>I talk about this is a <a title href=\"https://lispcast.com/why-should-you-throw-away-all-of-your-code/\">recent episode of my podcast</a>.</p>\n<h2>Clojure Media 🍿</h2>\n<p><a title href=\"https://purelyfunctional.tv/guide/how-to-install-clojure/\">How to install Clojure</a></p>\n<p>I recently updated an old install guide for Clojure. I dusted off VirtualBox and tried out every single command on a brand new install of all three of the main operating systems. I’d love to keep this up to date and add more troubleshooting tips. If you have any trouble installing Clojure, please let me know.</p>\n<h2>Currently recording 🎥</h2>\n<p>I am now recording a course called <a title href=\"https://purelyfunctional.tv/courses/property-based-testing-with-test-check/\"><em>Property-Based Testing with test.check</em></a>. Property-based testing (PBT) is a powerful tool for generating tests instead of writing them. You’ll love the way PBT makes you think about your system. And you can <a title href=\"https://purelyfunctional.tv/courses/property-based-testing-with-test-check/\">buy it now</a> in Early Access. Of course, PF.tv members have had access since the beginning, along with all of the other courses.</p>\n<p>I’m excited about these three new lessons (over 60 minutes of video). The question I’ve heard most consistently about PBT is how to come up with properties. The examples people give are too simplistic. This is an important skill to employ, and I never wanted anyone who took my course to feel like they didn’t have a toolbox of options.</p>\n<p>These three new lessons are just the start. They each look at different ways to come up with good properties. Here are the new lessons this week:</p>\n<ol>\n<li><a title href=\"https://purelyfunctional.tv/lesson/strategies-for-properties-functionality/\">Strategies for properties: functionality</a>, in which we take the direct approach and test that the function does the work it is meant to do.</li>\n<li><a title href=\"https://purelyfunctional.tv/lesson/strategies-for-properties-invariants/\">Strategies for properties: invariants</a>, in which we learn that sometimes it is easier to test what shouldn’t change.</li>\n<li><a title href=\"https://purelyfunctional.tv/lesson/strategies-for-properties-algebraic-properties/\">Strategies for properties: algebraic properties</a>, in which we see how algebraic properties can help us come up with properties.</li>\n</ol>\n<p>There are three more lessons about creating properties.</p>\n<p>I’ve made the first and fifth lessons free to watch. <a title href=\"https://purelyfunctional.tv/courses/property-based-testing-with-test-check/\">Go check them out</a>.</p>\n<p>Members already have access to the lessons. The Early Access Program is open. If you <a title href=\"https://purelyfunctional.tv/courses/property-based-testing-with-test-check/\">buy now</a>, you will get the already published material and everything else that comes out at a serious discount. There are already 5 hours of video, and looking at my plan, this one might be 9-10 hours. But that’s just an estimate. It could be more or less. The uncertainty about it is why there’s such a discount for the Early Access Program.</p>\n<h2>Clojure Challenge 🤔</h2>\n<h3>Last week’s challenge</h3>\n<p>The puzzle in <a title href=\"https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-337-functional-programming-is-deep/\">Issue 337</a> was to implement Soundex.</p>\n<p>You can check the submissions out <a title href=\"https://gist.github.com/ericnormand/9e54b331bdcf30e781cd129bde5b9c8b\">here</a>.</p>\n<h3>This week’s challenge</h3>\n<p><em>Derivative of a function</em></p>\n<p>In Calculus class, I learned two forms for the derivative. The first was the Limit definition. The other was a symbolic method, which used many identities that you had to learn to be able to find the derivative.</p>\n<p>Here is the limit definition of the derivative:</p>\n<p><img title=\"\" src=\"https://purelyfunctional.tv/wp-content/uploads/2019/08/derivative.png\"></p>\n<p>For this challenge, define a function <code>deriv</code> that takes a function and returns the derivative of that function, using the limit definition. You can use any very small value for <code>h</code>, or perhaps provide it as an optional argument.</p>\n<p>This exercise is taken from <a title href=\"https://mitpress.mit.edu/sites/default/files/sicp/full-text/book/book-Z-H-4.html#%_toc_%_sec_Temp_116\">SICP Chapter 1, Section 3.4</a>.</p>\n<p>As usual, please send me your answers. I’ll share them all in next week’s issue. If you send me one, but you don’t want me to share it publicly, please let me know.</p>\n<p>Rock on!<br>Eric Normand</p>\n</div>\n<p>The post <a rel=\"nofollow\" href=\"https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-338-tip-re-implement-multiple-times/\">PurelyFunctional.tv Newsletter 338: Tip: Re-implement multiple times</a> appeared first on <a rel=\"nofollow\" href=\"https://purelyfunctional.tv\">PurelyFunctional.tv</a>.</p>",
   :direction "ltr"},
  :updated 1564999200000,
  :entities
  [{:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "about",
    :label "Clojure"}
   {:mentions [{:text "60 minutes"}],
    :id "nlp/f/entity/wd:25235",
    :salienceLevel "mention",
    :label "hour"}
   {:mentions [{:text "VirtualBox"}],
    :id "nlp/f/entity/wd:11393",
    :salienceLevel "mention",
    :label "VirtualBox"}
   {:mentions [{:text "Soundex"}],
    :id "nlp/f/entity/wd:1502023",
    :salienceLevel "mention",
    :label "Soundex"}
   {:mentions [{:text "SICP"}],
    :id "nlp/f/entity/wd:1249747",
    :salienceLevel "mention",
    :label "Structure and Interpretation of Computer Programs"}],
  :alternate
  [{:href
    "https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-338-tip-re-implement-multiple-times/",
    :type "text/html"}],
  :title
  "PurelyFunctional.tv Newsletter 338: Tip: Re-implement multiple times",
  :author "Eric Normand",
  :published-str "Mon Aug 05 03:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16c615be77b:2149625:4b2e0c8b",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url
   "https://purelyfunctional.tv/wp-content/uploads/2019/08/derivative.png",
   :width 926,
   :height 154,
   :contentType "image/png"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://purelyfunctional.tv/?p=31728",
  :commonTopics
  [{:score 0.829,
    :id "nlp/f/topic/1837",
    :salienceLevel "mention",
    :label "property management"}
   {:score 0.804,
    :id "nlp/f/topic/874",
    :salienceLevel "mention",
    :label "fitness"}
   {:score 0.793,
    :id "nlp/f/topic/294",
    :salienceLevel "mention",
    :label "bodybuilding"}
   {:score 0.731,
    :id "nlp/f/topic/1871",
    :salienceLevel "mention",
    :label "quant"}
   {:score 0.718,
    :id "nlp/f/topic/1240",
    :salienceLevel "mention",
    :label "journalism"}],
  :published 1564999200000,
  :fingerprint "a96ae002",
  :canonicalUrl
  "https://purelyfunctional.tv/issues/purelyfunctional-tv-newsletter-338-tip-re-implement-multiple-times/"}
 {:engagement 4,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/todo",
    :label "todo"}
   {:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1564998921353,
  :content
  {:content
   "<p>In <a href=\"https://maxweber.github.io/blog/2019-07-25-introducing-db-view-part-1\">part 1</a> I've talked about the db-view approach that has different trade-offs in comparison to a REST API. In essence you decide to develop your backend API endpoint with a single frontend app in mind. Thereby your API endpoint and frontend tends to stay <a href=\"https://www.infoq.com/presentations/Simple-Made-Easy/\">simple</a>.</p><p>This part is about the example app that I've developed for this blog post series. It implements the well-known <a href=\"http://todomvc.com/\">TodoMVC</a> example, an app to manage todo items. In comparison to many other TodoMVC implementations out there, it implements the frontend and the backend. It is a core principle of the db-view approach that you design your API exclusively for one frontend app, instead of providing a more generic API. The latter one introduces <a href=\"https://maxweber.github.io/blog/2019-06-15-approaching-the-web-after-tomorrow-part-3\">various complexities</a> which needs to be solved, despite the fact that they are not strictly required for your app.</p><p>The source code for the example app can be found here:</p><p><a href=\"https://github.com/maxweber/todomvc-db-view\">https://github.com/maxweber/todomvc-db-view</a></p><p>It uses Clojure for the backend and ClojureScript for the frontend. The <a href=\"https://leiningen.org/\">Leiningen</a> build tool is used for the Clojure part, while <a href=\"https://github.com/thheller/shadow-cljs\">shadow-cljs</a> is used for the frontend. The example <a href=\"https://github.com/maxweber/todomvc-db-view/blob/master/README.md\">README</a> describes how to start the app and the required tools.</p><p>The API endpoint <code>/db-view/get</code> is used to receive the <code>:db-view/output</code> map from the server. This is the corresponding frontend code:</p><pre><code>(ns todomvc-db-view.db-view.get\n  (:require [cljs.core.async :as a]\n            [cljs-http.client :as http]\n            [todomvc-db-view.state.core :as state])\n  (:require-macros [cljs.core.async.macros :refer [go]]))\n\n;; Concept:\n;;\n;; Gets and refreshes the db-view from the server. Provides the server\n;; API endpoint '/db-view/get' with the `:db-view/input` map from the\n;; app state. Receives the `:db-view/output` map in the API response\n;; and stores it in the app state. Reagent will trigger a rerender of\n;; all UI components which depend on changed parts of the\n;; `:db-view/output`.\n\n(defn get-view\n  &quot;Provides the server API endpoint '/db-view/get' with the\n   `:db-view/input` map from the app state and returns the API response\n   that contains the `:db-view/output` map.&quot;\n  [state-value]\n  (go\n    (let [response (&lt;! (http/request\n                        {:request-method :post\n                         :url &quot;/db-view/get&quot;\n                         ;; NOTE: for a production app add\n                         ;;       authorization here and prefer the\n                         ;;       Transit format:\n                         :edn-params (:db-view/input state-value)}))]\n      (:body response))))\n\n(defn refresh!\n  &quot;Provides the server API endpoint '/db-view/get' with the\n   `:db-view/input` map from the app state, receives the\n   `:db-view/output` map from the API response and stores it in the app\n   state.&quot;\n  []\n  (go\n    (:db-view/output\n     (swap! state/state\n            assoc\n            :db-view/output\n            (&lt;! (get-view @state/state))))))\n</code></pre><p>In the recent years I tend to use a light form of <a href=\"https://en.wikipedia.org/wiki/Literate_programming\">Literate programming</a>, where you provide more explanation of the logic in a natural language. Therefore you find the explanation of the source code in the 'Concept' header, the comments and the doc-strings of the functions above.</p><p>The app state is hold in a <a href=\"https://github.com/reagent-project/reagent\">Reagent</a> atom:</p><pre><code>(ns todomvc-db-view.state.core\n  (:require [reagent.core :as r]))\n\n;; Concept:\n;;\n;; Namespace with the Reagent atom `state` that holds the global app\n;; state of this ClojureScript app.\n\n(def initial-state-value\n  {:db-view/input {:todo/list {}}})\n\n(defonce state\n  (r/atom initial-state-value))\n</code></pre><p>The counterpart for the <code>/db-view/get</code> API endpoint on the server-side looks like this:</p><pre><code>(ns todomvc-db-view.db-view.get\n  (:require [datomic.api :as d]\n            [todomvc-db-view.util.edn :as edn]\n            [todomvc-db-view.db-view.todo-list :as todo-list]\n            [todomvc-db-view.db-view.todo-edit :as todo-edit]\n            [todomvc-db-view.db-view.todo-new :as todo-new]))\n\n;; Concept:\n;;\n;; Provides the API endpoint to get the db-view. The request body\n;; contains the parameters to query the database to assemble the\n;; `:db-view/output` map, that contains the required data for the\n;; current active UI parts. This value is returned in the response\n;; body and the client stores it in the Reagent app state atom, where\n;; the UI components can access it.\n\n(defn get-view\n  &quot;Main entry point to gather the `:db-view/output` map for the\n   client. Based on the given Datomic database value `db` and the\n   `:db-view/input` map from the client.&quot;\n  [db db-view-input]\n  (merge\n   (todo-list/get-view db\n                       db-view-input)\n   (todo-edit/get-view db\n                       db-view-input)\n   (todo-new/get-view db\n                      db-view-input)\n   ;; NOTE: add other db-view parts here.\n   ))\n\n(defn ring-handler\n  &quot;Ring handler to get the `:db-view/output` map for the given\n   `:db-view/input` map in the `request` body.&quot;\n  [db request]\n  (when (and (= (:request-method request) :post)\n             (= (:uri request) &quot;/db-view/get&quot;))\n    ;; NOTE: for a production app rather use\n    ;;       [Transit](https://github.com/cognitect/transit-format)\n    ;;       here instead of EDN:\n    (let [db-view-input (edn/read-string (slurp (:body request)))]\n      ;; NOTE: for a production app do the appropriate authorization\n      ;;       checks:\n      (edn/response\n       (get-view db\n                 db-view-input)))))\n</code></pre><p>I already included the commands into the example app, which are used to perform side-effects like adding a new todo-item. Commands will be explained in detail in the next blog post. Now let's have a look at the namespace that contains the db-view implementation for the todo list UI:</p><pre><code>(ns todomvc-db-view.db-view.todo-list\n  (:require [datomic.api :as d]))\n\n;; Concept:\n;;\n;; The db-view part for the todo list UI.\n\n(defn q-all\n  &quot;Queries all todo-item entities and pulls the attributes which are\n   required for todo list UI.&quot;\n  [db]\n  (d/q\n   '[:find\n     [(pull ?e\n            [:db/id :todo/title :todo/done]) ...]\n     :where\n     [?e :todo/title]]\n   db))\n\n(defn get-view\n  &quot;Returns the db-view for the todo list UI.&quot;\n  [db db-view-input]\n  (when-let [params (:todo/list db-view-input)]\n    (let [all (q-all db)\n          {:keys [active completed]} (group-by (fn [todo-item]\n                                                 (if (:todo/done todo-item)\n                                                   :completed\n                                                   :active))\n                                               all)\n          todo-items (case (:todo/filter params)\n                       :active\n                       active\n                       :completed\n                       completed\n                       all)]\n      {:todo/list {:todo/list-items todo-items\n                   :todo/active-count (count active)\n                   :todo/completed-count (count completed)}})))\n</code></pre><p>In the code above I removed the command-related parts for the purpose of this blog post, but you can already find it in the <a href=\"https://github.com/maxweber/todomvc-db-view/blob/master/src/clj/todomvc_db_view/db_view/todo_list.clj\">Github repo</a>. Altogether the code is really straightforward:</p><ul><li>it runs a Datomic query that gets all todo-items with the attributes required for the todo list UI</li><li>groups the query results into active and completed todo-items</li><li>returns the group that was requested via the <code>:todo/filter</code> parameter as <code>:todo/list-items</code></li><li>counts the active and completed todo-items (this information is used in the bottom bar of the todo list UI)</li></ul><p>The notify part of the app enables the real-time or rather auto-update behaviour of the example app. To try it out, just open the example app in two browser windows, then you see that changes in one window also get replicated in the other window. On the client side the code looks like this:</p><pre><code>(ns todomvc-db-view.db-view.notify\n  (:require [cljs-http.client :as http]\n            [todomvc-db-view.db-view.get :as get]\n            [cljs.core.async :as a])\n  (:require-macros [cljs.core.async.macros :refer [go-loop]]))\n\n;; Concept:\n;;\n;; Listens for changes in the Datomic transaction log, which affect\n;; the current logged-in user. Uses HTTP long polling to allow the API\n;; endpoint on the server to push a message. The server will notify\n;; the client everytime, when a transaction contains something\n;; relevant for the current logged-in user.\n;;\n;; Due to this mechanism the client can show updates, which were issued\n;; by the server (a finished background job for example or a change by\n;; another user).\n\n(defn start-listening\n  &quot;Starts a go-loop that opens a long-polling request to the\n   '/db-view/notify' API endpoint. Refreshes the `:db-view/output` map\n   in the app state, when it receives a HTTP 200 response. Sleeps for a\n   short moment, when it receives an error response to not DDoS the\n   server in the case of a server issue.&quot;\n  []\n  (go-loop []\n    (let [response (&lt;! (http/request\n                         {:request-method :post\n                          :url &quot;/db-view/notify&quot;}))]\n      (if (= (:status response)\n             200)\n        (&lt;! (get/refresh!))\n        (&lt;! (a/timeout 2000)))\n      (recur))))\n</code></pre><p>The server counterpart looks like this:</p><pre><code>(ns todomvc-db-view.db-view.notify\n  (:require [org.httpkit.server :as httpkit]\n            [datomic.api :as d]\n            [todomvc-db-view.util.edn :as edn]))\n\n;; Concept:\n;;\n;; Provides an API endpoint that allows clients to listen for changes\n;; in the Datomic transaction log, which affect their current\n;; logged-in user.\n;;\n;; Thereby the client can refresh the `:db-view/output` map as soon as\n;; it is notified by this API endpoint. HTTP long polling is used here\n;; to allow the server to push a message to the client. It is less\n;; complex to implement in comparison to WebSockets. Furthermore the\n;; low latency and reduced payload size of WebSockets is not required\n;; for this use case.\n\n(defonce client-listeners-state\n  ;; holds the httpkit channels of the clients, which are waiting for\n  ;; a db-view notify:\n  (atom {}))\n\n(defn ring-handler\n  &quot;Ring-handler for the '/db-view/notify' API endpoint.&quot;\n  [request]\n  (when (and (= (:request-method request) :post)\n             (= (:uri request) &quot;/db-view/notify&quot;))\n    ;; NOTE: for a production app add an authentication check here:\n    (httpkit/with-channel request channel\n      ;; register the user's browser session in the\n      ;; `client-listeners-state`:\n      (swap! client-listeners-state\n             assoc\n             channel\n             channel)\n      (httpkit/on-close channel\n                        (fn [status]\n                          ;; remove the user's browser session from\n                          ;; the `client-listeners-state` as soon as\n                          ;; the channel is closed, meaning the user\n                          ;; has closed the browser tab or the network\n                          ;; connection was interrupted:\n                          (swap! client-listeners-state\n                                 dissoc\n                                 channel))))))\n\n(defn notify\n  &quot;A Datomic transaction listener that notifies all user browser\n   sessions, where the user was affected by the transaction of the\n   `tx-report`.&quot;\n  [tx-report]\n  (let [basis-t (d/basis-t (:db-after tx-report))\n        response (edn/response\n                  {:db/basis-t basis-t})]\n    ;; NOTE: for a production app only send notifications to the users\n    ;;       which are affected by this `tx-report`:\n    (doseq [channel (vals @client-listeners-state)]\n      (httpkit/send! channel\n                     response))))\n</code></pre><p>As already mentioned in the note above you would normally only notify the connected users (client-listeners) which are affected by the current Datomic transaction report. For example if your app supports teams and one user makes a change on the team's todo list, only the team mates which are currently online would be notified.</p><p>Datomic has this great feature that you can access the transaction log and even receive push updates of new transactions via the <a href=\"https://docs.datomic.com/on-prem/clojure/index.html#datomic.api/tx-report-queue\"><code>datomic.api/tx-report-queue</code></a>. Most likely you will have multiple web servers, which response to db-view requests and executes commands (which transacts Datomic transactions). With the help of Datomic's transaction queue it does not matter to which server the client has opened the long-polling HTTP request, since all servers will be informed of the new transaction and initiate the necessary notification for an affected user.</p><p>The db-view approach also works for other databases than Datomic. But most of them do not provide access to a transaction queue. A do-it-yourself alternative to push the notifications is an effort that should not be underestimated. Therefore I would recommend services like <a href=\"https://pusher.com/\">Pusher</a> or <a href=\"https://www.pubnub.com/\">Pubnub</a>, where you can push messages to the user's web browser, without building the required infrastructure yourself. The server would then send the notifications to the affected users right after it has transacted the corresponding Datomic transaction.</p><p>As already mentioned, the next blog post will cover the concept of commands in the context of a db-view application.</p>",
   :direction "ltr"},
  :updated 1564956000000,
  :entities
  [{:mentions [{:text "API"}],
    :id "nlp/f/entity/wd:165194",
    :salienceLevel "mention",
    :label "application programming interface"}
   {:mentions [{:text "server"} {:text "server-side"}],
    :id "nlp/f/entity/wd:44127",
    :salienceLevel "mention",
    :label "server"}
   {:mentions [{:text "client"} {:text "client-side"}],
    :id "nlp/f/entity/wd:528166",
    :salienceLevel "mention",
    :label "client"}
   {:mentions [{:text "concept"}],
    :id "nlp/f/entity/wd:151885",
    :salienceLevel "mention",
    :label "concept"}
   {:mentions [{:text "web browser"} {:text "browser"}],
    :id "nlp/f/entity/wd:6368",
    :salienceLevel "mention",
    :label "web browser"}],
  :alternate
  [{:href
    "https://maxweber.github.io/blog/2019-08-05-introducing-db-view-part-2",
    :type "text/html"}],
  :title "Introducing db-view - Part 2",
  :author "Max Weber",
  :published-str "Sun Aug 04 15:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16c61346c89:2112246:561e4df6",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://maxweber.github.io/blog/2019-08-05-introducing-db-view-part-2",
  :commonTopics
  [{:score 33.109457073544974,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.974,
    :id "nlp/f/topic/1196",
    :salienceLevel "about",
    :label "ios"}
   {:score 0.837,
    :id "nlp/f/topic/651",
    :salienceLevel "mention",
    :label "devops"}],
  :published 1564956000000,
  :fingerprint "36ca6e18",
  :canonicalUrl
  "https://maxweber.github.io/blog/2019-08-05-introducing-db-view-part-2"}
 {:engagement 4,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1564984242794,
  :content
  {:content
   "<p>Level 1 of functional thinking is to distinguish between actions, calculations, and data. But what is a calculation? In this episode, we go over what it is, how to recognize them, and how to implement them. By the end, you should understand why they are so important to functional programming.</p>\n<p></p>\n<h2>Transcript</h2>\n<p>Eric Normand: What is a calculation? By the end of this episode, you will understand how to represent timeless calculations in your language. My name is Eric Normand and I help people thrive with functional programming.</p>\n<p>This is an important topic. I have a three-level system, three-level scheme, for how you can progress in your functional thinking journey. In the first level, the most fundamental level, you have to make a distinction between actions, calculations, and data. This distinction is necessary for the next two levels.</p>\n<p>I’ve already gone through actions in another episode. You should look that one up if you’re interested. In this one, we’re going to go over calculations. We’re going to go over what they are, how to identify them, their requirements and how to implement them. Let’s get started.</p>\n<p>As a rule of thumb, I like to say calculations are runnable code. They’re computations that do not depend on when they are run or how many times they are run. That doesn’t explain much. It’s a rule of thumb. It’s a way of identifying them. We’ll come back to this a few times in this episode. They are the kind of mathematical function that you think about.</p>\n<p>Another term that we hear a lot in functional programming is a pure function. It is a function from inputs to outputs. It’s a computation that takes some inputs and returns an output. It doesn’t do anything else. It doesn’t send an email. It doesn’t change any mutable values in your program. It simply does a calculation.</p>\n<p>When you have one of these, because it doesn’t matter when it’s run or how many times it’s run, it’s always going to give that same answer no matter what. They’re easy to test. They’re easy to understand how they work. You don’t have to look at the whole program and the history of the program to understand how it works.</p>\n<p>If you can say, “Hey, this one doesn’t depend on when it’s run or doesn’t matter how many times I run this. I’m always going to get the same answer.” Then you have a calculation. Now it can get tricky because calculations aren’t always functions. That’s why I don’t use the term “Pure function”.</p>\n<p>Because in a lot of languages…Function already has a lot of connotation when you’re talking in the context of programming languages. More functional languages tend to use functions more, but languages like C, Java, JavaScript, and Python, most languages, don’t always use a functions, even when it’s a mathematical function.</p>\n<p>Easy example, addition. In JavaScript, addition is an arithmetic operator. It is not a function. You do not call it the same way as you call a function.</p>\n<p>It is not a function. It’s a piece of syntax that the compiler recognizes and converts into machine code or whatever, it interprets it. It’s a different way of interpreting from interpreting functions. That is one reason why I call them calculations instead of functions. Is because function already has meaning to most programmers.</p>\n<p>It’s unfortunate, it’s sad that it’s not the same meaning mathematicians have. It would be better to have a more accurate usage of these different terms but that’s the way it is. Pure function gets at it, but then again it’s function. What about plus? What about times? These aren’t functions in most languages.</p>\n<p>When you have something like addition, in JavaScript, the plus operator. It’s pure, it’s a pure function right? Like in the abstract sense. Meaning, if you give it the same arguments, it will evaluate to the same answer.</p>\n<p>One plus two is always going to be three, right? A plus B is always going to be C, if you have the same values of A and B. It does make it easy to reason about. The problem is, that operator is not first-class. It cannot be passed to another function.</p>\n<p>JavaScript has first-class functions. You can pass a function as an argument to another function. You can save a function to a variable. You can return a function from another function. You can’t do any of those things with the Plus operator.</p>\n<p>The reason you need to do that is because at level one you start doing what are called, “Higher order operations.” You start doing Map, Filter, Reduce. You start building abstractions that take functions and return functions. You have functions that operate on functions. You can’t do that with Plus.</p>\n<p>What you need to do in your language is to find a way to represent all of those things that are not first-class baked in and represent them as a first-class thing. That is one of the challenges of doing functional programming in a non-functional language.</p>\n<p>JavaScript makes it relatively easy. You can always define a function called, Plus, P-L-U-S that takes two arguments and adds them and returns the answer. That’s easy to write. It’s so small now with the new lambda syntax that you can do that inline. You don’t even have to name the function. It can be anonymous.</p>\n<p>When you do that, you now have a function that does plus, it does addition but it’s first-class. You can start doing level two things. Did I say, “Level one?” Yeah, first-class is definitely level two. I got to change my notes here.</p>\n<p>Level one, just to be clear because I just messed it up. Level one is making this distinction between actions, calculations, and data. Level two is higher order thinking. This is data transformation pipelines. It’s Map, Filter, Reduce. It’s making higher order actions. You need to be able to represent these things as first-class values, like you can in JavaScript.</p>\n<p>In something like Java, it becomes a little bit more difficult. You could look at a method, let’s say it’s a static method and it does not access any mutable state or anything. It just takes some values as arguments and return to value as a return value. That is a calculation but it’s not first-class.</p>\n<p>You get all the benefits of it being a calculation, meaning it’s easy to test. It’s easy to think about what it’s going to do. You don’t have to worry about when it’s going to be called or what order it’s going to be called in. It has all those benefits. What it doesn’t have is the ability to pass it as an argument.</p>\n<p>Maybe with the new Java 8 stuff they’ve changed this but when I was learning Java, you could not pass a method into a function as an argument or a method into another method.</p>\n<p>The only thing you can pass in besides the primitive types like int and stuff, you can pass in an object. You need to represent your function as an object. I think with the lambda syntax in Java 8, you can start doing that. You can represent a single method call as a lambda.</p>\n<p>This episode is not about how to do it in Java. That might be a different episode or you might just have to do that on your own and figure out how to do that. To get to level two you need a representation that is first-class.</p>\n<p>One thing I like to say about calculations that I think might be clearer now is that they are timeless. Actions are bound up in time just by definition. When you look at any action, you can say one or two things. It either depends on when it is run. Meaning, compared to other things that are running, there is going to be some order where it has a different output.</p>\n<p>Example, if my JavaScript function reads the value of a global variable to make a decision in the function — it returns something different depending on what’s in that global variable — there’s going to be some way that I’m writing to that global variable in some other place that now I need to know about that to know what my function is going to do.</p>\n<p>Now, is that good or bad? I’m not judging. I’m just saying we put those in a different bucket because they require different kind of attention. Those are actions. If it doesn’t read any global variables, if it doesn’t read from the network, do anything like that, all it does is it compute something from the arguments to the return value, then I can say that it’s timeless.</p>\n<p>It doesn’t matter when it’s run. I could run it on a different machine. I could run it right now. I could’ve run it two weeks ago, and cache the value, and just kept the value. It’s timeless. I can free myself from worrying about any issues of time. Can I run it 100 times? Yes, no problem.</p>\n<p>I can’t say that about sending an email. A function that will send an email, I can’t say that it’s timeless. If I send the email today, it’s different from sending it tomorrow. If I run this function five times, it’s different from running it one time or running it zero times.</p>\n<p>Calculations are these things that because of these constraints we put on them, it doesn’t matter when you run them or how many times you run them. Then we can free our mind and just say, “These are an easier bucket. This bucket is easier to deal with. We can actually pay a lot less attention to them. They’re easier to test too.”</p>\n<p>You can just treat them in a different way. It’s like having the difference between a wild animal and a tamed animal. The tamed animal will just sit there and listen to you. If you say, “Hey, shoo, shoo,” it’ll just go. Whereas a wild animal, if you say, “Shoo,” you don’t know, it might jump out at you. They’re in different buckets. Cool.</p>\n<p>I’ve kind of belabor this point. That’s what I mean by timeless calculations. They’re timeless because they’re not bound up in time. Whenever you run them is fine. You don’t even have to think about it. This is what functional programmers do, is they put more and more of their code into calculations.</p>\n<p>They still have some actions. You need action. You need to send that email, but the more we can put into calculations, the more relaxed we can be because this stuff is much easier to work with. It’s an easier medium, these things that don’t matter when you run them.</p>\n<p>One of the hardest things about software is getting things to run in the right order. If you have a whole bucket of things that it doesn’t matter what order they run in, it makes everything easier. It means you can cache them.</p>\n<p>Also, another word for that is memoize. There’s a whole episode on that. It means you can even figure it out at compile time. You can do lazy evaluation. Maybe you don’t ever use it. Maybe you never need that value. You could just not calculate it until you really need it.</p>\n<p>There’s all sorts of great stuff you can do once you are free out of time. You’re freeing yourself from being bound in time.</p>\n<p>OK, let’s recap. Calculations are computations from inputs to output. They don’t do anything else. The rule of thumb is, it’s a calculation if it doesn’t depend on when it is run or how many times it is run.</p>\n<p>We’ll also call these, very often, pure functions, but they’re not always functions in your language. Some operations in your language are operators and not functions. It’s possible, or they’re a static method.</p>\n<p>What we need to learn to do in our language — and every language is going to do it differently — is to convert these things into first-class objects, first-class values. That’s so that we can do level two stuff, which is like Map, Filter, and Reduce that kind of thing.</p>\n<p>I like to say that they’re timeless. They represent like mathematical relationships, addition. It’s timeless. It’s never going to change. It’s been that way since who knows how long. The beginning of the universe, I want to say, but I wasn’t there.</p>\n<p>No one knows if the laws have changed, but as long as people have been around, two apples plus two apples is equal to four apples. It’s just always going to be the same. Cool.</p>\n<p>This has been my thought on functional programming. I’m Eric Normand. If you want to find the other episodes, the past episodes, you can find everything at lispcast.com/podcast. There, you’ll find audio, video, and text transcripts of all of the episodes. You’ll also find links to subscribe, whether you want to subscribe on YouTube, or the podcast, or via RSS if you like the whole blog thing.</p>\n<p>Also, you’ll find links to find me on social media. Please get in touch with me. I’m looking for the others. All right. Thank you very much. This has been my thought on functional programming. Rock on.</p>\n<p>The post <a rel=\"nofollow\" href=\"https://lispcast.com/what-is-a-calculation/\">What is a calculation?</a> appeared first on <a rel=\"nofollow\" href=\"https://lispcast.com\">LispCast</a>.</p>",
   :direction "ltr"},
  :updated 1564981200000,
  :entities
  [{:mentions [{:text "function"} {:text "mathematical function"}],
    :id "nlp/f/entity/wd:11348",
    :salienceLevel "mention",
    :label "function"}
   {:mentions [{:text "plus"} {:text "addition"}],
    :id "nlp/f/entity/wd:32043",
    :salienceLevel "mention",
    :label "addition"}
   {:mentions
    [{:text "functional programming"} {:text "functional language"}],
    :id "nlp/f/entity/wd:193076",
    :salienceLevel "mention",
    :label "functional programming"}
   {:mentions [{:text "JavaScript"}],
    :id "nlp/f/entity/wd:2005",
    :salienceLevel "mention",
    :label "JavaScript"}
   {:mentions [{:text "Java"}],
    :id "nlp/f/entity/wd:251",
    :salienceLevel "mention",
    :label "Java"}],
  :alternate
  [{:href "https://lispcast.com/what-is-a-calculation/",
    :type "text/html"}],
  :title "What is a calculation?",
  :author "Eric Normand",
  :published-str "Sun Aug 04 22:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16c6054726a:2000265:4b2e0c8b",
  :visual {:url "none"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://lispcast.com/?p=1963",
  :commonTopics
  [{:score 43.25083471103759,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.97,
    :id "nlp/f/topic/1975",
    :salienceLevel "about",
    :label "running"}
   {:score 0.854,
    :id "nlp/f/topic/1871",
    :salienceLevel "about",
    :label "quant"}
   {:score 0.779,
    :id "nlp/f/topic/2461",
    :salienceLevel "mention",
    :label "web design"}],
  :published 1564981200000,
  :fingerprint "820ecb6a",
  :canonicalUrl "https://lispcast.com/what-is-a-calculation/"}
 {:engagement 12,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/todo",
    :label "todo"}
   {:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1564978628079,
  :content
  {:content
   "<p>\nI have been thinking about writing up my experience of using Emacs and\nits positive influence on me as a Software Craftsman over the last 10\nyears or so. Over the weekend, I came across a a blog post by the CTO\nof a company, who put it very well that have really resonated with\nme. It is a great read, not too long not too short, that I strongly\nrecommend you go ahead read and come back here to continue with the\nrest of what I had to say. Here is the link: <a href=\"https://www.fugue.co/blog/2018-08-09-two-years-with-emacs-as-a-cto.html\">Two Years With Emacs as a\nCEO (and now CTO)</a>. </p>\n<p>\nSo I am not going to repeat what he said about Emacs and why he still\nloves to use it to get things done. I am going to add following points\non top of what he wrote there:\n</p>\n<div>\n<h2>Emacs is a great workbench</h2>\n<div>\n<p>\nI see Emacs as an extremely well designed workbench that will evolve\nwith you as your work environment, technology and paradigms\nchange. Emacs is a live programming environment where you can change\nevery aspects of its functionalities, be it a simple text editing to a\ncomplex work flow where you can interact with many external\nsystems. One of a startup that I worked had a mode where we have\ninteracted with our live system written in Clojure via its CLI\ninterface using `comint-mode`, which you should really checkout if you\nare not familiar with it. You can use Emacs as the client with uniform\ninterface to many of the CLI, API and even for <a href=\"https://en.wikipedia.org/wiki/Application_binary_interface\">ABI</a>. For example `EXWM`,\nwhich is an Window Manager, is a great example.\n</p>\n</div>\n</div>\n<div>\n<h2>Emacs is a great structured and unstructured text manipulation library</h2>\n<div>\n<p>\nThis is what I personally like a lot about Emacs. As a programmer, we\nwork with manipulating text all the time. Yes, there are great text\nEditors out there, which by the way I have used all of them myself\nbefore seeing the light of using Emacs. But I see all other\neditors/IDEs as a framework for the things they set out to do rather\nthan a library that I can compose to solve a particular problem at\nhand. For example, I can use `smartparens` package for structured text\nediting of Clojure code.\n</p>\n</div>\n</div>\n<div>\n<h2>Emacs helps you focus</h2>\n<div>\n<p>\nIn this day of our age where everything tries to grab your constant\nattention, Emacs stands out as the most distraction free environment\nto be in. One might argue that Emacs user spends way more time\nconfiguration management, which is definitely true when you are just\ngetting started with any new toolbox, I found I spend very little time\nwith configuration or keeping it up to date. Once you are familiar with\nEmacs help system and built in Documentation, You can be pretty much\non your own when it comes to how much you spend on customization. It\nis this freedom you get from using Emacs where you are in charge as to\nhow much customization you would like. The reason I say Emacs helps\nyou focus is due to the fact that you have the freedom to make it an\ndistraction free writing/coding/communication environment to get done\nwhat matters the most to you and have a lot of fun along the way.\n</p>\n</div>\n</div>\n<div>\n<h2>Emacs has a learning curve</h2>\n<div>\n<p>\nYes, I do acknowledge that Emacs has a learning curve. However, most\nof it is due to the wrong approach we tend to take when encountering an\nunknown. On hindsight, I wish I had following approach, which I do now\nall the time:\n</p>\n<ol>\n<li>Start with getting familiar with Emacs terminology such as windows,\nbuffers and frames etc. The builtin documentation is great for that\nand it is just C-h i (Hit Control and letter `h` at the same time,\nthen hit `i`, which stands for info). To read Emacs’ manual just\nenter `m` and select `Emacs` from minibuffer. Hmm, you might be\nwondering what is minibuffer, let us use this approach to find\nout. Press following C-h i m key sequence and type `Minibuffer` and\nhit enter. Voila, you are reading all about `Minibuffer` from the\nofficial Emacs manual. No other application that I have used comes\nclose to the level of Emacs in terms of self documentation.</li>\n<li>Start with the goal of getting something done. I have two example\nthat every programmer will benefit from learning: `Magit` and\n`Org-mode`. While you need to install `magit-mode`, which is a\nEmacs interface to git CLI, `org-mode` is built in. You will be\nsurprised to find that it makes your git journey so much fun or\nyour note organization so much enjoyable. I made the mistake of\ntrying to memorize hot keys as much as I can before learning the\nhard truth of learning one key at a time as needed bases. I\nstrongly recommend the only hot key you need at the beginning is\n`M-x`, where you just type a command so Emacs can execute for\nyou. For Example, if you would like open (it is `visit` in Emacs\nspeak) a file, just type `M-x` and type `file` then press tab key,\nselect `find-file` in the completion buffer, now you can choose a\nfile name from within the directory that you are in. It is just an\nexample but knowing the fact that every action you perform in Emacs\ninvokes an command, which is just an elisp function, is a very\npowerful realization. That means you can write an elisp function to\nhave Emacs do whatever you like. You can also lookup what a command\ndoes using C-h f, then typing the name of the command. For example,\nC-h f then, type `org-insert-link` then enter and read on…</li>\n<li>I advise against starting with Emacs using other’s configuration\nincluding Emacs that comes with pre-configuration. As I have\nmentioned earlier, Emacs is a great library where you can pick and\nchoose to fit your work style. You will loose this great aspects if\nyou start with other’s way of configuring/composing it. If you had\nto just start with a minimal config, put this in your `init.el`\nfile and start changing/adding/organizing configs as you see\nfit. For example:</li>\n</ol>\n<div>\n<pre><span>;; </span><span>Emacs reads init.el file located in ~/.emacs.d at startup</span>\n<span>;; </span><span>bootstrap el-get</span>\n<span>(</span>add-to-list 'load-path <span>&quot;~/.emacs.d/el-get/el-get&quot;</span><span>)</span>\n<span>(</span><span>unless</span> <span>(</span><span>require</span> '<span>el-get</span> nil 'noerror<span>)</span>\n  <span>(</span><span>with-current-buffer</span>\n      <span>(</span>url-retrieve-synchronously\n       <span>&quot;https://raw.githubusercontent.com/dimitri/el-get/master/el-get-install.el&quot;</span><span>)</span>\n    <span>(</span>goto-char <span>(</span>point-max<span>))</span>\n    <span>(</span>eval-print-last-sexp<span>)))</span>\n\n<span>;; </span><span>Initialize available packages first</span>\n<span>(</span>package-refresh-contents t<span>)</span>\n\n<span>;; </span><span>The only package you need to get started</span>\n<span>(</span><span>el-get-bundle</span> smex\n  <span>(</span><span>progn</span>\n    <span>(</span><span>require</span> '<span>smex</span><span>)</span>\n    <span>(</span>global-set-key <span>(</span>kbd <span>&quot;M-x&quot;</span><span>)</span> 'smex<span>)))</span>\n</pre>\n</div>\n<p>\nAbove snippets sets you up to use `El-get`, a great package manager\nthat I came to rely over the years and have never failed me. It also\npulls in the only package you had to have before getting started,\n`smex` that makes the only command `M-x` you need much more\nintuitive. Then say if you want to try `magit`, just type M-x\nel-get-install, then `magit`. El-get will download it and install it\nso you can starting using it in your git projects. Once you can find\nyour way around Emacs, you can start your journey of how best\norganize your config/customization as you go along. I use just one\norg file for it and you might or might not like it. Here is the file\nin its entirety if you are interested: <a href=\"https://www.birkey.co/static/config.html\">My config snapshot</a>\n</p>\n</div>\n</div>\n<div><a href=\"https://www.birkey.co/tags.html\">Tags</a>: <a href=\"https://www.birkey.co/tag-emacs.html\">emacs</a> </div>",
   :direction "ltr"},
  :updated 1564947780000,
  :entities
  [{:mentions [{:text "Emacs"}],
    :id "nlp/f/entity/wd:189722",
    :salienceLevel "about",
    :label "Emacs"}
   {:mentions [{:text "CLI"}],
    :id "nlp/f/entity/wd:189053",
    :salienceLevel "mention",
    :label "command-line interface"}
   {:mentions [{:text "org"} {:text "organization"}],
    :id "nlp/f/entity/wd:43229",
    :salienceLevel "mention",
    :label "organization"}
   {:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "learning curve"}],
    :id "nlp/f/entity/wd:1368723",
    :salienceLevel "mention",
    :label "learning curve"}],
  :alternate
  [{:href "https://www.birkey.co/2019-08-04-why-emacs.html",
    :type "text/html"}],
  :title "Why Emacs",
  :author "Birkey Consulting",
  :published-str "Sun Aug 04 12:43:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16c5ffec5ef:1ffe2c9:73d34570",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://www.birkey.co/2019-08-04-why-emacs.html",
  :commonTopics
  [{:score 52.923886398285006,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.773,
    :id "nlp/f/topic/737",
    :salienceLevel "mention",
    :label "editing"}],
  :published 1564947780000,
  :fingerprint "837f2404",
  :canonicalUrl "https://www.birkey.co/2019-08-04-why-emacs.html"}
 {:unread false,
  :crawled 1564954938138,
  :recrawled 1564992830013,
  :content
  {:content
   "<div>\n<figure>\n<img src=\"https://manuel-uberti.github.io/images/hoc.png\">\n</figure>\n</div>\n<p>I have still to properly unpack my luggage and yet here I am, eager to make\nsense of the enthusiasm of experiencing <a href=\"https://heartofclojure.eu/\">Heart of\nClojure</a>. I tried my best to pin down on my diary\neverything that the conference had to offer, because at first I wanted to write\na round-up similar to the one I did for <a href=\"https://manuel-uberti.github.io/programming/2018/04/23/dcd-round-up/\">Dutch Clojure Days\n2018</a>.\nHowever, summarising Heart of Clojure seems like an unimaginative exercise. And\nthis is because a summary is by definition a cursory look. Considering what I’ve\nhad the pleasure to enjoy, it doesn’t feel right.</p>\n<p>So, what was Heart of Clojure like exactly? After one day and a half in and\nplenty more to do, I came up with a definition: the people’s conference.\nFragments of this definition were already floating around my head as soon as\nI was in front of Hal5, the incredibly cosy space the Heart of Clojure team set\nup as the main location for the event. It’s not easy to put it clearly into\nwords, but just take a look at the registration process. You reached a desk,\nthey gave you a badge, you picked the holder of the right colour for you (i.e.,\ngreen meant you were fine appearing in pictures taken during the conference,\npink you were not), you were given pens and markers to write your name on the\nbadge and add whatever customisations you feel like adding to it. Now, go back\nand count how many <em>you</em> and <em>they</em> there are in the last sentence, and you’ll\nstart getting an idea about the general approach of Heart of Clojure.</p>\n<p>The more I think about it, the more I find the effort to make everything safe\nand nice for the attendees remarkable, especially because it looked like nobody\nwas actually controlling anything. I wasn’t expecting surveillance cameras and\nSWAT teams, of course, but the simple fact that the responsibility of looking\nafter everyone appeared invisible made for a peaceful environment. And you\nalways had kind and smiling Heart of Clojure’s staff members around ready to\nhelp you out or have a chat with you. The results were in plain sight. Everybody\nlooked calm, serene, and even without asking you could tell they were having a\ngreat time just being there.</p>\n<p>Unsurprisingly, the wide range of topics in the program left me with an\nimpossible amount of thoughts. Teaching programmers to draw, Clojure in fashion,\nempathy and resilience, inclusiveness and climate change, open source\nsustainability and fragment shaders, compilers and arcade games. In a two-day\nspan, the selection of talks leveraged topics of such a pervasive power that it\nwas basically impossible not to constantly connect and be moved. With the\nentertaining work of the hosts and unforgettable MCs <a href=\"http://www.saskialindner.com/\">Saskia\nLinder</a> and <a href=\"https://github.com/bbatsov\">Bozhidar\nBatsov</a> there was no such thing as boredom in the\nair.</p>\n<p>At the same time, though, I have to admit I was a bit sceptical about the extra\nactivities. Again, the Heart of Clojure’s masterminds put the people in charge,\nand so anyone could devise an activity covering the spare time in the evenings,\nduring the long afternoon break on Saturday, or on Sunday morning. Before\nleaving for Leuven, my overtly paranoid brain asked me: how could they trust\neverybody like this? What if a too fervid attendee can’t manage it well?\nWouldn’t it spoil the fun for the rest of us? It turned out there was too much\njoyfulness around to be paranoid, a well-deserved lesson for that silly brain of\nmine. I will never be able to thank the awesome <a href=\"https://malweene.com\">Malwine</a>\nenough for the sketchnote workshop, and I’ll have to find a way to be at another\nof her workshops sooner or later.</p>\n<p>Probably co-opted by the aforementioned brain, my mind wandered in similar\ndoubts when it came to the lightning talks, but in five minutes\n<a href=\"https://twitter.com/waffles193\">Connie</a> silenced both my brain and my mind.\nI think I’ve held my breath and stood still throughout her entire session,\nstruck in my seat by the genius of an eleven-year old’s crafts. More than\nanything else, she was the heart at the Heart of Clojure.</p>\n<p>I have to stop now, because it’s time to rest and see if I can soothe the\nintense emotions of the past three days. Did I mention the couple of tears on\nthe <a href=\"https://www.youtube.com/watch?v=v0_FFJArOG0\">“My Heart Will Go On”</a>\nkaraoke? You cannot play with a sentimental fool like this, people, there are\nfeelings at stake. Come on.</p>\n<p>But before turning off the lights:</p>\n<p>Thank you <a href=\"https://github.com/plexus\">Arne</a> and thank you\n<a href=\"https://github.com/martinklepsch\">Martin</a>: you conceived the impossible and\nmade it happen. Please make it happen again.</p>\n<p>Thank you Heart of Clojure’s program committee and reviewers: Arne and Martin\ncouldn’t have made it without you.</p>\n<p>Thank you <a href=\"https://heartofclojure.eu/speakers\">speakers</a>: singling out one of\nyou would be unfair and completely pointless. You all inspired me, in one way or\nthe other.</p>\n<p>Thank you Saskia: you taught me the beauty of reaching out, and I will treasure\nthe words on emotion management for a long while.</p>\n<p>Thank you Bozhidar: no, not for just CIDER this time. For everything, including\nthe unparalleled dancing skills.</p>\n<p>Thank you <a href=\"https://github.com/skuro\">Carlo</a>,\n<a href=\"https://github.com/Heliosmaster\">Davide</a>, <a href=\"https://github.com/f-f\">Fabrizio</a>,\nand <a href=\"https://github.com/pirp\">Kleopatra</a>: I’m still not sure of how you did it,\nbut you made me forget sociability is an issue for me. For a while, at least.</p>\n<p>Thank you <a href=\"https://github.com/mdallastella\">Marco</a> and thank you\n<a href=\"https://7bridges.eu/\">7bridges</a>: I just couldn’t have managed it by myself.</p>\n<p>Thank you James Cameron: yes, I still cry with that film, why are you doing this\nto me?</p>",
   :direction "ltr"},
  :updated 1564876800000,
  :entities
  [{:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "about",
    :label "Clojure"}
   {:mentions [{:text "Bozhidar"}],
    :id "nlp/f/entity/wd:4090172",
    :salienceLevel "mention",
    :label "Bozhidar"}
   {:mentions [{:text "Saskia"}],
    :id "nlp/f/entity/wd:154544",
    :salienceLevel "mention",
    :label "461 Saskia"}
   {:mentions [{:text "Leuven"}],
    :id "nlp/f/entity/wd:118958",
    :salienceLevel "mention",
    :label "Leuven"}],
  :alternate
  [{:href
    "http://manuel-uberti.github.io//clojure/2019/08/04/clojure-heart/",
    :type "text/html"}],
  :title "The people’s conference",
  :author "Manuel Uberti",
  :published-str "Sat Aug 03 17:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16c5e954b1a:1eb266e:73d34570",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url "https://manuel-uberti.github.io/images/hoc.png",
   :width 450,
   :height 530,
   :contentType "image/png"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "http://manuel-uberti.github.io//clojure/2019/08/04/clojure-heart/",
  :updateCount 2,
  :commonTopics
  [{:score 0.7419520122140189,
    :id "nlp/f/topic/1309",
    :salienceLevel "about",
    :label "leadership"}
   {:score 27.394674174869714,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.989,
    :id "nlp/f/topic/1585",
    :salienceLevel "about",
    :label "nlp"}
   {:score 0.875,
    :id "nlp/f/topic/2146",
    :salienceLevel "about",
    :label "special needs"}
   {:score 0.862,
    :id "nlp/f/topic/2276",
    :salienceLevel "about",
    :label "textiles"}
   {:score 0.718,
    :id "nlp/f/topic/1828",
    :salienceLevel "mention",
    :label "productivity"}],
  :published 1564876800000,
  :fingerprint "8d5b26c7"}
 {:engagement 15,
  :unread false,
  :crawled 1564949283471,
  :content
  {:content
   "<div><h1>Senior UX Engineer</h1><div>Stylitics | Anywhere // NYC HQ // North America timezones workday overlap</div><div>remote</div><div>$100000 - $135000</div><div><a href=\"https://stylitics.com/\">https://stylitics.com/</a></div><br><div><h2>About Us</h2><p>Stylitics is the leading visual outfitting and styling solution for the top retailers and brands in the world. Founded in 2011, Stylitics uses a powerful combination of algorithms, trend data, and stylist expertise to deliver thousands of on-brand outfit recommendations to millions of customers across multiple channels, such as e-commerce, email, in-store experiences, and social media. Our products -- built with Clojure, ClojureScript, and some JS -- keep customers engaged, increase sales, and boost marketing campaign performance. We are looking for a talented front-end developer to join our team and lead the development of new consumer-facing experiences and applications for our clients and to contribute to the ongoing expansion and improvement of our internal outfitting platform.</p><h2>Responsibilities</h2>\n<ul>\n<li>Design, prototype, build, collaborate on, and maintain front-end applications including 3rd party web applications which integrate simply and seamlessly with our clients' web pages, across modern browsers and various device sizes.</li>\n<li>Optimize performance of front-end experiences</li>\n<li>Collaborate effectively with back-end developers, product team, and designers to analyze user needs in conjunction with company strategy, current systems and resources, in order to scope and build solutions for maximum return on effort</li>\n<li>Contribute to functional requirement documents and guides</li>\n<li>Create quality mockups and prototypes</li>\n<li>Ensure high-quality visual standards and brand consistency</li>\n</ul><h2>Must Haves</h2>\n<ul>\n<li>Quality portfolio and work experience as a front-end developer</li>\n<li>Excellent communication skills</li>\n<li>ClojureScript knowledge and experience, or strong interest combined with other functional programming experience</li>\n<li>Modern JavaScript experience and proficiency, including tooling (e.g. npm, webpack, gulp)</li>\n<li>Proficiency with modern CSS (or compile-to-CSS alternatives)</li>\n<li>Ability to work quickly, exercise judgment, and lead discussion about the right level of polish &amp; functional orientation (flexible, configurable vs. rigid, single clear purpose) for the task at hand</li>\n<li>An up-to-date knowledge of best practices (or your own proven and defensible practices) for keeping styles maintainable over the long term</li>\n<li>Proficiency in measuring and optimizing front-end performance</li>\n<li>React.js experience</li>\n<li>Some familiarity with design software and tools, for creating mockups</li>\n<li>A product mindset</li>\n</ul><h2>Great to Haves</h2>\n<ul>\n<li>Advanced skill with ClojureScript and/or Clojure</li>\n<li>Backend experience, particularly with Clojure, Ansible, Linux server environments, cloud platforms, and databases</li>\n<li>Experience working in, or with, the retail industry</li>\n<li>Experience working on, or integrating with, large retail e-commerce sites</li>\n<li>Experience working on, or integrating with, adtech</li>\n<li>React Native or any native mobile app development experience</li>\n<li>TypeScript experience</li>\n<li>Proficiency with design software and tools</li>\n<li>Expertise in web performance optimization</li>\n<li>Proven ability to create clear &amp; useful data visualizations</li>\n</ul><h2>Benefits</h2>\n<ul>\n<li>Work-From-Home Fridays (or fully remote)</li>\n<li>Flexible paid time off policy</li>\n<li>Health, dental, and vision insurance</li>\n<li>Commuter benefits</li>\n<li>401K</li>\n<li>Gym membership discounts</li>\n</ul></div></div>",
   :direction "ltr"},
  :updated 1564947497000,
  :entities
  [{:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "CSS"}],
    :id "nlp/f/entity/wd:46441",
    :salienceLevel "mention",
    :label "Cascading Style Sheets"}
   {:mentions [{:text "functional requirement"}],
    :id "nlp/f/entity/wd:3264234",
    :salienceLevel "mention",
    :label "functional requirement"}
   {:mentions [{:text "mobile app"}],
    :id "nlp/f/entity/wd:620615",
    :salienceLevel "mention",
    :label "mobile app"}
   {:mentions [{:text "functional programming"}],
    :id "nlp/f/entity/wd:193076",
    :salienceLevel "mention",
    :label "functional programming"}],
  :alternate
  [{:href
    "https://jobs.braveclojure.com/jobs/17592186047037/senior-ux-engineer-stylitics",
    :type "text/html"}],
  :title "Senior UX Engineer",
  :author "Brave Clojure Jobs",
  :published-str "Sun Aug 04 12:38:17 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16c5e3f028f:1e02682:4b2e0c8b",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://jobs.braveclojure.com/jobs/17592186047037/senior-ux-engineer-stylitics",
  :commonTopics
  [{:score 85.17451820790262,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.996,
    :id "nlp/f/topic/2390",
    :salienceLevel "about",
    :label "ux"}
   {:score 0.986,
    :id "nlp/f/topic/590",
    :salienceLevel "about",
    :label "css"}
   {:score 0.973,
    :id "nlp/f/topic/2367",
    :salienceLevel "about",
    :label "ui"}
   {:score 0.972,
    :id "nlp/f/topic/2461",
    :salienceLevel "about",
    :label "web design"}],
  :published 1564947497000,
  :fingerprint "59b8622a",
  :canonicalUrl
  "https://jobs.braveclojure.com/jobs/17592186047037/senior-ux-engineer-stylitics"}
 {:engagement 10,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/todo",
    :label "todo"}
   {:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1564922372560,
  :content
  {:content
   "<img src=\"http://jr0cket.co.uk/images/clojure-logo.png\">\n<p>Continuing our exploration with Clojure CLI tools, we will discuss what what templates are available to help us create project, Then we will create a new ClojureScript project using figwheel-main and show the different builds we can use to provide several workflows for developing, testing and deploying an application.</p>\n<p>We will create a new project using the <a rel=\"external\" href=\"https://github.com/bhauman/figwheel-main-template\" target=\"_blank\">figwheel-main template</a>, explaining that we need to specify <code>organisation/project-name</code> or <code>organisation.project-name</code> for the <code>clj-new</code> templates to work properly.</p>\n<p>Then run the project using the <code>-A:fig:build</code> alias to run with rebel readline to our user account version of <code>deps.edn</code> so it is available for all projects. Then we will run a test runner and see the auto-testing monitoring. Finally we will show ways to configure a deploy workflow that we can use with GitHub</p>\n<p>This article is also covered in <a rel=\"external\" href=\"https://youtu.be/uuxEYsX-1eg\" target=\"_blank\">Practicalli Clojure study group #38 video</a></p>\n<p>Please see earlier articles in this series for background:</p>\n<ul>\n<li><a href=\"http://jr0cket.co.uk/2019/07/gaining-confidence-with-Clojure-CLI-tools.html\">Experimenting With Clojure CLI Tools Options</a></li>\n<li><a href=\"http://jr0cket.co.uk/2019/07/a-deeper-understanding-of-Clojure-CLI-tools.html\">A Deeper Understanding of Clojure CLI Tools</a></li>\n<li><a href=\"http://jr0cket.co.uk/2019/07/getting-started-with-Clojure-CLI-tools.html\">Getting Started With Clojure CLI Tools</a></li>\n</ul>\n<a></a>\n<h2><a href=\"http://jr0cket.co.uk/categories/clojure/atom.xml#Creating-projects-from-templates\" title=\"Creating projects from templates\"></a>Creating projects from templates</h2><p>In previous articles we have seen that we can use <code>clj-new</code> to create projects using a number of templates. This tool works with most Leiningen and Boot projects, however, it does not provide a <code>deps.edn</code> configuration file if the template itself does not. It should be easy enough to create your own from the project configuration file that is created by a Leiningen or Boot template (depending on how complex the template is).</p>\n<h2><a href=\"http://jr0cket.co.uk/categories/clojure/atom.xml#Create-a-new-project-using-the-figwheel-main-template\" title=\"Create a new project using the figwheel-main template\"></a>Create a new project using the figwheel-main template</h2><p>Using the <a rel=\"external\" href=\"https://github.com/bhauman/figwheel-main-template\" target=\"_blank\">figwheel-main template</a> we can create a new figwheel-main project with the comand:</p>\n<figure><table><tbody><tr><td><pre><div>1</div></pre></td><td><pre><div>clojure -A:new figwheel-main hello-world.core -- --reagent</div></pre></td></tr></tbody></table></figure>\n<p>This creates a basic project with several aliases defined in the <code>deps.edn</code> file for the project</p>\n<figure><table><tbody><tr><td><pre><div>1</div><div>2</div><div>3</div><div>4</div><div>5</div><div>6</div><div>7</div><div>8</div><div>9</div><div>10</div><div>11</div></pre></td><td><pre><div>{<span>:deps</span> {org.clojure/clojure {<span>:mvn/version</span> <span>&quot;1.10.0&quot;</span>}</div><div> org.clojure/clojurescript {<span>:mvn/version</span> <span>&quot;1.10.339&quot;</span>}</div><div> reagent {<span>:mvn/version</span> <span>&quot;0.8.1&quot;</span>}}</div><div> <span>:paths</span> [<span>&quot;src&quot;</span> <span>&quot;resources&quot;</span>]</div><div> <span>:aliases</span> {<span>:fig</span> {<span>:extra-deps</span></div><div> {com.bhauman/rebel-readline-cljs {<span>:mvn/version</span> <span>&quot;0.1.4&quot;</span>}</div><div> com.bhauman/figwheel-main {<span>:mvn/version</span> <span>&quot;0.1.9&quot;</span>}}</div><div> <span>:extra-paths</span> [<span>&quot;target&quot;</span> <span>&quot;test&quot;</span>]}</div><div> <span>:build</span> {<span>:main-opts</span> [<span>&quot;-m&quot;</span> <span>&quot;figwheel.main&quot;</span> <span>&quot;-b&quot;</span> <span>&quot;dev&quot;</span> <span>&quot;-r&quot;</span>]}</div><div> <span>:min</span> {<span>:main-opts</span> [<span>&quot;-m&quot;</span> <span>&quot;figwheel.main&quot;</span> <span>&quot;-O&quot;</span> <span>&quot;advanced&quot;</span> <span>&quot;-bo&quot;</span> <span>&quot;dev&quot;</span>]}</div><div> <span>:test</span> {<span>:main-opts</span> [<span>&quot;-m&quot;</span> <span>&quot;figwheel.main&quot;</span> <span>&quot;-co&quot;</span> <span>&quot;test.cljs.edn&quot;</span> <span>&quot;-m&quot;</span> practicalli.test-runner]}}}</div></pre></td></tr></tbody></table></figure>\n<ul>\n<li><code>:fig</code> adds the figwheel-main and rebel-readline libraries as dependencies</li>\n<li><code>:build</code> runs figwheel-main and creates a build of the project code and tests</li>\n<li><code>:min</code> creates a minified single JavaScript file for deployment</li>\n<li><code>:test</code> runs all the tests once using the test-runner</li>\n</ul>\n<p>We will explore these builds and the workflow they provide as we go through this article.</p>\n<h2><a href=\"http://jr0cket.co.uk/categories/clojure/atom.xml#Running-figwheel\" title=\"Running figwheel\"></a>Running figwheel</h2><p>We can run figwheel by specifying <code>figwheel-main</code> as the main namespace. Figwheel will run a browser and connect to its JavaScript REPL, sending any code we type there to be evaluated..</p>\n<figure><table><tbody><tr><td><pre><div>1</div></pre></td><td><pre><div>clojure -A:fig -m figwheel.main</div></pre></td></tr></tbody></table></figure>\n<p>The browser will show the default figwheel website that contains basic instructions on how to work with figwheel.</p>\n<p><img alt=\"figwheel-main - REPL host page\" src=\"http://jr0cket.co.uk/images/figwheel-main--REPL-host-page.png\"></p>\n<p><code>com.bhauman/rebel-readline-cljs</code> is defined as a dependency in the <code>:fig</code> alias in the project <code>deps.edn</code>. This allows figwheel to detect the presence of rebel readline and use it when starting the ClojureScript REPL, to give a very interactive command line. If rebel readline is dectected you will see the following line a few lines before the cljs.user=> prompt.</p>\n<figure><table><tbody><tr><td><pre><div>1</div><div>2</div></pre></td><td><pre><div>[Rebel readline] Type :repl/help for online help info</div><div>This confirms that we are using Rebel Readline.</div></pre></td></tr></tbody></table></figure>\n<p><img alt=\"Clojure CLI tools - Figwheel-main - rebel readline\" src=\"http://jr0cket.co.uk/images/clojure-cli-tools--figwheel-main-rebel-readline--map.png\"></p>\n<p>If you type :repl/help command at the prompt, as you type you immediately notice that :repl/help character are syntax highlighted. Upon hitting enter, you will see a useful reference for the REPL’s capabilities displayed.</p>\n<p><img alt=\"Figwheel-main - repl help\" src=\"http://jr0cket.co.uk/images/figwheel-main--repl-help.png\"></p>\n<blockquote>\n<p>Use the <code>clojure</code> command when using rebel-readline, The <code>clj</code> command provides it’s own terminal line reader</p>\n</blockquote>\n<p>We can call expressions in the REPL prompt, for example some typical ClojureScript such as <code>(map inc [2 4 6 8])</code></p>\n<p>Or we can evaluate some JavaScript interop code and see things change in the browser <code>(js/alert &quot;Notification from the command line&quot;)</code></p>\n<h2><a href=\"http://jr0cket.co.uk/categories/clojure/atom.xml#Running-figwheel-and-building-the-project\" title=\"Running figwheel and building the project\"></a>Running figwheel and building the project</h2><p>So far we have only run figwheel, however, our template did create some simple code that we can run that displays a website.</p>\n<p>The template also added more aliases that defined different ways to build a project.</p>\n<p>When developing we would typically run the <code>:build</code> alias along with <code>:fig</code></p>\n<p><code>clojure -A:fig:build</code></p>\n<p><img alt=\"Figwheel-main - project - hello world\" src=\"http://jr0cket.co.uk/images/figwheel-main--project-hello-world.png\"></p>\n<blockquote>\n<p>when we look in the project <code>deps.edn</code> file we can see the details of the command that the <code>build</code> alias uses<br><code>:build {:main-opts [&quot;-m&quot; &quot;figwheel.main&quot; &quot;-b&quot; &quot;dev&quot; &quot;-r&quot;]}</code></p>\n<p> This configuration is the equivalent of running the command<br><code>clojure -A:fig -m figwheel.main -b dev -r</code></p>\n<p>This command uses the <code>:fig</code> alias to add figwheel-main and rebel readline libraries, sets <code>figwheel-main</code> as the main namespace, the build as <code>dev</code> and <code>-r</code> to run a REPL.</p>\n</blockquote>\n<h2><a href=\"http://jr0cket.co.uk/categories/clojure/atom.xml#Running-tests-once\" title=\"Running tests once\"></a>Running tests once</h2><p>The source code for tests are placed under the top level <code>test</code> directory and uses a directory path that matches their namespace, matching those in <code>src</code>. Source code files test a matching namespace and have <code>-test</code> added to the end of their name. For example, if we have a source namespace of <code>practicalli.hello-world</code>, the tests would be in <code>practicalli.hello-world-test</code>.</p>\n<p>We can run tests created by the <code>figwheel-main</code> template by running <code>clojure</code> with the <code>:test</code> alias.</p>\n<blockquote>\n<p>As before, the <code>:fig</code> alias pulls in the <code>figwheel-main</code> and <code>rebel-readline</code> dependencies.</p>\n</blockquote>\n<figure><table><tbody><tr><td><pre><div>1</div></pre></td><td><pre><div>clojure -A:fig:test</div></pre></td></tr></tbody></table></figure>\n<p>This will open a browser and connect to its JavaScript REPL and run the tests. The results can be seen in the terminal window from where you ran the <code>clojure</code> command.</p>\n<p><img alt=\"Figwheel-main - test output in terminal\" src=\"http://jr0cket.co.uk/images/figwheel-main--test-output-terminal.png\"></p>\n<p>The <code>:test</code> alias sets <code>figwheel.main</code> as the main namespace so it can run the figwheel test-runner functions</p>\n<p><code>:test  {:main-opts [&quot;-m&quot; &quot;figwheel.main&quot; &quot;-co&quot; &quot;test.cljs.edn&quot; &quot;-m&quot; practicalli.test-runner]}</code></p>\n<h2><a href=\"http://jr0cket.co.uk/categories/clojure/atom.xml#Continuous-testing\" title=\"Continuous testing\"></a>Continuous testing</h2><p>Running a figwheel-main build will also include continuous testing service, so you can instantly see the results of your tests.</p>\n<figure><table><tbody><tr><td><pre><div>1</div></pre></td><td><pre><div>clojure -A:fig:build</div></pre></td></tr></tbody></table></figure>\n<p><a rel=\"external\" href=\"http://localhost:9500/figwheel-extra-main/auto-testing\" target=\"_blank\">http://localhost:9500/figwheel-extra-main/auto-testing</a> will show the live results of running the tests.</p>\n<p><img alt=\"Figwheel-main - tests - auto-testing webpage results\" src=\"http://jr0cket.co.uk/images/figwheel-main--tests-auto-testing-webpage.png\"></p>\n<p>You may see the auto-testing host page display before showing the tests</p>\n<p><img alt=\"Figwheel-main - tests - auto-testng host page\" src=\"http://jr0cket.co.uk/images/figwheel-main--tests-auto-testing-host-page.png\"></p>\n<h2><a href=\"http://jr0cket.co.uk/categories/clojure/atom.xml#Packaging-up-a-single-compiled-artifact-for-production\" title=\"Packaging up a single compiled artifact for production\"></a>Packaging up a single compiled artifact for production</h2><p>The building of ClojureScript applications generates lots of files under <code>target/public</code>, as this is the most efficient way to manage changes to your application during development. Using only a single file when deploying your application to the live system makes your application website faster to load (only one http request).</p>\n<blockquote>\n<p>The ClojureScript compiler has four :optimizations modes :none, :whitespace, :simple and :advanced.</p>\n</blockquote>\n<p>The <code>figwheel-main</code> template provides a <code>:min</code> alias to generate a single minified file that has been run through the Google Closure compiler to eliminate any uncalled code. This generates a single file called <code>target/public/cljs-out/dev-main.js</code></p>\n<p>You can manually copy this file to a suitable deployment directory when you publish your application live.</p>\n<h3><a href=\"http://jr0cket.co.uk/categories/clojure/atom.xml#Deploying-to-GitHub-pages\" title=\"Deploying to GitHub pages\"></a>Deploying to GitHub pages</h3><p><a rel=\"external\" href=\"https://pages.github.com/\" target=\"_blank\">GitHub pages</a> provides a fast and free service for running a website (html, css and JavaScript files). You can run a website by placing all the files in a <code>docs</code> directory.</p>\n<p>Rather than manually copy the <code>dev-main.js</code> file each time you want to deploy, create a new build configuration to output the single JavaScript file to a different location.</p>\n<p>Create a file called <code>github-pages.cljs.edn</code> to represent a new build and add the following configuration</p>\n<figure><table><tbody><tr><td><pre><div>1</div><div>2</div></pre></td><td><pre><div>{<span>:main</span> practicalli.hello-world</div><div> <span>:output-to</span> <span>&quot;docs/cljs-out/dev-main.js&quot;</span>}</div></pre></td></tr></tbody></table></figure>\n<p>Then edit the <code>deps.edn</code> file and change the <code>:min</code> alias to use the <code>deploy</code> build</p>\n<figure><table><tbody><tr><td><pre><div>1</div></pre></td><td><pre><div><span>:min</span> {<span>:main-opts</span> [<span>&quot;-m&quot;</span> <span>&quot;figwheel.main&quot;</span> <span>&quot;-O&quot;</span> <span>&quot;advanced&quot;</span> <span>&quot;-bo&quot;</span> <span>&quot;github-pages&quot;</span>]}</div></pre></td></tr></tbody></table></figure>\n<p>Instead of changing the <code>:min</code> alias, you could also add a new alias to deploy to GitHub pages directory.</p>\n<figure><table><tbody><tr><td><pre><div>1</div></pre></td><td><pre><div><span>:github-pages</span> {<span>:main-opts</span> [<span>&quot;-m&quot;</span> <span>&quot;figwheel.main&quot;</span> <span>&quot;-O&quot;</span> <span>&quot;advanced&quot;</span> <span>&quot;-bo&quot;</span> <span>&quot;github-pages&quot;</span>]}</div></pre></td></tr></tbody></table></figure>\n<blockquote>\n<p>See <a rel=\"external\" href=\"https://figwheel.org/tutorial#packaging-up-a-single-compiled-artifact-for-production\" target=\"_blank\">package a single file for production</a> for more details.</p>\n</blockquote>\n<h2><a href=\"http://jr0cket.co.uk/categories/clojure/atom.xml#Summary\" title=\"Summary\"></a>Summary</h2><p>It is very easy to add aliases and build configurations to customise the workflows you use for your Clojure CLI tools project. As all the configuration files are in EDN, they are Clojure maps and therefore very easy to work with and understand.</p>\n<p>There are more examples of options for figwheel-main projects on the <a rel=\"external\" href=\"https://figwheel.org/\" target=\"_blank\">https://figwheel.org/</a> website.</p>\n<p>Thank you.<br><a rel=\"external\" href=\"https://twitter.com/jr0cket\" target=\"_blank\">@jr0cket</a></p>",
   :direction "ltr"},
  :updated 1564918505000,
  :entities
  [{:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "about",
    :label "Clojure"}
   {:mentions [{:text "GitHub"}],
    :id "nlp/f/entity/wd:364",
    :salienceLevel "mention",
    :label "GitHub"}
   {:mentions [{:text "src"} {:text "source code"} {:text "source"}],
    :id "nlp/f/entity/wd:128751",
    :salienceLevel "mention",
    :label "source code"}
   {:mentions [{:text "REPL"}],
    :id "nlp/f/entity/wd:2032810",
    :salienceLevel "mention",
    :label "Read–eval–print loop"}
   {:mentions [{:text "JavaScript"}],
    :id "nlp/f/entity/wd:2005",
    :salienceLevel "mention",
    :label "JavaScript"}],
  :alternate
  [{:href
    "http://jr0cket.co.uk/2019/08/development-workflow-with-clojure-cli-tools.html",
    :type "text/html"}],
  :title "Development Workflow With Clojure CLI Tools",
  :author "John Stevenson",
  :published-str "Sun Aug 04 04:35:05 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16c5ca461d0:1cd4ceb:73d34570",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url
   "http://jr0cket.co.uk/images/figwheel-main--REPL-host-page.png",
   :width 2428,
   :height 1273,
   :contentType "image/png"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "http://jr0cket.co.uk/2019/08/development-workflow-with-clojure-cli-tools.html",
  :commonTopics
  [{:score 77.88132082149671,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.961,
    :id "nlp/f/topic/1975",
    :salienceLevel "about",
    :label "running"}
   {:score 0.903,
    :id "nlp/f/topic/2461",
    :salienceLevel "about",
    :label "web design"}
   {:score 0.845,
    :id "nlp/f/topic/2322",
    :salienceLevel "mention",
    :label "trail running"}
   {:score 0.726,
    :id "nlp/f/topic/1555",
    :salienceLevel "mention",
    :label "net"}],
  :published 1564918505000,
  :fingerprint "f530d179",
  :canonicalUrl
  "http://jr0cket.co.uk/2019/08/development-workflow-with-clojure-cli-tools.html"}
 {:engagement 9,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1564763571228,
  :content
  {:content
   "<p>Each week, we answer a different question about Clojure and functional programming.</p>\n<p>If you have a question you’d like us to discuss, tweet <a href=\"https://twitter.com/clojuredesign\">@clojuredesign</a>, send an email to <a href=\"mailto:feedback@clojuredesign.club\">feedback@clojuredesign.club</a>, or join the <code>#clojuredesign-podcast</code> channel on the <a href=\"http://clojurians.net/\">Clojurians Slack</a>.</p>\n<p>This week, the question is: <strong>“Should I use lein, boot, or tools.deps?”</strong> We assemble a list of build tool characteristics and talk about how each tool stacks up before giving our recommendations.</p>\n<p>Selected quotes:</p>\n<ul>\n<li>“The best thing about boot is that you can use all the flexibility of Clojure code. The worst thing about boot is that you can use all the flexibility of Clojure code.”</li>\n<li>“Tools.deps, the non-build build tool.”</li>\n<li>“I have a file, it’s got Clojure in it, and I want to run it.”</li>\n<li>“Tools.deps has enabled people to make build functions that stand alone. They don’t have any ceremony to become part of the tool. It’s just a main.”</li>\n</ul>",
   :direction "ltr"},
  :updated 1564758000000,
  :entities
  [{:mentions [{:text "Boot"}],
    :id "nlp/f/entity/wd:508683",
    :salienceLevel "about",
    :label "Tupolev Tu-91"}
   {:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "about",
    :label "Clojure"}
   {:mentions [{:text "functional programming"}],
    :id "nlp/f/entity/wd:193076",
    :salienceLevel "mention",
    :label "functional programming"}],
  :alternate
  [{:href
    "https://clojuredesign.club/episode/040-should-i-use-lein-boot-or-tools-deps/",
    :type "text/html"}],
  :title "Ep 040: Should I Use Lein, Boot, or Tools.deps?",
  :author "Christoph Neumann and Nate Jones",
  :published-str "Fri Aug 02 08:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16c532d441c:13860ac:73d34570",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://clojuredesign.club/episode/040-should-i-use-lein-boot-or-tools-deps/",
  :commonTopics
  [{:score 26.108768901758026,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.969,
    :id "nlp/f/topic/2501",
    :salienceLevel "about",
    :label "woodworking"}
   {:score 0.903,
    :id "nlp/f/topic/501",
    :salienceLevel "about",
    :label "college"}
   {:score 0.898,
    :id "nlp/f/topic/349",
    :salienceLevel "about",
    :label "business"}
   {:score 0.889,
    :id "nlp/f/topic/2085",
    :salienceLevel "about",
    :label "skiing"}
   {:score 0.878,
    :id "nlp/f/topic/2035",
    :salienceLevel "about",
    :label "sec tools"}],
  :published 1564758000000,
  :fingerprint "5e90f9b8",
  :canonicalUrl
  "https://clojuredesign.club/episode/040-should-i-use-lein-boot-or-tools-deps/"}
 {:engagement 5,
  :unread false,
  :crawled 1564741841255,
  :content
  {:content
   "<p>We have less than 35 growing seasons to double food production in order to meet the needs of a nine-billion+ population. Yet Earth’s soil fertility is rapidly degrading and climate volatility is increasing, with the impacts being felt on the frontline by farmers, enterprises relying on crop supplies and governments setting policy. </p>\n<p>Cervest is changing the landscape using cutting edge technology and statistical science to create ‘decision useful’ tools for our users. We are building an AI-powered platform that will empower our users to make better ‘risk aware’ decisions by predicting land productivity, simulating climate impacts and providing early warning signals. </p>\n<p>We’re seeking an experienced front end engineer to join our team at an exciting time for our business. You’ll be helping to grow our success as an AI-first platform, building infrastructure, platform and user interfaces that will facilitate the practice of computational statistics and data science within our company and that will place the outputs in the hands of our clients.</p>\n<p>From the outset you’ll be passionate about bringing the innovative approaches needed to establish a brand new category, and using your skills to leverage both business success and real change in the world. Reporting to Oliver Godby, Cervest’s Head of Engineering and Technology, you will play a crucial role in working on feature-rich, exciting user interfaces and setting the tone of the next five to ten years of innovation in this exciting company. </p>\n<p>The role offers a unique opportunity to join an early-stage, highly mission-driven team where you’ll have the ability to make a significant impact on our company and our users. </p>\n<p>We are a team of impatient optimists who want to make a lasting, positive and sustainable impact across the planet. We believe the benefits of AI should be accessible, affordable and used to empower those managing nature’s resources – growers, buyers and policymakers – to adapt to rising climate volatility. </p>\n<p>We are also a pro-diversity company and passionate about bringing together people of all backgrounds, because we know that a diverse team will help us achieve our mission sooner. </p>\n<p>Are you inspired by the power of technology, science and data to create a more sustainable world? If so, join us on our journey and help shape the future of our planet and humanity.</p>\n<p><strong>Great if you have:</strong></p>\n<p>Javascript Programming Skills – Specifically ReactJS or similar paradigm.</p>\n<p>ClojureScript OR a keen interest in learning ClojureScript</p>\n<p>D3 Skills, especially modifying / customising D3 visualisations, in order to build custom graph / diagram types for D3-based libraries (such as ReCharts / react-vis)</p>\n<p>SVG – low level SVG skills</p>\n<p>LeafletJS / Mapping on Web experience including tile services like MapBox</p>\n<p>HTML / CSS</p>\n<p>Linux familiarity / comfort</p>\n<p>Git</p>\n<p><strong>Even better if you have:</strong></p>\n<p>Clojure</p>\n<p>AWS Skills</p>\n<p>NodeJS or Python or Ruby</p>\n<p>GraphQL</p>\n<p>SysOps / DevOps skills</p>\n<p>Docker</p>\n<p>GIS Skills – PostGIS, QGIS etc.</p>\n<p>Sketch / Adobe XD</p>\n<p>WordPress Skills</p>\n<p>Get information on <a href=\"https://functionaljobs.com/jobs/9180-senior-front-end-engineer-at-cervest\">how to apply</a> for this position.</p>",
   :direction "ltr"},
  :updated 1564738865000,
  :entities
  [{:mentions [{:text "soil fertility"}],
    :id "nlp/f/entity/wd:202080",
    :salienceLevel "mention",
    :label "soil fertility"}
   {:mentions [{:text "data science"}],
    :id "nlp/f/entity/wd:2374463",
    :salienceLevel "mention",
    :label "data science"}
   {:mentions [{:text "Web"}],
    :id "nlp/f/entity/wd:466",
    :salienceLevel "mention",
    :label "World Wide Web"}
   {:mentions [{:text "Python"}],
    :id "nlp/f/entity/wd:28865",
    :salienceLevel "mention",
    :label "Python"}
   {:mentions [{:text "WordPress"}],
    :id "nlp/f/entity/wd:13166",
    :salienceLevel "mention",
    :label "WordPress"}],
  :alternate
  [{:href
    "https://functionaljobs.com/jobs/9180-senior-front-end-engineer-at-cervest",
    :type "text/html"}],
  :title "Senior Front End Engineer at Cervest (Full-time)",
  :author "FunctionalJobs.com",
  :published-str "Fri Aug 02 02:41:05 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16c51e1b167:1158363:73d34570",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url
   "https://functionaljobs.com/static/uploads/4dca65671eddcac569f621bea28b6935.png?1445284800",
   :width 187,
   :height 200,
   :contentType "image/png"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "urn:uuid:ce32174f-1929-00f4-2d0f-d27d6c9b2ea3",
  :commonTopics
  [{:score 78.01010204506076,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1564738865000,
  :fingerprint "d4fcaacf",
  :canonicalUrl
  "https://functionaljobs.com/jobs/9180-senior-front-end-engineer-at-cervest"}
 {:engagement 4,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1564720204540,
  :recrawled 1564821120536,
  :content
  {:content
   "<p>Because I promote functional programming, people often take what I say to mean that I don’t like OO. However, I think there’s a lot of cool stuff in OO. In this episode, I go over three or four things I think OO does really well.</p>\n<p></p>\n<h2>Transcript</h2>\n<p>Eric Normand: “Why is Object Oriented Programming So Great?” Hello. My name is Eric Normand and I help people thrive with functional programming.</p>\n<p>As a functional programming advocate, a lot of what I say often sounds like I don’t like Object Oriented Programming. I would like to talk about in this episode nothing but things that I like about OO. This is purely an opinion piece like most of my episodes.</p>\n<p>I feel like I’ve studied Object Oriented Programming in college from a Java-centered approach. I’ve also studied the early papers about Smalltalk and studied a lot of Alan Kay’s work. Never actually written anything in Smalltalk, but I’ve played with Squeak. I’ve gotten some insights into it.</p>\n<p>I’m not like an expert or anything, but I feel like I understand enough about it to be self-aware about why object-oriented programming could be powerful where things are going wrong in the world of Java and things like that.</p>\n<p>I would like to go over some of the things that I really like about object-oriented programming. Before I do that, I would like to say that Clojure wouldn’t exist without the object model that exists on the JVM. It uses it to a really great effect.</p>\n<p>Most of Clojure is written in Java. It definitely uses the OO features of Java to implement its features. Functions are just objects. There’s a class called fn, fun. There’s an interface called IFn. All of the core abstractions are developed as interfaces.</p>\n<p>It’s not clear that there needs to be such a strong division between object-oriented and functional programming, they can complement each other very well.</p>\n<p>It’s neat that FP and FP language, Clojure is built on top of the object-oriented principles of the JVM. That’s really neat. That’s awesome. I’m going to go over three or four points that are really cool about OO.</p>\n<p>Here we go. The first thing is that messages provide a layer of indirection. This layer of indirection is used for several things in most languages. When you send a message, the message has a name and then has some arguments.</p>\n<p>This name provides us a bit of semantics, some meaning to the message you’re passing. It’s usually a human-layer meaning. It’s in English or some human language. It’s not something the computer can understand directly.</p>\n<p>It’s an important layer of indirection because it lets you do polymorphism. By that, specifically, I mean that the receiving object can be a different class. As long as the message name is the same, the object receiving it can be different. You could have different results.</p>\n<p>That’s polymorphism. It lets you separate out the caller from the callee, meaning you can hide the implementation details. The caller should not have to care how it’s implemented.</p>\n<p>All this comes naturally out of indirection. Any layer of indirection should do that, should provide some kind of hiding. I’m indirecting through this so I don’t have to know what’s on the other side, like indirection in real life, like some kind of escrow service.</p>\n<p>I don’t need to know when the person is going to get their money. I put the money in this place and then they get it later.</p>\n<p>It’s a layer of indirection that serves to separate out the caller from the callee. That’s super important in programming. This message layer lets you do late binding. Some OO languages will use the static types to decide what method to call based on the message, but Smalltalk didn’t really have that.</p>\n<p>Everything was late bound. That’s what allows for polymorphism in a lot of ways that when I’m sending this message, I don’t know what the receiver is going to do with it. There’s always the hope that it will understand the message and do what I think it means, but you don’t know it’s going to do it.</p>\n<p>This is important when you’re building a system of any size because you don’t know how the system is going to work in general. Every change you have to make means that you will have to — if you don’t have polymorphism — change both sides, the caller and the callee.</p>\n<p>The caller now has to send the message to a different type of thing, it might require change on both sides. Changing the thing, the callee, and changing the caller to match the callee. With late binding, the caller is really insulated from the change of callee, meaning I can define a new type of number.</p>\n<p>Let’s say I want to make a complex number class, it implements plus, times, divide and minus, and all the things that I consider important for numbers. Now, I can plug that right in and it works in all of my existing code. No recompiling, nothing. It just works. That’s late binding.</p>\n<p>As your system evolves, there’s always going to be new stuff and new requirements that come in. You learn and you want to be able to change the system, but you want your changes to be isolated so you don’t have to change everything. That’s what late binding gives us.</p>\n<p>It also gives us a dispatch point. You can look at it in another way. In FP, even in typed FP, you often have different values that are part of the same type, and you want to do a different thing based on the value. The classic case is something like you have a maybe type optional value.</p>\n<p>You either have the value or you don’t because you want to do a different thing if you have the value. If you don’t have the value, do something else. This assumes you know all the possible values. That means that if you need to add a new value to that type, then you’re going to have to go change all the call sites.</p>\n<p>You’ve tightly coupled with early binding so the indirection is partial. It’s not real because the caller is still not totally separated from the callee. In FP, what you do is like a case statement or an if statement, some kind of branch on the value. If it’s just the value, if you have the value, do this. If you don’t have the value, do that.</p>\n<p>In OO, it reverses that. Instead of choosing the function first and then in the function you branch, OO says, “First look at the type of the thing or first look at the class — what value is it? — and then ask it to figure out what the operation should do.” That’s method lookup.</p>\n<p>Let me say this again. In FP, the name of the function you’re calling will determine the function. Then inside that function, you do some dispatch like a branch based on the value. It’s a little dynamic, because you have to check at runtime. Do I have the value right or do I not have the value?</p>\n<p>In OO, it’s reversed. First, you look at the value. That means looking up the value’s class. Then in the class, you’re doing this dispatch of look up the name of the method. Then that will give you the method, and then you call it. It’s the exact opposite order of things.</p>\n<p>The class is primary. The value is primary is primary in OO, whereas in FP the function is primary. By doing this reversal, I think it’s one of the magic tricks of OO. It’s like a jewel. It’s just one idea, but it gives you all these little benefits.</p>\n<p>This one reversal of letting the type — the value itself — determine how the operation should work, it means you don’t have this closed world assumption anymore. The caller can be separated from the callee. The caller no longer has to worry about what value it’s going to be sending this to.</p>\n<p>Once it sends the message, the callee can determine what to do with it, what is appropriate for it, for its semantics, for its way of representing things. This lets you add new cases, totally ad hoc without changing the caller.</p>\n<p>It’s another way of scaling your system. Every message pass is like you’re able to divide your system in half, the side that’s calling and the side that’s being called. It’s a very clean break.</p>\n<p>You can modify one side without modifying the other. That’s what layers of indirection are supposed to do. Systems that don’t give us those layers of indirection become very tightly coupled.</p>\n<p>OO is all about this ability to separate out the caller from the callee and give us this important level of indirection. Just to summarize, it gives us polymorphism. It lets us add in new cases or let’s call it new types of values, new classes that fit right in to an existing use.</p>\n<p>I gave the example of a complex number can now — if you implement all the right methods — go into a formula that you developed using integers, for instance. It’ll fit right in. You’re calling the same operations on it, so why not. The caller had no idea that that was even important.</p>\n<p>It allows for late binding, which means you can redefine things even after they’ve started being used. It also allows for dynamic recompilation. I can modify the code of this one class without having to recompile all the other classes, because it’s just an indirection. It’s a message pass.</p>\n<p>Finally, this late binding idea lets you be open. I can add new classes, new cases, new types of values that I didn’t have to anticipate. I don’t have to change the caller. It’s all about this indirection.</p>\n<p>This indirection, it’s basically a humility. It is saying, “I don’t know how this system is going to evolve. I don’t know the requirements six months from now, two weeks from now. I don’t know how things are going to change.</p>\n<p>I’m going to learn things along the way. I don’t know everything right now. Things are going to change, and I want to have to change as little as possible. Some code should still work even though I change a lot of it.”</p>\n<p>It’s a way to scale. In any project, when you first start, you know almost nothing about it. Programmers are like scientists. We’re like empirical scientists. We go into a domain, and we don’t know how it should work.</p>\n<p>We try things, we make hypotheses, and we test out whether this will make a good model of the system. Sometimes, we get pretty far. Then we get stuck, and we need to go back to the drawing board and make a new model. That’s what we do. We’re like little scientists.</p>\n<p>We don’t know how things should work, but often we get a lot right in the process. We can see that little things. We do understand those things, so we can break those off into small pieces that are totally encapsulated.</p>\n<p>This is a great thing for OO, total encapsulation of things. Those things might stick around for a really long time, because they were really well understood. That understanding was encoded in their interface.</p>\n<p>Some things we got wrong, especially the bigger things. More chances for mistakes. We had to rework those. We don’t want to rework the other parts that use those things. We want to rework the thing itself.</p>\n<p>I see OO as this admission that we don’t know. The only way to know is to go in, find out and try it out. Try to encode this knowledge as a program and see how it looks, see how it works.</p>\n<p>We can’t do that if every time we try to change something, we have to make it. We have to change the thing calling it as well. It’s an open-world assumption and just means “Here’s the stuff I know. I know there’s other stuff that I don’t know yet, but this is what I know.” [laughs] It’s basically what it means. That’s built into OO.</p>\n<p>I’ve said, I think, a lot of good things about OO. People will still continue to think that I don’t like OO at all because I talk about some of its limitations, but I do like OO. I think there’s a lot of good stuff there.</p>\n<p>Thank you very much. This has been my thought on functional programming. My name is Eric Normand. If you like this episode, you can find other episodes at lispcast.com/podcast. There, you’ll find all the past episodes with text, transcripts, video, and audio. There will be links to subscribe on podcasts via YouTube or RSS, if you like the text.</p>\n<p>You can also find links to find me on social media, like email, Twitter or LinkedIn. I love to get into discussions. If this episode was meaningful to you, either you’re pro, you agree with me, or you’re con, you disagree with me, let me know, we’ll talk about it because that’s what this is for.</p>\n<p>It’s me broadcasting, so I can talk to more people who like these ideas. You don’t have to agree with me. You just have to like talking about them. Awesome, thanks for listening. Rock on.</p>\n<p>The post <a rel=\"nofollow\" href=\"https://lispcast.com/what-is-so-great-about-object-oriented-programming/\">What is so great about object oriented programming?</a> appeared first on <a rel=\"nofollow\" href=\"https://lispcast.com\">LispCast</a>.</p>",
   :direction "ltr"},
  :updated 1564635600000,
  :entities
  [{:mentions [{:text "Object-Oriented Programming"}],
    :id "nlp/f/entity/wd:79872",
    :salienceLevel "about",
    :label "object-oriented programming"}
   {:mentions [{:text "functional programming"}],
    :id "nlp/f/entity/wd:193076",
    :salienceLevel "mention",
    :label "functional programming"}
   {:mentions [{:text "Smalltalk"}],
    :id "nlp/f/entity/wd:235086",
    :salienceLevel "mention",
    :label "Smalltalk"}
   {:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "Java"}],
    :id "nlp/f/entity/wd:251",
    :salienceLevel "mention",
    :label "Java"}],
  :alternate
  [{:href
    "https://lispcast.com/what-is-so-great-about-object-oriented-programming/",
    :type "text/html"}],
  :title "What is so great about object oriented programming?",
  :author "Eric Normand",
  :published-str "Wed Jul 31 22:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16c50978afc:fa66d2:73d34570",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url
   "https://lispcast.com/wp-content/uploads/2018/07/ERIC-NORMAND-LISPCAST.COM_.jpg",
   :width 513,
   :height 557,
   :contentType "image/jpeg"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://lispcast.com/what-is-so-great-about-object-oriented-programming/",
  :updateCount 1,
  :commonTopics
  [{:score 0.7092348341729189,
    :id "nlp/f/topic/1309",
    :salienceLevel "about",
    :label "leadership"}
   {:score 83.11584373261172,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.853,
    :id "nlp/f/topic/2010",
    :salienceLevel "about",
    :label "scalability"}
   {:score 0.747,
    :id "nlp/f/topic/1828",
    :salienceLevel "mention",
    :label "productivity"}
   {:score 0.73,
    :id "nlp/f/topic/525",
    :salienceLevel "mention",
    :label "computer science"}],
  :published 1564635600000,
  :fingerprint "450a08d0",
  :canonicalUrl
  "https://lispcast.com/what-is-so-great-about-object-oriented-programming/"}
 {:engagement 9,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1564652199524,
  :content
  {:content
   "<p>Summary: <em>Lists are kind of warty in Clojure. Care should be taken, especially by those coming from other Lisps.</em></p>\n<p>One of the things that still trips me up in Clojure is the actual types of lists. I used to program in Common Lisp, where things are a bit easier to understand: something is either a list or an atom. Lists are built out of conses and end with <code>nil</code>. Everything else is an atom.</p>\n<p>Coming from Common Lisp, one might expect this to work:</p>\n<pre><code>=> (listp (cons 1 nil))</code></pre>\n<p>In CL, it will be true. In Clojure, it is also true. (Try it out yourself!) Launch a REPL. Go to <a href=\"http://tryclj.com/\">Try Clojure</a>.</p>\n<pre><code>=> (list? (cons 1 nil))</code></pre>\n<p>What about this:</p>\n<pre><code>=> (list? (cons 1 (cons 1 nil)))</code></pre>\n<p>We’re consing onto a list, should be a list, no?</p>\n<p>In Common Lisp, yes. In Clojure?</p>\n<p>NO!</p>\n<p>That’s not a list. Go ahead, try it at your Clojure REPL.</p>\n<p>What gives? How is that possible? Are we living in a Kafkaesque ECMAScript World?</p>\n<div><img alt=\"\" width=\"500\" src=\"https://purelyfunctional.tv/wp-content/uploads/2019/08/kafkaesque.png\" class=\"wp-image-31705\" height=\"565\"></div>\n<p>Well . . . probably.</p>\n<p>What’s going on? Put on your Indiana Jones fedora. We’re going on an adventure deep into the heart of the Clojure JVM implementation.</p>\n<div><img alt=\"\" width=\"1920\" src=\"https://purelyfunctional.tv/wp-content/uploads/2019/08/raiders3.jpg\" class=\"wp-image-31706\" height=\"1080\"></div>\n<p>First, how is <code>list?</code> defined?</p>\n<p><a href=\"https://github.com/richhickey/clojure/blob/a1eff35124b923ef8539a35e7a292813ba54a0e0/src/clj/clojure/core.clj#L4961\">In clojure.core</a>:</p>\n<pre><code>(defn list?\n  &quot;Returns true if x implements IPersistentList&quot;\n  {:added &quot;1.0&quot;}\n  [x] (instance? clojure.lang.IPersistentList x))</code></pre>\n<p>Great, <code>list?</code> is just an instance check. <strong>What classes implement <code>clojure.lang.IPersistentList</code>?</strong> According to the javadoc on the Clojure sources, there are two: <code>PersistentQueue</code> and <code>PersistentList</code>. There’s also a static inner class in <code>PersistentList</code> called <code>EmptyList</code>.</p>\n<p>Let’s see those at the REPL:</p>\n<pre><code>=> (type ())\n  clojure.lang.PersistentList$EmptyList\n=> (list? ())\n  true\n\n=> (type (list 1 2 3))\n  clojure.lang.PersistentList\n=> (list? (list 1 2 3))\n  true\n\n=> (type clojure.lang.PersistentQueue/EMPTY)\n  clojure.lang.PersistentQueue\n=> (list? clojure.lang.PersistentQueue/EMPTY)\n  true</code></pre>\n<p>These all return true when given to <code>list?</code>. What about <code>(cons 1 nil)</code>?</p>\n<pre><code>=> (type (cons 1 nil))\n  clojure.lang.PersistentList\n=> (list? (cons 1 nil))\n  true</code></pre>\n<p>Great. <strong>Consing onto nil gives you a list</strong>. Let’s cons onto a list:</p>\n<pre><code>=> (type (cons 0 (list 1 2 3)))\n  clojure.lang.Cons\n=> (list? (cons 0 (list 1 2 3)))\n  false</code></pre>\n<div><img alt=\"\" width=\"640\" src=\"https://purelyfunctional.tv/wp-content/uploads/2019/08/raiders4.jpg\" class=\"wp-image-31707\" height=\"360\"></div>\n<p>Oh, no! Why does consing onto <code>nil</code> create a list, but <strong>consing onto a list create a cons</strong>? Poisonous dart averted! Back to the source code!</p>\n<p><a href=\"https://github.com/richhickey/clojure/blob/a1eff35124b923ef8539a35e7a292813ba54a0e0/src/clj/clojure/core.clj#L22\">In clojure.core</a>:</p>\n<pre><code>(def\n ^{:arglists '([x seq])\n    :doc &quot;Returns a new seq where x is the first element and seq is\n    the rest.&quot;\n   :added &quot;1.0&quot;}\n\n cons (fn* cons [x seq] (. clojure.lang.RT (cons x seq))))</code></pre>\n<p>So it calls <code>clojure.lang.RT/cons</code>. We can <a href=\"https://github.com/clojure/clojure/blob/1.5.x/src/jvm/clojure/lang/RT.java#L565\">look that up</a>:</p>\n<pre><code>static public ISeq cons(Object x, Object coll){\n    //ISeq y = seq(coll);\n    if(coll == null)\n        return new PersistentList(x);\n    else if(coll instanceof ISeq)\n        return new Cons(x, (ISeq) coll);\n    else\n        return new Cons(x, seq(coll));\n}</code></pre>\n<p>Wow! The code is clear: if the second argument is <code>null</code> (<code>nil</code>), <strong>it makes a <code>PersistentList</code></strong>. Otherwise, it constructs a <code>clojure.lang.Cons</code>, which is not a list! We’re at the root of our wart, but there’s nothing we can really do about it except keep exploring.</p>\n<p>If I have a list (according to <code>list?</code>) and I want to add an element to the front to make a new list, how do I do that?</p>\n<div><img alt=\"\" width=\"600\" src=\"https://purelyfunctional.tv/wp-content/uploads/2019/08/raiders-5.png\" class=\"wp-image-31708\" height=\"337\"></div>\n<p>Well, the answer is a little disappointing:</p>\n<pre><code>=> (def ls (list 1 2 3))\n=> (def ls2 (conj ls 0))\n=> (list? ls2)\n  true</code></pre>\n<p><code>conj</code> will maintain the type, <code>cons</code> will not. What happens if I <code>conj</code> onto a <code>Cons</code>?</p>\n<pre><code>=> (def c (cons 1 (cons 2 nil)))\n=> (conj c 0)\n  (0 1 2)\n=> (type (conj c 0))\n  clojure.lang.Cons</code></pre>\n<p>So, there you have it. It’s a bit of a wart having all of these slightly different types and predicates like <code>list?</code> that slice them up in odd ways. Sometimes it’s like running away from a giant paper-mache ball.</p>\n<div><img alt=\"\" width=\"580\" src=\"https://purelyfunctional.tv/wp-content/uploads/2019/08/raiders6.jpg\" class=\"wp-image-31709\" height=\"248\"></div>\n<p>In Clojure’s defense, I will say that <strong>I rarely use <code>list?</code></strong>, if at all. It’s <strong>not a very useful function</strong> in <code>clojure.core</code>. I’m usually working at a much higher level than that, thinking in terms of <a href=\"https://purelyfunctional.tv/guide/clojure-collections/#subvectors\">sequences</a> (an abstraction), not their concrete implementations. And in the end, you never get out of danger.</p>\n<p></p>\n<p>There you have it. If you’d like to learn more Clojure, I have a nice <a href=\"https://purelyfunctional.tv/browse/\">video series</a>.</p>\n<p>The post <a rel=\"nofollow\" href=\"https://purelyfunctional.tv/mini-guide/lists-in-clojure/\">Warty Lists in Clojure</a> appeared first on <a rel=\"nofollow\" href=\"https://purelyfunctional.tv\">PurelyFunctional.tv</a>.</p>",
   :direction "ltr"},
  :updated 1564647337000,
  :entities
  [{:mentions [{:text "Cons"}],
    :id "nlp/f/entity/wd:11599",
    :salienceLevel "about",
    :label "Chuck Taylor All-Stars"}
   {:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "Common Lisp"}],
    :id "nlp/f/entity/wd:849146",
    :salienceLevel "mention",
    :label "Common Lisp"}
   {:mentions [{:text "REPL"}],
    :id "nlp/f/entity/wd:2032810",
    :salienceLevel "mention",
    :label "Read–eval–print loop"}
   {:mentions [{:text "Indiana Jones"}],
    :id "nlp/f/entity/wd:148659",
    :salienceLevel "mention",
    :label "Indiana Jones"}],
  :alternate
  [{:href "https://purelyfunctional.tv/mini-guide/lists-in-clojure/",
    :type "text/html"}],
  :title "Warty Lists in Clojure",
  :author "Eric Normand",
  :published-str "Thu Aug 01 01:15:37 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16c4c89de64:9f9677:561e4df6",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url
   "https://purelyfunctional.tv/wp-content/uploads/2019/08/raiders3.jpg",
   :width 1920,
   :height 1080,
   :contentType "image/jpeg"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://purelyfunctional.tv/?p=31704",
  :commonTopics
  [{:score 56.39595101598704,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1564647337000,
  :fingerprint "35ac3ece",
  :canonicalUrl
  "https://purelyfunctional.tv/mini-guide/lists-in-clojure/"}
 {:engagement 5,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1564649563325,
  :content
  {:content
   "<p>Summary: <em>There are many classics of functional programming that can help you take your thinking to the next level. My recommendations are for making you think in a new way.</em></p>\n<p>You’re able to write programs in Clojure and you’ve even finished a few projects. You feel like you’ve got a handle on the language. (Congratulations!) But you’re stuck about where to go next. <strong>There don’t seem to be many resources for upping your skill.</strong></p>\n<p>One great thing about Clojure and Lisps in general: it’s not about the language. Yes, there’s some detailed stuff you have to learn, like how to use the data structures, details of destructuring syntax, etc. Those are like your lego blocks. But once you’ve got that down, it’s not about learning what language features you need for what problems. You’ve got your legos and <strong>it’s up to you to put the legos together in new ways</strong>.</p>\n<p>This is also the downside of Lisps. If you’re not good at making new things with lego blocks, where do you turn to learn how to do it? Really, you <strong>study the masters</strong> and learn what they’ve done.</p>\n<p>I know that it’s hard to grow in non-mainstream languages. Mainstream languages have lots of books, lots of stylists, lots of exploration about how best to structure your code. For instance, you can read <em>Design <a href=\"https://purelyfunctional.tv/guide/clojure-collections/#patterns\">Patterns</a></em> for an intermediate level Object Oriented Design perspective which will take you pretty far down the road to becoming an advanced OO programmer. <strong>Where are all of the functional programming books?</strong></p>\n<p>Well, they’re out there. The functional programming path will depart from the merely practical. You won’t learn how long to make your methods or how to name them. Some of the things you’ll learn are not practical at all. But you will <strong>learn general truths and principles that help you see the world in a new way</strong>.</p>\n<p>Here are some recommended books:</p>\n<h3>1. <a href=\"https://mitpress.mit.edu/sicp/full-text/book/book.html\">Structure and Interpretation of Computer Programs</a> (SICP)</h3>\n<p>SICP teaches the fundamental abstraction capabilities of Lisp-like languages. It will teach you a framework for understanding the abstractions of other languages. And it teaches the difficult idea higher-order programming. That means programming with functions as arguments and return values.</p>\n<p>By the end of the book: <strong>you’ll have a new appreciation for the relationship between code and data. You will also learn the how and why of abstraction.</strong></p>\n<p>Common comment during reading: “My entire CS education was a waste.”</p>\n<h3>2. <a href=\"http://www.amazon.com/Lisp-Small-Pieces-Christian-Queinnec/dp/0521545668\">Lisp in Small Pieces</a></h3>\n<p>If you’re curious about how to design a Lisp, this book is amazing. Lisp, being one of the oldest high-level languages, has a long history. In that history, versions of Lisp have been written and rewritten so many times, by so many people, that the design space has been very well explored. This book doesn’t give a historical perspective, but instead systematically walks through the different design decisions that you will face while implementing your own Lisp. It’s mind-expanding stuff for those interested in language design.</p>\n<p>By the end of the book: <strong>you will see the parts of any language as arbitrary choices and understand how they relate.</strong></p>\n<p>Common comment during reading: “Lisp is a field of study in itself.”</p>\n<h3>3. <a href=\"http://norvig.com/paip.html\">Paradigms of Artificial Intelligence Programming</a></h3>\n<p>This book is about the old style of artificial intelligence that wasn’t statistical. Instead, it was about rule engines, logic, and pattern matching. It’s a study in data-driven programming, which basically means bootstrapping a language (DSL?) inside of Lisp. For instance, at the end you write a small Prolog interpreter. You’ll learn how to recognize problems that are complex enough to warrant building their own language to solve them.</p>\n<p>By the end of the book: <strong>you’ll know how to build DSLs that aren’t merely for convenient syntax but instead give you new expressive power.</strong></p>\n<p>The oddest thing happens with this kind of knowledge. You can write a program to solve a problem with let’s say 500 lines of code. Or you could write an interpreter for a language in 100 lines of code, then the solution to the problem in one or two more lines in your new language. Such is the power of linguistic abstraction.</p>\n<p>Common comment during reading: “I could replace myself with a short interpreter.”</p>\n<h3>4. <a href=\"http://www.paulgraham.com/onlisp.html\">On Lisp</a></h3>\n<p>Before Paul Graham started his startup incubator, he was a well-respected Lisp popularizer. On Lisp is the best book on macros that I’ve read. It’s Common Lisp macros, but the principles are applicable to Clojure. This book goes well-beyond convenience macros that just provide better syntax. It dives into some fairly complex macros, my favorite being the delimited continuation macro, that are similar to how the go macro works in core.async.</p>\n<p>By the end of this book: <strong>you’ll be able to write such complex macros and won’t want to use macros for mere syntactic sugar.</strong></p>\n<p>Common comment during reading: “I will never again write code in a language without macros.”</p>\n<h3>5. <a href=\"http://www.amazon.com/To-Mock-Mockingbird-Other-Puzzles/dp/0192801422\">To Mock a Mockingbird</a></h3>\n<p><em>I haven’t actually read this, but I have been recommended it before.</em></p>\n<p>I hesitate to recommend this book because functional programming has a reputation of being impractical, abstract, and mathematical. But the more experienced functional programmers I talk to, the more I realize that it is very common to master this kind of thinking. You won’t want to implement them directly in your production code. But by putting your brain through the paces of solving these puzzles, you will have a better appreciation for the power of lambdas.</p>\n<p>By the end of this book: <strong>you’ll be able to develop systems of mostly small, composable higher-order functions.</strong></p>\n<p>Common comment during reading: “Where does the work happen?”</p>\n<p>These are my recommendations. What are yours? <a href=\"http://discuss.purelyfunctional.tv/t/recommendations-for-next-level-clojure/505\">Join the discussion.</a></p>\n<p>The post <a rel=\"nofollow\" href=\"https://purelyfunctional.tv/article/clojure-the-next-level/\">Recommendations for Next-Level Clojure</a> appeared first on <a rel=\"nofollow\" href=\"https://purelyfunctional.tv\">PurelyFunctional.tv</a>.</p>",
   :direction "ltr"},
  :updated 1564645832000,
  :entities
  [{:mentions [{:text "functional programming"}],
    :id "nlp/f/entity/wd:193076",
    :salienceLevel "mention",
    :label "functional programming"}
   {:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "Common Lisp"}],
    :id "nlp/f/entity/wd:849146",
    :salienceLevel "mention",
    :label "Common Lisp"}
   {:mentions [{:text "Lisp"}],
    :id "nlp/f/entity/wd:132874",
    :salienceLevel "mention",
    :label "Lisp"}
   {:mentions
    [{:text "Structure and Interpretation of Computer Programs"}
     {:text "SICP"}],
    :id "nlp/f/entity/wd:1249747",
    :salienceLevel "mention",
    :label "Structure and Interpretation of Computer Programs"}],
  :alternate
  [{:href
    "https://purelyfunctional.tv/article/clojure-the-next-level/",
    :type "text/html"}],
  :title "Recommendations for Next-Level Clojure",
  :author "Eric Normand",
  :published-str "Thu Aug 01 00:50:32 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16c4c61a4bd:9bc35a:561e4df6",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://purelyfunctional.tv/?p=31703",
  :commonTopics
  [{:score 111.11829516860985,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.956,
    :id "nlp/f/topic/1291",
    :salienceLevel "about",
    :label "languages"}
   {:score 0.87,
    :id "nlp/f/topic/525",
    :salienceLevel "about",
    :label "computer science"}
   {:score 0.839,
    :id "nlp/f/topic/721",
    :salienceLevel "mention",
    :label "ebooks"}],
  :published 1564645832000,
  :fingerprint "8509c1dd",
  :canonicalUrl
  "https://purelyfunctional.tv/article/clojure-the-next-level/"}
 {:engagement 9,
  :unread false,
  :crawled 1564649563325,
  :content
  {:content
   "<p>Summary: <em>ClojureScript adds a lot of value on top of the Javascript platform. But some of that value can be had directly in Javascript without using a new language.</em></p>\n<p><strong>ClojureScript is a dialect of Clojure that compiles to Javascript.</strong> It lets you run Clojure in a browser or on Node. Just like Clojure, it has <a href=\"https://purelyfunctional.tv/guide/clojure-concurrency/#ds\">immutable data structures</a>, literals for those data structures, macros, and core.async support.</p>\n<p>These features are very powerful and they give ClojureScript a lot of power above Javascript. But a lot of that power can be had in Javascript through libraries, tools, and now some ES6 features. If you can’t make the switch to ClojureScript, these tools might help you out. If you’ve heard of all the cool stuff that ClojureScript can do, well, this might be <strong>a good way to dip your toes in</strong> before you jump in.</p>\n<h3>1. <a href=\"http://swannodette.github.io/mori/\">Use ClojureScript’s awesome data structures in Javascript</a></h3>\n<p>David Nolen, the maintainer of ClojureScript, has wrapped up the <strong>ClojureScript immutable data structures to be used as a Javascript library</strong> which he calls <a href=\"http://swannodette.github.io/mori/\">mori</a>. He’s put in a lot of work to make it convenient to use from Javascript. It’s not just the datastructures. It also has all of the functional goodness that makes them powerful to use.</p>\n<h3>2. <a href=\"https://github.com/ubolonton/js-csp\">Write CSP like core.async without core.async</a></h3>\n<p>CSP stands for Communicating Sequential Processes. It’s a model of concurrency that is <strong>used in Go and in Clojure core.async</strong>. It’s a powerful tool, especially in Javascript, where you don’t have threads. Once you use it, you’ll never go back.</p>\n<p>Well, thanks to Generators in EcmaScript 6, <strong>you can write CSP code in Javascript</strong>. There’s a library called <a href=\"https://github.com/ubolonton/js-csp\">js-csp</a> that does just that.</p>\n<h3>3. <a href=\"https://github.com/cognitect/transit-format\">Better data formats than JSON</a></h3>\n<p>JSON is a great format for data exchange, but <strong>it has limitations</strong>. One of the biggest limitations is that it is not extensible. You cannot define new types. Wouldn’t it be nice to have values that get parsed as Javascript Date objects? Another limitation is that map keys can only be strings.</p>\n<p>The <a href=\"https://github.com/edn-format/edn\">edn format</a> is <strong>Clojure’s literal syntax made into a data format</strong>. It includes many data structures, including symbols, keywords, sets, maps, lists, and <a href=\"https://purelyfunctional.tv/guide/clojure-collections/#vector\">vectors</a>. It is also extensible with tagged literals, meaning a small tag can be placed in front of a value to indicate the <a href=\"https://purelyfunctional.tv/guide/clojure-collections/#two-layers\">semantic</a> meaning of that value. There are a couple of built-in tags, such as #instant for Dates and #uuid for, yes, UUIDs. But the important thing is <strong>you can define your own and define how they get parsed</strong>.</p>\n<p>There’s a <a href=\"https://github.com/shaunxcode/jsedn\">Javascript library</a> for parsing and generating edn.</p>\n<p>edn is a great format, but parsing it in Javascript is never going to be as fast as parsing JSON. The JSON parser is written in C and highly optimized. Because of that limitation, the folks who build Clojure wrote <a href=\"https://github.com/cognitect/transit-format\">Transit</a>, which is <strong>a data format that serializes to JSON</strong>. It’s semantically equivalent to edn, so it’s extensible, but it’s also JSON, so it’s fast to parse. There’s a <a href=\"https://github.com/cognitect/transit-js\">Javascript implementation</a>.</p>\n<h3>4. <a href=\"http://sweetjs.org/\">Write your own syntax with macros</a></h3>\n<p>Macros are one of those legendary things Lisps are known for. They let you write code that writes code. Well, that’s kind of a meaningless statement. Think of it more like extensible syntax. You can <strong>write a new type of syntax</strong> which will be <strong>translated to plain Javascript</strong>.</p>\n<p>There’s a macro system for Javascript called <a href=\"http://sweetjs.org/\">Sweet.js</a>. The macro system is similar to the one found in Scheme systems. This isn’t directly from Clojure, but you get the same power. <strong>Macros are a great way to extend a language.</strong> You no longer have to wait for a new language feature to be implemented. You can do it yourself.</p>\n<h3>Conclusion</h3>\n<p>The Javascript community is active and growing. There are plenty of smart people making cool libraries that can revolutionize your programs. One of Clojure’s philosophies is to have <strong>a small core language and extend</strong>, to the extent possible, using libraries<sup><a href=\"https://purelyfunctional.tv/tag/clojure/feed/#fn1\">1</a></sup>. So, those libraries can often be leveraged outside of Clojure, which is true in the case of mori. Or they are simply standardized to work cross-platform, like edn and Transit. CSP and macros are simply powerful tools that can be added to many languages.</p>\n<p><strong>Go give these tools a try.</strong> If you like them, you might like Clojure/ClojureScript. They will be here when you’re ready. And when you <em>are</em> ready, I must recommend <a href=\"https://purelyfunctional.tv/tag/clojure/feed/www.purelyfunctional.tv/intro-to-clojure\">LispCast Introduction to Clojure</a>. It’s a video course designed and produced to take you from zero to Clojure.</p>\n<div>\n<hr>\n<ol>\n<li>Those libraries often contain macros which extend the base language.<a href=\"https://purelyfunctional.tv/tag/clojure/feed/#fnref1\">↩</a></li>\n</ol>\n</div>\n<p>The post <a rel=\"nofollow\" href=\"https://purelyfunctional.tv/article/four-features-javascript-can-steal-from-clojure/\">4 Features Javascript can steal from Clojure(Script)</a> appeared first on <a rel=\"nofollow\" href=\"https://purelyfunctional.tv\">PurelyFunctional.tv</a>.</p>",
   :direction "ltr"},
  :updated 1564644980000,
  :entities
  [{:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "about",
    :label "Clojure"}
   {:mentions [{:text "JSON"}],
    :id "nlp/f/entity/wd:2063",
    :salienceLevel "mention",
    :label "JavaScript Object Notation"}
   {:mentions [{:text "Transit"}],
    :id "nlp/f/entity/wd:181517",
    :salienceLevel "mention",
    :label "theodolite"}
   {:mentions [{:text "UUID"}],
    :id "nlp/f/entity/wd:195284",
    :salienceLevel "mention",
    :label "universally unique identifier"}
   {:mentions [{:text "Node"}],
    :id "nlp/f/entity/wd:756100",
    :salienceLevel "mention",
    :label "Node.js"}],
  :alternate
  [{:href
    "https://purelyfunctional.tv/article/four-features-javascript-can-steal-from-clojure/",
    :type "text/html"}],
  :title "4 Features Javascript can steal from Clojure(Script)",
  :author "Eric Normand",
  :published-str "Thu Aug 01 00:36:20 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16c4c61a4bd:9bc359:561e4df6",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://purelyfunctional.tv/?p=31697",
  :commonTopics
  [{:score 67.75833029379574,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.798,
    :id "nlp/f/topic/1555",
    :salienceLevel "mention",
    :label "net"}],
  :published 1564644980000,
  :fingerprint "2694f812",
  :canonicalUrl
  "https://purelyfunctional.tv/article/four-features-javascript-can-steal-from-clojure/"}
 {:engagement 4,
  :unread false,
  :crawled 1564646983234,
  :content
  {:content
   "<p>Summary: <em><code>conj</code> can be confusing if you’re used to other languages. It is not a commonly defined operation. Most languages define common positional adding operations. <code>conj</code>, however, has more useful semantics. How do you use <code>conj</code> usefully if you can’t guarantee the position?</em></p>\n<p>When I was at university, we were taught object-oriented programming as it exists in Java. We learned about interfaces, inheritance, and the <a href=\"http://en.wikipedia.org/wiki/Liskov_substitution_principle\"><em>Liskov Substitution Principle</em></a>. It makes sense. If you’re claiming that you’ve got a (sub)type of car, <strong>it still has to do everything a car can do</strong>. Otherwise it’s not really a subtype of car.</p>\n<h3>The point of confusion</h3>\n<p>Whenever I’m teaching someone Clojure, there’s <strong>a point in the journey where everyone gets at least curious</strong>, if not outright confused.</p>\n<pre><code>(conj '(1 2 3) 4) ;;=> '(4 1 2 3)</code></pre>\n<p>vs</p>\n<pre><code>(conj [1 2 3] 4) ;;=> [1 2 3 4]</code></pre>\n<p>What’s the deal? <strong>Does <code>conj</code> add to the beginning or the end?</strong> What possible contract could allow both of these behaviors?</p>\n<p>Then I show them that the confusion goes even deeper:</p>\n<pre><code>(conj #{1 2 3} 4) ;;=> #{1 4 2 3} ;; or some other random order</code></pre>\n<p>and</p>\n<pre><code>(conj {1 2 3 4} [5 6]) ;;=> {1 2 3 4 5 6}</code></pre>\n<p>What gives? How is this even possible? <strong>Do <a href=\"https://purelyfunctional.tv/guide/clojure-collections/#hash-map\">hashmaps</a> and linked lists even share a common class ancestor?</strong></p>\n<p>The answer is, <em>sure, if you want them to</em>. The student must get over a tiny conceptual bump. And once that bump is surmounted, poof, a new way of seeing is discovered.</p>\n<h3>The bump</h3>\n<p>Let’s get over that bump right here, right now.</p>\n<p>Let’s imagine a traditional collection interface, let’s call it <code>List</code>. It has two methods, <code>addFirst</code> and <code>addLast</code> that add new elements. So you write an algorithm that adds a bunch of items to the end with <code>addLast</code>. It takes a <code>List</code> as argument, because that’s <strong>the least subtype you need to perform the algorithm</strong>.</p>\n<p>You call that algorithm with an <code>ArrayList</code>, which has the nice property that <code>addLast</code> is constant time. Woohoo! <strong>Your algorithm is fast and great.</strong></p>\n<p>A few months later, you get a phone call from another developer. He’s complaining that he used your routine and can’t figure out why it’s so slow. It was working fine for a while, but <strong>as the users generated more records in the database</strong>, the routine was grinding to a hault.</p>\n<p>You check out the code and immediately see the problem: the database query was returning not an <code>ArrayList</code> but a <code>LinkedList</code>. The implementation of <code>addLast</code> on <code>LinkedList</code>s is actually linear. <strong>Adding a bunch of stuff to the end was turning into a quadratic operation.</strong></p>\n<p>Let’s say that again: even though the location <a href=\"https://purelyfunctional.tv/guide/clojure-collections/#two-layers\">semantics</a> of the operation were the same, <code>addLast</code> on one had constant time and on the other had linear time. They both gave equivalent lists, but one of them was too slow. <strong>Does this satisfy the Liskov Substitution Principle?</strong> In practice, can you <em>really</em> substitute one for the other? <strong>Algorithmic complexity matters.</strong></p>\n<p>Clojure avoids that mess (while swapping it for another, which I’ll get to shortly). It defines <code>conj</code>, which means not “put this at the beginning” or “put this at the end”, but “hey, collection, you know yourself better than I ever can. Please add this wherever it makes sense for you as long as you <strong>do it in constant time</strong>. Thanks.”<sup><a href=\"https://purelyfunctional.tv/tag/clojure/feed/#fn1\">1</a></sup></p>\n<p>Practically, that means that <code>conj</code> on <code>LinkedList</code> adds to the front, because that’s constant time. And <code>conj</code> on <code>ArrayList</code> adds to the end. But, because the operation doesn’t talk about order, like <code>addFirst</code> and <code>addLast</code> do, you can now extend <code>conj</code> to <code>Set</code> and even <code>Map</code> if you consider key/value pairs as single items. And that means that linear algorithms using <code>conj</code> will <strong>remain linear regardless of which collection you use</strong>.</p>\n<h3>The mess that Clojure chooses over the other mess</h3>\n<p>Does this satisfy the Liskov Substitution Principle? Well, that depends on how you look at it. You certainly <strong>don’t guarantee that you get the same or even equivalent answers out</strong>. Consider this:</p>\n<pre><code>(def a [1 2 3])\n(def b '(1 2 3))\n\n(= a b) ;;=> true\n(= (conj a 4) (conj b 4)) ;;=> false</code></pre>\n<p>So, here, performing the same operation on two equal values does not give equal results. That’s kind of hard to reason about. <strong>But it’s a similar tradeoff that you see with other operations that don’t guarantee order.</strong> For instance, imagine two sets <code>a</code> and <code>b</code>.<sup><a href=\"https://purelyfunctional.tv/tag/clojure/feed/#fn2\">2</a></sup></p>\n<pre><code>(= a b) ;;=> true\n\n(= (seq a) (seq b)) ;;=> could be false!</code></pre>\n<p>The order of most sets is not guaranteed! This means that Clojure has some operations that do not maintain equality. <code>conj</code> just happens to be one of them.</p>\n<h3>What’s the point?</h3>\n<p>So Clojure does not provide <code>add</code> operations that guarantee order regardless of collection type. Fine. What’s the point?</p>\n<p>The point is that, in practice, <code>conj</code> is more useful than <code>addFirst</code> and <code>addLast</code> combined. By defining a function using <code>conj</code>, <strong>it will work on a broader number of collections</strong>. It might give different answers for each, but it won’t explode on one and do fine on the rest. And often <strong>the answers it gives are just fine</strong>. A basic version of <code>into</code> can be defined very easily. It works on all <a href=\"https://purelyfunctional.tv/guide/clojure-collections/\">collections</a> (for both <code>to</code> and <code>from</code>).</p>\n<pre><code>(defn into [to from]\n  (reduce conj to from))</code></pre>\n<h3>Common usage</h3>\n<p>One last thing before I wrap up: because the <em>collection itself</em> defines where the item will be added, I often find myself choosing the collection based on where I need it. A common idiom in Common Lisp was to make a new list by <code>cons</code>ing onto the front, then reversing it at the end because you really wanted them in the other order. In Clojure, there’s no need, because you can just use a <a href=\"https://purelyfunctional.tv/guide/clojure-collections/#vector\">vector</a> (and use <code>conj</code>). <strong>As long as the vector is local to the algorithm, it’s not part of the contract, so it’s your choice.</strong></p>\n<h3>Conclusion</h3>\n<p>Java was wrong. <code>addFirst</code> and <code>addLast</code> cannot be substituted in <code>LinkedList</code> and <code>ArrayList</code>. They have <strong>different algorithmic complexities</strong> and at some point one’s performance will be totally unacceptable. The operation that <em>does</em> allow for substitutibility in algorithm complexity is <code>conj</code>, which is always constant time. But then it doesn’t maintain equality. However, I find that <code>conj</code> is way more natural and helps algorithmic reasoning more than guaranteeing <em>where</em> the item is placed.</p>\n<p>If you’d like to learn Clojure, I recommend my video course <a href=\"http://www.purelyfunctional.tv/intro-to-clojure\"><em>LispCast Introduction to Clojure</em></a>. It’s a great introduction to the language using animations, exercises, and screencasts. It’s designed to give a deep dive straight to what makes Clojure interesting. It begins with syntax, goes through functional programming, and ends with data-driven programming.</p>\n<div>\n<hr>\n<ol>\n<li>It’s even polite!<a href=\"https://purelyfunctional.tv/tag/clojure/feed/#fnref1\">↩</a></li>\n<li><code>(def a (set (range 100))) (def b (apply sorted-set (range 100)))</code><a href=\"https://purelyfunctional.tv/tag/clojure/feed/#fnref2\">↩</a></li>\n</ol>\n</div>\n<p>The post <a rel=\"nofollow\" href=\"https://purelyfunctional.tv/article/conj-mental-bump/\">Why does Clojure’s conj add to the end of vectors but the beginning of lists?</a> appeared first on <a rel=\"nofollow\" href=\"https://purelyfunctional.tv\">PurelyFunctional.tv</a>.</p>",
   :direction "ltr"},
  :updated 1564644425000,
  :entities
  [{:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "about",
    :label "Clojure"}
   {:mentions [{:text "semantics"}],
    :id "nlp/f/entity/wd:39645",
    :salienceLevel "mention",
    :label "semantics"}
   {:mentions [{:text "Java"}],
    :id "nlp/f/entity/wd:251",
    :salienceLevel "mention",
    :label "Java"}
   {:mentions [{:text "Common Lisp"}],
    :id "nlp/f/entity/wd:849146",
    :salienceLevel "mention",
    :label "Common Lisp"}
   {:mentions [{:text "object-oriented programming"}],
    :id "nlp/f/entity/wd:79872",
    :salienceLevel "mention",
    :label "object-oriented programming"}],
  :alternate
  [{:href "https://purelyfunctional.tv/article/conj-mental-bump/",
    :type "text/html"}],
  :title
  "Why does Clojure’s conj add to the end of vectors but the beginning of lists?",
  :author "Eric Normand",
  :published-str "Thu Aug 01 00:27:05 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16c4c3a4642:97ec90:561e4df6",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://purelyfunctional.tv/?p=31694",
  :commonTopics
  [{:score 85.60159111581801,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.826,
    :id "nlp/f/topic/76",
    :salienceLevel "mention",
    :label "algorithms"}
   {:score 0.737,
    :id "nlp/f/topic/525",
    :salienceLevel "mention",
    :label "computer science"}],
  :published 1564644425000,
  :fingerprint "279440bd",
  :canonicalUrl
  "https://purelyfunctional.tv/article/conj-mental-bump/"}
 {:engagement 4,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1564646983234,
  :content
  {:content
   "<p>Summary: <em><code>clojure.set</code> is part of the standard library that comes with Clojure. It has functions for doing set operations and relational algebra.</em></p>\n<p>Clojure comes with a namespace called <code>clojure.set</code> in the standard library. It’s something I turn to all the time, even though it’s not so big. The namespace is fundamentally about standard operations on sets. I want to give you a quick tour of the library.</p>\n<h3>Including the library</h3>\n<p>The library comes standard, so there’s no extra dependency you have to add to your project. However, you will have to add a <code>:require</code> statement to your <code>ns</code> form at the top of namespaces where you want to use it. It’s typically aliased to <code>set</code>.</p>\n<pre><code>(ns com.lispcast.my-ns\n  (:require [clojure.set :as set]))</code></pre>\n<h3>Set-theoretic operations</h3>\n<p>When I think about sets, I think back to my math classes where we learned to do certain set operations like <em>union</em>, <em>intersection</em>, and <em>difference</em>. These operations are all available in <code>clojure.set</code> and they act like your math teacher would expect.</p>\n<p><code>(set/union a b)</code> is the set containing all elements from both <code>a</code> and <code>b</code>.</p>\n<p><code>(set/intersection a b)</code> is the set containing only elements that are in <code>a</code> and <code>b</code>.</p>\n<p><code>(set/difference a b)</code> is a set containing things that are in <code>a</code> but not in <code>b</code>.</p>\n<p><code>(set/subset? a b)</code> is true if <code>b</code> has all the elements in <code>a</code>.</p>\n<p><code>(set/superset? a b)</code> is true if <code>a</code> has all the elements in <code>b</code>.</p>\n<p><strong>Warning</strong>: these operations assume all the arguments are sets. They don’t check the types.</p>\n<h3>A few map operations</h3>\n<p>It may seem weird to put these in with the set operations, but these map operations were useful for implementing the operations in the next section. They’re still public and handy when you need them.</p>\n<p><code>(set/rename-keys {:x 1 :y 2} {:x :a})</code> is a map where the key <code>:x</code> is swapped for <code>:a</code>, namely <code>{:a 1 :y 2}</code>.</p>\n<p><code>(set/map-invert {:x 1 :y 2})</code> is a map where the keys and values are swapped, namely <code>{1 :x 2 :y}</code>.</p>\n<h3>Relational algebra operations</h3>\n<p>Relational algebra is what gave relational databases their name. If you imagine SQL tables are <em>sets</em> of records, you can see why these operations belong with other set operations. <code>clojure.set</code> has a complete set of the relational algebra basic operations. I don’t use these nearly as often as I should, even though I know they’re there. In <code>clojure.set</code> operations, <em>relations</em> are sets of maps, all with the same keys.</p>\n<p><code>(set/select (fn [row] (>= (:age row) 18)) people)</code> is a set of all people 18 or over.</p>\n<p><code>(set/join movie-appearances actors)</code> is the <em>natural join</em> between <code>movie-appearances</code> and <code>actors</code>. Imagine if <code>movie-appearances</code> was a set of maps that looked like <code>{:actor-name &quot;Mark Hamill&quot; :movie-name &quot;Star Wars&quot; :character-name &quot;Luke Skywalker&quot; ...}</code> and <code>actors</code> was a map like <code>{:actor-name &quot;Mark Hamill&quot; :nationality &quot;USA&quot; ...}</code>. Well, to find the natural join, you union maps that have the same value for keys that are shared. Here, <code>:actor-name</code> is shared between both relations. This join would contain the map</p>\n<pre><code>{:actor-name &quot;Mark Hamill&quot;\n :movie-name &quot;Star Wars&quot;\n :character-name &quot;Luke Skywalker&quot;\n :nationality &quot;USA&quot;\n ...}</code></pre>\n<p>Sometimes, though, the keys aren’t named right, or you just want to do a subset of the keys. In that case, you can pass in a map of key to key correspondences.</p>\n<p><code>(set/project movie-appearances [:actor-name :character-name])</code> is a relation without all the keys that aren’t in that list. Remember, it’s still a set (no duplicates) so it may have fewer <a href=\"https://purelyfunctional.tv/guide/clojure-collections/#tuple\">tuples</a>.</p>\n<p><code>(set/rename movie-appearances {:movie-name :movie-title})</code> is the same relation but with <code>:movie-name</code> changed to <code>:movie-title</code>.</p>\n<p><code>(set/index movie-appearances [:actor-name])</code> is a way to build an <a href=\"https://purelyfunctional.tv/guide/clojure-collections/#index\">index</a> of who was in what movie, looked up by the actor’s name.</p>\n<h3>Conclusions</h3>\n<p>Clojure comes with the standard set operations you’re used to, plus some useful relational algebra operations if you’re feeling frisky. Many <code>for</code> loops are actually set operations in disguise! And how many complex sprograms could be rewritten as a few relational algebra operations? We’ll never know. But I bet you can find some uses for these operations in your code!</p>\n<p>The post <a rel=\"nofollow\" href=\"https://purelyfunctional.tv/mini-guide/clojure-set/\">All about clojure.set</a> appeared first on <a rel=\"nofollow\" href=\"https://purelyfunctional.tv\">PurelyFunctional.tv</a>.</p>",
   :direction "ltr"},
  :updated 1564643360000,
  :entities
  [{:mentions [{:text "relational algebra"}],
    :id "nlp/f/entity/wd:840540",
    :salienceLevel "about",
    :label "relational algebra"}
   {:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "standard library"}],
    :id "nlp/f/entity/wd:1199356",
    :salienceLevel "mention",
    :label "standard library"}
   {:mentions [{:text "Mark Hamill"}],
    :id "nlp/f/entity/wd:210447",
    :salienceLevel "mention",
    :label "Mark Hamill"}
   {:mentions [{:text "Luke Skywalker"}],
    :id "nlp/f/entity/wd:51746",
    :salienceLevel "mention",
    :label "Luke Skywalker"}],
  :alternate
  [{:href "https://purelyfunctional.tv/mini-guide/clojure-set/",
    :type "text/html"}],
  :title "All about clojure.set",
  :author "Eric Normand",
  :published-str "Thu Aug 01 00:09:20 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16c4c3a4642:97ec8f:561e4df6",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://purelyfunctional.tv/?p=31692",
  :commonTopics
  [{:score 37.30663322810413,
    :id "nlp/f/topic/3052",
    :salienceLevel "about",
    :label "cinema"}
   {:score 26.66420112557,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.898,
    :id "nlp/f/topic/971",
    :salienceLevel "about",
    :label "gis"}],
  :published 1564643360000,
  :fingerprint "ca90581b",
  :canonicalUrl "https://purelyfunctional.tv/mini-guide/clojure-set/"}
 {:engagement 4,
  :unread false,
  :crawled 1564643933020,
  :content
  {:content
   "<p>The other day I wrote about some <a href=\"http://www.lispcast.com/java-learn-from-clojure\">principles that programming in Clojure</a> makes very clear. Those principles could be applied just as well in Java, and often are. However, there are some things that make Clojure distinct.</p>\n<p>Three of those distinctions are the way it deals with state change (using an <a href=\"http://en.wikipedia.org/wiki/Software_transactional_memory\">STM</a>), the <a href=\"http://clojure.org/data_structures\">Persistent Data Structures</a>, and the literal syntax for data with a reader (now called <a href=\"https://github.com/edn-format/edn\">edn</a>). Diving into the <a href=\"https://github.com/clojure/clojure\">source code for Clojure</a>, I realized that these three bits were written in Java. And that means that they can be used from Java. It is certainly not as easy as using them in Clojure, but they are all three powerful enough to warrant using them if you are using Java. <a href=\"http://mvnrepository.com/artifact/org.clojure/clojure/1.5.0\">You simply need to add one more JAR to your project (or add a maven dependency).</a> I have constructed a few minimal examples of their use.</p>\n<h3>1. Persistent Data Structures</h3>\n<p>Clojure comes with several powerful and fast collection classes. The interesting thing about them is that they are <a href=\"https://purelyfunctional.tv/guide/clojure-concurrency/#ds\">immutable</a>. If you want to add an object to a list, you actually create a new list containing the old elements and the new element. Instead of using copy-on-write, it reuses most of the internal structure of the original list, so only a small number of objects need to be allocated. It turns out that this can be done very quickly, comparable to using an <code>ArrayList</code>.</p>\n<p>The following example illustrates three of the more useful data structures: <a href=\"https://purelyfunctional.tv/guide/clojure-collections/#vector\">Vector</a>, <a href=\"https://purelyfunctional.tv/guide/clojure-collections/#hash-map\">HashMap</a>, and HashSet.</p>\n<pre><code>package persistent;\n\nimport clojure.lang.IPersistentMap;\nimport clojure.lang.IPersistentSet;\nimport clojure.lang.IPersistentVector;\nimport clojure.lang.PersistentHashMap;\nimport clojure.lang.PersistentHashSet;\nimport clojure.lang.PersistentVector;\n\npublic class PersistentTest {\n  public static void main(String[] args) {\n    IPersistentMap m = PersistentHashMap.create(&quot;abc&quot;, &quot;xyz&quot;);\n    m = m.assoc(1, 4); // add a new key/value pair\n    m = m.assoc(&quot;key&quot;, &quot;value&quot;);\n    m = m.without(&quot;abc&quot;); // remove key &quot;abc&quot; \n    System.out.println(m);\n        \n    IPersistentVector v = PersistentVector.create(1, 2, 3);\n    v = v.assocN(0, &quot;a string&quot;); // change index 0\n    v = v.cons(&quot;should be last&quot;); // add a string at the end\n    System.out.println(v);\n            \n    IPersistentSet s = PersistentHashSet.create(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;);\n    s = (IPersistentSet) s.cons(&quot;d&quot;); // add d to the set\n    s = (IPersistentSet) ((IPersistentMap) s).without(&quot;a&quot;); // remove an element\n    s.contains(&quot;g&quot;); // should return false\n    System.out.println(s);\n  }\n}</code></pre>\n<p>Now, it ain’t pretty. But it’s actually no worse than quite a few native Java libraries I’ve seen. There may be a better way to do this, but this one works.</p>\n<h3>2. Software Transactional Memory</h3>\n<p>Clojure uses <a href=\"http://en.wikipedia.org/wiki/Multiversion_concurrency_control\">Multiversion concurrency control</a> to provide a safe way to manage concurrent access to state shared between threads. In Clojure, they are called <a href=\"http://clojure.org/refs\">refs</a>. I won’t go very deep into how it works. Suffice it to say that <a href=\"http://clojure.org/refs\">Clojure refs</a> gives you non-blocking reads and transactional updates without having to do locking yourself. There are two caveats: 1 is that the value you give to the ref has to be immutable. 2 is that you should not perform IO (or perform any mutation) inside of the transaction.</p>\n<pre><code>package stm;\n\nimport java.util.concurrent.Callable;\n\nimport clojure.lang.LockingTransaction;\nimport clojure.lang.Ref;\n\npublic class STMTest {\n  public static void main(String[] args) {\n    // final needed to be used in anonymous class\n    final Ref r = new Ref(1);\n    final Ref s = new Ref(5);\n\n    try {\n      // run this in a transaction\n      // don't do IO inside\n      LockingTransaction.runInTransaction(\n        new Callable&lt;Object>() {\n          public Object call(){\n            s.set((Integer)r.deref() + 10);\n            r.set(2);\n            return null;\n          }\n        }\n      );\n    } catch (Exception e) {\n      e.printStackTrace();\n    }\n        \n    System.out.println(r.deref());\n    System.out.println(s.deref());\n  }\n}</code></pre>\n<h3>3. Extensible Data Notation</h3>\n<p>With <a href=\"https://github.com/clojure/clojure/blob/master/changes.md\">Clojure 1.5</a>, <a href=\"https://github.com/edn-format/edn\">edn</a> has become a standard part of the language. Edn is like an extensible JSON where the keys of objects can be any value (not just strings). It is based on the Clojure literal syntax, much in the same way that JSON is based on Javascript literal syntax. It is a nice way to serialize data. And since you already have the JAR in your project, it’s a no brainer to use it.</p>\n<pre><code>package edn;\n\nimport java.io.PushbackReader;\nimport java.io.StringReader;\n\nimport clojure.lang.EdnReader;\nimport clojure.lang.PersistentHashMap;\n\npublic class EDNTest {\n  public static void main(String[] args) {\n    // reading from a string\n    System.out.println(\n      EdnReader.readString(&quot;{\\&quot;x\\&quot; 1 \\&quot;y\\&quot; 2}&quot;, PersistentHashMap.EMPTY));\n\n    // reading from a Reader\n    // really, you can use any Reader wrapped in a PushbackReader\n    System.out.println(\n      EdnReader.read(new PushbackReader(new StringReader(&quot;#{10 2 3}&quot;)),\n                     PersistentHashMap.EMPTY));\n  }\n}</code></pre>\n<p>The post <a rel=\"nofollow\" href=\"https://purelyfunctional.tv/article/3-things-java-can-steal-from-clojure-2/\">3 Things Java Programmers Can Steal from Clojure</a> appeared first on <a rel=\"nofollow\" href=\"https://purelyfunctional.tv\">PurelyFunctional.tv</a>.</p>",
   :direction "ltr"},
  :updated 1564641369000,
  :entities
  [{:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "Java"}],
    :id "nlp/f/entity/wd:251",
    :salienceLevel "mention",
    :label "Java"}
   {:mentions [{:text "Reader"}],
    :id "nlp/f/entity/wd:159063",
    :salienceLevel "mention",
    :label "The Reader"}
   {:mentions [{:text "args"}],
    :id "nlp/f/entity/wd:2005914",
    :salienceLevel "mention",
    :label "entry point"}
   {:mentions [{:text "STM"}],
    :id "nlp/f/entity/wd:175646",
    :salienceLevel "mention",
    :label "scanning tunneling microscope"}],
  :alternate
  [{:href
    "https://purelyfunctional.tv/article/3-things-java-can-steal-from-clojure-2/",
    :type "text/html"}],
  :title "3 Things Java Programmers Can Steal from Clojure",
  :author "Eric Normand",
  :published-str "Wed Jul 31 23:36:09 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16c4c0bbb5c:9625d3:73d34570",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://purelyfunctional.tv/?p=31679",
  :commonTopics
  [{:score 103.7969615325148,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1564641369000,
  :fingerprint "b87e0b8b",
  :canonicalUrl
  "https://purelyfunctional.tv/article/3-things-java-can-steal-from-clojure-2/"}
 {:engagement 4,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1564622711307,
  :content
  {:content
   "<p>You should throw away your code and try again, because it will make you a better programmer to try the same problem multiple times. Each time you can try a new style or approach to solving it. That’s how you get better.</p>\n<p></p>\n<h2>Transcript</h2>\n<p>Eric Normand: Why should you throw away all of your code? Hi, my name is Eric Normand, and I help people thrive with functional programming. I’ve been thinking about ways to advise people to get better at functional programming, to be able to create more concise and expressive pieces of code.</p>\n<p>So many people say all the time like, “How did you think to do that?” Here’s the thing. My main advice is to code the same thing several times in different ways. The first time you code it, you’re probably just figuring out all the details, how it’s supposed to work. Make sure you handle all the cases, like null and stuff.</p>\n<p>You’re not getting it that right. You’ll get it working, but it’s not going to be beautiful and elegant, just like your first draft of an essay you have to write in school or anything like that. You’ve got to do multiple drafts to get it good.</p>\n<p>You try again. You code golf it a little. What if I used a different data structure? What if I used this other function that’s built in? What if I did it with this, changed the order of arguments? Does that make things feel better? You just have to give it some love, a little TLC. See if you can figure out a better way. Sometimes though, you just need to throw away the code and start over.</p>\n<p>What happens…It’s symptomatic of digital media. We tend to not want to throw stuff away. We feel like we’ve invested time in this thing, and we want to make edits to it to get it good instead of throwing it away.</p>\n<p>I feel like that is something that happens with digital media. If I write, let’s say an article, some essay in a Google doc, I’ll never just say, “OK, delete it all,” and start over, but I will often write on a piece of paper.</p>\n<p>When I write on paper, I’ll crumple it up and say, “That’s trash,” and start over. Why is it that I’m so reluctant to do it when it’s digital? I think that there’s something about that.</p>\n<p>That might be good advice. Try it on paper. Write it out on paper. If not, you don’t need to go to paper, but delete it. Start over. That first draft was all about learning. It’s a prototype. You figured out all the problems. Now, start over. Start over but with all this learning so you’re not influenced by the code you already have. Start again. Start fresh.</p>\n<p>That’s one of the benefits that we have of functional programming, is that things are so easy to write. Things are so short. Compared to other languages, other paradigms, we have plenty of extra time because it’s so quick to write.</p>\n<p>Use that extra time to try a couple more variations. It’s that experimentation that will build up your skill and expression in being concise. The more you do that, the more you’ll get better the first time you do it.</p>\n<p>You’ll still need to do this. You probably could make it a life-long practice where you keep getting better over time by continually doing it even though you’re well past your peers in how well you write the first time.</p>\n<p>Of course, there’s going to be times when you don’t really have time. Of course, you’re under a strict deadline. Getting it right, getting it working is good enough. When you do have time, don’t even think of it as refactoring. Just think of it as trying it out in a different way.</p>\n<p>It’s what code Codas are all about. This is not just the functional programming thing. They talk about the same thing in other paradigms. Just practice coding. Very often, those Codas, you do the same one over and over because you have already figured out all the problems. Now, the practice is in exploring the different ways you could implement it.</p>\n<p>That’s been my thought on functional programming. I’m Eric Normand. You can find all of the other thoughts, the other episodes at lispcast.com/podcast. Besides the links to the episodes, you’ll find links to subscribe and to find me on social media. On the site/podcast, there are text, video, and audio versions of all of these episodes.</p>\n<p>Please get in touch with me if you have any questions or any comments. I love to learn about…When people disagree with me, often, it’s just something I said wrong, a misunderstanding. I love to hear about those. They give me great ideas for future thoughts, future episodes. Cool. My name is Eric Normand. This has been my thought. Rock on.</p>\n<p>The post <a rel=\"nofollow\" href=\"https://lispcast.com/why-should-you-throw-away-all-of-your-code/\">Why should you throw away all of your code?</a> appeared first on <a rel=\"nofollow\" href=\"https://lispcast.com\">LispCast</a>.</p>",
   :direction "ltr"},
  :updated 1564617600000,
  :entities
  [{:mentions [{:text "functional programming"}],
    :id "nlp/f/entity/wd:193076",
    :salienceLevel "about",
    :label "functional programming"}
   {:mentions [{:text "data structure"}],
    :id "nlp/f/entity/wd:175263",
    :salienceLevel "mention",
    :label "data structure"}
   {:mentions [{:text "Google"}],
    :id "nlp/f/entity/wd:95",
    :salienceLevel "mention",
    :label "Google"}],
  :alternate
  [{:href
    "https://lispcast.com/why-should-you-throw-away-all-of-your-code/",
    :type "text/html"}],
  :title "Why should you throw away all of your code?",
  :author "Eric Normand",
  :published-str "Wed Jul 31 17:00:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16c4ac7ea0b:7e4c13:4b2e0c8b",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url
   "https://lispcast.com/wp-content/uploads/2019/08/Why-should-you-throw-away-all-of-your-code_.jpg",
   :width 1280,
   :height 720,
   :contentType "image/jpeg"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://lispcast.com/?p=1943",
  :commonTopics
  [{:score 27.170019523679926,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.925,
    :id "nlp/f/topic/1555",
    :salienceLevel "about",
    :label "net"}
   {:score 0.859,
    :id "nlp/f/topic/2010",
    :salienceLevel "about",
    :label "scalability"}
   {:score 0.778,
    :id "nlp/f/topic/525",
    :salienceLevel "mention",
    :label "computer science"}],
  :published 1564617600000,
  :fingerprint "f9791445",
  :canonicalUrl
  "https://lispcast.com/why-should-you-throw-away-all-of-your-code/"}
 {:engagement 4,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/todo",
    :label "todo"}
   {:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1564617075849,
  :content
  {:content
   "<h1>\n<a href=\"https://dev.to/feed#reading-material\">\n</a>\nReading Material\n</h1>\n<h2>\n<a href=\"https://dev.to/feed#yet-another-staticvsdynamic-shindig\">\n</a>\nYet Another Static-vs-Dynamic Shindig\n</h2>\n<p>This week I came across a <a href=\"https://lispcast.com/clojure-and-types/\">fantastic article</a> by Eric Normand on the whole &quot;static vs dynamic&quot; debate, written by someone with the unique perspective of having worked professionally in both Clojure and Haskell.</p>\n<p>The article is worth a read, but I want to focus one one line in particular that stuck with me. I don't fully understand it, and am hoping DEV may be able to shed some extra light.</p>\n<p>The author was quoting a Rich Hickey talk. For the uninitiated, <a href=\"https://purelyfunctional.tv/programmer-profiles/rich-hickey/\">Rich Hickey</a> is the creator of <a href=\"https://clojure.org/\">Clojure</a>, a dynamic functional Lisp dialect for the JVM, and current CTO of <a href=\"https://cognitect.com/\">Cognitect</a>. Part of his cult of personality has stemmed from the rather excellent and rather opinionated talks he's given discussing both Clojure specifically and his personal take on the current state of the software ecosystem and how it applies to the sorts of problems he solves. (The rest stems from his <a href=\"https://purelyfunctional.tv/wp-content/uploads/2016/09/Rich-Hickey.jpg\">phenomenal hairdo</a>.)</p>\n<p>That's a huge takeaway, something Normand takes extra care to identify: Rich Hickey isn't talking about the merits of static vs. dynamic typing <strong>in the general case</strong>. He's concerned with <strong>how it applies to his problem space</strong>. This is a detail that is all too often lost when these debates flare up, but is a factor when making absolutely any technical decision at all, and is important to keep in mind when engaging in this sort of discourse.</p>\n<h2>\n<a href=\"https://dev.to/feed#the-efficacy-of-maybe\">\n</a>\nThe Efficacy of Maybe\n</h2>\n<p>The line in particular that caught my eye was when he's discussing the use of <code>Maybe</code> in languages like Haskell to handle the concept of optional values. Instead of a <code>String</code>, you'd type your field <code>Maybe String</code>. Now if can either contain a string or not and still be properly typed. You used pattern matching and destructuring to get at that actual value when your code needs to do something with it. You use it when you don't know for sure whether or not this value will exist at all times in a given record.</p>\n<p>Rich Hickey doesn't like this. He disagrees with this approach, stating &quot;you either have it or you don’t&quot;. It makes sense, too. For the sorts of programs Clojure is designed to address, <em>everything</em> would be wrapped in a <code>Maybe</code>. These are long-running systems with high fault tolerance and constantly changing business needs. These systems do not lend themselves to hyper-rigid beautiful strongly-typed structures. If the spec changes, you don't want to have to make structural updates across every file in your project. You want to be able to just deal with objects of different shapes.</p>\n<p>I can understand why it may be cumbersome to explicitly include a <code>Maybe</code> on every single value, but I'm less clear on why it actually represents an inaccurate model of your system. In fact, not knowing <a href=\"https://kotlinlang.org/\">Kotlin</a> it actually kinds seems like that's what they're approaching - reducing the overhead for a nullable type to a <a href=\"https://kotlinlang.org/docs/reference/null-safety.html\">single character</a>.</p>\n<p>That sounds like it works to me, but it also feels like there's truth to Hickey's perspective. When your system is running and you have a record, he's right. You don't &quot;optionally&quot; have a string here at runtime. You've either got it or you don't. That's just true. It seems like the <code>Maybe</code>-based model is indeed a workaround for the convenience of the programmer, as opposed to an accurate model of a real-world phenomenon. At the same time, though, it does seem to model the expected behavior, and at runtime you'll still need to dispatch logic based on whether or not a given field is present.</p>\n<p>Do you agree? Disagree? I've always felt <code>Maybe</code> to be an effective solution to this problem, and this read has made me want to step back, consider the issue more carefully, and collect some perspectives.</p>\n<p>Photo by marc liu on Unsplash</p>",
   :direction "ltr"},
  :updated 1564581138000,
  :entities
  [{:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "Normand"}],
    :id "nlp/f/entity/wd:35214",
    :salienceLevel "mention",
    :label "Anglo-Norman"}
   {:mentions [{:text "Haskell"}],
    :id "nlp/f/entity/wd:34010",
    :salienceLevel "mention",
    :label "Haskell"}
   {:mentions [{:text "cult of personality"}],
    :id "nlp/f/entity/wd:192914",
    :salienceLevel "mention",
    :label "cult of personality"}
   {:mentions [{:text "DEV"}],
    :id "nlp/f/entity/wd:232197",
    :salienceLevel "mention",
    :label "DEV"}],
  :alternate
  [{:href
    "https://dev.to/deciduously/you-either-have-it-or-you-don-t-44ef",
    :type "text/html"}],
  :title "You Either Have It Or You Don't",
  :author "Ben Lovy",
  :published-str "Wed Jul 31 06:52:18 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16c4a71ec89:75e874:561e4df6",
  :visual
  {:processor "feedly-nikon-v3.1",
   :url
   "https://res.cloudinary.com/practicaldev/image/fetch/s--FIP7nYIr--/c_imagga_scale,f_auto,fl_progressive,h_500,q_auto,w_1000/https://res.cloudinary.com/practicaldev/image/fetch/s--dQs1e4j3--/c_imagga_scale%2Cf_auto%2Cfl_progressive%2Ch_420%2Cq_auto%2Cw_1000/https://thepracticaldev.s3.amazonaws.com/i/lprcuq1ew8176curhwtl.jpg",
   :width 1000,
   :height 500,
   :contentType "image/jpeg"},
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId
  "https://dev.to/deciduously/you-either-have-it-or-you-don-t-44ef",
  :commonTopics
  [{:score 37.288991084513896,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.86,
    :id "nlp/f/topic/2010",
    :salienceLevel "about",
    :label "scalability"}],
  :published 1564581138000,
  :fingerprint "85e37a71",
  :canonicalUrl
  "https://dev.to/deciduously/you-either-have-it-or-you-don-t-44ef"}
 {:engagement 10,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1564571745326,
  :content
  {:content
   "<p>Summary: <em>As you get better with Clojure, it becomes easier to read. Why not jump ahead of the learning curve and read like an expert? Focus on the first thing, use the indentation, and read the evaluation order.</em></p>\n<p>One of the most frequent complaints about Clojure (and Lisps in general) is the ever-present parenthesis. Unfortunately, the stock answer is “you stop focusing on the parentheses after a few weeks”. That’s not very helpful for beginners. <strong>It doesn’t tell the beginner <em>what to focus on instead</em>.</strong></p>\n<p>Knowing what to focus on and how to interpret what you’re seeing are two skills that experts in any field have that beginners lack. <strong>Beginners see lots of parentheses. But what do experts see?</strong> What do they know that beginners don’t? Here are three really important ways experts read Clojure.</p>\n<h3>1. Focus on the first thing after the parens</h3>\n<p>In Ruby code, your eyes often use punctuation to find the meaning of code. Commas, braces, brackets, hash rocket, period, and, yes, parentheses. These all <strong>influence the meanings of what’s around them</strong>. And since they’re not letters, it’s easy to pick them out visually.</p>\n<p>In Clojure, you do have several types of punctuation. But overwhelming all of the others are the parentheses. Lisp has been called “toenail soup”, and “oatmeal with toenail clippings mixed in”. Yet people who use it a lot say <strong>they don’t mind the parentheses anymore</strong>. What gives?</p>\n<p>The thing is, the parens aren’t very meaningful by themselves. It only takes a little while programming in Clojure for your eyes to start looking not at the parens but at <strong>the first thing inside the paren</strong> for meaning. The first thing in the list defines how the rest of the list is interpreted.</p>\n<p><a href=\"http://clojure.org/special_forms\">Special forms</a> are defined in the compiler. There are also <a href=\"http://clojure.org/macros\">macros</a>, method calls, and functions. Special forms and macros all define their own rules for interpreting the rest of the stuff in the expression. <strong>You’ll pick those up over time</strong>, just like you can pick up the difference between curly braces and square braces. The other thing it can be is a method or function, which follow standard rules for evaluation (evaluate the arguments first, then call the function on them).</p>\n<p>These rules are internalized by Clojure programmers. It’s not hard to learn all of the special forms and the common macros (and the rest are functions). It comes with time.</p>\n<p>Of course, all of the different types of expresions can nest very nicely. Which brings us to the next point.</p>\n<h3>2. Indentation means scoping</h3>\n<p>Another common complaint is how much nesting is done in Lisps. It’s true, there’s <strong>more nesting than in other languages</strong>. When I was working in JavaScript, nesting felt bad. But in Clojure, you expect more nesting than in other languages. There is still such a thing as “too much nesting”. The line is just drawn further to the right. But as a Clojure programmer, I appreciate the nesting because <strong>it helps me write better code</strong>.</p>\n<p>Having parens play such a big role in the language means indentation is very easy and regular. There is a rather standard style for how Clojure code should be indented.<sup><a href=\"https://purelyfunctional.tv/tag/clojure/feed/#fn1\">1</a></sup> The result of the indentation is to let you <strong>see nesting without counting parens</strong>.</p>\n<p>Nesting is important in Clojure. Nesting defines scopes and groups functions with their arguments. <strong>Scopes let you reason about small bits of code in isolation.</strong> Nesting visually shows you the structure of your program. After a short while, you will be able to see the important structure of the code by the indentation. And that will lead you to the next point.</p>\n<h3>3. Learn the evaluation direction</h3>\n<p>If you use a language like JavaScript, you’re probably used to <strong>seeing the evaluation order of code very quickly</strong>. What I mean is, you know that you should read the following code from left to right.</p>\n<pre><code><span>person</span>.<span>getName</span>().<span>toUpperCase</span>().<span>trim</span>()</code></pre>\n<p>But you also know that you should read function calls right to left (or “inside out”).</p>\n<pre><code><span>trim</span>(<span>toUpperCase</span>(<span>getName</span>(person)))</code></pre>\n<p>Function definitions are read from top to bottom:</p>\n<pre><code><span>function</span> <span>upper_name</span>(person) {\n  <span>var</span> name = <span>person</span>.<span>getName</span>();\n  name = <span>name</span>.<span>toUpperCase</span>();\n  name = <span>name</span>.<span>trim</span>();\n  <span>return</span> name;\n}</code></pre>\n<p>And assignments are kind of left to right to left. First, you define the variable. Then you run the code on the right, <em>then</em> assign it to the thing on the left.</p>\n<pre><code><span>var</span> name = <span>upper_name</span>(person);</code></pre>\n<p>And of course, you can write code that combines all of those types of code. So you wind up reading each bit of code in a different way.</p>\n<pre><code><span>function</span> <span>x</span>(person) {\n  <span>var</span> name = <span>trim</span>(<span>person</span>.<span>getName</span>().<span>toUpperCase</span>());\n  <span>return</span> name;\n}</code></pre>\n<p>Clojure has all of that, too (well, everything except the left to right to left order). But the <em>visual signals</em> are different. Like the first point says, you should focus on the <em>first thing</em> in each pair of parens. Here are some examples of different reading directions in Clojure.</p>\n<p>Right to left (inside out):</p>\n<ul>\n<li>function calls, method calls</li>\n</ul>\n<pre><code>(.trim (.toUpperCase (.getName person)))</code></pre>\n<p>Top to bottom:</p>\n<ul>\n<li><a href=\"http://clojure.github.io/clojure/clojure.core-api.html#clojure.core/let\"><code>let</code></a>, <a href=\"http://clojure.github.io/clojure/clojure.core-api.html#clojure.core/fn\"><code>fn</code></a>, <a href=\"http://clojure.org/special_forms#Special%20Forms--(do%20exprs*)\"><code>do</code></a>, <a href=\"http://clojure.github.io/clojure/clojure.core-api.html#clojure.core/doseq\"><code>doseq</code></a>, <a href=\"http://clojure.github.io/clojure/clojure.core-api.html#clojure.core/dotimes\"><code>dotimes</code></a>, etc</li>\n</ul>\n<pre><code>(<span>let</span> [<span>name</span> (.getName person)\n      <span>name</span> (.toUpperCase <span>name</span>)\n      <span>name</span> (.trim <span>name</span>)]\n  <span>name</span>)</code></pre>\n<p>Left to right:</p>\n<ul>\n<li><a href=\"http://clojure.github.io/clojure/clojure.core-api.html#clojure.core/-%3e\"><code>-></code></a>, <a href=\"http://clojure.github.io/clojure/clojure.core-api.html#clojure.core/-%3e%3e\"><code>->></code></a>, <a href=\"http://clojure.github.io/clojure/clojure.core-api.html#clojure.core/..\"><code>..</code></a>, etc</li>\n</ul>\n<pre><code>(<span>-></span> person .getName .toUpperCase .trim)</code></pre>\n<p>Those are just some examples. It takes a little practice, but soon you’ll be seeing the order you should read code in using the <em>first item</em> in the parens.</p>\n<h3>Conclusions</h3>\n<p>If you’ve never done Lisp before, the Clojure syntax can be a bit novel and bewildering. But it only takes a couple of weeks before you’ll have your bearings again. Just remember that everyone goes through that at first. After the adjustment, though, you’ll be able to easily pick out the <strong>visual landmarks</strong> you’ll need. And hopefully knowing what to look for can help you through that faster.</p>\n<p>If you’re serious about learning Clojure for a career change, you should look into <a href=\"http://www.purelyfunctional.tv/mentoring\"><em>PurelyFunctional.tv Online Mentoring</em></a>. It will guide you step-by-step to becoming a Clojure professional.</p>\n<div>\n<hr>\n<ol>\n<li>There are slight variations.<a href=\"https://purelyfunctional.tv/tag/clojure/feed/#fnref1\">↩</a></li>\n</ol>\n</div>\n<p>The post <a rel=\"nofollow\" href=\"https://purelyfunctional.tv/mini-guide/how-to-read-clojure-code-like-an-expert/\">How to Read Clojure Code Like an Expert</a> appeared first on <a rel=\"nofollow\" href=\"https://purelyfunctional.tv\">PurelyFunctional.tv</a>.</p>",
   :direction "ltr"},
  :updated 1564569552000,
  :entities
  [{:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "about",
    :label "Clojure"}
   {:mentions [{:text "Beginners"}],
    :id "nlp/f/entity/wd:814343",
    :salienceLevel "mention",
    :label "Beginners"}
   {:mentions [{:text "Lisp"}],
    :id "nlp/f/entity/wd:132874",
    :salienceLevel "mention",
    :label "Lisp"}
   {:mentions [{:text "learning curve"}],
    :id "nlp/f/entity/wd:1368723",
    :salienceLevel "mention",
    :label "learning curve"}
   {:mentions [{:text "JavaScript"}],
    :id "nlp/f/entity/wd:2005",
    :salienceLevel "mention",
    :label "JavaScript"}],
  :alternate
  [{:href
    "https://purelyfunctional.tv/mini-guide/how-to-read-clojure-code-like-an-expert/",
    :type "text/html"}],
  :title "How to Read Clojure Code Like an Expert",
  :author "Eric Normand",
  :published-str "Wed Jul 31 03:39:12 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16c47be3c2e:37c785:4b2e0c8b",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://purelyfunctional.tv/?p=31677",
  :commonTopics
  [{:score 53.99098727380894,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.891,
    :id "nlp/f/topic/1555",
    :salienceLevel "about",
    :label "net"}
   {:score 0.884,
    :id "nlp/f/topic/575",
    :salienceLevel "about",
    :label "crm"}
   {:score 0.842,
    :id "nlp/f/topic/1871",
    :salienceLevel "mention",
    :label "quant"}
   {:score 0.748,
    :id "nlp/f/topic/774",
    :salienceLevel "mention",
    :label "engineering"}],
  :published 1564569552000,
  :fingerprint "56aaa7da",
  :canonicalUrl
  "https://purelyfunctional.tv/mini-guide/how-to-read-clojure-code-like-an-expert/"}
 {:engagement 4,
  :unread false,
  :crawled 1564571745326,
  :content
  {:content
   "<p>The other day I wrote about some <a href=\"http://www.lispcast.com/java-learn-from-clojure\">principles that programming in Clojure</a> makes very clear. Those principles could be applied just as well in Java, and often are. However, there are some things that make Clojure distinct.</p>\n<p>Three of those distinctions are the way it deals with state change (using an <a href=\"http://en.wikipedia.org/wiki/Software_transactional_memory\">STM</a>), the <a href=\"http://clojure.org/data_structures\">Persistent Data Structures</a>, and the literal syntax for data with a reader (now called <a href=\"https://github.com/edn-format/edn\">edn</a>). Diving into the <a href=\"https://github.com/clojure/clojure\">source code for Clojure</a>, I realized that these three bits were written in Java. And that means that they can be used from Java. It is certainly not as easy as using them in Clojure, but they are all three powerful enough to warrant using them if you are using Java. <a href=\"http://mvnrepository.com/artifact/org.clojure/clojure/1.5.0\">You simply need to add one more JAR to your project (or add a maven dependency).</a> I have constructed a few minimal examples of their use.</p>\n<h3>1. Persistent Data Structures</h3>\n<p>Clojure comes with several powerful and fast collection classes. The interesting thing about them is that they are <a href=\"https://purelyfunctional.tv/guide/clojure-concurrency/#ds\">immutable</a>. If you want to add an object to a list, you actually create a new list containing the old elements and the new element. Instead of using copy-on-write, it reuses most of the internal structure of the original list, so only a small number of objects need to be allocated. It turns out that this can be done very quickly, comparable to using an <code>ArrayList</code>.</p>\n<p>The following example illustrates three of the more useful data structures: <a href=\"https://purelyfunctional.tv/guide/clojure-collections/#vector\">Vector</a>, <a href=\"https://purelyfunctional.tv/guide/clojure-collections/#hash-map\">HashMap</a>, and HashSet.</p>\n<pre><code>package persistent;\n\nimport clojure.lang.IPersistentMap;\nimport clojure.lang.IPersistentSet;\nimport clojure.lang.IPersistentVector;\nimport clojure.lang.PersistentHashMap;\nimport clojure.lang.PersistentHashSet;\nimport clojure.lang.PersistentVector;\n\npublic class PersistentTest {\n  public static void main(String[] args) {\n    IPersistentMap m = PersistentHashMap.create(&quot;abc&quot;, &quot;xyz&quot;);\n    m = m.assoc(1, 4); // add a new key/value pair\n    m = m.assoc(&quot;key&quot;, &quot;value&quot;);\n    m = m.without(&quot;abc&quot;); // remove key &quot;abc&quot; \n    System.out.println(m);\n        \n    IPersistentVector v = PersistentVector.create(1, 2, 3);\n    v = v.assocN(0, &quot;a string&quot;); // change index 0\n    v = v.cons(&quot;should be last&quot;); // add a string at the end\n    System.out.println(v);\n            \n    IPersistentSet s = PersistentHashSet.create(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;);\n    s = (IPersistentSet) s.cons(&quot;d&quot;); // add d to the set\n    s = (IPersistentSet) ((IPersistentMap) s).without(&quot;a&quot;); // remove an element\n    s.contains(&quot;g&quot;); // should return false\n    System.out.println(s);\n  }\n}</code></pre>\n<p>Now, it ain’t pretty. But it’s actually no worse than quite a few native Java libraries I’ve seen. There may be a better way to do this, but this one works.</p>\n<h3>2. Software Transactional Memory</h3>\n<p>Clojure uses <a href=\"http://en.wikipedia.org/wiki/Multiversion_concurrency_control\">Multiversion concurrency control</a> to provide a safe way to manage concurrent access to state shared between threads. In Clojure, they are called <a href=\"http://clojure.org/refs\">refs</a>. I won’t go very deep into how it works. Suffice it to say that <a href=\"http://clojure.org/refs\">Clojure refs</a> gives you non-blocking reads and transactional updates without having to do locking yourself. There are two caveats: 1 is that the value you give to the ref has to be immutable. 2 is that you should not perform IO (or perform any mutation) inside of the transaction.</p>\n<pre><code>package stm;\n\nimport java.util.concurrent.Callable;\n\nimport clojure.lang.LockingTransaction;\nimport clojure.lang.Ref;\n\npublic class STMTest {\n  public static void main(String[] args) {\n    // final needed to be used in anonymous class\n    final Ref r = new Ref(1);\n    final Ref s = new Ref(5);\n\n    try {\n      // run this in a transaction\n      // don't do IO inside\n      LockingTransaction.runInTransaction(\n        new Callable&lt;Object>() {\n          public Object call(){\n            s.set((Integer)r.deref() + 10);\n            r.set(2);\n            return null;\n          }\n        }\n      );\n    } catch (Exception e) {\n      e.printStackTrace();\n    }\n        \n    System.out.println(r.deref());\n    System.out.println(s.deref());\n  }\n}</code></pre>\n<h3>3. Extensible Data Notation</h3>\n<p>With <a href=\"https://github.com/clojure/clojure/blob/master/changes.md\">Clojure 1.5</a>, <a href=\"https://github.com/edn-format/edn\">edn</a> has become a standard part of the language. Edn is like an extensible JSON where the keys of objects can be any value (not just strings). It is based on the Clojure literal syntax, much in the same way that JSON is based on Javascript literal syntax. It is a nice way to serialize data. And since you already have the JAR in your project, it’s a no brainer to use it.</p>\n<pre><code>package edn;\n\nimport java.io.PushbackReader;\nimport java.io.StringReader;\n\nimport clojure.lang.EdnReader;\nimport clojure.lang.PersistentHashMap;\n\npublic class EDNTest {\n  public static void main(String[] args) {\n    // reading from a string\n    System.out.println(\n      EdnReader.readString(&quot;{\\&quot;x\\&quot; 1 \\&quot;y\\&quot; 2}&quot;, PersistentHashMap.EMPTY));\n\n    // reading from a Reader\n    // really, you can use any Reader wrapped in a PushbackReader\n    System.out.println(\n      EdnReader.read(new PushbackReader(new StringReader(&quot;#{10 2 3}&quot;)),\n                     PersistentHashMap.EMPTY));\n  }\n}</code></pre>\n<p>The post <a rel=\"nofollow\" href=\"https://purelyfunctional.tv/article/3-things-java-can-steal-from-clojure/\">3 Things Java Programmers Can Steal from Clojure</a> appeared first on <a rel=\"nofollow\" href=\"https://purelyfunctional.tv\">PurelyFunctional.tv</a>.</p>",
   :direction "ltr"},
  :updated 1564569372000,
  :entities
  [{:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "Java"}],
    :id "nlp/f/entity/wd:251",
    :salienceLevel "mention",
    :label "Java"}
   {:mentions [{:text "Reader"}],
    :id "nlp/f/entity/wd:159063",
    :salienceLevel "mention",
    :label "The Reader"}
   {:mentions [{:text "args"}],
    :id "nlp/f/entity/wd:2005914",
    :salienceLevel "mention",
    :label "entry point"}
   {:mentions [{:text "STM"}],
    :id "nlp/f/entity/wd:175646",
    :salienceLevel "mention",
    :label "scanning tunneling microscope"}],
  :alternate
  [{:href
    "https://purelyfunctional.tv/article/3-things-java-can-steal-from-clojure/",
    :type "text/html"}],
  :title "3 Things Java Programmers Can Steal from Clojure",
  :author "Eric Normand",
  :published-str "Wed Jul 31 03:36:12 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16c47be3c2e:37c784:4b2e0c8b",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://purelyfunctional.tv/?p=31675",
  :commonTopics
  [{:score 103.7969615325148,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}],
  :published 1564569372000,
  :fingerprint "acaf2baa",
  :canonicalUrl
  "https://purelyfunctional.tv/article/3-things-java-can-steal-from-clojure/"}
 {:engagement 4,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1564569091093,
  :content
  {:content
   "<p>Summary: <em>I go over a real-world example of how atoms and immutable values allow you to compose constructs in ways that are easy to reason about and less prone to error.</em></p>\n<p>The other day I was in IRC #clojure and someone asked a good question. They had code like the following, and they couldn’t understand why <strong>they couldn’t modify a map</strong>.</p>\n<pre><code>(def state (atom {}))\n\n(doseq [x [1 2 3]]\n  (assoc @state :x x))\n\n(println @state)\n</code></pre>\n<p>What does this print? Well, the asker wanted it to print <code>{:x 3}</code>. But it printed <code>{}</code>. To understand what’s happening, <strong>let’s go step by step</strong>.</p>\n<p><code>{}</code> creates an empty map. It’s literal syntax for a <em>constructor</em> for a map. This one happens to be empty.</p>\n<p><code>(atom {})</code> takes the empty map that was just created and passes it to the function <a href=\"http://grimoire.arrdem.com/1.6.0/clojure.core/atom/\"><code>atom</code></a>, which constructs a new <code>clojure.lang.Atom</code>. <a href=\"https://purelyfunctional.tv/guide/clojure-concurrency/#atom\">Atoms</a> are objects, and its current state is the empty map we just passed in.</p>\n<p><code>(def state (atom {}))</code> defines a new var called <code>state</code> in the current namespace.</p>\n<p>At this point, we’ve got a variable called <code>state</code> whose value is an atom that holds an empty map.</p>\n<p><code>(doseq [x [1 2 3]]</code> loops over the numbers 1, 2, and 3. <code>x</code> will be bound to each of those numbers, in turn.</p>\n<p><code>@state</code> gets transformed into <code>(deref state)</code>, which returns the current value of <code>state</code>. <code>:x</code> is a literal keyword, and <code>x</code> is a reference to the <code>x</code> bound inside the loop.</p>\n<p><code>(assoc @state :x x)</code> creates a <em>new map</em> by taking the current value of <code>state</code> (which happens to be <code>{}</code>) and associating <code>:x</code> with <code>x</code> (which will be <code>1</code>, <code>2</code>, and <code>3</code> as the loop happens). The value is returned by <a href=\"http://grimoire.arrdem.com/1.6.0/clojure.core/assoc\"><code>assoc</code></a>, and then thrown away, since it isn’t bound to anything.</p>\n<p>Then <code>(println @state)</code> will print the current value of <code>state</code>, which still is <code>{}</code>.</p>\n<p>This code shows a common problem that beginners face in Clojure: how do <a href=\"https://purelyfunctional.tv/guide/clojure-concurrency/#ds\"><strong>immutable data structures</strong></a> (like maps) and the <strong>concurrency primitives</strong> (like <code>atom</code>) work together to manage state?</p>\n<p>The answer is quite simple (<a href=\"http://www.infoq.com/presentations/Simple-Made-Easy\">in the Rich Hickeyan sense</a>) and elegant. <strong>By separating the ideas of value and state, Clojure has made it easy to express precisely the behavior you want in concurrent systems.</strong></p>\n<p>The value is the map. It is immutable. It cannot change. It is a single value, and it will always be the same. That means <strong>threads can share the value with no worries that one of them will change it</strong>.</p>\n<p>The state is the atom. It’s a mutable object. And being an object, it has methods that define its interface. In the code above, we saw that you can call <a href=\"http://grimoire.arrdem.com/1.6.0/clojure.core/deref\"><code>deref</code></a> on an atom to get its current value. <code>deref</code> is basically a getter.</p>\n<p>The main way to <em>change</em> the value of an atom is using <a href=\"http://grimoire.arrdem.com/1.6.0/clojure.core/swap!\"><code>swap!</code></a>. <code>swap!</code> takes an atom and a function (plus optional arguments) and <strong>calls the function on the current value of the atom</strong>. It then sets the value of the atom to the return value of the function. So let’s use that to fix the code.</p>\n<pre><code>\n(def state (atom {}))\n\n(doseq [x [1 2 3]]\n  (swap! state assoc :x x))\n\n(println @state)\n</code></pre>\n<p><code>swap!</code> takes the atom (<code>state</code>) and a function (<code>assoc</code>) and some arguments (<code>:x x</code>). It calls <code>assoc</code> on the current value of <code>state</code> with those extra arguments and sets the value of the atom to the return value of the function.</p>\n<p>The <code>swap!</code> expression is almost (but not) the same as this code:</p>\n<pre><code>\n(reset! state (assoc @state :x x)) ;; never do this\n</code></pre>\n<p><a href=\"http://grimoire.arrdem.com/1.6.0/clojure.core/reset!\"><code>reset!</code></a> changes the state of the atom but without regard to the current value. This new code is bad because it’s not thread-safe. <strong>Use <code>swap!</code> if you need to use the current value to determine the new value.</strong></p>\n<p>So what does an atom do? What does it represent?</p>\n<p>Atoms guarantee one very important thing: that <strong>each state is calculated from the last state</strong>. The <code>swap!</code> operation is <em>atomic</em>. No matter how many threads are trying to change the value, each change is calculated from the previous value and no previous values are lost. That’s its contract as an object and it’s one of the important ways that <strong>Clojure helps with concurrency</strong>.</p>\n<p>How can a value be lost?</p>\n<p>If we have two threads, each trying to change <code>state</code> in the same incorrect way (using <code>reset!</code>), the order of evaluation will have several steps:</p>\n<ol>\n<li><code>(deref state)   ;; call this value *1</code></li>\n<li><code>(assoc *1 :x x) ;; call this value *2</code></li>\n<li><code>(reset! state *2)</code></li>\n</ol>\n<p>Because the threads are running concurrently, the operations have a chance of interleaving their steps in unwanted ways. For instance, threads A and B might interleave like this:</p>\n<ol>\n<li>A: <code>(deref state)    ;; call this value *1A</code></li>\n<li>A: <code>(assoc *1A :x x) ;; call this value *2A</code></li>\n<li>B: <code>(deref state)    ;; call this value *1B</code></li>\n<li>B: <code>(assoc *1B :x x) ;; call this value *2B</code></li>\n<li>B: <code>(reset! state *2B)</code></li>\n<li>A: <code>(reset! state *1A)</code></li>\n</ol>\n<p>What happened? On line 6, A set the value of <code>state</code> to the value it calculated on line 2. So <strong>B’s work is completely discarded</strong>. That’s probably not what was intended. What’s worse is that that is one of many possible interleavings, some of which work and some don’t. Welcome to concurrency!</p>\n<p>What you probably wanted was to make sure that <em>no</em> work is discarded. You want the operation to be <em>atomic</em>. That’s why it’s called an atom. <code>swap!</code> is atomic. A <code>swap!</code> to an atom occurs “all at once”, instead of on three lines like the <code>reset!</code> example. If two threads are doing <code>swap!</code>, there are two possible interleavings.</p>\n<ol>\n<li>A: <code>(swap! state assoc :x x)</code></li>\n<li>B: <code>(swap! state assoc :x x)</code></li>\n</ol>\n<p>And</p>\n<ol>\n<li>B: <code>(swap! state assoc :x x)</code></li>\n<li>A: <code>(swap! state assoc :x x)</code></li>\n</ol>\n<p>These are usually what you want. If <em>only one</em> or <em>neither one</em> works, <strong>atom is not the right construct for you</strong>.</p>\n<p>So there you go. Atomic mutable state with immutable values gives you a nice, <strong>composable concurrency <a href=\"https://purelyfunctional.tv/guide/clojure-collections/#two-layers\">semantics</a></strong>. You could do it with locks but it’s harder to ensure you’re doing it correctly. It’s slightly higher-level than locks yet it provides tremendous value. <strong>Atoms are easier to reason about and less prone to errors.</strong></p>\n<p>If you’d like to learn the basics of Clojure, I recommend my video course called <a href=\"http://www.purelyfunctional.tv/intro-to-clojure\">LispCast Introduction to Clojure</a>. I don’t go over concurrency, but you will learn lots of functional programming. Go check out <a href=\"http://www.purelyfunctional.tv/intro-to-clojure\">the description</a> to see if it’s right for you.</p>\n<p>The post <a rel=\"nofollow\" href=\"https://purelyfunctional.tv/mini-guide/atom-code-explanation/\">Atom code explanation</a> appeared first on <a rel=\"nofollow\" href=\"https://purelyfunctional.tv\">PurelyFunctional.tv</a>.</p>",
   :direction "ltr"},
  :updated 1564564113000,
  :entities
  [{:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "about",
    :label "Clojure"}
   {:mentions [{:text "IRC"}],
    :id "nlp/f/entity/wd:73",
    :salienceLevel "mention",
    :label "Internet Relay Chat"}
   {:mentions [{:text "functional programming"}],
    :id "nlp/f/entity/wd:193076",
    :salienceLevel "mention",
    :label "functional programming"}
   {:mentions [{:text "semantics"}],
    :id "nlp/f/entity/wd:39645",
    :salienceLevel "mention",
    :label "semantics"}],
  :alternate
  [{:href
    "https://purelyfunctional.tv/mini-guide/atom-code-explanation/",
    :type "text/html"}],
  :title "Atom code explanation",
  :author "Eric Normand",
  :published-str "Wed Jul 31 02:08:33 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16c4795bc15:35ec36:73d34570",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://purelyfunctional.tv/?p=31668",
  :commonTopics
  [{:score 43.46358822719888,
    :id "nlp/f/topic/3036",
    :salienceLevel "about",
    :label "physical science"}
   {:score 0.974,
    :id "nlp/f/topic/971",
    :salienceLevel "about",
    :label "gis"}
   {:score 0.822,
    :id "nlp/f/topic/1743",
    :salienceLevel "mention",
    :label "philosophy"}],
  :published 1564564113000,
  :fingerprint "8b564c98",
  :canonicalUrl
  "https://purelyfunctional.tv/mini-guide/atom-code-explanation/"}
 {:engagement 4,
  :tags
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/todo",
    :label "todo"}
   {:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/tag/global.read",
    :label ""}],
  :unread false,
  :crawled 1564566082105,
  :content
  {:content
   "<p>Summary: <em>If your functions return <code>core.async</code> channels instead of taking callbacks, you encourage them to be called within <code>go</code> blocks. Unchecked, this encouragement could proliferate your use of <code>go</code> blocks unnecessarily. There are some coding conventions that can minimize this problem.</em></p>\n<p>I’ve been using (and enjoying!) <code>core.async</code> for about a year now (mostly in ClojureScript). It has been a huge help for <strong>easily building concurrency patterns</strong> that would be incredibly difficult to engineer (and maintain and change) without it.</p>\n<p>Over that year, I’ve developed <strong>some practices for writing code with <code>core.async</code></strong>. I’m putting them here as an invitation for discussion.</p>\n<h3>Use callback style, if possible</h3>\n<p>A style develops when using <code>core.async</code> where you convert what would in regular ClojureScript be a callback style with <em>return-a-channel</em> style. The channel will contain the result of the call when it is ready.</p>\n<p>Using this style to keep you out of “callback hell” is overkill. “Callback hell” is not caused by a single callback. It is caused by the <strong>eternal damnation of coordinating multiple callbacks</strong> when they could be called in any order at any time. <strong>Callbacks invert control.</strong></p>\n<p><code>core.async</code> quenches the hellfire because coordinating channels within a <code>go</code> block is easy. The <code>go</code> block decides which values to read in which order. <strong>Control is restored to the code in a procedural style.</strong></p>\n<p>But return-a-channel style is not exactly free of sin. If you return a channel too much, <strong>the code that calls those functions will likely end up in a <code>go</code> block</strong>.</p>\n<p><code>go</code> blocks will proliferate. <code>go</code> blocks incur extra cost, especially in ClojureScript where they happen asynchronously, meaning at the next iteration of the event loop, <strong>which is indeterminately far away</strong>.</p>\n<p>Furthermore, <code>go</code> blocks might begin nesting (a function whose body is a <code>go</code> block is called by another function whose body is a <code>go</code> block, etc), which is correct semantically but <strong>probably won’t give you the performance you’re looking for</strong>. It’s best to avoid it.</p>\n<p>“How?” you say? The most important rule is to only use <code>core.async</code> in a particular function when necessary. If you can get by with just a callback, don’t use <code>core.async</code>. <strong>Just use a callback.</strong> For instance, let’s say you have an <code>ajax</code> function that takes a callback and you’re trying to make a small API wrapper for convenience. You could make it return a channel like this:</p>\n<pre><code>(defn search-google [query]\n  (let \n    (ajax (str &quot;http://google.com/?q=&quot; query) #(put! c %))\n    c))</code></pre>\n<p>The interesting thing to note is that <code>core.async</code> is not being used very well above. Yes, you get rid of a callback, but <strong>there isn’t much coordination happening</strong>, so it’s not needed. It’s best to keep it straightforward, like this:</p>\n<pre><code>(defn search-google [query cb]\n   (ajax (str &quot;http://gooogle.com/?q=&quot; query) cb))</code></pre>\n<p>You’re <strong>just doing one bit of work here</strong> (basically constructing a URL), which is a good sign. But how do you “lift” this into <code>core.async</code>?</p>\n<h3><code>&lt;&lt;&lt;</code></h3>\n<p>There’s a common pattern in Javascript (not ubiquitous, but very common) to put the callback at the end of the parameter list. Since the callback is last, <strong>you can easily write something to add it automatically</strong>.</p>\n<pre><code>(defn &lt;&lt;&lt; [f &amp; args]\n  (let \n    (apply f (concat args [(fn [x]\n                             (if (nil? x)\n                               (close! c)\n                               (put! c x)))]))\n    c))</code></pre>\n<p>This little function is very handy. It automatically <strong>adds a callback to a parameter list</strong>. You call it like this:</p>\n<pre><code>(go\n  (js/console.log (&lt;! (&lt;&lt;&lt; search-google &quot;unicorn droppings&quot;))))</code></pre>\n<p>This function lifts <code>search-google</code>, a regular asynchronous function written with callback style, into <code>core.async</code> return-a-channel style. With this function, <strong>if I always put the callback at the end, I can use my functions from within regular ClojureScript code and also from <code>core.async</code> code</strong>. I can also use any function (and there are many) that happen to have the callback last. This convention has two parts: <strong>always put the callback last and use <code>&lt;&lt;&lt;</code> when you need it</strong>. With this function, I can reserve <code>core.async</code> for coordination (what it’s good at), not merely simple asynchrony.</p>\n<h3><code>&lt;convention</code></h3>\n<p>There are times when writing a function using <code>go</code> blocks and returning channels <em>is</em> the best way. In those cases, I’ve adopted a naming convention. I <strong>put a <code>&lt;</code> prefix in front of functions that return channels</strong>. I tried it at the end of the name, but I like how it looks at the beginning.</p>\n<pre><code>(go\n  (js/console.log (&lt;! (&lt;do-something 1 2 3))))</code></pre>\n<p>The left-arrow of <code>&lt;do-something</code> fits right into the <code>&lt;!</code>. It also visually matches <code>(&lt;&lt;&lt; do-something 1 2 3)</code>, so it <strong>makes correct code look correct and <a href=\"http://www.joelonsoftware.com/articles/Wrong.html\">wrong code look wrong</a></strong>. The naming convention extends to named values as well:</p>\n<pre><code>(def &lt;values (chan))\n\n(go\n  (while true\n    (js/console.log (inc (&lt;! &lt;values)))))</code></pre>\n<h3>Conclusion</h3>\n<p>These conventions are a great compromise between ease of using <code>core.async</code> (<code>&lt;&lt;&lt;</code>) and universality (callbacks being universal in JS). The naming convention (<code>&lt;</code> prefix) visually marks code that should be used with <code>core.async</code>. These practices have taken me a long way. I’d love to discuss them with you <a href=\"http://discuss.purelyfunctional.tv/t/core-async-code-styles/46\">here</a>.</p>\n<p>If you know Clojure and you are interested in learning <code>core.async</code> in a fun, interactive style, check out the <a href=\"http://purelyfunctional.tv/core-async\">LispCast Clojure core.async videos</a>.</p>\n<p>The post <a rel=\"nofollow\" href=\"https://purelyfunctional.tv/mini-guide/core-async-code-style/\">core.async Code Style</a> appeared first on <a rel=\"nofollow\" href=\"https://purelyfunctional.tv\">PurelyFunctional.tv</a>.</p>",
   :direction "ltr"},
  :updated 1564563900000,
  :entities
  [{:mentions [{:text "args"}],
    :id "nlp/f/entity/wd:2005914",
    :salienceLevel "mention",
    :label "entry point"}
   {:mentions [{:text "Clojure"}],
    :id "nlp/f/entity/wd:51798",
    :salienceLevel "mention",
    :label "Clojure"}
   {:mentions [{:text "URL"}],
    :id "nlp/f/entity/wd:42253",
    :salienceLevel "mention",
    :label "Uniform Resource Locator"}
   {:mentions [{:text "API"}],
    :id "nlp/f/entity/wd:165194",
    :salienceLevel "mention",
    :label "application programming interface"}],
  :alternate
  [{:href
    "https://purelyfunctional.tv/mini-guide/core-async-code-style/",
    :type "text/html"}],
  :title "core.async Code Style",
  :author "Eric Normand",
  :published-str "Wed Jul 31 02:05:00 PDT 2019",
  :categories
  [{:id "user/70113bfa-0194-4887-b8b1-a828e4daf524/category/Clojure",
    :label "Clojure"}],
  :id
  "K3Y7GLlRfaBDsUWYD0WuXjH/byGbQnwaMWp+PEBoUZw=_16c4767d239:2ffda7:4b2e0c8b",
  :origin
  {:streamId "feed/http://planet.clojure.in/atom.xml",
   :title "Planet Clojure",
   :htmlUrl "http://planet.clojure.in/"},
  :originId "https://purelyfunctional.tv/?p=31667",
  :commonTopics
  [{:score 28.451189665802048,
    :id "nlp/f/topic/3001",
    :salienceLevel "about",
    :label "programming"}
   {:score 0.814,
    :id "nlp/f/topic/1871",
    :salienceLevel "mention",
    :label "quant"}
   {:score 0.779,
    :id "nlp/f/topic/2461",
    :salienceLevel "mention",
    :label "web design"}],
  :published 1564563900000,
  :fingerprint "be83fc5b",
  :canonicalUrl
  "https://purelyfunctional.tv/mini-guide/core-async-code-style/"})
